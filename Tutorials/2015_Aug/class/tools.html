<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><!-- InstanceBegin template="/Templates/temp2.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<!-- InstanceBeginEditable name="doctitle" -->
<title>WRFDA Practice</title>
<!-- InstanceEndEditable -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<SCRIPT language=JavaScript src="../assets/menu_array_class.js" type=text/javascript></SCRIPT>
<SCRIPT language=JavaScript src="../assets/mmenu.js" type=text/javascript></SCRIPT>
<!-- InstanceBeginEditable name="head" -->
<!-- InstanceEndEditable -->
<link href="../assets/wrfdastyle.css" rel="stylesheet" type="text/css">
<style type="text/css">
<!--
a:link {
	text-decoration: none;
}
a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}
a:active {
	text-decoration: none;
}
-->
</style></head>

<body id="top" bgcolor="#FFFFFF">
<table width="100%" border="2" cellpadding="0" cellspacing="0" bgcolor="cbffcd">
  <tr> 
    <td width="1485" colspan="3" bgcolor="#EEFFDD"><div align="center">
      <a href="../index.html"><img src="../images/header.png" alt="page header" height="125" border="0" align="left"></a>
    </div></td>
  </tr>
  <tr bgcolor="cbffcd" class="body"> 
    <td height="33" colspan="4" bgcolor="#99BB66">&nbsp;</td>
  </tr>
  <tr> 
    <td colspan="4" bgcolor="#EEFFDD"> <table width="90%" border="0" align="center" cellpadding="20" cellspacing="20">
        <tr> 
          <td valign="middle" bgcolor="#FFFFFF"><!-- InstanceBeginEditable name="maincontent" -->
            <span class="pagetitle">WRFDA Tools: Observation-based verification</span>
            <blockquote>
              <p>This exercise will teach you how to run WRFDA verification tools for observation-based verification.</p>
              <span class="bodyh1">Source code</span>
              <blockquote>
                <p>Get the <a href="wrfda_code.html">pre-compiled code</a>, if you have not done so. </p>
                <p><span class="stylecode">WRFDA/var/build/da_verif_obs.exe</span> is the executable that will be used in this session. It will be called directly by scripts, so there is no need to have it in your working directory.</p>
              </blockquote>
              <p><span class="bodyh1">Choose your working directory</span> </p>
              <blockquote>
                <p>For this exercise you should create<span class="stylecode"> /kumquat/users/${USER}/DA/verif_obs</span> and use this as your working directory.</p>
                <blockquote>
                <p class="stylecode">mkdir /kumquat/users/${USER}/DA/verif_obs<br>
                                     cd /kumquat/users/${USER}/DA/verif_obs</p>
                </blockquote>
                <p>You will need two scripts from the WRFDA TOOLS package: da_run_suite_verif_obs.ksh and da_verif_obs_plot.ksh. Copy them into your working directory.</p>
                <blockquote>
                <p class="stylecode">cp /kumquat/wrfhelp/DATA/WRFDA/TOOLS/scripts/da_run_suite_verif_obs.ksh .<br>
                                     cp /kumquat/wrfhelp/DATA/WRFDA/TOOLS/scripts/da_verif_obs_plot.ksh .</p>
                </blockquote>
                <p>The easiest way to control this scripts is by creating a "wrapper" script that sets the appropriate environment variables, then calls the scripts in order. Open a new file "verif_obs_wrapper.ksh" in vi (or your preferred text editor), and type the following:</p>
                <blockquote>
                <p class="stylecode">> vi verif_obs_wrapper.ksh<br>
                  #!/bin/ksh -aeux<br>
                  <br>
                  # Wrapper script for running WRFDA obs verification package<br>
                  <br>
                  # Settings for ./da_run_suite_verif_obs.ksh<br>
                  <br>
                  export CLEAN=false<br>
                  export INITIAL_DATE=2013122312<br>
                  export FINAL_DATE=2013122512<br>
                  export WRFVAR_DIR=/kumquat/users/${USER}/DA/WRFDA<br>
                  export SCRIPTS_DIR=/kumquat/wrfhelp/DATA/WRFDA/TOOLS/scripts<br>
                  export EXP_DIR=`pwd`/verify06<br>
                  export OB_DIR=/kumquat/wrfhelp/DATA/WRFDA/arctic_tutorial_case/ob/<br>
                  export FILTERED_OBS_DIR=/kumquat/wrfhelp/DATA/WRFDA/arctic_tutorial_case/filt_ob/<br>
                  export BE_DIR=/kumquat/wrfhelp/DATA/WRFDA/arctic_tutorial_case/be/<br>
                  export FC_DIR=/kumquat/wrfhelp/DATA/WRFDA/cycling/run<br>
                  export WINDOW_START=-3<br>
                  export WINDOW_END=3<br>
                  export CYCLE_PERIOD=6<br>
                  export NUM_PROCS=4<br>
                  export VERIFY_HOUR=6<br>
                  export RUN_CMD="mpirun -np $NUM_PROCS"<br>
                  export VERIFICATION_FILE_STRING=wrfout<br>
                  # Here is where you set the appropriate namelist variables that the script will use to run WRFDA<br>
                  export NL_ANALYSIS_TYPE=verify<br>
                  export NL_E_WE=181<br>
                  export NL_E_SN=181<br>
                  export NL_E_VERT=41<br>
                  export NL_DX=60000<br>
                  export NL_DY=60000<br>
                  export NL_SF_SURFACE_PHYSICS=2<br>
                  <br>
                  ./da_run_suite_verif_obs.ksh<br>
                  # Settings for da_verif_obs_plot.ksh<br>
                  <br>
                  export START_DATE=2013122312<br>
                  export END_DATE=2013122512<br>
                  export RUN_DIR=$EXP_DIR/plots<br>
                  export NUM_EXPT=1<br>
                  export REG_DIR=$EXP_DIR<br>
                  export EXP_NAMES='verify06'<br>
                  export EXP_LEGENDS='(/"verify06"/)'<br>
                  export EXP_DIRS="$EXP_DIR"<br>
                  export INTERVAL=6<br>
                  export NUM_PROCS=4<br>
                  export VERIFY_HOUR=00<br>
                  export GRAPHICS_DIR=/kumquat/wrfhelp/DATA/WRFDA/TOOLS/graphics/ncl<br>
                  export WRF_FILE="/kumquat/wrfhelp/DATA/WRFDA/cycling/run/2013122300/wrfout_d01_2013-12-23_00:00:00"<br>
                  export Verify_Date_Range="12z 23 Dec - 12z 25 Dec, 2015 (${INTERVAL} hour Cycle)"<br>
                  export OBS_TYPES=synop sound airep geoamv gpspw<br>
                  export NUM_OBS_TYPES=5<br>
                  export PLOT_WKS=pdf #"pdf" will save plots in pdf format; "x11" will display the plots and not save them<br>
                  <br>
                  ./da_verif_obs_plot.ksh</p>

                </blockquote>
                <p>Now make the script you just made executable using "chmod", then run it.</p>
                <blockquote>
                <p class="stylecode">> chmod +x verif_obs_wrapper.ksh</p>
                </blockquote>
              </blockquote>
            </blockquote>
            <span class="pagetitle">WRFDA Tools: Analysis-based verification</span>
            <blockquote>
              <span class="bodyh1">Input files</span>
<!--              <blockquote>
                <p>The setup for a pseduo-observation test is the same as <a href="3dvar.html">running WRFDA-3DVAR with real data</a> (except that the observation file ob.ascii is not required):</p>
                <blockquote>
                  <p class="stylecode">ln -fs /kumquat/users/${USER}/DA/WRFDA/run/LANDUSE.TBL ./LANDUSE.TBL <br>
                  ln -fs /kumquat/wrfhelp/DATA/WRFDA/CONUS60/be/be.dat ./be.dat <br>
                  ln -fs /kumquat/wrfhelp/DATA/WRFDA/CONUS60/rc/2008020512/wrfinput_d01 ./fg <br>
                </blockquote>
              </blockquote>
              <span class="bodyh1">Edit namelist.input</span>
              <blockquote>
                <p>Change and add the following <span class="stylecode">namelist.input</span> settings to activate the pseudo single ob test. You can do so by modifying the namelist.input used in the previous WRFDA-3DVAR tutorial case:</p>
                <blockquote>
                  <p class="stylecode">cp ../3dvar/namelist.input namelist.input</p>
                  <p class="stylecode">vi namelist.input</p>
                  <p class="stylecode">&amp;wrfvar15<br>
                    num_pseudo = 1,<br>
                    pseudo_x = 23.0, <br>
                    pseudo_y = 23.0, <br>
                    pseudo_z = 14.0, <br>
                    pseudo_err = 1.0,<br>
                    pseudo_val = 1.0,<br>
                    /<br>
                    &amp;wrfvar19<br>
                    pseudo_var = 'u'<br>
                    /</p>
                </blockquote>
                <p>Note: pseudo_var can be u, v, t, p, q. If pseudo_var is q, then the reasonable values of pseudo_err and pseudo_val are 0.001 in order to have reasonable analysis increments.</p>
                <p>By setting <span class="stylecode">num_pseudo = 1</span>, WRFDA will ignore real data and simply assimilate the pseudo-observation</p>
              </blockquote>
              <p><span class="bodyh1">Run WRFDA (da_wrfvar.exe)</span> </p>
              <blockquote>
                <p class="stylecode">mpirun -np 4 /kumquat/users/${USER}/DA/WRFDA/var/build/da_wrfvar_3dvar.exe</p>
              </blockquote>
              <p><span class="bodyh1">Check output</span>          </p>
              <blockquote>
                <p>As with every run of WRFDA, you should first make sure that the <span class="stylecode">rsl.out.0000</span> file ends with "<span class="stylecode">***&nbsp;WRF-Var&nbsp;completed&nbsp;successfully&nbsp;***</span>".</p>
                <p>Check the <span class="stylecode">statistics</span> file to view diagnostics related to your pseudo-obs run.</p>
                <p>Use <span class="stylecode">ncdiff</span> and <span class="stylecode">ncview</span> to generate and view the analysis increment file.</p>
                <blockquote>
                  <p class="stylecode">ncdiff -v U,V,T,QVAPOR,MU,P,PSFC wrfvar_output fg increment.nc<br>
                                       ncview increment.nc</p>
              </blockquote></blockquote>
              <span class="bodyh1">Graphics</span>
              <blockquote>
                <p>Some useful NCL scripts for this exercise are:<br>
                  <br>
                  WRFDA/var/graphics/ncl/WRF-Var_plot.ncl<br>
                  WRFDA/var/graphics/ncl/WRF_contributed.ncl.test<br>
                  WRFDA/var/graphics/ncl/psot_xy_auto.ncl<br>
                  WRFDA/var/graphics/ncl/psot_xz_auto.ncl<br>
                  WRFDA/var/graphics/ncl/psot_yz_auto.ncl
                </p>
              </blockquote>
            </blockquote>
            <blockquote>
              <span class="bodyh1">Other practice</span>
              <ul>
                <li>Response of BE length scaling parameters
                  <blockquote>
                    <p>                Run single ob test with the following additional parameters</p>
                    <p>                <span class="stylecode">vi namelist.input</span> (reduce length scale by 50%)</p>
                    <p class="stylecode">                &amp;wrfvar7<br>
                      len_scaling1 = 0.5<br>
                      len_scaling2 = 0.5<br>
                      len_scaling3 = 0.5<br>
                      len_scaling4 = 0.5<br>
                      len_scaling5 = 0.5<br>
                      /</p>
                  </blockquote>
                </li>
                <li>                  Response of changing BE variances
                  <blockquote>
                    <p>                Run single ob test with the following additional parameters</p>
                    <p><span class="stylecode">vi namelist.input</span> (reduce variance by 75%)</p>
                    <p class="stylecode">&amp;wrfvar7<br>
                      var_scaling1 = 0.25<br>
                      var_scaling2 = 0.25<br>
                      var_scaling3 = 0.25<br>
                      var_scaling4 = 0.25<br>
                      var_scaling5 = 0.25<br>
                      / </p>
                    <p>If this was successful, you can <a href="wrfda_sessions.html#session_gen_be">continue to the next practice case</a>.</p>
                  </blockquote>
                </li>
              </ul>
-->
            </blockquote>
<p>&nbsp;</p>
            <!-- InstanceEndEditable --><br>
            
          </td>
        </tr>
        <tr><td><a href="#top">back to top</a></td></tr>
    </table></td>
  </tr>
  <tr> 
    <td colspan="4" bgcolor="#99b86e">&nbsp;</td>
  </tr>
</table>

<map name="Map">
  <area shape="rect" coords="-189,-6,548,73" href="../../../index.html" alt="practice_page_header">
</map>
</body>
<!-- InstanceEnd --></html>
