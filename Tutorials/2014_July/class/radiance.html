<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><!-- InstanceBegin template="/Templates/temp2.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<!-- InstanceBeginEditable name="doctitle" -->
<title>WRFDA Practical</title>
<!-- InstanceEndEditable -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<SCRIPT language=JavaScript src="../assets/menu_array_class.js" type=text/javascript></SCRIPT>
<SCRIPT language=JavaScript src="../assets/mmenu.js" type=text/javascript></SCRIPT>
<!-- InstanceBeginEditable name="head" -->
<!-- InstanceEndEditable -->
<link href="../assets/wrfdastyle.css" rel="stylesheet" type="text/css">
<style type="text/css">
<!--
a:link {
	text-decoration: none;
}
a:visited {
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}
a:active {
	text-decoration: none;
}
-->
</style></head>

<body id="top" bgcolor="#FFFFFF">
<table width="100%" border="2" cellpadding="0" cellspacing="0" bgcolor="cbffcd">
  <tr> 
    <td width="190" align="left" bgcolor="#FFFFFF"><a href="../index.html"><img src="../images/hands_on.jpg" width="190" height="125" border="0" align="right"></a></td>
    <td width="1485" colspan="3" bgcolor="#EEFFDD"><div align="center">
      <a href="../index.html"><img src="../images/header.png" alt="page header" height="125" border="0" align="left"></a>
    </div></td>
  </tr>
  <tr bgcolor="cbffcd" class="body"> 
    <td height="33" colspan="4" bgcolor="#99BB66">&nbsp;</td>
  </tr>
  <tr> 
    <td colspan="4" bgcolor="#EEFFDD"> <table width="90%" border="0" align="center" cellpadding="20" cellspacing="20">
        <tr> 
          <td valign="middle" bgcolor="#FFFFFF"><!-- InstanceBeginEditable name="maincontent" -->
            <span class="pagetitle">Radiance data assimilation  </span>
            <blockquote>
              <p><span class="body">Reference: <a href="../docs/WRFDA_tutorial_radiance_201307.ppt">Download the tutorial presentation</a></span></p>
              <p><span class="bodyh1">Source code</span></p>
              <blockquote>
                <p>Get the <a href="wrfda_code.html">pre-compiled code</a>, if you have not done so. </p>
                <p><em>WRFDA/var/build/da_wrfvar.exe_3dvar</em> is the executable that will be used in this session.</p>
              </blockquote>
              <p><span class="bodyh1">Choice of your working directory </span> </p>
              <blockquote>
                <p>You should run each lesson in a separate directory, so that it will be easier to check for the necessary input files and look for what output files are created after a successful run.</p>
                <p>We recommend you create <em>/data1/${USER}/DA/radiance</em> to be your working directory for this session.</p>
                <blockquote>
                  <p class="stylecode">mkdir /data1/${USER}/DA/radiance<br>
                                       cd /data1/${USER}/DA/radiance</p>
              </blockquote></blockquote>
              <p><span class="bodyh1">Input files</span> </p>
              <blockquote>
                <p>The radiance case is the same CONUS60 case you have used in obsproc, running WRFDA-3DVAR and gen_be sessions. Keep in mind that when <a href="compile.html">compiling WRFDA yourself</a>, additional settings must be specified at compile time to utilize radiance data. This has been done for you in the pre-compiled code.</p>
                <p>Radiance assimilation for 3DVAR is much the same procedure as <a href="3dvar.html">Running WRFDA-3DVAR with conventional observations</a>. To begin this exercise, link/copy the basic input files above that you should have been familiar with by now:</p>
                <blockquote>
                  <p class="stylecode">ln -sf /data1/${USER}/DA/WRFDA/run/LANDUSE.TBL ./LANDUSE.TBL<br>
                                       ln -sf /data1/${USER}/DA/obsproc/obs_gts_2008-02-05_12:00:00.3DVAR ./ob.ascii<br>
                                       ln -sf /data1/${USER}/DA/gen_be/be.dat ./be.dat<br>
                                       <span style="color:red">(use /wrfhelp/DATA/WRFDA/CONUS60/be/be.dat if you have not done the GEN_BE exercise)</span><br>
                                       cp -p /wrfhelp/DATA/WRFDA/CONUS60/rc/2008020512/wrfinput_d01 ./fg</p>
                </blockquote>
                <p>In addition, the following extra files are required for radiance assimilation:</p>
              </blockquote>
              <ul>
                <li>Radiance data in NCEP BUFR format</li>
              </ul>
              <blockquote>
                <blockquote>
                  <p class="stylecodesmall">ln -fs /wrfhelp/DATA/WRFDA/CONUS60/ob/2008020512/gdas1.t12z.1bamua.tm00.bufr_d.linux ./amsua.bufr<br>
                    ln -fs /wrfhelp/DATA/WRFDA/CONUS60/ob/2008020512/gdas1.t12z.1bamub.tm00.bufr_d.linux ./amsub.bufr</p>
                </blockquote>
              </blockquote>
              <ul>
                <li>radiance_info files (you must link the whole directory)</li>
              </ul>
              <blockquote>
                <blockquote> 
                  <p class="stylecode">ln -fs /data1/${USER}/DA/WRFDA/var/run/radiance_info ./radiance_info</p>
                </blockquote>
              </blockquote>
              <ul>
                <li>File for variational bias correction</li>
              </ul>
              <blockquote>
                <blockquote>
                  <p class="stylecode">ln -fs /data1/${USER}/DA/WRFDA/var/run/VARBC.in ./VARBC.in</p>
                </blockquote>
              </blockquote>
              <ul>
                <li>Radiative Transfer Model (CRTM or RTTOV) coefficient files (you must link the whole directory)</li>
              </ul>
              <blockquote>
                <blockquote>
                  <p>(CRTM only)<span class="stylecode"> ln -fs /data1/${USER}/DA/WRFDA/var/run/crtm_coeffs ./crtm_coeffs</span></p>
                  <p>(RTTOV only) <span class="stylecode">ln -fs /wrfhelp/WRFDA/external/rttov10/rtcoef_rttov10/rttov7pred51L ./rttov_coeffs </span></p>
                </blockquote>
              </blockquote>
              <p><span class="bodyh1">Edit namelist.input</span> </p>
              <blockquote>
                <p>A sample namelist.input is provided in the WRFDA package as WRFDA/var/test/radiance/namelist.input</p>
                <p class="stylecode">cp /data1/${USER}/DA/WRFDA/var/test/radiance/namelist.input ./namelist.input</p>
                <p><span class="stylecode">vi namelist.input </span>(pay special attention to the following radiance-related settings)</p>
                <p class="stylecode">&amp;wrfvar4<br>
                  use_amsuaobs = .true.<br>
                  use_amsubobs = .true.<br>
                  /<br>
                  &amp;wrfvar14<br>
                  rtminit_nsensor = 6,<br>
                  rtminit_platform = 1,1,1,1,1,1<br>
                  rtminit_satid = 15,16,18,15,16,17<br>
                  rtminit_sensor = 3,3,3,4,4,4<br>
                  thinning_mesh = 120.0,120.0,120.0,120.0,120.0,120.0,<br>
                  thinning = .true.<br>
                  qc_rad = .true.<br>
                  write_iv_rad_ascii = .false.<br>
                  write_oa_rad_ascii = .true.<br>
                  rtm_option = 2<br>
                  only_sea_rad = .false.<br>
                  use_varbc = .true.<br>
                  <span style="color:red">use_crtm_kmatrix = .true.</span> (set "use_rttov_kmatrix" instead for RTTOV)<br>
                  <span style="color:red">varbc_nbgerr = 5000</span>
                  <br>
                  /<br>
                  &amp;wrfvar21<br>
                  time_window_min = &quot;2008-02-05_11:00:00&quot;<br>
                  /<br>
                  &amp;wrfvar22<br>
                time_window_max = &quot;2008-02-05_13:00:00&quot;<br>
                /
                </p>
              </blockquote>
              <p><span class="bodyh1">Run WRFDA</span> </p>
              <blockquote>
                <p class="stylecode">mpirun -np 4 /data1/${USER}/DA/WRFDA/var/build/da_wrfvar.exe_3dvar</p>
              </blockquote>
              <p><span class="bodyh1">Check output</span> </p>
              <blockquote>
                <p>Check analysis increments.</p>
                <p>Check <em><strong>statistics</strong></em>.</p>
                <p>There are extra diagnostic files when assimilating radiance data:</p>
                  <ul><li><b>01_oma_*amsu*</b>: Observation minus analysis statistics for each radiance instrument.</li>
                    <li><b>01_qcstat_*amsu*</b>: Quality control statistics for each radiance instrument.</li>
                    <li><b>VARBC.out</b>: Output file for Variational Bias Correction. This process is described in further detail in the <a href="http://www.mmm.ucar.edu/wrf/users/wrfda/Docs/user_guide_V3.5/WRFDA_Users_Guide.pdf">User's Guide</a></p>
              </blockquote>
              <span class="bodyh1">Graphics</span>
              <blockquote>
                <p><strong><em>/wrfhelp/SOURCE_CODE/WRFDA_SOURCE/TOOLS/scripts/da_rad_diags.ksh</em></strong><br>
                  Note: This version of <em><strong>da_rad_diag.ksh </strong></em> is customized to work for the directory structures for this tutorial. For your own applications, you should read through the default <em><strong>da_rad_diags.ksh</strong></em> and make proper changes.</p>
                <p>The diagnostics netCDF files will be created in the /data1/$USER/DA/radiance/diags directory.</p>
              </blockquote>
<p><span class="bodyh1">Other practice</span> </p>
              <ul>
                <li>Try linking<em> /wrfhelp/DATA/WRFDA/CONUS60/ob/2008020512/gdas1.t12z.1bamua.tm00.bufr_d</em> as <em>amsua.bufr</em> in your working directory and run WRFDA to see what log messages you will get.                </li>
              </ul>
              <p class="bodyh2"><a name="advance">Advanced </a></p>
              <ul>
                <li>
                  <p>Try changing some of the namelist.input settings (for example,  different instruments and sensors, different Radiative Transfer Model) and compare the results. </p>
                </li>
              </ul>
            </blockquote>
            <p>&nbsp;</p>
          <!-- InstanceEndEditable --><br>
            
          </td>
        </tr>
        <tr><td><a href="#top">back to top</a></td></tr>
    </table></td>
  </tr>
  <tr> 
    <td colspan="4" bgcolor="#99b86e">&nbsp;</td>
  </tr>
</table>

<map name="Map">
  <area shape="rect" coords="-189,-6,548,73" href="../../../index.html" alt="practical_page_header">
</map>
</body>
<!-- InstanceEnd --></html>
