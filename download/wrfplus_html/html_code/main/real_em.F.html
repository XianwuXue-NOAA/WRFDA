<HTML> <BODY BGCOLOR=#eeeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!  Create an initial data set for the WRF model based on real data.  This<a name='2'></font>
<font color=#447700>!  program is specifically set up for the Eulerian, mass-based coordinate.<a name='3'></font>
<A NAME='REAL_DATA'><A href='../../html_code/main/real_em.F.html#REAL_DATA' TARGET='top_target'><IMG SRC="../../gif/bar_yellow.gif" border=0></A><a name='4'>
<font color=#993300>PROGRAM </font><font color=#cc0000>real_data</font>,<A href='../../call_from/REAL_DATA.html' TARGET='index'>67</A><a name='5'>
<a name='6'>
   USE <A href='../../html_code/frame/module_machine.F.html#MODULE_MACHINE'>module_machine</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MACHINE_21"><a name='7'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_88"><a name='8'>
   USE <A href='../../html_code/dyn_exp/module_initialize_exp.F.html#MODULE_INITIALIZE'>module_initialize</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_INITIALIZE_4"><a name='9'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_11"><a name='10'>
   USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_34"><a name='11'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_98"><a name='12'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_20"><a name='13'>
#ifdef WRF_CHEM<a name='14'>
   USE module_input_chem_data<a name='15'>
   USE module_input_chem_bioemiss<a name='16'>
#endif<a name='17'>
   USE WRF_ESMF_MOD<a name='18'>
#ifdef DM_PARALLEL<a name='19'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_26"><a name='20'>
#endif<a name='21'>
<a name='22'>
   IMPLICIT NONE<a name='23'>
<a name='24'>
   REAL    :: time , bdyfrq<a name='25'>
<a name='26'>
   INTEGER :: loop , levels_to_process , debug_level<a name='27'>
<a name='28'>
<a name='29'>
   TYPE(domain) , POINTER :: null_domain<a name='30'>
   TYPE(domain) , POINTER :: grid<a name='31'>
   TYPE (grid_config_rec_type)              :: config_flags<a name='32'>
   INTEGER                :: number_at_same_level<a name='33'>
<a name='34'>
   INTEGER :: max_dom, domain_id<a name='35'>
   INTEGER :: idum1, idum2 <a name='36'>
#ifdef DM_PARALLEL<a name='37'>
   INTEGER                 :: nbytes<a name='38'>
   INTEGER, PARAMETER      :: configbuflen = 4* CONFIG_BUF_LEN<a name='39'>
   INTEGER                 :: configbuf( configbuflen )<a name='40'>
   LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='41'>
#endif<a name='42'>
<a name='43'>
   INTEGER :: ids , ide , jds , jde , kds , kde<a name='44'>
   INTEGER :: ims , ime , jms , jme , kms , kme<a name='45'>
   INTEGER :: ips , ipe , jps , jpe , kps , kpe<a name='46'>
   INTEGER :: ijds , ijde , spec_bdy_width<a name='47'>
   INTEGER :: i , j , k , idts, rc<a name='48'>
<a name='49'>
   CHARACTER (LEN=80)     :: message<a name='50'>
<a name='51'>
   INTEGER :: start_year , start_month , start_day , start_hour , start_minute , start_second<a name='52'>
   INTEGER ::   end_year ,   end_month ,   end_day ,   end_hour ,   end_minute ,   end_second<a name='53'>
   INTEGER :: interval_seconds , real_data_init_type<a name='54'>
   INTEGER :: time_loop_max , time_loop<a name='55'>
   TYPE(ESMF_TimeInterval) :: time_interval<a name='56'>
real::t1,t2<a name='57'>
   INTERFACE<a name='58'>
     SUBROUTINE Setup_Timekeeping( grid )<a name='59'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_89"><a name='60'>
      TYPE(domain), POINTER :: grid<a name='61'>
     END SUBROUTINE Setup_Timekeeping<a name='62'>
   END INTERFACE<a name='63'>
<a name='64'>
   <font color=#447700>!  Define the name of this program (program_name defined in module_domain)<a name='65'></font>
<a name='66'>
   <font color=#447700>! NOTE: share/input_wrf.F tests first 7 chars of this name to decide <a name='67'></font>
   <font color=#447700>! whether to read P_TOP as metadata from the SI (yes, if .eq. REAL_EM)<a name='68'></font>
<a name='69'>
   program_name = "REAL_EM V2.0.3.1 PREPROCESSOR"<a name='70'>
<a name='71'>
#ifdef DM_PARALLEL<a name='72'>
   CALL <A href='../../html_code/frame/module_io_quilt.F.html#DISABLE_QUILTING'>disable_quilting</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DISABLE_QUILTING_4"><a name='73'>
#endif<a name='74'>
<a name='75'>
   <font color=#447700>!  Initialize the modules used by the WRF system.  Many of the CALLs made from the<a name='76'></font>
   <font color=#447700>!  init_modules routine are NO-OPs.  Typical initializations are: the size of a<a name='77'></font>
   <font color=#447700>!  REAL, setting the file handles to a pre-use value, defining moisture and<a name='78'></font>
   <font color=#447700>!  chemistry indices, etc.<a name='79'></font>
<a name='80'>
   CALL       wrf_debug ( 100 , 'real_em: calling init_modules ' )<a name='81'>
   CALL <A href='../../html_code/share/init_modules.F.html#INIT_MODULES'>init_modules</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULES_11">(1)   <font color=#447700>! Phase 1 returns after MPI_INIT() (if it is called)<a name='82'></font>
   CALL ESMF_Initialize( defaultCalendar=ESMF_CAL_GREGORIAN, rc=rc )<a name='83'>
   CALL <A href='../../html_code/share/init_modules.F.html#INIT_MODULES'>init_modules</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULES_12">(2)   <font color=#447700>! Phase 2 resumes after MPI_INIT() (if it is called)<a name='84'></font>
<a name='85'>
   <font color=#447700>!  The configuration switches mostly come from the NAMELIST input.<a name='86'></font>
<a name='87'>
#ifdef DM_PARALLEL<a name='88'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='89'>
      CALL <A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG'>initial_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIAL_CONFIG_13"><a name='90'>
   ENDIF<a name='91'>
   CALL <A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER'>get_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_CONFIG_AS_BUFFER_12">( configbuf, configbuflen, nbytes )<a name='92'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_80">( configbuf, nbytes )<a name='93'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER'>set_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CONFIG_AS_BUFFER_12">( configbuf, configbuflen )<a name='94'>
   CALL wrf_dm_initialize<a name='95'>
#else<a name='96'>
   CALL <A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG'>initial_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIAL_CONFIG_14"><a name='97'>
#endif<a name='98'>
<a name='99'>
   CALL nl_get_debug_level ( 1, debug_level )<a name='100'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#SET_WRF_DEBUG_LEVEL'>set_wrf_debug_level</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_WRF_DEBUG_LEVEL_7"> ( debug_level )<a name='101'>
<a name='102'>
   CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_42"> ( program_name )<a name='103'>
<a name='104'>
   <font color=#447700>!  Allocate the space for the mother of all domains.<a name='105'></font>
<a name='106'>
   NULLIFY( null_domain )<a name='107'>
   CALL       wrf_debug ( 100 , 'real_em: calling alloc_and_configure_domain ' )<a name='108'>
   CALL <A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN'>alloc_and_configure_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_AND_CONFIGURE_DOMAIN_12"> ( domain_id  = 1           , &amp;<a name='109'>
                                     grid       = head_grid   , &amp;<a name='110'>
                                     parent     = null_domain , &amp;<a name='111'>
                                     kid        = -1            )<a name='112'>
<a name='113'>
   grid =&gt; head_grid<a name='114'>
<a name='115'>
   CALL <A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING'>Setup_Timekeeping</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SETUP_TIMEKEEPING_8"> ( grid )<a name='116'>
   CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_17"> ( 150, grid%domain_clock, &amp;<a name='117'>
                         'DEBUG real:  grid%domain_clock after Setup_Timekeeping,' )<a name='118'>
   CALL ESMF_TimeIntervalSet ( time_interval , S=model_config_rec%interval_seconds, rc=rc )<a name='119'>
   CALL ESMF_ClockSet ( grid%domain_clock , timeStep=time_interval , rc=rc )<a name='120'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_9">( ESMF_SUCCESS, rc, &amp;<a name='121'>
                         'ESMF_ClockSet(grid%domain_clock) FAILED', &amp;<a name='122'>
                         __FILE__ , &amp;<a name='123'>
                         __LINE__  )<a name='124'>
   CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_18"> ( 150, grid%domain_clock, &amp;<a name='125'>
                         'DEBUG real:  grid%domain_clock after timeStep set,' )<a name='126'>
<a name='127'>
<a name='128'>
   CALL       wrf_debug ( 100 , 'real_em: calling set_scalar_indices_from_config ' )<a name='129'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG'>set_scalar_indices_from_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_SCALAR_INDICES_FROM_CONFIG_18"> ( grid%id , idum1, idum2 )<a name='130'>
<a name='131'>
   CALL       wrf_debug ( 100 , 'real_em: calling model_to_grid_config_rec ' )<a name='132'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_26"> ( grid%id , model_config_rec , config_flags )<a name='133'>
<a name='134'>
   <font color=#447700>!  Initialize the WRF IO: open files, init file handles, etc.<a name='135'></font>
<a name='136'>
   CALL       wrf_debug ( 100 , 'real_em: calling init_wrfio' )<a name='137'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#INIT_WRFIO'>init_wrfio</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_WRFIO_7"><a name='138'>
<a name='139'>
   <font color=#447700>!  Some of the configuration values may have been modified from the initial READ<a name='140'></font>
   <font color=#447700>!  of the NAMELIST, so we re-broadcast the configuration records.<a name='141'></font>
<a name='142'>
#ifdef DM_PARALLEL<a name='143'>
   CALL       <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_133"> ( 100 , 'real_em: re-broadcast the configuration records' )<a name='144'>
   CALL <A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER'>get_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_CONFIG_AS_BUFFER_13">( configbuf, configbuflen, nbytes )<a name='145'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_81">( configbuf, nbytes )<a name='146'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER'>set_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CONFIG_AS_BUFFER_13">( configbuf, configbuflen )<a name='147'>
#endif<a name='148'>
<a name='149'>
   <font color=#447700>!   No looping in this layer.  <a name='150'></font>
<a name='151'>
   CALL       <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_134"> ( 100 , 'calling med_sidata_input' )<a name='152'>
   CALL <A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT'>med_sidata_input</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_SIDATA_INPUT_1"> ( grid , config_flags )<a name='153'>
   CALL       <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_135"> ( 100 , 'backfrom med_sidata_input' )<a name='154'>
<a name='155'>
   <font color=#447700>!  We are done.<a name='156'></font>
<a name='157'>
   CALL       <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_136"> (   0 , 'real_em: SUCCESS COMPLETE REAL_EM INIT' )<a name='158'>
<a name='159'>
   CALL <A href='../../html_code/frame/wrf_shutdown.F.html#WRF_SHUTDOWN'>wrf_shutdown</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SHUTDOWN_8"><a name='160'>
<a name='161'>
   CALL ESMF_Finalize( rc=rc )<a name='162'>
<a name='163'>
END PROGRAM real_data<a name='164'>
<a name='165'>
<A NAME='MED_SIDATA_INPUT'><A href='../../html_code/main/real_em.F.html#MED_SIDATA_INPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='166'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_sidata_input</font> ( grid , config_flags ) <A href='../../call_to/MED_SIDATA_INPUT.html' TARGET='index'>2</A>,<A href='../../call_from/MED_SIDATA_INPUT.html' TARGET='index'>62</A><a name='167'>
  <font color=#447700>! Driver layer<a name='168'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_90"><a name='169'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_12"><a name='170'>
  <font color=#447700>! Model layer<a name='171'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_99"><a name='172'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_1"><a name='173'>
   USE <A href='../../html_code/dyn_exp/module_initialize_exp.F.html#MODULE_INITIALIZE'>module_initialize</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_INITIALIZE_5"><a name='174'>
   USE <A href='../../html_code/share/module_optional_si_input.F.html#MODULE_OPTIONAL_SI_INPUT'>module_optional_si_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_OPTIONAL_SI_INPUT_3"><a name='175'>
#ifdef WRF_CHEM<a name='176'>
   USE module_input_chem_data<a name='177'>
   USE module_input_chem_bioemiss<a name='178'>
#endif<a name='179'>
<a name='180'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_2"><a name='181'>
   USE WRF_ESMF_MOD<a name='182'>
<a name='183'>
   IMPLICIT NONE<a name='184'>
<a name='185'>
<a name='186'>
  <font color=#447700>! Interface <a name='187'></font>
   INTERFACE<a name='188'>
     SUBROUTINE start_domain ( grid , allowed_to_read )  <font color=#447700>! comes from module_start in appropriate dyn_ directory<a name='189'></font>
       USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_91"><a name='190'>
       TYPE (domain) grid<a name='191'>
       LOGICAL, INTENT(IN) :: allowed_to_read<a name='192'>
     END SUBROUTINE start_domain<a name='193'>
   END INTERFACE<a name='194'>
<a name='195'>
  <font color=#447700>! Arguments<a name='196'></font>
   TYPE(domain)                :: grid<a name='197'>
   TYPE (grid_config_rec_type) :: config_flags<a name='198'>
  <font color=#447700>! Local<a name='199'></font>
   INTEGER                :: time_step_begin_restart<a name='200'>
   INTEGER                :: idsi , ierr , myproc<a name='201'>
   CHARACTER (LEN=80)      :: si_inpname<a name='202'>
   CHARACTER (LEN=80)      :: message<a name='203'>
<a name='204'>
   CHARACTER(LEN=19) :: start_date_char , end_date_char , current_date_char , next_date_char<a name='205'>
<a name='206'>
   INTEGER :: time_loop_max , loop, rc<a name='207'>
   INTEGER :: julyr , julday <a name='208'>
   REAL :: gmt<a name='209'>
real::t1,t2<a name='210'>
<a name='211'>
   grid%input_from_file = .true.<a name='212'>
   grid%input_from_file = .false.<a name='213'>
<a name='214'>
   CALL <A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END'>compute_si_start_and_end</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMPUTE_SI_START_AND_END_1"> ( model_config_rec%start_year  (grid%id) , &amp;<a name='215'>
                                   model_config_rec%start_month (grid%id) , &amp;<a name='216'>
                                   model_config_rec%start_day   (grid%id) , &amp;<a name='217'>
                                   model_config_rec%start_hour  (grid%id) , &amp;<a name='218'>
                                   model_config_rec%start_minute(grid%id) , &amp;<a name='219'>
                                   model_config_rec%start_second(grid%id) , &amp;<a name='220'>
                                   model_config_rec%  end_year  (grid%id) , &amp; <a name='221'>
                                   model_config_rec%  end_month (grid%id) , &amp;<a name='222'>
                                   model_config_rec%  end_day   (grid%id) , &amp;<a name='223'>
                                   model_config_rec%  end_hour  (grid%id) , &amp;<a name='224'>
                                   model_config_rec%  end_minute(grid%id) , &amp;<a name='225'>
                                   model_config_rec%  end_second(grid%id) , &amp;<a name='226'>
                                   model_config_rec%interval_seconds      , &amp;<a name='227'>
                                   model_config_rec%real_data_init_type   , &amp;<a name='228'>
                                   start_date_char , end_date_char , time_loop_max )<a name='229'>
<a name='230'>
   <font color=#447700>!  Override stop time with value computed above.  <a name='231'></font>
   CALL <A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME'>wrf_atotime</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ATOTIME_13">( end_date_char, grid%stop_time )<a name='232'>
   CALL ESMF_ClockSet ( grid%domain_clock , StopTime=grid%stop_time, rc=rc )<a name='233'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_10">( ESMF_SUCCESS, rc, &amp;<a name='234'>
                         'ESMF_ClockSet(grid%domain_clock) FAILED', &amp;<a name='235'>
                         __FILE__ , &amp;<a name='236'>
                         __LINE__  )<a name='237'>
   <font color=#447700>! TBH:  for now, turn off stop time and let it run data-driven<a name='238'></font>
   CALL ESMF_ClockStopTimeDisable( grid%domain_clock, rc=rc ) <a name='239'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_11">( ESMF_SUCCESS, rc, &amp;<a name='240'>
                         'ESMF_ClockStopTimeDisable(grid%domain_clock) FAILED', &amp;<a name='241'>
                         __FILE__ , &amp;<a name='242'>
                         __LINE__  )<a name='243'>
   CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_19"> ( 150, grid%domain_clock, &amp;<a name='244'>
                         'DEBUG med_sidata_input:  grid%domain_clock after stopTime set,' )<a name='245'>
<a name='246'>
   <font color=#447700>!  Here we define the initial time to process, for later use by the code.<a name='247'></font>
   <a name='248'>
   current_date_char = start_date_char<a name='249'>
   start_date = start_date_char // '.0000'<a name='250'>
   current_date = start_date<a name='251'>
<a name='252'>
   CALL nl_set_bdyfrq ( grid%id , REAL(model_config_rec%interval_seconds) )<a name='253'>
<a name='254'>
   <font color=#447700>!!!!!!!  Loop over each time period to process.<a name='255'></font>
<a name='256'>
   DO loop = 1 , time_loop_max<a name='257'>
<a name='258'>
      print *,'-----------------------------------------------------------------------------'<a name='259'>
      print *,' '<a name='260'>
      print '(A,A,A,I2,A,I2)' , ' Current date being processed: ',current_date, ', which is loop #',loop,' out of ',time_loop_max<a name='261'>
<a name='262'>
      <font color=#447700>!  After current_date has been set, fill in the julgmt stuff.<a name='263'></font>
<a name='264'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_JULGMT'>geth_julgmt</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_JULGMT_4"> ( config_flags%julyr , config_flags%julday , config_flags%gmt )<a name='265'>
<a name='266'>
        print *,'configflags%julyr, %julday, %gmt:',config_flags%julyr, config_flags%julday, config_flags%gmt<a name='267'>
      <font color=#447700>!  Now that the specific Julian info is available, save these in the model config record.<a name='268'></font>
<a name='269'>
      CALL nl_set_gmt (grid%id, config_flags%gmt)<a name='270'>
      CALL nl_set_julyr (grid%id, config_flags%julyr)<a name='271'>
      CALL nl_set_julday (grid%id, config_flags%julday)<a name='272'>
<a name='273'>
      <font color=#447700>!  Open the wrfinput file.<a name='274'></font>
<a name='275'>
      IF ( grid%dyn_opt .EQ. dyn_em ) THEN<a name='276'>
         CALL       wrf_debug ( 100 , 'med_sidata_input: calling open_r_dataset for wrf_real_input_em' )<a name='277'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2'>construct_filename2</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2_2">( si_inpname , 'wrf_real_input_em' , grid%id , 2 , current_date_char )<a name='278'>
      END IF<a name='279'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_4"> ( idsi, TRIM(si_inpname) , grid , config_flags , "DATASET=AUXINPUT1", ierr )<a name='280'>
      IF ( ( ierr .NE. 0 ) .AND. ( grid%dyn_opt .EQ. dyn_em ) ) THEN<a name='281'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_131">( 'error opening ' // TRIM(si_inpname) // ' for input; bad date in namelist or file not in directory' )<a name='282'>
      ENDIF<a name='283'>
<a name='284'>
      <font color=#447700>!  Input data.<a name='285'></font>
<a name='286'>
      CALL       wrf_debug ( 100 , 'med_sidata_input: calling input_aux_model_input1' )<a name='287'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT1'>input_aux_model_input1</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT1_1"> ( idsi ,   grid , config_flags , ierr )<a name='288'>
<a name='289'>
      <font color=#447700>!  Possible optional SI input.  This sets flags used by init_domain.<a name='290'></font>
      IF ( loop .EQ. 1 ) THEN<a name='291'>
         CALL       wrf_debug ( 100 , 'med_sidata_input: calling init_module_optional_si_input' )<a name='292'>
         CALL <A href='../../html_code/share/module_optional_si_input.F.html#INIT_MODULE_OPTIONAL_SI_INPUT'>init_module_optional_si_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULE_OPTIONAL_SI_INPUT_1"> ( grid , config_flags )<a name='293'>
      END IF<a name='294'>
      CALL       wrf_debug ( 100 , 'med_sidata_input: calling optional_si_input' )<a name='295'>
      CALL  <A href='../../html_code/share/module_optional_si_input.F.html#OPTIONAL_SI_INPUT'>optional_si_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_SI_INPUT_1"> ( grid , idsi )<a name='296'>
<a name='297'>
      <font color=#447700>!  Initialize the mother domain for this time period with input data.<a name='298'></font>
<a name='299'>
      CALL       wrf_debug ( 100 , 'med_sidata_input: calling init_domain' )<a name='300'>
      grid%input_from_file = .true.<a name='301'>
      CALL <A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_DOMAIN'>init_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_DOMAIN_2"> (  grid )<a name='302'>
      CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_27"> ( grid%id , model_config_rec , config_flags )<a name='303'>
<a name='304'>
      <font color=#447700>!  Close this file that is output from the SI and input to this pre-proc.<a name='305'></font>
<a name='306'>
      CALL       <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_137"> ( 100 , 'med_sidata_input: back from init_domain' )<a name='307'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_9"> ( idsi , config_flags , "DATASET=INPUT" )<a name='308'>
<a name='309'>
<font color=#447700>!     CALL start_domain ( grid , .TRUE. )<a name='310'></font>
<a name='311'>
#ifdef WRF_CHEM<a name='312'>
      IF ( loop == 1 ) THEN<a name='313'>
         IF ( ( grid%chem_opt .EQ. RADM2     ) .OR. &amp;<a name='314'>
              ( grid%chem_opt .EQ. RADM2SORG ) .OR. &amp;<a name='315'>
              ( grid%chem_opt .EQ. RACM      ) .OR. &amp;<a name='316'>
              ( grid%chem_opt .EQ. RACMSORG  ) ) THEN<a name='317'>
           <font color=#447700>! Read the chemistry data from a previous wrf forecast (wrfout file)<a name='318'></font>
           IF(grid%chem_in_opt == 1 ) THEN<a name='319'>
              message = 'INITIALIZING CHEMISTRY WITH OLD SIMULATION'<a name='320'>
              CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_43"> ( message )<a name='321'>
<a name='322'>
              CALL input_ext_chem_file( grid )<a name='323'>
<a name='324'>
              IF(grid%bio_emiss_opt == BEIS311 ) THEN<a name='325'>
                 message = 'READING BEIS3.11 EMISSIONS DATA'<a name='326'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_44"> ( message )<a name='327'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_2"> ( grid , config_flags)<a name='328'>
              END IF<a name='329'>
 <a name='330'>
           ELSEIF(grid%chem_in_opt == 0)then<a name='331'>
              <font color=#447700>! Generate chemistry data from a idealized vertical profile<a name='332'></font>
              message = 'STARTING WITH BACKGROUND CHEMISTRY '<a name='333'>
              CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_45"> ( message )<a name='334'>
<a name='335'>
              CALL input_chem_profile ( grid )<a name='336'>
<a name='337'>
              IF(grid%bio_emiss_opt == BEIS311 ) THEN<a name='338'>
                 message = 'READING BEIS3.11 EMISSIONS DATA'<a name='339'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_46"> ( message )<a name='340'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_3"> ( grid , config_flags)<a name='341'>
              END IF<a name='342'>
<a name='343'>
           ELSE<a name='344'>
             message = 'RUNNING WITHOUT CHEMISTRY INITIALIZATION'<a name='345'>
             CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_47"> ( message )<a name='346'>
           ENDIF<a name='347'>
         ENDIF<a name='348'>
      ENDIF<a name='349'>
#endif<a name='350'>
<a name='351'>
      CALL <A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT'>assemble_output</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ASSEMBLE_OUTPUT_1"> ( grid , config_flags , loop , time_loop_max )<a name='352'>
<a name='353'>
      <font color=#447700>!  Here we define the next time that we are going to process.<a name='354'></font>
<a name='355'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_7"> ( current_date_char , start_date_char , loop * model_config_rec%interval_seconds )<a name='356'>
      current_date =  current_date_char // '.0000'<a name='357'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME'>wrf_atotime</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ATOTIME_14">( current_date(1:19), grid%current_time )<a name='358'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_20"> ( 150, grid%domain_clock, &amp;<a name='359'>
                            'DEBUG med_sidata_input:  grid%domain_clock before currTime set,' )<a name='360'>
      WRITE (wrf_err_message,*) &amp;<a name='361'>
        'DEBUG med_sidata_input:  before currTime set, current_date = ',TRIM(current_date)<a name='362'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_138"> ( 150 , wrf_err_message )<a name='363'>
      CALL ESMF_ClockSet(grid%domain_clock, currTime=grid%current_time, rc=rc)<a name='364'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_12">( ESMF_SUCCESS, rc, &amp;<a name='365'>
                            'ESMF_ClockSet(grid%domain_clock) FAILED', &amp;<a name='366'>
                            __FILE__ , &amp;<a name='367'>
                            __LINE__  )<a name='368'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_21"> ( 150, grid%domain_clock, &amp;<a name='369'>
                            'DEBUG med_sidata_input:  grid%domain_clock after currTime set,' )<a name='370'>
if (loop.ne.time_loop_max )then<a name='371'>
print *,'set esmf clock to ',current_date(1:19)<a name='372'>
endif<a name='373'>
   END DO<a name='374'>
<a name='375'>
END SUBROUTINE med_sidata_input<a name='376'>
<a name='377'>
<A NAME='COMPUTE_SI_START_AND_END'><A href='../../html_code/main/real_em.F.html#COMPUTE_SI_START_AND_END' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='378'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>compute_si_start_and_end</font> (  &amp; <A href='../../call_to/COMPUTE_SI_START_AND_END.html' TARGET='index'>2</A>,<A href='../../call_from/COMPUTE_SI_START_AND_END.html' TARGET='index'>5</A><a name='379'>
   start_year , start_month , start_day , start_hour , start_minute , start_second , &amp;<a name='380'>
     end_year ,   end_month ,   end_day ,   end_hour ,   end_minute ,   end_second , &amp;<a name='381'>
   interval_seconds , real_data_init_type , &amp;<a name='382'>
   start_date_char , end_date_char , time_loop_max )<a name='383'>
<a name='384'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_3"><a name='385'>
<a name='386'>
   IMPLICIT NONE<a name='387'>
<a name='388'>
   INTEGER :: start_year , start_month , start_day , start_hour , start_minute , start_second<a name='389'>
   INTEGER ::   end_year ,   end_month ,   end_day ,   end_hour ,   end_minute ,   end_second<a name='390'>
   INTEGER :: interval_seconds , real_data_init_type<a name='391'>
   INTEGER :: time_loop_max , time_loop<a name='392'>
<a name='393'>
   CHARACTER(LEN=19) :: current_date_char , start_date_char , end_date_char , next_date_char<a name='394'>
<a name='395'>
   WRITE ( start_date_char , FMT = '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='396'>
           start_year,start_month,start_day,start_hour,start_minute,start_second<a name='397'>
   WRITE (   end_date_char , FMT = '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='398'>
             end_year,  end_month,  end_day,  end_hour,  end_minute,  end_second<a name='399'>
<a name='400'>
   IF ( end_date_char .LT. start_date_char ) THEN<a name='401'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_132">( 'Ending date in namelist ' // end_date_char // ' prior to beginning date ' // start_date_char )<a name='402'>
   END IF<a name='403'>
<a name='404'>
<font color=#447700>!  start_date = start_date_char // '.0000'<a name='405'></font>
<a name='406'>
   <font color=#447700>!  Figure out our loop count for the processing times.<a name='407'></font>
<a name='408'>
   time_loop = 1<a name='409'>
   PRINT '(A,I4,A,A,A)','Time period #',time_loop,' to process = ',start_date_char,'.'<a name='410'>
   current_date_char = start_date_char<a name='411'>
   loop_count : DO<a name='412'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_8"> ( next_date_char , current_date_char , interval_seconds )<a name='413'>
      IF      ( next_date_char .LT. end_date_char ) THEN<a name='414'>
         time_loop = time_loop + 1<a name='415'>
         PRINT '(A,I4,A,A,A)','Time period #',time_loop,' to process = ',next_date_char,'.'<a name='416'>
         current_date_char = next_date_char<a name='417'>
      ELSE IF ( next_date_char .EQ. end_date_char ) THEN<a name='418'>
         time_loop = time_loop + 1<a name='419'>
         PRINT '(A,I4,A,A,A)','Time period #',time_loop,' to process = ',next_date_char,'.'<a name='420'>
         PRINT '(A,I4,A)','Total analysis times to input = ',time_loop,'.'<a name='421'>
         time_loop_max = time_loop<a name='422'>
         EXIT loop_count<a name='423'>
      ELSE IF ( next_date_char .GT. end_date_char ) THEN<a name='424'>
         PRINT '(A,I4,A)','Total analysis times to input = ',time_loop,'.'<a name='425'>
         time_loop_max = time_loop<a name='426'>
         EXIT loop_count<a name='427'>
      END IF<a name='428'>
   END DO loop_count<a name='429'>
END SUBROUTINE compute_si_start_and_end<a name='430'>
<a name='431'>
<A NAME='ASSEMBLE_OUTPUT'><A href='../../html_code/main/real_em.F.html#ASSEMBLE_OUTPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='432'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>assemble_output</font> ( grid , config_flags , loop , time_loop_max ) <A href='../../call_to/ASSEMBLE_OUTPUT.html' TARGET='index'>2</A>,<A href='../../call_from/ASSEMBLE_OUTPUT.html' TARGET='index'>98</A><a name='433'>
<a name='434'>
   USE <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#MODULE_BIG_STEP_UTILITIES_EM'>module_big_step_utilities_em</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BIG_STEP_UTILITIES_EM_17"><a name='435'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_92"><a name='436'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_13"><a name='437'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_100"><a name='438'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_4"><a name='439'>
   USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_28"><a name='440'>
   IMPLICIT NONE<a name='441'>
<a name='442'>
   TYPE(domain)                 :: grid<a name='443'>
   TYPE (grid_config_rec_type)  :: config_flags<a name='444'>
   INTEGER , INTENT(IN)         :: loop , time_loop_max<a name='445'>
<a name='446'>
   INTEGER :: ids , ide , jds , jde , kds , kde<a name='447'>
   INTEGER :: ims , ime , jms , jme , kms , kme<a name='448'>
   INTEGER :: ips , ipe , jps , jpe , kps , kpe<a name='449'>
   INTEGER :: ijds , ijde , spec_bdy_width<a name='450'>
   INTEGER :: i , j , k , idts<a name='451'>
<a name='452'>
   INTEGER :: id1 , interval_seconds , ierr, rc<a name='453'>
   INTEGER , SAVE :: id <a name='454'>
   CHARACTER (LEN=80) :: inpname , bdyname<a name='455'>
   CHARACTER(LEN= 4) :: loop_char<a name='456'>
character *19 :: temp19<a name='457'>
character *24 :: temp24 , temp24b<a name='458'>
<a name='459'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: ubdy3dtemp1 , vbdy3dtemp1 , tbdy3dtemp1 , pbdy3dtemp1 , qbdy3dtemp1<a name='460'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: mbdy2dtemp1<a name='461'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: ubdy3dtemp2 , vbdy3dtemp2 , tbdy3dtemp2 , pbdy3dtemp2 , qbdy3dtemp2<a name='462'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: mbdy2dtemp2<a name='463'>
real::t1,t2<a name='464'>
<a name='465'>
   <font color=#447700>!  Various sizes that we need to be concerned about.<a name='466'></font>
<a name='467'>
   ids = grid%sd31<a name='468'>
   ide = grid%ed31<a name='469'>
   kds = grid%sd32<a name='470'>
   kde = grid%ed32<a name='471'>
   jds = grid%sd33<a name='472'>
   jde = grid%ed33<a name='473'>
<a name='474'>
   ims = grid%sm31<a name='475'>
   ime = grid%em31<a name='476'>
   kms = grid%sm32<a name='477'>
   kme = grid%em32<a name='478'>
   jms = grid%sm33<a name='479'>
   jme = grid%em33<a name='480'>
<a name='481'>
   ips = grid%sp31<a name='482'>
   ipe = grid%ep31<a name='483'>
   kps = grid%sp32<a name='484'>
   kpe = grid%ep32<a name='485'>
   jps = grid%sp33<a name='486'>
   jpe = grid%ep33<a name='487'>
<a name='488'>
   ijds = MIN ( ids , jds )<a name='489'>
   ijde = MAX ( ide , jde )<a name='490'>
<a name='491'>
   <font color=#447700>!  Boundary width, scalar value.<a name='492'></font>
<a name='493'>
   spec_bdy_width = model_config_rec%spec_bdy_width<a name='494'>
   interval_seconds = model_config_rec%interval_seconds<a name='495'>
<a name='496'>
print *,'spec_bdy_width, interval_seconds, loop=',spec_bdy_width , interval_seconds,loop<a name='497'>
<a name='498'>
   IF ( loop .EQ. 1 ) THEN<a name='499'>
<a name='500'>
      <font color=#447700>!  This is the space needed to save the current 3d data for use in computing<a name='501'></font>
      <font color=#447700>!  the lateral boundary tendencies.<a name='502'></font>
<a name='503'>
      ALLOCATE ( ubdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='504'>
      ALLOCATE ( vbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='505'>
      ALLOCATE ( tbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='506'>
      ALLOCATE ( pbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='507'>
      ALLOCATE ( qbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='508'>
      ALLOCATE ( mbdy2dtemp1(ims:ime,1:1,    jms:jme) )<a name='509'>
      ALLOCATE ( ubdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='510'>
      ALLOCATE ( vbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='511'>
      ALLOCATE ( tbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='512'>
      ALLOCATE ( pbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='513'>
      ALLOCATE ( qbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='514'>
      ALLOCATE ( mbdy2dtemp2(ims:ime,1:1,    jms:jme) )<a name='515'>
<a name='516'>
      <font color=#447700>!  Open the wrfinput file.  From this program, this is an *output* file.<a name='517'></font>
<a name='518'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_8">( inpname , 'wrfinput' , grid%id , 2 )<a name='519'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_8"> ( id1, TRIM(inpname) , grid , config_flags , output_model_input , "DATASET=INPUT", ierr )<a name='520'>
      IF ( ierr .NE. 0 ) THEN<a name='521'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_133">( 'real: error opening wrfinput for writing' )<a name='522'>
      ENDIF<a name='523'>
<font color=#447700>!     CALL calc_current_date ( grid%id , 0. )<a name='524'></font>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_MODEL_INPUT'>output_model_input</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_MODEL_INPUT_4"> ( id1, grid , config_flags , ierr )<a name='525'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_10"> ( id1 , config_flags , "DATASET=INPUT" )<a name='526'>
<a name='527'>
      <font color=#447700>!  We need to save the 3d data to compute a difference during the next loop.  Couple the<a name='528'></font>
      <font color=#447700>!  3d fields with total mu (mub + mu_2) and the stagger-specific map scale factor.<a name='529'></font>
<a name='530'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_16"> ( grid%em_mu_2 , grid%em_mub , ubdy3dtemp1 , grid%em_u_2                 , 'u' , grid%msfu , &amp;<a name='531'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='532'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_17"> ( grid%em_mu_2 , grid%em_mub , vbdy3dtemp1 , grid%em_v_2                 , 'v' , grid%msfv , &amp;<a name='533'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='534'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_18"> ( grid%em_mu_2 , grid%em_mub , tbdy3dtemp1 , grid%em_t_2                 , 't' , grid%msft , &amp;<a name='535'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='536'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_19"> ( grid%em_mu_2 , grid%em_mub , pbdy3dtemp1 , grid%em_ph_2                , 'h' , grid%msft , &amp;<a name='537'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='538'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_20"> ( grid%em_mu_2 , grid%em_mub , qbdy3dtemp1 , grid%moist_2(:,:,:,P_QV) , 't' , grid%msft , &amp;<a name='539'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='540'>
<a name='541'>
      DO j = jps , MIN(jde-1,jpe)<a name='542'>
         DO i = ips , MIN(ide-1,ipe)<a name='543'>
            mbdy2dtemp1(i,1,j) = grid%em_mu_2(i,j)<a name='544'>
         END DO<a name='545'>
      END DO<a name='546'>
<a name='547'>
      <font color=#447700>!  There are 2 components to the lateral boundaries.  First, there is the starting<a name='548'></font>
      <font color=#447700>!  point of this time period - just the outer few rows and columns.<a name='549'></font>
<a name='550'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_13">     ( ubdy3dtemp1 , grid%em_u_b     , 'U' , ijds , ijde , spec_bdy_width      , &amp;<a name='551'>
                                                                 ids , ide , jds , jde , kds , kde , &amp;<a name='552'>
                                                                 ims , ime , jms , jme , kms , kme , &amp;<a name='553'>
                                                                 ips , ipe , jps , jpe , kps , kpe )<a name='554'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_14">     ( vbdy3dtemp1 , grid%em_v_b     , 'V' , ijds , ijde , spec_bdy_width      , &amp;<a name='555'>
                                                                 ids , ide , jds , jde , kds , kde , &amp;<a name='556'>
                                                                 ims , ime , jms , jme , kms , kme , &amp;<a name='557'>
                                                                 ips , ipe , jps , jpe , kps , kpe )<a name='558'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_15">     ( tbdy3dtemp1 , grid%em_t_b     , 'T' , ijds , ijde , spec_bdy_width      , &amp;<a name='559'>
                                                                 ids , ide , jds , jde , kds , kde , &amp;<a name='560'>
                                                                 ims , ime , jms , jme , kms , kme , &amp;<a name='561'>
                                                                 ips , ipe , jps , jpe , kps , kpe )<a name='562'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_16">     ( pbdy3dtemp1 , grid%em_ph_b    , 'W' , ijds , ijde , spec_bdy_width      , &amp;<a name='563'>
                                                                 ids , ide , jds , jde , kds , kde , &amp;<a name='564'>
                                                                 ims , ime , jms , jme , kms , kme , &amp;<a name='565'>
                                                                 ips , ipe , jps , jpe , kps , kpe )<a name='566'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_17">     ( qbdy3dtemp1 , grid%em_rqv_b   , 'T' , ijds , ijde , spec_bdy_width      , &amp;<a name='567'>
                                                                 ids , ide , jds , jde , kds , kde , &amp;<a name='568'>
                                                                 ims , ime , jms , jme , kms , kme , &amp;<a name='569'>
                                                                 ips , ipe , jps , jpe , kps , kpe )<a name='570'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_18">     ( mbdy2dtemp1 , grid%em_mu_b    , 'M' , ijds , ijde , spec_bdy_width      , &amp;<a name='571'>
                                                                 ids , ide , jds , jde , 1 , 1 , &amp;<a name='572'>
                                                                 ims , ime , jms , jme , 1 , 1 , &amp;<a name='573'>
                                                                 ips , ipe , jps , jpe , 1 , 1 )<a name='574'>
<a name='575'>
<a name='576'>
   ELSE IF ( loop .GT. 1 ) THEN<a name='577'>
<a name='578'>
      <font color=#447700>!  Open the boundary file.<a name='579'></font>
<a name='580'>
<a name='581'>
      IF ( loop .eq. 2 ) THEN<a name='582'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_9">( bdyname , 'wrfbdy' , grid%id , 2 )<a name='583'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_9"> ( id, TRIM(bdyname) , grid , config_flags , output_boundary , "DATASET=BOUNDARY", ierr )<a name='584'>
         IF ( ierr .NE. 0 ) THEN<a name='585'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_134">( 'real: error opening wrfbdy for writing' )<a name='586'>
         ENDIF<a name='587'>
      ELSE<a name='588'>
         IF ( .NOT. ESMF_ClockIsStopTime(grid%domain_clock ,rc=rc) ) THEN<a name='589'>
            CALL ESMF_ClockAdvance( grid%domain_clock, rc=rc )<a name='590'>
            CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_22"> ( 150, grid%domain_clock, &amp;<a name='591'>
                                  'DEBUG assemble_output:  grid%domain_clock after ClockAdvance,' )<a name='592'>
         ENDIF<a name='593'>
      END IF<a name='594'>
<a name='595'>
<a name='596'>
      <font color=#447700>!  Couple this time period's data with total mu, and save it in the *bdy3dtemp2 arrays.<a name='597'></font>
<a name='598'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_21"> ( grid%em_mu_2 , grid%em_mub , ubdy3dtemp2 , grid%em_u_2                 , 'u' , grid%msfu , &amp;<a name='599'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='600'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_22"> ( grid%em_mu_2 , grid%em_mub , vbdy3dtemp2 , grid%em_v_2                 , 'v' , grid%msfv , &amp;<a name='601'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='602'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_23"> ( grid%em_mu_2 , grid%em_mub , tbdy3dtemp2 , grid%em_t_2                 , 't' , grid%msft , &amp;<a name='603'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='604'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_24"> ( grid%em_mu_2 , grid%em_mub , pbdy3dtemp2 , grid%em_ph_2                , 'h' , grid%msft , &amp;<a name='605'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='606'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_25"> ( grid%em_mu_2 , grid%em_mub , qbdy3dtemp2 , grid%moist_2(:,:,:,P_QV) , 't' , grid%msft , &amp;<a name='607'>
                    ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='608'>
<a name='609'>
      DO j = jps , jpe<a name='610'>
         DO i = ips , ipe<a name='611'>
            mbdy2dtemp2(i,1,j) = grid%em_mu_2(i,j)<a name='612'>
         END DO<a name='613'>
      END DO<a name='614'>
<a name='615'>
      <font color=#447700>!  During all of the loops after the first loop, we first compute the boundary<a name='616'></font>
      <font color=#447700>!  tendencies with the current data values (*bdy3dtemp2 arrays) and the previously <a name='617'></font>
      <font color=#447700>!  saved information stored in the *bdy3dtemp1 arrays.<a name='618'></font>
<a name='619'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_13"> ( ubdy3dtemp2 , ubdy3dtemp1 , REAL(interval_seconds) , grid%em_u_bt  , 'U' , &amp;<a name='620'>
                                                            ijds , ijde , spec_bdy_width      , &amp;<a name='621'>
                                                            ids , ide , jds , jde , kds , kde , &amp;<a name='622'>
                                                            ims , ime , jms , jme , kms , kme , &amp;<a name='623'>
                                                            ips , ipe , jps , jpe , kps , kpe )<a name='624'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_14"> ( vbdy3dtemp2 , vbdy3dtemp1 , REAL(interval_seconds) , grid%em_v_bt  , 'V' , &amp;<a name='625'>
                                                            ijds , ijde , spec_bdy_width      , &amp;<a name='626'>
                                                            ids , ide , jds , jde , kds , kde , &amp;<a name='627'>
                                                            ims , ime , jms , jme , kms , kme , &amp;<a name='628'>
                                                            ips , ipe , jps , jpe , kps , kpe )<a name='629'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_15"> ( tbdy3dtemp2 , tbdy3dtemp1 , REAL(interval_seconds) , grid%em_t_bt  , 'T' , &amp;<a name='630'>
                                                            ijds , ijde , spec_bdy_width      , &amp;<a name='631'>
                                                            ids , ide , jds , jde , kds , kde , &amp;<a name='632'>
                                                            ims , ime , jms , jme , kms , kme , &amp;<a name='633'>
                                                            ips , ipe , jps , jpe , kps , kpe )<a name='634'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_16"> ( pbdy3dtemp2 , pbdy3dtemp1 , REAL(interval_seconds) , grid%em_ph_bt  , 'W' , &amp;<a name='635'>
                                                            ijds , ijde , spec_bdy_width      , &amp;<a name='636'>
                                                            ids , ide , jds , jde , kds , kde , &amp;<a name='637'>
                                                            ims , ime , jms , jme , kms , kme , &amp;<a name='638'>
                                                            ips , ipe , jps , jpe , kps , kpe )<a name='639'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_17"> ( qbdy3dtemp2 , qbdy3dtemp1 , REAL(interval_seconds) , grid%em_rqv_bt , 'T' , &amp;<a name='640'>
                                                            ijds , ijde , spec_bdy_width      , &amp;<a name='641'>
                                                            ids , ide , jds , jde , kds , kde , &amp;<a name='642'>
                                                            ims , ime , jms , jme , kms , kme , &amp;<a name='643'>
                                                            ips , ipe , jps , jpe , kps , kpe )<a name='644'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_18"> ( mbdy2dtemp2 , mbdy2dtemp1 , REAL(interval_seconds) , grid%em_mu_bt  , 'M' , &amp;<a name='645'>
                                                            ijds , ijde , spec_bdy_width      , &amp;<a name='646'>
                                                            ids , ide , jds , jde , 1 , 1 , &amp;<a name='647'>
                                                            ims , ime , jms , jme , 1 , 1 , &amp;<a name='648'>
                                                            ips , ipe , jps , jpe , 1 , 1 )<a name='649'>
<a name='650'>
      <font color=#447700>!  Both pieces of the boundary data are now available to be written (initial time and tendency).<a name='651'></font>
      <font color=#447700>!  This looks ugly, these date shifting things.  What's it for?  We want the "Times" variable<a name='652'></font>
      <font color=#447700>!  in the lateral BDY file to have the valid times of when the initial fields are written.<a name='653'></font>
      <font color=#447700>!  That's what the loop-2 thingy is for with the start date.  We increment the start_date so<a name='654'></font>
      <font color=#447700>!  that the starting time in the attributes is the second time period.  Why you may ask.  I<a name='655'></font>
      <font color=#447700>!  agree, why indeed.<a name='656'></font>
<a name='657'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME'>wrf_atotime</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ATOTIME_15">( current_date(1:19), grid%current_time )<a name='658'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_23"> ( 150, grid%domain_clock, &amp;<a name='659'>
                            'DEBUG assemble_output:  grid%domain_clock before 1st currTime set,' )<a name='660'>
      WRITE (wrf_err_message,*) &amp;<a name='661'>
        'DEBUG assemble_output:  before 1st currTime set, current_date = ',TRIM(current_date)<a name='662'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_139"> ( 150 , wrf_err_message )<a name='663'>
      CALL ESMF_ClockSet(grid%domain_clock, currTime=grid%current_time, rc=rc)<a name='664'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_13">( ESMF_SUCCESS, rc, &amp;<a name='665'>
                            'ESMF_ClockSet(grid%domain_clock) FAILED', &amp;<a name='666'>
                            __FILE__ , &amp;<a name='667'>
                            __LINE__  )<a name='668'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_24"> ( 150, grid%domain_clock, &amp;<a name='669'>
                            'DEBUG assemble_output:  grid%domain_clock after 1st currTime set,' )<a name='670'>
<a name='671'>
      temp24= current_date<a name='672'>
      temp24b=start_date<a name='673'>
      start_date = current_date<a name='674'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_9"> ( temp19 , temp24b(1:19) , (loop-2) * model_config_rec%interval_seconds )<a name='675'>
      current_date = temp19 //  '.0000'<a name='676'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME'>wrf_atotime</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ATOTIME_16">( current_date(1:19), grid%current_time )<a name='677'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_25"> ( 150, grid%domain_clock, &amp;<a name='678'>
                            'DEBUG assemble_output:  grid%domain_clock before 2nd currTime set,' )<a name='679'>
      WRITE (wrf_err_message,*) &amp;<a name='680'>
        'DEBUG assemble_output:  before 2nd currTime set, current_date = ',TRIM(current_date)<a name='681'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_140"> ( 150 , wrf_err_message )<a name='682'>
      CALL ESMF_ClockSet(grid%domain_clock, currTime=grid%current_time, rc=rc)<a name='683'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_14">( ESMF_SUCCESS, rc, &amp;<a name='684'>
                            'ESMF_ClockSet(grid%domain_clock) FAILED', &amp;<a name='685'>
                            __FILE__ , &amp;<a name='686'>
                            __LINE__  )<a name='687'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_26"> ( 150, grid%domain_clock, &amp;<a name='688'>
                            'DEBUG assemble_output:  grid%domain_clock after 2nd currTime set,' )<a name='689'>
print *,'LBC valid between these times ',current_date, ' ',start_date<a name='690'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_BOUNDARY'>output_boundary</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_BOUNDARY_5"> ( id, grid , config_flags , ierr )<a name='691'>
      current_date = temp24<a name='692'>
      start_date = temp24b<a name='693'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME'>wrf_atotime</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ATOTIME_17">( current_date(1:19), grid%current_time )<a name='694'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_27"> ( 150, grid%domain_clock, &amp;<a name='695'>
                            'DEBUG assemble_output:  grid%domain_clock before 3rd currTime set,' )<a name='696'>
      WRITE (wrf_err_message,*) &amp;<a name='697'>
        'DEBUG assemble_output:  before 3rd currTime set, current_date = ',TRIM(current_date)<a name='698'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_141"> ( 150 , wrf_err_message )<a name='699'>
      CALL ESMF_ClockSet(grid%domain_clock, currTime=grid%current_time, rc=rc)<a name='700'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_15">( ESMF_SUCCESS, rc, &amp;<a name='701'>
                            'ESMF_ClockSet(grid%domain_clock) FAILED', &amp;<a name='702'>
                            __FILE__ , &amp;<a name='703'>
                            __LINE__  )<a name='704'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_28"> ( 150, grid%domain_clock, &amp;<a name='705'>
                            'DEBUG assemble_output:  grid%domain_clock after 3rd currTime set,' )<a name='706'>
<a name='707'>
      <font color=#447700>!  OK, for all of the loops, we output the initialzation data, which would allow us to<a name='708'></font>
      <font color=#447700>!  start the model at any of the available analysis time periods.<a name='709'></font>
<a name='710'>
<font color=#447700>!     WRITE ( loop_char , FMT = '(I4.4)' ) loop<a name='711'></font>
<font color=#447700>!     CALL open_w_dataset ( id1, 'wrfinput'//loop_char , grid , config_flags , output_model_input , "DATASET=INPUT", ierr )<a name='712'></font>
<font color=#447700>!     IF ( ierr .NE. 0 ) THEN<a name='713'></font>
<font color=#447700>!       CALL wrf_error_fatal( 'real: error opening wrfinput'//loop_char//' for writing' )<a name='714'></font>
<font color=#447700>!     ENDIF<a name='715'></font>
<a name='716'>
<font color=#447700>!     CALL calc_current_date ( grid%id , 0. )<a name='717'></font>
<font color=#447700>!     CALL output_model_input ( id1, grid , config_flags , ierr )<a name='718'></font>
<font color=#447700>!     CALL close_dataset ( id1 , config_flags , "DATASET=INPUT" )<a name='719'></font>
      <font color=#447700>!  Is this or is this not the last time time?  We can remove some unnecessary<a name='720'></font>
      <font color=#447700>!  stores if it is not.<a name='721'></font>
      IF     ( loop .LT. time_loop_max ) THEN<a name='722'>
<a name='723'>
         <font color=#447700>!  We need to save the 3d data to compute a difference during the next loop.  Couple the<a name='724'></font>
         <font color=#447700>!  3d fields with total mu (mub + mu_2) and the stagger-specific map scale factor.<a name='725'></font>
         <font color=#447700>!  We load up the boundary data again for use in the next loop.<a name='726'></font>
<a name='727'>
         DO j = jps , jpe<a name='728'>
            DO k = kps , kpe<a name='729'>
               DO i = ips , ipe<a name='730'>
                  ubdy3dtemp1(i,k,j) = ubdy3dtemp2(i,k,j)<a name='731'>
                  vbdy3dtemp1(i,k,j) = vbdy3dtemp2(i,k,j)<a name='732'>
                  tbdy3dtemp1(i,k,j) = tbdy3dtemp2(i,k,j)<a name='733'>
                  pbdy3dtemp1(i,k,j) = pbdy3dtemp2(i,k,j)<a name='734'>
                  qbdy3dtemp1(i,k,j) = qbdy3dtemp2(i,k,j)<a name='735'>
               END DO<a name='736'>
            END DO<a name='737'>
         END DO<a name='738'>
<a name='739'>
         DO j = jps , jpe<a name='740'>
            DO i = ips , ipe<a name='741'>
               mbdy2dtemp1(i,1,j) = mbdy2dtemp2(i,1,j)<a name='742'>
            END DO<a name='743'>
         END DO<a name='744'>
<a name='745'>
         <font color=#447700>!  There are 2 components to the lateral boundaries.  First, there is the starting<a name='746'></font>
         <font color=#447700>!  point of this time period - just the outer few rows and columns.<a name='747'></font>
<a name='748'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_19">     ( ubdy3dtemp1 , grid%em_u_b     , 'U' , ijds , ijde , spec_bdy_width      , &amp;<a name='749'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='750'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='751'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='752'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_20">     ( vbdy3dtemp1 , grid%em_v_b     , 'V' , ijds , ijde , spec_bdy_width      , &amp;<a name='753'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='754'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='755'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='756'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_21">     ( tbdy3dtemp1 , grid%em_t_b     , 'T' , ijds , ijde , spec_bdy_width      , &amp;<a name='757'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='758'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='759'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='760'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_22">     ( pbdy3dtemp1 , grid%em_ph_b    , 'W' , ijds , ijde , spec_bdy_width      , &amp;<a name='761'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='762'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='763'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='764'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_23">     ( qbdy3dtemp1 , grid%em_rqv_b   , 'T' , ijds , ijde , spec_bdy_width      , &amp;<a name='765'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='766'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='767'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='768'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_24">     ( mbdy2dtemp1 , grid%em_mu_b    , 'M' , ijds , ijde , spec_bdy_width      , &amp;<a name='769'>
                                                                    ids , ide , jds , jde , 1 , 1 , &amp;<a name='770'>
                                                                    ims , ime , jms , jme , 1 , 1 , &amp;<a name='771'>
                                                                    ips , ipe , jps , jpe , 1 , 1 )<a name='772'>
<a name='773'>
      ELSE IF ( loop .EQ. time_loop_max ) THEN<a name='774'>
<a name='775'>
         <font color=#447700>!  If this is the last time through here, we need to close the files.<a name='776'></font>
<a name='777'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_11"> ( id , config_flags , "DATASET=BOUNDARY" )<a name='778'>
<a name='779'>
      END IF<a name='780'>
<a name='781'>
   END IF<a name='782'>
<a name='783'>
END SUBROUTINE assemble_output<a name='784'>
</pre></body></html>