<HTML> <BODY BGCOLOR=#eeeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!  Create an initial data set for the WRF model based on real data.  This<a name='2'></font>
<font color=#447700>!  program is specifically set up for the NMM core.<a name='3'></font>
<a name='4'>
<A NAME='REAL_DATA'><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='top_target'><IMG SRC="../../gif/bar_yellow.gif" border=0></A><a name='5'>
<font color=#993300>PROGRAM </font><font color=#cc0000>real_data</font>,<A href='../../call_from/REAL_DATA.html' TARGET='index'>67</A><a name='6'>
<a name='7'>
   USE <A href='../../html_code/frame/module_machine.F.html#MODULE_MACHINE'>module_machine</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MACHINE_22"><a name='8'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_93"><a name='9'>
   USE <A href='../../html_code/dyn_exp/module_initialize_exp.F.html#MODULE_INITIALIZE'>module_initialize</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_INITIALIZE_6"><a name='10'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_14"><a name='11'>
   USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_35"><a name='12'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_101"><a name='13'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_21"><a name='14'>
   USE wrf_esmf_mod<a name='15'>
#ifdef DM_PARALLEL<a name='16'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_27"><a name='17'>
#endif<a name='18'>
<a name='19'>
   IMPLICIT NONE<a name='20'>
<a name='21'>
   REAL    :: time , bdyfrq<a name='22'>
<a name='23'>
   INTEGER :: loop , levels_to_process , debug_level<a name='24'>
<a name='25'>
<a name='26'>
   TYPE(domain) , POINTER :: null_domain<a name='27'>
   TYPE(domain) , POINTER :: grid<a name='28'>
   TYPE (grid_config_rec_type)              :: config_flags<a name='29'>
   INTEGER                :: number_at_same_level<a name='30'>
<a name='31'>
   INTEGER :: max_dom, domain_id<a name='32'>
   INTEGER :: idum1, idum2 <a name='33'>
#ifdef DM_PARALLEL<a name='34'>
   INTEGER                 :: nbytes<a name='35'>
<font color=#447700>!   INTEGER, PARAMETER      :: configbuflen = 2*1024<a name='36'></font>
   INTEGER, PARAMETER      :: configbuflen = 4*CONFIG_BUF_LEN<a name='37'>
   INTEGER                 :: configbuf( configbuflen )<a name='38'>
   LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='39'>
#endif<a name='40'>
<a name='41'>
   INTEGER :: ids , ide , jds , jde , kds , kde<a name='42'>
   INTEGER :: ims , ime , jms , jme , kms , kme<a name='43'>
   INTEGER :: ips , ipe , jps , jpe , kps , kpe<a name='44'>
   INTEGER :: ijds , ijde , spec_bdy_width<a name='45'>
   INTEGER :: i , j , k , idts<a name='46'>
<a name='47'>
#ifdef DEREF_KLUDGE<a name='48'>
<font color=#447700>!  see http://www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='49'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='50'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='51'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='52'>
#endif<a name='53'>
<a name='54'>
   CHARACTER (LEN=80)     :: message<a name='55'>
<a name='56'>
   INTEGER :: start_year , start_month , start_day <a name='57'>
   INTEGER :: start_hour , start_minute , start_second<a name='58'>
   INTEGER :: end_year ,   end_month ,   end_day ,   &amp;<a name='59'>
              end_hour ,   end_minute ,   end_second<a name='60'>
   INTEGER :: interval_seconds , real_data_init_type<a name='61'>
   INTEGER :: time_loop_max , time_loop, rc<a name='62'>
   TYPE(ESMF_TimeInterval) :: time_interval<a name='63'>
   REAL    :: t1,t2<a name='64'>
<a name='65'>
   INTERFACE<a name='66'>
     SUBROUTINE Setup_Timekeeping( grid )<a name='67'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_94"><a name='68'>
      TYPE(domain), POINTER :: grid<a name='69'>
     END SUBROUTINE Setup_Timekeeping<a name='70'>
   END INTERFACE<a name='71'>
<a name='72'>
   <font color=#447700>!  Define the name of this program (program_name defined in module_domain)<a name='73'></font>
<a name='74'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_1"><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='75'>
<a name='76'>
   program_name = "REAL_NMM V2.0 PREPROCESSOR"<a name='77'>
<a name='78'>
#ifdef DM_PARALLEL<a name='79'>
   CALL <A href='../../html_code/frame/module_io_quilt.F.html#DISABLE_QUILTING'>disable_quilting</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DISABLE_QUILTING_5"><a name='80'>
#endif<a name='81'>
<a name='82'>
   <font color=#447700>!  Initialize the modules used by the WRF system.  <a name='83'></font>
   <font color=#447700>!  Many of the CALLs made from the<a name='84'></font>
   <font color=#447700>!  init_modules routine are NO-OPs.  Typical initializations <a name='85'></font>
   <font color=#447700>!  are: the size of a<a name='86'></font>
   <font color=#447700>!  REAL, setting the file handles to a pre-use value, defining moisture and<a name='87'></font>
   <font color=#447700>!  chemistry indices, etc.<a name='88'></font>
<a name='89'>
   CALL       wrf_debug ( 100 , 'real_nmm: calling init_modules ' )<a name='90'>
<a name='91'>
<font color=#447700>!!!!   CALL init_modules<a name='92'></font>
   CALL <A href='../../html_code/share/init_modules.F.html#INIT_MODULES'>init_modules</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULES_13">(1)   <font color=#447700>! Phase 1 returns after MPI_INIT() (if it is called)<a name='93'></font>
   CALL ESMF_Initialize( defaultCalendar=ESMF_CAL_GREGORIAN, rc=rc )<a name='94'>
   CALL <A href='../../html_code/share/init_modules.F.html#INIT_MODULES'>init_modules</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULES_14">(2)   <font color=#447700>! Phase 2 resumes after MPI_INIT() (if it is called)<a name='95'></font>
<a name='96'>
   <font color=#447700>!  The configuration switches mostly come from the NAMELIST input.<a name='97'></font>
<a name='98'>
#ifdef DM_PARALLEL<a name='99'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='100'>
	write(0,*) 'call initial_config'<a name='101'>
      CALL <A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG'>initial_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIAL_CONFIG_15"><a name='102'>
   ENDIF<a name='103'>
   CALL <A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER'>get_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_CONFIG_AS_BUFFER_14">( configbuf, configbuflen, nbytes )<a name='104'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_82">( configbuf, nbytes )<a name='105'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER'>set_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CONFIG_AS_BUFFER_14">( configbuf, configbuflen )<a name='106'>
   CALL wrf_dm_initialize<a name='107'>
#else<a name='108'>
   CALL <A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG'>initial_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIAL_CONFIG_16"><a name='109'>
#endif<a name='110'>
<a name='111'>
<a name='112'>
   CALL nl_get_debug_level ( 1, debug_level )<a name='113'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#SET_WRF_DEBUG_LEVEL'>set_wrf_debug_level</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_WRF_DEBUG_LEVEL_8"> ( debug_level )<a name='114'>
<a name='115'>
   CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_48"> ( program_name )<a name='116'>
<a name='117'>
   <font color=#447700>!  Allocate the space for the mother of all domains.<a name='118'></font>
<a name='119'>
   NULLIFY( null_domain )<a name='120'>
   CALL  wrf_debug ( 100 , 'real_nmm: calling alloc_and_configure_domain ' )<a name='121'>
   CALL <A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN'>alloc_and_configure_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_AND_CONFIGURE_DOMAIN_13"> ( domain_id  = 1           , &amp;<a name='122'>
                                     grid       = head_grid   , &amp;<a name='123'>
                                     parent     = null_domain , &amp;<a name='124'>
                                     kid        = -1            )<a name='125'>
<a name='126'>
   grid =&gt; head_grid<a name='127'>
   CALL <A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING'>Setup_Timekeeping</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SETUP_TIMEKEEPING_9"> ( grid )<a name='128'>
   CALL ESMF_TimeIntervalSet ( time_interval ,  &amp;<a name='129'>
             S=model_config_rec%interval_seconds,rc=rc )<a name='130'>
   CALL ESMF_ClockSet ( grid%domain_clock , timeStep=time_interval , rc=rc )<a name='131'>
<a name='132'>
   CALL wrf_debug ( 100 , 'real_nmm: calling set_scalar_indices_from_config ' )<a name='133'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG'>set_scalar_indices_from_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_SCALAR_INDICES_FROM_CONFIG_19"> ( grid%id , idum1, idum2 )<a name='134'>
<a name='135'>
   CALL     wrf_debug ( 100 , 'real_nmm: calling model_to_grid_config_rec ' )<a name='136'>
<a name='137'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_28"> ( grid%id , model_config_rec , config_flags )<a name='138'>
<a name='139'>
	write(0,*) 'after model_to_grid_config_rec, e_we, e_sn are: ', &amp;<a name='140'>
                    config_flags%e_we, config_flags%e_sn<a name='141'>
<a name='142'>
   <font color=#447700>!  Initialize the WRF IO: open files, init file handles, etc.<a name='143'></font>
<a name='144'>
   CALL       wrf_debug ( 100 , 'real_nmm: calling init_wrfio' )<a name='145'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#INIT_WRFIO'>init_wrfio</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_WRFIO_8"><a name='146'>
<a name='147'>
<font color=#447700>!  Some of the configuration values may have been modified from the initial READ<a name='148'></font>
<font color=#447700>!  of the NAMELIST, so we re-broadcast the configuration records.<a name='149'></font>
<a name='150'>
#ifdef DM_PARALLEL<a name='151'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_142"> ( 100 , 'real_nmm: re-broadcast the configuration records' )<a name='152'>
   CALL <A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER'>get_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_CONFIG_AS_BUFFER_15">( configbuf, configbuflen, nbytes )<a name='153'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_83">( configbuf, nbytes )<a name='154'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER'>set_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CONFIG_AS_BUFFER_15">( configbuf, configbuflen )<a name='155'>
#endif<a name='156'>
<a name='157'>
   <font color=#447700>!   No looping in this layer.  <a name='158'></font>
<a name='159'>
   CALL <A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT'>med_sidata_input</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_SIDATA_INPUT_2"> ( grid , config_flags )<a name='160'>
<a name='161'>
   <font color=#447700>!  We are done.<a name='162'></font>
<a name='163'>
   CALL       <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_143"> (   0 , 'real_nmm: SUCCESS COMPLETE REAL_EM INIT' )<a name='164'>
<a name='165'>
	write(0,*) 'to wrf_dm_shutdown call'<a name='166'>
<a name='167'>
#ifdef DM_PARALLEL<a name='168'>
    CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_SHUTDOWN'>wrf_dm_shutdown</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_SHUTDOWN_2"><a name='169'>
#endif<a name='170'>
	write(0,*) 'done done'<a name='171'>
<a name='172'>
END PROGRAM real_data<a name='173'>
<a name='174'>
<A NAME='MED_SIDATA_INPUT'><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='175'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_sidata_input</font> ( grid , config_flags ) <A href='../../call_to/MED_SIDATA_INPUT.html' TARGET='index'>2</A>,<A href='../../call_from/MED_SIDATA_INPUT.html' TARGET='index'>62</A><a name='176'>
  <font color=#447700>! Driver layer<a name='177'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_95"><a name='178'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_15"><a name='179'>
  <font color=#447700>! Model layer<a name='180'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_102"><a name='181'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_2"><a name='182'>
   USE <A href='../../html_code/dyn_exp/module_initialize_exp.F.html#MODULE_INITIALIZE'>module_initialize</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_INITIALIZE_7"><a name='183'>
   USE <A href='../../html_code/share/module_optional_si_input.F.html#MODULE_OPTIONAL_SI_INPUT'>module_optional_si_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_OPTIONAL_SI_INPUT_4"><a name='184'>
<a name='185'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_5"><a name='186'>
<a name='187'>
   IMPLICIT NONE<a name='188'>
<a name='189'>
<a name='190'>
  <font color=#447700>! Interface <a name='191'></font>
   INTERFACE<a name='192'>
     SUBROUTINE start_domain ( grid , allowed_to_read )  <font color=#447700>! comes from module_start in appropriate dyn_ directory<a name='193'></font>
       USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_96"><a name='194'>
       TYPE (domain) grid<a name='195'>
       LOGICAL, INTENT(IN) :: allowed_to_read<a name='196'>
     END SUBROUTINE start_domain<a name='197'>
   END INTERFACE<a name='198'>
<a name='199'>
  <font color=#447700>! Arguments<a name='200'></font>
   TYPE(domain)                :: grid<a name='201'>
   TYPE (grid_config_rec_type) :: config_flags<a name='202'>
  <font color=#447700>! Local<a name='203'></font>
   INTEGER                :: time_step_begin_restart<a name='204'>
   INTEGER                :: idsi , ierr , myproc<a name='205'>
   CHARACTER (LEN=80)      :: si_inpname<a name='206'>
   CHARACTER (LEN=80)      :: message<a name='207'>
<a name='208'>
   CHARACTER(LEN=19) :: start_date_char , end_date_char , &amp;<a name='209'>
                        current_date_char , next_date_char<a name='210'>
<a name='211'>
   INTEGER :: time_loop_max , loop<a name='212'>
   INTEGER :: julyr , julday , LEN<a name='213'>
<a name='214'>
   REAL :: gmt<a name='215'>
   REAL :: t1,t2<a name='216'>
<a name='217'>
#ifdef DEREF_KLUDGE<a name='218'>
<font color=#447700>!  see http://www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='219'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='220'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='221'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='222'>
#endif<a name='223'>
<a name='224'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_2"><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='225'>
<a name='226'>
<a name='227'>
   grid%input_from_file = .true.<a name='228'>
   grid%input_from_file = .false.<a name='229'>
<a name='230'>
   CALL <A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END'>compute_si_start_and_end</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMPUTE_SI_START_AND_END_2"> ( model_config_rec%start_year  (grid%id) , &amp;<a name='231'>
                            model_config_rec%start_month (grid%id) , &amp;<a name='232'>
                            model_config_rec%start_day   (grid%id) , &amp;<a name='233'>
                            model_config_rec%start_hour  (grid%id) , &amp;<a name='234'>
                            model_config_rec%start_minute(grid%id) , &amp;<a name='235'>
                            model_config_rec%start_second(grid%id) , &amp;<a name='236'>
                            model_config_rec%  end_year  (grid%id) , &amp; <a name='237'>
                            model_config_rec%  end_month (grid%id) , &amp;<a name='238'>
                            model_config_rec%  end_day   (grid%id) , &amp;<a name='239'>
                            model_config_rec%  end_hour  (grid%id) , &amp;<a name='240'>
                            model_config_rec%  end_minute(grid%id) , &amp;<a name='241'>
                            model_config_rec%  end_second(grid%id) , &amp;<a name='242'>
                            model_config_rec%interval_seconds      , &amp;<a name='243'>
                            model_config_rec%real_data_init_type   , &amp;<a name='244'>
                            start_date_char , end_date_char , time_loop_max )<a name='245'>
<a name='246'>
	write(0,*) 'return si_start_and_end'<a name='247'>
<a name='248'>
   <font color=#447700>!  Here we define the initial time to process, for later use by the code.<a name='249'></font>
<a name='250'>
   current_date_char = start_date_char<a name='251'>
<font color=#447700>!   start_date = start_date_char // '.0000'<a name='252'></font>
   start_date = start_date_char <a name='253'>
   current_date = start_date<a name='254'>
<a name='255'>
   CALL nl_set_bdyfrq ( grid%id , REAL(model_config_rec%interval_seconds) )<a name='256'>
<a name='257'>
	write(0,*) 'past set_bdyfrq'<a name='258'>
<a name='259'>
   <font color=#447700>!  Loop over each time period to process.<a name='260'></font>
<a name='261'>
	write(0,*) 'time_loop_max: ', time_loop_max<a name='262'>
   DO loop = 1 , time_loop_max<a name='263'>
<a name='264'>
	write(0,*) 'loop=', loop<a name='265'>
<a name='266'>
      print *,'-----------------------------------------------------------'<a name='267'>
      print *,' '<a name='268'>
      print '(A,A,A,I2,A,I2)' , ' Current date being processed: ', &amp;<a name='269'>
        current_date, ', which is loop #',loop,' out of ',time_loop_max<a name='270'>
<a name='271'>
      <font color=#447700>!  After current_date has been set, fill in the julgmt stuff.<a name='272'></font>
<a name='273'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_JULGMT'>geth_julgmt</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_JULGMT_5"> ( config_flags%julyr , config_flags%julday , &amp;<a name='274'>
                                              config_flags%gmt )<a name='275'>
<a name='276'>
	write(0,*) 'config_flags%julday: ', config_flags%julday<a name='277'>
	write(0,*) 'config_flags%gmt: ', config_flags%gmt<a name='278'>
<a name='279'>
      <font color=#447700>!  Now that the specific Julian info is available, <a name='280'></font>
      <font color=#447700>!  save these in the model config record.<a name='281'></font>
<a name='282'>
      CALL nl_set_gmt (grid%id, config_flags%gmt)<a name='283'>
      CALL nl_set_julyr (grid%id, config_flags%julyr)<a name='284'>
      CALL nl_set_julday (grid%id, config_flags%julday)<a name='285'>
<a name='286'>
	write(0,*) 'past set_julday, open the file'<a name='287'>
      <font color=#447700>!  Open the wrfinput file.<a name='288'></font>
<a name='289'>
	write(0,*) 'grid%dyn_opt= ', grid%dyn_opt<a name='290'>
	write(0,*) 'dyn_nmm= ', dyn_nmm<a name='291'>
<a name='292'>
<font color=#447700>!      IF ( grid%dyn_opt .EQ. dyn_em ) THEN<a name='293'></font>
<font color=#447700>!         CALL  wrf_debug ( 100 , &amp;<a name='294'></font>
<font color=#447700>!   'med_sidata_input: calling open_r_dataset for wrf_real_input_em')<a name='295'></font>
<font color=#447700>!<a name='296'></font>
<font color=#447700>!         CALL construct_filename2( si_inpname , 'wrf_real_input_em' , &amp;<a name='297'></font>
<font color=#447700>!                                        grid%id , 2 , current_date_char )<a name='298'></font>
<font color=#447700>!      ELSE IF ( grid%dyn_opt .EQ. dyn_eh ) THEN<a name='299'></font>
<font color=#447700>!         CALL  wrf_debug ( 100 , &amp;<a name='300'></font>
<font color=#447700>!   'med_sidata_input: calling open_r_dataset for wrf_real_input_eh' )<a name='301'></font>
<font color=#447700>!<a name='302'></font>
<font color=#447700>!         CALL construct_filename2( si_inpname , 'wrf_real_input_eh' , &amp;<a name='303'></font>
<font color=#447700>!                                         grid%id , 2 , current_date_char )<a name='304'></font>
<a name='305'>
       IF ( grid%dyn_opt .EQ. dyn_nmm ) THEN<a name='306'>
         CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_144"> ( 100 , &amp;<a name='307'>
   'med_sidata_input: calling open_r_dataset for wrf_real_input_nm' )<a name='308'>
	current_date_char(11:11)='_'<a name='309'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2'>construct_filename2</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2_3">( si_inpname , 'wrf_real_input_nm' , &amp;<a name='310'>
                                         grid%id , 2 , current_date_char )<a name='311'>
	current_date_char(11:11)='T'<a name='312'>
	ELSE<a name='313'>
	write(0,*) 'dont know what to do'<a name='314'>
	write(0,*) 'dont know about this dyn_opt'<a name='315'>
	write(0,*) 'grid%dyn_opt= ', grid%dyn_opt<a name='316'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_135">('real: error cant handle this grid%dyn_opt' )<a name='317'>
      END IF<a name='318'>
<a name='319'>
<font color=#447700>!	write(0,*) 'trim(si_inpname):'  TRIM(si_inpname)<a name='320'></font>
<a name='321'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_5"> ( idsi, TRIM(si_inpname) , &amp;<a name='322'>
                              grid , config_flags , "DATASET=INPUT", ierr )<a name='323'>
	write(0,*) 'ierr from open: ', ierr<a name='324'>
<a name='325'>
<font color=#447700>!      IF ( ( ierr .NE. 0 ) .AND. ( grid%dyn_opt .EQ. dyn_em ) ) THEN<a name='326'></font>
<font color=#447700>!        CALL wrf_error_fatal('real: error opening wrf_real_input_em for read' )<a name='327'></font>
<font color=#447700>!      ELSE IF ( ( ierr .NE. 0 ) .AND. ( grid%dyn_opt .EQ. dyn_eh ) ) THEN<a name='328'></font>
<font color=#447700>!        CALL wrf_error_fatal('real: error opening wrf_real_input_eh for read' )<a name='329'></font>
<font color=#447700>!      ENDIF<a name='330'></font>
<a name='331'>
      <font color=#447700>!  Input data.<a name='332'></font>
<a name='333'>
      CALL wrf_debug (100, 'med_sidata_input: call input_aux_model_input1_wrf')<a name='334'>
<a name='335'>
<font color=#447700>!!!<a name='336'></font>
<font color=#447700>!!!	input from netCDF SI output.  Adapt as needed<a name='337'></font>
<font color=#447700>!!!<a name='338'></font>
<a name='339'>
	write(0,*) 'call input_aux_model_input1_wrf'<a name='340'>
<font color=#447700>!	write(0,*) 'ide,ite: ', ide,ite<a name='341'></font>
<font color=#447700>!	write(0,*) 'jde,jte: ', jde,jte<a name='342'></font>
<a name='343'>
<font color=#447700>!===========================================================================<a name='344'></font>
<font color=#447700>!  Dave: All variables are read in from SI<a name='345'></font>
<font color=#447700>!===========================================================================<a name='346'></font>
<a name='347'>
	grid%nmm_islope=1<a name='348'>
<a name='349'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT1'>input_aux_model_input1</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT1_2"> ( idsi ,   grid , config_flags , ierr )<a name='350'>
<a name='351'>
<font color=#447700>!tmp<a name='352'></font>
	grid%vegfra=grid%nmm_vegfrc<a name='353'>
	grid%nmm_dfrlg=grid%nmm_dfl/9.81<a name='354'>
<font color=#447700>!tmp<a name='355'></font>
<a name='356'>
	write(0,*) 'max of grid%nmm_islope: ', maxval(grid%nmm_islope)<a name='357'>
<font color=#447700>!!!<a name='358'></font>
<font color=#447700>!!!<a name='359'></font>
<a name='360'>
      <font color=#447700>!  Possible optional SI input.  This sets flags used by init_domain.<a name='361'></font>
<a name='362'>
<font color=#447700>!!!<a name='363'></font>
<font color=#447700>!!!	anything important input through "optional" SI input?<a name='364'></font>
<font color=#447700>!!!<a name='365'></font>
      IF ( loop .EQ. 1 ) THEN<a name='366'>
  CALL  wrf_debug (100, 'med_sidata_input: call init_module_optional_si_input' )<a name='367'>
         CALL <A href='../../html_code/share/module_optional_si_input.F.html#INIT_MODULE_OPTIONAL_SI_INPUT'>init_module_optional_si_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULE_OPTIONAL_SI_INPUT_2"> ( grid , config_flags )<a name='368'>
      END IF<a name='369'>
      CALL  wrf_debug ( 100 , 'med_sidata_input: calling optional_si_input' )<a name='370'>
<font color=#447700>!<a name='371'></font>
      CALL  <A href='../../html_code/share/module_optional_si_input.F.html#OPTIONAL_SI_INPUT'>optional_si_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_SI_INPUT_2"> ( grid , idsi )<a name='372'>
<font color=#447700>!<a name='373'></font>
	write(0,*) 'num_st_levels_input: ', num_st_levels_input<a name='374'>
<a name='375'>
      <font color=#447700>!  Initialize the mother domain for this time period with input data.<a name='376'></font>
<a name='377'>
      CALL       wrf_debug ( 100 , 'med_sidata_input: calling init_domain' )<a name='378'>
      grid%input_from_file = .true.<a name='379'>
<a name='380'>
<font color=#447700>!!!<a name='381'></font>
<font color=#447700>!!! init_domain will call init_domain_nmm in module_intialize_real.  <a name='382'></font>
<font color=#447700>!!! Fills a bunch of NHB-style (static) variables<a name='383'></font>
<font color=#447700>!!!<a name='384'></font>
<a name='385'>
        CALL <A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_DOMAIN'>init_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_DOMAIN_3"> (  grid )<a name='386'>
<a name='387'>
      CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_29"> ( grid%id, model_config_rec, config_flags )<a name='388'>
<a name='389'>
      <font color=#447700>!  Close this file that is output from the SI and input to this pre-proc.<a name='390'></font>
<a name='391'>
      CALL       <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_145"> ( 100 , 'med_sidata_input: back from init_domain' )<a name='392'>
<a name='393'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_12"> ( idsi , config_flags , "DATASET=INPUT" )<a name='394'>
<a name='395'>
<font color=#447700>!!! not sure about this, but doesnt seem like needs to be called each time<a name='396'></font>
	if (loop .eq. 1) then<a name='397'>
	write(0,*) 'call start_domain'<a name='398'>
        CALL <A href='../../html_code/share/start_domain.F.html#START_DOMAIN'>start_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_DOMAIN_1"> ( grid , .TRUE.)<a name='399'>
	endif<a name='400'>
<a name='401'>
	write(0,*) 'call assemble_output'<a name='402'>
        CALL <A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT'>assemble_output</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ASSEMBLE_OUTPUT_2"> ( grid , config_flags , loop , time_loop_max )<a name='403'>
	write(0,*) 'return assemble_output'<a name='404'>
<a name='405'>
      <font color=#447700>!  Here we define the next time that we are going to process.<a name='406'></font>
<a name='407'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_10"> ( current_date_char , start_date_char , &amp;<a name='408'>
                          loop * model_config_rec%interval_seconds )<a name='409'>
      current_date =  current_date_char // '.0000'<a name='410'>
<a name='411'>
	write(0,*) 'current_date= ', current_date<a name='412'>
<a name='413'>
   END DO<a name='414'>
END SUBROUTINE med_sidata_input<a name='415'>
<a name='416'>
<A NAME='COMPUTE_SI_START_AND_END'><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='417'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>compute_si_start_and_end</font> (  &amp; <A href='../../call_to/COMPUTE_SI_START_AND_END.html' TARGET='index'>2</A>,<A href='../../call_from/COMPUTE_SI_START_AND_END.html' TARGET='index'>5</A><a name='418'>
          start_year, start_month, start_day, start_hour, &amp;<a name='419'>
          start_minute, start_second, &amp;<a name='420'>
          end_year ,   end_month ,   end_day ,   end_hour , &amp;<a name='421'>
          end_minute ,   end_second , &amp;<a name='422'>
          interval_seconds , real_data_init_type , &amp;<a name='423'>
          start_date_char , end_date_char , time_loop_max )<a name='424'>
<a name='425'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_6"><a name='426'>
<a name='427'>
   IMPLICIT NONE<a name='428'>
<a name='429'>
   INTEGER :: start_year , start_month , start_day , &amp;<a name='430'>
              start_hour , start_minute , start_second<a name='431'>
   INTEGER ::   end_year ,   end_month ,   end_day , &amp;<a name='432'>
                end_hour ,   end_minute ,   end_second<a name='433'>
   INTEGER :: interval_seconds , real_data_init_type<a name='434'>
   INTEGER :: time_loop_max , time_loop<a name='435'>
<a name='436'>
   CHARACTER(LEN=19) :: current_date_char , start_date_char , &amp;<a name='437'>
                        end_date_char , next_date_char<a name='438'>
<a name='439'>
<font color=#447700>!   WRITE ( start_date_char , FMT = &amp;<a name='440'></font>
<font color=#447700>!         '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='441'></font>
<font color=#447700>!         start_year,start_month,start_day,start_hour,start_minute,start_second<a name='442'></font>
<font color=#447700>!   WRITE (   end_date_char , FMT = &amp;<a name='443'></font>
<font color=#447700>!         '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='444'></font>
<font color=#447700>!          end_year,  end_month,  end_day,  end_hour,  end_minute,  end_second<a name='445'></font>
<a name='446'>
   WRITE ( start_date_char , FMT = &amp;<a name='447'>
         '(I4.4,"-",I2.2,"-",I2.2,"T",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='448'>
         start_year,start_month,start_day,start_hour,start_minute,start_second<a name='449'>
   WRITE (   end_date_char , FMT = &amp;<a name='450'>
         '(I4.4,"-",I2.2,"-",I2.2,"T",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='451'>
          end_year,  end_month,  end_day,  end_hour,  end_minute,  end_second<a name='452'>
<a name='453'>
<font color=#447700>!  start_date = start_date_char // '.0000'<a name='454'></font>
<a name='455'>
   <font color=#447700>!  Figure out our loop count for the processing times.<a name='456'></font>
<a name='457'>
   time_loop = 1<a name='458'>
   PRINT '(A,I4,A,A,A)','Time period #',time_loop, &amp;<a name='459'>
                        ' to process = ',start_date_char,'.'<a name='460'>
   current_date_char = start_date_char<a name='461'>
   loop_count : DO<a name='462'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_11"> (next_date_char, current_date_char, interval_seconds )<a name='463'>
      IF      ( next_date_char .LT. end_date_char ) THEN<a name='464'>
         time_loop = time_loop + 1<a name='465'>
         PRINT '(A,I4,A,A,A)','Time period #',time_loop,&amp;<a name='466'>
                              ' to process = ',next_date_char,'.'<a name='467'>
         current_date_char = next_date_char<a name='468'>
      ELSE IF ( next_date_char .EQ. end_date_char ) THEN<a name='469'>
         time_loop = time_loop + 1<a name='470'>
         PRINT '(A,I4,A,A,A)','Time period #',time_loop,&amp;<a name='471'>
                              ' to process = ',next_date_char,'.'<a name='472'>
         PRINT '(A,I4,A)','Total analysis times to input = ',time_loop,'.'<a name='473'>
         time_loop_max = time_loop<a name='474'>
         EXIT loop_count<a name='475'>
      ELSE IF ( next_date_char .GT. end_date_char ) THEN<a name='476'>
         PRINT '(A,I4,A)','Total analysis times to input = ',time_loop,'.'<a name='477'>
         time_loop_max = time_loop<a name='478'>
         EXIT loop_count<a name='479'>
      END IF<a name='480'>
   END DO loop_count<a name='481'>
	write(0,*) 'done in si_start_and_end'<a name='482'>
END SUBROUTINE compute_si_start_and_end<a name='483'>
<a name='484'>
<A NAME='ASSEMBLE_OUTPUT'><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='485'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>assemble_output</font> ( grid , config_flags , loop , time_loop_max ) <A href='../../call_to/ASSEMBLE_OUTPUT.html' TARGET='index'>2</A>,<A href='../../call_from/ASSEMBLE_OUTPUT.html' TARGET='index'>98</A><a name='486'>
<a name='487'>
<font color=#447700>!!! replace with something?   USE module_big_step_utilities_em<a name='488'></font>
<a name='489'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_97"><a name='490'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_16"><a name='491'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_103"><a name='492'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_7"><a name='493'>
   USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_29"><a name='494'>
   IMPLICIT NONE<a name='495'>
<a name='496'>
   TYPE(domain)                 :: grid<a name='497'>
   TYPE (grid_config_rec_type)  :: config_flags<a name='498'>
   INTEGER , INTENT(IN)         :: loop , time_loop_max<a name='499'>
<a name='500'>
   INTEGER :: ids , ide , jds , jde , kds , kde<a name='501'>
   INTEGER :: ims , ime , jms , jme , kms , kme<a name='502'>
   INTEGER :: ips , ipe , jps , jpe , kps , kpe<a name='503'>
   INTEGER :: ijds , ijde , spec_bdy_width<a name='504'>
   INTEGER :: inc_h,inc_v<a name='505'>
   INTEGER :: i , j , k , idts<a name='506'>
<a name='507'>
   INTEGER :: id1 , interval_seconds , ierr, rc<a name='508'>
   INTEGER , SAVE :: id <a name='509'>
   CHARACTER (LEN=80) :: inpname , bdyname<a name='510'>
   CHARACTER(LEN= 4) :: loop_char<a name='511'>
character *19 :: temp19<a name='512'>
character *24 :: temp24 , temp24b<a name='513'>
<a name='514'>
   REAL, DIMENSION(:,:,:), ALLOCATABLE, SAVE :: ubdy3dtemp1 , vbdy3dtemp1 ,&amp;<a name='515'>
                                                tbdy3dtemp1 , &amp;<a name='516'>
				                cwmbdy3dtemp1 , qbdy3dtemp1,&amp;<a name='517'>
                                                q2bdy3dtemp1 , pdbdy2dtemp1<a name='518'>
   REAL, DIMENSION(:,:,:), ALLOCATABLE, SAVE :: ubdy3dtemp2 , vbdy3dtemp2 , &amp;<a name='519'>
                                                tbdy3dtemp2 , &amp; <a name='520'>
                                                cwmbdy3dtemp2 , qbdy3dtemp2, &amp;<a name='521'>
                                                q2bdy3dtemp2, pdbdy2dtemp2<a name='522'>
   REAL :: t1,t2<a name='523'>
<a name='524'>
#ifdef DEREF_KLUDGE<a name='525'>
<font color=#447700>!  see http://www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='526'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='527'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='528'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='529'>
#endif<a name='530'>
<a name='531'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_3"><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='532'>
<a name='533'>
<a name='534'>
   <font color=#447700>!  Various sizes that we need to be concerned about.<a name='535'></font>
<a name='536'>
   ids = grid%sd31<a name='537'>
   ide = grid%ed31-1 <font color=#447700>! 030730tst<a name='538'></font>
   kds = grid%sd32<a name='539'>
   kde = grid%ed32-1 <font color=#447700>! 030730tst<a name='540'></font>
   jds = grid%sd33<a name='541'>
   jde = grid%ed33-1 <font color=#447700>! 030730tst<a name='542'></font>
<a name='543'>
   ims = grid%sm31<a name='544'>
   ime = grid%em31<a name='545'>
   kms = grid%sm32<a name='546'>
   kme = grid%em32<a name='547'>
   jms = grid%sm33<a name='548'>
   jme = grid%em33<a name='549'>
<a name='550'>
   ips = grid%sp31<a name='551'>
   ipe = grid%ep31-1 <font color=#447700>! 030730tst<a name='552'></font>
   kps = grid%sp32<a name='553'>
   kpe = grid%ep32-1 <font color=#447700>! 030730tst<a name='554'></font>
   jps = grid%sp33<a name='555'>
   jpe = grid%ep33-1 <font color=#447700>! 030730tst<a name='556'></font>
<a name='557'>
<font color=#447700>!!!!!!! believe IPE and JPE should be larger if they aren't on the global<a name='558'></font>
<font color=#447700>!!!!!!! boundary<a name='559'></font>
<a name='560'>
        if (IPE .ne. IDE) IPE=IPE+1<a name='561'>
        if (JPE .ne. JDE) JPE=JPE+1<a name='562'>
<a name='563'>
	write(0,*) 'assemble output (ids,ide): ', ids,ide<a name='564'>
	write(0,*) 'assemble output (ims,ime): ', ims,ime<a name='565'>
	write(0,*) 'assemble output (ips,ipe): ', ips,ipe<a name='566'>
<a name='567'>
	write(0,*) 'assemble output (jds,jde): ', jds,jde<a name='568'>
	write(0,*) 'assemble output (jms,jme): ', jms,jme<a name='569'>
	write(0,*) 'assemble output (jps,jpe): ', jps,jpe<a name='570'>
<a name='571'>
	write(0,*) 'assemble output (kds,kde): ', kds,kde<a name='572'>
	write(0,*) 'assemble output (kms,kme): ', kms,kme<a name='573'>
	write(0,*) 'assemble output (kps,kpe): ', kps,kpe<a name='574'>
<a name='575'>
   ijds = MIN ( ids , jds )<a name='576'>
<font color=#447700>!mptest030805   ijde = MAX ( ide , jde )<a name='577'></font>
   ijde = MAX ( ide , jde ) + 1   <font color=#447700>! to make stuff_bdy dimensions consistent with alloc<a name='578'></font>
<a name='579'>
   <font color=#447700>!  Boundary width, scalar value.<a name='580'></font>
<a name='581'>
   spec_bdy_width = model_config_rec%spec_bdy_width<a name='582'>
   interval_seconds = model_config_rec%interval_seconds<a name='583'>
<a name='584'>
      write(0,*)' in assemble_ouput loop=',loop<a name='585'>
<font color=#447700>!-----------------------------------------------------------------------<a name='586'></font>
<font color=#447700>!<a name='587'></font>
   main_loop_test: IF ( loop .EQ. 1 ) THEN<a name='588'>
<font color=#447700>!<a name='589'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='590'></font>
<a name='591'>
   <font color=#447700>!  This is the space needed to save the current 3d data for use in computing<a name='592'></font>
   <font color=#447700>!  the lateral boundary tendencies.<a name='593'></font>
<a name='594'>
	write(0,*) 'allocating 3d arrays passed into stuff_bdy with vert lims: ', &amp;<a name='595'>
                  kms, kme<a name='596'>
      ALLOCATE ( ubdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='597'>
      ALLOCATE ( vbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='598'>
      ALLOCATE ( tbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='599'>
      ALLOCATE ( qbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='600'>
      ALLOCATE ( cwmbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='601'>
      ALLOCATE ( q2bdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='602'>
      ALLOCATE ( pdbdy2dtemp1(ims:ime,  1:1  ,jms:jme) )<a name='603'>
<a name='604'>
	ubdy3dtemp1=0.<a name='605'>
	vbdy3dtemp1=0.<a name='606'>
	tbdy3dtemp1=0.<a name='607'>
	qbdy3dtemp1=0.<a name='608'>
	cwmbdy3dtemp1=0.<a name='609'>
	q2bdy3dtemp1=0.<a name='610'>
	pdbdy2dtemp1=0.<a name='611'>
<a name='612'>
      ALLOCATE ( ubdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='613'>
      ALLOCATE ( vbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='614'>
      ALLOCATE ( tbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='615'>
      ALLOCATE ( qbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='616'>
      ALLOCATE ( cwmbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='617'>
      ALLOCATE ( q2bdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='618'>
      ALLOCATE ( pdbdy2dtemp2(ims:ime,  1:1  ,jms:jme) )<a name='619'>
<a name='620'>
	ubdy3dtemp2=0.<a name='621'>
	vbdy3dtemp2=0.<a name='622'>
	tbdy3dtemp2=0.<a name='623'>
	qbdy3dtemp2=0.<a name='624'>
	cwmbdy3dtemp2=0.<a name='625'>
	q2bdy3dtemp2=0.<a name='626'>
	pdbdy2dtemp2=0.<a name='627'>
<a name='628'>
      <font color=#447700>!  Open the wrfinput file.  From this program, this is an *output* file.<a name='629'></font>
<a name='630'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_10">( inpname , 'wrfinput' , grid%id , 2 )<a name='631'>
<a name='632'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_10"> ( id1, TRIM(inpname) , grid , config_flags , &amp;<a name='633'>
                            output_model_input , "DATASET=INPUT", ierr )<a name='634'>
<a name='635'>
      IF ( ierr .NE. 0 ) THEN<a name='636'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_136">( 'real: error opening wrfinput for writing' )<a name='637'>
      ENDIF<a name='638'>
<a name='639'>
<font color=#447700>!     CALL calc_current_date ( grid%id , 0. )<a name='640'></font>
<font color=#447700>!      grid%write_metadata = .true.<a name='641'></font>
<a name='642'>
	write(0,*) 'making call to output_model_input'<a name='643'>
<a name='644'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_MODEL_INPUT'>output_model_input</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_MODEL_INPUT_5"> ( id1, grid , config_flags , ierr )<a name='645'>
	write(0,*) 'ierr from output_model_input: ', ierr<a name='646'>
<a name='647'>
<font color=#447700>!***<a name='648'></font>
<font color=#447700>!***  CLOSE THE WRFINPUT DATASET<a name='649'></font>
<font color=#447700>!***<a name='650'></font>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_13"> ( id1 , config_flags , "DATASET=INPUT" )<a name='651'>
<a name='652'>
      <font color=#447700>!  We need to save the 3d data to compute a <a name='653'></font>
      <font color=#447700>!  difference during the next loop. <a name='654'></font>
<a name='655'>
   write(0,*) 'I,J,K lims: ', MIN(ide,ipe), MIN(jde,jpe), MIN(kde,kpe)<a name='656'>
<font color=#447700>!<a name='657'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='658'></font>
<font color=#447700>!***  SOUTHERN BOUNDARY<a name='659'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='660'></font>
<font color=#447700>!<a name='661'></font>
<a name='662'>
        IF(JPS==JDS)THEN<a name='663'>
          J=1<a name='664'>
          DO k = kps , MIN(kde,kpe)<a name='665'>
          DO i = ips , MIN(ide,ipe)<a name='666'>
            ubdy3dtemp1(i,k,j) = grid%nmm_u(i,k,j)<a name='667'>
            vbdy3dtemp1(i,k,j) = grid%nmm_v(i,k,j)<a name='668'>
            tbdy3dtemp1(i,k,j) = grid%nmm_t(i,k,j)<a name='669'>
            qbdy3dtemp1(i,k,j) = grid%nmm_q(i,k,j)<a name='670'>
            cwmbdy3dtemp1(i,k,j) = grid%nmm_cwm(i,k,j)<a name='671'>
            q2bdy3dtemp1(i,k,j) = grid%nmm_q2(i,k,j)<a name='672'>
          END DO<a name='673'>
          END DO<a name='674'>
<a name='675'>
          DO i = ips , MIN(ide,ipe)<a name='676'>
            pdbdy2dtemp1(i,1,j) = grid%nmm_pd(i,j)<a name='677'>
          END DO<a name='678'>
        ENDIF<a name='679'>
<a name='680'>
<font color=#447700>!<a name='681'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='682'></font>
<font color=#447700>!***  NORTHERN BOUNDARY<a name='683'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='684'></font>
<font color=#447700>!<a name='685'></font>
        IF(JPE==JDE)THEN<a name='686'>
          J=MIN(JDE,JPE)<a name='687'>
          DO k = kps , MIN(kde,kpe)<a name='688'>
          DO i = ips , MIN(ide,ipe)<a name='689'>
            ubdy3dtemp1(i,k,j) = grid%nmm_u(i,k,j)<a name='690'>
            vbdy3dtemp1(i,k,j) = grid%nmm_v(i,k,j)<a name='691'>
            tbdy3dtemp1(i,k,j) = grid%nmm_t(i,k,j)<a name='692'>
            qbdy3dtemp1(i,k,j) = grid%nmm_q(i,k,j)<a name='693'>
            cwmbdy3dtemp1(i,k,j) = grid%nmm_cwm(i,k,j)<a name='694'>
            q2bdy3dtemp1(i,k,j) = grid%nmm_q2(i,k,j)<a name='695'>
          END DO<a name='696'>
          END DO<a name='697'>
<a name='698'>
          DO i = ips , MIN(ide,ipe)<a name='699'>
            pdbdy2dtemp1(i,1,j) = grid%nmm_pd(i,j)<a name='700'>
          END DO<a name='701'>
        ENDIF<a name='702'>
<a name='703'>
<font color=#447700>!<a name='704'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='705'></font>
<font color=#447700>!***  WESTERN BOUNDARY<a name='706'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='707'></font>
<font color=#447700>!<a name='708'></font>
	write(0,*) 'western boundary, store winds over J: ', jps, min(jpe,jde)<a name='709'>
        IF(IPS==IDS)THEN<a name='710'>
          I=1<a name='711'>
          DO k = kps , MIN(kde,kpe)<a name='712'>
          inc_h=mod(jps+1,2)<a name='713'>
          DO j = jps+inc_h, min(jde,jpe),2<a name='714'>
<a name='715'>
        if (J .ge. 3 .and. J .le. JDE-2 .and. mod(J,2) .eq. 1) then<a name='716'>
            tbdy3dtemp1(i,k,j) = grid%nmm_t(i,k,j)<a name='717'>
            qbdy3dtemp1(i,k,j) = grid%nmm_q(i,k,j)<a name='718'>
            cwmbdy3dtemp1(i,k,j) = grid%nmm_cwm(i,k,j)<a name='719'>
            q2bdy3dtemp1(i,k,j) = grid%nmm_q2(i,k,j)<a name='720'>
      if(k==1)then<a name='721'>
        write(0,*)' loop=',loop,' i=',i,' j=',j,' tbdy3dtemp1(i,k,j)=',tbdy3dtemp1(i,k,j)<a name='722'>
      endif<a name='723'>
	endif<a name='724'>
          END DO<a name='725'>
          END DO<a name='726'>
<a name='727'>
          DO k = kps , MIN(kde,kpe)<a name='728'>
          inc_v=mod(jps,2)<a name='729'>
          DO j = jps+inc_v, min(jde,jpe),2<a name='730'>
        if (J .ge. 2 .and. J .le. JDE-1 .and. mod(J,2) .eq. 0) then<a name='731'>
            ubdy3dtemp1(i,k,j) = grid%nmm_u(i,k,j)<a name='732'>
            vbdy3dtemp1(i,k,j) = grid%nmm_v(i,k,j)<a name='733'>
	endif<a name='734'>
          END DO<a name='735'>
          END DO<a name='736'>
<font color=#447700>!<a name='737'></font>
          inc_h=mod(jps+1,2)<a name='738'>
        DO j = jps+inc_h, min(jde,jpe),2<a name='739'>
        if (J .ge. 3 .and. J .le. JDE-2 .and. mod(J,2) .eq. 1) then<a name='740'>
            pdbdy2dtemp1(i,1,j) = grid%nmm_pd(i,j)<a name='741'>
      write(0,*)' loop=',loop,' i=',i,' j=',j,' pdbdy2dtemp1(i,1,j)=',pdbdy2dtemp1(i,1,j)<a name='742'>
	endif<a name='743'>
          END DO<a name='744'>
        ENDIF<a name='745'>
<font color=#447700>!<a name='746'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='747'></font>
<font color=#447700>!***  EASTERN BOUNDARY<a name='748'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='749'></font>
<font color=#447700>!<a name='750'></font>
        IF(IPE==IDE)THEN<a name='751'>
          I=MIN(IDE,IPE)<a name='752'>
<font color=#447700>!<a name='753'></font>
          DO k = kps , MIN(kde,kpe)<a name='754'>
<font color=#447700>!<a name='755'></font>
<font color=#447700>!***   Make sure the J loop is on the global boundary<a name='756'></font>
<font color=#447700>!<a name='757'></font>
          inc_h=mod(jps+1,2)<a name='758'>
          DO j = jps+inc_h, min(jde,jpe),2<a name='759'>
        if (J .ge. 3 .and. J .le. JDE-2 .and. mod(J,2) .eq. 1) then<a name='760'>
            tbdy3dtemp1(i,k,j) = grid%nmm_t(i,k,j)<a name='761'>
            qbdy3dtemp1(i,k,j) = grid%nmm_q(i,k,j)<a name='762'>
            cwmbdy3dtemp1(i,k,j) = grid%nmm_cwm(i,k,j)<a name='763'>
            q2bdy3dtemp1(i,k,j) = grid%nmm_q2(i,k,j)<a name='764'>
	endif<a name='765'>
          END DO<a name='766'>
          END DO<a name='767'>
<a name='768'>
          DO k = kps , MIN(kde,kpe)<a name='769'>
          inc_v=mod(jps,2)<a name='770'>
          DO j = jps+inc_v, min(jde,jpe),2<a name='771'>
        if (J .ge. 2 .and. J .le. JDE-1 .and. mod(J,2) .eq. 0) then<a name='772'>
            ubdy3dtemp1(i,k,j) = grid%nmm_u(i,k,j)<a name='773'>
            vbdy3dtemp1(i,k,j) = grid%nmm_v(i,k,j)<a name='774'>
        endif<a name='775'>
          END DO<a name='776'>
          END DO<a name='777'>
<font color=#447700>!<a name='778'></font>
          inc_h=mod(jps+1,2)<a name='779'>
          DO j = jps+inc_h, min(jde,jpe),2<a name='780'>
        if (J .ge. 3 .and. J .le. JDE-2 .and. mod(J,2) .eq. 1) then<a name='781'>
            pdbdy2dtemp1(i,1,j) = grid%nmm_pd(i,j)<a name='782'>
	endif<a name='783'>
          END DO<a name='784'>
        ENDIF<a name='785'>
<a name='786'>
<a name='787'>
      <font color=#447700>!  There are 2 components to the lateral boundaries.  <a name='788'></font>
      <font color=#447700>!  First, there is the starting<a name='789'></font>
      <font color=#447700>!  point of this time period - just the outer few rows and columns.<a name='790'></font>
<a name='791'>
<a name='792'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_25"> (ubdy3dtemp1, grid%nmm_u_b, 'N', ijds, ijde, spec_bdy_width  , &amp;<a name='793'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='794'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='795'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='796'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_26"> ( vbdy3dtemp1, grid%nmm_v_b, 'N', ijds, ijde, spec_bdy_width, &amp;<a name='797'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='798'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='799'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='800'>
	write(0,*) 'size (dim 1) nmm_t_b: ', size(grid%nmm_t_b, dim=1)<a name='801'>
	write(0,*) 'size (dim 2) nmm_t_b: ', size(grid%nmm_t_b, dim=2)<a name='802'>
	write(0,*) 'size (dim 3) nmm_t_b: ', size(grid%nmm_t_b, dim=3)<a name='803'>
	write(0,*) 'size (dim 4) nmm_t_b: ', size(grid%nmm_t_b, dim=4)<a name='804'>
<a name='805'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_27"> ( tbdy3dtemp1, grid%nmm_t_b, 'N', ijds, ijde, spec_bdy_width, &amp;<a name='806'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='807'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='808'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='809'>
<a name='810'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_28"> ( cwmbdy3dtemp1,grid%nmm_cwm_b,'N',ijds,ijde, spec_bdy_width, &amp;<a name='811'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='812'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='813'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='814'>
<a name='815'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_29"> ( qbdy3dtemp1, grid%nmm_q_b, 'N', ijds, ijde, spec_bdy_width, &amp;<a name='816'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='817'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='818'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='819'>
<a name='820'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_30"> ( q2bdy3dtemp1,grid%nmm_q2_b,'N', ijds, ijde, spec_bdy_width, &amp;<a name='821'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='822'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='823'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='824'>
<a name='825'>
	write(0,*) 'stuff_bdy lims for pdbdy I: ', ids, ide+1<a name='826'>
	write(0,*) 'stuff_bdy lims for pdbdy J: ', jds, jde+1<a name='827'>
<a name='828'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_31"> ( pdbdy2dtemp1,grid%nmm_pd_b,'M', ijds,ijde, spec_bdy_width, &amp;<a name='829'>
                                        ids , ide+1 , jds , jde+1 , 1 , 1 , &amp;<a name='830'>
                                        ims , ime , jms , jme , 1 , 1 , &amp;<a name='831'>
                                        ips , ipe , jps , jpe , 1 , 1 )<a name='832'>
<a name='833'>
<font color=#447700>!-----------------------------------------------------------------------<a name='834'></font>
<font color=#447700>!<a name='835'></font>
   ELSE IF ( loop .GT. 1 ) THEN<a name='836'>
<font color=#447700>!<a name='837'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='838'></font>
<a name='839'>
      write(0,*)' assemble_ouput loop=',loop,' in IF block'<a name='840'>
      <font color=#447700>!  Open the boundary file.<a name='841'></font>
<a name='842'>
      IF ( loop .eq. 2 ) THEN<a name='843'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_11">( bdyname , 'wrfbdy' , grid%id , 2 )<a name='844'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_11"> ( id, TRIM(bdyname) , grid , config_flags , &amp;<a name='845'>
                          output_boundary , "DATASET=BOUNDARY", ierr )<a name='846'>
         IF ( ierr .NE. 0 ) THEN<a name='847'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_137">( 'real: error opening wrfbdy for writing' )<a name='848'>
         ENDIF<a name='849'>
<font color=#447700>!         grid%write_metadata = .true.<a name='850'></font>
      ELSE<a name='851'>
<font color=#447700>! what's this do?<a name='852'></font>
<font color=#447700>!         grid%write_metadata = .true.<a name='853'></font>
<font color=#447700>!         grid%write_metadata = .false.<a name='854'></font>
         CALL ESMF_ClockAdvance( grid%domain_clock, rc=rc )<a name='855'>
      END IF<a name='856'>
<a name='857'>
      write(0,*)' assemble_ouput loop=',loop,' point 2'<a name='858'>
<a name='859'>
<font color=#447700>!<a name='860'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='861'></font>
<font color=#447700>!***  SOUTHERN BOUNDARY<a name='862'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='863'></font>
<font color=#447700>!<a name='864'></font>
        IF(JPS==JDS)THEN<a name='865'>
          J=1<a name='866'>
          DO k = kps , MIN(kde,kpe)<a name='867'>
          DO i = ips , MIN(ide,ipe)<a name='868'>
            ubdy3dtemp2(i,k,j) = grid%nmm_u(i,k,j)<a name='869'>
            vbdy3dtemp2(i,k,j) = grid%nmm_v(i,k,j)<a name='870'>
            tbdy3dtemp2(i,k,j) = grid%nmm_t(i,k,j)<a name='871'>
            qbdy3dtemp2(i,k,j) = grid%nmm_q(i,k,j)<a name='872'>
            cwmbdy3dtemp2(i,k,j) = grid%nmm_cwm(i,k,j)<a name='873'>
            q2bdy3dtemp2(i,k,j) = grid%nmm_q2(i,k,j)<a name='874'>
          END DO<a name='875'>
          END DO<a name='876'>
<font color=#447700>!<a name='877'></font>
          DO i = ips , MIN(ide,ipe)<a name='878'>
            pdbdy2dtemp2(i,1,j) = grid%nmm_pd(i,j)<a name='879'>
          END DO<a name='880'>
        ENDIF<a name='881'>
<a name='882'>
<font color=#447700>!<a name='883'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='884'></font>
<font color=#447700>!***  NORTHERN BOUNDARY<a name='885'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='886'></font>
<font color=#447700>!<a name='887'></font>
        IF(JPE==JDE)THEN<a name='888'>
          J=MIN(JDE,JPE)<a name='889'>
          DO k = kps , MIN(kde,kpe)<a name='890'>
          DO i = ips , MIN(ide,ipe)<a name='891'>
            ubdy3dtemp2(i,k,j) = grid%nmm_u(i,k,j)<a name='892'>
            vbdy3dtemp2(i,k,j) = grid%nmm_v(i,k,j)<a name='893'>
            tbdy3dtemp2(i,k,j) = grid%nmm_t(i,k,j)<a name='894'>
            qbdy3dtemp2(i,k,j) = grid%nmm_q(i,k,j)<a name='895'>
            cwmbdy3dtemp2(i,k,j) = grid%nmm_cwm(i,k,j)<a name='896'>
            q2bdy3dtemp2(i,k,j) = grid%nmm_q2(i,k,j)<a name='897'>
          END DO<a name='898'>
          END DO<a name='899'>
<a name='900'>
          DO i = ips , MIN(ide,ipe)<a name='901'>
            pdbdy2dtemp2(i,1,j) = grid%nmm_pd(i,j)<a name='902'>
          END DO<a name='903'>
        ENDIF<a name='904'>
<font color=#447700>!<a name='905'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='906'></font>
<font color=#447700>!***  WESTERN BOUNDARY<a name='907'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='908'></font>
<font color=#447700>!<a name='909'></font>
      write(0,*)' assemble_ouput loop=',loop,' point 3 ips=',ips,' ids=',ids<a name='910'>
        IF(IPS==IDS)THEN<a name='911'>
          I=1<a name='912'>
          DO k = kps , MIN(kde,kpe)<a name='913'>
          inc_h=mod(jps+1,2)<a name='914'>
      if(k==1)then<a name='915'>
        write(0,*)' assemble_ouput loop=',loop,' inc_h=',inc_h,' jps=',jps<a name='916'>
      endif<a name='917'>
          DO j = jps+inc_h, MIN(jde,jpe),2<a name='918'>
        if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='919'>
            tbdy3dtemp2(i,k,j) = grid%nmm_t(i,k,j)<a name='920'>
      if(k==1)then<a name='921'>
        write(0,*)' loop=',loop,' i=',i,' j=',j,' tbdy3dtemp1(i,k,j)=',tbdy3dtemp1(i,k,j)<a name='922'>
      endif<a name='923'>
            qbdy3dtemp2(i,k,j) = grid%nmm_q(i,k,j)<a name='924'>
            cwmbdy3dtemp2(i,k,j) = grid%nmm_cwm(i,k,j)<a name='925'>
            q2bdy3dtemp2(i,k,j) = grid%nmm_q2(i,k,j)<a name='926'>
	endif<a name='927'>
          END DO<a name='928'>
          END DO<a name='929'>
<font color=#447700>!<a name='930'></font>
          DO k = kps , MIN(kde,kpe)<a name='931'>
          inc_v=mod(jps,2)<a name='932'>
          DO j = jps+inc_v, MIN(jde,jpe),2<a name='933'>
        if (J .ge. 2 .and. J .le. jde-1 .and. mod(J,2) .eq. 0) then<a name='934'>
            ubdy3dtemp2(i,k,j) = grid%nmm_u(i,k,j)<a name='935'>
            vbdy3dtemp2(i,k,j) = grid%nmm_v(i,k,j)<a name='936'>
	endif<a name='937'>
          END DO<a name='938'>
          END DO<a name='939'>
<a name='940'>
	write(0,*) 'western boundary pdbdy J lims: ',  jps, min(jde,jpe)<a name='941'>
          inc_h=mod(jps+1,2)<a name='942'>
        DO j = jps+inc_h, MIN(jde,jpe),2<a name='943'>
        if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='944'>
            pdbdy2dtemp2(i,1,j) = grid%nmm_pd(i,j)<a name='945'>
      write(0,*)' loop=',loop,' i=',i,' j=',j,' pdbdy2dtemp1(i,1,j)=',pdbdy2dtemp1(i,1,j)<a name='946'>
	endif<a name='947'>
          END DO<a name='948'>
        ENDIF<a name='949'>
<font color=#447700>!<a name='950'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='951'></font>
<font color=#447700>!***  EASTERN BOUNDARY<a name='952'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='953'></font>
<font color=#447700>!<a name='954'></font>
        IF(IPE==IDE)THEN<a name='955'>
          I=MIN(IDE,IPE)<a name='956'>
<a name='957'>
          DO k = kps , MIN(kde,kpe)<a name='958'>
          inc_h=mod(jps+1,2)<a name='959'>
          DO j = jps+inc_h, MIN(jde,jpe),2<a name='960'>
        if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='961'>
            tbdy3dtemp2(i,k,j) = grid%nmm_t(i,k,j)<a name='962'>
            qbdy3dtemp2(i,k,j) = grid%nmm_q(i,k,j)<a name='963'>
            cwmbdy3dtemp2(i,k,j) = grid%nmm_cwm(i,k,j)<a name='964'>
            q2bdy3dtemp2(i,k,j) = grid%nmm_q2(i,k,j)<a name='965'>
	endif<a name='966'>
          END DO<a name='967'>
          END DO<a name='968'>
<a name='969'>
          DO k = kps , MIN(kde,kpe)<a name='970'>
          inc_v=mod(jps,2)<a name='971'>
          DO j = jps+inc_v, MIN(jde,jpe),2<a name='972'>
        if (J .ge. 2 .and. J .le. jde-1 .and. mod(J,2) .eq. 0) then<a name='973'>
            ubdy3dtemp2(i,k,j) = grid%nmm_u(i,k,j)<a name='974'>
            vbdy3dtemp2(i,k,j) = grid%nmm_v(i,k,j)<a name='975'>
	endif<a name='976'>
          END DO<a name='977'>
          END DO<a name='978'>
<a name='979'>
          inc_h=mod(jps+1,2)<a name='980'>
          DO j = jps+inc_h, MIN(jde,jpe),2<a name='981'>
        if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='982'>
            pdbdy2dtemp2(i,1,j) = grid%nmm_pd(i,j)<a name='983'>
	endif<a name='984'>
          END DO<a name='985'>
        ENDIF<a name='986'>
<font color=#447700>!-----------------------------------------------------------------------<a name='987'></font>
      <font color=#447700>!  During all of the loops after the first loop, <a name='988'></font>
      <font color=#447700>!  we first compute the boundary<a name='989'></font>
      <font color=#447700>!  tendencies with the current data values <a name='990'></font>
      <font color=#447700>!  (*bdy3dtemp2 arrays) and the previously <a name='991'></font>
      <font color=#447700>!  saved information stored in the *bdy3dtemp1 arrays.<a name='992'></font>
<a name='993'>
<a name='994'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_19"> ( ubdy3dtemp2 , ubdy3dtemp1 , REAL(interval_seconds),&amp;<a name='995'>
                                   grid%nmm_u_bt  , 'N' , &amp;<a name='996'>
                                   ijds , ijde , spec_bdy_width      , &amp;<a name='997'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='998'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='999'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1000'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_20"> ( vbdy3dtemp2 , vbdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1001'>
                                    grid%nmm_v_bt  , 'N' , &amp;<a name='1002'>
                                   ijds , ijde , spec_bdy_width      , &amp;<a name='1003'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1004'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1005'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1006'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_21"> ( tbdy3dtemp2 , tbdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1007'>
                                   grid%nmm_t_bt  , 'N' , &amp;<a name='1008'>
                                   ijds , ijde , spec_bdy_width      , &amp;<a name='1009'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1010'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1011'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1012'>
<a name='1013'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_22"> ( cwmbdy3dtemp2,cwmbdy3dtemp1,REAL(interval_seconds),&amp;<a name='1014'>
                                   grid%nmm_cwm_bt  , 'N' , &amp;<a name='1015'>
                                   ijds , ijde , spec_bdy_width      , &amp;<a name='1016'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1017'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1018'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1019'>
<a name='1020'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_23"> ( qbdy3dtemp2 , qbdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1021'>
                                   grid%nmm_q_bt , 'N' , &amp;<a name='1022'>
                                   ijds , ijde , spec_bdy_width      , &amp;<a name='1023'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1024'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1025'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1026'>
<a name='1027'>
    CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_24"> ( q2bdy3dtemp2, q2bdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1028'>
                                   grid%nmm_q2_bt , 'N' , &amp;<a name='1029'>
                                   ijds , ijde , spec_bdy_width      , &amp;<a name='1030'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1031'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1032'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1033'>
<a name='1034'>
       if(jps==jds.and.ips==ids) write(0,*) 'pdbdy2dtemp2(1,1,1): ', pdbdy2dtemp2(1,1,1)<a name='1035'>
<a name='1036'>
	write(0,*) 'stuff_bdytend lims for pdbdy I: ', ids, ide+1<a name='1037'>
	write(0,*) 'stuff_bdytend lims for pdbdy J: ', jds, jde+1<a name='1038'>
<a name='1039'>
    CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_25">( pdbdy2dtemp2 , pdbdy2dtemp1, REAL(interval_seconds),&amp;<a name='1040'>
                                   grid%nmm_pd_bt  , 'M' , &amp;<a name='1041'>
                                   ijds , ijde , spec_bdy_width      , &amp;<a name='1042'>
                                   ids , ide+1 , jds , jde+1 , 1 , 1 , &amp;<a name='1043'>
                                   ims , ime , jms , jme , 1 , 1 , &amp;<a name='1044'>
                                   ips , ipe , jps , jpe , 1 , 1 )<a name='1045'>
<a name='1046'>
       write(0,*) 'grid%nmm_pd_bt(1,1): ', grid%nmm_pd_bt(1,1,1,1)<a name='1047'>
<a name='1048'>
      <font color=#447700>!  Both pieces of the boundary data are now <a name='1049'></font>
      <font color=#447700>!  available to be written (initial time and tendency).<a name='1050'></font>
      <font color=#447700>!  This looks ugly, these date shifting things.  <a name='1051'></font>
      <font color=#447700>!  What's it for?  We want the "Times" variable<a name='1052'></font>
      <font color=#447700>!  in the lateral BDY file to have the valid times <a name='1053'></font>
      <font color=#447700>!  of when the initial fields are written.<a name='1054'></font>
      <font color=#447700>!  That's what the loop-2 thingy is for with the start date.  <a name='1055'></font>
      <font color=#447700>!  We increment the start_date so<a name='1056'></font>
      <font color=#447700>!  that the starting time in the attributes is the <a name='1057'></font>
      <font color=#447700>!  second time period.  Why you may ask.  I<a name='1058'></font>
      <font color=#447700>!  agree, why indeed.<a name='1059'></font>
<a name='1060'>
      temp24= current_date<a name='1061'>
      temp24b=start_date<a name='1062'>
      start_date = current_date<a name='1063'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_12"> ( temp19 , temp24b(1:19) , &amp;<a name='1064'>
                         (loop-2) * model_config_rec%interval_seconds )<a name='1065'>
      current_date = temp19 //  '.0000'<a name='1066'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_BOUNDARY'>output_boundary</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_BOUNDARY_6"> ( id, grid , config_flags , ierr )<a name='1067'>
      current_date = temp24<a name='1068'>
      start_date = temp24b<a name='1069'>
<a name='1070'>
      <font color=#447700>!  OK, for all of the loops, we output the initialzation <a name='1071'></font>
      <font color=#447700>!  data, which would allow us to<a name='1072'></font>
      <font color=#447700>!  start the model at any of the available analysis time periods.<a name='1073'></font>
<a name='1074'>
<font color=#447700>!  WRITE ( loop_char , FMT = '(I4.4)' ) loop<a name='1075'></font>
<font color=#447700>!  CALL open_w_dataset ( id1, 'wrfinput'//loop_char , grid , config_flags , output_model_input , "DATASET=INPUT", ierr )<a name='1076'></font>
<font color=#447700>!  IF ( ierr .NE. 0 ) THEN<a name='1077'></font>
<font color=#447700>!    CALL wrf_error_fatal( 'real: error opening wrfinput'//loop_char//' for writing' )<a name='1078'></font>
<font color=#447700>!  ENDIF<a name='1079'></font>
<font color=#447700>!  grid%write_metadata = .true.<a name='1080'></font>
<a name='1081'>
<font color=#447700>!  CALL calc_current_date ( grid%id , 0. )<a name='1082'></font>
<font color=#447700>!  CALL output_model_input ( id1, grid , config_flags , ierr )<a name='1083'></font>
<font color=#447700>!  CALL close_dataset ( id1 , config_flags , "DATASET=INPUT" )<a name='1084'></font>
<a name='1085'>
  <font color=#447700>!  Is this or is this not the last time time?  We can remove some unnecessary<a name='1086'></font>
  <font color=#447700>!  stores if it is not.<a name='1087'></font>
<a name='1088'>
      IF     ( loop .LT. time_loop_max ) THEN<a name='1089'>
<a name='1090'>
         <font color=#447700>!  We need to save the 3d data to compute a <a name='1091'></font>
         <font color=#447700>!  difference during the next loop.  Couple the<a name='1092'></font>
         <font color=#447700>!  3d fields with total mu (mub + mu_2) and the <a name='1093'></font>
         <font color=#447700>!  stagger-specific map scale factor.<a name='1094'></font>
         <font color=#447700>!  We load up the boundary data again for use in the next loop.<a name='1095'></font>
<a name='1096'>
<a name='1097'>
<font color=#447700>!mp	change these limits?????????<a name='1098'></font>
<a name='1099'>
	write(0,*) 'limits at end: ipe,jpe,kpe: ', ipe,jpe,kpe<a name='1100'>
<a name='1101'>
         DO j = jps , jpe<a name='1102'>
            DO k = kps , kpe<a name='1103'>
               DO i = ips , ipe<a name='1104'>
                  ubdy3dtemp1(i,k,j) = ubdy3dtemp2(i,k,j)<a name='1105'>
                  vbdy3dtemp1(i,k,j) = vbdy3dtemp2(i,k,j)<a name='1106'>
                  tbdy3dtemp1(i,k,j) = tbdy3dtemp2(i,k,j)<a name='1107'>
                  cwmbdy3dtemp1(i,k,j) = cwmbdy3dtemp2(i,k,j)<a name='1108'>
                  qbdy3dtemp1(i,k,j) = qbdy3dtemp2(i,k,j)<a name='1109'>
                  q2bdy3dtemp1(i,k,j) = q2bdy3dtemp2(i,k,j)<a name='1110'>
               END DO<a name='1111'>
            END DO<a name='1112'>
         END DO<a name='1113'>
<a name='1114'>
<font color=#447700>!mp	change these limits?????????<a name='1115'></font>
<a name='1116'>
         DO j = jps , jpe<a name='1117'>
            DO i = ips , ipe<a name='1118'>
               pdbdy2dtemp1(i,1,j) = pdbdy2dtemp2(i,1,j)<a name='1119'>
            END DO<a name='1120'>
         END DO<a name='1121'>
<a name='1122'>
  <font color=#447700>!  There are 2 components to the lateral boundaries.  <a name='1123'></font>
  <font color=#447700>!   First, there is the starting<a name='1124'></font>
  <font color=#447700>!  point of this time period - just the outer few rows and columns.<a name='1125'></font>
<a name='1126'>
<a name='1127'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_32"> ( ubdy3dtemp1 , grid%nmm_u_b  , 'N' ,&amp; <a name='1128'>
                                        ijds , ijde , spec_bdy_width      , &amp;<a name='1129'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1130'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='1131'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='1132'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_33"> ( vbdy3dtemp1 , grid%nmm_v_b  , 'N' , &amp;<a name='1133'>
                                        ijds , ijde , spec_bdy_width      , &amp;<a name='1134'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1135'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='1136'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='1137'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_34"> ( tbdy3dtemp1 , grid%nmm_t_b  , 'N' , &amp;<a name='1138'>
                                        ijds , ijde , spec_bdy_width      , &amp;<a name='1139'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1140'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='1141'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='1142'>
<a name='1143'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_35"> ( cwmbdy3dtemp1 , grid%nmm_cwm_b , 'N' , &amp;<a name='1144'>
                                          ijds , ijde , spec_bdy_width      , &amp;<a name='1145'>
                                          ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1146'>
                                          ims , ime , jms , jme , kms , kme , &amp;<a name='1147'>
                                          ips , ipe , jps , jpe , kps , kpe+1 )<a name='1148'>
<a name='1149'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_36"> ( qbdy3dtemp1 , grid%nmm_q_b , 'N' ,&amp;<a name='1150'>
                                        ijds , ijde , spec_bdy_width      , &amp;<a name='1151'>
                                        ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1152'>
                                        ims , ime , jms , jme , kms , kme , &amp;<a name='1153'>
                                        ips , ipe , jps , jpe , kps , kpe+1 )<a name='1154'>
<a name='1155'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_37"> ( q2bdy3dtemp1 , grid%nmm_q2_b, 'N' ,&amp;<a name='1156'>
                                         ijds , ijde , spec_bdy_width      , &amp;<a name='1157'>
                                         ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1158'>
                                         ims , ime , jms , jme , kms , kme , &amp;<a name='1159'>
                                         ips , ipe , jps , jpe , kps , kpe+1 )<a name='1160'>
<a name='1161'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_38"> ( pdbdy2dtemp1 , grid%nmm_pd_b , 'M' ,&amp;<a name='1162'>
                                          ijds , ijde , spec_bdy_width  , &amp;<a name='1163'>
                                          ids , ide+1 , jds , jde+1 , 1 , 1 , &amp;<a name='1164'>
                                          ims , ime , jms , jme , 1 , 1 , &amp;<a name='1165'>
                                          ips , ipe , jps , jpe , 1 , 1 )<a name='1166'>
<a name='1167'>
            write(0,*) 'grid%nmm_pd_b(1,1): ', grid%nmm_pd_b(1,1,1,1)<a name='1168'>
<a name='1169'>
      ELSE IF ( loop .EQ. time_loop_max ) THEN<a name='1170'>
<a name='1171'>
    <font color=#447700>!  If this is the last time through here, we need to close the files.<a name='1172'></font>
<a name='1173'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_14"> ( id , config_flags , "DATASET=BOUNDARY" )<a name='1174'>
<a name='1175'>
      END IF<a name='1176'>
<a name='1177'>
   END IF main_loop_test<a name='1178'>
<a name='1179'>
END SUBROUTINE assemble_output<a name='1180'>
</pre></body></html>