<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!                           DISCLAIMER<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<font color=#447700>!   This file was generated by TAF version 1.7.18<a name='4'></font>
<font color=#447700>!<a name='5'></font>
<font color=#447700>!   FASTOPT DISCLAIMS  ALL  WARRANTIES,  EXPRESS  OR  IMPLIED,<a name='6'></font>
<font color=#447700>!   INCLUDING (WITHOUT LIMITATION) ALL IMPLIED  WARRANTIES  OF<a name='7'></font>
<font color=#447700>!   MERCHANTABILITY  OR FITNESS FOR A PARTICULAR PURPOSE, WITH<a name='8'></font>
<font color=#447700>!   RESPECT TO THE SOFTWARE AND USER PROGRAMS.   IN  NO  EVENT<a name='9'></font>
<font color=#447700>!   SHALL  FASTOPT BE LIABLE FOR ANY LOST OR ANTICIPATED PROF-<a name='10'></font>
<font color=#447700>!   ITS, OR ANY INDIRECT, INCIDENTAL, EXEMPLARY,  SPECIAL,  OR<a name='11'></font>
<font color=#447700>!   CONSEQUENTIAL  DAMAGES, WHETHER OR NOT FASTOPT WAS ADVISED<a name='12'></font>
<font color=#447700>!   OF THE POSSIBILITY OF SUCH DAMAGES.<a name='13'></font>
<font color=#447700>!<a name='14'></font>
<font color=#447700>!                           Haftungsbeschraenkung<a name='15'></font>
<font color=#447700>!   FastOpt gibt ausdruecklich keine Gewaehr, explizit oder indirekt,<a name='16'></font>
<font color=#447700>!   bezueglich der Brauchbarkeit  der Software  fuer einen bestimmten<a name='17'></font>
<font color=#447700>!   Zweck.   Unter  keinen  Umstaenden   ist  FastOpt   haftbar  fuer<a name='18'></font>
<font color=#447700>!   irgendeinen Verlust oder nicht eintretenden erwarteten Gewinn und<a name='19'></font>
<font color=#447700>!   allen indirekten,  zufaelligen,  exemplarischen  oder  speziellen<a name='20'></font>
<font color=#447700>!   Schaeden  oder  Folgeschaeden  unabhaengig  von einer eventuellen<a name='21'></font>
<font color=#447700>!   Mitteilung darueber an FastOpt.<a name='22'></font>
<font color=#447700>!<a name='23'></font>
<A NAME='A_MODULE_SMALL_STEP_EM'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_MODULE_SMALL_STEP_EM' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='24'>
<font color=#993300>module     </font><font color=#cc0000>a_module_small_step_em</font> <A href='../../call_to/A_MODULE_SMALL_STEP_EM.html' TARGET='index'>2</A><a name='25'>
<font color=#447700>!******************************************************************<a name='26'></font>
<font color=#447700>!******************************************************************<a name='27'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='28'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='29'></font>
<font color=#447700>!******************************************************************<a name='30'></font>
<font color=#447700>!******************************************************************<a name='31'></font>
<font color=#447700>!==============================================<a name='32'></font>
<font color=#447700>! referencing used modules<a name='33'></font>
<font color=#447700>!==============================================<a name='34'></font>
use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#module_small_step_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_23"><a name='35'>
use <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#module_small_step_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_21"><a name='36'>
use <A href='../../html_code/dyn_em/module_small_step_em.F.html#MODULE_SMALL_STEP_EM'>module_small_step_em</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#module_small_step_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SMALL_STEP_EM_1"><a name='37'>
<a name='38'>
USE <A href='../../html_code/frame/module_trace.F.html#MODULE_TRACE'>module_trace</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#module_small_step_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TRACE_10">, only : trace_entry, trace_exit<a name='39'>
<a name='40'>
<font color=#447700>!==============================================<a name='41'></font>
<font color=#447700>! all entries are defined explicitly<a name='42'></font>
<font color=#447700>!==============================================<a name='43'></font>
implicit none<a name='44'>
<a name='45'>
contains<a name='46'>
<a name='47'>
<A NAME='A_ADVANCE_MU_T'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_MU_T' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='48'>
<font color=#993300>subroutine </font><font color=#cc0000>a_advance_mu_t</font>( ww, a_ww, ww_1, a_ww_1, u, a_u, u_1, a_u_1, v, a_v, v_1, a_v_1, a_mu, a_mut, a_muave, a_muts, muu, &amp; <A href='../../call_to/A_ADVANCE_MU_T.html' TARGET='index'>2</A>,<A href='../../call_from/A_ADVANCE_MU_T.html' TARGET='index'>2</A><a name='49'>
&amp;a_muu, muv, a_muv, a_mudf, a_t, t_1, a_t_1, a_t_ave, a_ft, mu_tend, a_mu_tend, rdx, rdy, dts, epssm, dnw, fnm, fnp, rdnw, msfu, &amp;<a name='50'>
&amp;msfv, msft, config_flags, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='51'>
<font color=#447700>!******************************************************************<a name='52'></font>
<font color=#447700>!******************************************************************<a name='53'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='54'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='55'></font>
<font color=#447700>!******************************************************************<a name='56'></font>
<font color=#447700>!******************************************************************<a name='57'></font>
<font color=#447700>!==============================================<a name='58'></font>
<font color=#447700>! all entries are defined explicitly<a name='59'></font>
<font color=#447700>!==============================================<a name='60'></font>
implicit none<a name='61'>
<a name='62'>
<font color=#447700>!==============================================<a name='63'></font>
<font color=#447700>! declare arguments<a name='64'></font>
<font color=#447700>!==============================================<a name='65'></font>
integer, intent(in) :: ime<a name='66'>
integer, intent(in) :: ims<a name='67'>
integer, intent(in) :: jme<a name='68'>
integer, intent(in) :: jms<a name='69'>
integer, intent(in) :: kme<a name='70'>
integer, intent(in) :: kms<a name='71'>
real, intent(inout) :: a_ft(ims:ime,kms:kme,jms:jme)<a name='72'>
real, intent(inout) :: a_mu(ims:ime,jms:jme)<a name='73'>
real, intent(inout) :: a_mu_tend(ims:ime,jms:jme)<a name='74'>
real, intent(inout) :: a_muave(ims:ime,jms:jme)<a name='75'>
real, intent(inout) :: a_mudf(ims:ime,jms:jme)<a name='76'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='77'>
real, intent(inout) :: a_muts(ims:ime,jms:jme)<a name='78'>
real, intent(inout) :: a_muu(ims:ime,jms:jme)<a name='79'>
real, intent(inout) :: a_muv(ims:ime,jms:jme)<a name='80'>
real, intent(inout) :: a_t(ims:ime,kms:kme,jms:jme)<a name='81'>
real, intent(inout) :: a_t_1(ims:ime,kms:kme,jms:jme)<a name='82'>
real, intent(inout) :: a_t_ave(ims:ime,kms:kme,jms:jme)<a name='83'>
real, intent(inout) :: a_u(ims:ime,kms:kme,jms:jme)<a name='84'>
real, intent(inout) :: a_u_1(ims:ime,kms:kme,jms:jme)<a name='85'>
real, intent(inout) :: a_v(ims:ime,kms:kme,jms:jme)<a name='86'>
real, intent(inout) :: a_v_1(ims:ime,kms:kme,jms:jme)<a name='87'>
real, intent(inout) :: a_ww(ims:ime,kms:kme,jms:jme)<a name='88'>
real, intent(inout) :: a_ww_1(ims:ime,kms:kme,jms:jme)<a name='89'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='90'>
real, intent(in) :: dnw(kms:kme)<a name='91'>
real, intent(in) :: dts<a name='92'>
real, intent(in) :: epssm<a name='93'>
real, intent(in) :: fnm(kms:kme)<a name='94'>
real, intent(in) :: fnp(kms:kme)<a name='95'>
integer, intent(in) :: ide<a name='96'>
integer, intent(in) :: ids<a name='97'>
integer, intent(in) :: ite<a name='98'>
integer, intent(in) :: its<a name='99'>
integer, intent(in) :: jde<a name='100'>
integer, intent(in) :: jds<a name='101'>
integer, intent(in) :: jte<a name='102'>
integer, intent(in) :: jts<a name='103'>
integer, intent(in) :: kde<a name='104'>
integer, intent(in) :: kte<a name='105'>
integer, intent(in) :: kts<a name='106'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='107'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='108'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='109'>
real, intent(in) :: mu_tend(ims:ime,jms:jme)<a name='110'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='111'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='112'>
real, intent(in) :: rdnw(kms:kme)<a name='113'>
real, intent(in) :: rdx<a name='114'>
real, intent(in) :: rdy<a name='115'>
real, intent(in) :: t_1(ims:ime,kms:kme,jms:jme)<a name='116'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='117'>
real, intent(in) :: u_1(ims:ime,kms:kme,jms:jme)<a name='118'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='119'>
real, intent(in) :: v_1(ims:ime,kms:kme,jms:jme)<a name='120'>
real, intent(inout) :: ww(ims:ime,kms:kme,jms:jme)<a name='121'>
real, intent(inout) :: ww_1(ims:ime,kms:kme,jms:jme)<a name='122'>
<a name='123'>
<font color=#447700>!==============================================<a name='124'></font>
<font color=#447700>! declare local variables<a name='125'></font>
<font color=#447700>!==============================================<a name='126'></font>
real a_dmdt(its:ite)<a name='127'>
real a_dvdxi(its:ite,kts:kte)<a name='128'>
real a_wdtn(its:ite,kts:kte)<a name='129'>
real dmdt(its:ite)<a name='130'>
real dvdxi(its:ite,kts:kte)<a name='131'>
integer i<a name='132'>
integer i_end<a name='133'>
integer i_start<a name='134'>
integer j<a name='135'>
integer j_end<a name='136'>
integer j_start<a name='137'>
integer k<a name='138'>
integer k_end<a name='139'>
integer k_start<a name='140'>
<a name='141'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_MU_T' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_87">("a_advance_mu_t")<a name='142'>
<a name='143'>
<font color=#447700>!----------------------------------------------<a name='144'></font>
<font color=#447700>! RESET LOCAL ADJOINT VARIABLES<a name='145'></font>
<font color=#447700>!----------------------------------------------<a name='146'></font>
a_dmdt(:) = 0.<a name='147'>
a_dvdxi(:,:) = 0.<a name='148'>
a_wdtn(:,:) = 0.<a name='149'>
<a name='150'>
<font color=#447700>!----------------------------------------------<a name='151'></font>
<font color=#447700>! ROUTINE BODY<a name='152'></font>
<font color=#447700>!----------------------------------------------<a name='153'></font>
i_start = its<a name='154'>
<font color=#447700>! recompute : i_start<a name='155'></font>
i_end = ite<a name='156'>
<font color=#447700>! recompute : i_end<a name='157'></font>
j_start = jts<a name='158'>
<font color=#447700>! recompute : j_start<a name='159'></font>
j_end = jte<a name='160'>
<font color=#447700>! recompute : j_end<a name='161'></font>
k_start = kts<a name='162'>
<font color=#447700>! recompute : k_start<a name='163'></font>
k_end = kte-1<a name='164'>
<font color=#447700>! recompute : k_end<a name='165'></font>
if (j_end .eq. jde) then<a name='166'>
  j_end = j_end-1<a name='167'>
endif<a name='168'>
<font color=#447700>! recompute : j_end<a name='169'></font>
if (i_end .eq. ide) then<a name='170'>
  i_end = i_end-1<a name='171'>
endif<a name='172'>
<font color=#447700>! recompute : i_end<a name='173'></font>
if ((config_flags%specified .or. config_flags%nested) .and. its .eq. ids) then<a name='174'>
  i_start = i_start+1<a name='175'>
endif<a name='176'>
<font color=#447700>! recompute : i_start<a name='177'></font>
if ((config_flags%specified .or. config_flags%nested) .and. ite .eq. ide) then<a name='178'>
  i_end = i_end-1<a name='179'>
endif<a name='180'>
<font color=#447700>! recompute : i_end<a name='181'></font>
if ((config_flags%specified .or. config_flags%nested) .and. jts .eq. jds) then<a name='182'>
  j_start = j_start+1<a name='183'>
endif<a name='184'>
<font color=#447700>! recompute : j_start<a name='185'></font>
if ((config_flags%specified .or. config_flags%nested) .and. jte .eq. jde) then<a name='186'>
  j_end = j_end-1<a name='187'>
endif<a name='188'>
<font color=#447700>! recompute : j_end<a name='189'></font>
do j = j_start, j_end<a name='190'>
  do i = i_start, i_end<a name='191'>
    dmdt(i) = 0.<a name='192'>
  end do<a name='193'>
  do k = k_start, k_end<a name='194'>
    do i = i_start, i_end<a name='195'>
      dvdxi(i,k) = msft(i,j)*msft(i,j)*(rdy*(v(i,k,j+1)+muv(i,j+1)*v_1(i,k,j+1)/msfv(i,j+1)-(v(i,k,j)+muv(i,j)*v_1(i,k,j)/msfv(i,j)&amp;<a name='196'>
&amp;))+rdx*(u(i+1,k,j)+muu(i+1,j)*u_1(i+1,k,j)/msfu(i+1,j)-(u(i,k,j)+muu(i,j)*u_1(i,k,j)/msfu(i,j))))<a name='197'>
      dmdt(i) = dmdt(i)+dnw(k)*dvdxi(i,k)<a name='198'>
    end do<a name='199'>
  end do<a name='200'>
  do k = 2, k_end<a name='201'>
    do i = i_start, i_end<a name='202'>
      ww(i,k,j) = ww(i,k-1,j)-dnw(k-1)*(dmdt(i)+dvdxi(i,k-1)+mu_tend(i,j))/msft(i,j)<a name='203'>
    end do<a name='204'>
  end do<a name='205'>
  do k = 1, k_end<a name='206'>
    do i = i_start, i_end<a name='207'>
      ww(i,k,j) = ww(i,k,j)-ww_1(i,k,j)<a name='208'>
    end do<a name='209'>
  end do<a name='210'>
end do<a name='211'>
<font color=#447700>! recompute : ww<a name='212'></font>
do j = j_start, j_end<a name='213'>
  do k = 1, k_end<a name='214'>
    do i = i_start, i_end<a name='215'>
      a_t_1(i,k,j-1) = a_t_1(i,k,j-1)+0.5*a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*rdy*v(i,k,j)<a name='216'>
      a_t_1(i,k,j+1) = a_t_1(i,k,j+1)-0.5*a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*rdy*v(i,k,j+1)<a name='217'>
      a_t_1(i-1,k,j) = a_t_1(i-1,k,j)+0.5*a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*rdx*u(i,k,j)<a name='218'>
      a_t_1(i+1,k,j) = a_t_1(i+1,k,j)-0.5*a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*rdx*u(i+1,k,j)<a name='219'>
      a_t_1(i,k,j) = a_t_1(i,k,j)-a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*(0.5*rdy*(v(i,k,j+1)-v(i,k,j))+0.5*rdx*(u(i+1,k,j)-u(i,k,j)))<a name='220'>
      a_u(i+1,k,j) = a_u(i+1,k,j)-0.5*a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*rdx*(t_1(i+1,k,j)+t_1(i,k,j))<a name='221'>
      a_u(i,k,j) = a_u(i,k,j)+0.5*a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*rdx*(t_1(i,k,j)+t_1(i-1,k,j))<a name='222'>
      a_v(i,k,j+1) = a_v(i,k,j+1)-0.5*a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*rdy*(t_1(i,k,j+1)+t_1(i,k,j))<a name='223'>
      a_v(i,k,j) = a_v(i,k,j)+0.5*a_t(i,k,j)*dts*msft(i,j)*msft(i,j)*rdy*(t_1(i,k,j)+t_1(i,k,j-1))<a name='224'>
      a_wdtn(i,k+1) = a_wdtn(i,k+1)-a_t(i,k,j)*dts*msft(i,j)*rdnw(k)<a name='225'>
      a_wdtn(i,k) = a_wdtn(i,k)+a_t(i,k,j)*dts*msft(i,j)*rdnw(k)<a name='226'>
    end do<a name='227'>
  end do<a name='228'>
  do k = 2, k_end<a name='229'>
    do i = i_start, i_end<a name='230'>
      a_t_1(i,k-1,j) = a_t_1(i,k-1,j)+a_wdtn(i,k)*ww(i,k,j)*fnp(k)<a name='231'>
      a_t_1(i,k,j) = a_t_1(i,k,j)+a_wdtn(i,k)*ww(i,k,j)*fnm(k)<a name='232'>
      a_ww(i,k,j) = a_ww(i,k,j)+a_wdtn(i,k)*(fnm(k)*t_1(i,k,j)+fnp(k)*t_1(i,k-1,j))<a name='233'>
      a_wdtn(i,k) = 0.<a name='234'>
    end do<a name='235'>
  end do<a name='236'>
  do i = i_start, i_end<a name='237'>
    a_wdtn(i,kde) = 0.<a name='238'>
    a_wdtn(i,1) = 0.<a name='239'>
  end do<a name='240'>
end do<a name='241'>
<a name='242'>
do j = j_start, j_end<a name='243'>
  do k = 1, k_end<a name='244'>
    do i = i_start, i_end<a name='245'>
      a_ft(i,k,j) = a_ft(i,k,j)+a_t(i,k,j)*msft(i,j)*dts<a name='246'>
      a_t(i,k,j) = a_t(i,k,j)+a_t_ave(i,k,j)<a name='247'>
      a_t_ave(i,k,j) = 0.<a name='248'>
    end do<a name='249'>
  end do<a name='250'>
end do<a name='251'>
do j = j_start, j_end<a name='252'>
  do k = 1, k_end<a name='253'>
    do i = i_start, i_end<a name='254'>
      a_ww_1(i,k,j) = a_ww_1(i,k,j)-a_ww(i,k,j)<a name='255'>
    end do<a name='256'>
  end do<a name='257'>
  do k = k_end, 2, -1<a name='258'>
    do i = i_start, i_end<a name='259'>
      a_dmdt(i) = a_dmdt(i)-a_ww(i,k,j)*(dnw(k-1)/msft(i,j))<a name='260'>
      a_dvdxi(i,k-1) = a_dvdxi(i,k-1)-a_ww(i,k,j)*(dnw(k-1)/msft(i,j))<a name='261'>
      a_mu_tend(i,j) = a_mu_tend(i,j)-a_ww(i,k,j)*(dnw(k-1)/msft(i,j))<a name='262'>
      a_ww(i,k-1,j) = a_ww(i,k-1,j)+a_ww(i,k,j)<a name='263'>
      a_ww(i,k,j) = 0.<a name='264'>
    end do<a name='265'>
  end do<a name='266'>
  do i = i_start, i_end<a name='267'>
    a_mu(i,j) = a_mu(i,j)+0.5*a_muave(i,j)*(1+epssm)<a name='268'>
    a_muave(i,j) = 0.5*a_muave(i,j)*(1.-epssm)<a name='269'>
    a_mu(i,j) = a_mu(i,j)+a_muts(i,j)<a name='270'>
    a_mut(i,j) = a_mut(i,j)+a_muts(i,j)<a name='271'>
    a_muts(i,j) = 0.<a name='272'>
    a_dmdt(i) = a_dmdt(i)+a_mudf(i,j)<a name='273'>
    a_mu_tend(i,j) = a_mu_tend(i,j)+a_mudf(i,j)<a name='274'>
    a_mudf(i,j) = 0.<a name='275'>
    a_dmdt(i) = a_dmdt(i)+a_mu(i,j)*dts<a name='276'>
    a_mu_tend(i,j) = a_mu_tend(i,j)+a_mu(i,j)*dts<a name='277'>
    a_mu(i,j) = a_mu(i,j)+a_muave(i,j)<a name='278'>
    a_muave(i,j) = 0.<a name='279'>
  end do<a name='280'>
  do k = k_end, k_start, -1<a name='281'>
    do i = i_start, i_end<a name='282'>
      a_dvdxi(i,k) = a_dvdxi(i,k)+a_dmdt(i)*dnw(k)<a name='283'>
      a_muu(i+1,j) = a_muu(i+1,j)+a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdx*(u_1(i+1,k,j)/msfu(i+1,j))<a name='284'>
      a_muu(i,j) = a_muu(i,j)-a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdx*(u_1(i,k,j)/msfu(i,j))<a name='285'>
      a_muv(i,j+1) = a_muv(i,j+1)+a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdy*(v_1(i,k,j+1)/msfv(i,j+1))<a name='286'>
      a_muv(i,j) = a_muv(i,j)-a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdy*(v_1(i,k,j)/msfv(i,j))<a name='287'>
      a_u(i+1,k,j) = a_u(i+1,k,j)+a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdx<a name='288'>
      a_u(i,k,j) = a_u(i,k,j)-a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdx<a name='289'>
      a_u_1(i+1,k,j) = a_u_1(i+1,k,j)+a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdx*(muu(i+1,j)/msfu(i+1,j))<a name='290'>
      a_u_1(i,k,j) = a_u_1(i,k,j)-a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdx*(muu(i,j)/msfu(i,j))<a name='291'>
      a_v(i,k,j+1) = a_v(i,k,j+1)+a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdy<a name='292'>
      a_v(i,k,j) = a_v(i,k,j)-a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdy<a name='293'>
      a_v_1(i,k,j+1) = a_v_1(i,k,j+1)+a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdy*(muv(i,j+1)/msfv(i,j+1))<a name='294'>
      a_v_1(i,k,j) = a_v_1(i,k,j)-a_dvdxi(i,k)*msft(i,j)*msft(i,j)*rdy*(muv(i,j)/msfv(i,j))<a name='295'>
      a_dvdxi(i,k) = 0.<a name='296'>
    end do<a name='297'>
  end do<a name='298'>
  do i = i_start, i_end<a name='299'>
    a_dmdt(i) = 0.<a name='300'>
  end do<a name='301'>
end do<a name='302'>
<a name='303'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_MU_T' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_87">("a_advance_mu_t")<a name='304'>
<a name='305'>
end subroutine a_advance_mu_t<a name='306'>
<a name='307'>
<a name='308'>
<A NAME='A_ADVANCE_UV'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_UV' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='309'>
<font color=#993300>subroutine </font><font color=#cc0000>a_advance_uv</font>( a_u, a_ru_tend, a_v, a_rv_tend, p, a_p, pb, ph, a_ph, php, a_php, alt, a_alt, al, a_al, mu, a_mu, muu, &amp; <A href='../../call_to/A_ADVANCE_UV.html' TARGET='index'>2</A>,<A href='../../call_from/A_ADVANCE_UV.html' TARGET='index'>2</A><a name='310'>
&amp;a_muu, cqu, a_cqu, muv, a_muv, cqv, a_cqv, a_mudf, rdx, rdy, dts, cf1, cf2, cf3, fnm, fnp, emdiv, rdnw, config_flags, spec_zone, &amp;<a name='311'>
&amp;non_hydrostatic, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='312'>
<font color=#447700>!******************************************************************<a name='313'></font>
<font color=#447700>!******************************************************************<a name='314'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='315'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='316'></font>
<font color=#447700>!******************************************************************<a name='317'></font>
<font color=#447700>!******************************************************************<a name='318'></font>
<font color=#447700>!==============================================<a name='319'></font>
<font color=#447700>! all entries are defined explicitly<a name='320'></font>
<font color=#447700>!==============================================<a name='321'></font>
implicit none<a name='322'>
<a name='323'>
<font color=#447700>!==============================================<a name='324'></font>
<font color=#447700>! declare arguments<a name='325'></font>
<font color=#447700>!==============================================<a name='326'></font>
integer, intent(in) :: ime<a name='327'>
integer, intent(in) :: ims<a name='328'>
integer, intent(in) :: jme<a name='329'>
integer, intent(in) :: jms<a name='330'>
integer, intent(in) :: kme<a name='331'>
integer, intent(in) :: kms<a name='332'>
real, intent(inout) :: a_al(ims:ime,kms:kme,jms:jme)<a name='333'>
real, intent(inout) :: a_alt(ims:ime,kms:kme,jms:jme)<a name='334'>
real, intent(inout) :: a_cqu(ims:ime,kms:kme,jms:jme)<a name='335'>
real, intent(inout) :: a_cqv(ims:ime,kms:kme,jms:jme)<a name='336'>
real, intent(inout) :: a_mu(ims:ime,jms:jme)<a name='337'>
real, intent(inout) :: a_mudf(ims:ime,jms:jme)<a name='338'>
real, intent(inout) :: a_muu(ims:ime,jms:jme)<a name='339'>
real, intent(inout) :: a_muv(ims:ime,jms:jme)<a name='340'>
real, intent(inout) :: a_p(ims:ime,kms:kme,jms:jme)<a name='341'>
real, intent(inout) :: a_ph(ims:ime,kms:kme,jms:jme)<a name='342'>
real, intent(inout) :: a_php(ims:ime,kms:kme,jms:jme)<a name='343'>
real, intent(inout) :: a_ru_tend(ims:ime,kms:kme,jms:jme)<a name='344'>
real, intent(inout) :: a_rv_tend(ims:ime,kms:kme,jms:jme)<a name='345'>
real, intent(inout) :: a_u(ims:ime,kms:kme,jms:jme)<a name='346'>
real, intent(inout) :: a_v(ims:ime,kms:kme,jms:jme)<a name='347'>
real, intent(in) :: al(ims:ime,kms:kme,jms:jme)<a name='348'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='349'>
real, intent(in) :: cf1<a name='350'>
real, intent(in) :: cf2<a name='351'>
real, intent(in) :: cf3<a name='352'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='353'>
real, intent(in) :: cqu(ims:ime,kms:kme,jms:jme)<a name='354'>
real, intent(in) :: cqv(ims:ime,kms:kme,jms:jme)<a name='355'>
real, intent(in) :: dts<a name='356'>
real, intent(in) :: emdiv<a name='357'>
real, intent(in) :: fnm(kms:kme)<a name='358'>
real, intent(in) :: fnp(kms:kme)<a name='359'>
integer, intent(in) :: ide<a name='360'>
integer, intent(in) :: ids<a name='361'>
integer, intent(in) :: ite<a name='362'>
integer, intent(in) :: its<a name='363'>
integer, intent(in) :: jde<a name='364'>
integer, intent(in) :: jds<a name='365'>
integer, intent(in) :: jte<a name='366'>
integer, intent(in) :: jts<a name='367'>
integer, intent(in) :: kde<a name='368'>
integer, intent(in) :: kte<a name='369'>
integer, intent(in) :: kts<a name='370'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='371'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='372'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='373'>
logical, intent(in) :: non_hydrostatic<a name='374'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='375'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='376'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='377'>
real, intent(in) :: php(ims:ime,kms:kme,jms:jme)<a name='378'>
real, intent(in) :: rdnw(kms:kme)<a name='379'>
real, intent(in) :: rdx<a name='380'>
real, intent(in) :: rdy<a name='381'>
integer, intent(in) :: spec_zone<a name='382'>
<a name='383'>
<font color=#447700>!==============================================<a name='384'></font>
<font color=#447700>! declare local variables<a name='385'></font>
<font color=#447700>!==============================================<a name='386'></font>
real a_dpn(its:ite,kts:kte)<a name='387'>
real a_dpxy(its:ite,kts:kte)<a name='388'>
real a_mudf_xy(its:ite)<a name='389'>
real dpn(its:ite,kts:kte)<a name='390'>
real dpxy(its:ite,kts:kte)<a name='391'>
real dx<a name='392'>
real dy<a name='393'>
integer i<a name='394'>
integer i_end<a name='395'>
integer i_end_up<a name='396'>
integer i_endu<a name='397'>
integer i_start<a name='398'>
integer i_start_up<a name='399'>
integer j<a name='400'>
integer j_end<a name='401'>
integer j_end_vp<a name='402'>
integer j_endv<a name='403'>
integer j_start<a name='404'>
integer j_start_vp<a name='405'>
integer k<a name='406'>
integer k_end<a name='407'>
integer k_start<a name='408'>
<a name='409'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_UV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_88">("a_advance_uv")<a name='410'>
<a name='411'>
<font color=#447700>!----------------------------------------------<a name='412'></font>
<font color=#447700>! RESET LOCAL ADJOINT VARIABLES<a name='413'></font>
<font color=#447700>!----------------------------------------------<a name='414'></font>
a_dpn(:,:) = 0.<a name='415'>
a_dpxy(:,:) = 0.<a name='416'>
a_mudf_xy(:) = 0.<a name='417'>
<a name='418'>
<font color=#447700>!----------------------------------------------<a name='419'></font>
<font color=#447700>! ROUTINE BODY<a name='420'></font>
<font color=#447700>!----------------------------------------------<a name='421'></font>
if (config_flags%nested .or. config_flags%specified) then<a name='422'>
  i_start = max(its,ids+spec_zone)<a name='423'>
  i_end = min(ite,ide-spec_zone-1)<a name='424'>
  j_start = max(jts,jds+spec_zone)<a name='425'>
  j_end = min(jte,jde-spec_zone-1)<a name='426'>
  k_start = kts<a name='427'>
  k_end = min(kte,kde-1)<a name='428'>
  i_endu = min(ite,ide-spec_zone)<a name='429'>
  j_endv = min(jte,jde-spec_zone)<a name='430'>
else<a name='431'>
  i_start = its<a name='432'>
  i_end = ite<a name='433'>
  j_start = jts<a name='434'>
  j_end = jte<a name='435'>
  k_start = kts<a name='436'>
  k_end = kte-1<a name='437'>
  i_endu = i_end<a name='438'>
  j_endv = j_end<a name='439'>
  if (j_end .eq. jde) then<a name='440'>
    j_end = j_end-1<a name='441'>
  endif<a name='442'>
  if (i_end .eq. ide) then<a name='443'>
    i_end = i_end-1<a name='444'>
  endif<a name='445'>
endif<a name='446'>
<font color=#447700>! recompute : i_end,i_endu,i_start,j_end,j_endv,j_start,k_end,k_start<a name='447'></font>
i_start_up = i_start<a name='448'>
<font color=#447700>! recompute : i_start_up<a name='449'></font>
i_end_up = i_endu<a name='450'>
<font color=#447700>! recompute : i_end_up<a name='451'></font>
j_start_vp = j_start<a name='452'>
<font color=#447700>! recompute : j_start_vp<a name='453'></font>
j_end_vp = j_endv<a name='454'>
<font color=#447700>! recompute : j_end_vp<a name='455'></font>
if ((config_flags%open_xs .or. config_flags%symmetric_xs) .and. its .eq. ids) then<a name='456'>
  i_start_up = i_start_up+1<a name='457'>
endif<a name='458'>
<font color=#447700>! recompute : i_start_up<a name='459'></font>
if ((config_flags%open_xe .or. config_flags%symmetric_xe) .and. ite .eq. ide) then<a name='460'>
  i_end_up = i_end_up-1<a name='461'>
endif<a name='462'>
<font color=#447700>! recompute : i_end_up<a name='463'></font>
if ((config_flags%open_ys .or. config_flags%symmetric_ys) .and. jts .eq. jds) then<a name='464'>
  j_start_vp = j_start_vp+1<a name='465'>
endif<a name='466'>
<font color=#447700>! recompute : j_start_vp<a name='467'></font>
if ((config_flags%open_ye .or. config_flags%symmetric_ye) .and. jte .eq. jde) then<a name='468'>
  j_end_vp = j_end_vp-1<a name='469'>
endif<a name='470'>
<font color=#447700>! recompute : j_end_vp<a name='471'></font>
dx = 1./rdx<a name='472'>
<font color=#447700>! recompute : dx<a name='473'></font>
dy = 1./rdy<a name='474'>
<font color=#447700>! recompute : dy<a name='475'></font>
a_v_outer_j_loop: do j = j_endv, j_start, -1<a name='476'>
  if (j .ge. j_start_vp .and. j .le. j_end_vp) then<a name='477'>
    do k = k_start, k_end<a name='478'>
      do i = i_start, i_end<a name='479'>
        dpxy(i,k) = 0.5*rdy*muv(i,j)*(ph(i,k+1,j)-ph(i,k+1,j-1)+ph(i,k,j)-ph(i,k,j-1)+(alt(i,k,j)+alt(i,k,j-1))*(p(i,k,j)-p(i,k,j-&amp;<a name='480'>
&amp;1))+(al(i,k,j)+al(i,k,j-1))*(pb(i,k,j)-pb(i,k,j-1)))<a name='481'>
      end do<a name='482'>
    end do<a name='483'>
<font color=#447700>! recompute : dpxy<a name='484'></font>
    if (non_hydrostatic) then<a name='485'>
      do i = i_start, i_end<a name='486'>
        dpn(i,1) = 0.5*(cf1*(p(i,1,j)+p(i,1,j-1))+cf2*(p(i,2,j)+p(i,2,j-1))+cf3*(p(i,3,j)+p(i,3,j-1)))<a name='487'>
        dpn(i,kde) = 0.<a name='488'>
      end do<a name='489'>
      do k = k_start+1, k_end<a name='490'>
        do i = i_start, i_end<a name='491'>
          dpn(i,k) = 0.5*(fnm(k)*(p(i,k,j)+p(i,k,j-1))+fnp(k)*(p(i,k-1,j)+p(i,k-1,j-1)))<a name='492'>
        end do<a name='493'>
      end do<a name='494'>
      do k = k_start, k_end<a name='495'>
        do i = i_start, i_end<a name='496'>
          dpxy(i,k) = dpxy(i,k)+rdy*(php(i,k,j)-php(i,k,j-1))*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i,j-1)+mu(i,j)))<a name='497'>
        end do<a name='498'>
      end do<a name='499'>
    endif<a name='500'>
<font color=#447700>! recompute : dpxy<a name='501'></font>
    do k = k_start, k_end<a name='502'>
      do i = i_start, i_end<a name='503'>
        a_cqv(i,k,j) = a_cqv(i,k,j)-a_v(i,k,j)*dts*dpxy(i,k)<a name='504'>
        a_dpxy(i,k) = a_dpxy(i,k)-a_v(i,k,j)*dts*cqv(i,k,j)<a name='505'>
        a_mudf_xy(i) = a_mudf_xy(i)+a_v(i,k,j)<a name='506'>
      end do<a name='507'>
    end do<a name='508'>
    if (non_hydrostatic) then<a name='509'>
<font color=#447700>! recompute : dpn<a name='510'></font>
      do k = k_start, k_end<a name='511'>
        do i = i_start, i_end<a name='512'>
          a_dpn(i,k+1) = a_dpn(i,k+1)+a_dpxy(i,k)*rdy*(php(i,k,j)-php(i,k,j-1))*rdnw(k)<a name='513'>
          a_dpn(i,k) = a_dpn(i,k)-a_dpxy(i,k)*rdy*(php(i,k,j)-php(i,k,j-1))*rdnw(k)<a name='514'>
          a_mu(i,j-1) = a_mu(i,j-1)-0.5*a_dpxy(i,k)*rdy*(php(i,k,j)-php(i,k,j-1))<a name='515'>
          a_mu(i,j) = a_mu(i,j)-0.5*a_dpxy(i,k)*rdy*(php(i,k,j)-php(i,k,j-1))<a name='516'>
          a_php(i,k,j-1) = a_php(i,k,j-1)-a_dpxy(i,k)*rdy*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i,j-1)+mu(i,j)))<a name='517'>
          a_php(i,k,j) = a_php(i,k,j)+a_dpxy(i,k)*rdy*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i,j-1)+mu(i,j)))<a name='518'>
        end do<a name='519'>
      end do<a name='520'>
      do k = k_start+1, k_end<a name='521'>
        do i = i_start, i_end<a name='522'>
          a_p(i,k-1,j-1) = a_p(i,k-1,j-1)+0.5*a_dpn(i,k)*fnp(k)<a name='523'>
          a_p(i,k-1,j) = a_p(i,k-1,j)+0.5*a_dpn(i,k)*fnp(k)<a name='524'>
          a_p(i,k,j-1) = a_p(i,k,j-1)+0.5*a_dpn(i,k)*fnm(k)<a name='525'>
          a_p(i,k,j) = a_p(i,k,j)+0.5*a_dpn(i,k)*fnm(k)<a name='526'>
          a_dpn(i,k) = 0.<a name='527'>
        end do<a name='528'>
      end do<a name='529'>
      do i = i_start, i_end<a name='530'>
        a_dpn(i,kde) = 0.<a name='531'>
        a_p(i,3,j-1) = a_p(i,3,j-1)+0.5*a_dpn(i,1)*cf3<a name='532'>
        a_p(i,3,j) = a_p(i,3,j)+0.5*a_dpn(i,1)*cf3<a name='533'>
        a_p(i,2,j-1) = a_p(i,2,j-1)+0.5*a_dpn(i,1)*cf2<a name='534'>
        a_p(i,2,j) = a_p(i,2,j)+0.5*a_dpn(i,1)*cf2<a name='535'>
        a_p(i,1,j-1) = a_p(i,1,j-1)+0.5*a_dpn(i,1)*cf1<a name='536'>
        a_p(i,1,j) = a_p(i,1,j)+0.5*a_dpn(i,1)*cf1<a name='537'>
<a name='538'>
        a_dpn(i,1) = 0.<a name='539'>
      end do<a name='540'>
    endif<a name='541'>
    do k = k_start, k_end<a name='542'>
      do i = i_start, i_end<a name='543'>
        a_al(i,k,j-1) = a_al(i,k,j-1)+0.5*a_dpxy(i,k)*rdy*muv(i,j)*(pb(i,k,j)-pb(i,k,j-1))<a name='544'>
        a_al(i,k,j) = a_al(i,k,j)+0.5*a_dpxy(i,k)*rdy*muv(i,j)*(pb(i,k,j)-pb(i,k,j-1))<a name='545'>
        a_alt(i,k,j-1) = a_alt(i,k,j-1)+0.5*a_dpxy(i,k)*rdy*muv(i,j)*(p(i,k,j)-p(i,k,j-1))<a name='546'>
        a_alt(i,k,j) = a_alt(i,k,j)+0.5*a_dpxy(i,k)*rdy*muv(i,j)*(p(i,k,j)-p(i,k,j-1))<a name='547'>
        a_muv(i,j) = a_muv(i,j)+0.5*a_dpxy(i,k)*rdy*(ph(i,k+1,j)-ph(i,k+1,j-1)+ph(i,k,j)-ph(i,k,j-1)+(alt(i,k,j)+alt(i,k,j-1))*&amp;<a name='548'>
&amp;(p(i,k,j)-p(i,k,j-1))+(al(i,k,j)+al(i,k,j-1))*(pb(i,k,j)-pb(i,k,j-1)))<a name='549'>
        a_p(i,k,j-1) = a_p(i,k,j-1)-0.5*a_dpxy(i,k)*rdy*muv(i,j)*(alt(i,k,j)+alt(i,k,j-1))<a name='550'>
        a_p(i,k,j) = a_p(i,k,j)+0.5*a_dpxy(i,k)*rdy*muv(i,j)*(alt(i,k,j)+alt(i,k,j-1))<a name='551'>
        a_ph(i,k+1,j-1) = a_ph(i,k+1,j-1)-0.5*a_dpxy(i,k)*rdy*muv(i,j)<a name='552'>
        a_ph(i,k+1,j) = a_ph(i,k+1,j)+0.5*a_dpxy(i,k)*rdy*muv(i,j)<a name='553'>
        a_ph(i,k,j-1) = a_ph(i,k,j-1)-0.5*a_dpxy(i,k)*rdy*muv(i,j)<a name='554'>
        a_ph(i,k,j) = a_ph(i,k,j)+0.5*a_dpxy(i,k)*rdy*muv(i,j)<a name='555'>
        a_dpxy(i,k) = 0.<a name='556'>
      end do<a name='557'>
    end do<a name='558'>
  endif<a name='559'>
  do i = i_start, i_end<a name='560'>
    a_mudf(i,j-1) = a_mudf(i,j-1)+a_mudf_xy(i)*emdiv*dy<a name='561'>
    a_mudf(i,j) = a_mudf(i,j)-a_mudf_xy(i)*emdiv*dy<a name='562'>
    a_mudf_xy(i) = 0.<a name='563'>
  end do<a name='564'>
  do k = k_start, k_end<a name='565'>
    do i = i_start, i_end<a name='566'>
      a_rv_tend(i,k,j) = a_rv_tend(i,k,j)+a_v(i,k,j)*dts<a name='567'>
    end do<a name='568'>
  end do<a name='569'>
end do a_v_outer_j_loop<a name='570'>
do j = j_start, j_end<a name='571'>
  do k = k_start, k_end<a name='572'>
    do i = i_start_up, i_end_up<a name='573'>
      dpxy(i,k) = 0.5*rdx*muu(i,j)*(ph(i,k+1,j)-ph(i-1,k+1,j)+ph(i,k,j)-ph(i-1,k,j)+(alt(i,k,j)+alt(i-1,k,j))*(p(i,k,j)-p(i-1,k,j))&amp;<a name='574'>
&amp;+(al(i,k,j)+al(i-1,k,j))*(pb(i,k,j)-pb(i-1,k,j)))<a name='575'>
    end do<a name='576'>
  end do<a name='577'>
<font color=#447700>! recompute : dpxy<a name='578'></font>
  if (non_hydrostatic) then<a name='579'>
    do i = i_start_up, i_end_up<a name='580'>
      dpn(i,1) = 0.5*(cf1*(p(i,1,j)+p(i-1,1,j))+cf2*(p(i,2,j)+p(i-1,2,j))+cf3*(p(i,3,j)+p(i-1,3,j)))<a name='581'>
      dpn(i,kde) = 0.<a name='582'>
    end do<a name='583'>
    do k = k_start+1, k_end<a name='584'>
      do i = i_start_up, i_end_up<a name='585'>
        dpn(i,k) = 0.5*(fnm(k)*(p(i,k,j)+p(i-1,k,j))+fnp(k)*(p(i,k-1,j)+p(i-1,k-1,j)))<a name='586'>
      end do<a name='587'>
    end do<a name='588'>
    do k = k_start, k_end<a name='589'>
      do i = i_start_up, i_end_up<a name='590'>
        dpxy(i,k) = dpxy(i,k)+rdx*(php(i,k,j)-php(i-1,k,j))*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))<a name='591'>
      end do<a name='592'>
    end do<a name='593'>
  endif<a name='594'>
<font color=#447700>! recompute : dpxy<a name='595'></font>
  do k = k_start, k_end<a name='596'>
    do i = i_start_up, i_end_up<a name='597'>
      a_cqu(i,k,j) = a_cqu(i,k,j)-a_u(i,k,j)*dts*dpxy(i,k)<a name='598'>
      a_dpxy(i,k) = a_dpxy(i,k)-a_u(i,k,j)*dts*cqu(i,k,j)<a name='599'>
      a_mudf_xy(i) = a_mudf_xy(i)+a_u(i,k,j)<a name='600'>
    end do<a name='601'>
  end do<a name='602'>
  if (non_hydrostatic) then<a name='603'>
<font color=#447700>! recompute : dpn<a name='604'></font>
    do k = k_start, k_end<a name='605'>
      do i = i_start_up, i_end_up<a name='606'>
        a_dpn(i,k+1) = a_dpn(i,k+1)+a_dpxy(i,k)*rdx*(php(i,k,j)-php(i-1,k,j))*rdnw(k)<a name='607'>
        a_dpn(i,k) = a_dpn(i,k)-a_dpxy(i,k)*rdx*(php(i,k,j)-php(i-1,k,j))*rdnw(k)<a name='608'>
        a_mu(i-1,j) = a_mu(i-1,j)-0.5*a_dpxy(i,k)*rdx*(php(i,k,j)-php(i-1,k,j))<a name='609'>
        a_mu(i,j) = a_mu(i,j)-0.5*a_dpxy(i,k)*rdx*(php(i,k,j)-php(i-1,k,j))<a name='610'>
        a_php(i-1,k,j) = a_php(i-1,k,j)-a_dpxy(i,k)*rdx*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))<a name='611'>
        a_php(i,k,j) = a_php(i,k,j)+a_dpxy(i,k)*rdx*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))<a name='612'>
      end do<a name='613'>
    end do<a name='614'>
    do k = k_start+1, k_end<a name='615'>
      do i = i_start_up, i_end_up<a name='616'>
        a_p(i-1,k-1,j) = a_p(i-1,k-1,j)+0.5*a_dpn(i,k)*fnp(k)<a name='617'>
        a_p(i,k-1,j) = a_p(i,k-1,j)+0.5*a_dpn(i,k)*fnp(k)<a name='618'>
        a_p(i-1,k,j) = a_p(i-1,k,j)+0.5*a_dpn(i,k)*fnm(k)<a name='619'>
        a_p(i,k,j) = a_p(i,k,j)+0.5*a_dpn(i,k)*fnm(k)<a name='620'>
        a_dpn(i,k) = 0.<a name='621'>
      end do<a name='622'>
    end do<a name='623'>
    do i = i_start_up, i_end_up<a name='624'>
      a_dpn(i,kde) = 0.<a name='625'>
      a_p(i-1,3,j) = a_p(i-1,3,j)+0.5*a_dpn(i,1)*cf3<a name='626'>
      a_p(i,3,j) = a_p(i,3,j)+0.5*a_dpn(i,1)*cf3<a name='627'>
      a_p(i-1,2,j) = a_p(i-1,2,j)+0.5*a_dpn(i,1)*cf2<a name='628'>
      a_p(i,2,j) = a_p(i,2,j)+0.5*a_dpn(i,1)*cf2<a name='629'>
      a_p(i-1,1,j) = a_p(i-1,1,j)+0.5*a_dpn(i,1)*cf1<a name='630'>
      a_p(i,1,j) = a_p(i,1,j)+0.5*a_dpn(i,1)*cf1<a name='631'>
      a_dpn(i,1) = 0.<a name='632'>
    end do<a name='633'>
  endif<a name='634'>
  do k = k_start, k_end<a name='635'>
    do i = i_start_up, i_end_up<a name='636'>
      a_al(i-1,k,j) = a_al(i-1,k,j)+0.5*a_dpxy(i,k)*rdx*muu(i,j)*(pb(i,k,j)-pb(i-1,k,j))<a name='637'>
      a_al(i,k,j) = a_al(i,k,j)+0.5*a_dpxy(i,k)*rdx*muu(i,j)*(pb(i,k,j)-pb(i-1,k,j))<a name='638'>
      a_alt(i-1,k,j) = a_alt(i-1,k,j)+0.5*a_dpxy(i,k)*rdx*muu(i,j)*(p(i,k,j)-p(i-1,k,j))<a name='639'>
      a_alt(i,k,j) = a_alt(i,k,j)+0.5*a_dpxy(i,k)*rdx*muu(i,j)*(p(i,k,j)-p(i-1,k,j))<a name='640'>
      a_muu(i,j) = a_muu(i,j)+0.5*a_dpxy(i,k)*rdx*(ph(i,k+1,j)-ph(i-1,k+1,j)+ph(i,k,j)-ph(i-1,k,j)+(alt(i,k,j)+alt(i-1,k,j))*(p(i,&amp;<a name='641'>
&amp;k,j)-p(i-1,k,j))+(al(i,k,j)+al(i-1,k,j))*(pb(i,k,j)-pb(i-1,k,j)))<a name='642'>
      a_p(i-1,k,j) = a_p(i-1,k,j)-0.5*a_dpxy(i,k)*rdx*muu(i,j)*(alt(i,k,j)+alt(i-1,k,j))<a name='643'>
      a_p(i,k,j) = a_p(i,k,j)+0.5*a_dpxy(i,k)*rdx*muu(i,j)*(alt(i,k,j)+alt(i-1,k,j))<a name='644'>
      a_ph(i-1,k+1,j) = a_ph(i-1,k+1,j)-0.5*a_dpxy(i,k)*rdx*muu(i,j)<a name='645'>
      a_ph(i,k+1,j) = a_ph(i,k+1,j)+0.5*a_dpxy(i,k)*rdx*muu(i,j)<a name='646'>
      a_ph(i-1,k,j) = a_ph(i-1,k,j)-0.5*a_dpxy(i,k)*rdx*muu(i,j)<a name='647'>
      a_ph(i,k,j) = a_ph(i,k,j)+0.5*a_dpxy(i,k)*rdx*muu(i,j)<a name='648'>
      a_dpxy(i,k) = 0.<a name='649'>
    end do<a name='650'>
  end do<a name='651'>
  do i = i_start_up, i_end_up<a name='652'>
    a_mudf(i-1,j) = a_mudf(i-1,j)+a_mudf_xy(i)*emdiv*dx<a name='653'>
    a_mudf(i,j) = a_mudf(i,j)-a_mudf_xy(i)*emdiv*dx<a name='654'>
    a_mudf_xy(i) = 0.<a name='655'>
  end do<a name='656'>
  do k = k_start, k_end<a name='657'>
    do i = i_start, i_endu<a name='658'>
      a_ru_tend(i,k,j) = a_ru_tend(i,k,j)+a_u(i,k,j)*dts<a name='659'>
    end do<a name='660'>
  end do<a name='661'>
end do<a name='662'>
<a name='663'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_UV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_88">("a_advance_uv")<a name='664'>
<a name='665'>
end subroutine a_advance_uv<a name='666'>
<a name='667'>
<a name='668'>
<A NAME='A_ADVANCE_W'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='669'>
<font color=#993300>subroutine </font><font color=#cc0000>a_advance_w</font>( w, a_w, rw_tend, a_rw_tend, ww, a_ww, u, a_u, v, a_v, mu1, a_mu1, mut, a_mut, muave, a_muave, muts, a_muts,&amp; <A href='../../call_to/A_ADVANCE_W.html' TARGET='index'>2</A>,<A href='../../call_from/A_ADVANCE_W.html' TARGET='index'>2</A><a name='670'>
&amp; t_2ave, a_t_2ave, t_2, a_t_2, t_1, a_t_1, ph, a_ph, ph_1, a_ph_1, phb, ph_tend, a_ph_tend, ht, c2a, a_c2a, cqw, a_cqw, alt, &amp;<a name='671'>
&amp;a_alt, alb, a, a_a, alpha, a_alpha, gamma, a_gamma, rdx, rdy, dts, t0, epssm, fnm, fnp, rdnw, rdn, cf1, cf2, cf3, msft, &amp;<a name='672'>
&amp;config_flags, ids, ide, jds, jde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='673'>
<font color=#447700>!******************************************************************<a name='674'></font>
<font color=#447700>!******************************************************************<a name='675'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='676'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='677'></font>
<font color=#447700>!******************************************************************<a name='678'></font>
<font color=#447700>!******************************************************************<a name='679'></font>
<font color=#447700>!==============================================<a name='680'></font>
<font color=#447700>! all entries are defined explicitly<a name='681'></font>
<font color=#447700>!==============================================<a name='682'></font>
implicit none<a name='683'>
<a name='684'>
<font color=#447700>!==============================================<a name='685'></font>
<font color=#447700>! declare arguments<a name='686'></font>
<font color=#447700>!==============================================<a name='687'></font>
integer, intent(in) :: ime<a name='688'>
integer, intent(in) :: ims<a name='689'>
integer, intent(in) :: jme<a name='690'>
integer, intent(in) :: jms<a name='691'>
integer, intent(in) :: kme<a name='692'>
integer, intent(in) :: kms<a name='693'>
real, intent(in) :: a(ims:ime,kms:kme,jms:jme)<a name='694'>
real, intent(inout) :: a_a(ims:ime,kms:kme,jms:jme)<a name='695'>
real, intent(inout) :: a_alpha(ims:ime,kms:kme,jms:jme)<a name='696'>
real, intent(inout) :: a_alt(ims:ime,kms:kme,jms:jme)<a name='697'>
real, intent(inout) :: a_c2a(ims:ime,kms:kme,jms:jme)<a name='698'>
real, intent(inout) :: a_cqw(ims:ime,kms:kme,jms:jme)<a name='699'>
real, intent(inout) :: a_gamma(ims:ime,kms:kme,jms:jme)<a name='700'>
real, intent(inout) :: a_mu1(ims:ime,jms:jme)<a name='701'>
real, intent(inout) :: a_muave(ims:ime,jms:jme)<a name='702'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='703'>
real, intent(inout) :: a_muts(ims:ime,jms:jme)<a name='704'>
real, intent(inout) :: a_ph(ims:ime,kms:kme,jms:jme)<a name='705'>
real, intent(inout) :: a_ph_1(ims:ime,kms:kme,jms:jme)<a name='706'>
real, intent(inout) :: a_ph_tend(ims:ime,kms:kme,jms:jme)<a name='707'>
real, intent(inout) :: a_rw_tend(ims:ime,kms:kme,jms:jme)<a name='708'>
real, intent(inout) :: a_t_1(ims:ime,kms:kme,jms:jme)<a name='709'>
real, intent(inout) :: a_t_2(ims:ime,kms:kme,jms:jme)<a name='710'>
real, intent(inout) :: a_t_2ave(ims:ime,kms:kme,jms:jme)<a name='711'>
real, intent(inout) :: a_u(ims:ime,kms:kme,jms:jme)<a name='712'>
real, intent(inout) :: a_v(ims:ime,kms:kme,jms:jme)<a name='713'>
real, intent(inout) :: a_w(ims:ime,kms:kme,jms:jme)<a name='714'>
real, intent(inout) :: a_ww(ims:ime,kms:kme,jms:jme)<a name='715'>
real, intent(in) :: alb(ims:ime,kms:kme,jms:jme)<a name='716'>
real, intent(in) :: alpha(ims:ime,kms:kme,jms:jme)<a name='717'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='718'>
real, intent(in) :: c2a(ims:ime,kms:kme,jms:jme)<a name='719'>
real, intent(in) :: cf1<a name='720'>
real, intent(in) :: cf2<a name='721'>
real, intent(in) :: cf3<a name='722'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='723'>
real, intent(in) :: cqw(ims:ime,kms:kme,jms:jme)<a name='724'>
real, intent(in) :: dts<a name='725'>
real, intent(in) :: epssm<a name='726'>
real, intent(in) :: fnm(kms:kme)<a name='727'>
real, intent(in) :: fnp(kms:kme)<a name='728'>
real, intent(in) :: gamma(ims:ime,kms:kme,jms:jme)<a name='729'>
real, intent(in) :: ht(ims:ime,jms:jme)<a name='730'>
integer, intent(in) :: ide<a name='731'>
integer, intent(in) :: ids<a name='732'>
integer, intent(in) :: ite<a name='733'>
integer, intent(in) :: its<a name='734'>
integer, intent(in) :: jde<a name='735'>
integer, intent(in) :: jds<a name='736'>
integer, intent(in) :: jte<a name='737'>
integer, intent(in) :: jts<a name='738'>
integer, intent(in) :: kte<a name='739'>
integer, intent(in) :: kts<a name='740'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='741'>
real, intent(in) :: mu1(ims:ime,jms:jme)<a name='742'>
real, intent(in) :: muave(ims:ime,jms:jme)<a name='743'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='744'>
real, intent(in) :: muts(ims:ime,jms:jme)<a name='745'>
real, intent(inout) :: ph(ims:ime,kms:kme,jms:jme)<a name='746'>
real, intent(in) :: ph_1(ims:ime,kms:kme,jms:jme)<a name='747'>
real, intent(in) :: ph_tend(ims:ime,kms:kme,jms:jme)<a name='748'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='749'>
real, intent(in) :: rdn(kms:kme)<a name='750'>
real, intent(in) :: rdnw(kms:kme)<a name='751'>
real, intent(in) :: rdx<a name='752'>
real, intent(in) :: rdy<a name='753'>
real, intent(in) :: rw_tend(ims:ime,kms:kme,jms:jme)<a name='754'>
real, intent(in) :: t0<a name='755'>
real, intent(in) :: t_1(ims:ime,kms:kme,jms:jme)<a name='756'>
real, intent(in) :: t_2(ims:ime,kms:kme,jms:jme)<a name='757'>
real, intent(inout) :: t_2ave(ims:ime,kms:kme,jms:jme)<a name='758'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='759'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='760'>
real, intent(inout) :: w(ims:ime,kms:kme,jms:jme)<a name='761'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='762'>
<a name='763'>
<font color=#447700>!==============================================<a name='764'></font>
<font color=#447700>! declare local variables<a name='765'></font>
<font color=#447700>!==============================================<a name='766'></font>
real a_mut_inv(its:ite)<a name='767'>
real a_rhs(its:ite,kts:kte)<a name='768'>
real a_wdwn(its:ite,kts:kte)<a name='769'>
integer i<a name='770'>
integer i_end<a name='771'>
integer i_start<a name='772'>
integer j<a name='773'>
integer j_end<a name='774'>
integer j_start<a name='775'>
integer k<a name='776'>
integer k_end<a name='777'>
real msft_inv(its:ite)<a name='778'>
real mut_inv(its:ite)<a name='779'>
real rhs(its:ite,kts:kte)<a name='780'>
real t_2aveh(ims:ime,kms:kme,jms:jme)<a name='781'>
real wdwn(its:ite,kts:kte)<a name='782'>
real wh(ims:ime,kms:kme,jms:jme)<a name='783'>
<font color=#447700>!mzz<a name='784'></font>
real keep1_w(ims:ime,kms:kme,jms:jme)<a name='785'>
real keep2_w(ims:ime,kms:kme,jms:jme)<a name='786'>
real keep3_w(ims:ime,kms:kme,jms:jme)<a name='787'>
<font color=#447700>!mzz<a name='788'></font>
<a name='789'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_89">("a_advance_w")<a name='790'>
<a name='791'>
<font color=#447700>!----------------------------------------------<a name='792'></font>
<font color=#447700>! SAVE REQUIRED INPUT VARIABLES<a name='793'></font>
<font color=#447700>!----------------------------------------------<a name='794'></font>
wh(:,:,:) = w(:,:,:)<a name='795'>
t_2aveh(:,:,:) = t_2ave(:,:,:)<a name='796'>
<a name='797'>
<font color=#447700>!----------------------------------------------<a name='798'></font>
<font color=#447700>! RESET LOCAL ADJOINT VARIABLES<a name='799'></font>
<font color=#447700>!----------------------------------------------<a name='800'></font>
a_mut_inv(:) = 0.<a name='801'>
a_rhs(:,:) = 0.<a name='802'>
a_wdwn(:,:) = 0.<a name='803'>
<a name='804'>
<font color=#447700>!----------------------------------------------<a name='805'></font>
<font color=#447700>! ROUTINE BODY<a name='806'></font>
<font color=#447700>!----------------------------------------------<a name='807'></font>
i_start = its<a name='808'>
<font color=#447700>! recompute : i_start<a name='809'></font>
i_end = ite<a name='810'>
<font color=#447700>! recompute : i_end<a name='811'></font>
j_start = jts<a name='812'>
<font color=#447700>! recompute : j_start<a name='813'></font>
j_end = jte<a name='814'>
<font color=#447700>! recompute : j_end<a name='815'></font>
k_end = kte-1<a name='816'>
<font color=#447700>! recompute : k_end<a name='817'></font>
if (j_end .eq. jde) then<a name='818'>
  j_end = j_end-1<a name='819'>
endif<a name='820'>
<font color=#447700>! recompute : j_end<a name='821'></font>
if (i_end .eq. ide) then<a name='822'>
  i_end = i_end-1<a name='823'>
endif<a name='824'>
<font color=#447700>! recompute : i_end<a name='825'></font>
if ((config_flags%specified .or. config_flags%nested) .and. its .eq. ids) then<a name='826'>
  i_start = i_start+1<a name='827'>
endif<a name='828'>
<font color=#447700>! recompute : i_start<a name='829'></font>
if ((config_flags%specified .or. config_flags%nested) .and. ite .eq. ide) then<a name='830'>
  i_end = i_end-1<a name='831'>
endif<a name='832'>
<font color=#447700>! recompute : i_end<a name='833'></font>
if ((config_flags%specified .or. config_flags%nested) .and. jts .eq. jds) then<a name='834'>
  j_start = j_start+1<a name='835'>
endif<a name='836'>
<font color=#447700>! recompute : j_start<a name='837'></font>
if ((config_flags%specified .or. config_flags%nested) .and. jte .eq. jde) then<a name='838'>
  j_end = j_end-1<a name='839'>
endif<a name='840'>
<font color=#447700>! recompute : j_end<a name='841'></font>
do j = j_start, j_end<a name='842'>
  DO i=i_start, i_end<a name='843'>
    rhs(i,1) = 0.<a name='844'>
  ENDDO<a name='845'>
  do i = i_start, i_end<a name='846'>
    mut_inv(i) = 1./mut(i,j)<a name='847'>
    msft_inv(i) = 1./msft(i,j)<a name='848'>
  end do<a name='849'>
<font color=#447700>! recompute : msft_inv,mut_inv<a name='850'></font>
  do k = 1, k_end<a name='851'>
    do i = i_start, i_end<a name='852'>
      t_2ave(i,k,j) = 0.5*((1.+epssm)*t_2(i,k,j)+(1.-epssm)*t_2ave(i,k,j))<a name='853'>
      t_2ave(i,k,j) = (t_2ave(i,k,j)-mu1(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)))<a name='854'>
    end do<a name='855'>
  end do<a name='856'>
<font color=#447700>! recompute : t_2ave<a name='857'></font>
  do k = 2, k_end+1<a name='858'>
    do i = i_start, i_end<a name='859'>
      wdwn(i,k) = 0.5*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)*(ph_1(i,k,j)-ph_1(i,k-1,j)+phb(i,k,j)-phb(i,k-1,j))<a name='860'>
      rhs(i,k) = dts*(ph_tend(i,k,j)+0.5*g*(1.-epssm)*w(i,k,j))<a name='861'>
    end do<a name='862'>
  end do<a name='863'>
<font color=#447700>! recompute : rhs,wdwn<a name='864'></font>
  do k = 2, k_end<a name='865'>
    do i = i_start, i_end<a name='866'>
      rhs(i,k) = rhs(i,k)-dts*(fnm(k)*wdwn(i,k+1)+fnp(k)*wdwn(i,k))<a name='867'>
    end do<a name='868'>
  end do<a name='869'>
<font color=#447700>! recompute : rhs<a name='870'></font>
  do k = 2, k_end+1<a name='871'>
    do i = i_start, i_end<a name='872'>
      rhs(i,k) = ph(i,k,j)+msft(i,j)*rhs(i,k)*mut_inv(i)<a name='873'>
    end do<a name='874'>
  end do<a name='875'>
<font color=#447700>! recompute : rhs<a name='876'></font>
  do i = i_start, i_end<a name='877'>
    w(i,1,j) = 0.5*rdy*((ht(i,j+1)-ht(i,j))*(cf1*v(i,1,j+1)+cf2*v(i,2,j+1)+cf3*v(i,3,j+1))+(ht(i,j)-ht(i,j-1))*(cf1*v(i,1,j)+cf2*&amp;<a name='878'>
&amp;v(i,2,j)+cf3*v(i,3,j)))+0.5*rdx*((ht(i+1,j)-ht(i,j))*(cf1*u(i+1,1,j)+cf2*u(i+1,2,j)+cf3*u(i+1,3,j))+(ht(i,j)-ht(i-1,j))*(cf1*&amp;<a name='879'>
&amp;u(i,1,j)+cf2*u(i,2,j)+cf3*u(i,3,j)))<a name='880'>
  end do<a name='881'>
<font color=#447700>! recompute : w<a name='882'></font>
  do k = 2, k_end<a name='883'>
    do i = i_start, i_end<a name='884'>
      w(i,k,j) = w(i,k,j)+dts*rw_tend(i,k,j)+msft_inv(i)*cqw(i,k,j)*0.5*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*((1.+epssm)*&amp;<a name='885'>
&amp;(rhs(i,k+1)-rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))-c2a(i,k-1,j)*rdnw(k-1)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-&amp;<a name='886'>
&amp;epssm)*(ph(i,k,j)-ph(i,k-1,j))))+dts*g*msft_inv(i)*(rdn(k)*(c2a(i,k,j)*alt(i,k,j)*t_2ave(i,k,j)-c2a(i,k-1,j)*alt(i,k-1,j)*&amp;<a name='887'>
&amp;t_2ave(i,k-1,j))+(rdn(k)*(c2a(i,k,j)*alb(i,k,j)-c2a(i,k-1,j)*alb(i,k-1,j))*mut_inv(i)-1.)*muave(i,j))<a name='888'>
    end do<a name='889'>
  end do<a name='890'>
<font color=#447700>! recompute : w<a name='891'></font>
  k = k_end+1<a name='892'>
<font color=#447700>! recompute : k<a name='893'></font>
  do i = i_start, i_end<a name='894'>
    w(i,k,j) = w(i,k,j)+dts*rw_tend(i,k,j)+msft_inv(i)*((-(0.5*dts*g*mut_inv(i)*rdnw(k-1)**2*2.*c2a(i,k-1,j)*((1.+epssm)*(rhs(i,k)-&amp;<a name='895'>
&amp;rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)-ph(i,k-1,j)))))-dts*g*(2.*rdnw(k-1)*c2a(i,k-1,j)*alt(i,k-1,j)*t_2ave(i,k-1,j)+(1.+2.*rdnw(k-&amp;<a name='896'>
&amp;1)*c2a(i,k-1,j)*alb(i,k-1,j)*mut_inv(i))*muave(i,j)))<a name='897'>
  end do<a name='898'>
<font color=#447700>! recompute : w<a name='899'></font>
  do k = 2, k_end+1<a name='900'>
    do i = i_start, i_end<a name='901'>
<font color=#447700>!mzz<a name='902'></font>
    keep1_w(i,k-1,j) =w(i,k-1,j)<a name='903'>
    keep2_w(i,k,j) =w(i,k,j)<a name='904'>
<font color=#447700>!mzz<a name='905'></font>
      w(i,k,j) = (w(i,k,j)-a(i,k,j)*w(i,k-1,j))*alpha(i,k,j)<a name='906'>
    end do<a name='907'>
  end do<a name='908'>
<font color=#447700>! recompute : w<a name='909'></font>
  do k = k_end, 2, -1<a name='910'>
    do i = i_start, i_end<a name='911'>
<font color=#447700>!mzz<a name='912'></font>
    keep3_w(i,k+1,j) =w(i,k+1,j)  <a name='913'>
<font color=#447700>!mzz<a name='914'></font>
      w(i,k,j) = w(i,k,j)-gamma(i,k,j)*w(i,k+1,j)<a name='915'>
    end do<a name='916'>
  end do<a name='917'>
<font color=#447700>! recompute : w<a name='918'></font>
  do k = 2, k_end+1<a name='919'>
    do i = i_start, i_end<a name='920'>
      a_muts(i,j) = a_muts(i,j)-a_ph(i,k,j)*(0.5*msft(i,j)*dts*g*(1.+epssm)*w(i,k,j)/(muts(i,j)*muts(i,j)))<a name='921'>
      a_rhs(i,k) = a_rhs(i,k)+a_ph(i,k,j)<a name='922'>
      a_w(i,k,j) = a_w(i,k,j)+a_ph(i,k,j)*(0.5*msft(i,j)*dts*g*(1.+epssm)/muts(i,j))<a name='923'>
      a_ph(i,k,j) = 0.<a name='924'>
    end do<a name='925'>
  end do<a name='926'>
#ifdef ADJOINT_NO_OPTIMIZE<a name='927'>
<font color=#447700>! recdepend vars : cf1,cf2,cf3,ht,i_end,i_start,j,rdx,rdy,u,v<a name='928'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1361<a name='929'></font>
<font color=#447700>! recompute vars : w<a name='930'></font>
<a name='931'>
  do i = i_start, i_end<a name='932'>
    w(i,1,j) = 0.5*rdy*((ht(i,j+1)-ht(i,j))*(cf1*v(i,1,j+1)+cf2*v(i,2,j+1)+cf3*v(i,3,j+1))+(ht(i,j)-ht(i,j-1))*(cf1*v(i,1,j)+cf2*&amp;<a name='933'>
&amp;v(i,2,j)+cf3*v(i,3,j)))+0.5*rdx*((ht(i+1,j)-ht(i,j))*(cf1*u(i+1,1,j)+cf2*u(i+1,2,j)+cf3*u(i+1,3,j))+(ht(i,j)-ht(i-1,j))*(cf1*&amp;<a name='934'>
&amp;u(i,1,j)+cf2*u(i,2,j)+cf3*u(i,3,j)))<a name='935'>
  end do<a name='936'>
<font color=#447700>! recompute vars : w<a name='937'></font>
<font color=#447700>!  recdepend vars : alb,alt,c2a,cqw,dts,epssm,g,i_end,i_start,j,k_end,ms<a name='938'></font>
<font color=#447700>! ft_inv,muave,mut_inv,ph,rdn,rdnw,rhs,rw_tend,t_2ave,w<a name='939'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1382<a name='940'></font>
<font color=#447700>! recompute vars : w<a name='941'></font>
  do k = 2, k_end<a name='942'>
    do i = i_start, i_end<a name='943'>
      w(i,k,j) = w(i,k,j)+dts*rw_tend(i,k,j)+msft_inv(i)*cqw(i,k,j)*0.5*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*((1.+epssm)*&amp;<a name='944'>
&amp;(rhs(i,k+1)-rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))-c2a(i,k-1,j)*rdnw(k-1)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-&amp;<a name='945'>
&amp;epssm)*(ph(i,k,j)-ph(i,k-1,j))))+dts*g*msft_inv(i)*(rdn(k)*(c2a(i,k,j)*alt(i,k,j)*t_2ave(i,k,j)-c2a(i,k-1,j)*alt(i,k-1,j)*&amp;<a name='946'>
&amp;t_2ave(i,k-1,j))+(rdn(k)*(c2a(i,k,j)*alb(i,k,j)-c2a(i,k-1,j)*alb(i,k-1,j))*mut_inv(i)-1.)*muave(i,j))<a name='947'>
    end do<a name='948'>
  end do<a name='949'>
<font color=#447700>! recompute vars : w<a name='950'></font>
<font color=#447700>! recdepend vars : k_end,w<a name='951'></font>
<font color=#447700>! recompute pos : ASSIGN_STMT module_small_step_em.f90:1404<a name='952'></font>
<font color=#447700>! recompute vars : k<a name='953'></font>
  k = k_end+1<a name='954'>
<font color=#447700>! recompute vars : k<a name='955'></font>
<font color=#447700>!  recdepend vars : alb,alt,c2a,dts,epssm,g,i_end,i_start,j,k,msft_inv,m<a name='956'></font>
<font color=#447700>! uave,mut_inv,ph,rdnw,rhs,rw_tend,t_2ave,w<a name='957'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1406<a name='958'></font>
<font color=#447700>! recompute vars : w<a name='959'></font>
  do i = i_start, i_end<a name='960'>
    w(i,k,j) = w(i,k,j)+dts*rw_tend(i,k,j)+msft_inv(i)*((-(0.5*dts*g*mut_inv(i)*rdnw(k-1)**2*2.*c2a(i,k-1,j)*((1.+epssm)*(rhs(i,k)-&amp;<a name='961'>
&amp;rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)-ph(i,k-1,j)))))-dts*g*(2.*rdnw(k-1)*c2a(i,k-1,j)*alt(i,k-1,j)*t_2ave(i,k-1,j)+(1.+2.*rdnw(k-&amp;<a name='962'>
&amp;1)*c2a(i,k-1,j)*alb(i,k-1,j)*mut_inv(i))*muave(i,j)))<a name='963'>
  end do<a name='964'>
<font color=#447700>! recompute vars : w<a name='965'></font>
<font color=#447700>! recdepend vars : a,alpha,i_end,i_start,j,k_end,w<a name='966'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1418<a name='967'></font>
<font color=#447700>! recompute vars : w<a name='968'></font>
  do k = 2, k_end+1<a name='969'>
    do i = i_start, i_end<a name='970'>
      w(i,k,j) = (w(i,k,j)-a(i,k,j)*w(i,k-1,j))*alpha(i,k,j)<a name='971'>
    end do<a name='972'>
  end do<a name='973'>
<font color=#447700>! recompute vars : w<a name='974'></font>
  do k = k_end, 3, -1<a name='975'>
    do i = i_start, i_end<a name='976'>
      w(i,k,j) = w(i,k,j)-gamma(i,k,j)*w(i,k+1,j)<a name='977'>
    end do<a name='978'>
  end do<a name='979'>
#endif<a name='980'>
  do k = 2, k_end<a name='981'>
    do i = i_start, i_end<a name='982'>
<font color=#447700>!mzz<a name='983'></font>
    w(i,k+1,j) =keep3_w(i,k+1,j)  <a name='984'>
<font color=#447700>!mzz<a name='985'></font>
      a_gamma(i,k,j) = a_gamma(i,k,j)-a_w(i,k,j)*w(i,k+1,j)<a name='986'>
      a_w(i,k+1,j) = a_w(i,k+1,j)-a_w(i,k,j)*gamma(i,k,j)<a name='987'>
    end do<a name='988'>
  end do<a name='989'>
#ifdef ADJOINT_NO_OPTIMIZE<a name='990'>
<font color=#447700>! recdepend vars : cf1,cf2,cf3,ht,i_end,i_start,j,rdx,rdy,u,v<a name='991'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1361<a name='992'></font>
<font color=#447700>! recompute vars : w<a name='993'></font>
  do i = i_start, i_end<a name='994'>
    w(i,1,j) = 0.5*rdy*((ht(i,j+1)-ht(i,j))*(cf1*v(i,1,j+1)+cf2*v(i,2,j+1)+cf3*v(i,3,j+1))+(ht(i,j)-ht(i,j-1))*(cf1*v(i,1,j)+cf2*&amp;<a name='995'>
&amp;v(i,2,j)+cf3*v(i,3,j)))+0.5*rdx*((ht(i+1,j)-ht(i,j))*(cf1*u(i+1,1,j)+cf2*u(i+1,2,j)+cf3*u(i+1,3,j))+(ht(i,j)-ht(i-1,j))*(cf1*&amp;<a name='996'>
&amp;u(i,1,j)+cf2*u(i,2,j)+cf3*u(i,3,j)))<a name='997'>
  end do<a name='998'>
<font color=#447700>! recompute vars : w<a name='999'></font>
<font color=#447700>!  recdepend vars : alb,alt,c2a,cqw,dts,epssm,g,i_end,i_start,j,k_end,ms<a name='1000'></font>
<font color=#447700>! ft_inv,muave,mut_inv,ph,rdn,rdnw,rhs,rw_tend,t_2ave,w<a name='1001'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1382<a name='1002'></font>
<font color=#447700>! recompute vars : w<a name='1003'></font>
  do k = 2, k_end<a name='1004'>
    do i = i_start, i_end<a name='1005'>
      w(i,k,j) = w(i,k,j)+dts*rw_tend(i,k,j)+msft_inv(i)*cqw(i,k,j)*0.5*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*((1.+epssm)*&amp;<a name='1006'>
&amp;(rhs(i,k+1)-rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))-c2a(i,k-1,j)*rdnw(k-1)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-&amp;<a name='1007'>
&amp;epssm)*(ph(i,k,j)-ph(i,k-1,j))))+dts*g*msft_inv(i)*(rdn(k)*(c2a(i,k,j)*alt(i,k,j)*t_2ave(i,k,j)-c2a(i,k-1,j)*alt(i,k-1,j)*&amp;<a name='1008'>
&amp;t_2ave(i,k-1,j))+(rdn(k)*(c2a(i,k,j)*alb(i,k,j)-c2a(i,k-1,j)*alb(i,k-1,j))*mut_inv(i)-1.)*muave(i,j))<a name='1009'>
    end do<a name='1010'>
  end do<a name='1011'>
<font color=#447700>! recompute vars : w<a name='1012'></font>
<font color=#447700>! recdepend vars : k_end,w<a name='1013'></font>
<font color=#447700>! recompute pos : ASSIGN_STMT module_small_step_em.f90:1404<a name='1014'></font>
<font color=#447700>! recompute vars : k<a name='1015'></font>
  k = k_end+1<a name='1016'>
<font color=#447700>! recompute vars : k<a name='1017'></font>
<font color=#447700>!  recdepend vars : alb,alt,c2a,dts,epssm,g,i_end,i_start,j,k,msft_inv,m<a name='1018'></font>
<font color=#447700>! uave,mut_inv,ph,rdnw,rhs,rw_tend,t_2ave,w<a name='1019'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1406<a name='1020'></font>
<font color=#447700>! recompute vars : w<a name='1021'></font>
  do i = i_start, i_end<a name='1022'>
    w(i,k,j) = w(i,k,j)+dts*rw_tend(i,k,j)+msft_inv(i)*((-(0.5*dts*g*mut_inv(i)*rdnw(k-1)**2*2.*c2a(i,k-1,j)*((1.+epssm)*(rhs(i,k)-&amp;<a name='1023'>
&amp;rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)-ph(i,k-1,j)))))-dts*g*(2.*rdnw(k-1)*c2a(i,k-1,j)*alt(i,k-1,j)*t_2ave(i,k-1,j)+(1.+2.*rdnw(k-&amp;<a name='1024'>
&amp;1)*c2a(i,k-1,j)*alb(i,k-1,j)*mut_inv(i))*muave(i,j)))<a name='1025'>
  end do<a name='1026'>
<font color=#447700>! recompute vars : w<a name='1027'></font>
  do k = 2, k_end<a name='1028'>
    do i = i_start, i_end<a name='1029'>
      w(i,k,j) = (w(i,k,j)-a(i,k,j)*w(i,k-1,j))*alpha(i,k,j)<a name='1030'>
    end do<a name='1031'>
  end do<a name='1032'>
#endif<a name='1033'>
  do k = k_end+1, 2, -1<a name='1034'>
    do i = i_start, i_end<a name='1035'>
<font color=#447700>!mzz<a name='1036'></font>
     w(i,k-1,j)=keep1_w(i,k-1,j) <a name='1037'>
     w(i,k,j)=keep2_w(i,k,j) <a name='1038'>
<font color=#447700>!mzz<a name='1039'></font>
      a_a(i,k,j) = a_a(i,k,j)-a_w(i,k,j)*w(i,k-1,j)*alpha(i,k,j)<a name='1040'>
      a_alpha(i,k,j) = a_alpha(i,k,j)+a_w(i,k,j)*(w(i,k,j)-a(i,k,j)*w(i,k-1,j))<a name='1041'>
      a_w(i,k-1,j) = a_w(i,k-1,j)-a_w(i,k,j)*a(i,k,j)*alpha(i,k,j)<a name='1042'>
      a_w(i,k,j) = a_w(i,k,j)*alpha(i,k,j)<a name='1043'>
    end do<a name='1044'>
  end do<a name='1045'>
<a name='1046'>
<font color=#447700>! recdepend vars : k_end<a name='1047'></font>
<font color=#447700>! recompute pos : ASSIGN_STMT module_small_step_em.f90:1404<a name='1048'></font>
<font color=#447700>! recompute vars : k<a name='1049'></font>
  k = k_end+1<a name='1050'>
<font color=#447700>! recompute vars : k<a name='1051'></font>
  do i = i_start, i_end<a name='1052'>
    a_alt(i,k-1,j) = a_alt(i,k-1,j)-2*a_w(i,k,j)*msft_inv(i)*dts*g*rdnw(k-1)*c2a(i,k-1,j)*t_2ave(i,k-1,j)<a name='1053'>
    a_c2a(i,k-1,j) = a_c2a(i,k-1,j)-a_w(i,k,j)*msft_inv(i)*dts*g*(mut_inv(i)*rdnw(k-1)**2*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-&amp;<a name='1054'>
&amp;epssm)*(ph(i,k,j)-ph(i,k-1,j)))+2*rdnw(k-1)*alt(i,k-1,j)*t_2ave(i,k-1,j)+2*rdnw(k-1)*alb(i,k-1,j)*mut_inv(i)*muave(i,j))<a name='1055'>
    a_muave(i,j) = a_muave(i,j)-a_w(i,k,j)*msft_inv(i)*dts*g*(1+2.*rdnw(k-1)*c2a(i,k-1,j)*alb(i,k-1,j)*mut_inv(i))<a name='1056'>
    a_mut_inv(i) = a_mut_inv(i)-a_w(i,k,j)*msft_inv(i)*(dts*g*rdnw(k-1)**2*c2a(i,k-1,j)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-&amp;<a name='1057'>
&amp;epssm)*(ph(i,k,j)-ph(i,k-1,j)))+2*dts*g*rdnw(k-1)*c2a(i,k-1,j)*alb(i,k-1,j)*muave(i,j))<a name='1058'>
    a_ph(i,k-1,j) = a_ph(i,k-1,j)+a_w(i,k,j)*msft_inv(i)*dts*g*mut_inv(i)*rdnw(k-1)**2*c2a(i,k-1,j)*(1.-epssm)<a name='1059'>
    a_ph(i,k,j) = a_ph(i,k,j)-a_w(i,k,j)*msft_inv(i)*dts*g*mut_inv(i)*rdnw(k-1)**2*c2a(i,k-1,j)*(1.-epssm)<a name='1060'>
    a_rhs(i,k-1) = a_rhs(i,k-1)+a_w(i,k,j)*msft_inv(i)*dts*g*mut_inv(i)*rdnw(k-1)**2*c2a(i,k-1,j)*(1.+epssm)<a name='1061'>
    a_rhs(i,k) = a_rhs(i,k)-a_w(i,k,j)*msft_inv(i)*dts*g*mut_inv(i)*rdnw(k-1)**2*c2a(i,k-1,j)*(1+epssm)<a name='1062'>
    a_rw_tend(i,k,j) = a_rw_tend(i,k,j)+a_w(i,k,j)*dts<a name='1063'>
    a_t_2ave(i,k-1,j) = a_t_2ave(i,k-1,j)-2*a_w(i,k,j)*msft_inv(i)*dts*g*rdnw(k-1)*c2a(i,k-1,j)*alt(i,k-1,j)<a name='1064'>
  end do<a name='1065'>
  do k = 2, k_end<a name='1066'>
    do i = i_start, i_end<a name='1067'>
      a_alt(i,k-1,j) = a_alt(i,k-1,j)-a_w(i,k,j)*dts*g*msft_inv(i)*rdn(k)*c2a(i,k-1,j)*t_2ave(i,k-1,j)<a name='1068'>
      a_alt(i,k,j) = a_alt(i,k,j)+a_w(i,k,j)*dts*g*msft_inv(i)*rdn(k)*c2a(i,k,j)*t_2ave(i,k,j)<a name='1069'>
      a_c2a(i,k-1,j) = a_c2a(i,k-1,j)+a_w(i,k,j)*((-(0.5*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*rdnw(k-1)*((1.+epssm)*&amp;<a name='1070'>
&amp;(rhs(i,k)-rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)-ph(i,k-1,j)))))+dts*g*msft_inv(i)*((-(rdn(k)*alt(i,k-1,j)*t_2ave(i,k-1,j)))-&amp;<a name='1071'>
&amp;rdn(k)*alb(i,k-1,j)*mut_inv(i)*muave(i,j)))<a name='1072'>
      a_c2a(i,k,j) = a_c2a(i,k,j)+a_w(i,k,j)*(0.5*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*rdnw(k)*((1.+epssm)*(rhs(i,k+1)-&amp;<a name='1073'>
&amp;rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))+dts*g*msft_inv(i)*rdn(k)*(alt(i,k,j)*t_2ave(i,k,j)+alb(i,k,j)*mut_inv(i)*muave(i,j)))<a name='1074'>
      a_cqw(i,k,j) = a_cqw(i,k,j)+0.5*a_w(i,k,j)*msft_inv(i)*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*((1.+epssm)*(rhs(i,k+1)-&amp;<a name='1075'>
&amp;rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))-c2a(i,k-1,j)*rdnw(k-1)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)&amp;<a name='1076'>
&amp;-ph(i,k-1,j))))<a name='1077'>
      a_muave(i,j) = a_muave(i,j)+a_w(i,k,j)*dts*g*msft_inv(i)*((-1)+rdn(k)*(c2a(i,k,j)*alb(i,k,j)-c2a(i,k-1,j)*alb(i,k-1,j))*&amp;<a name='1078'>
&amp;mut_inv(i))<a name='1079'>
      a_mut_inv(i) = a_mut_inv(i)+a_w(i,k,j)*(0.5*msft_inv(i)*cqw(i,k,j)*dts*g*rdn(k)*(c2a(i,k,j)*rdnw(k)*((1.+epssm)*(rhs(i,k+1)-&amp;<a name='1080'>
&amp;rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))-c2a(i,k-1,j)*rdnw(k-1)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)&amp;<a name='1081'>
&amp;-ph(i,k-1,j))))+dts*g*msft_inv(i)*rdn(k)*(c2a(i,k,j)*alb(i,k,j)-c2a(i,k-1,j)*alb(i,k-1,j))*muave(i,j))<a name='1082'>
      a_ph(i,k-1,j) = a_ph(i,k-1,j)+0.5*a_w(i,k,j)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*c2a(i,k-1,j)*rdnw(k-1)*(1.-epssm)<a name='1083'>
      a_ph(i,k+1,j) = a_ph(i,k+1,j)+0.5*a_w(i,k,j)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*c2a(i,k,j)*rdnw(k)*(1.-epssm)<a name='1084'>
      a_ph(i,k,j) = a_ph(i,k,j)-0.5*a_w(i,k,j)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*(1.-epssm)+c2a(i,&amp;<a name='1085'>
&amp;k-1,j)*rdnw(k-1)*(1.-epssm))<a name='1086'>
      a_rhs(i,k-1) = a_rhs(i,k-1)+0.5*a_w(i,k,j)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*c2a(i,k-1,j)*rdnw(k-1)*(1.+epssm)<a name='1087'>
      a_rhs(i,k+1) = a_rhs(i,k+1)+0.5*a_w(i,k,j)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*c2a(i,k,j)*rdnw(k)*(1+epssm)<a name='1088'>
      a_rhs(i,k) = a_rhs(i,k)-0.5*a_w(i,k,j)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*(1.+epssm)+c2a(i,k-&amp;<a name='1089'>
&amp;1,j)*rdnw(k-1)*(1+epssm))<a name='1090'>
      a_rw_tend(i,k,j) = a_rw_tend(i,k,j)+a_w(i,k,j)*dts<a name='1091'>
      a_t_2ave(i,k-1,j) = a_t_2ave(i,k-1,j)-a_w(i,k,j)*dts*g*msft_inv(i)*rdn(k)*c2a(i,k-1,j)*alt(i,k-1,j)<a name='1092'>
      a_t_2ave(i,k,j) = a_t_2ave(i,k,j)+a_w(i,k,j)*dts*g*msft_inv(i)*rdn(k)*c2a(i,k,j)*alt(i,k,j)<a name='1093'>
    end do<a name='1094'>
  end do<a name='1095'>
  do i = i_start, i_end<a name='1096'>
    a_u(i+1,3,j) = a_u(i+1,3,j)+0.5*a_w(i,1,j)*rdx*(ht(i+1,j)-ht(i,j))*cf3<a name='1097'>
    a_u(i,3,j) = a_u(i,3,j)+0.5*a_w(i,1,j)*rdx*(ht(i,j)-ht(i-1,j))*cf3<a name='1098'>
    a_u(i+1,2,j) = a_u(i+1,2,j)+0.5*a_w(i,1,j)*rdx*(ht(i+1,j)-ht(i,j))*cf2<a name='1099'>
    a_u(i,2,j) = a_u(i,2,j)+0.5*a_w(i,1,j)*rdx*(ht(i,j)-ht(i-1,j))*cf2<a name='1100'>
    a_u(i+1,1,j) = a_u(i+1,1,j)+0.5*a_w(i,1,j)*rdx*(ht(i+1,j)-ht(i,j))*cf1<a name='1101'>
    a_u(i,1,j) = a_u(i,1,j)+0.5*a_w(i,1,j)*rdx*(ht(i,j)-ht(i-1,j))*cf1<a name='1102'>
    a_v(i,3,j+1) = a_v(i,3,j+1)+0.5*a_w(i,1,j)*rdy*(ht(i,j+1)-ht(i,j))*cf3<a name='1103'>
    a_v(i,3,j) = a_v(i,3,j)+0.5*a_w(i,1,j)*rdy*(ht(i,j)-ht(i,j-1))*cf3<a name='1104'>
    a_v(i,2,j+1) = a_v(i,2,j+1)+0.5*a_w(i,1,j)*rdy*(ht(i,j+1)-ht(i,j))*cf2<a name='1105'>
    a_v(i,2,j) = a_v(i,2,j)+0.5*a_w(i,1,j)*rdy*(ht(i,j)-ht(i,j-1))*cf2<a name='1106'>
    a_v(i,1,j+1) = a_v(i,1,j+1)+0.5*a_w(i,1,j)*rdy*(ht(i,j+1)-ht(i,j))*cf1<a name='1107'>
    a_v(i,1,j) = a_v(i,1,j)+0.5*a_w(i,1,j)*rdy*(ht(i,j)-ht(i,j-1))*cf1<a name='1108'>
    a_w(i,1,j) = 0.<a name='1109'>
  end do<a name='1110'>
  w(:,:,:) = wh(:,:,:)<a name='1111'>
<font color=#447700>! recdepend vars : dts,epssm,g,i_end,i_start,j,k_end,ph_tend,w<a name='1112'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1335<a name='1113'></font>
<font color=#447700>! recompute vars : rhs<a name='1114'></font>
  do k = 2, k_end+1<a name='1115'>
    do i = i_start, i_end<a name='1116'>
      rhs(i,k) = dts*(ph_tend(i,k,j)+0.5*g*(1.-epssm)*w(i,k,j))<a name='1117'>
    end do<a name='1118'>
  end do<a name='1119'>
<font color=#447700>! recompute vars : rhs<a name='1120'></font>
<font color=#447700>! recdepend vars : dts,fnm,fnp,i_end,i_start,k_end,rhs,wdwn<a name='1121'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:1343<a name='1122'></font>
<font color=#447700>! recompute vars : rhs<a name='1123'></font>
  do k = 2, k_end<a name='1124'>
    do i = i_start, i_end<a name='1125'>
      rhs(i,k) = rhs(i,k)-dts*(fnm(k)*wdwn(i,k+1)+fnp(k)*wdwn(i,k))<a name='1126'>
    end do<a name='1127'>
  end do<a name='1128'>
<font color=#447700>! recompute vars : rhs<a name='1129'></font>
  do k = 2, k_end+1<a name='1130'>
    do i = i_start, i_end<a name='1131'>
      a_mut_inv(i) = a_mut_inv(i)+a_rhs(i,k)*msft(i,j)*rhs(i,k)<a name='1132'>
      a_ph(i,k,j) = a_ph(i,k,j)+a_rhs(i,k)<a name='1133'>
      a_rhs(i,k) = a_rhs(i,k)*msft(i,j)*mut_inv(i)<a name='1134'>
    end do<a name='1135'>
  end do<a name='1136'>
  do k = 2, k_end<a name='1137'>
    do i = i_start, i_end<a name='1138'>
      a_wdwn(i,k+1) = a_wdwn(i,k+1)-a_rhs(i,k)*dts*fnm(k)<a name='1139'>
      a_wdwn(i,k) = a_wdwn(i,k)-a_rhs(i,k)*dts*fnp(k)<a name='1140'>
    end do<a name='1141'>
  end do<a name='1142'>
  do k = 2, k_end+1<a name='1143'>
    do i = i_start, i_end<a name='1144'>
      a_ph_tend(i,k,j) = a_ph_tend(i,k,j)+a_rhs(i,k)*dts<a name='1145'>
      a_w(i,k,j) = a_w(i,k,j)+0.5*a_rhs(i,k)*dts*g*(1.-epssm)<a name='1146'>
      a_rhs(i,k) = 0.<a name='1147'>
      a_ph_1(i,k-1,j) = a_ph_1(i,k-1,j)-0.5*a_wdwn(i,k)*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)<a name='1148'>
      a_ph_1(i,k,j) = a_ph_1(i,k,j)+0.5*a_wdwn(i,k)*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)<a name='1149'>
      a_ww(i,k-1,j) = a_ww(i,k-1,j)+0.5*a_wdwn(i,k)*rdnw(k-1)*(ph_1(i,k,j)-ph_1(i,k-1,j)+phb(i,k,j)-phb(i,k-1,j))<a name='1150'>
      a_ww(i,k,j) = a_ww(i,k,j)+0.5*a_wdwn(i,k)*rdnw(k-1)*(ph_1(i,k,j)-ph_1(i,k-1,j)+phb(i,k,j)-phb(i,k-1,j))<a name='1151'>
      a_wdwn(i,k) = 0.<a name='1152'>
    end do<a name='1153'>
  end do<a name='1154'>
  t_2ave(:,:,:) = t_2aveh(:,:,:)<a name='1155'>
  do k = 1, k_end<a name='1156'>
    do i = i_start, i_end<a name='1157'>
      t_2ave(i,k,j) = 0.5*((1.+epssm)*t_2(i,k,j)+(1.-epssm)*t_2ave(i,k,j))<a name='1158'>
<font color=#447700>! recompute : t_2ave<a name='1159'></font>
      a_mu1(i,j) = a_mu1(i,j)-a_t_2ave(i,k,j)*(t_1(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1160'>
      a_muts(i,j) = a_muts(i,j)-a_t_2ave(i,k,j)*((t_2ave(i,k,j)-mu1(i,j)*t_1(i,k,j))*(t0+t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j))*&amp;<a name='1161'>
&amp;muts(i,j)*(t0+t_1(i,k,j))))<a name='1162'>
      a_t_1(i,k,j) = a_t_1(i,k,j)-a_t_2ave(i,k,j)*(mu1(i,j)/(muts(i,j)*(t0+t_1(i,k,j)))+(t_2ave(i,k,j)-mu1(i,j)*t_1(i,k,j))*muts(i,&amp;<a name='1163'>
&amp;j)/(muts(i,j)*(t0+t_1(i,k,j))*muts(i,j)*(t0+t_1(i,k,j))))<a name='1164'>
      a_t_2ave(i,k,j) = a_t_2ave(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j)))<a name='1165'>
      a_t_2(i,k,j) = a_t_2(i,k,j)+0.5*a_t_2ave(i,k,j)*(1+epssm)<a name='1166'>
      a_t_2ave(i,k,j) = 0.5*a_t_2ave(i,k,j)*(1.-epssm)<a name='1167'>
    end do<a name='1168'>
  end do<a name='1169'>
  do i = i_start, i_end<a name='1170'>
    a_mut(i,j) = a_mut(i,j)-a_mut_inv(i)/(mut(i,j)*mut(i,j))<a name='1171'>
    a_mut_inv(i) = 0.<a name='1172'>
  end do<a name='1173'>
end do<a name='1174'>
<a name='1175'>
<font color=#447700>!----------------------------------------------<a name='1176'></font>
<font color=#447700>! FREE DYNAMIC MEMORY<a name='1177'></font>
<font color=#447700>!----------------------------------------------<a name='1178'></font>
<a name='1179'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_89">("a_advance_w")<a name='1180'>
<a name='1181'>
end subroutine a_advance_w<a name='1182'>
<a name='1183'>
<a name='1184'>
<A NAME='A_CALC_COEF_W'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_COEF_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1185'>
<font color=#993300>subroutine </font><font color=#cc0000>a_calc_coef_w</font>( a, a_a, alpha, a_alpha, gamma, a_gamma, mut, a_mut, cqw, a_cqw, rdn, rdnw, c2a, a_c2a, dts, g, epssm, &amp; <A href='../../call_to/A_CALC_COEF_W.html' TARGET='index'>2</A>,<A href='../../call_from/A_CALC_COEF_W.html' TARGET='index'>2</A><a name='1186'>
&amp;ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte )<a name='1187'>
<font color=#447700>!******************************************************************<a name='1188'></font>
<font color=#447700>!******************************************************************<a name='1189'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1190'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1191'></font>
<font color=#447700>!******************************************************************<a name='1192'></font>
<font color=#447700>!******************************************************************<a name='1193'></font>
<font color=#447700>!==============================================<a name='1194'></font>
<font color=#447700>! all entries are defined explicitly<a name='1195'></font>
<font color=#447700>!==============================================<a name='1196'></font>
implicit none<a name='1197'>
<a name='1198'>
<font color=#447700>!==============================================<a name='1199'></font>
<font color=#447700>! declare arguments<a name='1200'></font>
<font color=#447700>!==============================================<a name='1201'></font>
integer, intent(in) :: ime<a name='1202'>
integer, intent(in) :: ims<a name='1203'>
integer, intent(in) :: jme<a name='1204'>
integer, intent(in) :: jms<a name='1205'>
integer, intent(in) :: kme<a name='1206'>
integer, intent(in) :: kms<a name='1207'>
real, intent(inout) :: a(ims:ime,kms:kme,jms:jme)<a name='1208'>
real, intent(inout) :: a_a(ims:ime,kms:kme,jms:jme)<a name='1209'>
real, intent(inout) :: a_alpha(ims:ime,kms:kme,jms:jme)<a name='1210'>
real, intent(inout) :: a_c2a(ims:ime,kms:kme,jms:jme)<a name='1211'>
real, intent(inout) :: a_cqw(ims:ime,kms:kme,jms:jme)<a name='1212'>
real, intent(inout) :: a_gamma(ims:ime,kms:kme,jms:jme)<a name='1213'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='1214'>
real, intent(inout) :: alpha(ims:ime,kms:kme,jms:jme)<a name='1215'>
real, intent(in) :: c2a(ims:ime,kms:kme,jms:jme)<a name='1216'>
real, intent(in) :: cqw(ims:ime,kms:kme,jms:jme)<a name='1217'>
real, intent(in) :: dts<a name='1218'>
real, intent(in) :: epssm<a name='1219'>
real, intent(in) :: g<a name='1220'>
real, intent(inout) :: gamma(ims:ime,kms:kme,jms:jme)<a name='1221'>
integer, intent(in) :: ide<a name='1222'>
integer, intent(in) :: ite<a name='1223'>
integer, intent(in) :: its<a name='1224'>
integer, intent(in) :: jde<a name='1225'>
integer, intent(in) :: jte<a name='1226'>
integer, intent(in) :: jts<a name='1227'>
integer, intent(in) :: kde<a name='1228'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='1229'>
real, intent(in) :: rdn(kms:kme)<a name='1230'>
real, intent(in) :: rdnw(kms:kme)<a name='1231'>
<a name='1232'>
<font color=#447700>!==============================================<a name='1233'></font>
<font color=#447700>! declare local variables<a name='1234'></font>
<font color=#447700>!==============================================<a name='1235'></font>
real a_b<a name='1236'>
real a_c<a name='1237'>
real a_cof(ims:ime)<a name='1238'>
real b<a name='1239'>
real c<a name='1240'>
real cof(ims:ime)<a name='1241'>
integer i<a name='1242'>
integer i_end<a name='1243'>
integer i_start<a name='1244'>
integer j<a name='1245'>
integer j_end<a name='1246'>
integer j_start<a name='1247'>
integer k<a name='1248'>
integer k1<a name='1249'>
<a name='1250'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_COEF_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_90">("a_calc_coef_w")<a name='1251'>
<a name='1252'>
<font color=#447700>!----------------------------------------------<a name='1253'></font>
<font color=#447700>! RESET LOCAL ADJOINT VARIABLES<a name='1254'></font>
<font color=#447700>!----------------------------------------------<a name='1255'></font>
a_b = 0.<a name='1256'>
a_c = 0.<a name='1257'>
a_cof(:) = 0.<a name='1258'>
<a name='1259'>
<font color=#447700>!----------------------------------------------<a name='1260'></font>
<font color=#447700>! ROUTINE BODY<a name='1261'></font>
<font color=#447700>!----------------------------------------------<a name='1262'></font>
i_start = its<a name='1263'>
<font color=#447700>! recompute : i_start<a name='1264'></font>
i_end = ite<a name='1265'>
<font color=#447700>! recompute : i_end<a name='1266'></font>
j_start = jts<a name='1267'>
<font color=#447700>! recompute : j_start<a name='1268'></font>
j_end = jte<a name='1269'>
<font color=#447700>! recompute : j_end<a name='1270'></font>
if (j_end .eq. jde) then<a name='1271'>
  j_end = j_end-1<a name='1272'>
endif<a name='1273'>
<font color=#447700>! recompute : j_end<a name='1274'></font>
if (i_end .eq. ide) then<a name='1275'>
  i_end = i_end-1<a name='1276'>
endif<a name='1277'>
<font color=#447700>! recompute : i_end<a name='1278'></font>
do j = j_start, j_end<a name='1279'>
  a_b = 0.<a name='1280'>
  a_c = 0.<a name='1281'>
  do i = i_start, i_end<a name='1282'>
    cof(i) = (0.5*dts*g*(1.+epssm)/mut(i,j))**2<a name='1283'>
    a(i,2,j) = 0.<a name='1284'>
    a(i,kde,j) = -(2.*cof(i)*rdnw(kde-1)**2*c2a(i,kde-1,j))<a name='1285'>
    gamma(i,1,j) = 0.<a name='1286'>
  end do<a name='1287'>
<font color=#447700>! recompute : cof,gamma<a name='1288'></font>
  do k = 3, kde-1<a name='1289'>
    do i = i_start, i_end<a name='1290'>
      a(i,k,j) = -(cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k-1)*c2a(i,k-1,j))<a name='1291'>
    end do<a name='1292'>
  end do<a name='1293'>
<font color=#447700>! recompute : a<a name='1294'></font>
  do k = 2, kde-1<a name='1295'>
    do i = i_start, i_end<a name='1296'>
      b = 1.+cqw(i,k,j)*cof(i)*rdn(k)*(rdnw(k)*c2a(i,k,j)+rdnw(k-1)*c2a(i,k-1,j))<a name='1297'>
      c = -(cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k)*c2a(i,k,j))<a name='1298'>
      alpha(i,k,j) = 1./(b-a(i,k,j)*gamma(i,k-1,j))<a name='1299'>
      gamma(i,k,j) = c*alpha(i,k,j)<a name='1300'>
    end do<a name='1301'>
  end do<a name='1302'>
<font color=#447700>! recompute : gamma<a name='1303'></font>
  do i = i_start, i_end<a name='1304'>
    a_b = 0.<a name='1305'>
    a_c = 0.<a name='1306'>
    b = 1.+2.*cof(i)*rdnw(kde-1)**2*c2a(i,kde-1,j)<a name='1307'>
<font color=#447700>! recompute : b<a name='1308'></font>
    c = 0.<a name='1309'>
<font color=#447700>! recompute : c<a name='1310'></font>
    alpha(i,kde,j) = 1./(b-a(i,kde,j)*gamma(i,kde-1,j))<a name='1311'>
<font color=#447700>! recompute : alpha<a name='1312'></font>
    a_alpha(i,kde,j) = a_alpha(i,kde,j)+a_gamma(i,kde,j)*c<a name='1313'>
    a_c = a_c+a_gamma(i,kde,j)*alpha(i,kde,j)<a name='1314'>
    a_gamma(i,kde,j) = 0.<a name='1315'>
    a_a(i,kde,j) = a_a(i,kde,j)+a_alpha(i,kde,j)*(1.*gamma(i,kde-1,j)/((b-a(i,kde,j)*gamma(i,kde-1,j))*(b-a(i,kde,j)*gamma(i,kde-1,&amp;<a name='1316'>
&amp;j))))<a name='1317'>
    a_b = a_b-a_alpha(i,kde,j)/((b-a(i,kde,j)*gamma(i,kde-1,j))*(b-a(i,kde,j)*gamma(i,kde-1,j)))<a name='1318'>
    a_gamma(i,kde-1,j) = a_gamma(i,kde-1,j)+a_alpha(i,kde,j)*(1.*a(i,kde,j)/((b-a(i,kde,j)*gamma(i,kde-1,j))*(b-a(i,kde,j)*gamma(i,&amp;<a name='1319'>
&amp;kde-1,j))))<a name='1320'>
    a_alpha(i,kde,j) = 0.<a name='1321'>
    a_c = 0.<a name='1322'>
    a_c2a(i,kde-1,j) = a_c2a(i,kde-1,j)+2*a_b*cof(i)*rdnw(kde-1)**2<a name='1323'>
    a_cof(i) = a_cof(i)+2*a_b*rdnw(kde-1)**2*c2a(i,kde-1,j)<a name='1324'>
    a_b = 0.<a name='1325'>
  end do<a name='1326'>
  do k = kde-1, 2, -1<a name='1327'>
<font color=#447700>! recdepend vars : i_end,i_start,j<a name='1328'></font>
<font color=#447700>! recompute pos : DOLOOP_STMT module_small_step_em.f90:658<a name='1329'></font>
<font color=#447700>! recompute vars : gamma<a name='1330'></font>
    do i = i_start, i_end<a name='1331'>
      gamma(i,1,j) = 0.<a name='1332'>
    end do<a name='1333'>
<font color=#447700>! recompute vars : gamma<a name='1334'></font>
    do k1 = 2, k-1<a name='1335'>
      do i = i_start, i_end<a name='1336'>
        b = 1.+cqw(i,k1,j)*cof(i)*rdn(k1)*(rdnw(k1)*c2a(i,k1,j)+rdnw(k1-1)*c2a(i,k1-1,j))<a name='1337'>
        c = -(cqw(i,k1,j)*cof(i)*rdn(k1)*rdnw(k1)*c2a(i,k1,j))<a name='1338'>
        alpha(i,k1,j) = 1./(b-a(i,k1,j)*gamma(i,k1-1,j))<a name='1339'>
        gamma(i,k1,j) = c*alpha(i,k1,j)<a name='1340'>
      end do<a name='1341'>
    end do<a name='1342'>
    do i = i_start, i_end<a name='1343'>
      a_b = 0.<a name='1344'>
      a_c = 0.<a name='1345'>
      b = 1.+cqw(i,k,j)*cof(i)*rdn(k)*(rdnw(k)*c2a(i,k,j)+rdnw(k-1)*c2a(i,k-1,j))<a name='1346'>
<font color=#447700>! recompute : b<a name='1347'></font>
      c = -(cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k)*c2a(i,k,j))<a name='1348'>
<font color=#447700>! recompute : c<a name='1349'></font>
      alpha(i,k,j) = 1./(b-a(i,k,j)*gamma(i,k-1,j))<a name='1350'>
<font color=#447700>! recompute : alpha<a name='1351'></font>
      a_alpha(i,k,j) = a_alpha(i,k,j)+a_gamma(i,k,j)*c<a name='1352'>
      a_c = a_c+a_gamma(i,k,j)*alpha(i,k,j)<a name='1353'>
      a_gamma(i,k,j) = 0.<a name='1354'>
      a_a(i,k,j) = a_a(i,k,j)+a_alpha(i,k,j)*(1.*gamma(i,k-1,j)/((b-a(i,k,j)*gamma(i,k-1,j))*(b-a(i,k,j)*gamma(i,k-1,j))))<a name='1355'>
      a_b = a_b-a_alpha(i,k,j)/((b-a(i,k,j)*gamma(i,k-1,j))*(b-a(i,k,j)*gamma(i,k-1,j)))<a name='1356'>
      a_gamma(i,k-1,j) = a_gamma(i,k-1,j)+a_alpha(i,k,j)*(1.*a(i,k,j)/((b-a(i,k,j)*gamma(i,k-1,j))*(b-a(i,k,j)*gamma(i,k-1,j))))<a name='1357'>
      a_alpha(i,k,j) = 0.<a name='1358'>
      a_c2a(i,k,j) = a_c2a(i,k,j)-a_c*cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k)<a name='1359'>
      a_cof(i) = a_cof(i)-a_c*cqw(i,k,j)*rdn(k)*rdnw(k)*c2a(i,k,j)<a name='1360'>
      a_cqw(i,k,j) = a_cqw(i,k,j)-a_c*cof(i)*rdn(k)*rdnw(k)*c2a(i,k,j)<a name='1361'>
      a_c = 0.<a name='1362'>
      a_c2a(i,k-1,j) = a_c2a(i,k-1,j)+a_b*cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k-1)<a name='1363'>
      a_c2a(i,k,j) = a_c2a(i,k,j)+a_b*cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k)<a name='1364'>
      a_cof(i) = a_cof(i)+a_b*cqw(i,k,j)*rdn(k)*(rdnw(k)*c2a(i,k,j)+rdnw(k-1)*c2a(i,k-1,j))<a name='1365'>
      a_cqw(i,k,j) = a_cqw(i,k,j)+a_b*cof(i)*rdn(k)*(rdnw(k)*c2a(i,k,j)+rdnw(k-1)*c2a(i,k-1,j))<a name='1366'>
      a_b = 0.<a name='1367'>
    end do<a name='1368'>
  end do<a name='1369'>
  do k = 3, kde-1<a name='1370'>
    do i = i_start, i_end<a name='1371'>
      a_c2a(i,k-1,j) = a_c2a(i,k-1,j)-a_a(i,k,j)*cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k-1)<a name='1372'>
      a_cof(i) = a_cof(i)-a_a(i,k,j)*cqw(i,k,j)*rdn(k)*rdnw(k-1)*c2a(i,k-1,j)<a name='1373'>
      a_cqw(i,k,j) = a_cqw(i,k,j)-a_a(i,k,j)*cof(i)*rdn(k)*rdnw(k-1)*c2a(i,k-1,j)<a name='1374'>
      a_a(i,k,j) = 0.<a name='1375'>
    end do<a name='1376'>
  end do<a name='1377'>
  do i = i_start, i_end<a name='1378'>
    cof(i) = (0.5*dts*g*(1.+epssm)/mut(i,j))**2<a name='1379'>
<font color=#447700>! recompute : cof<a name='1380'></font>
    a_gamma(i,1,j) = 0.<a name='1381'>
    a_c2a(i,kde-1,j) = a_c2a(i,kde-1,j)-2*a_a(i,kde,j)*cof(i)*rdnw(kde-1)**2<a name='1382'>
    a_cof(i) = a_cof(i)-2*a_a(i,kde,j)*rdnw(kde-1)**2*c2a(i,kde-1,j)<a name='1383'>
    a_a(i,kde,j) = 0.<a name='1384'>
    a_a(i,2,j) = 0.<a name='1385'>
    a_mut(i,j) = a_mut(i,j)-2*a_cof(i)*0.5*dts*g*(1.+epssm)/(mut(i,j)*mut(i,j))*(0.5*dts*g*(1.+epssm)/mut(i,j))<a name='1386'>
    a_cof(i) = 0.<a name='1387'>
  end do<a name='1388'>
end do<a name='1389'>
<a name='1390'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_COEF_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_90">("a_calc_coef_w")<a name='1391'>
<a name='1392'>
end subroutine a_calc_coef_w<a name='1393'>
<a name='1394'>
<a name='1395'>
<A NAME='A_CALC_P_RHO'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_P_RHO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1396'>
<font color=#993300>subroutine </font><font color=#cc0000>a_calc_p_rho</font>( al, a_al, p, a_p, ph, a_ph, alt, a_alt, t_2, a_t_2, t_1, a_t_1, c2a, a_c2a, a_pm1, mu, a_mu, muts, a_muts,&amp; <A href='../../call_to/A_CALC_P_RHO.html' TARGET='index'>3</A>,<A href='../../call_from/A_CALC_P_RHO.html' TARGET='index'>2</A><a name='1397'>
&amp; znu, t0, rdnw, dnw, smdiv, non_hydrostatic, step, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1398'>
<font color=#447700>!******************************************************************<a name='1399'></font>
<font color=#447700>!******************************************************************<a name='1400'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1401'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1402'></font>
<font color=#447700>!******************************************************************<a name='1403'></font>
<font color=#447700>!******************************************************************<a name='1404'></font>
<font color=#447700>!==============================================<a name='1405'></font>
<font color=#447700>! all entries are defined explicitly<a name='1406'></font>
<font color=#447700>!==============================================<a name='1407'></font>
implicit none<a name='1408'>
<a name='1409'>
<font color=#447700>!==============================================<a name='1410'></font>
<font color=#447700>! declare arguments<a name='1411'></font>
<font color=#447700>!==============================================<a name='1412'></font>
integer, intent(in) :: ime<a name='1413'>
integer, intent(in) :: ims<a name='1414'>
integer, intent(in) :: jme<a name='1415'>
integer, intent(in) :: jms<a name='1416'>
integer, intent(in) :: kme<a name='1417'>
integer, intent(in) :: kms<a name='1418'>
real, intent(inout) :: a_al(ims:ime,kms:kme,jms:jme)<a name='1419'>
real, intent(inout) :: a_alt(ims:ime,kms:kme,jms:jme)<a name='1420'>
real, intent(inout) :: a_c2a(ims:ime,kms:kme,jms:jme)<a name='1421'>
real, intent(inout) :: a_mu(ims:ime,jms:jme)<a name='1422'>
real, intent(inout) :: a_muts(ims:ime,jms:jme)<a name='1423'>
real, intent(inout) :: a_p(ims:ime,kms:kme,jms:jme)<a name='1424'>
real, intent(inout) :: a_ph(ims:ime,kms:kme,jms:jme)<a name='1425'>
real, intent(inout) :: a_pm1(ims:ime,kms:kme,jms:jme)<a name='1426'>
real, intent(inout) :: a_t_1(ims:ime,kms:kme,jms:jme)<a name='1427'>
real, intent(inout) :: a_t_2(ims:ime,kms:kme,jms:jme)<a name='1428'>
real, intent(out) :: al(ims:ime,kms:kme,jms:jme)<a name='1429'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='1430'>
real, intent(in) :: c2a(ims:ime,kms:kme,jms:jme)<a name='1431'>
real, intent(in) :: dnw(kms:kme)<a name='1432'>
integer, intent(in) :: ide<a name='1433'>
integer, intent(in) :: ite<a name='1434'>
integer, intent(in) :: its<a name='1435'>
integer, intent(in) :: jde<a name='1436'>
integer, intent(in) :: jte<a name='1437'>
integer, intent(in) :: jts<a name='1438'>
integer, intent(in) :: kde<a name='1439'>
integer, intent(in) :: kte<a name='1440'>
integer, intent(in) :: kts<a name='1441'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='1442'>
real, intent(in) :: muts(ims:ime,jms:jme)<a name='1443'>
logical, intent(in) :: non_hydrostatic<a name='1444'>
real, intent(out) :: p(ims:ime,kms:kme,jms:jme)<a name='1445'>
real, intent(inout) :: ph(ims:ime,kms:kme,jms:jme)<a name='1446'>
real, intent(in) :: rdnw(kms:kme)<a name='1447'>
real, intent(in) :: smdiv<a name='1448'>
integer, intent(in) :: step<a name='1449'>
real, intent(in) :: t0<a name='1450'>
real, intent(in) :: t_1(ims:ime,kms:kme,jms:jme)<a name='1451'>
real, intent(in) :: t_2(ims:ime,kms:kme,jms:jme)<a name='1452'>
real, intent(in) :: znu(kms:kme)<a name='1453'>
<a name='1454'>
<font color=#447700>!==============================================<a name='1455'></font>
<font color=#447700>! declare local variables<a name='1456'></font>
<font color=#447700>!==============================================<a name='1457'></font>
real a_ptmp<a name='1458'>
integer i<a name='1459'>
integer i_end<a name='1460'>
integer i_start<a name='1461'>
integer j<a name='1462'>
integer j_end<a name='1463'>
integer j_start<a name='1464'>
integer k<a name='1465'>
integer k_end<a name='1466'>
integer k_start<a name='1467'>
<a name='1468'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_P_RHO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_91">("a_calc_p_rho")<a name='1469'>
<a name='1470'>
<font color=#447700>!----------------------------------------------<a name='1471'></font>
<font color=#447700>! RESET LOCAL ADJOINT VARIABLES<a name='1472'></font>
<font color=#447700>!----------------------------------------------<a name='1473'></font>
a_ptmp = 0.<a name='1474'>
<a name='1475'>
<font color=#447700>!----------------------------------------------<a name='1476'></font>
<font color=#447700>! ROUTINE BODY<a name='1477'></font>
<font color=#447700>!----------------------------------------------<a name='1478'></font>
i_start = its<a name='1479'>
<font color=#447700>! recompute : i_start<a name='1480'></font>
i_end = ite<a name='1481'>
<font color=#447700>! recompute : i_end<a name='1482'></font>
j_start = jts<a name='1483'>
<font color=#447700>! recompute : j_start<a name='1484'></font>
j_end = jte<a name='1485'>
<font color=#447700>! recompute : j_end<a name='1486'></font>
k_start = kts<a name='1487'>
<font color=#447700>! recompute : k_start<a name='1488'></font>
k_end = min(kte,kde-1)<a name='1489'>
<font color=#447700>! recompute : k_end<a name='1490'></font>
if (i_end .eq. ide) then<a name='1491'>
  i_end = i_end-1<a name='1492'>
endif<a name='1493'>
<font color=#447700>! recompute : i_end<a name='1494'></font>
if (j_end .eq. jde) then<a name='1495'>
  j_end = j_end-1<a name='1496'>
endif<a name='1497'>
<font color=#447700>! recompute : j_end<a name='1498'></font>
if (step .eq. 0) then<a name='1499'>
  do j = j_start, j_end<a name='1500'>
    do k = k_start, k_end<a name='1501'>
      do i = i_start, i_end<a name='1502'>
        a_p(i,k,j) = a_p(i,k,j)+a_pm1(i,k,j)<a name='1503'>
        a_pm1(i,k,j) = 0.<a name='1504'>
      end do<a name='1505'>
    end do<a name='1506'>
  end do<a name='1507'>
else<a name='1508'>
  do j = j_start, j_end<a name='1509'>
    a_ptmp = 0.<a name='1510'>
    do k = k_start, k_end<a name='1511'>
      a_ptmp = 0.<a name='1512'>
      do i = i_start, i_end<a name='1513'>
        a_ptmp = 0.<a name='1514'>
        a_ptmp = a_ptmp+a_pm1(i,k,j)<a name='1515'>
        a_pm1(i,k,j) = 0.<a name='1516'>
        a_pm1(i,k,j) = a_pm1(i,k,j)-a_p(i,k,j)*smdiv<a name='1517'>
        a_p(i,k,j) = a_p(i,k,j)*(1+smdiv)<a name='1518'>
        a_p(i,k,j) = a_p(i,k,j)+a_ptmp<a name='1519'>
        a_ptmp = 0.<a name='1520'>
      end do<a name='1521'>
    end do<a name='1522'>
  end do<a name='1523'>
endif<a name='1524'>
if (non_hydrostatic) then<a name='1525'>
  do j = j_start, j_end<a name='1526'>
    do k = k_start, k_end<a name='1527'>
      do i = i_start, i_end<a name='1528'>
        al(i,k,j) = -(1./muts(i,j)*(alt(i,k,j)*mu(i,j)+rdnw(k)*(ph(i,k+1,j)-ph(i,k,j))))<a name='1529'>
<font color=#447700>! recompute : al<a name='1530'></font>
        a_al(i,k,j) = a_al(i,k,j)-a_p(i,k,j)*c2a(i,k,j)<a name='1531'>
        a_alt(i,k,j) = a_alt(i,k,j)+a_p(i,k,j)*c2a(i,k,j)*((t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1532'>
        a_c2a(i,k,j) = a_c2a(i,k,j)+a_p(i,k,j)*(alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)))-al(i,k,j))<a name='1533'>
        a_mu(i,j) = a_mu(i,j)-a_p(i,k,j)*c2a(i,k,j)*(alt(i,k,j)*t_1(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1534'>
        a_muts(i,j) = a_muts(i,j)-a_p(i,k,j)*c2a(i,k,j)*(alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))*(t0+t_1(i,k,j))/(muts(i,j)*(t0+&amp;<a name='1535'>
&amp;t_1(i,k,j))*muts(i,j)*(t0+t_1(i,k,j))))<a name='1536'>
        a_t_1(i,k,j) = a_t_1(i,k,j)-a_p(i,k,j)*c2a(i,k,j)*(alt(i,k,j)*mu(i,j)/(muts(i,j)*(t0+t_1(i,k,j)))+alt(i,k,j)*(t_2(i,k,j)-&amp;<a name='1537'>
&amp;mu(i,j)*t_1(i,k,j))*muts(i,j)/(muts(i,j)*(t0+t_1(i,k,j))*muts(i,j)*(t0+t_1(i,k,j))))<a name='1538'>
        a_t_2(i,k,j) = a_t_2(i,k,j)+a_p(i,k,j)*c2a(i,k,j)*(alt(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1539'>
        a_p(i,k,j) = 0.<a name='1540'>
        a_alt(i,k,j) = a_alt(i,k,j)-a_al(i,k,j)*1./muts(i,j)*mu(i,j)<a name='1541'>
        a_mu(i,j) = a_mu(i,j)-a_al(i,k,j)*1./muts(i,j)*alt(i,k,j)<a name='1542'>
        a_muts(i,j) = a_muts(i,j)+a_al(i,k,j)/(muts(i,j)*muts(i,j))*(alt(i,k,j)*mu(i,j)+rdnw(k)*(ph(i,k+1,j)-ph(i,k,j)))<a name='1543'>
        a_ph(i,k+1,j) = a_ph(i,k+1,j)-a_al(i,k,j)*1./muts(i,j)*rdnw(k)<a name='1544'>
        a_ph(i,k,j) = a_ph(i,k,j)+a_al(i,k,j)*1./muts(i,j)*rdnw(k)<a name='1545'>
        a_al(i,k,j) = 0.<a name='1546'>
      end do<a name='1547'>
    end do<a name='1548'>
  end do<a name='1549'>
else<a name='1550'>
  do j = j_start, j_end<a name='1551'>
    do k = k_end, k_start, -1<a name='1552'>
      do i = i_start, i_end<a name='1553'>
        p(i,k,j) = mu(i,j)*znu(k)<a name='1554'>
<font color=#447700>! recompute : p<a name='1555'></font>
        al(i,k,j) = alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)))-p(i,k,j)/c2a(i,k,j)<a name='1556'>
<font color=#447700>! recompute : al<a name='1557'></font>
        a_al(i,k,j) = a_al(i,k,j)-a_ph(i,k+1,j)*dnw(k)*muts(i,j)<a name='1558'>
        a_alt(i,k,j) = a_alt(i,k,j)-a_ph(i,k+1,j)*dnw(k)*mu(i,j)<a name='1559'>
        a_mu(i,j) = a_mu(i,j)-a_ph(i,k+1,j)*dnw(k)*alt(i,k,j)<a name='1560'>
        a_muts(i,j) = a_muts(i,j)-a_ph(i,k+1,j)*dnw(k)*al(i,k,j)<a name='1561'>
        a_ph(i,k,j) = a_ph(i,k,j)+a_ph(i,k+1,j)<a name='1562'>
        a_ph(i,k+1,j) = 0.<a name='1563'>
        a_alt(i,k,j) = a_alt(i,k,j)+a_al(i,k,j)*((t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1564'>
        a_c2a(i,k,j) = a_c2a(i,k,j)+a_al(i,k,j)*(p(i,k,j)/(c2a(i,k,j)*c2a(i,k,j)))<a name='1565'>
        a_mu(i,j) = a_mu(i,j)-a_al(i,k,j)*(alt(i,k,j)*t_1(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1566'>
        a_muts(i,j) = a_muts(i,j)-a_al(i,k,j)*(alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))*(t0+t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)&amp;<a name='1567'>
&amp;)*muts(i,j)*(t0+t_1(i,k,j))))<a name='1568'>
        a_p(i,k,j) = a_p(i,k,j)-a_al(i,k,j)/c2a(i,k,j)<a name='1569'>
        a_t_1(i,k,j) = a_t_1(i,k,j)-a_al(i,k,j)*(alt(i,k,j)*mu(i,j)/(muts(i,j)*(t0+t_1(i,k,j)))+alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*&amp;<a name='1570'>
&amp;t_1(i,k,j))*muts(i,j)/(muts(i,j)*(t0+t_1(i,k,j))*muts(i,j)*(t0+t_1(i,k,j))))<a name='1571'>
        a_t_2(i,k,j) = a_t_2(i,k,j)+a_al(i,k,j)*(alt(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1572'>
        a_al(i,k,j) = 0.<a name='1573'>
        a_mu(i,j) = a_mu(i,j)+a_p(i,k,j)*znu(k)<a name='1574'>
        a_p(i,k,j) = 0.<a name='1575'>
      end do<a name='1576'>
    end do<a name='1577'>
  end do<a name='1578'>
endif<a name='1579'>
<a name='1580'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_P_RHO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_91">("a_calc_p_rho")<a name='1581'>
<a name='1582'>
end subroutine a_calc_p_rho<a name='1583'>
<a name='1584'>
<A NAME='A_SMALL_STEP_FINISH'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SMALL_STEP_FINISH' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1585'>
<font color=#993300>subroutine </font><font color=#cc0000>a_small_step_finish</font>( u_2, a_u_2, v_2, a_v_2, w_2, a_w_2, t_2, a_t_2, a_ph_2, a_mu_2, mut, a_mut, muts, a_muts, muu, &amp; <A href='../../call_to/A_SMALL_STEP_FINISH.html' TARGET='index'>2</A>,<A href='../../call_from/A_SMALL_STEP_FINISH.html' TARGET='index'>2</A><a name='1586'>
&amp;a_muu, muus, a_muus, muv, a_muv, muvs, a_muvs, u_save, a_u_save, v_save, a_v_save, w_save, a_w_save, t_save, a_t_save, a_ph_save, &amp;<a name='1587'>
&amp;a_mu_save, msfu, msfv, msft, ide, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte )<a name='1588'>
<a name='1589'>
<font color=#447700>!******************************************************************<a name='1590'></font>
<font color=#447700>!******************************************************************<a name='1591'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1592'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1593'></font>
<font color=#447700>!******************************************************************<a name='1594'></font>
<font color=#447700>!******************************************************************<a name='1595'></font>
<font color=#447700>!==============================================<a name='1596'></font>
<font color=#447700>! all entries are defined explicitly<a name='1597'></font>
<font color=#447700>!==============================================<a name='1598'></font>
implicit none<a name='1599'>
<a name='1600'>
<font color=#447700>!==============================================<a name='1601'></font>
<font color=#447700>! declare arguments<a name='1602'></font>
<font color=#447700>!==============================================<a name='1603'></font>
integer, intent(in) :: ime<a name='1604'>
integer, intent(in) :: ims<a name='1605'>
integer, intent(in) :: jme<a name='1606'>
integer, intent(in) :: jms<a name='1607'>
real, intent(inout) :: a_mu_2(ims:ime,jms:jme)<a name='1608'>
real, intent(inout) :: a_mu_save(ims:ime,jms:jme)<a name='1609'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='1610'>
real, intent(inout) :: a_muts(ims:ime,jms:jme)<a name='1611'>
real, intent(inout) :: a_muu(ims:ime,jms:jme)<a name='1612'>
real, intent(inout) :: a_muus(ims:ime,jms:jme)<a name='1613'>
real, intent(inout) :: a_muv(ims:ime,jms:jme)<a name='1614'>
real, intent(inout) :: a_muvs(ims:ime,jms:jme)<a name='1615'>
integer, intent(in) :: kme<a name='1616'>
integer, intent(in) :: kms<a name='1617'>
real, intent(inout) :: a_ph_2(ims:ime,kms:kme,jms:jme)<a name='1618'>
real, intent(inout) :: a_ph_save(ims:ime,kms:kme,jms:jme)<a name='1619'>
real, intent(inout) :: a_t_2(ims:ime,kms:kme,jms:jme)<a name='1620'>
real, intent(inout) :: a_t_save(ims:ime,kms:kme,jms:jme)<a name='1621'>
real, intent(inout) :: a_u_2(ims:ime,kms:kme,jms:jme)<a name='1622'>
real, intent(inout) :: a_u_save(ims:ime,kms:kme,jms:jme)<a name='1623'>
real, intent(inout) :: a_v_2(ims:ime,kms:kme,jms:jme)<a name='1624'>
real, intent(inout) :: a_v_save(ims:ime,kms:kme,jms:jme)<a name='1625'>
real, intent(inout) :: a_w_2(ims:ime,kms:kme,jms:jme)<a name='1626'>
real, intent(inout) :: a_w_save(ims:ime,kms:kme,jms:jme)<a name='1627'>
integer, intent(in) :: ide<a name='1628'>
integer, intent(in) :: ite<a name='1629'>
integer, intent(in) :: its<a name='1630'>
integer, intent(in) :: jde<a name='1631'>
integer, intent(in) :: jte<a name='1632'>
integer, intent(in) :: jts<a name='1633'>
integer, intent(in) :: kde<a name='1634'>
integer, intent(in) :: kds<a name='1635'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='1636'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='1637'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='1638'>
real, intent(inout) :: mut(ims:ime,jms:jme)<a name='1639'>
real, intent(inout) :: muts(ims:ime,jms:jme)<a name='1640'>
real, intent(inout) :: muu(ims:ime,jms:jme)<a name='1641'>
real, intent(inout) :: muus(ims:ime,jms:jme)<a name='1642'>
real, intent(inout) :: muv(ims:ime,jms:jme)<a name='1643'>
real, intent(inout) :: muvs(ims:ime,jms:jme)<a name='1644'>
real, intent(inout) :: t_2(ims:ime,kms:kme,jms:jme)<a name='1645'>
real, intent(in) :: t_save(ims:ime,kms:kme,jms:jme)<a name='1646'>
real, intent(inout) :: u_2(ims:ime,kms:kme,jms:jme)<a name='1647'>
real, intent(in) :: u_save(ims:ime,kms:kme,jms:jme)<a name='1648'>
real, intent(inout) :: v_2(ims:ime,kms:kme,jms:jme)<a name='1649'>
real, intent(in) :: v_save(ims:ime,kms:kme,jms:jme)<a name='1650'>
real, intent(inout) :: w_2(ims:ime,kms:kme,jms:jme)<a name='1651'>
real, intent(in) :: w_save(ims:ime,kms:kme,jms:jme)<a name='1652'>
<a name='1653'>
<a name='1654'>
  REAL,   DIMENSION(ims:ime, kms:kme, jms:jme)  ::ww1,a_ww1,a_ww<a name='1655'>
  REAL, DIMENSION(ims:ime, kms:kme, jms:jme) :: h_diabatic<a name='1656'>
  INTEGER                   :: number_of_small_timesteps<a name='1657'>
  REAL                      :: dts<a name='1658'>
<a name='1659'>
<a name='1660'>
<a name='1661'>
<font color=#447700>!==============================================<a name='1662'></font>
<font color=#447700>! declare local variables<a name='1663'></font>
<font color=#447700>!==============================================<a name='1664'></font>
integer i<a name='1665'>
integer i_end<a name='1666'>
integer i_endu<a name='1667'>
integer i_start<a name='1668'>
integer j<a name='1669'>
integer j_end<a name='1670'>
integer j_endv<a name='1671'>
integer j_start<a name='1672'>
integer k<a name='1673'>
<a name='1674'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SMALL_STEP_FINISH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_92">("a_small_step_finish")<a name='1675'>
<a name='1676'>
<font color=#447700>!----------------------------------------------<a name='1677'></font>
<font color=#447700>! ROUTINE BODY<a name='1678'></font>
<font color=#447700>!----------------------------------------------<a name='1679'></font>
i_start = its<a name='1680'>
<font color=#447700>! recompute : i_start<a name='1681'></font>
i_end = ite<a name='1682'>
<font color=#447700>! recompute : i_end<a name='1683'></font>
j_start = jts<a name='1684'>
<font color=#447700>! recompute : j_start<a name='1685'></font>
j_end = jte<a name='1686'>
<font color=#447700>! recompute : j_end<a name='1687'></font>
i_endu = i_end<a name='1688'>
<font color=#447700>! recompute : i_endu<a name='1689'></font>
j_endv = j_end<a name='1690'>
<font color=#447700>! recompute : j_endv<a name='1691'></font>
if (i_end .eq. ide) then<a name='1692'>
  i_end = i_end-1<a name='1693'>
endif<a name='1694'>
<font color=#447700>! recompute : i_end<a name='1695'></font>
if (j_end .eq. jde) then<a name='1696'>
  j_end = j_end-1<a name='1697'>
endif<a name='1698'>
<font color=#447700>! recompute : j_end<a name='1699'></font>
do j = j_start, j_end<a name='1700'>
  do i = i_start, i_end<a name='1701'>
    a_mu_save(i,j) = a_mu_save(i,j)+a_mu_2(i,j)<a name='1702'>
  end do<a name='1703'>
end do<a name='1704'>
do j = j_start, j_end<a name='1705'>
  do k = kds, kde-1<a name='1706'>
    do i = i_start, i_end<a name='1707'>
<font color=#447700>!zzma      a_mut(i,j) = a_mut(i,j)+a_t_2(i,k,j)*(t_save(i,k,j)/muts(i,j))<a name='1708'></font>
<font color=#447700>!zzma      a_muts(i,j) = a_muts(i,j)-a_t_2(i,k,j)*((t_2(i,k,j)+t_save(i,k,j)*mut(i,j))/(muts(i,j)*muts(i,j)))<a name='1709'></font>
<font color=#447700>!zzma      a_t_save(i,k,j) = a_t_save(i,k,j)+a_t_2(i,k,j)*(mut(i,j)/muts(i,j))<a name='1710'></font>
<font color=#447700>!zzma      a_t_2(i,k,j) = a_t_2(i,k,j)/muts(i,j)<a name='1711'></font>
<a name='1712'>
      a_mut(i,j) = a_mut(i,j)+a_t_2(i,k,j)*(- dts*number_of_small_timesteps*h_diabatic(i,k,j) +t_save(i,k,j)/muts(i,j))<a name='1713'>
      a_muts(i,j) = a_muts(i,j)-a_t_2(i,k,j)*((t_2(i,k,j)- dts*number_of_small_timesteps*mut(i,j)*h_diabatic(i,k,j) &amp;<a name='1714'>
                    +t_save(i,k,j)*mut(i,j))/(muts(i,j)*muts(i,j)))<a name='1715'>
      a_t_save(i,k,j) = a_t_save(i,k,j)+a_t_2(i,k,j)*(mut(i,j)/muts(i,j))<a name='1716'>
      a_t_2(i,k,j) = a_t_2(i,k,j)/muts(i,j)<a name='1717'>
<a name='1718'>
    end do<a name='1719'>
  end do<a name='1720'>
end do<a name='1721'>
do j = j_start, j_end<a name='1722'>
  do k = kds, kde<a name='1723'>
    do i = i_start, i_end<a name='1724'>
<font color=#447700>!------------------------- added in May 9 -----------------<a name='1725'></font>
      a_ww1(i,k,j) =a_ww1(i,k,j) +a_ww(i,k,j)<a name='1726'>
<font color=#447700>!------------------------- added in May 9 -----------------<a name='1727'></font>
<a name='1728'>
      a_ph_save(i,k,j) = a_ph_save(i,k,j)+a_ph_2(i,k,j)<a name='1729'>
      a_mut(i,j) = a_mut(i,j)+a_w_2(i,k,j)*(w_save(i,k,j)/muts(i,j))<a name='1730'>
      a_muts(i,j) = a_muts(i,j)-a_w_2(i,k,j)*((msft(i,j)*w_2(i,k,j)+w_save(i,k,j)*mut(i,j))/(muts(i,j)*muts(i,j)))<a name='1731'>
      a_w_save(i,k,j) = a_w_save(i,k,j)+a_w_2(i,k,j)*(mut(i,j)/muts(i,j))<a name='1732'>
      a_w_2(i,k,j) = a_w_2(i,k,j)*(msft(i,j)/muts(i,j))<a name='1733'>
    end do<a name='1734'>
  end do<a name='1735'>
end do<a name='1736'>
do j = j_start, j_end<a name='1737'>
  do k = kds, kde-1<a name='1738'>
    do i = i_start, i_endu<a name='1739'>
      a_muu(i,j) = a_muu(i,j)+a_u_2(i,k,j)*(u_save(i,k,j)/muus(i,j))<a name='1740'>
      a_muus(i,j) = a_muus(i,j)-a_u_2(i,k,j)*((msfu(i,j)*u_2(i,k,j)+u_save(i,k,j)*muu(i,j))/(muus(i,j)*muus(i,j)))<a name='1741'>
      a_u_save(i,k,j) = a_u_save(i,k,j)+a_u_2(i,k,j)*(muu(i,j)/muus(i,j))<a name='1742'>
      a_u_2(i,k,j) = a_u_2(i,k,j)*(msfu(i,j)/muus(i,j))<a name='1743'>
    end do<a name='1744'>
  end do<a name='1745'>
end do<a name='1746'>
do j = j_start, j_endv<a name='1747'>
  do k = kds, kde-1<a name='1748'>
    do i = i_start, i_end<a name='1749'>
      a_muv(i,j) = a_muv(i,j)+a_v_2(i,k,j)*(v_save(i,k,j)/muvs(i,j))<a name='1750'>
      a_muvs(i,j) = a_muvs(i,j)-a_v_2(i,k,j)*((msfv(i,j)*v_2(i,k,j)+v_save(i,k,j)*muv(i,j))/(muvs(i,j)*muvs(i,j)))<a name='1751'>
      a_v_save(i,k,j) = a_v_save(i,k,j)+a_v_2(i,k,j)*(muv(i,j)/muvs(i,j))<a name='1752'>
      a_v_2(i,k,j) = a_v_2(i,k,j)*(msfv(i,j)/muvs(i,j))<a name='1753'>
    end do<a name='1754'>
  end do<a name='1755'>
end do<a name='1756'>
<a name='1757'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SMALL_STEP_FINISH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_92">("a_small_step_finish")<a name='1758'>
<a name='1759'>
end subroutine a_small_step_finish<a name='1760'>
<a name='1761'>
<a name='1762'>
<A NAME='A_SMALL_STEP_PREP'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SMALL_STEP_PREP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1763'>
<font color=#993300>subroutine </font><font color=#cc0000>a_small_step_prep</font>( u_1, a_u_1, u_2, a_u_2, v_1, a_v_1, v_2, a_v_2, w_1, a_w_1, w_2, a_w_2, t_1, a_t_1, t_2, a_t_2, &amp; <A href='../../call_to/A_SMALL_STEP_PREP.html' TARGET='index'>2</A>,<A href='../../call_from/A_SMALL_STEP_PREP.html' TARGET='index'>2</A><a name='1764'>
&amp;a_ph_1, a_ph_2, mub, mu_1, a_mu_1, mu_2, a_mu_2, muu, a_muu, muus, a_muus, muv, a_muv, muvs, a_muvs, mut, a_mut, muts, a_muts, &amp;<a name='1765'>
&amp;a_mudf, a_u_save, a_v_save, a_w_save, a_t_save, a_ph_save, a_mu_save, a_ww, a_ww_save, a_c2a, pb, p, a_p, alt, a_alt, msfu, msfv, &amp;<a name='1766'>
&amp;msft, rk_step, leapfrog, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1767'>
<font color=#447700>!******************************************************************<a name='1768'></font>
<font color=#447700>!******************************************************************<a name='1769'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1770'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1771'></font>
<font color=#447700>!******************************************************************<a name='1772'></font>
<font color=#447700>!******************************************************************<a name='1773'></font>
<font color=#447700>!==============================================<a name='1774'></font>
<font color=#447700>! all entries are defined explicitly<a name='1775'></font>
<font color=#447700>!==============================================<a name='1776'></font>
implicit none<a name='1777'>
<a name='1778'>
<font color=#447700>!==============================================<a name='1779'></font>
<font color=#447700>! declare arguments<a name='1780'></font>
<font color=#447700>!==============================================<a name='1781'></font>
integer, intent(in) :: ime<a name='1782'>
integer, intent(in) :: ims<a name='1783'>
integer, intent(in) :: jme<a name='1784'>
integer, intent(in) :: jms<a name='1785'>
integer, intent(in) :: kme<a name='1786'>
integer, intent(in) :: kms<a name='1787'>
real, intent(inout) :: a_alt(ims:ime,kms:kme,jms:jme)<a name='1788'>
real, intent(inout) :: a_c2a(ims:ime,kms:kme,jms:jme)<a name='1789'>
real, intent(inout) :: a_mu_1(ims:ime,jms:jme)<a name='1790'>
real, intent(inout) :: a_mu_2(ims:ime,jms:jme)<a name='1791'>
real, intent(inout) :: a_mu_save(ims:ime,jms:jme)<a name='1792'>
real, intent(inout) :: a_mudf(ims:ime,jms:jme)<a name='1793'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='1794'>
real, intent(inout) :: a_muts(ims:ime,jms:jme)<a name='1795'>
real, intent(inout) :: a_muu(ims:ime,jms:jme)<a name='1796'>
real, intent(inout) :: a_muus(ims:ime,jms:jme)<a name='1797'>
real, intent(inout) :: a_muv(ims:ime,jms:jme)<a name='1798'>
real, intent(inout) :: a_muvs(ims:ime,jms:jme)<a name='1799'>
real, intent(inout) :: a_p(ims:ime,kms:kme,jms:jme)<a name='1800'>
real, intent(inout) :: a_ph_1(ims:ime,kms:kme,jms:jme)<a name='1801'>
real, intent(inout) :: a_ph_2(ims:ime,kms:kme,jms:jme)<a name='1802'>
real, intent(inout) :: a_ph_save(ims:ime,kms:kme,jms:jme)<a name='1803'>
real, intent(inout) :: a_t_1(ims:ime,kms:kme,jms:jme)<a name='1804'>
real, intent(inout) :: a_t_2(ims:ime,kms:kme,jms:jme)<a name='1805'>
real, intent(inout) :: a_t_save(ims:ime,kms:kme,jms:jme)<a name='1806'>
real, intent(inout) :: a_u_1(ims:ime,kms:kme,jms:jme)<a name='1807'>
real, intent(inout) :: a_u_2(ims:ime,kms:kme,jms:jme)<a name='1808'>
real, intent(inout) :: a_u_save(ims:ime,kms:kme,jms:jme)<a name='1809'>
real, intent(inout) :: a_v_1(ims:ime,kms:kme,jms:jme)<a name='1810'>
real, intent(inout) :: a_v_2(ims:ime,kms:kme,jms:jme)<a name='1811'>
real, intent(inout) :: a_v_save(ims:ime,kms:kme,jms:jme)<a name='1812'>
real, intent(inout) :: a_w_1(ims:ime,kms:kme,jms:jme)<a name='1813'>
real, intent(inout) :: a_w_2(ims:ime,kms:kme,jms:jme)<a name='1814'>
real, intent(inout) :: a_w_save(ims:ime,kms:kme,jms:jme)<a name='1815'>
real, intent(inout) :: a_ww(ims:ime,kms:kme,jms:jme)<a name='1816'>
real, intent(inout) :: a_ww_save(ims:ime,kms:kme,jms:jme)<a name='1817'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='1818'>
integer, intent(in) :: ide<a name='1819'>
integer, intent(in) :: ite<a name='1820'>
integer, intent(in) :: its<a name='1821'>
integer, intent(in) :: jde<a name='1822'>
integer, intent(in) :: jte<a name='1823'>
integer, intent(in) :: jts<a name='1824'>
integer, intent(in) :: kde<a name='1825'>
integer, intent(in) :: kte<a name='1826'>
integer, intent(in) :: kts<a name='1827'>
logical, intent(in) :: leapfrog<a name='1828'>
real, intent(inout) :: msft(ims:ime,jms:jme)<a name='1829'>
real, intent(inout) :: msfu(ims:ime,jms:jme)<a name='1830'>
real, intent(inout) :: msfv(ims:ime,jms:jme)<a name='1831'>
real, intent(inout) :: mu_1(ims:ime,jms:jme)<a name='1832'>
real, intent(inout) :: mu_2(ims:ime,jms:jme)<a name='1833'>
real, intent(inout) :: mub(ims:ime,jms:jme)<a name='1834'>
real, intent(inout) :: mut(ims:ime,jms:jme)<a name='1835'>
real, intent(out) :: muts(ims:ime,jms:jme)<a name='1836'>
real, intent(inout) :: muu(ims:ime,jms:jme)<a name='1837'>
real, intent(out) :: muus(ims:ime,jms:jme)<a name='1838'>
real, intent(inout) :: muv(ims:ime,jms:jme)<a name='1839'>
real, intent(out) :: muvs(ims:ime,jms:jme)<a name='1840'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='1841'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='1842'>
integer, intent(in) :: rk_step<a name='1843'>
real, intent(inout) :: t_1(ims:ime,kms:kme,jms:jme)<a name='1844'>
real, intent(inout) :: t_2(ims:ime,kms:kme,jms:jme)<a name='1845'>
real, intent(inout) :: u_1(ims:ime,kms:kme,jms:jme)<a name='1846'>
real, intent(inout) :: u_2(ims:ime,kms:kme,jms:jme)<a name='1847'>
real, intent(inout) :: v_1(ims:ime,kms:kme,jms:jme)<a name='1848'>
real, intent(inout) :: v_2(ims:ime,kms:kme,jms:jme)<a name='1849'>
real, intent(inout) :: w_1(ims:ime,kms:kme,jms:jme)<a name='1850'>
real, intent(inout) :: w_2(ims:ime,kms:kme,jms:jme)<a name='1851'>
<a name='1852'>
<font color=#447700>!==============================================<a name='1853'></font>
<font color=#447700>! declare local variables<a name='1854'></font>
<font color=#447700>!==============================================<a name='1855'></font>
integer i<a name='1856'>
integer i_end<a name='1857'>
integer i_endu<a name='1858'>
integer i_start<a name='1859'>
integer j<a name='1860'>
integer j_end<a name='1861'>
integer j_endv<a name='1862'>
integer j_start<a name='1863'>
integer k<a name='1864'>
integer k_end<a name='1865'>
integer k_start<a name='1866'>
<a name='1867'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SMALL_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_93">("a_small_step_prep")<a name='1868'>
<a name='1869'>
<font color=#447700>!----------------------------------------------<a name='1870'></font>
<font color=#447700>! ROUTINE BODY<a name='1871'></font>
<font color=#447700>!----------------------------------------------<a name='1872'></font>
i_start = its<a name='1873'>
<font color=#447700>! recompute : i_start<a name='1874'></font>
i_end = ite<a name='1875'>
<font color=#447700>! recompute : i_end<a name='1876'></font>
j_start = jts<a name='1877'>
<font color=#447700>! recompute : j_start<a name='1878'></font>
j_end = jte<a name='1879'>
<font color=#447700>! recompute : j_end<a name='1880'></font>
k_start = kts<a name='1881'>
<font color=#447700>! recompute : k_start<a name='1882'></font>
k_end = min(kte,kde-1)<a name='1883'>
<font color=#447700>! recompute : k_end<a name='1884'></font>
i_endu = i_end<a name='1885'>
<font color=#447700>! recompute : i_endu<a name='1886'></font>
j_endv = j_end<a name='1887'>
<font color=#447700>! recompute : j_endv<a name='1888'></font>
if (i_end .eq. ide) then<a name='1889'>
  i_end = i_end-1<a name='1890'>
endif<a name='1891'>
<font color=#447700>! recompute : i_end<a name='1892'></font>
if (j_end .eq. jde) then<a name='1893'>
  j_end = j_end-1<a name='1894'>
endif<a name='1895'>
<a name='1896'>
<font color=#447700>! recompute : j_end<a name='1897'></font>
if (rk_step .eq. 1 .and. ( .not. leapfrog)) then<a name='1898'>
<a name='1899'>
<font color=#447700>!--------- added by zzma -----------<a name='1900'></font>
      DO j=j_start, j_end<a name='1901'>
      DO i=i_start, i_end<a name='1902'>
        mu_1(i,j)=mu_2(i,j)<a name='1903'>
      ENDDO<a name='1904'>
      ENDDO<a name='1905'>
<font color=#447700>!--------- added by zzma -----------<a name='1906'></font>
<a name='1907'>
  do j = j_start, j_end<a name='1908'>
    do k = k_start, k_end<a name='1909'>
      do i = i_start, i_endu<a name='1910'>
        u_1(i,k,j) = u_2(i,k,j)<a name='1911'>
      end do<a name='1912'>
    end do<a name='1913'>
  end do<a name='1914'>
  do j = j_start, j_endv<a name='1915'>
    do k = k_start, k_end<a name='1916'>
      do i = i_start, i_end<a name='1917'>
        v_1(i,k,j) = v_2(i,k,j)<a name='1918'>
      end do<a name='1919'>
    end do<a name='1920'>
  end do<a name='1921'>
  do j = j_start, j_end<a name='1922'>
    do k = k_start, k_end<a name='1923'>
      do i = i_start, i_end<a name='1924'>
        t_1(i,k,j) = t_2(i,k,j)<a name='1925'>
      end do<a name='1926'>
    end do<a name='1927'>
  end do<a name='1928'>
  do j = j_start, j_end<a name='1929'>
    do k = k_start, min(kde,kte)<a name='1930'>
      do i = i_start, i_end<a name='1931'>
        w_1(i,k,j) = w_2(i,k,j)<a name='1932'>
<a name='1933'>
<font color=#447700>!--------- added by zzma -----------<a name='1934'></font>
<font color=#447700>!        ph_1(i,k,j) = ph_2(i,k,j)<a name='1935'></font>
<font color=#447700>!--------- added by zzma -----------<a name='1936'></font>
<a name='1937'>
      end do<a name='1938'>
    end do<a name='1939'>
  end do<a name='1940'>
  do j = j_start, j_end<a name='1941'>
    do i = i_start, i_end<a name='1942'>
      muts(i,j) = mub(i,j)+mu_2(i,j)<a name='1943'>
    end do<a name='1944'>
    do i = i_start, i_endu<a name='1945'>
      muus(i,j) = muu(i,j)<a name='1946'>
    end do<a name='1947'>
  end do<a name='1948'>
  do j = j_start, j_endv<a name='1949'>
    do i = i_start, i_end<a name='1950'>
      muvs(i,j) = muv(i,j)<a name='1951'>
    end do<a name='1952'>
  end do<a name='1953'>
else<a name='1954'>
  do j = j_start, j_end<a name='1955'>
    do i = i_start, i_end<a name='1956'>
      muts(i,j) = mub(i,j)+mu_1(i,j)<a name='1957'>
    end do<a name='1958'>
    do i = i_start, i_endu<a name='1959'>
      muus(i,j) = 0.5*(mub(i,j)+mu_1(i,j)+mub(i-1,j)+mu_1(i-1,j))<a name='1960'>
    end do<a name='1961'>
  end do<a name='1962'>
  do j = j_start, j_endv<a name='1963'>
    do i = i_start, i_end<a name='1964'>
      muvs(i,j) = 0.5*(mub(i,j)+mu_1(i,j)+mub(i,j-1)+mu_1(i,j-1))<a name='1965'>
    end do<a name='1966'>
  end do<a name='1967'>
<a name='1968'>
<font color=#447700>!--------- added by zzma -----------<a name='1969'></font>
    DO j=j_start, j_end<a name='1970'>
      DO i=i_start, i_end<a name='1971'>
        mu_2(i,j)=mu_1(i,j)-mu_2(i,j)<a name='1972'>
      ENDDO<a name='1973'>
    ENDDO<a name='1974'>
<font color=#447700>!--------- added by zzma -----------<a name='1975'></font>
<a name='1976'>
endif<a name='1977'>
<font color=#447700>! recompute : muts,muus,muvs,t_1,u_1,v_1,w_1<a name='1978'></font>
do j = j_start, j_end<a name='1979'>
  do k = k_start, kde<a name='1980'>
    do i = i_start, i_end<a name='1981'>
      a_ww(i,k,j) = a_ww(i,k,j)+a_ww_save(i,k,j)<a name='1982'>
      a_ww_save(i,k,j) = 0.<a name='1983'>
    end do<a name='1984'>
  end do<a name='1985'>
end do<a name='1986'>
do j = j_start, j_end<a name='1987'>
  do k = k_start, kde<a name='1988'>
    do i = i_start, i_end<a name='1989'>
      a_ph_1(i,k,j) = a_ph_1(i,k,j)+a_ph_2(i,k,j)<a name='1990'>
      a_ph_2(i,k,j) = -a_ph_2(i,k,j)<a name='1991'>
      a_ph_2(i,k,j) = a_ph_2(i,k,j)+a_ph_save(i,k,j)<a name='1992'>
      a_ph_save(i,k,j) = 0.<a name='1993'>
      a_mut(i,j) = a_mut(i,j)-a_w_2(i,k,j)*(w_2(i,k,j)/msft(i,j))<a name='1994'>
      a_muts(i,j) = a_muts(i,j)+a_w_2(i,k,j)*(w_1(i,k,j)/msft(i,j))<a name='1995'>
      a_w_1(i,k,j) = a_w_1(i,k,j)+a_w_2(i,k,j)*(muts(i,j)/msft(i,j))<a name='1996'>
      a_w_2(i,k,j) = -(a_w_2(i,k,j)*(mut(i,j)/msft(i,j)))<a name='1997'>
      a_w_2(i,k,j) = a_w_2(i,k,j)+a_w_save(i,k,j)<a name='1998'>
      a_w_save(i,k,j) = 0.<a name='1999'>
    end do<a name='2000'>
  end do<a name='2001'>
end do<a name='2002'>
do j = j_start, j_end<a name='2003'>
  do k = k_start, k_end<a name='2004'>
    do i = i_start, i_end<a name='2005'>
      a_mut(i,j) = a_mut(i,j)-a_t_2(i,k,j)*t_2(i,k,j)<a name='2006'>
      a_muts(i,j) = a_muts(i,j)+a_t_2(i,k,j)*t_1(i,k,j)<a name='2007'>
      a_t_1(i,k,j) = a_t_1(i,k,j)+a_t_2(i,k,j)*muts(i,j)<a name='2008'>
      a_t_2(i,k,j) = -(a_t_2(i,k,j)*mut(i,j))<a name='2009'>
      a_t_2(i,k,j) = a_t_2(i,k,j)+a_t_save(i,k,j)<a name='2010'>
      a_t_save(i,k,j) = 0.<a name='2011'>
    end do<a name='2012'>
  end do<a name='2013'>
end do<a name='2014'>
do j = j_start, j_endv<a name='2015'>
  do k = k_start, k_end<a name='2016'>
    do i = i_start, i_end<a name='2017'>
      a_muv(i,j) = a_muv(i,j)-a_v_2(i,k,j)*(v_2(i,k,j)/msfv(i,j))<a name='2018'>
      a_muvs(i,j) = a_muvs(i,j)+a_v_2(i,k,j)*(v_1(i,k,j)/msfv(i,j))<a name='2019'>
      a_v_1(i,k,j) = a_v_1(i,k,j)+a_v_2(i,k,j)*(muvs(i,j)/msfv(i,j))<a name='2020'>
      a_v_2(i,k,j) = -(a_v_2(i,k,j)*(muv(i,j)/msfv(i,j)))<a name='2021'>
      a_v_2(i,k,j) = a_v_2(i,k,j)+a_v_save(i,k,j)<a name='2022'>
      a_v_save(i,k,j) = 0.<a name='2023'>
    end do<a name='2024'>
  end do<a name='2025'>
end do<a name='2026'>
do j = j_start, j_end<a name='2027'>
  do k = k_start, k_end<a name='2028'>
    do i = i_start, i_endu<a name='2029'>
      a_muu(i,j) = a_muu(i,j)-a_u_2(i,k,j)*(u_2(i,k,j)/msfu(i,j))<a name='2030'>
      a_muus(i,j) = a_muus(i,j)+a_u_2(i,k,j)*(u_1(i,k,j)/msfu(i,j))<a name='2031'>
      a_u_1(i,k,j) = a_u_1(i,k,j)+a_u_2(i,k,j)*(muus(i,j)/msfu(i,j))<a name='2032'>
      a_u_2(i,k,j) = -(a_u_2(i,k,j)*(muu(i,j)/msfu(i,j)))<a name='2033'>
      a_u_2(i,k,j) = a_u_2(i,k,j)+a_u_save(i,k,j)<a name='2034'>
      a_u_save(i,k,j) = 0.<a name='2035'>
    end do<a name='2036'>
  end do<a name='2037'>
end do<a name='2038'>
do j = j_start, j_end<a name='2039'>
  do k = k_start, k_end<a name='2040'>
    do i = i_start, i_end<a name='2041'>
      a_alt(i,k,j) = a_alt(i,k,j)-a_c2a(i,k,j)*(cpovcv*(pb(i,k,j)+p(i,k,j))/(alt(i,k,j)*alt(i,k,j)))<a name='2042'>
      a_p(i,k,j) = a_p(i,k,j)+a_c2a(i,k,j)*(cpovcv/alt(i,k,j))<a name='2043'>
      a_c2a(i,k,j) = 0.<a name='2044'>
    end do<a name='2045'>
  end do<a name='2046'>
end do<a name='2047'>
do j = j_start, j_end<a name='2048'>
  do i = i_start, i_end<a name='2049'>
    a_ww_save(i,1,j) = 0.<a name='2050'>
    a_ww_save(i,kde,j) = 0.<a name='2051'>
  end do<a name='2052'>
end do<a name='2053'>
if (rk_step .eq. 1 .and. ( .not. leapfrog)) then<a name='2054'>
  do j = j_start, j_end<a name='2055'>
    do i = i_start, i_end<a name='2056'>
      a_mu_2(i,j) = 0.<a name='2057'>
      a_mu_2(i,j) = a_mu_2(i,j)+a_mu_save(i,j)<a name='2058'>
      a_mu_save(i,j) = 0.<a name='2059'>
    end do<a name='2060'>
  end do<a name='2061'>
  do j = j_start, j_endv<a name='2062'>
    do i = i_start, i_end<a name='2063'>
      a_muv(i,j) = a_muv(i,j)+a_muvs(i,j)<a name='2064'>
      a_muvs(i,j) = 0.<a name='2065'>
    end do<a name='2066'>
  end do<a name='2067'>
  do j = j_start, j_end<a name='2068'>
    do i = i_start, i_endu<a name='2069'>
      a_muu(i,j) = a_muu(i,j)+a_muus(i,j)<a name='2070'>
      a_muus(i,j) = 0.<a name='2071'>
    end do<a name='2072'>
    do i = i_start, i_end<a name='2073'>
      a_mu_2(i,j) = a_mu_2(i,j)+a_muts(i,j)<a name='2074'>
      a_muts(i,j) = 0.<a name='2075'>
    end do<a name='2076'>
  end do<a name='2077'>
  do j = j_start, j_end<a name='2078'>
    do k = k_start, min(kde,kte)<a name='2079'>
      do i = i_start, i_end<a name='2080'>
        a_ph_2(i,k,j) = a_ph_2(i,k,j)+a_ph_1(i,k,j)<a name='2081'>
        a_ph_1(i,k,j) = 0.<a name='2082'>
        a_w_2(i,k,j) = a_w_2(i,k,j)+a_w_1(i,k,j)<a name='2083'>
        a_w_1(i,k,j) = 0.<a name='2084'>
      end do<a name='2085'>
    end do<a name='2086'>
  end do<a name='2087'>
  do j = j_start, j_end<a name='2088'>
    do k = k_start, k_end<a name='2089'>
      do i = i_start, i_end<a name='2090'>
        a_t_2(i,k,j) = a_t_2(i,k,j)+a_t_1(i,k,j)<a name='2091'>
        a_t_1(i,k,j) = 0.<a name='2092'>
      end do<a name='2093'>
    end do<a name='2094'>
  end do<a name='2095'>
  do j = j_start, j_endv<a name='2096'>
    do k = k_start, k_end<a name='2097'>
      do i = i_start, i_end<a name='2098'>
        a_v_2(i,k,j) = a_v_2(i,k,j)+a_v_1(i,k,j)<a name='2099'>
        a_v_1(i,k,j) = 0.<a name='2100'>
      end do<a name='2101'>
    end do<a name='2102'>
  end do<a name='2103'>
  do j = j_start, j_end<a name='2104'>
    do k = k_start, k_end<a name='2105'>
      do i = i_start, i_endu<a name='2106'>
        a_u_2(i,k,j) = a_u_2(i,k,j)+a_u_1(i,k,j)<a name='2107'>
        a_u_1(i,k,j) = 0.<a name='2108'>
      end do<a name='2109'>
    end do<a name='2110'>
  end do<a name='2111'>
  do j = j_start, j_end<a name='2112'>
    do i = i_start, i_end<a name='2113'>
      a_mudf(i,j) = 0.<a name='2114'>
      a_ww_save(i,1,j) = 0.<a name='2115'>
      a_ww_save(i,kde,j) = 0.<a name='2116'>
      a_mu_2(i,j) = a_mu_2(i,j)+a_mu_1(i,j)<a name='2117'>
      a_mu_1(i,j) = 0.<a name='2118'>
    end do<a name='2119'>
  end do<a name='2120'>
else<a name='2121'>
<font color=#447700>!---------- zzma -----------<a name='2122'></font>
  do j = j_start, j_end<a name='2123'>
    do i = i_start, i_end<a name='2124'>
<font color=#447700>!      a_mu_1(i,j) = 0.0<a name='2125'></font>
    end do<a name='2126'>
  end do<a name='2127'>
  do j = j_start, j_endv<a name='2128'>
    do i = i_start, i_end<a name='2129'>
<font color=#447700>!      a_mu_1(i,j) = 0.0<a name='2130'></font>
    end do<a name='2131'>
  end do<a name='2132'>
  do j = j_start, j_endv<a name='2133'>
    do i = i_start, i_endu<a name='2134'>
<font color=#447700>!      a_mu_1(i,j) = 0.0<a name='2135'></font>
    end do<a name='2136'>
  end do<a name='2137'>
<a name='2138'>
<font color=#447700>!   a_mu_1=0<a name='2139'></font>
<font color=#447700>!   a_u_1=0<a name='2140'></font>
<font color=#447700>!   a_v_1=0<a name='2141'></font>
<font color=#447700>!   a_w_1=0<a name='2142'></font>
<font color=#447700>!   a_t_1=0<a name='2143'></font>
<font color=#447700>!  a_ph_1=0<a name='2144'></font>
<font color=#447700>!  a_muts =0<a name='2145'></font>
<font color=#447700>!  a_muvs=0<a name='2146'></font>
<font color=#447700>!  a_muus=0<a name='2147'></font>
<font color=#447700>!  a_mu_save=0<a name='2148'></font>
<a name='2149'>
<font color=#447700>!---------- zzma -----------<a name='2150'></font>
  do j = j_start, j_end<a name='2151'>
    do i = i_start, i_end<a name='2152'>
      a_mu_1(i,j) = a_mu_1(i,j)+a_mu_2(i,j)<a name='2153'>
      a_mu_2(i,j) = -a_mu_2(i,j)<a name='2154'>
      a_mu_2(i,j) = a_mu_2(i,j)+a_mu_save(i,j)<a name='2155'>
      a_mu_save(i,j) = 0.<a name='2156'>
    end do<a name='2157'>
  end do<a name='2158'>
  do j = j_start, j_endv<a name='2159'>
    do i = i_start, i_end<a name='2160'>
      a_mu_1(i,j-1) = a_mu_1(i,j-1)+0.5*a_muvs(i,j)<a name='2161'>
      a_mu_1(i,j) = a_mu_1(i,j)+0.5*a_muvs(i,j)<a name='2162'>
      a_muvs(i,j) = 0.<a name='2163'>
    end do<a name='2164'>
  end do<a name='2165'>
  do j = j_start, j_end<a name='2166'>
    do i = i_start, i_endu<a name='2167'>
      a_mu_1(i-1,j) = a_mu_1(i-1,j)+0.5*a_muus(i,j)<a name='2168'>
      a_mu_1(i,j) = a_mu_1(i,j)+0.5*a_muus(i,j)<a name='2169'>
      a_muus(i,j) = 0.<a name='2170'>
    end do<a name='2171'>
    do i = i_start, i_end<a name='2172'>
      a_mu_1(i,j) = a_mu_1(i,j)+a_muts(i,j)<a name='2173'>
      a_muts(i,j) = 0.<a name='2174'>
    end do<a name='2175'>
  end do<a name='2176'>
endif<a name='2177'>
<a name='2178'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SMALL_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_93">("a_small_step_prep")<a name='2179'>
<a name='2180'>
end subroutine a_small_step_prep<a name='2181'>
<a name='2182'>
<a name='2183'>
<A NAME='A_SUMFLUX'><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SUMFLUX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2184'>
<font color=#993300>subroutine </font><font color=#cc0000>a_sumflux</font>( a_ru, a_rv, a_ww, u_lin, a_u_lin, v_lin, a_v_lin, a_ww_lin, muu, a_muu, muv, a_muv, a_ru_m, a_rv_m, a_ww_m, &amp; <A href='../../call_to/A_SUMFLUX.html' TARGET='index'>2</A>,<A href='../../call_from/A_SUMFLUX.html' TARGET='index'>2</A><a name='2185'>
&amp;msfu, msfv, iteration, number_of_small_timesteps, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='2186'>
<font color=#447700>!******************************************************************<a name='2187'></font>
<font color=#447700>!******************************************************************<a name='2188'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='2189'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='2190'></font>
<font color=#447700>!******************************************************************<a name='2191'></font>
<font color=#447700>!******************************************************************<a name='2192'></font>
<font color=#447700>!==============================================<a name='2193'></font>
<font color=#447700>! all entries are defined explicitly<a name='2194'></font>
<font color=#447700>!==============================================<a name='2195'></font>
implicit none<a name='2196'>
<a name='2197'>
<font color=#447700>!==============================================<a name='2198'></font>
<font color=#447700>! declare arguments<a name='2199'></font>
<font color=#447700>!==============================================<a name='2200'></font>
integer, intent(in) :: ime<a name='2201'>
integer, intent(in) :: ims<a name='2202'>
integer, intent(in) :: jme<a name='2203'>
integer, intent(in) :: jms<a name='2204'>
real, intent(inout) :: a_muu(ims:ime,jms:jme)<a name='2205'>
real, intent(inout) :: a_muv(ims:ime,jms:jme)<a name='2206'>
integer, intent(in) :: kme<a name='2207'>
integer, intent(in) :: kms<a name='2208'>
real, intent(inout) :: a_ru(ims:ime,kms:kme,jms:jme)<a name='2209'>
real, intent(inout) :: a_ru_m(ims:ime,kms:kme,jms:jme)<a name='2210'>
real, intent(inout) :: a_rv(ims:ime,kms:kme,jms:jme)<a name='2211'>
real, intent(inout) :: a_rv_m(ims:ime,kms:kme,jms:jme)<a name='2212'>
real, intent(inout) :: a_u_lin(ims:ime,kms:kme,jms:jme)<a name='2213'>
real, intent(inout) :: a_v_lin(ims:ime,kms:kme,jms:jme)<a name='2214'>
real, intent(inout) :: a_ww(ims:ime,kms:kme,jms:jme)<a name='2215'>
real, intent(inout) :: a_ww_lin(ims:ime,kms:kme,jms:jme)<a name='2216'>
real, intent(inout) :: a_ww_m(ims:ime,kms:kme,jms:jme)<a name='2217'>
integer, intent(in) :: ide<a name='2218'>
integer, intent(in) :: ite<a name='2219'>
integer, intent(in) :: iteration<a name='2220'>
integer, intent(in) :: its<a name='2221'>
integer, intent(in) :: jde<a name='2222'>
integer, intent(in) :: jte<a name='2223'>
integer, intent(in) :: jts<a name='2224'>
integer, intent(in) :: kde<a name='2225'>
integer, intent(in) :: kte<a name='2226'>
integer, intent(in) :: kts<a name='2227'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='2228'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='2229'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='2230'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='2231'>
integer, intent(in) :: number_of_small_timesteps<a name='2232'>
real, intent(in) :: u_lin(ims:ime,kms:kme,jms:jme)<a name='2233'>
real, intent(in) :: v_lin(ims:ime,kms:kme,jms:jme)<a name='2234'>
<a name='2235'>
<font color=#447700>!==============================================<a name='2236'></font>
<font color=#447700>! declare local variables<a name='2237'></font>
<font color=#447700>!==============================================<a name='2238'></font>
integer i<a name='2239'>
integer j<a name='2240'>
integer k<a name='2241'>
<a name='2242'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SUMFLUX' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_94">("a_sumflux")<a name='2243'>
<a name='2244'>
<font color=#447700>!----------------------------------------------<a name='2245'></font>
<font color=#447700>! ROUTINE BODY<a name='2246'></font>
<font color=#447700>!----------------------------------------------<a name='2247'></font>
if (iteration .eq. number_of_small_timesteps) then<a name='2248'>
  do j = jts, min(jde-1,jte)<a name='2249'>
    do k = kts, kte<a name='2250'>
      do i = its, min(ide-1,ite)<a name='2251'>
        a_ww_lin(i,k,j) = a_ww_lin(i,k,j)+a_ww_m(i,k,j)<a name='2252'>
        a_ww_m(i,k,j) = a_ww_m(i,k,j)/float(number_of_small_timesteps)<a name='2253'>
      end do<a name='2254'>
    end do<a name='2255'>
  end do<a name='2256'>
  do j = jts, jte<a name='2257'>
    do k = kts, min(kde-1,kte)<a name='2258'>
      do i = its, min(ide-1,ite)<a name='2259'>
        a_muv(i,j) = a_muv(i,j)+a_rv_m(i,k,j)*(v_lin(i,k,j)/msfv(i,j))<a name='2260'>
        a_v_lin(i,k,j) = a_v_lin(i,k,j)+a_rv_m(i,k,j)*(muv(i,j)/msfv(i,j))<a name='2261'>
        a_rv_m(i,k,j) = a_rv_m(i,k,j)/float(number_of_small_timesteps)<a name='2262'>
      end do<a name='2263'>
    end do<a name='2264'>
  end do<a name='2265'>
  do j = jts, min(jde-1,jte)<a name='2266'>
    do k = kts, min(kde-1,kte)<a name='2267'>
      do i = its, ite<a name='2268'>
        a_muu(i,j) = a_muu(i,j)+a_ru_m(i,k,j)*(u_lin(i,k,j)/msfu(i,j))<a name='2269'>
        a_u_lin(i,k,j) = a_u_lin(i,k,j)+a_ru_m(i,k,j)*(muu(i,j)/msfu(i,j))<a name='2270'>
        a_ru_m(i,k,j) = a_ru_m(i,k,j)/float(number_of_small_timesteps)<a name='2271'>
      end do<a name='2272'>
    end do<a name='2273'>
  end do<a name='2274'>
endif<a name='2275'>
do j = jts, min(jde-1,jte)<a name='2276'>
  do k = kts, kte<a name='2277'>
    do i = its, min(ide-1,ite)<a name='2278'>
      a_ww(i,k,j) = a_ww(i,k,j)+a_ww_m(i,k,j)<a name='2279'>
    end do<a name='2280'>
  end do<a name='2281'>
end do<a name='2282'>
do j = jts, jte<a name='2283'>
  do k = kts, min(kde-1,kte)<a name='2284'>
    do i = its, min(ide-1,ite)<a name='2285'>
      a_rv(i,k,j) = a_rv(i,k,j)+a_rv_m(i,k,j)<a name='2286'>
    end do<a name='2287'>
  end do<a name='2288'>
end do<a name='2289'>
do j = jts, min(jde-1,jte)<a name='2290'>
  do k = kts, min(kde-1,kte)<a name='2291'>
    do i = its, ite<a name='2292'>
      a_ru(i,k,j) = a_ru(i,k,j)+a_ru_m(i,k,j)<a name='2293'>
    end do<a name='2294'>
  end do<a name='2295'>
end do<a name='2296'>
if (iteration .eq. 1) then<a name='2297'>
  do j = jts, jte<a name='2298'>
    do k = kts, kte<a name='2299'>
      do i = its, ite<a name='2300'>
        a_ww_m(i,k,j) = 0.<a name='2301'>
        a_rv_m(i,k,j) = 0.<a name='2302'>
        a_ru_m(i,k,j) = 0.<a name='2303'>
      end do<a name='2304'>
    end do<a name='2305'>
  end do<a name='2306'>
endif<a name='2307'>
<a name='2308'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SUMFLUX' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_94">("a_sumflux")<a name='2309'>
<a name='2310'>
end subroutine a_sumflux<a name='2311'>
<a name='2312'>
<a name='2313'>
end module     a_module_small_step_em<a name='2314'>
<a name='2315'>
<a name='2316'>
</pre></body></html>