<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!-------------------------------------------------------------------<a name='2'></font>
<a name='3'>
<A NAME='START_DOMAIN_EM'><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>start_domain_em</font> ( grid, allowed_to_read , &amp; <A href='../../call_to/START_DOMAIN_EM.html' TARGET='index'>1</A>,<A href='../../call_from/START_DOMAIN_EM.html' TARGET='index'>57</A><a name='5'>
<font color=#447700>! Actual arguments generated from Registry<a name='6'></font>
# include &lt;<A href='../../html_code/include/em_dummy_args.inc.html'>em_dummy_args.inc</A>&gt;<A NAME="em_dummy_args.inc_1"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7'>
<font color=#447700>!<a name='8'></font>
)<a name='9'>
<a name='10'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_18"><a name='11'>
<font color=#447700>!  USE module_io_domain<a name='12'></font>
   USE module_state_description<a name='13'>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_27"><a name='14'>
   USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_24"><a name='15'>
   USE <A href='../../html_code/dyn_em/module_bc_em.F.html#MODULE_BC_EM'>module_bc_em</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_EM_7"><a name='16'>
<font color=#447700>!  USE module_timing<a name='17'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_31"><a name='18'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_1"><a name='19'>
   USE <A href='../../html_code/frame/module_tiles.F.html#MODULE_TILES'>module_tiles</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TILES_6"><a name='20'>
<a name='21'>
   USE <A href='../../html_code/phys/module_physics_init.F.html#MODULE_PHYSICS_INIT'>module_physics_init</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_PHYSICS_INIT_1"><a name='22'>
<a name='23'>
#ifdef DM_PARALLEL<a name='24'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_15"><a name='25'>
#endif<a name='26'>
<a name='27'>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_28"><a name='28'>
   IMPLICIT NONE<a name='29'>
   <font color=#447700>!  Input data.<a name='30'></font>
   TYPE (domain)          :: grid<a name='31'>
   LOGICAL , INTENT(IN)   :: allowed_to_read<a name='32'>
<a name='33'>
   <font color=#447700>!  Definitions of dummy arguments to this routine (generated from Registry).<a name='34'></font>
# include &lt;<A href='../../html_code/include/em_dummy_decl.inc.html'>em_dummy_decl.inc</A>&gt;<A NAME="em_dummy_decl.inc_2"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='35'>
<a name='36'>
   <font color=#447700>!  Structure that contains run-time configuration (namelist) data for domain<a name='37'></font>
   TYPE (grid_config_rec_type)              :: config_flags<a name='38'>
<a name='39'>
   <font color=#447700>!  Local data<a name='40'></font>
   INTEGER                             ::                       &amp;<a name='41'>
                                  ids, ide, jds, jde, kds, kde, &amp;<a name='42'>
                                  ims, ime, jms, jme, kms, kme, &amp;<a name='43'>
                                  ips, ipe, jps, jpe, kps, kpe, &amp;<a name='44'>
                                  its, ite, jts, jte, kts, kte, &amp;<a name='45'>
                                  ij,i,j,k,ii,jj,kk,loop,error,l<a name='46'>
                                  <a name='47'>
<font color=#447700>! These are used if -DDEREF_KLUDGE is compiled<a name='48'></font>
<font color=#447700>!  see http://www.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='49'></font>
   INTEGER     :: sm31  , em31  , sm32  , em32  , sm33  , em33<a name='50'>
   INTEGER     :: sm31x , em31x , sm32x , em32x , sm33x , em33x<a name='51'>
   INTEGER     :: sm31y , em31y , sm32y , em32y , sm33y , em33y<a name='52'>
<a name='53'>
   INTEGER     :: hr, mn, sec, ms, rc<a name='54'>
<a name='55'>
   CHARACTER*80 :: message<a name='56'>
<a name='57'>
   REAL :: qvf1, qvf2, qvf<a name='58'>
   REAL :: MPDT<a name='59'>
   LOGICAL :: first_trip_for_this_domain<a name='60'>
   REAL    :: wgt1, wgt2, zw, z1, z2<a name='61'>
<a name='62'>
<font color=#447700>! Trick problematic compilers into not performing copy-in/copy-out by adding<a name='63'></font>
<font color=#447700>! indices to array arguments in the CALL statements in this routine.<a name='64'></font>
<font color=#447700>! It has the effect of passing only the first element of the array, rather <a name='65'></font>
<font color=#447700>! than the entire array.  See:  <a name='66'></font>
<font color=#447700>! http://www.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='67'></font>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_3"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='68'>
<a name='69'>
<font color=#447700>! Limit the number of arguments if compiled with -DLIMIT_ARGS by copying <a name='70'></font>
<font color=#447700>! scalar (non-array) arguments out of the grid data structure into locally<a name='71'></font>
<font color=#447700>! defined copies (defined in em_dummy_decl.inc, above, as they are if they<a name='72'></font>
<font color=#447700>! are arguments). An equivalent include of em_scalar_derefs.inc appears<a name='73'></font>
<font color=#447700>! at the end of the routine to copy back any chnaged non-array values.<a name='74'></font>
<font color=#447700>! The definition of COPY_IN or COPY_OUT before the include defines the<a name='75'></font>
<font color=#447700>! direction of the copy.  Em_scalar_derefs.inc is generated from Registry<a name='76'></font>
#define COPY_IN<a name='77'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_4"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='78'>
<a name='79'>
<font color=#447700>! Needed by some comm layers, e.g. RSL. If needed, nmm_data_calls.inc is<a name='80'></font>
<font color=#447700>! generated from the registry.  The definition of REGISTER_I1 allows<a name='81'></font>
<font color=#447700>! I1 data to be communicated in this routine if necessary.<a name='82'></font>
#ifdef DM_PARALLEL<a name='83'>
#    include &lt;<A href='../../html_code/include/em_data_calls.inc.html'>em_data_calls.inc</A>&gt;<A NAME="em_data_calls.inc_5"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='84'>
#endif<a name='85'>
   CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_9"> (  grid ,                   &amp;<a name='86'>
                             ids, ide, jds, jde, kds, kde,    &amp;<a name='87'>
                             ims, ime, jms, jme, kms, kme,    &amp;<a name='88'>
                             ips, ipe, jps, jpe, kps, kpe    )<a name='89'>
<a name='90'>
   kts = kps ; kte = kpe     <font color=#447700>! note that tile is entire patch<a name='91'></font>
   its = ips ; ite = ipe     <font color=#447700>! note that tile is entire patch<a name='92'></font>
   jts = jps ; jte = jpe    <font color=#447700>! note that tile is entire patch<a name='93'></font>
<a name='94'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_8"> ( grid%id , model_config_rec , config_flags )<a name='95'>
<a name='96'>
<font color=#447700>! here we check to see if the boundary conditions are set properly<a name='97'></font>
<a name='98'>
   CALL <A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK'>boundary_condition_check</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BOUNDARY_CONDITION_CHECK_8">( config_flags, bdyzone, error, grid%id )<a name='99'>
<a name='100'>
<font color=#447700>!kludge - need to stop CG from resetting precip and phys tendencies to zero<a name='101'></font>
<font color=#447700>!         when we are in here due to a nest being spawned, we want to still<a name='102'></font>
<font color=#447700>!         recompute the base state, but that is about it<a name='103'></font>
   <font color=#447700>!  This is temporary and will need to be changed when itimestep is removed.<a name='104'></font>
<a name='105'>
   IF ( itimestep .EQ. 0 ) THEN<a name='106'>
      first_trip_for_this_domain = .TRUE.<a name='107'>
   ELSE<a name='108'>
      first_trip_for_this_domain = .FALSE.<a name='109'>
   END IF<a name='110'>
<a name='111'>
   IF ( .not. restart ) THEN <a name='112'>
       itimestep=0<a name='113'>
   ENDIF<a name='114'>
<a name='115'>
   IF ( restart .or. moved ) THEN <a name='116'>
       first_trip_for_this_domain = .TRUE.<a name='117'>
   ENDIF<a name='118'>
   <a name='119'>
   IF (config_flags%specified) THEN<a name='120'>
<font color=#447700>!<a name='121'></font>
<font color=#447700>! Arrays for specified boundary conditions<a name='122'></font>
<a name='123'>
<a name='124'>
     DO loop = spec_zone + 1, spec_zone + relax_zone<a name='125'>
       fcx(loop) = 0.1 / dt * (spec_zone + relax_zone - loop) / (relax_zone - 1)<a name='126'>
       gcx(loop) = 1.0 / dt / 50. * (spec_zone + relax_zone - loop) / (relax_zone - 1)<a name='127'>
     ENDDO<a name='128'>
<a name='129'>
   ELSE IF (config_flags%nested) THEN<a name='130'>
<font color=#447700>!<a name='131'></font>
<font color=#447700>! Arrays for specified boundary conditions<a name='132'></font>
<a name='133'>
     DO loop = spec_zone + 1, spec_zone + relax_zone<a name='134'>
<font color=#447700>!       fcx(loop) = 0.1 / dt * (spec_zone + relax_zone - loop) / (relax_zone - 1)<a name='135'></font>
<font color=#447700>!       gcx(loop) = 1.0 / dt / 50. * (spec_zone + relax_zone - loop) / (relax_zone - 1)<a name='136'></font>
       fcx(loop) = 0.<a name='137'>
       gcx(loop) = 0.<a name='138'>
     ENDDO<a name='139'>
<a name='140'>
     dtbc = 0.<a name='141'>
<a name='142'>
   ENDIF<a name='143'>
<a name='144'>
   IF(.not.config_flags%restart)THEN<a name='145'>
<a name='146'>
<font color=#447700>!  if this is for a nested domain, the defined/interpolated fields are the _2<a name='147'></font>
<a name='148'>
     IF ( first_trip_for_this_domain ) THEN<a name='149'>
<a name='150'>
<font color=#447700>! data that is expected to be zero must be explicitly initialized as such<a name='151'></font>
     h_diabatic = 0.<a name='152'>
<a name='153'>
       DO j = jts,min(jte,jde-1)<a name='154'>
       DO k = kts,kte-1<a name='155'>
       DO i = its, min(ite,ide-1)<a name='156'>
           IF ( imask_nostag(i,j) .EQ. 1 ) THEN<a name='157'>
             moist_1(i,k,j,P_QV)=moist_2(i,k,j,P_QV)<a name='158'>
             t_1(i,k,j)=t_2(i,k,j)<a name='159'>
           ENDIF<a name='160'>
       ENDDO<a name='161'>
       ENDDO<a name='162'>
       ENDDO<a name='163'>
  <a name='164'>
       DO j = jts,min(jte,jde-1)<a name='165'>
       DO i = its, min(ite,ide-1)<a name='166'>
           IF ( imask_nostag(i,j) .EQ. 1 ) THEN<a name='167'>
             mu_1(i,j)=mu_2(i,j)<a name='168'>
           ENDIF<a name='169'>
       ENDDO<a name='170'>
       ENDDO<a name='171'>
     END IF<a name='172'>
<a name='173'>
<font color=#447700>!  reconstitute base-state fields<a name='174'></font>
<a name='175'>
     DO j = jts,min(jte,jde-1)<a name='176'>
     DO k = kts,kte-1<a name='177'>
     DO i = its, min(ite,ide-1)<a name='178'>
       IF ( imask_nostag(i,j) .EQ. 1 ) THEN<a name='179'>
         pb(i,k,j) = znu(k)*mub(i,j)+p_top<a name='180'>
         alb(i,k,j) = -rdnw(k)*(phb(i,k+1,j)-phb(i,k,j))/mub(i,j)<a name='181'>
         t_init(i,k,j) = alb(i,k,j)*(p1000mb/r_d)/((pb(i,k,j)/p1000mb)**cvpm) - t0<a name='182'>
       ENDIF<a name='183'>
     ENDDO<a name='184'>
     ENDDO<a name='185'>
     ENDDO<a name='186'>
<a name='187'>
     DO j = jts,min(jte,jde-1)<a name='188'>
<a name='189'>
       k = kte-1<a name='190'>
       DO i = its, min(ite,ide-1)<a name='191'>
         IF ( imask_nostag(i,j) .EQ. 1 ) THEN<a name='192'>
           qvf1 = 0.5*(moist_1(i,k,j,P_QV)+moist_1(i,k,j,P_QV))<a name='193'>
           qvf2 = 1./(1.+qvf1)<a name='194'>
           qvf1 = qvf1*qvf2<a name='195'>
           p(i,k,j) = - 0.5*(mu_1(i,j)+qvf1*mub(i,j))/rdnw(k)/qvf2<a name='196'>
           qvf = 1. + rvovrd*moist_1(i,k,j,P_QV)<a name='197'>
           alt(i,k,j) = (r_d/p1000mb)*(t_1(i,k,j)+t0)*qvf*(((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm)<a name='198'>
           al(i,k,j) = alt(i,k,j) - alb(i,k,j)<a name='199'>
         ENDIF<a name='200'>
       ENDDO<a name='201'>
<a name='202'>
       DO k = kte-2, 1, -1<a name='203'>
       DO i = its, min(ite,ide-1)<a name='204'>
         IF ( imask_nostag(i,j) .EQ. 1 ) THEN<a name='205'>
           qvf1 = 0.5*(moist_1(i,k,j,P_QV)+moist_1(i,k+1,j,P_QV))<a name='206'>
           qvf2 = 1./(1.+qvf1)<a name='207'>
           qvf1 = qvf1*qvf2<a name='208'>
           p(i,k,j) = p(i,k+1,j) - (mu_1(i,j) + qvf1*mub(i,j))/qvf2/rdn(k+1)<a name='209'>
           qvf = 1. + rvovrd*moist_1(i,k,j,P_QV)<a name='210'>
           alt(i,k,j) = (r_d/p1000mb)*(t_1(i,k,j)+t0)*qvf* &amp;<a name='211'>
                        (((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm)<a name='212'>
           al(i,k,j) = alt(i,k,j) - alb(i,k,j)<a name='213'>
         ENDIF<a name='214'>
       ENDDO<a name='215'>
       ENDDO<a name='216'>
<a name='217'>
     ENDDO<a name='218'>
<a name='219'>
   ENDIF<a name='220'>
<a name='221'>
   IF ( first_trip_for_this_domain ) THEN<a name='222'>
<a name='223'>
   CALL wrf_debug ( 100 , 'module_start: start_domain_rk: Before call to phy_init' )<a name='224'>
<a name='225'>
<font color=#447700>! namelist MPDT does not exist yet, so set it here<a name='226'></font>
<font color=#447700>! MPDT is the call frequency for microphysics in minutes (0 means every step)<a name='227'></font>
   MPDT = 0.<a name='228'>
<a name='229'>
<font color=#447700>! set GMT outside of phy_init because phy_init may not be called on this<a name='230'></font>
<font color=#447700>! process if, for example, it is a moving nest and if this part of the domain is not<a name='231'></font>
<font color=#447700>! being initialized (not the leading edge).<a name='232'></font>
   IF ( .NOT. grid%restart ) THEN<a name='233'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_1">(150, grid%domain_clock, &amp;<a name='234'>
                         'DEBUG phy_init():  get currTime from grid%domain_clock,')<a name='235'>
     CALL ESMF_ClockGet( grid%domain_clock, currTime=grid%current_time, rc=rc )<a name='236'>
     CALL ESMF_TimeGet( grid%current_time, YY=julyr, dayOfYear=julday, H=hr, M=mn, S=sec, MS=ms, rc=rc)<a name='237'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_1"> ( grid%current_time, message )<a name='238'>
     WRITE( wrf_err_message , * ) 'DEBUG start_em():  currTime = [',TRIM( message ),']'<a name='239'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_57">( 150, TRIM(wrf_err_message) )<a name='240'>
     gmt=hr+real(mn)/60.+real(sec)/3600.+real(ms)/(1000*3600)<a name='241'>
     WRITE( wrf_err_message , * ) 'DEBUG start_em():  julyr,hr,mn,sec,ms,julday = ', &amp;<a name='242'>
                                  julyr,hr,mn,sec,ms,julday<a name='243'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_58">( 150, TRIM(wrf_err_message) )<a name='244'>
     WRITE( wrf_err_message , * ) 'DEBUG start_em():  gmt = ',gmt<a name='245'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_59">( 150, TRIM(wrf_err_message) )<a name='246'>
   ELSE<a name='247'>
     CALL nl_get_julyr (grid%id, julyr)<a name='248'>
     CALL nl_get_julday (grid%id, julday)<a name='249'>
     CALL nl_get_gmt (grid%id, gmt)<a name='250'>
   END IF<a name='251'>
<a name='252'>
   CALL <A href='../../html_code/frame/module_tiles.F.html#SET_TILES'>set_tiles</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_TILES_5"> ( grid , imask_nostag, ims, ime, jms, jme, ips, ipe, jps, jpe )<a name='253'>
<a name='254'>
<font color=#447700>! Phy_init is not necessarily thread-safe; do not multi-thread this loop.<a name='255'></font>
<font color=#447700>! The tiling is to handle the fact that we may be masking off part of the computation.<a name='256'></font>
   DO ij = 1, grid%num_tiles<a name='257'>
<a name='258'>
     CALL <A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT'>phy_init</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_INIT_1"> (  grid,                                   &amp;  <a name='259'>
                      grid%id , config_flags, DT, znw, znu,   &amp;<a name='260'>
                      p_top, TSK, RADT,BLDT,CUDT, MPDT,       &amp;<a name='261'>
                      RTHCUTEN, RQVCUTEN, RQRCUTEN,           &amp;<a name='262'>
                      RQCCUTEN, RQSCUTEN, RQICUTEN,           &amp;<a name='263'>
                      RUBLTEN,RVBLTEN,RTHBLTEN,               &amp;<a name='264'>
                      RQVBLTEN,RQCBLTEN,RQIBLTEN,             &amp;<a name='265'>
                      RTHRATEN,RTHRATENLW,RTHRATENSW,         &amp;<a name='266'>
                      STEPBL,STEPRA,STEPCU,                   &amp;<a name='267'>
                      W0AVG, RAINNC, RAINC, RAINCV, RAINNCV,  &amp;<a name='268'>
                      NCA,                                    &amp;<a name='269'>
                      CLDEFI,LOWLYR,                          &amp;<a name='270'>
                      MASS_FLUX,                              &amp;<a name='271'>
                      RTHFTEN, RQVFTEN,                       &amp;<a name='272'>
                      CLDFRA,GLW,GSW,EMISS,LU_INDEX,          &amp;<a name='273'>
                      XLAT,XLONG,ALBEDO,ALBBCK,GMT,JULYR,JULDAY,     &amp;<a name='274'>
                      TMN,XLAND,ZNT,Z0,UST,MOL,PBLH,TKE_MYJ,     &amp;<a name='275'>
                      EXCH_H,THC,SNOWC,MAVAIL,HFX,QFX,RAINBL, &amp;<a name='276'>
                      TSLB,ZS,DZS,num_soil_layers,warm_rain,  &amp;<a name='277'>
                      APR_GR,APR_W,APR_MC,APR_ST,APR_AS,      &amp;<a name='278'>
                      APR_CAPMA,APR_CAPME,APR_CAPMI,          &amp;<a name='279'>
                      XICE,VEGFRA,SNOW,CANWAT,SMSTAV,         &amp;<a name='280'>
                      SMSTOT, SFCRUNOFF,UDRUNOFF,GRDFLX,ACSNOW,      &amp;<a name='281'>
                      ACSNOM,IVGTYP,ISLTYP, SFCEVP,SMOIS,     &amp;<a name='282'>
                      SH2O, SNOWH, SMFR3D,                    &amp;<a name='283'>
                      DX,DY,F_ICE_PHY,F_RAIN_PHY,F_RIMEF_PHY, &amp;<a name='284'>
                      allowed_to_read, moved ,                &amp;<a name='285'>
                      ids, ide, jds, jde, kds, kde,           &amp;<a name='286'>
                      ims, ime, jms, jme, kms, kme,           &amp;<a name='287'>
                      grid%i_start(ij), grid%i_end(ij), grid%j_start(ij), grid%j_end(ij), kts, kte           )<a name='288'>
<a name='289'>
   ENDDO<a name='290'>
<a name='291'>
<font color=#447700>!                     SH2O, SNOWH, FNDSOILW, FNDSNOWH,        &amp;  ! correct one<a name='292'></font>
<a name='293'>
   CALL wrf_debug ( 100 , 'module_start: start_domain_rk: After call to phy_init' )<a name='294'>
<a name='295'>
#ifdef MCELIO<a name='296'>
   LU_MASK = 0.<a name='297'>
   WHERE ( LU_INDEX .EQ. 16 ) LU_MASK = 1.<a name='298'>
#endif<a name='299'>
<a name='300'>
   END IF<a name='301'>
<a name='302'>
<font color=#447700>!<a name='303'></font>
<font color=#447700>!<a name='304'></font>
<a name='305'>
 <font color=#447700>!  set physical boundary conditions for all initialized variables<a name='306'></font>
<a name='307'>
<font color=#447700>!-----------------------------------------------------------------------<a name='308'></font>
<font color=#447700>!  Stencils for patch communications  (WCS, 29 June 2001)<a name='309'></font>
<font color=#447700>!  Note:  the size of this halo exchange reflects the <a name='310'></font>
<font color=#447700>!         fact that we are carrying the uncoupled variables <a name='311'></font>
<font color=#447700>!         as state variables in the mass coordinate model, as<a name='312'></font>
<font color=#447700>!         opposed to the coupled variables as in the height<a name='313'></font>
<font color=#447700>!         coordinate model.<a name='314'></font>
<font color=#447700>!<a name='315'></font>
<font color=#447700>!                           * * * * *<a name='316'></font>
<font color=#447700>!         *        * * *    * * * * *<a name='317'></font>
<font color=#447700>!       * + *      * + *    * * + * * <a name='318'></font>
<font color=#447700>!         *        * * *    * * * * *<a name='319'></font>
<font color=#447700>!                           * * * * *<a name='320'></font>
<font color=#447700>!<a name='321'></font>
<font color=#447700>!j  u_1                          x<a name='322'></font>
<font color=#447700>!j  u_2                          x<a name='323'></font>
<font color=#447700>!j  v_1                          x<a name='324'></font>
<font color=#447700>!j  v_2                          x<a name='325'></font>
<font color=#447700>!j  w_1                          x<a name='326'></font>
<font color=#447700>!j  w_2                          x<a name='327'></font>
<font color=#447700>!j  t_1                          x<a name='328'></font>
<font color=#447700>!j  t_2                          x<a name='329'></font>
<font color=#447700>!j ph_1                          x<a name='330'></font>
<font color=#447700>!j ph_2                          x<a name='331'></font>
<font color=#447700>!<a name='332'></font>
<font color=#447700>!j  t_init                       x<a name='333'></font>
<font color=#447700>!<a name='334'></font>
<font color=#447700>!j  phb   x<a name='335'></font>
<font color=#447700>!j  ph0   x<a name='336'></font>
<font color=#447700>!j  php   x<a name='337'></font>
<font color=#447700>!j   pb   x<a name='338'></font>
<font color=#447700>!j   al   x<a name='339'></font>
<font color=#447700>!j  alt   x<a name='340'></font>
<font color=#447700>!j  alb   x<a name='341'></font>
<font color=#447700>!<a name='342'></font>
<font color=#447700>!  the following are 2D (xy) variables<a name='343'></font>
<font color=#447700>!<a name='344'></font>
<font color=#447700>!j mu_1                          x<a name='345'></font>
<font color=#447700>!j mu_2                          x<a name='346'></font>
<font color=#447700>!j mub   x<a name='347'></font>
<font color=#447700>!j mu0   x<a name='348'></font>
<font color=#447700>!j ht    x<a name='349'></font>
<font color=#447700>!j msft  x<a name='350'></font>
<font color=#447700>!j msfu  x<a name='351'></font>
<font color=#447700>!j msfv  x<a name='352'></font>
<font color=#447700>!j sina  x<a name='353'></font>
<font color=#447700>!j cosa  x<a name='354'></font>
<font color=#447700>!j e     x<a name='355'></font>
<font color=#447700>!j f     x<a name='356'></font>
<font color=#447700>!<a name='357'></font>
<font color=#447700>!  4D variables<a name='358'></font>
<font color=#447700>!<a name='359'></font>
<font color=#447700>! moist_1                        x<a name='360'></font>
<font color=#447700>! moist_2                        x<a name='361'></font>
<font color=#447700>!  chem_1                        x<a name='362'></font>
<font color=#447700>!  chem_2                        x<a name='363'></font>
<a name='364'>
<font color=#447700>!--------------------------------------------------------------<a name='365'></font>
<a name='366'>
<a name='367'>
#ifdef DM_PARALLEL<a name='368'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_INIT.inc.html'>PERIOD_BDY_EM_INIT.inc</A>"<A NAME="PERIOD_BDY_EM_INIT.inc_6"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='369'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_MOIST.inc.html'>PERIOD_BDY_EM_MOIST.inc</A>"<A NAME="PERIOD_BDY_EM_MOIST.inc_7"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='370'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_CHEM.inc.html'>PERIOD_BDY_EM_CHEM.inc</A>"<A NAME="PERIOD_BDY_EM_CHEM.inc_8"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='371'>
#  include "<A href='../../html_code/include/HALO_EM_INIT_1.inc.html'>HALO_EM_INIT_1.inc</A>"<A NAME="HALO_EM_INIT_1.inc_9"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='372'>
#  include "<A href='../../html_code/include/HALO_EM_INIT_2.inc.html'>HALO_EM_INIT_2.inc</A>"<A NAME="HALO_EM_INIT_2.inc_10"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='373'>
#  include "<A href='../../html_code/include/HALO_EM_INIT_3.inc.html'>HALO_EM_INIT_3.inc</A>"<A NAME="HALO_EM_INIT_3.inc_11"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='374'>
#  include "<A href='../../html_code/include/HALO_EM_INIT_4.inc.html'>HALO_EM_INIT_4.inc</A>"<A NAME="HALO_EM_INIT_4.inc_12"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='375'>
#  include "<A href='../../html_code/include/HALO_EM_INIT_5.inc.html'>HALO_EM_INIT_5.inc</A>"<A NAME="HALO_EM_INIT_5.inc_13"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='376'>
#endif<a name='377'>
<a name='378'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_145">( u_1 , 'U' , config_flags ,                  &amp;<a name='379'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='380'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='381'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='382'>
                         its , ite , jts , jte , kts , kte )<a name='383'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_146">( u_2 , 'U' , config_flags ,                  &amp;<a name='384'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='385'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='386'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='387'>
                         its , ite , jts , jte , kts , kte )<a name='388'>
<a name='389'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_147">( v_1 , 'V' , config_flags ,                  &amp;<a name='390'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='391'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='392'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='393'>
                         its , ite , jts , jte , kts , kte )<a name='394'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_148">( v_2 , 'V' , config_flags ,                  &amp;<a name='395'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='396'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='397'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='398'>
                         its , ite , jts , jte , kts , kte )<a name='399'>
<a name='400'>
<font color=#447700>! set kinematic condition for w <a name='401'></font>
<a name='402'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_28">( ht , 'r' , config_flags ,                &amp;<a name='403'>
                           ids , ide , jds , jde , &amp;<a name='404'>
                           ims , ime , jms , jme , &amp;<a name='405'>
                           its , ite , jts , jte , &amp;<a name='406'>
                           its , ite , jts , jte   )<a name='407'>
<a name='408'>
   IF ( .not. restart ) THEN <a name='409'>
   CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SET_W_SURFACE'>set_w_surface</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_W_SURFACE_1">(  config_flags,                                      &amp;<a name='410'>
                        w_1, ht, u_1, v_1, cf1, cf2, cf3, rdx, rdy, msft,  &amp;<a name='411'>
                        ids, ide, jds, jde, kds, kde,                      &amp;<a name='412'>
                        ips, ipe, jps, jpe, kps, kpe,                      &amp;<a name='413'>
                        its, ite, jts, jte, kts, kte,                      &amp;<a name='414'>
                        ims, ime, jms, jme, kms, kme                      )<a name='415'>
   CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SET_W_SURFACE'>set_w_surface</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_W_SURFACE_2">(  config_flags,                                      &amp;<a name='416'>
                        w_2, ht, u_2, v_2, cf1, cf2, cf3, rdx, rdy, msft,  &amp;<a name='417'>
                        ids, ide, jds, jde, kds, kde,                      &amp;<a name='418'>
                        ips, ipe, jps, jpe, kps, kpe,                      &amp;<a name='419'>
                        its, ite, jts, jte, kts, kte,                      &amp;<a name='420'>
                        ims, ime, jms, jme, kms, kme                      )<a name='421'>
   END IF<a name='422'>
<a name='423'>
<font color=#447700>! finished setting kinematic condition for w at the surface<a name='424'></font>
<a name='425'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_149">( w_1 , 'W' , config_flags ,                 &amp;<a name='426'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='427'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='428'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='429'>
                         its , ite , jts , jte , kts , kte )<a name='430'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_150">( w_2 , 'W' , config_flags ,                 &amp;<a name='431'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='432'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='433'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='434'>
                         its , ite , jts , jte , kts , kte )<a name='435'>
<a name='436'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_151">( ph_1 , 'W' , config_flags ,                 &amp;<a name='437'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='438'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='439'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='440'>
                         its , ite , jts , jte , kts , kte )<a name='441'>
<a name='442'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_152">( ph_2 , 'W' , config_flags ,                 &amp;<a name='443'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='444'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='445'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='446'>
                         its , ite , jts , jte , kts , kte )<a name='447'>
<a name='448'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_153">( t_1 , 't' , config_flags ,                 &amp;<a name='449'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='450'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='451'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='452'>
                         its , ite , jts , jte , kts , kte )<a name='453'>
<a name='454'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_154">( t_2 , 't' , config_flags ,                 &amp;<a name='455'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='456'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='457'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='458'>
                         its , ite , jts , jte , kts , kte )<a name='459'>
<a name='460'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_29">( mu_1, 't' , config_flags ,   &amp;<a name='461'>
                           ids , ide , jds , jde ,  &amp;<a name='462'>
                           ims , ime , jms , jme ,  &amp;<a name='463'>
                           its , ite , jts , jte ,  &amp;<a name='464'>
                           its , ite , jts , jte   )<a name='465'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_30">( mu_2, 't' , config_flags ,   &amp;<a name='466'>
                           ids , ide , jds , jde ,  &amp;<a name='467'>
                           ims , ime , jms , jme ,  &amp;<a name='468'>
                           its , ite , jts , jte ,  &amp;<a name='469'>
                           its , ite , jts , jte   )<a name='470'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_31">( mub , 't' , config_flags ,   &amp;<a name='471'>
                           ids , ide , jds , jde ,  &amp;<a name='472'>
                           ims , ime , jms , jme ,  &amp;<a name='473'>
                           its , ite , jts , jte ,  &amp;<a name='474'>
                           its , ite , jts , jte   )<a name='475'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_32">( mu0 , 't' , config_flags ,   &amp;<a name='476'>
                           ids , ide , jds , jde ,  &amp;<a name='477'>
                           ims , ime , jms , jme ,  &amp;<a name='478'>
                           its , ite , jts , jte ,  &amp;<a name='479'>
                           its , ite , jts , jte   )<a name='480'>
<a name='481'>
<a name='482'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_155">( phb , 'W' , config_flags ,                 &amp;<a name='483'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='484'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='485'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='486'>
                         its , ite , jts , jte , kts , kte )<a name='487'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_156">( ph0 , 'W' , config_flags ,                 &amp;<a name='488'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='489'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='490'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='491'>
                         its , ite , jts , jte , kts , kte )<a name='492'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_157">( php , 'W' , config_flags ,                 &amp;<a name='493'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='494'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='495'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='496'>
                         its , ite , jts , jte , kts , kte )<a name='497'>
<a name='498'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_158">( pb , 't' , config_flags ,                 &amp;<a name='499'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='500'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='501'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='502'>
                         its , ite , jts , jte , kts , kte )<a name='503'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_159">( al , 't' , config_flags ,                 &amp;<a name='504'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='505'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='506'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='507'>
                         its , ite , jts , jte , kts , kte )<a name='508'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_160">( alt , 't' , config_flags ,                 &amp;<a name='509'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='510'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='511'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='512'>
                         its , ite , jts , jte , kts , kte )<a name='513'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_161">( alb , 't' , config_flags ,                 &amp;<a name='514'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='515'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='516'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='517'>
                         its , ite , jts , jte , kts , kte )<a name='518'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_162">(t_init, 't' , config_flags ,                 &amp;<a name='519'>
                         ids , ide , jds , jde , kds , kde ,        &amp;<a name='520'>
                         ims , ime , jms , jme , kms , kme ,        &amp;<a name='521'>
                         its , ite , jts , jte , kts , kte ,        &amp;<a name='522'>
                         its , ite , jts , jte , kts , kte )<a name='523'>
<a name='524'>
   IF (num_moist &gt; 0) THEN<a name='525'>
<a name='526'>
<font color=#447700>! use of (:,:,:,loop) not efficient on DEC, but (ims,kms,jms,loop) not portable to SGI/Cray<a name='527'></font>
<a name='528'>
      loop_3d_m   : DO loop = 1 , num_moist<a name='529'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_163">( moist_1(:,:,:,loop) , 'r' , config_flags ,                 &amp;<a name='530'>
                                 ids , ide , jds , jde , kds , kde ,        &amp;<a name='531'>
                                 ims , ime , jms , jme , kms , kme ,        &amp;<a name='532'>
                                 its , ite , jts , jte , kts , kte ,        &amp;<a name='533'>
                                 its , ite , jts , jte , kts , kte )<a name='534'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_164">( moist_2(:,:,:,loop) , 'r' , config_flags ,                 &amp;<a name='535'>
                                 ids , ide , jds , jde , kds , kde ,        &amp;<a name='536'>
                                 ims , ime , jms , jme , kms , kme ,        &amp;<a name='537'>
                                 its , ite , jts , jte , kts , kte ,        &amp;<a name='538'>
                                 its , ite , jts , jte , kts , kte )<a name='539'>
      END DO loop_3d_m<a name='540'>
<a name='541'>
   ENDIF<a name='542'>
<a name='543'>
   IF (num_chem &gt;= PARAM_FIRST_SCALAR ) THEN<a name='544'>
#ifdef WRF_CHEM<a name='545'>
         CALL chem_init (grid%id,chem_2,dt,bioemdt,photdt,chemdt,           &amp;<a name='546'>
                         stepbioe,stepphot,stepchem,                        &amp;<a name='547'>
                         ph_2,phb,g,aerwrf,config_flags,                    &amp;<a name='548'>
                         alt,t_1,pb,p,t0,p1000mb,rcp,                       &amp;<a name='549'>
                         aer_dry,aer_water,chem_in_opt,                     &amp;<a name='550'>
                         imicrogram,                                        &amp;<a name='551'>
                                 ids , ide , jds , jde , kds , kde ,        &amp;<a name='552'>
                                 ims , ime , jms , jme , kms , kme ,        &amp;<a name='553'>
                                 its , ite , jts , jte , kts , kte          )<a name='554'>
        chem_1=chem_2<a name='555'>
<font color=#447700>!<a name='556'></font>
<font color=#447700>! calculate initial pm<a name='557'></font>
<font color=#447700>!<a name='558'></font>
        print *,'calculating initial pm'<a name='559'>
        do j=jts,jte<a name='560'>
        jj=min(jde-1,j)<a name='561'>
        do k=kts,kte<a name='562'>
        kk=min(kde-1,k)<a name='563'>
        do i=its,ite<a name='564'>
        ii=min(ide-1,i)<a name='565'>
<a name='566'>
          pm2_5(i,k,j)=0.<a name='567'>
          do l=p_so4aj,p_p25i<a name='568'>
             pm2_5(i,k,j)=pm2_5(i,k,j)+chem_2(ii,kk,jj,l)<a name='569'>
          enddo<a name='570'>
          pm10(i,k,j)= pm2_5(i,k,j)                      &amp;<a name='571'>
                      +chem_2(ii,kk,jj,p_antha)             &amp;<a name='572'>
                      +chem_2(ii,kk,jj,p_soila)             &amp;<a name='573'>
                      +chem_2(ii,kk,jj,p_seas)<a name='574'>
        enddo<a name='575'>
        enddo<a name='576'>
        enddo<a name='577'>
#endif<a name='578'>
<a name='579'>
<font color=#447700>! use of (:,:,:,loop) not efficient on DEC, but (ims,kms,jms,loop) not portable to SGI/Cray<a name='580'></font>
<a name='581'>
      loop_3d_c   : DO loop = PARAM_FIRST_SCALAR , num_chem<a name='582'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_165">( chem_1(:,:,:,loop) , 'r' , config_flags ,                 &amp;<a name='583'>
                                 ids , ide , jds , jde , kds , kde ,        &amp;<a name='584'>
                                 ims , ime , jms , jme , kms , kme ,        &amp;<a name='585'>
                                 its , ite , jts , jte , kts , kte ,        &amp;<a name='586'>
                                 its , ite , jts , jte , kts , kte )<a name='587'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_166">( chem_2(:,:,:,loop) , 'r' , config_flags ,                 &amp;<a name='588'>
                                 ids , ide , jds , jde , kds , kde ,        &amp;<a name='589'>
                                 ims , ime , jms , jme , kms , kme ,        &amp;<a name='590'>
                                 its , ite , jts , jte , kts , kte ,        &amp;<a name='591'>
                                 its , ite , jts , jte , kts , kte )<a name='592'>
      END DO loop_3d_c<a name='593'>
<a name='594'>
   ENDIF<a name='595'>
<a name='596'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_33">( msft , 'r' , config_flags ,              &amp;<a name='597'>
                         ids , ide , jds , jde , &amp;<a name='598'>
                         ims , ime , jms , jme , &amp;<a name='599'>
                         its , ite , jts , jte , &amp;<a name='600'>
                         its , ite , jts , jte   )<a name='601'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_34">( msfu , 'x' , config_flags ,              &amp;<a name='602'>
                         ids , ide , jds , jde , &amp;<a name='603'>
                         ims , ime , jms , jme , &amp;<a name='604'>
                         its , ite , jts , jte , &amp;<a name='605'>
                         its , ite , jts , jte   ) <a name='606'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_35">( msfv , 'y' , config_flags ,              &amp;<a name='607'>
                         ids , ide , jds , jde , &amp;<a name='608'>
                         ims , ime , jms , jme , &amp;<a name='609'>
                         its , ite , jts , jte , &amp;<a name='610'>
                         its , ite , jts , jte   ) <a name='611'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_36">( sina , 'r' , config_flags ,              &amp;<a name='612'>
                         ids , ide , jds , jde , &amp;<a name='613'>
                         ims , ime , jms , jme , &amp;<a name='614'>
                         its , ite , jts , jte , &amp;<a name='615'>
                         its , ite , jts , jte   ) <a name='616'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_37">( cosa , 'r' , config_flags ,              &amp;<a name='617'>
                         ids , ide , jds , jde , &amp;<a name='618'>
                         ims , ime , jms , jme , &amp;<a name='619'>
                         its , ite , jts , jte , &amp;<a name='620'>
                         its , ite , jts , jte   ) <a name='621'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_38">( e , 'r' , config_flags ,                 &amp;<a name='622'>
                         ids , ide , jds , jde , &amp;<a name='623'>
                         ims , ime , jms , jme , &amp;<a name='624'>
                         its , ite , jts , jte , &amp;<a name='625'>
                         its , ite , jts , jte   ) <a name='626'>
   CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_39">( f , 'r' , config_flags ,                 &amp;<a name='627'>
                         ids , ide , jds , jde , &amp;<a name='628'>
                         ims , ime , jms , jme , &amp;<a name='629'>
                         its , ite , jts , jte , &amp;<a name='630'>
                         its , ite , jts , jte   ) <a name='631'>
<a name='632'>
<font color=#447700>! initial surface pressure (xyh)<a name='633'></font>
<a name='634'>
    do j = jts,min( jte,jde-1 )<a name='635'>
    do i = its,min( ite,ide-1 )<a name='636'>
      zw = (phb(i,1,j)+ph_1(i,1,j))/g<a name='637'>
      z1 = 0.5*(ph_1(i,1,j)+phb(i,1,j)+ph_1(i,2,j)+phb(i,2,j))/g<a name='638'>
      z2 = 0.5*(ph_1(i,2,j)+phb(i,2,j)+ph_1(i,3,j)+phb(i,3,j))/g<a name='639'>
      wgt1 = (zw - z2)/(z1 - z2)<a name='640'>
      wgt2 = 1. - wgt1<a name='641'>
      psfc (i,j) = wgt1*(p(i,1,j) + pb(i,1,j)) &amp;<a name='642'>
                  +wgt2*(p(i,2,j) + pb(i,2,j))<a name='643'>
      psfcm(i,j) = psfc(i,j)<a name='644'>
    enddo<a name='645'>
    enddo<a name='646'>
<a name='647'>
#ifdef DM_PARALLEL<a name='648'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_1.inc.html'>HALO_EM_INIT_1.inc</A>"<A NAME="HALO_EM_INIT_1.inc_14"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='649'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_2.inc.html'>HALO_EM_INIT_2.inc</A>"<A NAME="HALO_EM_INIT_2.inc_15"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='650'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_3.inc.html'>HALO_EM_INIT_3.inc</A>"<A NAME="HALO_EM_INIT_3.inc_16"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='651'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_4.inc.html'>HALO_EM_INIT_4.inc</A>"<A NAME="HALO_EM_INIT_4.inc_17"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='652'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_5.inc.html'>HALO_EM_INIT_5.inc</A>"<A NAME="HALO_EM_INIT_5.inc_18"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='653'>
#endif<a name='654'>
<a name='655'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_60"> ( 100 , 'module_start: start_domain_rk: Returning' )<a name='656'>
<a name='657'>
#define COPY_OUT<a name='658'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_19"><A href='../../html_code/dyn_em/start_em.F.html#START_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='659'>
<a name='660'>
     RETURN<a name='661'>
<a name='662'>
   END SUBROUTINE start_domain_em<a name='663'>
<a name='664'>
</pre></body></html>