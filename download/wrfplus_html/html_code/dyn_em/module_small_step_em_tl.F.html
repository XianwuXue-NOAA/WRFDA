<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!                           DISCLAIMER<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<font color=#447700>!   This file was generated by TAF version 1.7.18<a name='4'></font>
<font color=#447700>!<a name='5'></font>
<font color=#447700>!   FASTOPT DISCLAIMS  ALL  WARRANTIES,  EXPRESS  OR  IMPLIED,<a name='6'></font>
<font color=#447700>!   INCLUDING (WITHOUT LIMITATION) ALL IMPLIED  WARRANTIES  OF<a name='7'></font>
<font color=#447700>!   MERCHANTABILITY  OR FITNESS FOR A PARTICULAR PURPOSE, WITH<a name='8'></font>
<font color=#447700>!   RESPECT TO THE SOFTWARE AND USER PROGRAMS.   IN  NO  EVENT<a name='9'></font>
<font color=#447700>!   SHALL  FASTOPT BE LIABLE FOR ANY LOST OR ANTICIPATED PROF-<a name='10'></font>
<font color=#447700>!   ITS, OR ANY INDIRECT, INCIDENTAL, EXEMPLARY,  SPECIAL,  OR<a name='11'></font>
<font color=#447700>!   CONSEQUENTIAL  DAMAGES, WHETHER OR NOT FASTOPT WAS ADVISED<a name='12'></font>
<font color=#447700>!   OF THE POSSIBILITY OF SUCH DAMAGES.<a name='13'></font>
<font color=#447700>!<a name='14'></font>
<font color=#447700>!                           Haftungsbeschraenkung<a name='15'></font>
<font color=#447700>!   FastOpt gibt ausdruecklich keine Gewaehr, explizit oder indirekt,<a name='16'></font>
<font color=#447700>!   bezueglich der Brauchbarkeit  der Software  fuer einen bestimmten<a name='17'></font>
<font color=#447700>!   Zweck.   Unter  keinen  Umstaenden   ist  FastOpt   haftbar  fuer<a name='18'></font>
<font color=#447700>!   irgendeinen Verlust oder nicht eintretenden erwarteten Gewinn und<a name='19'></font>
<font color=#447700>!   allen indirekten,  zufaelligen,  exemplarischen  oder  speziellen<a name='20'></font>
<font color=#447700>!   Schaeden  oder  Folgeschaeden  unabhaengig  von einer eventuellen<a name='21'></font>
<font color=#447700>!   Mitteilung darueber an FastOpt.<a name='22'></font>
<font color=#447700>!<a name='23'></font>
<A NAME='G_MODULE_SMALL_STEP_EM'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_MODULE_SMALL_STEP_EM' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='24'>
<font color=#993300>module     </font><font color=#cc0000>g_module_small_step_em</font> <A href='../../call_to/G_MODULE_SMALL_STEP_EM.html' TARGET='index'>3</A><a name='25'>
<font color=#447700>!******************************************************************<a name='26'></font>
<font color=#447700>!******************************************************************<a name='27'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='28'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='29'></font>
<font color=#447700>!******************************************************************<a name='30'></font>
<font color=#447700>!******************************************************************<a name='31'></font>
<font color=#447700>!==============================================<a name='32'></font>
<font color=#447700>! referencing used modules<a name='33'></font>
<font color=#447700>!==============================================<a name='34'></font>
use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#module_small_step_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_24"><a name='35'>
use <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#module_small_step_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_22"><a name='36'>
use <A href='../../html_code/dyn_em/module_small_step_em.F.html#MODULE_SMALL_STEP_EM'>module_small_step_em</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#module_small_step_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SMALL_STEP_EM_2"><a name='37'>
<a name='38'>
USE <A href='../../html_code/frame/module_trace.F.html#MODULE_TRACE'>module_trace</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#module_small_step_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TRACE_11">, only : trace_entry, trace_exit<a name='39'>
<a name='40'>
<font color=#447700>!==============================================<a name='41'></font>
<font color=#447700>! all entries are defined explicitly<a name='42'></font>
<font color=#447700>!==============================================<a name='43'></font>
implicit none<a name='44'>
<a name='45'>
contains<a name='46'>
<a name='47'>
<A NAME='G_ADVANCE_MU_T'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_MU_T' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='48'>
<font color=#993300>subroutine </font><font color=#cc0000>g_advance_mu_t</font>( ww, g_ww, ww_1, g_ww_1, u, g_u, u_1, g_u_1, v, g_v, v_1, g_v_1, mu, g_mu, mut, g_mut, muave, g_muave, &amp; <A href='../../call_to/G_ADVANCE_MU_T.html' TARGET='index'>3</A>,<A href='../../call_from/G_ADVANCE_MU_T.html' TARGET='index'>2</A><a name='49'>
&amp;muts, g_muts, muu, g_muu, muv, g_muv, mudf, g_mudf, t, g_t, t_1, g_t_1, t_ave, g_t_ave, ft, g_ft, mu_tend, g_mu_tend, rdx, rdy, &amp;<a name='50'>
&amp;dts, epssm, dnw, fnm, fnp, rdnw, msfu, msfv, msft, config_flags, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, &amp;<a name='51'>
&amp;jts, jte, kts, kte )<a name='52'>
<font color=#447700>!******************************************************************<a name='53'></font>
<font color=#447700>!******************************************************************<a name='54'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='55'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='56'></font>
<font color=#447700>!******************************************************************<a name='57'></font>
<font color=#447700>!******************************************************************<a name='58'></font>
<font color=#447700>!==============================================<a name='59'></font>
<font color=#447700>! all entries are defined explicitly<a name='60'></font>
<font color=#447700>!==============================================<a name='61'></font>
implicit none<a name='62'>
<a name='63'>
<font color=#447700>!==============================================<a name='64'></font>
<font color=#447700>! declare arguments<a name='65'></font>
<font color=#447700>!==============================================<a name='66'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='67'>
integer, intent(in) :: kme<a name='68'>
integer, intent(in) :: kms<a name='69'>
real, intent(in) :: dnw(kms:kme)<a name='70'>
real, intent(in) :: dts<a name='71'>
real, intent(in) :: epssm<a name='72'>
real, intent(in) :: fnm(kms:kme)<a name='73'>
real, intent(in) :: fnp(kms:kme)<a name='74'>
integer, intent(in) :: ime<a name='75'>
integer, intent(in) :: ims<a name='76'>
integer, intent(in) :: jme<a name='77'>
integer, intent(in) :: jms<a name='78'>
real, intent(in) :: ft(ims:ime,kms:kme,jms:jme)<a name='79'>
real, intent(in) :: g_ft(ims:ime,kms:kme,jms:jme)<a name='80'>
real, intent(inout) :: g_mu(ims:ime,jms:jme)<a name='81'>
real, intent(in) :: g_mu_tend(ims:ime,jms:jme)<a name='82'>
real, intent(out) :: g_muave(ims:ime,jms:jme)<a name='83'>
real, intent(out) :: g_mudf(ims:ime,jms:jme)<a name='84'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='85'>
real, intent(out) :: g_muts(ims:ime,jms:jme)<a name='86'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='87'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='88'>
real, intent(inout) :: g_t(ims:ime,kms:kme,jms:jme)<a name='89'>
real, intent(in) :: g_t_1(ims:ime,kms:kme,jms:jme)<a name='90'>
real, intent(inout) :: g_t_ave(ims:ime,kms:kme,jms:jme)<a name='91'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='92'>
real, intent(in) :: g_u_1(ims:ime,kms:kme,jms:jme)<a name='93'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='94'>
real, intent(in) :: g_v_1(ims:ime,kms:kme,jms:jme)<a name='95'>
real, intent(inout) :: g_ww(ims:ime,kms:kme,jms:jme)<a name='96'>
real, intent(inout) :: g_ww_1(ims:ime,kms:kme,jms:jme)<a name='97'>
integer, intent(in) :: ide<a name='98'>
integer, intent(in) :: ids<a name='99'>
integer, intent(in) :: ite<a name='100'>
integer, intent(in) :: its<a name='101'>
integer, intent(in) :: jde<a name='102'>
integer, intent(in) :: jds<a name='103'>
integer, intent(in) :: jte<a name='104'>
integer, intent(in) :: jts<a name='105'>
integer, intent(in) :: kde<a name='106'>
integer, intent(in) :: kte<a name='107'>
integer, intent(in) :: kts<a name='108'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='109'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='110'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='111'>
real, intent(inout) :: mu(ims:ime,jms:jme)<a name='112'>
real, intent(in) :: mu_tend(ims:ime,jms:jme)<a name='113'>
real, intent(out) :: muave(ims:ime,jms:jme)<a name='114'>
real, intent(out) :: mudf(ims:ime,jms:jme)<a name='115'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='116'>
real, intent(out) :: muts(ims:ime,jms:jme)<a name='117'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='118'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='119'>
real, intent(in) :: rdnw(kms:kme)<a name='120'>
real, intent(in) :: rdx<a name='121'>
real, intent(in) :: rdy<a name='122'>
real, intent(inout) :: t(ims:ime,kms:kme,jms:jme)<a name='123'>
real, intent(in) :: t_1(ims:ime,kms:kme,jms:jme)<a name='124'>
real, intent(inout) :: t_ave(ims:ime,kms:kme,jms:jme)<a name='125'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='126'>
real, intent(in) :: u_1(ims:ime,kms:kme,jms:jme)<a name='127'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='128'>
real, intent(in) :: v_1(ims:ime,kms:kme,jms:jme)<a name='129'>
real, intent(inout) :: ww(ims:ime,kms:kme,jms:jme)<a name='130'>
real, intent(inout) :: ww_1(ims:ime,kms:kme,jms:jme)<a name='131'>
<a name='132'>
<font color=#447700>!==============================================<a name='133'></font>
<font color=#447700>! declare local variables<a name='134'></font>
<font color=#447700>!==============================================<a name='135'></font>
real dmdt(its:ite)<a name='136'>
real dvdxi(its:ite,kts:kte)<a name='137'>
real g_dmdt(its:ite)<a name='138'>
real g_dvdxi(its:ite,kts:kte)<a name='139'>
real g_wdtn(its:ite,kts:kte)<a name='140'>
integer i<a name='141'>
integer i_end<a name='142'>
integer i_start<a name='143'>
integer j<a name='144'>
integer j_end<a name='145'>
integer j_start<a name='146'>
integer k<a name='147'>
integer k_end<a name='148'>
integer k_start<a name='149'>
real wdtn(its:ite,kts:kte)<a name='150'>
<a name='151'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_MU_T' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_95">("g_advance_mu_t")<a name='152'>
<a name='153'>
<font color=#447700>!----------------------------------------------<a name='154'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='155'></font>
<font color=#447700>!----------------------------------------------<a name='156'></font>
i_start = its<a name='157'>
i_end = ite<a name='158'>
j_start = jts<a name='159'>
j_end = jte<a name='160'>
k_start = kts<a name='161'>
k_end = kte-1<a name='162'>
if (j_end .eq. jde) then<a name='163'>
  j_end = j_end-1<a name='164'>
endif<a name='165'>
if (i_end .eq. ide) then<a name='166'>
  i_end = i_end-1<a name='167'>
endif<a name='168'>
if ((config_flags%specified .or. config_flags%nested) .and. its .eq. ids) then<a name='169'>
  i_start = i_start+1<a name='170'>
endif<a name='171'>
if ((config_flags%specified .or. config_flags%nested) .and. ite .eq. ide) then<a name='172'>
  i_end = i_end-1<a name='173'>
endif<a name='174'>
if ((config_flags%specified .or. config_flags%nested) .and. jts .eq. jds) then<a name='175'>
  j_start = j_start+1<a name='176'>
endif<a name='177'>
if ((config_flags%specified .or. config_flags%nested) .and. jte .eq. jde) then<a name='178'>
  j_end = j_end-1<a name='179'>
endif<a name='180'>
do j = j_start, j_end<a name='181'>
  do i = i_start, i_end<a name='182'>
    g_dmdt(i) = 0.<a name='183'>
    dmdt(i) = 0.<a name='184'>
  end do<a name='185'>
  do k = k_start, k_end<a name='186'>
    do i = i_start, i_end<a name='187'>
      g_dvdxi(i,k) = g_muu(i+1,j)*msft(i,j)*msft(i,j)*rdx*(u_1(i+1,k,j)/msfu(i+1,j))-g_muu(i,j)*msft(i,j)*msft(i,j)*rdx*(u_1(i,k,j)&amp;<a name='188'>
&amp;/msfu(i,j))+g_muv(i,j+1)*msft(i,j)*msft(i,j)*rdy*(v_1(i,k,j+1)/msfv(i,j+1))-g_muv(i,j)*msft(i,j)*msft(i,j)*rdy*(v_1(i,k,j)/&amp;<a name='189'>
&amp;msfv(i,j))+g_u(i+1,k,j)*msft(i,j)*msft(i,j)*rdx-g_u(i,k,j)*msft(i,j)*msft(i,j)*rdx+g_u_1(i+1,k,j)*msft(i,j)*msft(i,j)*rdx*&amp;<a name='190'>
&amp;(muu(i+1,j)/msfu(i+1,j))-g_u_1(i,k,j)*msft(i,j)*msft(i,j)*rdx*(muu(i,j)/msfu(i,j))+g_v(i,k,j+1)*msft(i,j)*msft(i,j)*rdy-&amp;<a name='191'>
&amp;g_v(i,k,j)*msft(i,j)*msft(i,j)*rdy+g_v_1(i,k,j+1)*msft(i,j)*msft(i,j)*rdy*(muv(i,j+1)/msfv(i,j+1))-g_v_1(i,k,j)*msft(i,j)*&amp;<a name='192'>
&amp;msft(i,j)*rdy*(muv(i,j)/msfv(i,j))<a name='193'>
      dvdxi(i,k) = msft(i,j)*msft(i,j)*(rdy*(v(i,k,j+1)+muv(i,j+1)*v_1(i,k,j+1)/msfv(i,j+1)-(v(i,k,j)+muv(i,j)*v_1(i,k,j)/msfv(i,j)&amp;<a name='194'>
&amp;))+rdx*(u(i+1,k,j)+muu(i+1,j)*u_1(i+1,k,j)/msfu(i+1,j)-(u(i,k,j)+muu(i,j)*u_1(i,k,j)/msfu(i,j))))<a name='195'>
      g_dmdt(i) = g_dmdt(i)+g_dvdxi(i,k)*dnw(k)<a name='196'>
      dmdt(i) = dmdt(i)+dnw(k)*dvdxi(i,k)<a name='197'>
    end do<a name='198'>
  end do<a name='199'>
  do i = i_start, i_end<a name='200'>
    g_muave(i,j) = g_mu(i,j)<a name='201'>
    muave(i,j) = mu(i,j)<a name='202'>
    g_mu(i,j) = g_dmdt(i)*dts+g_mu(i,j)+g_mu_tend(i,j)*dts<a name='203'>
    mu(i,j) = mu(i,j)+dts*(dmdt(i)+mu_tend(i,j))<a name='204'>
    g_mudf(i,j) = g_dmdt(i)+g_mu_tend(i,j)<a name='205'>
    mudf(i,j) = dmdt(i)+mu_tend(i,j)<a name='206'>
    g_muts(i,j) = g_mu(i,j)+g_mut(i,j)<a name='207'>
    muts(i,j) = mut(i,j)+mu(i,j)<a name='208'>
    g_muave(i,j) = 0.5*g_mu(i,j)*(1+epssm)+0.5*g_muave(i,j)*(1.-epssm)<a name='209'>
    muave(i,j) = 0.5*((1.+epssm)*mu(i,j)+(1.-epssm)*muave(i,j))<a name='210'>
  end do<a name='211'>
  do k = 2, k_end<a name='212'>
    do i = i_start, i_end<a name='213'>
      g_ww(i,k,j) = (-(g_dmdt(i)*(dnw(k-1)/msft(i,j))))-g_dvdxi(i,k-1)*(dnw(k-1)/msft(i,j))-g_mu_tend(i,j)*(dnw(k-1)/msft(i,j))+&amp;<a name='214'>
&amp;g_ww(i,k-1,j)<a name='215'>
      ww(i,k,j) = ww(i,k-1,j)-dnw(k-1)*(dmdt(i)+dvdxi(i,k-1)+mu_tend(i,j))/msft(i,j)<a name='216'>
    end do<a name='217'>
  end do<a name='218'>
  do k = 1, k_end<a name='219'>
    do i = i_start, i_end<a name='220'>
      g_ww(i,k,j) = g_ww(i,k,j)-g_ww_1(i,k,j)<a name='221'>
      ww(i,k,j) = ww(i,k,j)-ww_1(i,k,j)<a name='222'>
    end do<a name='223'>
  end do<a name='224'>
end do<a name='225'>
do j = j_start, j_end<a name='226'>
  do k = 1, k_end<a name='227'>
    do i = i_start, i_end<a name='228'>
      g_t_ave(i,k,j) = g_t(i,k,j)<a name='229'>
      t_ave(i,k,j) = t(i,k,j)<a name='230'>
      g_t(i,k,j) = g_ft(i,k,j)*msft(i,j)*dts+g_t(i,k,j)<a name='231'>
      t(i,k,j) = t(i,k,j)+msft(i,j)*dts*ft(i,k,j)<a name='232'>
    end do<a name='233'>
  end do<a name='234'>
end do<a name='235'>
do j = j_start, j_end<a name='236'>
  do i = i_start, i_end<a name='237'>
    g_wdtn(i,1) = 0.<a name='238'>
    wdtn(i,1) = 0.<a name='239'>
    g_wdtn(i,kde) = 0.<a name='240'>
    wdtn(i,kde) = 0.<a name='241'>
  end do<a name='242'>
  do k = 2, k_end<a name='243'>
    do i = i_start, i_end<a name='244'>
      g_wdtn(i,k) = g_t_1(i,k-1,j)*ww(i,k,j)*fnp(k)+g_t_1(i,k,j)*ww(i,k,j)*fnm(k)+g_ww(i,k,j)*(fnm(k)*t_1(i,k,j)+fnp(k)*t_1(i,k-1,&amp;<a name='245'>
&amp;j))<a name='246'>
      wdtn(i,k) = ww(i,k,j)*(fnm(k)*t_1(i,k,j)+fnp(k)*t_1(i,k-1,j))<a name='247'>
    end do<a name='248'>
  end do<a name='249'>
  do k = 1, k_end<a name='250'>
    do i = i_start, i_end<a name='251'>
      g_t(i,k,j) = g_t(i,k,j)+0.5*g_t_1(i,k,j-1)*dts*msft(i,j)*msft(i,j)*rdy*v(i,k,j)-0.5*g_t_1(i,k,j+1)*dts*msft(i,j)*msft(i,j)*&amp;<a name='252'>
&amp;rdy*v(i,k,j+1)+0.5*g_t_1(i-1,k,j)*dts*msft(i,j)*msft(i,j)*rdx*u(i,k,j)-0.5*g_t_1(i+1,k,j)*dts*msft(i,j)*msft(i,j)*rdx*u(i+1,&amp;<a name='253'>
&amp;k,j)-g_t_1(i,k,j)*dts*msft(i,j)*msft(i,j)*(0.5*rdy*(v(i,k,j+1)-v(i,k,j))+0.5*rdx*(u(i+1,k,j)-u(i,k,j)))-0.5*g_u(i+1,k,j)*&amp;<a name='254'>
&amp;dts*msft(i,j)*msft(i,j)*rdx*(t_1(i+1,k,j)+t_1(i,k,j))+0.5*g_u(i,k,j)*dts*msft(i,j)*msft(i,j)*rdx*(t_1(i,k,j)+t_1(i-1,k,j))-&amp;<a name='255'>
&amp;0.5*g_v(i,k,j+1)*dts*msft(i,j)*msft(i,j)*rdy*(t_1(i,k,j+1)+t_1(i,k,j))+0.5*g_v(i,k,j)*dts*msft(i,j)*msft(i,j)*rdy*(t_1(i,k,&amp;<a name='256'>
&amp;j)+t_1(i,k,j-1))-g_wdtn(i,k+1)*dts*msft(i,j)*rdnw(k)+g_wdtn(i,k)*dts*msft(i,j)*rdnw(k)<a name='257'>
      t(i,k,j) = t(i,k,j)-dts*msft(i,j)*(msft(i,j)*(0.5*rdy*(v(i,k,j+1)*(t_1(i,k,j+1)+t_1(i,k,j))-v(i,k,j)*(t_1(i,k,j)+t_1(i,k,j-1)&amp;<a name='258'>
&amp;))+0.5*rdx*(u(i+1,k,j)*(t_1(i+1,k,j)+t_1(i,k,j))-u(i,k,j)*(t_1(i,k,j)+t_1(i-1,k,j))))+rdnw(k)*(wdtn(i,k+1)-wdtn(i,k)))<a name='259'>
    end do<a name='260'>
  end do<a name='261'>
end do<a name='262'>
<a name='263'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_MU_T' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_95">("g_advance_mu_t")<a name='264'>
<a name='265'>
end subroutine g_advance_mu_t<a name='266'>
<a name='267'>
<a name='268'>
<A NAME='G_ADVANCE_UV'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_UV' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='269'>
<font color=#993300>subroutine </font><font color=#cc0000>g_advance_uv</font>( u, g_u, ru_tend, g_ru_tend, v, g_v, rv_tend, g_rv_tend, p, g_p, pb, ph, g_ph, php, g_php, alt, g_alt, al, &amp; <A href='../../call_to/G_ADVANCE_UV.html' TARGET='index'>3</A>,<A href='../../call_from/G_ADVANCE_UV.html' TARGET='index'>2</A><a name='270'>
&amp;g_al, mu, g_mu, muu, g_muu, cqu, g_cqu, muv, g_muv, cqv, g_cqv, mudf, g_mudf, rdx, rdy, dts, cf1, cf2, cf3, fnm, fnp, emdiv, rdnw,&amp;<a name='271'>
&amp; config_flags, spec_zone, non_hydrostatic, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='272'>
<font color=#447700>!******************************************************************<a name='273'></font>
<font color=#447700>!******************************************************************<a name='274'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='275'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='276'></font>
<font color=#447700>!******************************************************************<a name='277'></font>
<font color=#447700>!******************************************************************<a name='278'></font>
<font color=#447700>!==============================================<a name='279'></font>
<font color=#447700>! all entries are defined explicitly<a name='280'></font>
<font color=#447700>!==============================================<a name='281'></font>
implicit none<a name='282'>
<a name='283'>
<font color=#447700>!==============================================<a name='284'></font>
<font color=#447700>! declare arguments<a name='285'></font>
<font color=#447700>!==============================================<a name='286'></font>
integer, intent(in) :: ime<a name='287'>
integer, intent(in) :: ims<a name='288'>
integer, intent(in) :: jme<a name='289'>
integer, intent(in) :: jms<a name='290'>
integer, intent(in) :: kme<a name='291'>
integer, intent(in) :: kms<a name='292'>
real, intent(in) :: al(ims:ime,kms:kme,jms:jme)<a name='293'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='294'>
real, intent(in) :: cf1<a name='295'>
real, intent(in) :: cf2<a name='296'>
real, intent(in) :: cf3<a name='297'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='298'>
real, intent(in) :: cqu(ims:ime,kms:kme,jms:jme)<a name='299'>
real, intent(in) :: cqv(ims:ime,kms:kme,jms:jme)<a name='300'>
real, intent(in) :: dts<a name='301'>
real, intent(in) :: emdiv<a name='302'>
real, intent(in) :: fnm(kms:kme)<a name='303'>
real, intent(in) :: fnp(kms:kme)<a name='304'>
real, intent(in) :: g_al(ims:ime,kms:kme,jms:jme)<a name='305'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='306'>
real, intent(in) :: g_cqu(ims:ime,kms:kme,jms:jme)<a name='307'>
real, intent(in) :: g_cqv(ims:ime,kms:kme,jms:jme)<a name='308'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='309'>
real, intent(in) :: g_mudf(ims:ime,jms:jme)<a name='310'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='311'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='312'>
real, intent(in) :: g_p(ims:ime,kms:kme,jms:jme)<a name='313'>
real, intent(in) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='314'>
real, intent(in) :: g_php(ims:ime,kms:kme,jms:jme)<a name='315'>
real, intent(in) :: g_ru_tend(ims:ime,kms:kme,jms:jme)<a name='316'>
real, intent(in) :: g_rv_tend(ims:ime,kms:kme,jms:jme)<a name='317'>
real, intent(inout) :: g_u(ims:ime,kms:kme,jms:jme)<a name='318'>
real, intent(inout) :: g_v(ims:ime,kms:kme,jms:jme)<a name='319'>
integer, intent(in) :: ide<a name='320'>
integer, intent(in) :: ids<a name='321'>
integer, intent(in) :: ite<a name='322'>
integer, intent(in) :: its<a name='323'>
integer, intent(in) :: jde<a name='324'>
integer, intent(in) :: jds<a name='325'>
integer, intent(in) :: jte<a name='326'>
integer, intent(in) :: jts<a name='327'>
integer, intent(in) :: kde<a name='328'>
integer, intent(in) :: kte<a name='329'>
integer, intent(in) :: kts<a name='330'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='331'>
real, intent(in) :: mudf(ims:ime,jms:jme)<a name='332'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='333'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='334'>
logical, intent(in) :: non_hydrostatic<a name='335'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='336'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='337'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='338'>
real, intent(in) :: php(ims:ime,kms:kme,jms:jme)<a name='339'>
real, intent(in) :: rdnw(kms:kme)<a name='340'>
real, intent(in) :: rdx<a name='341'>
real, intent(in) :: rdy<a name='342'>
real, intent(in) :: ru_tend(ims:ime,kms:kme,jms:jme)<a name='343'>
real, intent(in) :: rv_tend(ims:ime,kms:kme,jms:jme)<a name='344'>
integer, intent(in) :: spec_zone<a name='345'>
real, intent(inout) :: u(ims:ime,kms:kme,jms:jme)<a name='346'>
real, intent(inout) :: v(ims:ime,kms:kme,jms:jme)<a name='347'>
<a name='348'>
<font color=#447700>!==============================================<a name='349'></font>
<font color=#447700>! declare local variables<a name='350'></font>
<font color=#447700>!==============================================<a name='351'></font>
real dpn(its:ite,kts:kte)<a name='352'>
real dpxy(its:ite,kts:kte)<a name='353'>
real dx<a name='354'>
real dy<a name='355'>
real g_dpn(its:ite,kts:kte)<a name='356'>
real g_dpxy(its:ite,kts:kte)<a name='357'>
real g_mudf_xy(its:ite)<a name='358'>
integer i<a name='359'>
integer i_end<a name='360'>
integer i_end_up<a name='361'>
integer i_endu<a name='362'>
integer i_start<a name='363'>
integer i_start_up<a name='364'>
integer j<a name='365'>
integer j_end<a name='366'>
integer j_end_vp<a name='367'>
integer j_endv<a name='368'>
integer j_start<a name='369'>
integer j_start_vp<a name='370'>
integer k<a name='371'>
integer k_end<a name='372'>
integer k_start<a name='373'>
real mudf_xy(its:ite)<a name='374'>
<a name='375'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_UV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_96">("g_advance_uv")<a name='376'>
<a name='377'>
<font color=#447700>!----------------------------------------------<a name='378'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='379'></font>
<font color=#447700>!----------------------------------------------<a name='380'></font>
if (config_flags%nested .or. config_flags%specified) then<a name='381'>
  i_start = max(its,ids+spec_zone)<a name='382'>
  i_end = min(ite,ide-spec_zone-1)<a name='383'>
  j_start = max(jts,jds+spec_zone)<a name='384'>
  j_end = min(jte,jde-spec_zone-1)<a name='385'>
  k_start = kts<a name='386'>
  k_end = min(kte,kde-1)<a name='387'>
  i_endu = min(ite,ide-spec_zone)<a name='388'>
  j_endv = min(jte,jde-spec_zone)<a name='389'>
else<a name='390'>
  i_start = its<a name='391'>
  i_end = ite<a name='392'>
  j_start = jts<a name='393'>
  j_end = jte<a name='394'>
  k_start = kts<a name='395'>
  k_end = kte-1<a name='396'>
  i_endu = i_end<a name='397'>
  j_endv = j_end<a name='398'>
  if (j_end .eq. jde) then<a name='399'>
    j_end = j_end-1<a name='400'>
  endif<a name='401'>
  if (i_end .eq. ide) then<a name='402'>
    i_end = i_end-1<a name='403'>
  endif<a name='404'>
endif<a name='405'>
i_start_up = i_start<a name='406'>
i_end_up = i_endu<a name='407'>
j_start_vp = j_start<a name='408'>
j_end_vp = j_endv<a name='409'>
if ((config_flags%open_xs .or. config_flags%symmetric_xs) .and. its .eq. ids) then<a name='410'>
  i_start_up = i_start_up+1<a name='411'>
endif<a name='412'>
if ((config_flags%open_xe .or. config_flags%symmetric_xe) .and. ite .eq. ide) then<a name='413'>
  i_end_up = i_end_up-1<a name='414'>
endif<a name='415'>
if ((config_flags%open_ys .or. config_flags%symmetric_ys) .and. jts .eq. jds) then<a name='416'>
  j_start_vp = j_start_vp+1<a name='417'>
endif<a name='418'>
if ((config_flags%open_ye .or. config_flags%symmetric_ye) .and. jte .eq. jde) then<a name='419'>
  j_end_vp = j_end_vp-1<a name='420'>
endif<a name='421'>
dx = 1./rdx<a name='422'>
dy = 1./rdy<a name='423'>
u_outer_j_loop: do j = j_start, j_end<a name='424'>
  do k = k_start, k_end<a name='425'>
    do i = i_start, i_endu<a name='426'>
      g_u(i,k,j) = g_ru_tend(i,k,j)*dts+g_u(i,k,j)<a name='427'>
      u(i,k,j) = u(i,k,j)+dts*ru_tend(i,k,j)<a name='428'>
    end do<a name='429'>
  end do<a name='430'>
  do i = i_start_up, i_end_up<a name='431'>
    g_mudf_xy(i) = g_mudf(i-1,j)*emdiv*dx-g_mudf(i,j)*emdiv*dx<a name='432'>
    mudf_xy(i) = -(emdiv*dx*(mudf(i,j)-mudf(i-1,j)))<a name='433'>
  end do<a name='434'>
  do k = k_start, k_end<a name='435'>
    do i = i_start_up, i_end_up<a name='436'>
      g_dpxy(i,k) = 0.5*g_al(i-1,k,j)*rdx*muu(i,j)*(pb(i,k,j)-pb(i-1,k,j))+0.5*g_al(i,k,j)*rdx*muu(i,j)*(pb(i,k,j)-pb(i-1,k,j))+&amp;<a name='437'>
&amp;0.5*g_alt(i-1,k,j)*rdx*muu(i,j)*(p(i,k,j)-p(i-1,k,j))+0.5*g_alt(i,k,j)*rdx*muu(i,j)*(p(i,k,j)-p(i-1,k,j))+0.5*g_muu(i,j)*&amp;<a name='438'>
&amp;rdx*(ph(i,k+1,j)-ph(i-1,k+1,j)+ph(i,k,j)-ph(i-1,k,j)+(alt(i,k,j)+alt(i-1,k,j))*(p(i,k,j)-p(i-1,k,j))+(al(i,k,j)+al(i-1,k,j))&amp;<a name='439'>
&amp;*(pb(i,k,j)-pb(i-1,k,j)))-0.5*g_p(i-1,k,j)*rdx*muu(i,j)*(alt(i,k,j)+alt(i-1,k,j))+0.5*g_p(i,k,j)*rdx*muu(i,j)*(alt(i,k,j)+&amp;<a name='440'>
&amp;alt(i-1,k,j))-0.5*g_ph(i-1,k+1,j)*rdx*muu(i,j)+0.5*g_ph(i,k+1,j)*rdx*muu(i,j)-0.5*g_ph(i-1,k,j)*rdx*muu(i,j)+0.5*g_ph(i,k,j)&amp;<a name='441'>
&amp;*rdx*muu(i,j)<a name='442'>
      dpxy(i,k) = 0.5*rdx*muu(i,j)*(ph(i,k+1,j)-ph(i-1,k+1,j)+ph(i,k,j)-ph(i-1,k,j)+(alt(i,k,j)+alt(i-1,k,j))*(p(i,k,j)-p(i-1,k,j))&amp;<a name='443'>
&amp;+(al(i,k,j)+al(i-1,k,j))*(pb(i,k,j)-pb(i-1,k,j)))<a name='444'>
    end do<a name='445'>
  end do<a name='446'>
  if (non_hydrostatic) then<a name='447'>
    do i = i_start_up, i_end_up<a name='448'>
      g_dpn(i,1) = 0.5*g_p(i-1,3,j)*cf3+0.5*g_p(i,3,j)*cf3+0.5*g_p(i-1,2,j)*cf2+0.5*g_p(i,2,j)*cf2+0.5*g_p(i-1,1,j)*cf1+0.5*g_p(i,&amp;<a name='449'>
&amp;1,j)*cf1<a name='450'>
      dpn(i,1) = 0.5*(cf1*(p(i,1,j)+p(i-1,1,j))+cf2*(p(i,2,j)+p(i-1,2,j))+cf3*(p(i,3,j)+p(i-1,3,j)))<a name='451'>
      g_dpn(i,kde) = 0.<a name='452'>
      dpn(i,kde) = 0.<a name='453'>
    end do<a name='454'>
    do k = k_start+1, k_end<a name='455'>
      do i = i_start_up, i_end_up<a name='456'>
        g_dpn(i,k) = 0.5*g_p(i-1,k-1,j)*fnp(k)+0.5*g_p(i,k-1,j)*fnp(k)+0.5*g_p(i-1,k,j)*fnm(k)+0.5*g_p(i,k,j)*fnm(k)<a name='457'>
        dpn(i,k) = 0.5*(fnm(k)*(p(i,k,j)+p(i-1,k,j))+fnp(k)*(p(i,k-1,j)+p(i-1,k-1,j)))<a name='458'>
      end do<a name='459'>
    end do<a name='460'>
    do k = k_start, k_end<a name='461'>
      do i = i_start_up, i_end_up<a name='462'>
        g_dpxy(i,k) = g_dpn(i,k+1)*rdx*(php(i,k,j)-php(i-1,k,j))*rdnw(k)-g_dpn(i,k)*rdx*(php(i,k,j)-php(i-1,k,j))*rdnw(k)+g_dpxy(i,&amp;<a name='463'>
&amp;k)-0.5*g_mu(i-1,j)*rdx*(php(i,k,j)-php(i-1,k,j))-0.5*g_mu(i,j)*rdx*(php(i,k,j)-php(i-1,k,j))-g_php(i-1,k,j)*rdx*(rdnw(k)*&amp;<a name='464'>
&amp;(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))+g_php(i,k,j)*rdx*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))<a name='465'>
        dpxy(i,k) = dpxy(i,k)+rdx*(php(i,k,j)-php(i-1,k,j))*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))<a name='466'>
      end do<a name='467'>
    end do<a name='468'>
  endif<a name='469'>
  do k = k_start, k_end<a name='470'>
    do i = i_start_up, i_end_up<a name='471'>
      g_u(i,k,j) = (-(g_cqu(i,k,j)*dts*dpxy(i,k)))-g_dpxy(i,k)*dts*cqu(i,k,j)+g_mudf_xy(i)+g_u(i,k,j)<a name='472'>
      u(i,k,j) = u(i,k,j)-dts*cqu(i,k,j)*dpxy(i,k)+mudf_xy(i)<a name='473'>
    end do<a name='474'>
  end do<a name='475'>
end do u_outer_j_loop<a name='476'>
v_outer_j_loop: do j = j_start, j_endv<a name='477'>
  do k = k_start, k_end<a name='478'>
    do i = i_start, i_end<a name='479'>
      g_v(i,k,j) = g_rv_tend(i,k,j)*dts+g_v(i,k,j)<a name='480'>
      v(i,k,j) = v(i,k,j)+dts*rv_tend(i,k,j)<a name='481'>
    end do<a name='482'>
  end do<a name='483'>
  do i = i_start, i_end<a name='484'>
    g_mudf_xy(i) = g_mudf(i,j-1)*emdiv*dy-g_mudf(i,j)*emdiv*dy<a name='485'>
    mudf_xy(i) = -(emdiv*dy*(mudf(i,j)-mudf(i,j-1)))<a name='486'>
  end do<a name='487'>
  if (j .ge. j_start_vp .and. j .le. j_end_vp) then<a name='488'>
    do k = k_start, k_end<a name='489'>
      do i = i_start, i_end<a name='490'>
        g_dpxy(i,k) = 0.5*g_al(i,k,j-1)*rdy*muv(i,j)*(pb(i,k,j)-pb(i,k,j-1))+0.5*g_al(i,k,j)*rdy*muv(i,j)*(pb(i,k,j)-pb(i,k,j-1))+&amp;<a name='491'>
&amp;0.5*g_alt(i,k,j-1)*rdy*muv(i,j)*(p(i,k,j)-p(i,k,j-1))+0.5*g_alt(i,k,j)*rdy*muv(i,j)*(p(i,k,j)-p(i,k,j-1))+0.5*g_muv(i,j)*&amp;<a name='492'>
&amp;rdy*(ph(i,k+1,j)-ph(i,k+1,j-1)+ph(i,k,j)-ph(i,k,j-1)+(alt(i,k,j)+alt(i,k,j-1))*(p(i,k,j)-p(i,k,j-1))+(al(i,k,j)+al(i,k,j-&amp;<a name='493'>
&amp;1))*(pb(i,k,j)-pb(i,k,j-1)))-0.5*g_p(i,k,j-1)*rdy*muv(i,j)*(alt(i,k,j)+alt(i,k,j-1))+0.5*g_p(i,k,j)*rdy*muv(i,j)*(alt(i,k,&amp;<a name='494'>
&amp;j)+alt(i,k,j-1))-0.5*g_ph(i,k+1,j-1)*rdy*muv(i,j)+0.5*g_ph(i,k+1,j)*rdy*muv(i,j)-0.5*g_ph(i,k,j-1)*rdy*muv(i,j)+0.5*&amp;<a name='495'>
&amp;g_ph(i,k,j)*rdy*muv(i,j)<a name='496'>
        dpxy(i,k) = 0.5*rdy*muv(i,j)*(ph(i,k+1,j)-ph(i,k+1,j-1)+ph(i,k,j)-ph(i,k,j-1)+(alt(i,k,j)+alt(i,k,j-1))*(p(i,k,j)-p(i,k,j-&amp;<a name='497'>
&amp;1))+(al(i,k,j)+al(i,k,j-1))*(pb(i,k,j)-pb(i,k,j-1)))<a name='498'>
      end do<a name='499'>
    end do<a name='500'>
    if (non_hydrostatic) then<a name='501'>
      do i = i_start, i_end<a name='502'>
        g_dpn(i,1) = 0.5*g_p(i,3,j-1)*cf3+0.5*g_p(i,3,j)*cf3+0.5*g_p(i,2,j-1)*cf2+0.5*g_p(i,2,j)*cf2+0.5*g_p(i,1,j-1)*cf1+0.5*&amp;<a name='503'>
&amp;g_p(i,1,j)*cf1<a name='504'>
        dpn(i,1) = 0.5*(cf1*(p(i,1,j)+p(i,1,j-1))+cf2*(p(i,2,j)+p(i,2,j-1))+cf3*(p(i,3,j)+p(i,3,j-1)))<a name='505'>
        g_dpn(i,kde) = 0.<a name='506'>
        dpn(i,kde) = 0.<a name='507'>
      end do<a name='508'>
      do k = k_start+1, k_end<a name='509'>
        do i = i_start, i_end<a name='510'>
          g_dpn(i,k) = 0.5*g_p(i,k-1,j-1)*fnp(k)+0.5*g_p(i,k-1,j)*fnp(k)+0.5*g_p(i,k,j-1)*fnm(k)+0.5*g_p(i,k,j)*fnm(k)<a name='511'>
          dpn(i,k) = 0.5*(fnm(k)*(p(i,k,j)+p(i,k,j-1))+fnp(k)*(p(i,k-1,j)+p(i,k-1,j-1)))<a name='512'>
        end do<a name='513'>
      end do<a name='514'>
      do k = k_start, k_end<a name='515'>
        do i = i_start, i_end<a name='516'>
          g_dpxy(i,k) = g_dpn(i,k+1)*rdy*(php(i,k,j)-php(i,k,j-1))*rdnw(k)-g_dpn(i,k)*rdy*(php(i,k,j)-php(i,k,j-1))*rdnw(k)+&amp;<a name='517'>
&amp;g_dpxy(i,k)-0.5*g_mu(i,j-1)*rdy*(php(i,k,j)-php(i,k,j-1))-0.5*g_mu(i,j)*rdy*(php(i,k,j)-php(i,k,j-1))-g_php(i,k,j-1)*&amp;<a name='518'>
&amp;rdy*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i,j-1)+mu(i,j)))+g_php(i,k,j)*rdy*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i,j-&amp;<a name='519'>
&amp;1)+mu(i,j)))<a name='520'>
          dpxy(i,k) = dpxy(i,k)+rdy*(php(i,k,j)-php(i,k,j-1))*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i,j-1)+mu(i,j)))<a name='521'>
        end do<a name='522'>
      end do<a name='523'>
    endif<a name='524'>
    do k = k_start, k_end<a name='525'>
      do i = i_start, i_end<a name='526'>
        g_v(i,k,j) = (-(g_cqv(i,k,j)*dts*dpxy(i,k)))-g_dpxy(i,k)*dts*cqv(i,k,j)+g_mudf_xy(i)+g_v(i,k,j)<a name='527'>
        v(i,k,j) = v(i,k,j)-dts*cqv(i,k,j)*dpxy(i,k)+mudf_xy(i)<a name='528'>
      end do<a name='529'>
    end do<a name='530'>
  endif<a name='531'>
end do v_outer_j_loop<a name='532'>
<a name='533'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_UV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_96">("g_advance_uv")<a name='534'>
<a name='535'>
end subroutine g_advance_uv<a name='536'>
<a name='537'>
<a name='538'>
<A NAME='G_ADVANCE_W'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='539'>
<font color=#993300>subroutine </font><font color=#cc0000>g_advance_w</font>( w, g_w, rw_tend, g_rw_tend, ww, g_ww, u, g_u, v, g_v, mu1, g_mu1, mut, g_mut, muave, g_muave, muts, g_muts,&amp; <A href='../../call_to/G_ADVANCE_W.html' TARGET='index'>3</A>,<A href='../../call_from/G_ADVANCE_W.html' TARGET='index'>2</A><a name='540'>
&amp; t_2ave, g_t_2ave, t_2, g_t_2, t_1, g_t_1, ph, g_ph, ph_1, g_ph_1, phb, ph_tend, g_ph_tend, ht, c2a, g_c2a, cqw, g_cqw, alt, &amp;<a name='541'>
&amp;g_alt, alb, a, g_a, alpha, g_alpha, gamma, g_gamma, rdx, rdy, dts, t0, epssm, fnm, fnp, rdnw, rdn, cf1, cf2, cf3, msft, &amp;<a name='542'>
&amp;config_flags, ids, ide, jds, jde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='543'>
<font color=#447700>!******************************************************************<a name='544'></font>
<font color=#447700>!******************************************************************<a name='545'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='546'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='547'></font>
<font color=#447700>!******************************************************************<a name='548'></font>
<font color=#447700>!******************************************************************<a name='549'></font>
<font color=#447700>!==============================================<a name='550'></font>
<font color=#447700>! all entries are defined explicitly<a name='551'></font>
<font color=#447700>!==============================================<a name='552'></font>
implicit none<a name='553'>
<a name='554'>
<font color=#447700>!==============================================<a name='555'></font>
<font color=#447700>! declare arguments<a name='556'></font>
<font color=#447700>!==============================================<a name='557'></font>
integer, intent(in) :: ime<a name='558'>
integer, intent(in) :: ims<a name='559'>
integer, intent(in) :: jme<a name='560'>
integer, intent(in) :: jms<a name='561'>
integer, intent(in) :: kme<a name='562'>
integer, intent(in) :: kms<a name='563'>
real, intent(in) :: a(ims:ime,kms:kme,jms:jme)<a name='564'>
real, intent(in) :: alb(ims:ime,kms:kme,jms:jme)<a name='565'>
real, intent(in) :: alpha(ims:ime,kms:kme,jms:jme)<a name='566'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='567'>
real, intent(in) :: c2a(ims:ime,kms:kme,jms:jme)<a name='568'>
real, intent(in) :: cf1<a name='569'>
real, intent(in) :: cf2<a name='570'>
real, intent(in) :: cf3<a name='571'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='572'>
real, intent(in) :: cqw(ims:ime,kms:kme,jms:jme)<a name='573'>
real, intent(in) :: dts<a name='574'>
real, intent(in) :: epssm<a name='575'>
real, intent(in) :: fnm(kms:kme)<a name='576'>
real, intent(in) :: fnp(kms:kme)<a name='577'>
real, intent(in) :: g_a(ims:ime,kms:kme,jms:jme)<a name='578'>
real, intent(in) :: g_alpha(ims:ime,kms:kme,jms:jme)<a name='579'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='580'>
real, intent(in) :: g_c2a(ims:ime,kms:kme,jms:jme)<a name='581'>
real, intent(in) :: g_cqw(ims:ime,kms:kme,jms:jme)<a name='582'>
real, intent(in) :: g_gamma(ims:ime,kms:kme,jms:jme)<a name='583'>
real, intent(in) :: g_mu1(ims:ime,jms:jme)<a name='584'>
real, intent(in) :: g_muave(ims:ime,jms:jme)<a name='585'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='586'>
real, intent(in) :: g_muts(ims:ime,jms:jme)<a name='587'>
real, intent(inout) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='588'>
real, intent(in) :: g_ph_1(ims:ime,kms:kme,jms:jme)<a name='589'>
real, intent(in) :: g_ph_tend(ims:ime,kms:kme,jms:jme)<a name='590'>
real, intent(in) :: g_rw_tend(ims:ime,kms:kme,jms:jme)<a name='591'>
real, intent(in) :: g_t_1(ims:ime,kms:kme,jms:jme)<a name='592'>
real, intent(in) :: g_t_2(ims:ime,kms:kme,jms:jme)<a name='593'>
real, intent(inout) :: g_t_2ave(ims:ime,kms:kme,jms:jme)<a name='594'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='595'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='596'>
real, intent(inout) :: g_w(ims:ime,kms:kme,jms:jme)<a name='597'>
real, intent(in) :: g_ww(ims:ime,kms:kme,jms:jme)<a name='598'>
real, intent(in) :: gamma(ims:ime,kms:kme,jms:jme)<a name='599'>
real, intent(in) :: ht(ims:ime,jms:jme)<a name='600'>
integer, intent(in) :: ide<a name='601'>
integer, intent(in) :: ids<a name='602'>
integer, intent(in) :: ite<a name='603'>
integer, intent(in) :: its<a name='604'>
integer, intent(in) :: jde<a name='605'>
integer, intent(in) :: jds<a name='606'>
integer, intent(in) :: jte<a name='607'>
integer, intent(in) :: jts<a name='608'>
integer, intent(in) :: kte<a name='609'>
integer, intent(in) :: kts<a name='610'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='611'>
real, intent(in) :: mu1(ims:ime,jms:jme)<a name='612'>
real, intent(in) :: muave(ims:ime,jms:jme)<a name='613'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='614'>
real, intent(in) :: muts(ims:ime,jms:jme)<a name='615'>
real, intent(inout) :: ph(ims:ime,kms:kme,jms:jme)<a name='616'>
real, intent(in) :: ph_1(ims:ime,kms:kme,jms:jme)<a name='617'>
real, intent(in) :: ph_tend(ims:ime,kms:kme,jms:jme)<a name='618'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='619'>
real, intent(in) :: rdn(kms:kme)<a name='620'>
real, intent(in) :: rdnw(kms:kme)<a name='621'>
real, intent(in) :: rdx<a name='622'>
real, intent(in) :: rdy<a name='623'>
real, intent(in) :: rw_tend(ims:ime,kms:kme,jms:jme)<a name='624'>
real, intent(in) :: t0<a name='625'>
real, intent(in) :: t_1(ims:ime,kms:kme,jms:jme)<a name='626'>
real, intent(in) :: t_2(ims:ime,kms:kme,jms:jme)<a name='627'>
real, intent(inout) :: t_2ave(ims:ime,kms:kme,jms:jme)<a name='628'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='629'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='630'>
real, intent(inout) :: w(ims:ime,kms:kme,jms:jme)<a name='631'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='632'>
<a name='633'>
<font color=#447700>!==============================================<a name='634'></font>
<font color=#447700>! declare local variables<a name='635'></font>
<font color=#447700>!==============================================<a name='636'></font>
real g_mut_inv(its:ite)<a name='637'>
real g_rhs(its:ite,kts:kte)<a name='638'>
real g_wdwn(its:ite,kts:kte)<a name='639'>
integer i<a name='640'>
integer i_end<a name='641'>
integer i_start<a name='642'>
integer j<a name='643'>
integer j_end<a name='644'>
integer j_start<a name='645'>
integer k<a name='646'>
integer k_end<a name='647'>
real msft_inv(its:ite)<a name='648'>
real mut_inv(its:ite)<a name='649'>
real rhs(its:ite,kts:kte)<a name='650'>
real wdwn(its:ite,kts:kte)<a name='651'>
<a name='652'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_97">("g_advance_w")<a name='653'>
<a name='654'>
<font color=#447700>!----------------------------------------------<a name='655'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='656'></font>
<font color=#447700>!----------------------------------------------<a name='657'></font>
i_start = its<a name='658'>
i_end = ite<a name='659'>
j_start = jts<a name='660'>
j_end = jte<a name='661'>
k_end = kte-1<a name='662'>
if (j_end .eq. jde) then<a name='663'>
  j_end = j_end-1<a name='664'>
endif<a name='665'>
if (i_end .eq. ide) then<a name='666'>
  i_end = i_end-1<a name='667'>
endif<a name='668'>
if ((config_flags%specified .or. config_flags%nested) .and. its .eq. ids) then<a name='669'>
  i_start = i_start+1<a name='670'>
endif<a name='671'>
if ((config_flags%specified .or. config_flags%nested) .and. ite .eq. ide) then<a name='672'>
  i_end = i_end-1<a name='673'>
endif<a name='674'>
if ((config_flags%specified .or. config_flags%nested) .and. jts .eq. jds) then<a name='675'>
  j_start = j_start+1<a name='676'>
endif<a name='677'>
if ((config_flags%specified .or. config_flags%nested) .and. jte .eq. jde) then<a name='678'>
  j_end = j_end-1<a name='679'>
endif<a name='680'>
do i = i_start, i_end<a name='681'>
  g_rhs(i,1) = 0.<a name='682'>
  rhs(i,1) = 0.<a name='683'>
end do<a name='684'>
j_loop_w: do j = j_start, j_end<a name='685'>
  do i = i_start, i_end<a name='686'>
    g_mut_inv(i) = -(g_mut(i,j)/(mut(i,j)*mut(i,j)))<a name='687'>
    mut_inv(i) = 1./mut(i,j)<a name='688'>
    msft_inv(i) = 1./msft(i,j)<a name='689'>
  end do<a name='690'>
  do k = 1, k_end<a name='691'>
    do i = i_start, i_end<a name='692'>
      g_t_2ave(i,k,j) = 0.5*g_t_2(i,k,j)*(1+epssm)+0.5*g_t_2ave(i,k,j)*(1.-epssm)<a name='693'>
      t_2ave(i,k,j) = 0.5*((1.+epssm)*t_2(i,k,j)+(1.-epssm)*t_2ave(i,k,j))<a name='694'>
      g_t_2ave(i,k,j) = (-(g_mu1(i,j)*(t_1(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))))-g_muts(i,j)*((t_2ave(i,k,j)-mu1(i,j)*t_1(i,k,j))*&amp;<a name='695'>
&amp;(t0+t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j))*muts(i,j)*(t0+t_1(i,k,j))))-g_t_1(i,k,j)*(mu1(i,j)/(muts(i,j)*(t0+t_1(i,k,j)))+&amp;<a name='696'>
&amp;(t_2ave(i,k,j)-mu1(i,j)*t_1(i,k,j))*muts(i,j)/(muts(i,j)*(t0+t_1(i,k,j))*muts(i,j)*(t0+t_1(i,k,j))))+g_t_2ave(i,k,j)/&amp;<a name='697'>
&amp;(muts(i,j)*(t0+t_1(i,k,j)))<a name='698'>
      t_2ave(i,k,j) = (t_2ave(i,k,j)-mu1(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)))<a name='699'>
    end do<a name='700'>
  end do<a name='701'>
  do k = 2, k_end+1<a name='702'>
    do i = i_start, i_end<a name='703'>
      g_wdwn(i,k) = (-0.5)*g_ph_1(i,k-1,j)*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)+0.5*g_ph_1(i,k,j)*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)+&amp;<a name='704'>
&amp;0.5*g_ww(i,k-1,j)*rdnw(k-1)*(ph_1(i,k,j)-ph_1(i,k-1,j)+phb(i,k,j)-phb(i,k-1,j))+0.5*g_ww(i,k,j)*rdnw(k-1)*(ph_1(i,k,j)-&amp;<a name='705'>
&amp;ph_1(i,k-1,j)+phb(i,k,j)-phb(i,k-1,j))<a name='706'>
      wdwn(i,k) = 0.5*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)*(ph_1(i,k,j)-ph_1(i,k-1,j)+phb(i,k,j)-phb(i,k-1,j))<a name='707'>
      g_rhs(i,k) = g_ph_tend(i,k,j)*dts+0.5*g_w(i,k,j)*dts*g*(1.-epssm)<a name='708'>
      rhs(i,k) = dts*(ph_tend(i,k,j)+0.5*g*(1.-epssm)*w(i,k,j))<a name='709'>
    end do<a name='710'>
  end do<a name='711'>
  do k = 2, k_end<a name='712'>
    do i = i_start, i_end<a name='713'>
      g_rhs(i,k) = g_rhs(i,k)-g_wdwn(i,k+1)*dts*fnm(k)-g_wdwn(i,k)*dts*fnp(k)<a name='714'>
      rhs(i,k) = rhs(i,k)-dts*(fnm(k)*wdwn(i,k+1)+fnp(k)*wdwn(i,k))<a name='715'>
    end do<a name='716'>
  end do<a name='717'>
  do k = 2, k_end+1<a name='718'>
    do i = i_start, i_end<a name='719'>
      g_rhs(i,k) = g_mut_inv(i)*msft(i,j)*rhs(i,k)+g_ph(i,k,j)+g_rhs(i,k)*msft(i,j)*mut_inv(i)<a name='720'>
      rhs(i,k) = ph(i,k,j)+msft(i,j)*rhs(i,k)*mut_inv(i)<a name='721'>
    end do<a name='722'>
  end do<a name='723'>
  do i = i_start, i_end<a name='724'>
    g_w(i,1,j) = 0.5*g_u(i+1,3,j)*rdx*(ht(i+1,j)-ht(i,j))*cf3+0.5*g_u(i,3,j)*rdx*(ht(i,j)-ht(i-1,j))*cf3+0.5*g_u(i+1,2,j)*rdx*&amp;<a name='725'>
&amp;(ht(i+1,j)-ht(i,j))*cf2+0.5*g_u(i,2,j)*rdx*(ht(i,j)-ht(i-1,j))*cf2+0.5*g_u(i+1,1,j)*rdx*(ht(i+1,j)-ht(i,j))*cf1+0.5*g_u(i,1,j)&amp;<a name='726'>
&amp;*rdx*(ht(i,j)-ht(i-1,j))*cf1+0.5*g_v(i,3,j+1)*rdy*(ht(i,j+1)-ht(i,j))*cf3+0.5*g_v(i,3,j)*rdy*(ht(i,j)-ht(i,j-1))*cf3+0.5*&amp;<a name='727'>
&amp;g_v(i,2,j+1)*rdy*(ht(i,j+1)-ht(i,j))*cf2+0.5*g_v(i,2,j)*rdy*(ht(i,j)-ht(i,j-1))*cf2+0.5*g_v(i,1,j+1)*rdy*(ht(i,j+1)-ht(i,j))*&amp;<a name='728'>
&amp;cf1+0.5*g_v(i,1,j)*rdy*(ht(i,j)-ht(i,j-1))*cf1<a name='729'>
    w(i,1,j) = 0.5*rdy*((ht(i,j+1)-ht(i,j))*(cf1*v(i,1,j+1)+cf2*v(i,2,j+1)+cf3*v(i,3,j+1))+(ht(i,j)-ht(i,j-1))*(cf1*v(i,1,j)+cf2*&amp;<a name='730'>
&amp;v(i,2,j)+cf3*v(i,3,j)))+0.5*rdx*((ht(i+1,j)-ht(i,j))*(cf1*u(i+1,1,j)+cf2*u(i+1,2,j)+cf3*u(i+1,3,j))+(ht(i,j)-ht(i-1,j))*(cf1*&amp;<a name='731'>
&amp;u(i,1,j)+cf2*u(i,2,j)+cf3*u(i,3,j)))<a name='732'>
  end do<a name='733'>
  do k = 2, k_end<a name='734'>
    do i = i_start, i_end<a name='735'>
      g_w(i,k,j) = (-(g_alt(i,k-1,j)*dts*g*msft_inv(i)*rdn(k)*c2a(i,k-1,j)*t_2ave(i,k-1,j)))+g_alt(i,k,j)*dts*g*msft_inv(i)*rdn(k)*&amp;<a name='736'>
&amp;c2a(i,k,j)*t_2ave(i,k,j)+g_c2a(i,k-1,j)*((-(0.5*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*rdnw(k-1)*((1.+epssm)*(rhs(i,&amp;<a name='737'>
&amp;k)-rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)-ph(i,k-1,j)))))+dts*g*msft_inv(i)*((-(rdn(k)*alt(i,k-1,j)*t_2ave(i,k-1,j)))-rdn(k)*&amp;<a name='738'>
&amp;alb(i,k-1,j)*mut_inv(i)*muave(i,j)))+g_c2a(i,k,j)*(0.5*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*rdnw(k)*((1.+epssm)*&amp;<a name='739'>
&amp;(rhs(i,k+1)-rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))+dts*g*msft_inv(i)*rdn(k)*(alt(i,k,j)*t_2ave(i,k,j)+alb(i,k,j)*&amp;<a name='740'>
&amp;mut_inv(i)*muave(i,j)))+0.5*g_cqw(i,k,j)*msft_inv(i)*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*((1.+epssm)*(rhs(i,k+1)-&amp;<a name='741'>
&amp;rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))-c2a(i,k-1,j)*rdnw(k-1)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)&amp;<a name='742'>
&amp;-ph(i,k-1,j))))+g_muave(i,j)*dts*g*msft_inv(i)*((-1)+rdn(k)*(c2a(i,k,j)*alb(i,k,j)-c2a(i,k-1,j)*alb(i,k-1,j))*mut_inv(i))+&amp;<a name='743'>
&amp;g_mut_inv(i)*(0.5*msft_inv(i)*cqw(i,k,j)*dts*g*rdn(k)*(c2a(i,k,j)*rdnw(k)*((1.+epssm)*(rhs(i,k+1)-rhs(i,k))+(1.-epssm)*&amp;<a name='744'>
&amp;(ph(i,k+1,j)-ph(i,k,j)))-c2a(i,k-1,j)*rdnw(k-1)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)-ph(i,k-1,j))))+dts*&amp;<a name='745'>
&amp;g*msft_inv(i)*rdn(k)*(c2a(i,k,j)*alb(i,k,j)-c2a(i,k-1,j)*alb(i,k-1,j))*muave(i,j))+0.5*g_ph(i,k-1,j)*msft_inv(i)*cqw(i,k,j)*&amp;<a name='746'>
&amp;dts*g*mut_inv(i)*rdn(k)*c2a(i,k-1,j)*rdnw(k-1)*(1.-epssm)+0.5*g_ph(i,k+1,j)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*&amp;<a name='747'>
&amp;c2a(i,k,j)*rdnw(k)*(1.-epssm)-0.5*g_ph(i,k,j)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*(1.-epssm)+&amp;<a name='748'>
&amp;c2a(i,k-1,j)*rdnw(k-1)*(1.-epssm))+0.5*g_rhs(i,k-1)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*c2a(i,k-1,j)*rdnw(k-1)*&amp;<a name='749'>
&amp;(1.+epssm)+0.5*g_rhs(i,k+1)*msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*c2a(i,k,j)*rdnw(k)*(1+epssm)-0.5*g_rhs(i,k)*&amp;<a name='750'>
&amp;msft_inv(i)*cqw(i,k,j)*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*(1.+epssm)+c2a(i,k-1,j)*rdnw(k-1)*(1+epssm))+g_rw_tend(i,&amp;<a name='751'>
&amp;k,j)*dts-g_t_2ave(i,k-1,j)*dts*g*msft_inv(i)*rdn(k)*c2a(i,k-1,j)*alt(i,k-1,j)+g_t_2ave(i,k,j)*dts*g*msft_inv(i)*rdn(k)*&amp;<a name='752'>
&amp;c2a(i,k,j)*alt(i,k,j)+g_w(i,k,j)<a name='753'>
      w(i,k,j) = w(i,k,j)+dts*rw_tend(i,k,j)+msft_inv(i)*cqw(i,k,j)*0.5*dts*g*mut_inv(i)*rdn(k)*(c2a(i,k,j)*rdnw(k)*((1.+epssm)*&amp;<a name='754'>
&amp;(rhs(i,k+1)-rhs(i,k))+(1.-epssm)*(ph(i,k+1,j)-ph(i,k,j)))-c2a(i,k-1,j)*rdnw(k-1)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-&amp;<a name='755'>
&amp;epssm)*(ph(i,k,j)-ph(i,k-1,j))))+dts*g*msft_inv(i)*(rdn(k)*(c2a(i,k,j)*alt(i,k,j)*t_2ave(i,k,j)-c2a(i,k-1,j)*alt(i,k-1,j)*&amp;<a name='756'>
&amp;t_2ave(i,k-1,j))+(rdn(k)*(c2a(i,k,j)*alb(i,k,j)-c2a(i,k-1,j)*alb(i,k-1,j))*mut_inv(i)-1.)*muave(i,j))<a name='757'>
    end do<a name='758'>
  end do<a name='759'>
  k = k_end+1<a name='760'>
  do i = i_start, i_end<a name='761'>
    g_w(i,k,j) = (-(2*g_alt(i,k-1,j)*msft_inv(i)*dts*g*rdnw(k-1)*c2a(i,k-1,j)*t_2ave(i,k-1,j)))-g_c2a(i,k-1,j)*msft_inv(i)*dts*g*&amp;<a name='762'>
&amp;(mut_inv(i)*rdnw(k-1)**2*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)-ph(i,k-1,j)))+2*rdnw(k-1)*alt(i,k-1,j)*&amp;<a name='763'>
&amp;t_2ave(i,k-1,j)+2*rdnw(k-1)*alb(i,k-1,j)*mut_inv(i)*muave(i,j))-g_muave(i,j)*msft_inv(i)*dts*g*(1+2.*rdnw(k-1)*c2a(i,k-1,j)*&amp;<a name='764'>
&amp;alb(i,k-1,j)*mut_inv(i))-g_mut_inv(i)*msft_inv(i)*(dts*g*rdnw(k-1)**2*c2a(i,k-1,j)*((1.+epssm)*(rhs(i,k)-rhs(i,k-1))+(1.-&amp;<a name='765'>
&amp;epssm)*(ph(i,k,j)-ph(i,k-1,j)))+2*dts*g*rdnw(k-1)*c2a(i,k-1,j)*alb(i,k-1,j)*muave(i,j))+g_ph(i,k-1,j)*msft_inv(i)*dts*g*&amp;<a name='766'>
&amp;mut_inv(i)*rdnw(k-1)**2*c2a(i,k-1,j)*(1.-epssm)-g_ph(i,k,j)*msft_inv(i)*dts*g*mut_inv(i)*rdnw(k-1)**2*c2a(i,k-1,j)*(1.-epssm)+&amp;<a name='767'>
&amp;g_rhs(i,k-1)*msft_inv(i)*dts*g*mut_inv(i)*rdnw(k-1)**2*c2a(i,k-1,j)*(1.+epssm)-g_rhs(i,k)*msft_inv(i)*dts*g*mut_inv(i)*rdnw(k-&amp;<a name='768'>
&amp;1)**2*c2a(i,k-1,j)*(1+epssm)+g_rw_tend(i,k,j)*dts-2*g_t_2ave(i,k-1,j)*msft_inv(i)*dts*g*rdnw(k-1)*c2a(i,k-1,j)*alt(i,k-1,j)+&amp;<a name='769'>
&amp;g_w(i,k,j)<a name='770'>
    w(i,k,j) = w(i,k,j)+dts*rw_tend(i,k,j)+msft_inv(i)*((-(0.5*dts*g*mut_inv(i)*rdnw(k-1)**2*2.*c2a(i,k-1,j)*((1.+epssm)*(rhs(i,k)-&amp;<a name='771'>
&amp;rhs(i,k-1))+(1.-epssm)*(ph(i,k,j)-ph(i,k-1,j)))))-dts*g*(2.*rdnw(k-1)*c2a(i,k-1,j)*alt(i,k-1,j)*t_2ave(i,k-1,j)+(1.+2.*rdnw(k-&amp;<a name='772'>
&amp;1)*c2a(i,k-1,j)*alb(i,k-1,j)*mut_inv(i))*muave(i,j)))<a name='773'>
  end do<a name='774'>
  do k = 2, k_end+1<a name='775'>
    do i = i_start, i_end<a name='776'>
      g_w(i,k,j) = (-(g_a(i,k,j)*w(i,k-1,j)*alpha(i,k,j)))+g_alpha(i,k,j)*(w(i,k,j)-a(i,k,j)*w(i,k-1,j))-g_w(i,k-1,j)*a(i,k,j)*&amp;<a name='777'>
&amp;alpha(i,k,j)+g_w(i,k,j)*alpha(i,k,j)<a name='778'>
      w(i,k,j) = (w(i,k,j)-a(i,k,j)*w(i,k-1,j))*alpha(i,k,j)<a name='779'>
    end do<a name='780'>
  end do<a name='781'>
  do k = k_end, 2, -1<a name='782'>
    do i = i_start, i_end<a name='783'>
      g_w(i,k,j) = (-(g_gamma(i,k,j)*w(i,k+1,j)))-g_w(i,k+1,j)*gamma(i,k,j)+g_w(i,k,j)<a name='784'>
      w(i,k,j) = w(i,k,j)-gamma(i,k,j)*w(i,k+1,j)<a name='785'>
    end do<a name='786'>
  end do<a name='787'>
  do k = 2, k_end+1<a name='788'>
    do i = i_start, i_end<a name='789'>
      g_ph(i,k,j) = (-(g_muts(i,j)*(0.5*msft(i,j)*dts*g*(1.+epssm)*w(i,k,j)/(muts(i,j)*muts(i,j)))))+g_rhs(i,k)+g_w(i,k,j)*(0.5*&amp;<a name='790'>
&amp;msft(i,j)*dts*g*(1.+epssm)/muts(i,j))<a name='791'>
      ph(i,k,j) = rhs(i,k)+msft(i,j)*0.5*dts*g*(1.+epssm)*w(i,k,j)/muts(i,j)<a name='792'>
    end do<a name='793'>
  end do<a name='794'>
end do j_loop_w<a name='795'>
<a name='796'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_97">("g_advance_w")<a name='797'>
<a name='798'>
end subroutine g_advance_w<a name='799'>
<a name='800'>
<a name='801'>
<A NAME='G_CALC_COEF_W'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_COEF_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='802'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_coef_w</font>( a, g_a, alpha, g_alpha, gamma, g_gamma, mut, g_mut, cqw, g_cqw, rdn, rdnw, c2a, g_c2a, dts, g, epssm, &amp; <A href='../../call_to/G_CALC_COEF_W.html' TARGET='index'>3</A>,<A href='../../call_from/G_CALC_COEF_W.html' TARGET='index'>2</A><a name='803'>
&amp;ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte )<a name='804'>
<font color=#447700>!******************************************************************<a name='805'></font>
<font color=#447700>!******************************************************************<a name='806'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='807'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='808'></font>
<font color=#447700>!******************************************************************<a name='809'></font>
<font color=#447700>!******************************************************************<a name='810'></font>
<font color=#447700>!==============================================<a name='811'></font>
<font color=#447700>! all entries are defined explicitly<a name='812'></font>
<font color=#447700>!==============================================<a name='813'></font>
implicit none<a name='814'>
<a name='815'>
<font color=#447700>!==============================================<a name='816'></font>
<font color=#447700>! declare arguments<a name='817'></font>
<font color=#447700>!==============================================<a name='818'></font>
integer, intent(in) :: ime<a name='819'>
integer, intent(in) :: ims<a name='820'>
integer, intent(in) :: jme<a name='821'>
integer, intent(in) :: jms<a name='822'>
integer, intent(in) :: kme<a name='823'>
integer, intent(in) :: kms<a name='824'>
real, intent(inout) :: a(ims:ime,kms:kme,jms:jme)<a name='825'>
real, intent(inout) :: alpha(ims:ime,kms:kme,jms:jme)<a name='826'>
real, intent(in) :: c2a(ims:ime,kms:kme,jms:jme)<a name='827'>
real, intent(in) :: cqw(ims:ime,kms:kme,jms:jme)<a name='828'>
real, intent(in) :: dts<a name='829'>
real, intent(in) :: epssm<a name='830'>
real, intent(in) :: g<a name='831'>
real, intent(inout) :: g_a(ims:ime,kms:kme,jms:jme)<a name='832'>
real, intent(inout) :: g_alpha(ims:ime,kms:kme,jms:jme)<a name='833'>
real, intent(in) :: g_c2a(ims:ime,kms:kme,jms:jme)<a name='834'>
real, intent(in) :: g_cqw(ims:ime,kms:kme,jms:jme)<a name='835'>
real, intent(inout) :: g_gamma(ims:ime,kms:kme,jms:jme)<a name='836'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='837'>
real, intent(inout) :: gamma(ims:ime,kms:kme,jms:jme)<a name='838'>
integer, intent(in) :: ide<a name='839'>
integer, intent(in) :: ite<a name='840'>
integer, intent(in) :: its<a name='841'>
integer, intent(in) :: jde<a name='842'>
integer, intent(in) :: jte<a name='843'>
integer, intent(in) :: jts<a name='844'>
integer, intent(in) :: kde<a name='845'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='846'>
real, intent(in) :: rdn(kms:kme)<a name='847'>
real, intent(in) :: rdnw(kms:kme)<a name='848'>
<a name='849'>
<font color=#447700>!==============================================<a name='850'></font>
<font color=#447700>! declare local variables<a name='851'></font>
<font color=#447700>!==============================================<a name='852'></font>
real b<a name='853'>
real c<a name='854'>
real cof(ims:ime)<a name='855'>
real g_b<a name='856'>
real g_c<a name='857'>
real g_cof(ims:ime)<a name='858'>
integer i<a name='859'>
integer i_end<a name='860'>
integer i_start<a name='861'>
integer j<a name='862'>
integer j_end<a name='863'>
integer j_start<a name='864'>
integer k<a name='865'>
<a name='866'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_COEF_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_98">("g_calc_coef_w")<a name='867'>
<a name='868'>
<font color=#447700>!----------------------------------------------<a name='869'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='870'></font>
<font color=#447700>!----------------------------------------------<a name='871'></font>
i_start = its<a name='872'>
i_end = ite<a name='873'>
j_start = jts<a name='874'>
j_end = jte<a name='875'>
if (j_end .eq. jde) then<a name='876'>
  j_end = j_end-1<a name='877'>
endif<a name='878'>
if (i_end .eq. ide) then<a name='879'>
  i_end = i_end-1<a name='880'>
endif<a name='881'>
outer_j_loop: do j = j_start, j_end<a name='882'>
  do i = i_start, i_end<a name='883'>
    g_cof(i) = -(2*g_mut(i,j)*0.5*dts*g*(1.+epssm)/(mut(i,j)*mut(i,j))*(0.5*dts*g*(1.+epssm)/mut(i,j)))<a name='884'>
    cof(i) = (0.5*dts*g*(1.+epssm)/mut(i,j))**2<a name='885'>
    g_a(i,2,j) = 0.<a name='886'>
    a(i,2,j) = 0.<a name='887'>
    g_a(i,kde,j) = (-(2*g_c2a(i,kde-1,j)*cof(i)*rdnw(kde-1)**2))-2*g_cof(i)*rdnw(kde-1)**2*c2a(i,kde-1,j)<a name='888'>
    a(i,kde,j) = -(2.*cof(i)*rdnw(kde-1)**2*c2a(i,kde-1,j))<a name='889'>
    g_gamma(i,1,j) = 0.<a name='890'>
    gamma(i,1,j) = 0.<a name='891'>
  end do<a name='892'>
  do k = 3, kde-1<a name='893'>
    do i = i_start, i_end<a name='894'>
      g_a(i,k,j) = (-(g_c2a(i,k-1,j)*cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k-1)))-g_cof(i)*cqw(i,k,j)*rdn(k)*rdnw(k-1)*c2a(i,k-1,j)-&amp;<a name='895'>
&amp;g_cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k-1)*c2a(i,k-1,j)<a name='896'>
      a(i,k,j) = -(cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k-1)*c2a(i,k-1,j))<a name='897'>
    end do<a name='898'>
  end do<a name='899'>
  do k = 2, kde-1<a name='900'>
    do i = i_start, i_end<a name='901'>
      g_b = g_c2a(i,k-1,j)*cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k-1)+g_c2a(i,k,j)*cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k)+g_cof(i)*cqw(i,k,j)*&amp;<a name='902'>
&amp;rdn(k)*(rdnw(k)*c2a(i,k,j)+rdnw(k-1)*c2a(i,k-1,j))+g_cqw(i,k,j)*cof(i)*rdn(k)*(rdnw(k)*c2a(i,k,j)+rdnw(k-1)*c2a(i,k-1,j))<a name='903'>
      b = 1.+cqw(i,k,j)*cof(i)*rdn(k)*(rdnw(k)*c2a(i,k,j)+rdnw(k-1)*c2a(i,k-1,j))<a name='904'>
      g_c = (-(g_c2a(i,k,j)*cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k)))-g_cof(i)*cqw(i,k,j)*rdn(k)*rdnw(k)*c2a(i,k,j)-g_cqw(i,k,j)*cof(i)*&amp;<a name='905'>
&amp;rdn(k)*rdnw(k)*c2a(i,k,j)<a name='906'>
      c = -(cqw(i,k,j)*cof(i)*rdn(k)*rdnw(k)*c2a(i,k,j))<a name='907'>
      g_alpha(i,k,j) = g_a(i,k,j)*(1.*gamma(i,k-1,j)/((b-a(i,k,j)*gamma(i,k-1,j))*(b-a(i,k,j)*gamma(i,k-1,j))))-g_b/((b-a(i,k,j)*&amp;<a name='908'>
&amp;gamma(i,k-1,j))*(b-a(i,k,j)*gamma(i,k-1,j)))+g_gamma(i,k-1,j)*(1.*a(i,k,j)/((b-a(i,k,j)*gamma(i,k-1,j))*(b-a(i,k,j)*gamma(i,&amp;<a name='909'>
&amp;k-1,j))))<a name='910'>
      alpha(i,k,j) = 1./(b-a(i,k,j)*gamma(i,k-1,j))<a name='911'>
      g_gamma(i,k,j) = g_alpha(i,k,j)*c+g_c*alpha(i,k,j)<a name='912'>
      gamma(i,k,j) = c*alpha(i,k,j)<a name='913'>
    end do<a name='914'>
  end do<a name='915'>
  do i = i_start, i_end<a name='916'>
    g_b = 2*g_c2a(i,kde-1,j)*cof(i)*rdnw(kde-1)**2+2*g_cof(i)*rdnw(kde-1)**2*c2a(i,kde-1,j)<a name='917'>
    b = 1.+2.*cof(i)*rdnw(kde-1)**2*c2a(i,kde-1,j)<a name='918'>
    g_c = 0.<a name='919'>
    c = 0.<a name='920'>
    g_alpha(i,kde,j) = g_a(i,kde,j)*(1.*gamma(i,kde-1,j)/((b-a(i,kde,j)*gamma(i,kde-1,j))*(b-a(i,kde,j)*gamma(i,kde-1,j))))-g_b/&amp;<a name='921'>
&amp;((b-a(i,kde,j)*gamma(i,kde-1,j))*(b-a(i,kde,j)*gamma(i,kde-1,j)))+g_gamma(i,kde-1,j)*(1.*a(i,kde,j)/((b-a(i,kde,j)*gamma(i,&amp;<a name='922'>
&amp;kde-1,j))*(b-a(i,kde,j)*gamma(i,kde-1,j))))<a name='923'>
    alpha(i,kde,j) = 1./(b-a(i,kde,j)*gamma(i,kde-1,j))<a name='924'>
    g_gamma(i,kde,j) = g_alpha(i,kde,j)*c+g_c*alpha(i,kde,j)<a name='925'>
    gamma(i,kde,j) = c*alpha(i,kde,j)<a name='926'>
  end do<a name='927'>
end do outer_j_loop<a name='928'>
<a name='929'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_COEF_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_98">("g_calc_coef_w")<a name='930'>
<a name='931'>
end subroutine g_calc_coef_w<a name='932'>
<a name='933'>
<a name='934'>
<A NAME='G_CALC_P_RHO'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_P_RHO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='935'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_p_rho</font>( al, g_al, p, g_p, ph, g_ph, alt, g_alt, t_2, g_t_2, t_1, g_t_1, c2a, g_c2a, pm1, g_pm1, mu, g_mu, muts, &amp; <A href='../../call_to/G_CALC_P_RHO.html' TARGET='index'>4</A>,<A href='../../call_from/G_CALC_P_RHO.html' TARGET='index'>2</A><a name='936'>
&amp;g_muts, znu, t0, rdnw, dnw, smdiv, non_hydrostatic, step, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, &amp;<a name='937'>
&amp;kte )<a name='938'>
<font color=#447700>!******************************************************************<a name='939'></font>
<font color=#447700>!******************************************************************<a name='940'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='941'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='942'></font>
<font color=#447700>!******************************************************************<a name='943'></font>
<font color=#447700>!******************************************************************<a name='944'></font>
<font color=#447700>!==============================================<a name='945'></font>
<font color=#447700>! all entries are defined explicitly<a name='946'></font>
<font color=#447700>!==============================================<a name='947'></font>
implicit none<a name='948'>
<a name='949'>
<font color=#447700>!==============================================<a name='950'></font>
<font color=#447700>! declare arguments<a name='951'></font>
<font color=#447700>!==============================================<a name='952'></font>
integer, intent(in) :: ime<a name='953'>
integer, intent(in) :: ims<a name='954'>
integer, intent(in) :: jme<a name='955'>
integer, intent(in) :: jms<a name='956'>
integer, intent(in) :: kme<a name='957'>
integer, intent(in) :: kms<a name='958'>
real, intent(out) :: al(ims:ime,kms:kme,jms:jme)<a name='959'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='960'>
real, intent(in) :: c2a(ims:ime,kms:kme,jms:jme)<a name='961'>
real, intent(in) :: dnw(kms:kme)<a name='962'>
real, intent(out) :: g_al(ims:ime,kms:kme,jms:jme)<a name='963'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='964'>
real, intent(in) :: g_c2a(ims:ime,kms:kme,jms:jme)<a name='965'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='966'>
real, intent(in) :: g_muts(ims:ime,jms:jme)<a name='967'>
real, intent(out) :: g_p(ims:ime,kms:kme,jms:jme)<a name='968'>
real, intent(inout) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='969'>
real, intent(inout) :: g_pm1(ims:ime,kms:kme,jms:jme)<a name='970'>
real, intent(in) :: g_t_1(ims:ime,kms:kme,jms:jme)<a name='971'>
real, intent(in) :: g_t_2(ims:ime,kms:kme,jms:jme)<a name='972'>
integer, intent(in) :: ide<a name='973'>
integer, intent(in) :: ite<a name='974'>
integer, intent(in) :: its<a name='975'>
integer, intent(in) :: jde<a name='976'>
integer, intent(in) :: jte<a name='977'>
integer, intent(in) :: jts<a name='978'>
integer, intent(in) :: kde<a name='979'>
integer, intent(in) :: kte<a name='980'>
integer, intent(in) :: kts<a name='981'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='982'>
real, intent(in) :: muts(ims:ime,jms:jme)<a name='983'>
logical, intent(in) :: non_hydrostatic<a name='984'>
real, intent(out) :: p(ims:ime,kms:kme,jms:jme)<a name='985'>
real, intent(inout) :: ph(ims:ime,kms:kme,jms:jme)<a name='986'>
real, intent(inout) :: pm1(ims:ime,kms:kme,jms:jme)<a name='987'>
real, intent(in) :: rdnw(kms:kme)<a name='988'>
real, intent(in) :: smdiv<a name='989'>
integer, intent(in) :: step<a name='990'>
real, intent(in) :: t0<a name='991'>
real, intent(in) :: t_1(ims:ime,kms:kme,jms:jme)<a name='992'>
real, intent(in) :: t_2(ims:ime,kms:kme,jms:jme)<a name='993'>
real, intent(in) :: znu(kms:kme)<a name='994'>
<a name='995'>
<font color=#447700>!==============================================<a name='996'></font>
<font color=#447700>! declare local variables<a name='997'></font>
<font color=#447700>!==============================================<a name='998'></font>
real g_ptmp<a name='999'>
integer i<a name='1000'>
integer i_end<a name='1001'>
integer i_start<a name='1002'>
integer j<a name='1003'>
integer j_end<a name='1004'>
integer j_start<a name='1005'>
integer k<a name='1006'>
integer k_end<a name='1007'>
integer k_start<a name='1008'>
real ptmp<a name='1009'>
<a name='1010'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_P_RHO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_99">("g_calc_p_rho")<a name='1011'>
<a name='1012'>
<font color=#447700>!----------------------------------------------<a name='1013'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1014'></font>
<font color=#447700>!----------------------------------------------<a name='1015'></font>
i_start = its<a name='1016'>
i_end = ite<a name='1017'>
j_start = jts<a name='1018'>
j_end = jte<a name='1019'>
k_start = kts<a name='1020'>
k_end = min(kte,kde-1)<a name='1021'>
if (i_end .eq. ide) then<a name='1022'>
  i_end = i_end-1<a name='1023'>
endif<a name='1024'>
if (j_end .eq. jde) then<a name='1025'>
  j_end = j_end-1<a name='1026'>
endif<a name='1027'>
if (non_hydrostatic) then<a name='1028'>
  do j = j_start, j_end<a name='1029'>
    do k = k_start, k_end<a name='1030'>
      do i = i_start, i_end<a name='1031'>
        g_al(i,k,j) = (-(g_alt(i,k,j)*1./muts(i,j)*mu(i,j)))-g_mu(i,j)*1./muts(i,j)*alt(i,k,j)+g_muts(i,j)/(muts(i,j)*muts(i,j))*&amp;<a name='1032'>
&amp;(alt(i,k,j)*mu(i,j)+rdnw(k)*(ph(i,k+1,j)-ph(i,k,j)))-g_ph(i,k+1,j)*1./muts(i,j)*rdnw(k)+g_ph(i,k,j)*1./muts(i,j)*rdnw(k)<a name='1033'>
        al(i,k,j) = -(1./muts(i,j)*(alt(i,k,j)*mu(i,j)+rdnw(k)*(ph(i,k+1,j)-ph(i,k,j))))<a name='1034'>
        g_p(i,k,j) = (-(g_al(i,k,j)*c2a(i,k,j)))+g_alt(i,k,j)*c2a(i,k,j)*((t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)&amp;<a name='1035'>
&amp;)))+g_c2a(i,k,j)*(alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)))-al(i,k,j))-g_mu(i,j)*c2a(i,k,j)*&amp;<a name='1036'>
&amp;(alt(i,k,j)*t_1(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))-g_muts(i,j)*c2a(i,k,j)*(alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))*&amp;<a name='1037'>
&amp;(t0+t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j))*muts(i,j)*(t0+t_1(i,k,j))))-g_t_1(i,k,j)*c2a(i,k,j)*(alt(i,k,j)*mu(i,j)/&amp;<a name='1038'>
&amp;(muts(i,j)*(t0+t_1(i,k,j)))+alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))*muts(i,j)/(muts(i,j)*(t0+t_1(i,k,j))*muts(i,j)*(t0+&amp;<a name='1039'>
&amp;t_1(i,k,j))))+g_t_2(i,k,j)*c2a(i,k,j)*(alt(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1040'>
        p(i,k,j) = c2a(i,k,j)*(alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)))-al(i,k,j))<a name='1041'>
      end do<a name='1042'>
    end do<a name='1043'>
  end do<a name='1044'>
else<a name='1045'>
  do j = j_start, j_end<a name='1046'>
    do k = k_start, k_end<a name='1047'>
      do i = i_start, i_end<a name='1048'>
        g_p(i,k,j) = g_mu(i,j)*znu(k)<a name='1049'>
        p(i,k,j) = mu(i,j)*znu(k)<a name='1050'>
        g_al(i,k,j) = g_alt(i,k,j)*((t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j))))+g_c2a(i,k,j)*(p(i,k,j)/(c2a(i,k,j)&amp;<a name='1051'>
&amp;*c2a(i,k,j)))-g_mu(i,j)*(alt(i,k,j)*t_1(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))-g_muts(i,j)*(alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*&amp;<a name='1052'>
&amp;t_1(i,k,j))*(t0+t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j))*muts(i,j)*(t0+t_1(i,k,j))))-g_p(i,k,j)/c2a(i,k,j)-g_t_1(i,k,j)*&amp;<a name='1053'>
&amp;(alt(i,k,j)*mu(i,j)/(muts(i,j)*(t0+t_1(i,k,j)))+alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))*muts(i,j)/(muts(i,j)*(t0+t_1(i,&amp;<a name='1054'>
&amp;k,j))*muts(i,j)*(t0+t_1(i,k,j))))+g_t_2(i,k,j)*(alt(i,k,j)/(muts(i,j)*(t0+t_1(i,k,j))))<a name='1055'>
        al(i,k,j) = alt(i,k,j)*(t_2(i,k,j)-mu(i,j)*t_1(i,k,j))/(muts(i,j)*(t0+t_1(i,k,j)))-p(i,k,j)/c2a(i,k,j)<a name='1056'>
        g_ph(i,k+1,j) = (-(g_al(i,k,j)*dnw(k)*muts(i,j)))-g_alt(i,k,j)*dnw(k)*mu(i,j)-g_mu(i,j)*dnw(k)*alt(i,k,j)-g_muts(i,j)*&amp;<a name='1057'>
&amp;dnw(k)*al(i,k,j)+g_ph(i,k,j)<a name='1058'>
        ph(i,k+1,j) = ph(i,k,j)-dnw(k)*(muts(i,j)*al(i,k,j)+mu(i,j)*alt(i,k,j))<a name='1059'>
      end do<a name='1060'>
    end do<a name='1061'>
  end do<a name='1062'>
endif<a name='1063'>
if (step .eq. 0) then<a name='1064'>
  do j = j_start, j_end<a name='1065'>
    do k = k_start, k_end<a name='1066'>
      do i = i_start, i_end<a name='1067'>
        g_pm1(i,k,j) = g_p(i,k,j)<a name='1068'>
        pm1(i,k,j) = p(i,k,j)<a name='1069'>
      end do<a name='1070'>
    end do<a name='1071'>
  end do<a name='1072'>
else<a name='1073'>
  do j = j_start, j_end<a name='1074'>
    do k = k_start, k_end<a name='1075'>
      do i = i_start, i_end<a name='1076'>
        g_ptmp = g_p(i,k,j)<a name='1077'>
        ptmp = p(i,k,j)<a name='1078'>
        g_p(i,k,j) = g_p(i,k,j)*(1+smdiv)-g_pm1(i,k,j)*smdiv<a name='1079'>
        p(i,k,j) = p(i,k,j)+smdiv*(p(i,k,j)-pm1(i,k,j))<a name='1080'>
        g_pm1(i,k,j) = g_ptmp<a name='1081'>
        pm1(i,k,j) = ptmp<a name='1082'>
      end do<a name='1083'>
    end do<a name='1084'>
  end do<a name='1085'>
endif<a name='1086'>
<a name='1087'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_P_RHO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_99">("g_calc_p_rho")<a name='1088'>
<a name='1089'>
end subroutine g_calc_p_rho<a name='1090'>
<a name='1091'>
<A NAME='G_SMALL_STEP_FINISH'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SMALL_STEP_FINISH' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1092'>
<font color=#993300>subroutine </font><font color=#cc0000>g_small_step_finish</font>( u_2, g_u_2, v_2, g_v_2, w_2, g_w_2, t_2, g_t_2, ph_2, g_ph_2, ww, mu_2, g_mu_2, mut, g_mut, muts, &amp; <A href='../../call_to/G_SMALL_STEP_FINISH.html' TARGET='index'>3</A>,<A href='../../call_from/G_SMALL_STEP_FINISH.html' TARGET='index'>2</A><a name='1093'>
&amp;g_muts, muu, g_muu, muus, g_muus, muv, g_muv, muvs, g_muvs, u_save, g_u_save, v_save, g_v_save, w_save, g_w_save, t_save, &amp;<a name='1094'>
&amp;g_t_save, ph_save, g_ph_save, mu_save, g_mu_save, msfu, msfv, msft, ide, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, &amp;<a name='1095'>
&amp;jts, jte )<a name='1096'>
<a name='1097'>
<font color=#447700>!******************************************************************<a name='1098'></font>
<font color=#447700>!******************************************************************<a name='1099'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1100'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1101'></font>
<font color=#447700>!******************************************************************<a name='1102'></font>
<font color=#447700>!******************************************************************<a name='1103'></font>
<font color=#447700>!==============================================<a name='1104'></font>
<font color=#447700>! all entries are defined explicitly<a name='1105'></font>
<font color=#447700>!==============================================<a name='1106'></font>
implicit none<a name='1107'>
<a name='1108'>
<font color=#447700>!==============================================<a name='1109'></font>
<font color=#447700>! declare arguments<a name='1110'></font>
<font color=#447700>!==============================================<a name='1111'></font>
integer, intent(in) :: ime<a name='1112'>
integer, intent(in) :: ims<a name='1113'>
integer, intent(in) :: jme<a name='1114'>
integer, intent(in) :: jms<a name='1115'>
real, intent(inout) :: g_mu_2(ims:ime,jms:jme)<a name='1116'>
real, intent(inout) :: g_mu_save(ims:ime,jms:jme)<a name='1117'>
real, intent(inout) :: g_mut(ims:ime,jms:jme)<a name='1118'>
real, intent(inout) :: g_muts(ims:ime,jms:jme)<a name='1119'>
real, intent(inout) :: g_muu(ims:ime,jms:jme)<a name='1120'>
real, intent(inout) :: g_muus(ims:ime,jms:jme)<a name='1121'>
real, intent(inout) :: g_muv(ims:ime,jms:jme)<a name='1122'>
real, intent(inout) :: g_muvs(ims:ime,jms:jme)<a name='1123'>
integer, intent(in) :: kme<a name='1124'>
integer, intent(in) :: kms<a name='1125'>
real, intent(inout) :: g_ph_2(ims:ime,kms:kme,jms:jme)<a name='1126'>
real, intent(in) :: g_ph_save(ims:ime,kms:kme,jms:jme)<a name='1127'>
real, intent(inout) :: g_t_2(ims:ime,kms:kme,jms:jme)<a name='1128'>
real, intent(in) :: g_t_save(ims:ime,kms:kme,jms:jme)<a name='1129'>
real, intent(inout) :: g_u_2(ims:ime,kms:kme,jms:jme)<a name='1130'>
real, intent(in) :: g_u_save(ims:ime,kms:kme,jms:jme)<a name='1131'>
real, intent(inout) :: g_v_2(ims:ime,kms:kme,jms:jme)<a name='1132'>
real, intent(in) :: g_v_save(ims:ime,kms:kme,jms:jme)<a name='1133'>
real, intent(inout) :: g_w_2(ims:ime,kms:kme,jms:jme)<a name='1134'>
real, intent(in) :: g_w_save(ims:ime,kms:kme,jms:jme)<a name='1135'>
integer, intent(in) :: ide<a name='1136'>
integer, intent(in) :: ite<a name='1137'>
integer, intent(in) :: its<a name='1138'>
integer, intent(in) :: jde<a name='1139'>
integer, intent(in) :: jte<a name='1140'>
integer, intent(in) :: jts<a name='1141'>
integer, intent(in) :: kde<a name='1142'>
integer, intent(in) :: kds<a name='1143'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='1144'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='1145'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='1146'>
real, intent(inout) :: mu_2(ims:ime,jms:jme)<a name='1147'>
real, intent(inout) :: mu_save(ims:ime,jms:jme)<a name='1148'>
real, intent(inout) :: mut(ims:ime,jms:jme)<a name='1149'>
real, intent(inout) :: muts(ims:ime,jms:jme)<a name='1150'>
real, intent(inout) :: muu(ims:ime,jms:jme)<a name='1151'>
real, intent(inout) :: muus(ims:ime,jms:jme)<a name='1152'>
real, intent(inout) :: muv(ims:ime,jms:jme)<a name='1153'>
real, intent(inout) :: muvs(ims:ime,jms:jme)<a name='1154'>
real, intent(inout) :: ph_2(ims:ime,kms:kme,jms:jme)<a name='1155'>
real, intent(in) :: ph_save(ims:ime,kms:kme,jms:jme)<a name='1156'>
real, intent(inout) :: t_2(ims:ime,kms:kme,jms:jme)<a name='1157'>
real, intent(in) :: t_save(ims:ime,kms:kme,jms:jme)<a name='1158'>
real, intent(inout) :: u_2(ims:ime,kms:kme,jms:jme)<a name='1159'>
real, intent(in) :: u_save(ims:ime,kms:kme,jms:jme)<a name='1160'>
real, intent(inout) :: v_2(ims:ime,kms:kme,jms:jme)<a name='1161'>
real, intent(in) :: v_save(ims:ime,kms:kme,jms:jme)<a name='1162'>
real, intent(inout) :: w_2(ims:ime,kms:kme,jms:jme)<a name='1163'>
real, intent(in) :: w_save(ims:ime,kms:kme,jms:jme)<a name='1164'>
real, intent(inout) :: ww(ims:ime,kms:kme,jms:jme)<a name='1165'>
<a name='1166'>
<a name='1167'>
  REAL,   DIMENSION(ims:ime, kms:kme, jms:jme)  ::ww1,g_ww1,g_ww<a name='1168'>
  REAL, DIMENSION(ims:ime, kms:kme, jms:jme) :: h_diabatic<a name='1169'>
  INTEGER                   :: number_of_small_timesteps<a name='1170'>
  REAL                      :: dts<a name='1171'>
<a name='1172'>
<a name='1173'>
<a name='1174'>
<font color=#447700>!==============================================<a name='1175'></font>
<font color=#447700>! declare local variables<a name='1176'></font>
<font color=#447700>!==============================================<a name='1177'></font>
integer i<a name='1178'>
integer i_end<a name='1179'>
integer i_endu<a name='1180'>
integer i_start<a name='1181'>
integer j<a name='1182'>
integer j_end<a name='1183'>
integer j_endv<a name='1184'>
integer j_start<a name='1185'>
integer k<a name='1186'>
<a name='1187'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SMALL_STEP_FINISH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_100">("g_small_step_finish")<a name='1188'>
<a name='1189'>
<font color=#447700>!----------------------------------------------<a name='1190'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1191'></font>
<font color=#447700>!----------------------------------------------<a name='1192'></font>
i_start = its<a name='1193'>
i_end = ite<a name='1194'>
j_start = jts<a name='1195'>
j_end = jte<a name='1196'>
i_endu = i_end<a name='1197'>
j_endv = j_end<a name='1198'>
if (i_end .eq. ide) then<a name='1199'>
  i_end = i_end-1<a name='1200'>
endif<a name='1201'>
if (j_end .eq. jde) then<a name='1202'>
  j_end = j_end-1<a name='1203'>
endif<a name='1204'>
do j = j_start, j_endv<a name='1205'>
  do k = kds, kde-1<a name='1206'>
    do i = i_start, i_end<a name='1207'>
      g_v_2(i,k,j) = g_muv(i,j)*(v_save(i,k,j)/muvs(i,j))-g_muvs(i,j)*((msfv(i,j)*v_2(i,k,j)+v_save(i,k,j)*muv(i,j))/(muvs(i,j)*&amp;<a name='1208'>
&amp;muvs(i,j)))+g_v_2(i,k,j)*(msfv(i,j)/muvs(i,j))+g_v_save(i,k,j)*(muv(i,j)/muvs(i,j))<a name='1209'>
      v_2(i,k,j) = (msfv(i,j)*v_2(i,k,j)+v_save(i,k,j)*muv(i,j))/muvs(i,j)<a name='1210'>
    end do<a name='1211'>
  end do<a name='1212'>
end do<a name='1213'>
do j = j_start, j_end<a name='1214'>
  do k = kds, kde-1<a name='1215'>
    do i = i_start, i_endu<a name='1216'>
      g_u_2(i,k,j) = g_muu(i,j)*(u_save(i,k,j)/muus(i,j))-g_muus(i,j)*((msfu(i,j)*u_2(i,k,j)+u_save(i,k,j)*muu(i,j))/(muus(i,j)*&amp;<a name='1217'>
&amp;muus(i,j)))+g_u_2(i,k,j)*(msfu(i,j)/muus(i,j))+g_u_save(i,k,j)*(muu(i,j)/muus(i,j))<a name='1218'>
      u_2(i,k,j) = (msfu(i,j)*u_2(i,k,j)+u_save(i,k,j)*muu(i,j))/muus(i,j)<a name='1219'>
    end do<a name='1220'>
  end do<a name='1221'>
end do<a name='1222'>
do j = j_start, j_end<a name='1223'>
  do k = kds, kde<a name='1224'>
    do i = i_start, i_end<a name='1225'>
      g_w_2(i,k,j) = g_mut(i,j)*(w_save(i,k,j)/muts(i,j))-g_muts(i,j)*((msft(i,j)*w_2(i,k,j)+w_save(i,k,j)*mut(i,j))/(muts(i,j)*&amp;<a name='1226'>
&amp;muts(i,j)))+g_w_2(i,k,j)*(msft(i,j)/muts(i,j))+g_w_save(i,k,j)*(mut(i,j)/muts(i,j))<a name='1227'>
      w_2(i,k,j) = (msft(i,j)*w_2(i,k,j)+w_save(i,k,j)*mut(i,j))/muts(i,j)<a name='1228'>
      g_ph_2(i,k,j) = g_ph_2(i,k,j)+g_ph_save(i,k,j)<a name='1229'>
      ph_2(i,k,j) = ph_2(i,k,j)+ph_save(i,k,j)<a name='1230'>
<a name='1231'>
<font color=#447700>!------------------------- added in May 9 -----------------<a name='1232'></font>
    g_ww(i,k,j) = g_ww(i,k,j) + g_ww1(i,k,j)<a name='1233'>
    ww(i,k,j) = ww(i,k,j) + ww1(i,k,j)<a name='1234'>
<font color=#447700>!------------------------- added in May 9 -----------------<a name='1235'></font>
<a name='1236'>
    end do<a name='1237'>
  end do<a name='1238'>
end do<a name='1239'>
do j = j_start, j_end<a name='1240'>
  do k = kds, kde-1<a name='1241'>
    do i = i_start, i_end<a name='1242'>
<font color=#447700>!zzma      g_t_2(i,k,j) = g_mut(i,j)*(t_save(i,k,j)/muts(i,j))-g_muts(i,j)*((t_2(i,k,j)+t_save(i,k,j)*mut(i,j))/(muts(i,j)*muts(i,j)))+&amp;<a name='1243'></font>
<font color=#447700>!zzma&amp;g_t_2(i,k,j)/muts(i,j)+g_t_save(i,k,j)*(mut(i,j)/muts(i,j))<a name='1244'></font>
<font color=#447700>!zzma      t_2(i,k,j) = (t_2(i,k,j)+t_save(i,k,j)*mut(i,j))/muts(i,j)<a name='1245'></font>
<a name='1246'>
<font color=#447700>!------------------------- rewrited in May 9 -----------------<a name='1247'></font>
     g_t_2(i,k,j) = (g_t_2(i,k,j) - dts*number_of_small_timesteps*g_mut(i,j)*h_diabatic(i,k,j)            &amp;<a name='1248'>
                    + g_t_save(i,k,j)*mut(i,j) + t_save(i,k,j)*g_mut(i,j))/muts(i,j)                      &amp;<a name='1249'>
                    -(t_2(i,k,j) - dts*number_of_small_timesteps*mut(i,j)*h_diabatic(i,k,j)+ t_save(i,k,j)*mut(i,j))*g_muts(i,j) &amp;<a name='1250'>
                    /muts(i,j)**2<a name='1251'>
    t_2(i,k,j) = (t_2(i,k,j) - dts*number_of_small_timesteps*mut(i,j)*h_diabatic(i,k,j) &amp;<a name='1252'>
                  + t_save(i,k,j)*mut(i,j))/muts(i,j)<a name='1253'>
<a name='1254'>
<font color=#447700>!------------------------- rewrited in May 9 -----------------<a name='1255'></font>
    end do<a name='1256'>
  end do<a name='1257'>
end do<a name='1258'>
do j = j_start, j_end<a name='1259'>
  do i = i_start, i_end<a name='1260'>
    g_mu_2(i,j) = g_mu_2(i,j)+g_mu_save(i,j)<a name='1261'>
    mu_2(i,j) = mu_2(i,j)+mu_save(i,j)<a name='1262'>
  end do<a name='1263'>
end do<a name='1264'>
<a name='1265'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SMALL_STEP_FINISH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_100">("g_small_step_finish")<a name='1266'>
<a name='1267'>
end subroutine g_small_step_finish<a name='1268'>
<a name='1269'>
<a name='1270'>
<A NAME='G_SMALL_STEP_PREP'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SMALL_STEP_PREP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1271'>
<font color=#993300>subroutine </font><font color=#cc0000>g_small_step_prep</font>( u_1, g_u_1, u_2, g_u_2, v_1, g_v_1, v_2, g_v_2, w_1, g_w_1, w_2, g_w_2, t_1, g_t_1, t_2, g_t_2, ph_1,&amp; <A href='../../call_to/G_SMALL_STEP_PREP.html' TARGET='index'>3</A>,<A href='../../call_from/G_SMALL_STEP_PREP.html' TARGET='index'>2</A><a name='1272'>
&amp; g_ph_1, ph_2, g_ph_2, mub, mu_1, g_mu_1, mu_2, g_mu_2, muu, g_muu, muus, g_muus, muv, g_muv, muvs, g_muvs, mut, g_mut, muts, &amp;<a name='1273'>
&amp;g_muts, mudf, g_mudf, u_save, g_u_save, v_save, g_v_save, w_save, g_w_save, t_save, g_t_save, ph_save, g_ph_save, mu_save, &amp;<a name='1274'>
&amp;g_mu_save, ww, g_ww, ww_save, g_ww_save, c2a, g_c2a, pb, p, g_p, alt, g_alt, msfu, msfv, msft, rk_step, leapfrog, ide, jde, kde, &amp;<a name='1275'>
&amp;ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1276'>
<font color=#447700>!******************************************************************<a name='1277'></font>
<font color=#447700>!******************************************************************<a name='1278'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1279'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1280'></font>
<font color=#447700>!******************************************************************<a name='1281'></font>
<font color=#447700>!******************************************************************<a name='1282'></font>
<font color=#447700>!==============================================<a name='1283'></font>
<font color=#447700>! all entries are defined explicitly<a name='1284'></font>
<font color=#447700>!==============================================<a name='1285'></font>
implicit none<a name='1286'>
<a name='1287'>
<font color=#447700>!==============================================<a name='1288'></font>
<font color=#447700>! declare arguments<a name='1289'></font>
<font color=#447700>!==============================================<a name='1290'></font>
integer, intent(in) :: ime<a name='1291'>
integer, intent(in) :: ims<a name='1292'>
integer, intent(in) :: jme<a name='1293'>
integer, intent(in) :: jms<a name='1294'>
integer, intent(in) :: kme<a name='1295'>
integer, intent(in) :: kms<a name='1296'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='1297'>
real, intent(out) :: c2a(ims:ime,kms:kme,jms:jme)<a name='1298'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='1299'>
real, intent(out) :: g_c2a(ims:ime,kms:kme,jms:jme)<a name='1300'>
real, intent(inout) :: g_mu_1(ims:ime,jms:jme)<a name='1301'>
real, intent(inout) :: g_mu_2(ims:ime,jms:jme)<a name='1302'>
real, intent(out) :: g_mu_save(ims:ime,jms:jme)<a name='1303'>
real, intent(out) :: g_mudf(ims:ime,jms:jme)<a name='1304'>
real, intent(inout) :: g_mut(ims:ime,jms:jme)<a name='1305'>
real, intent(out) :: g_muts(ims:ime,jms:jme)<a name='1306'>
real, intent(inout) :: g_muu(ims:ime,jms:jme)<a name='1307'>
real, intent(out) :: g_muus(ims:ime,jms:jme)<a name='1308'>
real, intent(inout) :: g_muv(ims:ime,jms:jme)<a name='1309'>
real, intent(out) :: g_muvs(ims:ime,jms:jme)<a name='1310'>
real, intent(in) :: g_p(ims:ime,kms:kme,jms:jme)<a name='1311'>
real, intent(inout) :: g_ph_1(ims:ime,kms:kme,jms:jme)<a name='1312'>
real, intent(inout) :: g_ph_2(ims:ime,kms:kme,jms:jme)<a name='1313'>
real, intent(out) :: g_ph_save(ims:ime,kms:kme,jms:jme)<a name='1314'>
real, intent(inout) :: g_t_1(ims:ime,kms:kme,jms:jme)<a name='1315'>
real, intent(inout) :: g_t_2(ims:ime,kms:kme,jms:jme)<a name='1316'>
real, intent(out) :: g_t_save(ims:ime,kms:kme,jms:jme)<a name='1317'>
real, intent(inout) :: g_u_1(ims:ime,kms:kme,jms:jme)<a name='1318'>
real, intent(inout) :: g_u_2(ims:ime,kms:kme,jms:jme)<a name='1319'>
real, intent(out) :: g_u_save(ims:ime,kms:kme,jms:jme)<a name='1320'>
real, intent(inout) :: g_v_1(ims:ime,kms:kme,jms:jme)<a name='1321'>
real, intent(inout) :: g_v_2(ims:ime,kms:kme,jms:jme)<a name='1322'>
real, intent(out) :: g_v_save(ims:ime,kms:kme,jms:jme)<a name='1323'>
real, intent(inout) :: g_w_1(ims:ime,kms:kme,jms:jme)<a name='1324'>
real, intent(inout) :: g_w_2(ims:ime,kms:kme,jms:jme)<a name='1325'>
real, intent(out) :: g_w_save(ims:ime,kms:kme,jms:jme)<a name='1326'>
real, intent(in) :: g_ww(ims:ime,kms:kme,jms:jme)<a name='1327'>
real, intent(out) :: g_ww_save(ims:ime,kms:kme,jms:jme)<a name='1328'>
integer, intent(in) :: ide<a name='1329'>
integer, intent(in) :: ite<a name='1330'>
integer, intent(in) :: its<a name='1331'>
integer, intent(in) :: jde<a name='1332'>
integer, intent(in) :: jte<a name='1333'>
integer, intent(in) :: jts<a name='1334'>
integer, intent(in) :: kde<a name='1335'>
integer, intent(in) :: kte<a name='1336'>
integer, intent(in) :: kts<a name='1337'>
logical, intent(in) :: leapfrog<a name='1338'>
real, intent(inout) :: msft(ims:ime,jms:jme)<a name='1339'>
real, intent(inout) :: msfu(ims:ime,jms:jme)<a name='1340'>
real, intent(inout) :: msfv(ims:ime,jms:jme)<a name='1341'>
real, intent(inout) :: mu_1(ims:ime,jms:jme)<a name='1342'>
real, intent(inout) :: mu_2(ims:ime,jms:jme)<a name='1343'>
real, intent(out) :: mu_save(ims:ime,jms:jme)<a name='1344'>
real, intent(inout) :: mub(ims:ime,jms:jme)<a name='1345'>
real, intent(out) :: mudf(ims:ime,jms:jme)<a name='1346'>
real, intent(inout) :: mut(ims:ime,jms:jme)<a name='1347'>
real, intent(out) :: muts(ims:ime,jms:jme)<a name='1348'>
real, intent(inout) :: muu(ims:ime,jms:jme)<a name='1349'>
real, intent(out) :: muus(ims:ime,jms:jme)<a name='1350'>
real, intent(inout) :: muv(ims:ime,jms:jme)<a name='1351'>
real, intent(out) :: muvs(ims:ime,jms:jme)<a name='1352'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='1353'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='1354'>
real, intent(inout) :: ph_1(ims:ime,kms:kme,jms:jme)<a name='1355'>
real, intent(inout) :: ph_2(ims:ime,kms:kme,jms:jme)<a name='1356'>
real, intent(out) :: ph_save(ims:ime,kms:kme,jms:jme)<a name='1357'>
integer, intent(in) :: rk_step<a name='1358'>
real, intent(inout) :: t_1(ims:ime,kms:kme,jms:jme)<a name='1359'>
real, intent(inout) :: t_2(ims:ime,kms:kme,jms:jme)<a name='1360'>
real, intent(out) :: t_save(ims:ime,kms:kme,jms:jme)<a name='1361'>
real, intent(inout) :: u_1(ims:ime,kms:kme,jms:jme)<a name='1362'>
real, intent(inout) :: u_2(ims:ime,kms:kme,jms:jme)<a name='1363'>
real, intent(out) :: u_save(ims:ime,kms:kme,jms:jme)<a name='1364'>
real, intent(inout) :: v_1(ims:ime,kms:kme,jms:jme)<a name='1365'>
real, intent(inout) :: v_2(ims:ime,kms:kme,jms:jme)<a name='1366'>
real, intent(out) :: v_save(ims:ime,kms:kme,jms:jme)<a name='1367'>
real, intent(inout) :: w_1(ims:ime,kms:kme,jms:jme)<a name='1368'>
real, intent(inout) :: w_2(ims:ime,kms:kme,jms:jme)<a name='1369'>
real, intent(out) :: w_save(ims:ime,kms:kme,jms:jme)<a name='1370'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='1371'>
real, intent(out) :: ww_save(ims:ime,kms:kme,jms:jme)<a name='1372'>
<a name='1373'>
<font color=#447700>!==============================================<a name='1374'></font>
<font color=#447700>! declare local variables<a name='1375'></font>
<font color=#447700>!==============================================<a name='1376'></font>
integer i<a name='1377'>
integer i_end<a name='1378'>
integer i_endu<a name='1379'>
integer i_start<a name='1380'>
integer j<a name='1381'>
integer j_end<a name='1382'>
integer j_endv<a name='1383'>
integer j_start<a name='1384'>
integer k<a name='1385'>
integer k_end<a name='1386'>
integer k_start<a name='1387'>
<a name='1388'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SMALL_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_101">("g_small_step_prep")<a name='1389'>
<a name='1390'>
<font color=#447700>!----------------------------------------------<a name='1391'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1392'></font>
<font color=#447700>!----------------------------------------------<a name='1393'></font>
i_start = its<a name='1394'>
i_end = ite<a name='1395'>
j_start = jts<a name='1396'>
j_end = jte<a name='1397'>
k_start = kts<a name='1398'>
k_end = min(kte,kde-1)<a name='1399'>
i_endu = i_end<a name='1400'>
j_endv = j_end<a name='1401'>
if (i_end .eq. ide) then<a name='1402'>
  i_end = i_end-1<a name='1403'>
endif<a name='1404'>
if (j_end .eq. jde) then<a name='1405'>
  j_end = j_end-1<a name='1406'>
endif<a name='1407'>
<a name='1408'>
<a name='1409'>
if (rk_step .eq. 1 .and. ( .not. leapfrog)) then<a name='1410'>
  do j = j_start, j_end<a name='1411'>
    do i = i_start, i_end<a name='1412'>
      g_mu_1(i,j) = g_mu_2(i,j)<a name='1413'>
      mu_1(i,j) = mu_2(i,j)<a name='1414'>
      g_ww_save(i,kde,j) = 0.<a name='1415'>
      ww_save(i,kde,j) = 0.<a name='1416'>
      g_ww_save(i,1,j) = 0.<a name='1417'>
      ww_save(i,1,j) = 0.<a name='1418'>
      g_mudf(i,j) = 0.<a name='1419'>
      mudf(i,j) = 0.<a name='1420'>
    end do<a name='1421'>
  end do<a name='1422'>
  do j = j_start, j_end<a name='1423'>
    do k = k_start, k_end<a name='1424'>
      do i = i_start, i_endu<a name='1425'>
        g_u_1(i,k,j) = g_u_2(i,k,j)<a name='1426'>
        u_1(i,k,j) = u_2(i,k,j)<a name='1427'>
      end do<a name='1428'>
    end do<a name='1429'>
  end do<a name='1430'>
  do j = j_start, j_endv<a name='1431'>
    do k = k_start, k_end<a name='1432'>
      do i = i_start, i_end<a name='1433'>
        g_v_1(i,k,j) = g_v_2(i,k,j)<a name='1434'>
        v_1(i,k,j) = v_2(i,k,j)<a name='1435'>
      end do<a name='1436'>
    end do<a name='1437'>
  end do<a name='1438'>
  do j = j_start, j_end<a name='1439'>
    do k = k_start, k_end<a name='1440'>
      do i = i_start, i_end<a name='1441'>
        g_t_1(i,k,j) = g_t_2(i,k,j)<a name='1442'>
        t_1(i,k,j) = t_2(i,k,j)<a name='1443'>
      end do<a name='1444'>
    end do<a name='1445'>
  end do<a name='1446'>
  do j = j_start, j_end<a name='1447'>
    do k = k_start, min(kde,kte)<a name='1448'>
      do i = i_start, i_end<a name='1449'>
        g_w_1(i,k,j) = g_w_2(i,k,j)<a name='1450'>
        w_1(i,k,j) = w_2(i,k,j)<a name='1451'>
        g_ph_1(i,k,j) = g_ph_2(i,k,j)<a name='1452'>
        ph_1(i,k,j) = ph_2(i,k,j)<a name='1453'>
      end do<a name='1454'>
    end do<a name='1455'>
  end do<a name='1456'>
  do j = j_start, j_end<a name='1457'>
    do i = i_start, i_end<a name='1458'>
      g_muts(i,j) = g_mu_2(i,j)<a name='1459'>
      muts(i,j) = mub(i,j)+mu_2(i,j)<a name='1460'>
    end do<a name='1461'>
    do i = i_start, i_endu<a name='1462'>
      g_muus(i,j) = g_muu(i,j)<a name='1463'>
      muus(i,j) = muu(i,j)<a name='1464'>
    end do<a name='1465'>
  end do<a name='1466'>
  do j = j_start, j_endv<a name='1467'>
    do i = i_start, i_end<a name='1468'>
      g_muvs(i,j) = g_muv(i,j)<a name='1469'>
      muvs(i,j) = muv(i,j)<a name='1470'>
    end do<a name='1471'>
  end do<a name='1472'>
  do j = j_start, j_end<a name='1473'>
    do i = i_start, i_end<a name='1474'>
      g_mu_save(i,j) = g_mu_2(i,j)<a name='1475'>
      mu_save(i,j) = mu_2(i,j)<a name='1476'>
      g_mu_2(i,j) = 0.<a name='1477'>
      mu_2(i,j) = mu_2(i,j)-mu_2(i,j)<a name='1478'>
    end do<a name='1479'>
  end do<a name='1480'>
else<a name='1481'>
  do j = j_start, j_end<a name='1482'>
    do i = i_start, i_end<a name='1483'>
      g_muts(i,j) = g_mu_1(i,j)<a name='1484'>
      muts(i,j) = mub(i,j)+mu_1(i,j)<a name='1485'>
    end do<a name='1486'>
    do i = i_start, i_endu<a name='1487'>
      g_muus(i,j) = 0.5*g_mu_1(i-1,j)+0.5*g_mu_1(i,j)<a name='1488'>
      muus(i,j) = 0.5*(mub(i,j)+mu_1(i,j)+mub(i-1,j)+mu_1(i-1,j))<a name='1489'>
    end do<a name='1490'>
  end do<a name='1491'>
  do j = j_start, j_endv<a name='1492'>
    do i = i_start, i_end<a name='1493'>
      g_muvs(i,j) = 0.5*g_mu_1(i,j-1)+0.5*g_mu_1(i,j)<a name='1494'>
      muvs(i,j) = 0.5*(mub(i,j)+mu_1(i,j)+mub(i,j-1)+mu_1(i,j-1))<a name='1495'>
    end do<a name='1496'>
  end do<a name='1497'>
  do j = j_start, j_end<a name='1498'>
    do i = i_start, i_end<a name='1499'>
      g_mu_save(i,j) = g_mu_2(i,j)<a name='1500'>
      mu_save(i,j) = mu_2(i,j)<a name='1501'>
      g_mu_2(i,j) = g_mu_1(i,j)-g_mu_2(i,j)<a name='1502'>
      mu_2(i,j) = mu_1(i,j)-mu_2(i,j)<a name='1503'>
    end do<a name='1504'>
  end do<a name='1505'>
endif<a name='1506'>
do j = j_start, j_end<a name='1507'>
  do i = i_start, i_end<a name='1508'>
    g_ww_save(i,kde,j) = 0.<a name='1509'>
    ww_save(i,kde,j) = 0.<a name='1510'>
    g_ww_save(i,1,j) = 0.<a name='1511'>
    ww_save(i,1,j) = 0.<a name='1512'>
  end do<a name='1513'>
end do<a name='1514'>
do j = j_start, j_end<a name='1515'>
  do k = k_start, k_end<a name='1516'>
    do i = i_start, i_end<a name='1517'>
      g_c2a(i,k,j) = (-(g_alt(i,k,j)*(cpovcv*(pb(i,k,j)+p(i,k,j))/(alt(i,k,j)*alt(i,k,j)))))+g_p(i,k,j)*(cpovcv/alt(i,k,j))<a name='1518'>
      c2a(i,k,j) = cpovcv*(pb(i,k,j)+p(i,k,j))/alt(i,k,j)<a name='1519'>
    end do<a name='1520'>
  end do<a name='1521'>
end do<a name='1522'>
do j = j_start, j_end<a name='1523'>
  do k = k_start, k_end<a name='1524'>
    do i = i_start, i_endu<a name='1525'>
      g_u_save(i,k,j) = g_u_2(i,k,j)<a name='1526'>
      u_save(i,k,j) = u_2(i,k,j)<a name='1527'>
      g_u_2(i,k,j) = (-(g_muu(i,j)*(u_2(i,k,j)/msfu(i,j))))+g_muus(i,j)*(u_1(i,k,j)/msfu(i,j))+g_u_1(i,k,j)*(muus(i,j)/msfu(i,j))-&amp;<a name='1528'>
&amp;g_u_2(i,k,j)*(muu(i,j)/msfu(i,j))<a name='1529'>
      u_2(i,k,j) = (muus(i,j)*u_1(i,k,j)-muu(i,j)*u_2(i,k,j))/msfu(i,j)<a name='1530'>
    end do<a name='1531'>
  end do<a name='1532'>
end do<a name='1533'>
do j = j_start, j_endv<a name='1534'>
  do k = k_start, k_end<a name='1535'>
    do i = i_start, i_end<a name='1536'>
      g_v_save(i,k,j) = g_v_2(i,k,j)<a name='1537'>
      v_save(i,k,j) = v_2(i,k,j)<a name='1538'>
      g_v_2(i,k,j) = (-(g_muv(i,j)*(v_2(i,k,j)/msfv(i,j))))+g_muvs(i,j)*(v_1(i,k,j)/msfv(i,j))+g_v_1(i,k,j)*(muvs(i,j)/msfv(i,j))-&amp;<a name='1539'>
&amp;g_v_2(i,k,j)*(muv(i,j)/msfv(i,j))<a name='1540'>
      v_2(i,k,j) = (muvs(i,j)*v_1(i,k,j)-muv(i,j)*v_2(i,k,j))/msfv(i,j)<a name='1541'>
    end do<a name='1542'>
  end do<a name='1543'>
end do<a name='1544'>
do j = j_start, j_end<a name='1545'>
  do k = k_start, k_end<a name='1546'>
    do i = i_start, i_end<a name='1547'>
      g_t_save(i,k,j) = g_t_2(i,k,j)<a name='1548'>
      t_save(i,k,j) = t_2(i,k,j)<a name='1549'>
      g_t_2(i,k,j) = (-(g_mut(i,j)*t_2(i,k,j)))+g_muts(i,j)*t_1(i,k,j)+g_t_1(i,k,j)*muts(i,j)-g_t_2(i,k,j)*mut(i,j)<a name='1550'>
      t_2(i,k,j) = muts(i,j)*t_1(i,k,j)-mut(i,j)*t_2(i,k,j)<a name='1551'>
    end do<a name='1552'>
  end do<a name='1553'>
end do<a name='1554'>
do j = j_start, j_end<a name='1555'>
  do k = k_start, kde<a name='1556'>
    do i = i_start, i_end<a name='1557'>
      g_w_save(i,k,j) = g_w_2(i,k,j)<a name='1558'>
      w_save(i,k,j) = w_2(i,k,j)<a name='1559'>
      g_w_2(i,k,j) = (-(g_mut(i,j)*(w_2(i,k,j)/msft(i,j))))+g_muts(i,j)*(w_1(i,k,j)/msft(i,j))+g_w_1(i,k,j)*(muts(i,j)/msft(i,j))-&amp;<a name='1560'>
&amp;g_w_2(i,k,j)*(mut(i,j)/msft(i,j))<a name='1561'>
      w_2(i,k,j) = (muts(i,j)*w_1(i,k,j)-mut(i,j)*w_2(i,k,j))/msft(i,j)<a name='1562'>
      g_ph_save(i,k,j) = g_ph_2(i,k,j)<a name='1563'>
      ph_save(i,k,j) = ph_2(i,k,j)<a name='1564'>
      g_ph_2(i,k,j) = g_ph_1(i,k,j)-g_ph_2(i,k,j)<a name='1565'>
      ph_2(i,k,j) = ph_1(i,k,j)-ph_2(i,k,j)<a name='1566'>
    end do<a name='1567'>
  end do<a name='1568'>
end do<a name='1569'>
do j = j_start, j_end<a name='1570'>
  do k = k_start, kde<a name='1571'>
    do i = i_start, i_end<a name='1572'>
      g_ww_save(i,k,j) = g_ww(i,k,j)<a name='1573'>
      ww_save(i,k,j) = ww(i,k,j)<a name='1574'>
    end do<a name='1575'>
  end do<a name='1576'>
end do<a name='1577'>
<a name='1578'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SMALL_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_101">("g_small_step_prep")<a name='1579'>
<a name='1580'>
end subroutine g_small_step_prep<a name='1581'>
<a name='1582'>
<a name='1583'>
<A NAME='G_SUMFLUX'><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SUMFLUX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1584'>
<font color=#993300>subroutine </font><font color=#cc0000>g_sumflux</font>( ru, g_ru, rv, g_rv, ww, g_ww, u_lin, g_u_lin, v_lin, g_v_lin, ww_lin, g_ww_lin, muu, g_muu, muv, g_muv, ru_m,&amp; <A href='../../call_to/G_SUMFLUX.html' TARGET='index'>3</A>,<A href='../../call_from/G_SUMFLUX.html' TARGET='index'>2</A><a name='1585'>
&amp; g_ru_m, rv_m, g_rv_m, ww_m, g_ww_m, msfu, msfv, iteration, number_of_small_timesteps, ide, jde, kde, ims, ime, jms, jme, kms, &amp;<a name='1586'>
&amp;kme, its, ite, jts, jte, kts, kte )<a name='1587'>
<font color=#447700>!******************************************************************<a name='1588'></font>
<font color=#447700>!******************************************************************<a name='1589'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1590'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1591'></font>
<font color=#447700>!******************************************************************<a name='1592'></font>
<font color=#447700>!******************************************************************<a name='1593'></font>
<font color=#447700>!==============================================<a name='1594'></font>
<font color=#447700>! all entries are defined explicitly<a name='1595'></font>
<font color=#447700>!==============================================<a name='1596'></font>
implicit none<a name='1597'>
<a name='1598'>
<font color=#447700>!==============================================<a name='1599'></font>
<font color=#447700>! declare arguments<a name='1600'></font>
<font color=#447700>!==============================================<a name='1601'></font>
integer, intent(in) :: ime<a name='1602'>
integer, intent(in) :: ims<a name='1603'>
integer, intent(in) :: jme<a name='1604'>
integer, intent(in) :: jms<a name='1605'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='1606'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='1607'>
integer, intent(in) :: kme<a name='1608'>
integer, intent(in) :: kms<a name='1609'>
real, intent(in) :: g_ru(ims:ime,kms:kme,jms:jme)<a name='1610'>
real, intent(inout) :: g_ru_m(ims:ime,kms:kme,jms:jme)<a name='1611'>
real, intent(in) :: g_rv(ims:ime,kms:kme,jms:jme)<a name='1612'>
real, intent(inout) :: g_rv_m(ims:ime,kms:kme,jms:jme)<a name='1613'>
real, intent(in) :: g_u_lin(ims:ime,kms:kme,jms:jme)<a name='1614'>
real, intent(in) :: g_v_lin(ims:ime,kms:kme,jms:jme)<a name='1615'>
real, intent(in) :: g_ww(ims:ime,kms:kme,jms:jme)<a name='1616'>
real, intent(in) :: g_ww_lin(ims:ime,kms:kme,jms:jme)<a name='1617'>
real, intent(inout) :: g_ww_m(ims:ime,kms:kme,jms:jme)<a name='1618'>
integer, intent(in) :: ide<a name='1619'>
integer, intent(in) :: ite<a name='1620'>
integer, intent(in) :: iteration<a name='1621'>
integer, intent(in) :: its<a name='1622'>
integer, intent(in) :: jde<a name='1623'>
integer, intent(in) :: jte<a name='1624'>
integer, intent(in) :: jts<a name='1625'>
integer, intent(in) :: kde<a name='1626'>
integer, intent(in) :: kte<a name='1627'>
integer, intent(in) :: kts<a name='1628'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='1629'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='1630'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='1631'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='1632'>
integer, intent(in) :: number_of_small_timesteps<a name='1633'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='1634'>
real, intent(inout) :: ru_m(ims:ime,kms:kme,jms:jme)<a name='1635'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='1636'>
real, intent(inout) :: rv_m(ims:ime,kms:kme,jms:jme)<a name='1637'>
real, intent(in) :: u_lin(ims:ime,kms:kme,jms:jme)<a name='1638'>
real, intent(in) :: v_lin(ims:ime,kms:kme,jms:jme)<a name='1639'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='1640'>
real, intent(in) :: ww_lin(ims:ime,kms:kme,jms:jme)<a name='1641'>
real, intent(inout) :: ww_m(ims:ime,kms:kme,jms:jme)<a name='1642'>
<a name='1643'>
<font color=#447700>!==============================================<a name='1644'></font>
<font color=#447700>! declare local variables<a name='1645'></font>
<font color=#447700>!==============================================<a name='1646'></font>
integer i<a name='1647'>
integer j<a name='1648'>
integer k<a name='1649'>
<a name='1650'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SUMFLUX' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_102">("g_sumflux")<a name='1651'>
<a name='1652'>
<font color=#447700>!----------------------------------------------<a name='1653'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1654'></font>
<font color=#447700>!----------------------------------------------<a name='1655'></font>
if (iteration .eq. 1) then<a name='1656'>
  do j = jts, jte<a name='1657'>
    do k = kts, kte<a name='1658'>
      do i = its, ite<a name='1659'>
        g_ru_m(i,k,j) = 0.<a name='1660'>
        ru_m(i,k,j) = 0.<a name='1661'>
        g_rv_m(i,k,j) = 0.<a name='1662'>
        rv_m(i,k,j) = 0.<a name='1663'>
        g_ww_m(i,k,j) = 0.<a name='1664'>
        ww_m(i,k,j) = 0.<a name='1665'>
      end do<a name='1666'>
    end do<a name='1667'>
  end do<a name='1668'>
endif<a name='1669'>
do j = jts, min(jde-1,jte)<a name='1670'>
  do k = kts, min(kde-1,kte)<a name='1671'>
    do i = its, ite<a name='1672'>
      g_ru_m(i,k,j) = g_ru(i,k,j)+g_ru_m(i,k,j)<a name='1673'>
      ru_m(i,k,j) = ru_m(i,k,j)+ru(i,k,j)<a name='1674'>
    end do<a name='1675'>
  end do<a name='1676'>
end do<a name='1677'>
do j = jts, jte<a name='1678'>
  do k = kts, min(kde-1,kte)<a name='1679'>
    do i = its, min(ide-1,ite)<a name='1680'>
      g_rv_m(i,k,j) = g_rv(i,k,j)+g_rv_m(i,k,j)<a name='1681'>
      rv_m(i,k,j) = rv_m(i,k,j)+rv(i,k,j)<a name='1682'>
    end do<a name='1683'>
  end do<a name='1684'>
end do<a name='1685'>
do j = jts, min(jde-1,jte)<a name='1686'>
  do k = kts, kte<a name='1687'>
    do i = its, min(ide-1,ite)<a name='1688'>
      g_ww_m(i,k,j) = g_ww(i,k,j)+g_ww_m(i,k,j)<a name='1689'>
      ww_m(i,k,j) = ww_m(i,k,j)+ww(i,k,j)<a name='1690'>
    end do<a name='1691'>
  end do<a name='1692'>
end do<a name='1693'>
if (iteration .eq. number_of_small_timesteps) then<a name='1694'>
  do j = jts, min(jde-1,jte)<a name='1695'>
    do k = kts, min(kde-1,kte)<a name='1696'>
      do i = its, ite<a name='1697'>
        g_ru_m(i,k,j) = g_muu(i,j)*(u_lin(i,k,j)/msfu(i,j))+g_ru_m(i,k,j)/float(number_of_small_timesteps)+g_u_lin(i,k,j)*(muu(i,j)&amp;<a name='1698'>
&amp;/msfu(i,j))<a name='1699'>
        ru_m(i,k,j) = ru_m(i,k,j)/number_of_small_timesteps+muu(i,j)*u_lin(i,k,j)/msfu(i,j)<a name='1700'>
      end do<a name='1701'>
    end do<a name='1702'>
  end do<a name='1703'>
  do j = jts, jte<a name='1704'>
    do k = kts, min(kde-1,kte)<a name='1705'>
      do i = its, min(ide-1,ite)<a name='1706'>
        g_rv_m(i,k,j) = g_muv(i,j)*(v_lin(i,k,j)/msfv(i,j))+g_rv_m(i,k,j)/float(number_of_small_timesteps)+g_v_lin(i,k,j)*(muv(i,j)&amp;<a name='1707'>
&amp;/msfv(i,j))<a name='1708'>
        rv_m(i,k,j) = rv_m(i,k,j)/number_of_small_timesteps+muv(i,j)*v_lin(i,k,j)/msfv(i,j)<a name='1709'>
      end do<a name='1710'>
    end do<a name='1711'>
  end do<a name='1712'>
  do j = jts, min(jde-1,jte)<a name='1713'>
    do k = kts, kte<a name='1714'>
      do i = its, min(ide-1,ite)<a name='1715'>
        g_ww_m(i,k,j) = g_ww_lin(i,k,j)+g_ww_m(i,k,j)/float(number_of_small_timesteps)<a name='1716'>
        ww_m(i,k,j) = ww_m(i,k,j)/number_of_small_timesteps+ww_lin(i,k,j)<a name='1717'>
      end do<a name='1718'>
    end do<a name='1719'>
  end do<a name='1720'>
endif<a name='1721'>
<a name='1722'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SUMFLUX' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_102">("g_sumflux")<a name='1723'>
<a name='1724'>
end subroutine g_sumflux<a name='1725'>
<a name='1726'>
<a name='1727'>
end module     g_module_small_step_em<a name='1728'>
<a name='1729'>
<a name='1730'>
</pre></body></html>