<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!IDEAL:MODEL_LAYER:INITIALIZATION<a name='2'></font>
<a name='3'>
<font color=#447700>!  This MODULE holds the routines which are used to perform various initializations<a name='4'></font>
<font color=#447700>!  for the individual domains.  <a name='5'></font>
<a name='6'>
<font color=#447700>!-----------------------------------------------------------------------<a name='7'></font>
<a name='8'>
<A NAME='MODULE_INITIALIZE'><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#MODULE_INITIALIZE' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='9'>
<font color=#993300>MODULE </font><font color=#cc0000>module_initialize</font> <A href='../../call_to/MODULE_INITIALIZE.html' TARGET='index'>7</A><a name='10'>
<a name='11'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#module_initialize_b_wave.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_6"><a name='12'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#module_initialize_b_wave.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_1"><a name='13'>
   USE module_state_description<a name='14'>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#module_initialize_b_wave.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_13"><a name='15'>
   USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#module_initialize_b_wave.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_13"><a name='16'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#module_initialize_b_wave.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_1"><a name='17'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#module_initialize_b_wave.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_14"><a name='18'>
   USE <A href='../../html_code/dyn_em/module_init_utilities.F.html#MODULE_INIT_UTILITIES'>module_init_utilities</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#module_initialize_b_wave.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_INIT_UTILITIES_1"><a name='19'>
#ifdef DM_PARALLEL<a name='20'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#module_initialize_b_wave.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_4"><a name='21'>
#endif<a name='22'>
<a name='23'>
<a name='24'>
CONTAINS<a name='25'>
<a name='26'>
<a name='27'>
<font color=#447700>!-------------------------------------------------------------------<a name='28'></font>
<font color=#447700>! this is a wrapper for the solver-specific init_domain routines.<a name='29'></font>
<font color=#447700>! Also dereferences the grid variables and passes them down as arguments.<a name='30'></font>
<font color=#447700>! This is crucial, since the lower level routines may do message passing<a name='31'></font>
<font color=#447700>! and this will get fouled up on machines that insist on passing down<a name='32'></font>
<font color=#447700>! copies of assumed-shape arrays (by passing down as arguments, the <a name='33'></font>
<font color=#447700>! data are treated as assumed-size -- ie. f77 -- arrays and the copying<a name='34'></font>
<font color=#447700>! business is avoided).  Fie on the F90 designers.  Fie and a pox.<a name='35'></font>
<a name='36'>
<A NAME='INIT_DOMAIN'><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#INIT_DOMAIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='37'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_domain</font> ( grid ) <A href='../../call_to/INIT_DOMAIN.html' TARGET='index'>3</A>,<A href='../../call_from/INIT_DOMAIN.html' TARGET='index'>24</A><a name='38'>
<a name='39'>
   IMPLICIT NONE<a name='40'>
<a name='41'>
   <font color=#447700>!  Input data.<a name='42'></font>
   TYPE (domain), POINTER :: grid <a name='43'>
   <font color=#447700>!  Local data.<a name='44'></font>
   INTEGER                :: dyn_opt <a name='45'>
   INTEGER :: idum1, idum2<a name='46'>
<a name='47'>
#ifdef DEREF_KLUDGE<a name='48'>
<font color=#447700>!  see http://www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='49'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='50'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='51'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='52'>
#endif<a name='53'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_1"><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='54'>
<a name='55'>
   CALL nl_get_dyn_opt( 1, dyn_opt )<a name='56'>
   <a name='57'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG'>set_scalar_indices_from_config</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_SCALAR_INDICES_FROM_CONFIG_1"> ( head_grid%id , idum1, idum2 )<a name='58'>
<a name='59'>
   IF (      dyn_opt .eq. 1 &amp;<a name='60'>
        .or. dyn_opt .eq. 2 &amp;<a name='61'>
        .or. dyn_opt .eq. 3 &amp;<a name='62'>
                                       ) THEN<a name='63'>
     CALL <A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK'>init_domain_rk</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_DOMAIN_RK_1">( grid, &amp;<a name='64'>
<font color=#447700>!<a name='65'></font>
#include &lt;<A href='../../html_code/include/em_actual_args.inc.html'>em_actual_args.inc</A>&gt;<A NAME="em_actual_args.inc_2"><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='66'>
<font color=#447700>!<a name='67'></font>
                        )<a name='68'>
<a name='69'>
   ELSE<a name='70'>
     WRITE(0,*)' init_domain: unknown or unimplemented dyn_opt = ',dyn_opt<a name='71'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_17"> ( ' init_domain: unknown or unimplemented dyn_opt ' )<a name='72'>
   ENDIF<a name='73'>
<a name='74'>
   END SUBROUTINE init_domain<a name='75'>
<a name='76'>
<font color=#447700>!-------------------------------------------------------------------<a name='77'></font>
<a name='78'>
<A NAME='INIT_DOMAIN_RK'><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#INIT_DOMAIN_RK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='79'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_domain_rk</font> ( grid, &amp; <A href='../../call_to/INIT_DOMAIN_RK.html' TARGET='index'>7</A>,<A href='../../call_from/INIT_DOMAIN_RK.html' TARGET='index'>128</A><a name='80'>
<font color=#447700>!<a name='81'></font>
# include &lt;<A href='../../html_code/include/em_dummy_args.inc.html'>em_dummy_args.inc</A>&gt;<A NAME="em_dummy_args.inc_3"><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='82'>
<font color=#447700>!<a name='83'></font>
)<a name='84'>
   IMPLICIT NONE<a name='85'>
<a name='86'>
   <font color=#447700>!  Input data.<a name='87'></font>
   TYPE (domain), POINTER :: grid<a name='88'>
<a name='89'>
# include &lt;<A href='../../html_code/include/em_dummy_decl.inc.html'>em_dummy_decl.inc</A>&gt;<A NAME="em_dummy_decl.inc_4"><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='90'>
<a name='91'>
   TYPE (grid_config_rec_type)              :: config_flags<a name='92'>
<a name='93'>
   <font color=#447700>!  Local data<a name='94'></font>
   INTEGER                             ::                       &amp;<a name='95'>
                                  ids, ide, jds, jde, kds, kde, &amp;<a name='96'>
                                  ims, ime, jms, jme, kms, kme, &amp;<a name='97'>
                                  its, ite, jts, jte, kts, kte, &amp;<a name='98'>
                                  i, j, k<a name='99'>
<a name='100'>
   <font color=#447700>! Local data<a name='101'></font>
<a name='102'>
   INTEGER, PARAMETER :: nl_max = 1000<a name='103'>
   REAL, DIMENSION(nl_max) :: zk, p_in, theta, rho, u, v, qv, pd_in<a name='104'>
   INTEGER :: nl_in<a name='105'>
<a name='106'>
   INTEGER :: icm,jcm, ii, im1, jj, jm1, loop, error, fid, nxc, nyc<a name='107'>
   REAL    :: u_mean,v_mean, f0, p_surf, p_level, qvf, z_at_v, z_at_u<a name='108'>
   REAL    :: z_scale, xrad, yrad, zrad, rad, delt, cof1, cof2<a name='109'>
<font color=#447700>!   REAL, EXTERNAL :: interp_0<a name='110'></font>
   REAL    :: hm<a name='111'>
   REAL    :: pi<a name='112'>
<a name='113'>
<font color=#447700>!  stuff from original initialization that has been dropped from the Registry <a name='114'></font>
   REAL    :: vnu, xnu, xnus, dinit0, cbh, p0_temp, t0_temp, zd, zt<a name='115'>
   REAL    :: qvf1, qvf2, pd_surf<a name='116'>
   INTEGER :: it<a name='117'>
<a name='118'>
   LOGICAL :: moisture_init<a name='119'>
   LOGICAL :: stretch_grid, dry_sounding, debug<a name='120'>
<a name='121'>
<font color=#447700>!  kludge space for initial jet<a name='122'></font>
<a name='123'>
   INTEGER, parameter :: nz_jet=64, ny_jet=80<a name='124'>
   REAL, DIMENSION(nz_jet, ny_jet) :: u_jet, rho_jet, th_jet, z_jet<a name='125'>
<a name='126'>
<font color=#447700>!  perturbation parameters<a name='127'></font>
<a name='128'>
   REAL, PARAMETER :: htbub=8000., radbub=2000000., radz=8000., tpbub=1.0<a name='129'>
   REAL :: piov2, tp<a name='130'>
   INTEGER :: icen, jcen<a name='131'>
   real :: thtmp, ptmp, temp(3)<a name='132'>
#ifdef DEREF_KLUDGE<a name='133'>
<font color=#447700>!  see http://www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='134'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='135'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='136'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='137'>
#endif<a name='138'>
<a name='139'>
#define COPY_IN<a name='140'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_5"><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='141'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_6"><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='142'>
#ifdef DM_PARALLEL<a name='143'>
#    include &lt;<A href='../../html_code/include/em_data_calls.inc.html'>em_data_calls.inc</A>&gt;<A NAME="em_data_calls.inc_7"><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='144'>
#endif<a name='145'>
<a name='146'>
   SELECT CASE ( model_data_order )<a name='147'>
         CASE ( DATA_ORDER_ZXY )<a name='148'>
   kds = grid%sd31 ; kde = grid%ed31 ;<a name='149'>
   ids = grid%sd32 ; ide = grid%ed32 ;<a name='150'>
   jds = grid%sd33 ; jde = grid%ed33 ;<a name='151'>
<a name='152'>
   kms = grid%sm31 ; kme = grid%em31 ;<a name='153'>
   ims = grid%sm32 ; ime = grid%em32 ;<a name='154'>
   jms = grid%sm33 ; jme = grid%em33 ;<a name='155'>
<a name='156'>
   kts = grid%sp31 ; kte = grid%ep31 ;   <font color=#447700>! note that tile is entire patch<a name='157'></font>
   its = grid%sp32 ; ite = grid%ep32 ;   <font color=#447700>! note that tile is entire patch<a name='158'></font>
   jts = grid%sp33 ; jte = grid%ep33 ;   <font color=#447700>! note that tile is entire patch<a name='159'></font>
         CASE ( DATA_ORDER_XYZ )<a name='160'>
   ids = grid%sd31 ; ide = grid%ed31 ;<a name='161'>
   jds = grid%sd32 ; jde = grid%ed32 ;<a name='162'>
   kds = grid%sd33 ; kde = grid%ed33 ;<a name='163'>
<a name='164'>
   ims = grid%sm31 ; ime = grid%em31 ;<a name='165'>
   jms = grid%sm32 ; jme = grid%em32 ;<a name='166'>
   kms = grid%sm33 ; kme = grid%em33 ;<a name='167'>
<a name='168'>
   its = grid%sp31 ; ite = grid%ep31 ;   <font color=#447700>! note that tile is entire patch<a name='169'></font>
   jts = grid%sp32 ; jte = grid%ep32 ;   <font color=#447700>! note that tile is entire patch<a name='170'></font>
   kts = grid%sp33 ; kte = grid%ep33 ;   <font color=#447700>! note that tile is entire patch<a name='171'></font>
         CASE ( DATA_ORDER_XZY )<a name='172'>
   ids = grid%sd31 ; ide = grid%ed31 ;<a name='173'>
   kds = grid%sd32 ; kde = grid%ed32 ;<a name='174'>
   jds = grid%sd33 ; jde = grid%ed33 ;<a name='175'>
<a name='176'>
   ims = grid%sm31 ; ime = grid%em31 ;<a name='177'>
   kms = grid%sm32 ; kme = grid%em32 ;<a name='178'>
   jms = grid%sm33 ; jme = grid%em33 ;<a name='179'>
<a name='180'>
   its = grid%sp31 ; ite = grid%ep31 ;   <font color=#447700>! note that tile is entire patch<a name='181'></font>
   kts = grid%sp32 ; kte = grid%ep32 ;   <font color=#447700>! note that tile is entire patch<a name='182'></font>
   jts = grid%sp33 ; jte = grid%ep33 ;   <font color=#447700>! note that tile is entire patch<a name='183'></font>
<a name='184'>
   END SELECT<a name='185'>
<a name='186'>
   piov2 = 2.*atan(1.0)<a name='187'>
   icen = ide/4<a name='188'>
   jcen = jde/2<a name='189'>
<a name='190'>
   stretch_grid = .true.<a name='191'>
   delt = 0.<a name='192'>
   z_scale = .50<a name='193'>
   pi = 2.*asin(1.0)<a name='194'>
   write(6,*) ' pi is ',pi<a name='195'>
   nxc = (ide-ids)/4<a name='196'>
   nyc = (jde-jds)/2<a name='197'>
<a name='198'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_1"> ( grid%id , model_config_rec , config_flags )<a name='199'>
<a name='200'>
<font color=#447700>! here we check to see if the boundary conditions are set properly<a name='201'></font>
<a name='202'>
   CALL <A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK'>boundary_condition_check</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BOUNDARY_CONDITION_CHECK_1">( config_flags, bdyzone, error, grid%id )<a name='203'>
<a name='204'>
   moisture_init = .true.<a name='205'>
<a name='206'>
    grid%itimestep=0<a name='207'>
<a name='208'>
#ifdef DM_PARALLEL<a name='209'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_1">( icm , IWORDSIZE )<a name='210'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_2">( jcm , IWORDSIZE )<a name='211'>
#endif<a name='212'>
<a name='213'>
    CALL <A href='../../html_code/frame/module_configure.F.html#NL_SET_MMINLU'>nl_set_mminlu</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NL_SET_MMINLU_1">(1,'    ')<a name='214'>
    CALL nl_set_iswater(1,0)<a name='215'>
    CALL nl_set_cen_lat(1,40.)<a name='216'>
    CALL nl_set_cen_lon(1,-105.)<a name='217'>
    CALL nl_set_truelat1(1,0.)<a name='218'>
    CALL nl_set_truelat2(1,0.)<a name='219'>
    CALL nl_set_moad_cen_lat (1,0.)<a name='220'>
    CALL nl_set_stand_lon (1,0.)<a name='221'>
    CALL nl_set_map_proj(1,0)<a name='222'>
<a name='223'>
<a name='224'>
<font color=#447700>!  here we initialize data we currently is not initialized <a name='225'></font>
<font color=#447700>!  in the input data<a name='226'></font>
<a name='227'>
    DO j = jts, jte<a name='228'>
      DO i = its, ite<a name='229'>
<a name='230'>
         ht(i,j)       = 0.<a name='231'>
         msft(i,j)     = 1.<a name='232'>
         msfu(i,j)     = 1.<a name='233'>
         msfv(i,j)     = 1.<a name='234'>
         sina(i,j)     = 0.<a name='235'>
         cosa(i,j)     = 1.<a name='236'>
         e(i,j)        = 0.<a name='237'>
         f(i,j)        = 1.e-04<a name='238'>
<a name='239'>
      END DO<a name='240'>
   END DO<a name='241'>
<a name='242'>
    DO j = jts, jte<a name='243'>
    DO k = kts, kte<a name='244'>
      DO i = its, ite<a name='245'>
         ww(i,k,j)     = 0.<a name='246'>
      END DO<a name='247'>
   END DO<a name='248'>
   END DO<a name='249'>
<a name='250'>
   step_number = 0<a name='251'>
<a name='252'>
<font color=#447700>! set up the grid<a name='253'></font>
<a name='254'>
   IF (stretch_grid) THEN <font color=#447700>! exponential stretch for eta (nearly constant dz)<a name='255'></font>
     DO k=1, kde<a name='256'>
      znw(k) = (exp(-(k-1)/float(kde-1)/z_scale) - exp(-1./z_scale))/ &amp;<a name='257'>
                                (1.-exp(-1./z_scale))<a name='258'>
     ENDDO<a name='259'>
   ELSE<a name='260'>
     DO k=1, kde<a name='261'>
      znw(k) = 1. - float(k-1)/float(kde-1)<a name='262'>
     ENDDO<a name='263'>
   ENDIF<a name='264'>
<a name='265'>
   DO k=1, kde-1<a name='266'>
    dnw(k) = znw(k+1) - znw(k)<a name='267'>
    rdnw(k) = 1./dnw(k)<a name='268'>
    znu(k) = 0.5*(znw(k+1)+znw(k))<a name='269'>
   ENDDO<a name='270'>
   DO k=2, kde-1<a name='271'>
    dn(k) = 0.5*(dnw(k)+dnw(k-1))<a name='272'>
    rdn(k) = 1./dn(k)<a name='273'>
    fnp(k) = .5* dnw(k  )/dn(k)<a name='274'>
    fnm(k) = .5* dnw(k-1)/dn(k)<a name='275'>
   ENDDO<a name='276'>
<a name='277'>
   cof1 = (2.*dn(2)+dn(3))/(dn(2)+dn(3))*dnw(1)/dn(2) <a name='278'>
   cof2 =     dn(2)        /(dn(2)+dn(3))*dnw(1)/dn(3) <a name='279'>
   cf1  = fnp(2) + cof1<a name='280'>
   cf2  = fnm(2) - cof1 - cof2<a name='281'>
   cf3  = cof2       <a name='282'>
<a name='283'>
   cfn  = (.5*dnw(kde-1)+dn(kde-1))/dn(kde-1)<a name='284'>
   cfn1 = -.5*dnw(kde-1)/dn(kde-1)<a name='285'>
   rdx = 1./dx<a name='286'>
   rdy = 1./dy<a name='287'>
<a name='288'>
<font color=#447700>!  get the sounding from the ascii sounding file, first get dry sounding and <a name='289'></font>
<font color=#447700>!  calculate base state<a name='290'></font>
<a name='291'>
  write(6,*) ' reading input jet sounding '<a name='292'>
  call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#READ_INPUT_JET'>read_input_jet</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="READ_INPUT_JET_1">( u_jet, rho_jet, th_jet, z_jet, nz_jet, ny_jet )<a name='293'>
<a name='294'>
  write(6,*) ' getting dry sounding for base state '<a name='295'>
  write(6,*) ' using middle column in jet sounding, j = ',ny_jet/2<a name='296'>
  dry_sounding = .true.<a name='297'>
<a name='298'>
  dry_sounding   = .true.<a name='299'>
  debug = .true.  <font color=#447700>!  this will produce print of the sounding<a name='300'></font>
  CALL <A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#GET_SOUNDING'>get_sounding</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_SOUNDING_1">( zk, p_in, pd_in, theta, rho, u, v, qv, dry_sounding, &amp;<a name='301'>
                      nl_max, nl_in, u_jet, rho_jet, th_jet, z_jet,      &amp;<a name='302'>
                      nz_jet, ny_jet, ny_jet/2, debug                   )<a name='303'>
<a name='304'>
  write(6,*) ' returned from reading sounding, nl_in is ',nl_in<a name='305'>
<a name='306'>
<font color=#447700>!  find ptop for the desired ztop (ztop is input from the namelist),<a name='307'></font>
<font color=#447700>!  and find surface pressure<a name='308'></font>
<a name='309'>
<font color=#447700>!  For the jet, using the middle column for the base state means that<a name='310'></font>
<font color=#447700>!  we will be extrapolating above the highest height data to the south<a name='311'></font>
<font color=#447700>!  of the centerline.<a name='312'></font>
<a name='313'>
  p_top = <A href='../../html_code/dyn_em/module_init_utilities.F.html#INTERP_0'>interp_0</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERP_0_1">( p_in, zk, ztop, nl_in )<a name='314'>
<a name='315'>
  DO j=jts,jte<a name='316'>
  DO i=its,ite  <font color=#447700>! flat surface<a name='317'></font>
    phb(i,1,j) = 0.<a name='318'>
    php(i,1,j) = 0.<a name='319'>
    ph0(i,1,j) = 0.<a name='320'>
    ht(i,j) = 0.<a name='321'>
  ENDDO<a name='322'>
  ENDDO<a name='323'>
<a name='324'>
  DO J = jts, jte<a name='325'>
  DO I = its, ite<a name='326'>
<a name='327'>
    p_surf = <A href='../../html_code/dyn_em/module_init_utilities.F.html#INTERP_0'>interp_0</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERP_0_2">( p_in, zk, phb(i,1,j)/g, nl_in )<a name='328'>
    mub(i,j) = p_surf-p_top<a name='329'>
<a name='330'>
<font color=#447700>!  this is dry hydrostatic sounding (base state), so given p (coordinate),<a name='331'></font>
<font color=#447700>!  interp theta (from interp) and compute 1/rho from eqn. of state<a name='332'></font>
<a name='333'>
    DO K = 1, kte-1<a name='334'>
      p_level = znu(k)*(p_surf - p_top) + p_top<a name='335'>
      pb(i,k,j) = p_level<a name='336'>
      t_init(i,k,j) = <A href='../../html_code/dyn_em/module_init_utilities.F.html#INTERP_0'>interp_0</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERP_0_3">( theta, p_in, p_level, nl_in ) - t0<a name='337'>
      alb(i,k,j) = (r_d/p1000mb)*(t_init(i,k,j)+t0)*(pb(i,k,j)/p1000mb)**cvpm<a name='338'>
    ENDDO<a name='339'>
<a name='340'>
<font color=#447700>!  calc hydrostatic balance (alternatively we could interp the geopotential from the<a name='341'></font>
<font color=#447700>!  sounding, but this assures that the base state is in exact hydrostatic balance with<a name='342'></font>
<font color=#447700>!  respect to the model eqns.<a name='343'></font>
<a name='344'>
    DO k  = 2,kte<a name='345'>
      phb(i,k,j) = phb(i,k-1,j) - dnw(k-1)*mub(i,j)*alb(i,k-1,j)<a name='346'>
    ENDDO<a name='347'>
<a name='348'>
  ENDDO<a name='349'>
  ENDDO<a name='350'>
<a name='351'>
  write(6,*) ' ptop is ',p_top<a name='352'>
  write(6,*) ' base state mub(1,1), p_surf is ',mub(1,1),mub(1,1)+p_top<a name='353'>
<a name='354'>
<font color=#447700>!  calculate full state for each column - this includes moisture.<a name='355'></font>
<a name='356'>
  write(6,*) ' getting moist sounding for full state '<a name='357'>
<a name='358'>
  dry_sounding = .true.<a name='359'>
  IF (config_flags%mp_physics /= 0)  dry_sounding = .false.<a name='360'>
<a name='361'>
  DO J = jts, min(jde-1,jte)<a name='362'>
<a name='363'>
<font color=#447700>!  get sounding for this point<a name='364'></font>
<a name='365'>
  debug = .false.  <font color=#447700>!  this will turn off print of the sounding<a name='366'></font>
  CALL <A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#GET_SOUNDING'>get_sounding</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_SOUNDING_2">( zk, p_in, pd_in, theta, rho, u, v, qv, dry_sounding, &amp;<a name='367'>
                      nl_max, nl_in, u_jet, rho_jet, th_jet, z_jet,      &amp;<a name='368'>
                      nz_jet, ny_jet, j, debug                          )<a name='369'>
<a name='370'>
  DO I = its, min(ide-1,ite)<a name='371'>
<a name='372'>
<font color=#447700>!   we could just do the first point in "i" and copy from there, but we'll<a name='373'></font>
<font color=#447700>!   be lazy and do all the points as if they are all, independent<a name='374'></font>
<a name='375'>
<font color=#447700>!   At this point p_top is already set. find the DRY mass in the column <a name='376'></font>
<font color=#447700>!   by interpolating the DRY pressure.  <a name='377'></font>
<a name='378'>
    pd_surf = <A href='../../html_code/dyn_em/module_init_utilities.F.html#INTERP_0'>interp_0</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERP_0_4">( pd_in, zk, phb(i,1,j)/g, nl_in )<a name='379'>
<a name='380'>
<font color=#447700>!   compute the perturbation mass and the full mass<a name='381'></font>
<a name='382'>
    mu_1(i,j) = pd_surf-p_top - mub(i,j)<a name='383'>
    mu_2(i,j) = mu_1(i,j)<a name='384'>
    mu0(i,j) = mu_1(i,j) + mub(i,j)<a name='385'>
<a name='386'>
<font color=#447700>!   given the dry pressure and coordinate system, interp the potential<a name='387'></font>
<font color=#447700>!   temperature and qv<a name='388'></font>
<a name='389'>
    do k=1,kde-1<a name='390'>
<a name='391'>
      p_level = znu(k)*(pd_surf - p_top) + p_top<a name='392'>
<a name='393'>
      moist_1(i,k,j,P_QV) = <A href='../../html_code/dyn_em/module_init_utilities.F.html#INTERP_0'>interp_0</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERP_0_5">( qv, pd_in, p_level, nl_in )<a name='394'>
      moist_2(i,k,j,P_QV) = moist_1(i,k,j,P_QV)<a name='395'>
      t_1(i,k,j)          = <A href='../../html_code/dyn_em/module_init_utilities.F.html#INTERP_0'>interp_0</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERP_0_6">( theta, pd_in, p_level, nl_in ) - t0<a name='396'>
      t_2(i,k,j)          = t_1(i,k,j)<a name='397'>
      <a name='398'>
<a name='399'>
    enddo<a name='400'>
<a name='401'>
<font color=#447700>!   integrate the hydrostatic equation (from the RHS of the bigstep<a name='402'></font>
<font color=#447700>!   vertical momentum equation) down from the top to get p.<a name='403'></font>
<font color=#447700>!   first from the top of the model to the top pressure<a name='404'></font>
<a name='405'>
    k = kte-1  <font color=#447700>! top level<a name='406'></font>
<a name='407'>
    qvf1 = 0.5*(moist_1(i,k,j,P_QV)+moist_1(i,k,j,P_QV))<a name='408'>
    qvf2 = 1./(1.+qvf1)<a name='409'>
    qvf1 = qvf1*qvf2<a name='410'>
<a name='411'>
<font color=#447700>!    p(i,k,j) = - 0.5*mu_1(i,j)/rdnw(k)<a name='412'></font>
    p(i,k,j) = - 0.5*(mu_1(i,j)+qvf1*mub(i,j))/rdnw(k)/qvf2<a name='413'>
    qvf = 1. + rvovrd*moist_1(i,k,j,P_QV)<a name='414'>
    alt(i,k,j) = (r_d/p1000mb)*(t_1(i,k,j)+t0)*qvf* &amp;<a name='415'>
                (((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm)<a name='416'>
    al(i,k,j) = alt(i,k,j) - alb(i,k,j)<a name='417'>
<a name='418'>
<font color=#447700>!  down the column<a name='419'></font>
<a name='420'>
    do k=kte-2,1,-1<a name='421'>
      qvf1 = 0.5*(moist_1(i,k,j,P_QV)+moist_1(i,k+1,j,P_QV))<a name='422'>
      qvf2 = 1./(1.+qvf1)<a name='423'>
      qvf1 = qvf1*qvf2<a name='424'>
      p(i,k,j) = p(i,k+1,j) - (mu_1(i,j) + qvf1*mub(i,j))/qvf2/rdn(k+1)<a name='425'>
      qvf = 1. + rvovrd*moist_1(i,k,j,P_QV)<a name='426'>
      alt(i,k,j) = (r_d/p1000mb)*(t_1(i,k,j)+t0)*qvf* &amp;<a name='427'>
                  (((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm)<a name='428'>
      al(i,k,j) = alt(i,k,j) - alb(i,k,j)<a name='429'>
    enddo<a name='430'>
<a name='431'>
<font color=#447700>!  this is the hydrostatic equation used in the model after the<a name='432'></font>
<font color=#447700>!  small timesteps.  In the model, al (inverse density)<a name='433'></font>
<font color=#447700>!  is computed from the geopotential.<a name='434'></font>
<a name='435'>
<a name='436'>
    ph_1(i,1,j) = 0.<a name='437'>
    DO k  = 2,kte<a name='438'>
      ph_1(i,k,j) = ph_1(i,k-1,j) - (1./rdnw(k-1))*(       &amp;<a name='439'>
                   (mub(i,j)+mu_1(i,j))*al(i,k-1,j)+ &amp;<a name='440'>
                    mu_1(i,j)*alb(i,k-1,j)  )<a name='441'>
                                                   <a name='442'>
      ph_2(i,k,j) = ph_1(i,k,j) <a name='443'>
      ph0(i,k,j) = ph_1(i,k,j) + phb(i,k,j)<a name='444'>
    ENDDO<a name='445'>
<a name='446'>
<font color=#447700>! interp u<a name='447'></font>
<a name='448'>
    DO K = 1, kte<a name='449'>
      p_level = znu(k)*(p_surf - p_top) + p_top<a name='450'>
      u_1(i,k,j) = <A href='../../html_code/dyn_em/module_init_utilities.F.html#INTERP_0'>interp_0</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERP_0_7">( u, p_in, p_level, nl_in )<a name='451'>
      u_2(i,k,j) = u_1(i,k,j)<a name='452'>
    ENDDO<a name='453'>
<a name='454'>
  ENDDO<a name='455'>
  ENDDO<a name='456'>
<a name='457'>
<font color=#447700>!  thermal perturbation to kick off convection<a name='458'></font>
<a name='459'>
  write(6,*) ' nxc, nyc for perturbation ',nxc,nyc<a name='460'>
  write(6,*) ' delt for perturbation ',tpbub<a name='461'>
<a name='462'>
  DO J = jts, min(jde-1,jte)<a name='463'>
    yrad = dy*float(j-jde/2-1)/radbub<a name='464'>
    DO I = its, min(ide-1,ite)<a name='465'>
      xrad = float(i-1)/float(ide-ids)<a name='466'>
<a name='467'>
      DO K = 1, kte-1<a name='468'>
<a name='469'>
<font color=#447700>!  put in preturbation theta (bubble) and recalc density.  note,<a name='470'></font>
<font color=#447700>!  the mass in the column is not changing, so when theta changes,<a name='471'></font>
<font color=#447700>!  we recompute density and geopotential<a name='472'></font>
<a name='473'>
        zrad = 0.5*(ph_1(i,k,j)+ph_1(i,k+1,j)  &amp;<a name='474'>
                   +phb(i,k,j)+phb(i,k+1,j))/g<a name='475'>
        zrad = (zrad-htbub)/radz<a name='476'>
        RAD=SQRT(yrad*yrad+zrad*zrad)<a name='477'>
        IF(RAD &lt;= 1.) THEN<a name='478'>
           tp = tpbub*cos(rad*piov2)*cos(rad*piov2)*cos(xrad*2*pi+pi)<a name='479'>
           T_1(i,k,j)=T_1(i,k,j)+tp<a name='480'>
           T_2(i,k,j)=T_1(i,k,j)<a name='481'>
           qvf = 1. + rvovrd*moist_1(i,k,j,P_QV)<a name='482'>
           alt(i,k,j) = (r_d/p1000mb)*(t_1(i,k,j)+t0)*qvf* &amp;<a name='483'>
                        (((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm)<a name='484'>
           al(i,k,j) = alt(i,k,j) - alb(i,k,j)<a name='485'>
        ENDIF<a name='486'>
      ENDDO<a name='487'>
<a name='488'>
<font color=#447700>!  rebalance hydrostatically<a name='489'></font>
<a name='490'>
      DO k  = 2,kte<a name='491'>
        ph_1(i,k,j) = ph_1(i,k-1,j) - (1./rdnw(k-1))*(       &amp;<a name='492'>
                     (mub(i,j)+mu_1(i,j))*al(i,k-1,j)+ &amp;<a name='493'>
                      mu_1(i,j)*alb(i,k-1,j)  )<a name='494'>
                                                   <a name='495'>
        ph_2(i,k,j) = ph_1(i,k,j) <a name='496'>
        ph0(i,k,j) = ph_1(i,k,j) + phb(i,k,j)<a name='497'>
      ENDDO<a name='498'>
<a name='499'>
    ENDDO<a name='500'>
  ENDDO<a name='501'>
<a name='502'>
<font color=#447700>!#endif<a name='503'></font>
<a name='504'>
   write(6,*) ' mu_1 from comp ', mu_1(1,1)<a name='505'>
   write(6,*) ' pert state sounding from comp, ph_1, pp, al, t_1, qv '<a name='506'>
   do k=1,kde-1<a name='507'>
     write(6,'(i3,1x,5(1x,1pe10.3))') k, ph_1(1,k,1),p(1,k,1), al(1,k,1), &amp;<a name='508'>
                     t_1(1,k,1), moist_1(1,k,1,P_QV)<a name='509'>
   enddo<a name='510'>
<a name='511'>
   write(6,*) ' mu_1 from comp ', mu_1(1,1)<a name='512'>
   write(6,*) ' full state sounding from comp, ph, p, al, t_1, qv '<a name='513'>
   write(6,*) ' at j = 1 '<a name='514'>
   do k=1,kde-1<a name='515'>
     write(6,'(i3,1x,5(1x,1pe10.3))') k, ph_1(1,k,1)+phb(1,k,1), &amp;<a name='516'>
                     p(1,k,1)+pb(1,k,1), al(1,k,1)+alb(1,k,1), &amp;<a name='517'>
                     t_1(1,k,1)+t0, moist_1(1,k,1,P_QV)<a name='518'>
   enddo<a name='519'>
<a name='520'>
<a name='521'>
   write(6,*) ' full state sounding from comp, ph, p, al, t_1, qv '<a name='522'>
   write(6,*) ' at j = jde/2 '<a name='523'>
   do k=1,kde-1<a name='524'>
     write(6,'(i3,1x,5(1x,1pe10.3))') k, ph_1(1,k,jde/2)+phb(1,k,jde/2), &amp;<a name='525'>
                     p(1,k,jde/2)+pb(1,k,jde/2), al(1,k,jde/2)+alb(1,k,jde/2), &amp;<a name='526'>
                     t_1(1,k,jde/2)+t0, moist_1(1,k,jde/2,P_QV)<a name='527'>
   enddo<a name='528'>
<a name='529'>
   write(6,*) ' full state sounding from comp, ph, p, al, t_1, qv '<a name='530'>
   write(6,*) ' at j = jde-1 '<a name='531'>
   do k=1,kde-1<a name='532'>
     write(6,'(i3,1x,5(1x,1pe10.3))') k, ph_1(1,k,jde-1)+phb(1,k,jde-1), &amp;<a name='533'>
                     p(1,k,jde-1)+pb(1,k,jde-1), al(1,k,jde-1)+alb(1,k,jde-1), &amp;<a name='534'>
                     t_1(1,k,jde-1)+t0, moist_1(1,k,jde-1,P_QV)<a name='535'>
   enddo<a name='536'>
<a name='537'>
<font color=#447700>! set v<a name='538'></font>
<a name='539'>
  DO J = jts, jte<a name='540'>
  DO I = its, min(ide-1,ite)<a name='541'>
<a name='542'>
    DO K = 1, kte<a name='543'>
      v_1(i,k,j) = 0.<a name='544'>
      v_2(i,k,j) = v_1(i,k,j)<a name='545'>
    ENDDO<a name='546'>
<a name='547'>
  ENDDO<a name='548'>
  ENDDO<a name='549'>
<a name='550'>
<font color=#447700>!  fill out last i row for u<a name='551'></font>
<a name='552'>
  DO J = jts, min(jde-1,jte)<a name='553'>
  DO I = ite, ite<a name='554'>
<a name='555'>
    DO K = 1, kte<a name='556'>
      u_1(i,k,j) = u_1(its,k,j)<a name='557'>
      u_2(i,k,j) = u_2(its,k,j)<a name='558'>
    ENDDO<a name='559'>
<a name='560'>
  ENDDO<a name='561'>
  ENDDO<a name='562'>
<a name='563'>
<font color=#447700>!  set w<a name='564'></font>
<a name='565'>
  DO J = jts, min(jde-1,jte)<a name='566'>
  DO K = kts, kte<a name='567'>
  DO I = its, min(ide-1,ite)<a name='568'>
    w_1(i,k,j) = 0.<a name='569'>
    w_2(i,k,j) = 0.<a name='570'>
  ENDDO<a name='571'>
  ENDDO<a name='572'>
  ENDDO<a name='573'>
<a name='574'>
<font color=#447700>!  set a few more things<a name='575'></font>
<a name='576'>
  DO J = jts, min(jde-1,jte)<a name='577'>
  DO K = kts, kte-1<a name='578'>
  DO I = its, min(ide-1,ite)<a name='579'>
    h_diabatic(i,k,j) = 0.<a name='580'>
  ENDDO<a name='581'>
  ENDDO<a name='582'>
  ENDDO<a name='583'>
<a name='584'>
  DO k=1,kte-1<a name='585'>
    t_base(k) = t_1(1,k,1)<a name='586'>
    qv_base(k) = moist_1(1,k,1,P_QV)<a name='587'>
    u_base(k) = u_1(1,k,1)<a name='588'>
    v_base(k) = v_1(1,k,1)<a name='589'>
  ENDDO<a name='590'>
<a name='591'>
  DO J = jts, min(jde-1,jte)<a name='592'>
  DO I = its, min(ide-1,ite)<a name='593'>
     thtmp   = t_2(i,1,j)+t0<a name='594'>
     ptmp    = p(i,1,j)+pb(i,1,j)<a name='595'>
     temp(1) = thtmp * (ptmp/p1000mb)**rcp<a name='596'>
     thtmp   = t_2(i,2,j)+t0<a name='597'>
     ptmp    = p(i,2,j)+pb(i,2,j)<a name='598'>
     temp(2) = thtmp * (ptmp/p1000mb)**rcp<a name='599'>
     thtmp   = t_2(i,3,j)+t0<a name='600'>
     ptmp    = p(i,3,j)+pb(i,3,j)<a name='601'>
     temp(3) = thtmp * (ptmp/p1000mb)**rcp<a name='602'>
<a name='603'>
     TSK(I,J)=cf1*temp(1)+cf2*temp(2)+cf3*temp(3)<a name='604'>
     if (i .eq. 1) print*,'sfctem',j,temp(1),temp(2),temp(3),TSK(I,J)<a name='605'>
     TMN(I,J)=TSK(I,J)-0.5<a name='606'>
  ENDDO<a name='607'>
  ENDDO<a name='608'>
<a name='609'>
#define COPY_OUT<a name='610'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_8"><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#INIT_DOMAIN_RK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='611'>
  RETURN<a name='612'>
<a name='613'>
 END SUBROUTINE init_domain_rk<a name='614'>
<a name='615'>
<font color=#447700>!---------------------------------------------------------------------<a name='616'></font>
<a name='617'>
<A NAME='INIT_MODULE_INITIALIZE'><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#INIT_MODULE_INITIALIZE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='618'>
 <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_initialize</font>,<A href='../../call_from/INIT_MODULE_INITIALIZE.html' TARGET='index'>8</A><a name='619'>
 END SUBROUTINE init_module_initialize<a name='620'>
<a name='621'>
<font color=#447700>!---------------------------------------------------------------------<a name='622'></font>
#if 0<a name='623'>
<font color=#447700>! TEST DRIVER FOR "read_input_jet" and "get_sounding"<a name='624'></font>
  implicit none <a name='625'>
  integer, parameter :: nz_jet=64, ny_jet=80<a name='626'>
  real, dimension(nz_jet,ny_jet) :: u_jet, rho_jet, &amp;<a name='627'>
                                    th_jet, z_jet<a name='628'>
<a name='629'>
  real, dimension(nz_jet,ny_jet) :: zk,p,p_dry,theta,rho,u,v,qv<a name='630'>
  logical :: dry, debug<a name='631'>
  integer :: j, nl<a name='632'>
<a name='633'>
  call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#READ_INPUT_JET'>read_input_jet</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_MODULE_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="READ_INPUT_JET_2">( u_jet, rho_jet, th_jet, z_jet, nz_jet, ny_jet )<a name='634'>
<a name='635'>
  call opngks<a name='636'>
  call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#PARRAY'>parray</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_MODULE_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRAY_1">( u_jet, nz_jet, ny_jet)<a name='637'>
  call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#PARRAY'>parray</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_MODULE_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRAY_2">( rho_jet, nz_jet, ny_jet)<a name='638'>
  call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#PARRAY'>parray</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_MODULE_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRAY_3">( th_jet, nz_jet, ny_jet)<a name='639'>
<font color=#447700>!  call clsgks<a name='640'></font>
<a name='641'>
<font color=#447700>!  set up initial jet<a name='642'></font>
<a name='643'>
  debug = .true.<a name='644'>
  dry = .true.<a name='645'>
  do j=1,ny_jet<a name='646'>
<a name='647'>
    call <A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#GET_SOUNDING'>get_sounding</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_MODULE_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_SOUNDING_3">( zk(:,j),p(:,j),p_dry(:,j),theta(:,j),      &amp;<a name='648'>
                       rho(:,j),u(:,j), v(:,j),  qv(:,j),        &amp;<a name='649'>
                       dry, nz_jet, nl, u_jet, rho_jet, th_jet,  &amp;<a name='650'>
                       z_jet, nz_jet, ny_jet, j, debug          )<a name='651'>
    debug = .false.<a name='652'>
<a name='653'>
  enddo<a name='654'>
<a name='655'>
  write(6,*) ' lowest level p, th, and rho, highest level p '<a name='656'>
<a name='657'>
  do j=1,ny_jet<a name='658'>
    write(6,*) j, p(1,j),theta(1,j),rho(1,j), p(nz_jet,j)<a name='659'>
<font color=#447700>!    write(6,*) j, p(1,j),theta(1,j)-th_jet(1,j),rho(1,j)-rho_jet(1,j)<a name='660'></font>
  enddo<a name='661'>
<a name='662'>
  call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#PARRAY'>parray</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_MODULE_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRAY_4">( p, nz_jet, ny_jet)<a name='663'>
  call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#PARRAY'>parray</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_MODULE_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRAY_5">( p_dry, nz_jet, ny_jet)<a name='664'>
  call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#PARRAY'>parray</A><A href='../../html_code/dyn_exp/module_initialize_exp.F.html#INIT_MODULE_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRAY_6">( theta, nz_jet, ny_jet)<a name='665'>
<a name='666'>
  call clsgks<a name='667'>
<a name='668'>
  end<a name='669'>
<a name='670'>
<font color=#447700>!---------------------------------<a name='671'></font>
<a name='672'>
<A NAME='PARRAY'><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#PARRAY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='673'>
      <font color=#993300>subroutine </font><font color=#cc0000>parray</font>(a,m,n) <A href='../../call_to/PARRAY.html' TARGET='index'>6</A><a name='674'>
      dimension a(m,n)<a name='675'>
      dimension b(n,m)<a name='676'>
<a name='677'>
    do i=1,m<a name='678'>
    do j=1,n<a name='679'>
      b(j,i) = a(i,j)<a name='680'>
    enddo<a name='681'>
    enddo<a name='682'>
      <a name='683'>
      write(6,'(''  dimensions m,n  '',2i6)')m,n<a name='684'>
        call set(.05,.95,.05,.95,0.,1.,0.,1.,1)<a name='685'>
        call perim(4,5,4,5)<a name='686'>
        call setusv('LW',2000)<a name='687'>
<font color=#447700>!        CALL CONREC(a,m,m,n,cmax,cmin,cinc,-1,-638,-922)<a name='688'></font>
        CALL CONREC(b,n,n,m,0.,0.,0.,-1,-638,-922)<a name='689'>
        call frame<a name='690'>
      return<a name='691'>
      end<a name='692'>
<a name='693'>
<font color=#447700>! END TEST DRIVER FOR "read_input_jet" and "get_sounding"<a name='694'></font>
#endif<a name='695'>
<a name='696'>
<font color=#447700>!------------------------------------------------------------------<a name='697'></font>
<a name='698'>
<A NAME='GET_SOUNDING'><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#GET_SOUNDING' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='699'>
    <font color=#993300>subroutine </font><font color=#cc0000>get_sounding</font>( zk, p, p_dry, theta, rho,       &amp; <A href='../../call_to/GET_SOUNDING.html' TARGET='index'>13</A>,<A href='../../call_from/GET_SOUNDING.html' TARGET='index'>12</A><a name='700'>
                             u, v, qv, dry, nl_max, nl_in,  &amp;<a name='701'>
                             u_jet, rho_jet, th_jet, z_jet, &amp;<a name='702'>
                             nz_jet, ny_jet, j_point, debug )<a name='703'>
    implicit none<a name='704'>
<a name='705'>
    integer nl_max, nl_in<a name='706'>
    real zk(nl_max), p(nl_max), theta(nl_max), rho(nl_max), &amp;<a name='707'>
         u(nl_max), v(nl_max), qv(nl_max), p_dry(nl_max)<a name='708'>
    logical dry<a name='709'>
<a name='710'>
    integer nz_jet, ny_jet, j_point<a name='711'>
    real, dimension(nz_jet, ny_jet) :: u_jet, rho_jet, th_jet, z_jet<a name='712'>
<a name='713'>
    integer n<a name='714'>
    parameter(n=1000)<a name='715'>
    logical debug<a name='716'>
<a name='717'>
<font color=#447700>! input sounding data<a name='718'></font>
<a name='719'>
    real p_surf, th_surf, qv_surf<a name='720'>
    real pi_surf, pi(n)<a name='721'>
    real h_input(n), th_input(n), qv_input(n), u_input(n), v_input(n)<a name='722'>
<a name='723'>
<font color=#447700>! diagnostics<a name='724'></font>
<a name='725'>
    real rho_surf, p_input(n), rho_input(n)<a name='726'>
    real pm_input(n)  <font color=#447700>!  this are for full moist sounding<a name='727'></font>
<a name='728'>
<font color=#447700>! local data<a name='729'></font>
<a name='730'>
    real p1000mb,cv,cp,r,cvpm,g<a name='731'>
    parameter (p1000mb = 1.e+05, r = 287, cp = 1003., cv = cp-r, cvpm = -cv/cp, g=9.81 )<a name='732'>
    integer k, it, nl<a name='733'>
    real qvf, qvf1, dz<a name='734'>
<a name='735'>
<font color=#447700>!  first, read the sounding<a name='736'></font>
<a name='737'>
<font color=#447700>!    call read_sounding( p_surf, th_surf, qv_surf, &amp;<a name='738'></font>
<font color=#447700>!                          h_input, th_input, qv_input, u_input, v_input,n, nl, debug )<a name='739'></font>
<a name='740'>
   call <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#CALC_JET_SOUNDING'>calc_jet_sounding</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#GET_SOUNDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_JET_SOUNDING_1">( p_surf, th_surf, qv_surf,                             &amp;<a name='741'>
                           h_input, th_input, qv_input, u_input, v_input,        &amp;<a name='742'>
                           n, nl, debug, u_jet, rho_jet, th_jet, z_jet, j_point, &amp;<a name='743'>
                           nz_jet, ny_jet, dry                                  )<a name='744'>
<a name='745'>
   nl = nz_jet<a name='746'>
<a name='747'>
    if(dry) then<a name='748'>
     do k=1,nl<a name='749'>
       qv_input(k) = 0.<a name='750'>
     enddo<a name='751'>
    endif<a name='752'>
<a name='753'>
    if(debug) write(6,*) ' number of input levels = ',nl<a name='754'>
<a name='755'>
      nl_in = nl<a name='756'>
      if(nl_in .gt. nl_max ) then<a name='757'>
        write(6,*) ' too many levels for input arrays ',nl_in,nl_max<a name='758'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/module_initialize_squall2d_y.F.html#GET_SOUNDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_18"> ( ' too many levels for input arrays ' )<a name='759'>
      end if<a name='760'>
<a name='761'>
<font color=#447700>!  compute diagnostics,<a name='762'></font>
<font color=#447700>!  first, convert qv(g/kg) to qv(g/g)<a name='763'></font>
<font color=#447700>!<a name='764'></font>
<font color=#447700>!      do k=1,nl<a name='765'></font>
<font color=#447700>!        qv_input(k) = 0.001*qv_input(k)<a name='766'></font>
<font color=#447700>!      enddo<a name='767'></font>
<font color=#447700>!      p_surf = 100.*p_surf  ! convert to pascals<a name='768'></font>
<a name='769'>
    qvf = 1. + rvovrd*qv_input(1) <a name='770'>
    rho_surf = 1./((r/p1000mb)*th_surf*qvf*((p_surf/p1000mb)**cvpm))<a name='771'>
    pi_surf = (p_surf/p1000mb)**(r/cp)<a name='772'>
<a name='773'>
    if(debug) then<a name='774'>
      write(6,*) ' surface density is ',rho_surf<a name='775'>
      write(6,*) ' surface pi is    ',pi_surf<a name='776'>
    end if<a name='777'>
<a name='778'>
<a name='779'>
<font color=#447700>!  integrate moist sounding hydrostatically, starting from the<a name='780'></font>
<font color=#447700>!  specified surface pressure<a name='781'></font>
<font color=#447700>!  -&gt; first, integrate from surface to lowest level<a name='782'></font>
<a name='783'>
        qvf = 1. + rvovrd*qv_input(1) <a name='784'>
        qvf1 = 1. + qv_input(1)<a name='785'>
        rho_input(1) = rho_surf<a name='786'>
        dz = h_input(1)<a name='787'>
        do it=1,10<a name='788'>
          pm_input(1) = p_surf &amp;<a name='789'>
                  - 0.5*dz*(rho_surf+rho_input(1))*g*qvf1<a name='790'>
          rho_input(1) = 1./((r/p1000mb)*th_input(1)*qvf*((pm_input(1)/p1000mb)**cvpm))<a name='791'>
        enddo<a name='792'>
<a name='793'>
<font color=#447700>! integrate up the column<a name='794'></font>
<a name='795'>
        do k=2,nl<a name='796'>
          rho_input(k) = rho_input(k-1)<a name='797'>
          dz = h_input(k)-h_input(k-1)<a name='798'>
          qvf1 = 0.5*(2.+(qv_input(k-1)+qv_input(k)))<a name='799'>
          qvf = 1. + rvovrd*qv_input(k)   <font color=#447700>! qv is in g/kg here<a name='800'></font>
 <a name='801'>
          do it=1,10<a name='802'>
            pm_input(k) = pm_input(k-1) &amp;<a name='803'>
                    - 0.5*dz*(rho_input(k)+rho_input(k-1))*g*qvf1<a name='804'>
            rho_input(k) = 1./((r/p1000mb)*th_input(k)*qvf*((pm_input(k)/p1000mb)**cvpm))<a name='805'>
          enddo<a name='806'>
        enddo<a name='807'>
<a name='808'>
<font color=#447700>!  we have the moist sounding<a name='809'></font>
<a name='810'>
<font color=#447700>!  next, compute the dry sounding using p at the highest level from the<a name='811'></font>
<font color=#447700>!  moist sounding and integrating down.<a name='812'></font>
<a name='813'>
        p_input(nl) = pm_input(nl)<a name='814'>
<a name='815'>
          do k=nl-1,1,-1<a name='816'>
            dz = h_input(k+1)-h_input(k)<a name='817'>
            p_input(k) = p_input(k+1) + 0.5*dz*(rho_input(k)+rho_input(k+1))*g<a name='818'>
          enddo<a name='819'>
<a name='820'>
<a name='821'>
        do k=1,nl<a name='822'>
<a name='823'>
          zk(k) = h_input(k)<a name='824'>
          p(k) = pm_input(k)<a name='825'>
          p_dry(k) = p_input(k)<a name='826'>
          theta(k) = th_input(k)<a name='827'>
          rho(k) = rho_input(k)<a name='828'>
          u(k) = u_input(k)<a name='829'>
          v(k) = v_input(k)<a name='830'>
          qv(k) = qv_input(k)<a name='831'>
<a name='832'>
        enddo<a name='833'>
<a name='834'>
     if(debug) then<a name='835'>
      write(6,*) ' sounding '<a name='836'>
      write(6,*) '  k  height(m)  press (Pa)   pd(Pa)   theta (K)  den(kg/m^3)  u(m/s)     v(m/s)    qv(g/g) '<a name='837'>
      do k=1,nl<a name='838'>
        write(6,'(1x,i3,8(1x,1pe10.3))') k, zk(k), p(k), p_dry(k), theta(k), rho(k), u(k), v(k), qv(k)<a name='839'>
      enddo<a name='840'>
<a name='841'>
     end if<a name='842'>
<a name='843'>
     end subroutine get_sounding<a name='844'>
<a name='845'>
<font color=#447700>!------------------------------------------------------------------<a name='846'></font>
<a name='847'>
<A NAME='CALC_JET_SOUNDING'><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#CALC_JET_SOUNDING' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='848'>
  <font color=#993300>subroutine </font><font color=#cc0000>calc_jet_sounding</font>( p_surf, th_surf, qv_surf,      &amp; <A href='../../call_to/CALC_JET_SOUNDING.html' TARGET='index'>1</A><a name='849'>
                                h, th, qv, u, v, n, nl, debug, &amp;<a name='850'>
                                u_jet, rho_jet, th_jet, z_jet, &amp;<a name='851'>
                                jp, nz_jet, ny_jet, dry       )<a name='852'>
  implicit none<a name='853'>
  integer :: n, nl, jp, nz_jet, ny_jet<a name='854'>
<a name='855'>
  real, dimension(nz_jet, ny_jet) :: u_jet, rho_jet, th_jet, z_jet<a name='856'>
  real, dimension(n) :: h,th,qv,u,v<a name='857'>
  real :: p_surf, th_surf, qv_surf<a name='858'>
  logical :: debug, dry<a name='859'>
<a name='860'>
  real, dimension(1:nz_jet) :: rho, rel_hum, p<a name='861'>
  integer :: k<a name='862'>
<a name='863'>
<font color=#447700>!  some local stuff<a name='864'></font>
<a name='865'>
  real :: tmppi, es, qvs, temperature<a name='866'>
  real, parameter :: p1000mb=1.e+05, rcp=287./1004.5, svpt0=273.15, &amp;<a name='867'>
                     svp3 = 29.65, ep_2=287./461.6, r_d = 287., &amp;<a name='868'>
                     cpovcv = 1004./(1004.-287.),               &amp;<a name='869'>
                     svp1 = 0.6112, svp2 = 17.67<a name='870'>
<a name='871'>
<font color=#447700>!  get sounding from column jp<a name='872'></font>
<a name='873'>
   do k=1,nz_jet<a name='874'>
     h(k)  = z_jet(k,jp)<a name='875'>
     th(k) = th_jet(k,jp)<a name='876'>
     qv(k) = 0.<a name='877'>
     rho(k) = rho_jet(k,jp)<a name='878'>
     u(k) = u_jet(k,jp)<a name='879'>
     v(k) = 0.<a name='880'>
   enddo<a name='881'>
<a name='882'>
   if (.not.dry) then<a name='883'>
     DO k=1,nz_jet<a name='884'>
       if(h(k) .gt. 8000.) then<a name='885'>
         rel_hum(k)=0.1<a name='886'>
       else<a name='887'>
         rel_hum(k)=(1.-0.90*(h(k)/8000.)**1.25)<a name='888'>
       end if<a name='889'>
       rel_hum(k) = min(0.7,rel_hum(k))<a name='890'>
     ENDDO<a name='891'>
   else<a name='892'>
     do k=1,nz_jet<a name='893'>
       rel_hum(k) = 0.<a name='894'>
     enddo<a name='895'>
   endif<a name='896'>
<a name='897'>
<font color=#447700>!  next, compute pressure<a name='898'></font>
<a name='899'>
   do k=1,nz_jet<a name='900'>
     p(k) = p1000mb*(R_d*rho(k)*th(k)/p1000mb)**cpovcv<a name='901'>
   enddo<a name='902'>
<a name='903'>
<font color=#447700>!  here we adjust for fixed moisture profile<a name='904'></font>
<a name='905'>
     IF (.not.dry)  THEN<a name='906'>
<a name='907'>
<font color=#447700>!  here we assume the input theta is th_v, so we reset theta accordingly<a name='908'></font>
<a name='909'>
       DO k=1,nz_jet<a name='910'>
         tmppi=(p(k)/p1000mb)**rcp<a name='911'>
         temperature = tmppi*th(k)<a name='912'>
         if (temperature .gt. svpt0) then<a name='913'>
            es  = 1000.*svp1*exp(svp2*(temperature-svpt0)/(temperature-svp3))<a name='914'>
            qvs = ep_2*es/(p(k)-es)<a name='915'>
         else<a name='916'>
            es  = 1000.*svp1*exp( 21.8745584*(temperature-273.16)/(temperature-7.66) )<a name='917'>
            qvs = ep_2*es/(p(k)-es)<a name='918'>
         endif<a name='919'>
         qv(k) = rel_hum(k)*qvs<a name='920'>
         th(k) = th(k)/(1.+.61*qv(k))<a name='921'>
       ENDDO<a name='922'>
 <a name='923'>
     ENDIF<a name='924'>
<a name='925'>
<font color=#447700>!  finally, set the surface data. We'll just do a simple extrapolation<a name='926'></font>
<a name='927'>
   p_surf = 1.5*p(1) - 0.5*p(2)<a name='928'>
   th_surf = 1.5*th(1) - 0.5*th(2)<a name='929'>
   qv_surf = 1.5*qv(1) - 0.5*qv(2)<a name='930'>
<a name='931'>
   end subroutine calc_jet_sounding<a name='932'>
<a name='933'>
<font color=#447700>!---------------------------------------------------------------------<a name='934'></font>
<a name='935'>
<A NAME='READ_INPUT_JET'><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#READ_INPUT_JET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='936'>
 <font color=#993300>SUBROUTINE </font><font color=#cc0000>read_input_jet</font>( u, r, t, zk, nz, ny ) <A href='../../call_to/READ_INPUT_JET.html' TARGET='index'>2</A>,<A href='../../call_from/READ_INPUT_JET.html' TARGET='index'>1</A><a name='937'>
 implicit none<a name='938'>
<a name='939'>
 integer, intent(in) :: nz,ny<a name='940'>
 real, dimension(nz,ny), intent(out) :: u,r,t,zk<a name='941'>
 integer :: ny_in, nz_in, j,k<a name='942'>
 real, dimension(ny,nz) :: field_in<a name='943'>
<a name='944'>
<font color=#447700>! this code assumes it is called on processor 0 only<a name='945'></font>
<a name='946'>
   OPEN(unit=10, file='input_jet', form='unformatted', status='old' )<a name='947'>
   REWIND(10) <a name='948'>
   read(10) ny_in,nz_in<a name='949'>
   if((ny_in /= ny ) .or. (nz_in /= nz)) then<a name='950'>
     write(0,*) ' error in input jet dimensions '<a name='951'>
     write(0,*) ' ny, ny_input, nz, nz_input ', ny, ny_in, nz,nz_in<a name='952'>
     write(0,*) ' error exit '<a name='953'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#READ_INPUT_JET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_19"> ( ' error in input jet dimensions ' )<a name='954'>
   end if<a name='955'>
   read(10) field_in<a name='956'>
   do j=1,ny<a name='957'>
   do k=1,nz<a name='958'>
     u(k,j) = field_in(j,k)<a name='959'>
   enddo<a name='960'>
   enddo<a name='961'>
   read(10) field_in<a name='962'>
   do j=1,ny<a name='963'>
   do k=1,nz<a name='964'>
     t(k,j) = field_in(j,k)<a name='965'>
   enddo<a name='966'>
   enddo<a name='967'>
<a name='968'>
   read(10) field_in<a name='969'>
   do j=1,ny<a name='970'>
   do k=1,nz<a name='971'>
     r(k,j) = field_in(j,k)<a name='972'>
   enddo<a name='973'>
   enddo<a name='974'>
<a name='975'>
   do j=1,ny<a name='976'>
   do k=1,nz<a name='977'>
     zk(k,j) = 125. + 250.*float(k-1)<a name='978'>
   enddo<a name='979'>
   enddo<a name='980'>
<a name='981'>
 end subroutine read_input_jet<a name='982'>
<a name='983'>
END MODULE module_initialize<a name='984'>
</pre></body></html>