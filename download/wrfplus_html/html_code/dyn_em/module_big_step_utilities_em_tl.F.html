<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!                           DISCLAIMER<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<font color=#447700>!   This file was generated by TAF version 1.7.18<a name='4'></font>
<font color=#447700>!<a name='5'></font>
<font color=#447700>!   FASTOPT DISCLAIMS  ALL  WARRANTIES,  EXPRESS  OR  IMPLIED,<a name='6'></font>
<font color=#447700>!   INCLUDING (WITHOUT LIMITATION) ALL IMPLIED  WARRANTIES  OF<a name='7'></font>
<font color=#447700>!   MERCHANTABILITY  OR FITNESS FOR A PARTICULAR PURPOSE, WITH<a name='8'></font>
<font color=#447700>!   RESPECT TO THE SOFTWARE AND USER PROGRAMS.   IN  NO  EVENT<a name='9'></font>
<font color=#447700>!   SHALL  FASTOPT BE LIABLE FOR ANY LOST OR ANTICIPATED PROF-<a name='10'></font>
<font color=#447700>!   ITS, OR ANY INDIRECT, INCIDENTAL, EXEMPLARY,  SPECIAL,  OR<a name='11'></font>
<font color=#447700>!   CONSEQUENTIAL  DAMAGES, WHETHER OR NOT FASTOPT WAS ADVISED<a name='12'></font>
<font color=#447700>!   OF THE POSSIBILITY OF SUCH DAMAGES.<a name='13'></font>
<font color=#447700>!<a name='14'></font>
<font color=#447700>!                           Haftungsbeschraenkung<a name='15'></font>
<font color=#447700>!   FastOpt gibt ausdruecklich keine Gewaehr, explizit oder indirekt,<a name='16'></font>
<font color=#447700>!   bezueglich der Brauchbarkeit  der Software  fuer einen bestimmten<a name='17'></font>
<font color=#447700>!   Zweck.   Unter  keinen  Umstaenden   ist  FastOpt   haftbar  fuer<a name='18'></font>
<font color=#447700>!   irgendeinen Verlust oder nicht eintretenden erwarteten Gewinn und<a name='19'></font>
<font color=#447700>!   allen indirekten,  zufaelligen,  exemplarischen  oder  speziellen<a name='20'></font>
<font color=#447700>!   Schaeden  oder  Folgeschaeden  unabhaengig  von einer eventuellen<a name='21'></font>
<font color=#447700>!   Mitteilung darueber an FastOpt.<a name='22'></font>
<font color=#447700>!<a name='23'></font>
<A NAME='G_MODULE_BIG_STEP_UTILITIES_EM'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MODULE_BIG_STEP_UTILITIES_EM' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='24'>
<font color=#993300>module </font><font color=#cc0000>g_module_big_step_utilities_em</font> <A href='../../call_to/G_MODULE_BIG_STEP_UTILITIES_EM.html' TARGET='index'>5</A><a name='25'>
<font color=#447700>!******************************************************************<a name='26'></font>
<font color=#447700>!******************************************************************<a name='27'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='28'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='29'></font>
<font color=#447700>!******************************************************************<a name='30'></font>
<font color=#447700>!******************************************************************<a name='31'></font>
<font color=#447700>!==============================================<a name='32'></font>
<font color=#447700>! referencing used modules<a name='33'></font>
<font color=#447700>!==============================================<a name='34'></font>
use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#module_big_step_utilities_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_5"><a name='35'>
use <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#module_big_step_utilities_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_6"><a name='36'>
use module_state_description<a name='37'>
use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#module_big_step_utilities_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_10"><a name='38'>
use <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#MODULE_BIG_STEP_UTILITIES_EM'>module_big_step_utilities_em</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#module_big_step_utilities_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BIG_STEP_UTILITIES_EM_3"><a name='39'>
<a name='40'>
USE <A href='../../html_code/frame/module_trace.F.html#MODULE_TRACE'>module_trace</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#module_big_step_utilities_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TRACE_7">, only : trace_entry, trace_exit<a name='41'>
<a name='42'>
<font color=#447700>!==============================================<a name='43'></font>
<font color=#447700>! all entries are defined explicitly<a name='44'></font>
<font color=#447700>!==============================================<a name='45'></font>
implicit none<a name='46'>
<a name='47'>
contains<a name='48'>
<a name='49'>
<A NAME='G_CALC_ALT'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_ALT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='50'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_alt</font>( alt, g_alt, al, g_al, alb, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte ) <A href='../../call_to/G_CALC_ALT.html' TARGET='index'>1</A>,<A href='../../call_from/G_CALC_ALT.html' TARGET='index'>2</A><a name='51'>
<font color=#447700>!******************************************************************<a name='52'></font>
<font color=#447700>!******************************************************************<a name='53'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='54'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='55'></font>
<font color=#447700>!******************************************************************<a name='56'></font>
<font color=#447700>!******************************************************************<a name='57'></font>
<font color=#447700>!==============================================<a name='58'></font>
<font color=#447700>! all entries are defined explicitly<a name='59'></font>
<font color=#447700>!==============================================<a name='60'></font>
implicit none<a name='61'>
<a name='62'>
<font color=#447700>!==============================================<a name='63'></font>
<font color=#447700>! declare arguments<a name='64'></font>
<font color=#447700>!==============================================<a name='65'></font>
integer, intent(in) :: ime<a name='66'>
integer, intent(in) :: ims<a name='67'>
integer, intent(in) :: jme<a name='68'>
integer, intent(in) :: jms<a name='69'>
integer, intent(in) :: kme<a name='70'>
integer, intent(in) :: kms<a name='71'>
real, intent(in) :: al(ims:ime,kms:kme,jms:jme)<a name='72'>
real, intent(in) :: alb(ims:ime,kms:kme,jms:jme)<a name='73'>
real, intent(out) :: alt(ims:ime,kms:kme,jms:jme)<a name='74'>
real, intent(in) :: g_al(ims:ime,kms:kme,jms:jme)<a name='75'>
real, intent(out) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='76'>
integer, intent(in) :: ide<a name='77'>
integer, intent(in) :: ite<a name='78'>
integer, intent(in) :: its<a name='79'>
integer, intent(in) :: jde<a name='80'>
integer, intent(in) :: jte<a name='81'>
integer, intent(in) :: jts<a name='82'>
integer, intent(in) :: kde<a name='83'>
integer, intent(in) :: kte<a name='84'>
integer, intent(in) :: kts<a name='85'>
<a name='86'>
<font color=#447700>!==============================================<a name='87'></font>
<font color=#447700>! declare local variables<a name='88'></font>
<font color=#447700>!==============================================<a name='89'></font>
integer i<a name='90'>
integer itf<a name='91'>
integer j<a name='92'>
integer jtf<a name='93'>
integer k<a name='94'>
integer ktf<a name='95'>
<a name='96'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_ALT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_46">("g_calc_alt")<a name='97'>
<a name='98'>
<font color=#447700>!----------------------------------------------<a name='99'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='100'></font>
<font color=#447700>!----------------------------------------------<a name='101'></font>
itf = min(ite,ide-1)<a name='102'>
jtf = min(jte,jde-1)<a name='103'>
ktf = min(kte,kde-1)<a name='104'>
do j = jts, jtf<a name='105'>
  do k = kts, ktf<a name='106'>
    do i = its, itf<a name='107'>
      g_alt(i,k,j) = g_al(i,k,j)<a name='108'>
      alt(i,k,j) = al(i,k,j)+alb(i,k,j)<a name='109'>
    end do<a name='110'>
  end do<a name='111'>
end do<a name='112'>
<a name='113'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_ALT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_46">("g_calc_alt")<a name='114'>
<a name='115'>
end subroutine g_calc_alt<a name='116'>
<a name='117'>
<a name='118'>
<A NAME='G_CALC_CQ'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_CQ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='119'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_cq</font>( moist, g_moist, cqu, g_cqu, cqv, g_cqv, cqw, g_cqw, n_moist, ide, jde, kde, ims, ime, jms, jme, kms, kme, &amp; <A href='../../call_to/G_CALC_CQ.html' TARGET='index'>1</A>,<A href='../../call_from/G_CALC_CQ.html' TARGET='index'>2</A><a name='120'>
&amp;its, ite, jts, jte, kts, kte )<a name='121'>
<font color=#447700>!******************************************************************<a name='122'></font>
<font color=#447700>!******************************************************************<a name='123'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='124'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='125'></font>
<font color=#447700>!******************************************************************<a name='126'></font>
<font color=#447700>!******************************************************************<a name='127'></font>
<font color=#447700>!==============================================<a name='128'></font>
<font color=#447700>! all entries are defined explicitly<a name='129'></font>
<font color=#447700>!==============================================<a name='130'></font>
implicit none<a name='131'>
<a name='132'>
<font color=#447700>!==============================================<a name='133'></font>
<font color=#447700>! declare arguments<a name='134'></font>
<font color=#447700>!==============================================<a name='135'></font>
integer, intent(in) :: ime<a name='136'>
integer, intent(in) :: ims<a name='137'>
integer, intent(in) :: jme<a name='138'>
integer, intent(in) :: jms<a name='139'>
integer, intent(in) :: kme<a name='140'>
integer, intent(in) :: kms<a name='141'>
real, intent(out) :: cqu(ims:ime,kms:kme,jms:jme)<a name='142'>
real, intent(out) :: cqv(ims:ime,kms:kme,jms:jme)<a name='143'>
real, intent(out) :: cqw(ims:ime,kms:kme,jms:jme)<a name='144'>
real, intent(out) :: g_cqu(ims:ime,kms:kme,jms:jme)<a name='145'>
real, intent(out) :: g_cqv(ims:ime,kms:kme,jms:jme)<a name='146'>
real, intent(out) :: g_cqw(ims:ime,kms:kme,jms:jme)<a name='147'>
integer, intent(in) :: n_moist<a name='148'>
real, intent(in) :: g_moist(ims:ime,kms:kme,jms:jme,n_moist)<a name='149'>
integer, intent(in) :: ide<a name='150'>
integer, intent(in) :: ite<a name='151'>
integer, intent(in) :: its<a name='152'>
integer, intent(in) :: jde<a name='153'>
integer, intent(in) :: jte<a name='154'>
integer, intent(in) :: jts<a name='155'>
integer, intent(in) :: kde<a name='156'>
integer, intent(in) :: kte<a name='157'>
integer, intent(in) :: kts<a name='158'>
real, intent(in) :: moist(ims:ime,kms:kme,jms:jme,n_moist)<a name='159'>
<a name='160'>
<font color=#447700>!==============================================<a name='161'></font>
<font color=#447700>! declare local variables<a name='162'></font>
<font color=#447700>!==============================================<a name='163'></font>
real g_qtot<a name='164'>
integer i<a name='165'>
integer ispe<a name='166'>
integer itf<a name='167'>
integer j<a name='168'>
integer jtf<a name='169'>
integer k<a name='170'>
integer ktf<a name='171'>
real qtot<a name='172'>
<a name='173'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_CQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_47">("g_calc_cq")<a name='174'>
<a name='175'>
<font color=#447700>!----------------------------------------------<a name='176'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='177'></font>
<font color=#447700>!----------------------------------------------<a name='178'></font>
itf = ite<a name='179'>
jtf = min(jte,jde-1)<a name='180'>
ktf = min(kte,kde-1)<a name='181'>
if (n_moist .ge. param_first_scalar) then<a name='182'>
  do j = jts, jtf<a name='183'>
    do k = kts, ktf<a name='184'>
      do i = its, itf<a name='185'>
        g_qtot = 0.<a name='186'>
        qtot = 0.<a name='187'>
        do ispe = param_first_scalar, n_moist<a name='188'>
          g_qtot = g_moist(i-1,k,j,ispe)+g_moist(i,k,j,ispe)+g_qtot<a name='189'>
          qtot = qtot+moist(i,k,j,ispe)+moist(i-1,k,j,ispe)<a name='190'>
        end do<a name='191'>
        g_cqu(i,k,j) = -(g_qtot*(0.5/((1.+0.5*qtot)*(1.+0.5*qtot))))<a name='192'>
        cqu(i,k,j) = 1./(1.+0.5*qtot)<a name='193'>
      end do<a name='194'>
    end do<a name='195'>
  end do<a name='196'>
  itf = min(ite,ide-1)<a name='197'>
  jtf = jte<a name='198'>
  do j = jts, jtf<a name='199'>
    do k = kts, ktf<a name='200'>
      do i = its, itf<a name='201'>
        g_qtot = 0.<a name='202'>
        qtot = 0.<a name='203'>
        do ispe = param_first_scalar, n_moist<a name='204'>
          g_qtot = g_moist(i,k,j-1,ispe)+g_moist(i,k,j,ispe)+g_qtot<a name='205'>
          qtot = qtot+moist(i,k,j,ispe)+moist(i,k,j-1,ispe)<a name='206'>
        end do<a name='207'>
        g_cqv(i,k,j) = -(g_qtot*(0.5/((1.+0.5*qtot)*(1.+0.5*qtot))))<a name='208'>
        cqv(i,k,j) = 1./(1.+0.5*qtot)<a name='209'>
      end do<a name='210'>
    end do<a name='211'>
  end do<a name='212'>
  itf = min(ite,ide-1)<a name='213'>
  jtf = min(jte,jde-1)<a name='214'>
  do j = jts, jtf<a name='215'>
    do k = kts+1, ktf<a name='216'>
      do i = its, itf<a name='217'>
        g_qtot = 0.<a name='218'>
        qtot = 0.<a name='219'>
        do ispe = param_first_scalar, n_moist<a name='220'>
          g_qtot = g_moist(i,k-1,j,ispe)+g_moist(i,k,j,ispe)+g_qtot<a name='221'>
          qtot = qtot+moist(i,k,j,ispe)+moist(i,k-1,j,ispe)<a name='222'>
        end do<a name='223'>
        g_cqw(i,k,j) = 0.5*g_qtot<a name='224'>
        cqw(i,k,j) = 0.5*qtot<a name='225'>
      end do<a name='226'>
    end do<a name='227'>
  end do<a name='228'>
else<a name='229'>
  do j = jts, jtf<a name='230'>
    do k = kts, ktf<a name='231'>
      do i = its, itf<a name='232'>
        g_cqu(i,k,j) = 0.<a name='233'>
        cqu(i,k,j) = 1.<a name='234'>
      end do<a name='235'>
    end do<a name='236'>
  end do<a name='237'>
  itf = min(ite,ide-1)<a name='238'>
  jtf = jte<a name='239'>
  do j = jts, jtf<a name='240'>
    do k = kts, ktf<a name='241'>
      do i = its, itf<a name='242'>
        g_cqv(i,k,j) = 0.<a name='243'>
        cqv(i,k,j) = 1.<a name='244'>
      end do<a name='245'>
    end do<a name='246'>
  end do<a name='247'>
  itf = min(ite,ide-1)<a name='248'>
  jtf = min(jte,jde-1)<a name='249'>
  do j = jts, jtf<a name='250'>
    do k = kts+1, ktf<a name='251'>
      do i = its, itf<a name='252'>
        g_cqw(i,k,j) = 0.<a name='253'>
        cqw(i,k,j) = 0.<a name='254'>
      end do<a name='255'>
    end do<a name='256'>
  end do<a name='257'>
endif<a name='258'>
<a name='259'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_CQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_47">("g_calc_cq")<a name='260'>
<a name='261'>
end subroutine g_calc_cq<a name='262'>
<a name='263'>
<a name='264'>
<A NAME='G_CALC_MU_UV'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_MU_UV' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='265'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_mu_uv</font>( config_flags, mu, g_mu, mub, muu, g_muu, muv, g_muv, ids, ide, jds, jde, ims, ime, jms, jme, its, ite, &amp; <A href='../../call_to/G_CALC_MU_UV.html' TARGET='index'>1</A>,<A href='../../call_from/G_CALC_MU_UV.html' TARGET='index'>2</A><a name='266'>
&amp;jts, jte )<a name='267'>
<font color=#447700>!******************************************************************<a name='268'></font>
<font color=#447700>!******************************************************************<a name='269'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='270'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='271'></font>
<font color=#447700>!******************************************************************<a name='272'></font>
<font color=#447700>!******************************************************************<a name='273'></font>
<font color=#447700>!==============================================<a name='274'></font>
<font color=#447700>! all entries are defined explicitly<a name='275'></font>
<font color=#447700>!==============================================<a name='276'></font>
implicit none<a name='277'>
<a name='278'>
<font color=#447700>!==============================================<a name='279'></font>
<font color=#447700>! declare arguments<a name='280'></font>
<font color=#447700>!==============================================<a name='281'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='282'>
integer, intent(in) :: ime<a name='283'>
integer, intent(in) :: ims<a name='284'>
integer, intent(in) :: jme<a name='285'>
integer, intent(in) :: jms<a name='286'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='287'>
real, intent(out) :: g_muu(ims:ime,jms:jme)<a name='288'>
real, intent(out) :: g_muv(ims:ime,jms:jme)<a name='289'>
integer, intent(in) :: ide<a name='290'>
integer, intent(in) :: ids<a name='291'>
integer, intent(in) :: ite<a name='292'>
integer, intent(in) :: its<a name='293'>
integer, intent(in) :: jde<a name='294'>
integer, intent(in) :: jds<a name='295'>
integer, intent(in) :: jte<a name='296'>
integer, intent(in) :: jts<a name='297'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='298'>
real, intent(in) :: mub(ims:ime,jms:jme)<a name='299'>
real, intent(out) :: muu(ims:ime,jms:jme)<a name='300'>
real, intent(out) :: muv(ims:ime,jms:jme)<a name='301'>
<a name='302'>
<font color=#447700>!==============================================<a name='303'></font>
<font color=#447700>! declare local variables<a name='304'></font>
<font color=#447700>!==============================================<a name='305'></font>
integer i<a name='306'>
integer im<a name='307'>
integer itf<a name='308'>
integer j<a name='309'>
integer jm<a name='310'>
integer jtf<a name='311'>
<a name='312'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_MU_UV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_48">("g_calc_mu_uv")<a name='313'>
<a name='314'>
<font color=#447700>!----------------------------------------------<a name='315'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='316'></font>
<font color=#447700>!----------------------------------------------<a name='317'></font>
itf = ite<a name='318'>
jtf = min(jte,jde-1)<a name='319'>
if (its .ne. ids .and. ite .ne. ide) then<a name='320'>
  do j = jts, jtf<a name='321'>
    do i = its, itf<a name='322'>
      g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='323'>
      muu(i,j) = 0.5*(mu(i,j)+mu(i-1,j)+mub(i,j)+mub(i-1,j))<a name='324'>
    end do<a name='325'>
  end do<a name='326'>
else if (its .eq. ids .and. ite .ne. ide) then<a name='327'>
  do j = jts, jtf<a name='328'>
    do i = its+1, itf<a name='329'>
      g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='330'>
      muu(i,j) = 0.5*(mu(i,j)+mu(i-1,j)+mub(i,j)+mub(i-1,j))<a name='331'>
    end do<a name='332'>
  end do<a name='333'>
  i = its<a name='334'>
  im = its<a name='335'>
  if (config_flags%periodic_x) then<a name='336'>
    im = its-1<a name='337'>
  endif<a name='338'>
  do j = jts, jtf<a name='339'>
    g_muu(i,j) = 0.5*g_mu(i,j)+0.5*g_mu(im,j)<a name='340'>
    muu(i,j) = 0.5*(mu(i,j)+mu(im,j)+mub(i,j)+mub(im,j))<a name='341'>
  end do<a name='342'>
else if (its .ne. ids .and. ite .eq. ide) then<a name='343'>
  do j = jts, jtf<a name='344'>
    do i = its, itf-1<a name='345'>
      g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='346'>
      muu(i,j) = 0.5*(mu(i,j)+mu(i-1,j)+mub(i,j)+mub(i-1,j))<a name='347'>
    end do<a name='348'>
  end do<a name='349'>
  i = ite<a name='350'>
  im = ite-1<a name='351'>
  if (config_flags%periodic_x) then<a name='352'>
    im = ite<a name='353'>
  endif<a name='354'>
  do j = jts, jtf<a name='355'>
    g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(im,j)<a name='356'>
    muu(i,j) = 0.5*(mu(i-1,j)+mu(im,j)+mub(i-1,j)+mub(im,j))<a name='357'>
  end do<a name='358'>
else if (its .eq. ids .and. ite .eq. ide) then<a name='359'>
  do j = jts, jtf<a name='360'>
    do i = its+1, itf-1<a name='361'>
      g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='362'>
      muu(i,j) = 0.5*(mu(i,j)+mu(i-1,j)+mub(i,j)+mub(i-1,j))<a name='363'>
    end do<a name='364'>
  end do<a name='365'>
  i = its<a name='366'>
  im = its<a name='367'>
  if (config_flags%periodic_x) then<a name='368'>
    im = its-1<a name='369'>
  endif<a name='370'>
  do j = jts, jtf<a name='371'>
    g_muu(i,j) = 0.5*g_mu(i,j)+0.5*g_mu(im,j)<a name='372'>
    muu(i,j) = 0.5*(mu(i,j)+mu(im,j)+mub(i,j)+mub(im,j))<a name='373'>
  end do<a name='374'>
  i = ite<a name='375'>
  im = ite-1<a name='376'>
  if (config_flags%periodic_x) then<a name='377'>
    im = ite<a name='378'>
  endif<a name='379'>
  do j = jts, jtf<a name='380'>
    g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(im,j)<a name='381'>
    muu(i,j) = 0.5*(mu(i-1,j)+mu(im,j)+mub(i-1,j)+mub(im,j))<a name='382'>
  end do<a name='383'>
endif<a name='384'>
itf = min(ite,ide-1)<a name='385'>
jtf = jte<a name='386'>
if (jts .ne. jds .and. jte .ne. jde) then<a name='387'>
  do j = jts, jtf<a name='388'>
    do i = its, itf<a name='389'>
      g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='390'>
      muv(i,j) = 0.5*(mu(i,j)+mu(i,j-1)+mub(i,j)+mub(i,j-1))<a name='391'>
    end do<a name='392'>
  end do<a name='393'>
else if (jts .eq. jds .and. jte .ne. jde) then<a name='394'>
  do j = jts+1, jtf<a name='395'>
    do i = its, itf<a name='396'>
      g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='397'>
      muv(i,j) = 0.5*(mu(i,j)+mu(i,j-1)+mub(i,j)+mub(i,j-1))<a name='398'>
    end do<a name='399'>
  end do<a name='400'>
  j = jts<a name='401'>
  jm = jts<a name='402'>
  if (config_flags%periodic_y) then<a name='403'>
    jm = jts-1<a name='404'>
  endif<a name='405'>
  do i = its, itf<a name='406'>
    g_muv(i,j) = 0.5*g_mu(i,j)+0.5*g_mu(i,jm)<a name='407'>
    muv(i,j) = 0.5*(mu(i,j)+mu(i,jm)+mub(i,j)+mub(i,jm))<a name='408'>
  end do<a name='409'>
else if (jts .ne. jds .and. jte .eq. jde) then<a name='410'>
  do j = jts, jtf-1<a name='411'>
    do i = its, itf<a name='412'>
      g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='413'>
      muv(i,j) = 0.5*(mu(i,j)+mu(i,j-1)+mub(i,j)+mub(i,j-1))<a name='414'>
    end do<a name='415'>
  end do<a name='416'>
  j = jte<a name='417'>
  jm = jte-1<a name='418'>
  if (config_flags%periodic_y) then<a name='419'>
    jm = jte<a name='420'>
  endif<a name='421'>
  do i = its, itf<a name='422'>
    g_muv(i,j) = g_mu(i,j-1)<a name='423'>
    muv(i,j) = mu(i,j-1)+mub(i,j-1)<a name='424'>
    g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,jm)<a name='425'>
    muv(i,j) = 0.5*(mu(i,j-1)+mu(i,jm)+mub(i,j-1)+mub(i,jm))<a name='426'>
  end do<a name='427'>
else if (jts .eq. jds .and. jte .eq. jde) then<a name='428'>
  do j = jts+1, jtf-1<a name='429'>
    do i = its, itf<a name='430'>
      g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='431'>
      muv(i,j) = 0.5*(mu(i,j)+mu(i,j-1)+mub(i,j)+mub(i,j-1))<a name='432'>
    end do<a name='433'>
  end do<a name='434'>
  j = jts<a name='435'>
  jm = jts<a name='436'>
  if (config_flags%periodic_y) then<a name='437'>
    jm = jts-1<a name='438'>
  endif<a name='439'>
  do i = its, itf<a name='440'>
    g_muv(i,j) = 0.5*g_mu(i,j)+0.5*g_mu(i,jm)<a name='441'>
    muv(i,j) = 0.5*(mu(i,j)+mu(i,jm)+mub(i,j)+mub(i,jm))<a name='442'>
  end do<a name='443'>
  j = jte<a name='444'>
  jm = jte-1<a name='445'>
  if (config_flags%periodic_y) then<a name='446'>
    jm = jte<a name='447'>
  endif<a name='448'>
  do i = its, itf<a name='449'>
    g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,jm)<a name='450'>
    muv(i,j) = 0.5*(mu(i,j-1)+mu(i,jm)+mub(i,j-1)+mub(i,jm))<a name='451'>
  end do<a name='452'>
endif<a name='453'>
<a name='454'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_MU_UV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_48">("g_calc_mu_uv")<a name='455'>
<a name='456'>
end subroutine g_calc_mu_uv<a name='457'>
<a name='458'>
<a name='459'>
<A NAME='G_CALC_MU_UV_1'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_MU_UV_1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='460'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_mu_uv_1</font>( config_flags, mu, g_mu, muu, g_muu, muv, g_muv, ids, ide, jds, jde, ims, ime, jms, jme, its, ite, jts, &amp; <A href='../../call_to/G_CALC_MU_UV_1.html' TARGET='index'>3</A>,<A href='../../call_from/G_CALC_MU_UV_1.html' TARGET='index'>2</A><a name='461'>
&amp;jte )<a name='462'>
<font color=#447700>!******************************************************************<a name='463'></font>
<font color=#447700>!******************************************************************<a name='464'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='465'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='466'></font>
<font color=#447700>!******************************************************************<a name='467'></font>
<font color=#447700>!******************************************************************<a name='468'></font>
<font color=#447700>!==============================================<a name='469'></font>
<font color=#447700>! all entries are defined explicitly<a name='470'></font>
<font color=#447700>!==============================================<a name='471'></font>
implicit none<a name='472'>
<a name='473'>
<font color=#447700>!==============================================<a name='474'></font>
<font color=#447700>! declare arguments<a name='475'></font>
<font color=#447700>!==============================================<a name='476'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='477'>
integer, intent(in) :: ime<a name='478'>
integer, intent(in) :: ims<a name='479'>
integer, intent(in) :: jme<a name='480'>
integer, intent(in) :: jms<a name='481'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='482'>
real, intent(out) :: g_muu(ims:ime,jms:jme)<a name='483'>
real, intent(out) :: g_muv(ims:ime,jms:jme)<a name='484'>
integer, intent(in) :: ide<a name='485'>
integer, intent(in) :: ids<a name='486'>
integer, intent(in) :: ite<a name='487'>
integer, intent(in) :: its<a name='488'>
integer, intent(in) :: jde<a name='489'>
integer, intent(in) :: jds<a name='490'>
integer, intent(in) :: jte<a name='491'>
integer, intent(in) :: jts<a name='492'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='493'>
real, intent(out) :: muu(ims:ime,jms:jme)<a name='494'>
real, intent(out) :: muv(ims:ime,jms:jme)<a name='495'>
<a name='496'>
<font color=#447700>!==============================================<a name='497'></font>
<font color=#447700>! declare local variables<a name='498'></font>
<font color=#447700>!==============================================<a name='499'></font>
integer i<a name='500'>
integer im<a name='501'>
integer itf<a name='502'>
integer j<a name='503'>
integer jm<a name='504'>
integer jtf<a name='505'>
<a name='506'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_MU_UV_1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_49">("g_calc_mu_uv_1")<a name='507'>
<a name='508'>
<font color=#447700>!----------------------------------------------<a name='509'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='510'></font>
<font color=#447700>!----------------------------------------------<a name='511'></font>
itf = ite<a name='512'>
jtf = min(jte,jde-1)<a name='513'>
if (its .ne. ids .and. ite .ne. ide) then<a name='514'>
  do j = jts, jtf<a name='515'>
    do i = its, itf<a name='516'>
      g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='517'>
      muu(i,j) = 0.5*(mu(i,j)+mu(i-1,j))<a name='518'>
    end do<a name='519'>
  end do<a name='520'>
else if (its .eq. ids .and. ite .ne. ide) then<a name='521'>
  do j = jts, jtf<a name='522'>
    do i = its+1, itf<a name='523'>
      g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='524'>
      muu(i,j) = 0.5*(mu(i,j)+mu(i-1,j))<a name='525'>
    end do<a name='526'>
  end do<a name='527'>
  i = its<a name='528'>
  im = its<a name='529'>
  if (config_flags%periodic_x) then<a name='530'>
    im = its-1<a name='531'>
  endif<a name='532'>
  do j = jts, jtf<a name='533'>
    g_muu(i,j) = 0.5*g_mu(i,j)+0.5*g_mu(im,j)<a name='534'>
    muu(i,j) = 0.5*(mu(i,j)+mu(im,j))<a name='535'>
  end do<a name='536'>
else if (its .ne. ids .and. ite .eq. ide) then<a name='537'>
  do j = jts, jtf<a name='538'>
    do i = its, itf-1<a name='539'>
      g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='540'>
      muu(i,j) = 0.5*(mu(i,j)+mu(i-1,j))<a name='541'>
    end do<a name='542'>
  end do<a name='543'>
  i = ite<a name='544'>
  im = ite-1<a name='545'>
  if (config_flags%periodic_x) then<a name='546'>
    im = ite<a name='547'>
  endif<a name='548'>
  do j = jts, jtf<a name='549'>
    g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(im,j)<a name='550'>
    muu(i,j) = 0.5*(mu(i-1,j)+mu(im,j))<a name='551'>
  end do<a name='552'>
else if (its .eq. ids .and. ite .eq. ide) then<a name='553'>
  do j = jts, jtf<a name='554'>
    do i = its+1, itf-1<a name='555'>
      g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='556'>
      muu(i,j) = 0.5*(mu(i,j)+mu(i-1,j))<a name='557'>
    end do<a name='558'>
  end do<a name='559'>
  i = its<a name='560'>
  im = its<a name='561'>
  if (config_flags%periodic_x) then<a name='562'>
    im = its-1<a name='563'>
  endif<a name='564'>
  do j = jts, jtf<a name='565'>
    g_muu(i,j) = 0.5*g_mu(i,j)+0.5*g_mu(im,j)<a name='566'>
    muu(i,j) = 0.5*(mu(i,j)+mu(im,j))<a name='567'>
  end do<a name='568'>
  i = ite<a name='569'>
  im = ite-1<a name='570'>
  if (config_flags%periodic_x) then<a name='571'>
    im = ite<a name='572'>
  endif<a name='573'>
  do j = jts, jtf<a name='574'>
    g_muu(i,j) = 0.5*g_mu(i-1,j)+0.5*g_mu(im,j)<a name='575'>
    muu(i,j) = 0.5*(mu(i-1,j)+mu(im,j))<a name='576'>
  end do<a name='577'>
endif<a name='578'>
itf = min(ite,ide-1)<a name='579'>
jtf = jte<a name='580'>
if (jts .ne. jds .and. jte .ne. jde) then<a name='581'>
  do j = jts, jtf<a name='582'>
    do i = its, itf<a name='583'>
      g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='584'>
      muv(i,j) = 0.5*(mu(i,j)+mu(i,j-1))<a name='585'>
    end do<a name='586'>
  end do<a name='587'>
else if (jts .eq. jds .and. jte .ne. jde) then<a name='588'>
  do j = jts+1, jtf<a name='589'>
    do i = its, itf<a name='590'>
      g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='591'>
      muv(i,j) = 0.5*(mu(i,j)+mu(i,j-1))<a name='592'>
    end do<a name='593'>
  end do<a name='594'>
  j = jts<a name='595'>
  jm = jts<a name='596'>
  if (config_flags%periodic_y) then<a name='597'>
    jm = jts-1<a name='598'>
  endif<a name='599'>
  do i = its, itf<a name='600'>
    g_muv(i,j) = 0.5*g_mu(i,j)+0.5*g_mu(i,jm)<a name='601'>
    muv(i,j) = 0.5*(mu(i,j)+mu(i,jm))<a name='602'>
  end do<a name='603'>
else if (jts .ne. jds .and. jte .eq. jde) then<a name='604'>
  do j = jts, jtf-1<a name='605'>
    do i = its, itf<a name='606'>
      g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='607'>
      muv(i,j) = 0.5*(mu(i,j)+mu(i,j-1))<a name='608'>
    end do<a name='609'>
  end do<a name='610'>
  j = jte<a name='611'>
  jm = jte-1<a name='612'>
  if (config_flags%periodic_y) then<a name='613'>
    jm = jte<a name='614'>
  endif<a name='615'>
  do i = its, itf<a name='616'>
    g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,jm)<a name='617'>
    muv(i,j) = 0.5*(mu(i,j-1)+mu(i,jm))<a name='618'>
  end do<a name='619'>
else if (jts .eq. jds .and. jte .eq. jde) then<a name='620'>
  do j = jts+1, jtf-1<a name='621'>
    do i = its, itf<a name='622'>
      g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='623'>
      muv(i,j) = 0.5*(mu(i,j)+mu(i,j-1))<a name='624'>
    end do<a name='625'>
  end do<a name='626'>
  j = jts<a name='627'>
  jm = jts<a name='628'>
  if (config_flags%periodic_y) then<a name='629'>
    jm = jts-1<a name='630'>
  endif<a name='631'>
  do i = its, itf<a name='632'>
    g_muv(i,j) = 0.5*g_mu(i,j)+0.5*g_mu(i,jm)<a name='633'>
    muv(i,j) = 0.5*(mu(i,j)+mu(i,jm))<a name='634'>
  end do<a name='635'>
  j = jte<a name='636'>
  jm = jte-1<a name='637'>
  if (config_flags%periodic_y) then<a name='638'>
    jm = jte<a name='639'>
  endif<a name='640'>
  do i = its, itf<a name='641'>
    g_muv(i,j) = 0.5*g_mu(i,j-1)+0.5*g_mu(i,jm)<a name='642'>
    muv(i,j) = 0.5*(mu(i,j-1)+mu(i,jm))<a name='643'>
  end do<a name='644'>
endif<a name='645'>
<a name='646'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_MU_UV_1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_49">("g_calc_mu_uv_1")<a name='647'>
<a name='648'>
end subroutine g_calc_mu_uv_1<a name='649'>
<a name='650'>
<a name='651'>
<A NAME='G_CALC_P_RHO_PHI'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_P_RHO_PHI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='652'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_p_rho_phi</font>( moist, g_moist, n_moist, al, g_al, alb, mu, g_mu, muts, g_muts, ph, g_ph, p, g_p, pb, t, g_t, p0, t0, &amp; <A href='../../call_to/G_CALC_P_RHO_PHI.html' TARGET='index'>4</A>,<A href='../../call_from/G_CALC_P_RHO_PHI.html' TARGET='index'>2</A><a name='653'>
&amp;dnw, rdnw, rdn, non_hydrostatic, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='654'>
<font color=#447700>!******************************************************************<a name='655'></font>
<font color=#447700>!******************************************************************<a name='656'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='657'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='658'></font>
<font color=#447700>!******************************************************************<a name='659'></font>
<font color=#447700>!******************************************************************<a name='660'></font>
<font color=#447700>!==============================================<a name='661'></font>
<font color=#447700>! all entries are defined explicitly<a name='662'></font>
<font color=#447700>!==============================================<a name='663'></font>
implicit none<a name='664'>
<a name='665'>
<font color=#447700>!==============================================<a name='666'></font>
<font color=#447700>! declare arguments<a name='667'></font>
<font color=#447700>!==============================================<a name='668'></font>
integer, intent(in) :: ime<a name='669'>
integer, intent(in) :: ims<a name='670'>
integer, intent(in) :: jme<a name='671'>
integer, intent(in) :: jms<a name='672'>
integer, intent(in) :: kme<a name='673'>
integer, intent(in) :: kms<a name='674'>
real, intent(out) :: al(ims:ime,kms:kme,jms:jme)<a name='675'>
real, intent(in) :: alb(ims:ime,kms:kme,jms:jme)<a name='676'>
real, intent(in) :: dnw(kms:kme)<a name='677'>
real, intent(out) :: g_al(ims:ime,kms:kme,jms:jme)<a name='678'>
integer, intent(in) :: n_moist<a name='679'>
real, intent(in) :: g_moist(ims:ime,kms:kme,jms:jme,n_moist)<a name='680'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='681'>
real, intent(in) :: g_muts(ims:ime,jms:jme)<a name='682'>
real, intent(out) :: g_p(ims:ime,kms:kme,jms:jme)<a name='683'>
real, intent(inout) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='684'>
real, intent(in) :: g_t(ims:ime,kms:kme,jms:jme)<a name='685'>
integer, intent(in) :: ide<a name='686'>
integer, intent(in) :: ite<a name='687'>
integer, intent(in) :: its<a name='688'>
integer, intent(in) :: jde<a name='689'>
integer, intent(in) :: jte<a name='690'>
integer, intent(in) :: jts<a name='691'>
integer, intent(in) :: kde<a name='692'>
integer, intent(in) :: kte<a name='693'>
integer, intent(in) :: kts<a name='694'>
real, intent(in) :: moist(ims:ime,kms:kme,jms:jme,n_moist)<a name='695'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='696'>
real, intent(in) :: muts(ims:ime,jms:jme)<a name='697'>
logical, intent(in) :: non_hydrostatic<a name='698'>
real, intent(out) :: p(ims:ime,kms:kme,jms:jme)<a name='699'>
real, intent(in) :: p0<a name='700'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='701'>
real, intent(inout) :: ph(ims:ime,kms:kme,jms:jme)<a name='702'>
real, intent(in) :: rdn(kms:kme)<a name='703'>
real, intent(in) :: rdnw(kms:kme)<a name='704'>
real, intent(in) :: t(ims:ime,kms:kme,jms:jme)<a name='705'>
real, intent(in) :: t0<a name='706'>
<a name='707'>
<font color=#447700>!==============================================<a name='708'></font>
<font color=#447700>! declare local variables<a name='709'></font>
<font color=#447700>!==============================================<a name='710'></font>
real g_qf1<a name='711'>
real g_qf2<a name='712'>
real g_qtot<a name='713'>
real g_qvf<a name='714'>
integer i<a name='715'>
integer ispe<a name='716'>
integer itf<a name='717'>
integer j<a name='718'>
integer jtf<a name='719'>
integer k<a name='720'>
integer ktf<a name='721'>
real qf1<a name='722'>
real qf2<a name='723'>
real qtot<a name='724'>
real qvf<a name='725'>
<a name='726'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_P_RHO_PHI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_50">("g_calc_p_rho_phi")<a name='727'>
<a name='728'>
<font color=#447700>!----------------------------------------------<a name='729'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='730'></font>
<font color=#447700>!----------------------------------------------<a name='731'></font>
itf = min(ite,ide-1)<a name='732'>
jtf = min(jte,jde-1)<a name='733'>
ktf = min(kte,kde-1)<a name='734'>
if (non_hydrostatic) then<a name='735'>
  if (n_moist .ge. param_first_scalar) then<a name='736'>
    do j = jts, jtf<a name='737'>
      do k = kts, ktf<a name='738'>
        do i = its, itf<a name='739'>
          g_qvf = g_moist(i,k,j,p_qv)*rvovrd<a name='740'>
          qvf = 1.+rvovrd*moist(i,k,j,p_qv)<a name='741'>
          g_al(i,k,j) = (-(g_mu(i,j)*1./muts(i,j)*alb(i,k,j)))+g_muts(i,j)/(muts(i,j)*muts(i,j))*(alb(i,k,j)*mu(i,j)+rdnw(k)*(ph(i,&amp;<a name='742'>
&amp;k+1,j)-ph(i,k,j)))-g_ph(i,k+1,j)*1./muts(i,j)*rdnw(k)+g_ph(i,k,j)*1./muts(i,j)*rdnw(k)<a name='743'>
          al(i,k,j) = -(1./muts(i,j)*(alb(i,k,j)*mu(i,j)+rdnw(k)*(ph(i,k+1,j)-ph(i,k,j))))<a name='744'>
          g_p(i,k,j) = (-(g_al(i,k,j)*r_d*(t0+t(i,k,j))*qvf*p0/(p0*(al(i,k,j)+alb(i,k,j))*p0*(al(i,k,j)+alb(i,k,j)))*cpovcv*(r_d*&amp;<a name='745'>
&amp;(t0+t(i,k,j))*qvf/(p0*(al(i,k,j)+alb(i,k,j))))**(cpovcv-1)*p0))+g_qvf*r_d*(t0+t(i,k,j))/(p0*(al(i,k,j)+alb(i,k,j)))*&amp;<a name='746'>
&amp;cpovcv*(r_d*(t0+t(i,k,j))*qvf/(p0*(al(i,k,j)+alb(i,k,j))))**(cpovcv-1)*p0+g_t(i,k,j)*r_d*qvf/(p0*(al(i,k,j)+alb(i,k,j)))&amp;<a name='747'>
&amp;*cpovcv*(r_d*(t0+t(i,k,j))*qvf/(p0*(al(i,k,j)+alb(i,k,j))))**(cpovcv-1)*p0<a name='748'>
          p(i,k,j) = (r_d*(t0+t(i,k,j))*qvf/(p0*(al(i,k,j)+alb(i,k,j))))**cpovcv*p0-pb(i,k,j)<a name='749'>
        end do<a name='750'>
      end do<a name='751'>
    end do<a name='752'>
  else<a name='753'>
    do j = jts, jtf<a name='754'>
      do k = kts, ktf<a name='755'>
        do i = its, itf<a name='756'>
          g_al(i,k,j) = (-(g_mu(i,j)*1./muts(i,j)*alb(i,k,j)))+g_muts(i,j)/(muts(i,j)*muts(i,j))*(alb(i,k,j)*mu(i,j)+rdnw(k)*(ph(i,&amp;<a name='757'>
&amp;k+1,j)-ph(i,k,j)))-g_ph(i,k+1,j)*1./muts(i,j)*rdnw(k)+g_ph(i,k,j)*1./muts(i,j)*rdnw(k)<a name='758'>
          al(i,k,j) = -(1./muts(i,j)*(alb(i,k,j)*mu(i,j)+rdnw(k)*(ph(i,k+1,j)-ph(i,k,j))))<a name='759'>
          g_p(i,k,j) = (-(g_al(i,k,j)*p0*r_d*(t0+t(i,k,j))*p0/(p0*(al(i,k,j)+alb(i,k,j))*p0*(al(i,k,j)+alb(i,k,j)))*cpovcv*(r_d*&amp;<a name='760'>
&amp;(t0+t(i,k,j))/(p0*(al(i,k,j)+alb(i,k,j))))**(cpovcv-1)))+g_t(i,k,j)*p0*r_d/(p0*(al(i,k,j)+alb(i,k,j)))*cpovcv*(r_d*(t0+&amp;<a name='761'>
&amp;t(i,k,j))/(p0*(al(i,k,j)+alb(i,k,j))))**(cpovcv-1)<a name='762'>
          p(i,k,j) = p0*(r_d*(t0+t(i,k,j))/(p0*(al(i,k,j)+alb(i,k,j))))**cpovcv-pb(i,k,j)<a name='763'>
        end do<a name='764'>
      end do<a name='765'>
    end do<a name='766'>
  endif<a name='767'>
else<a name='768'>
  if (n_moist .ge. param_first_scalar) then<a name='769'>
    do j = jts, jtf<a name='770'>
      k = ktf<a name='771'>
      do i = its, itf<a name='772'>
        g_qtot = 0.<a name='773'>
        qtot = 0.<a name='774'>
        do ispe = param_first_scalar, n_moist<a name='775'>
          g_qtot = g_moist(i,k,j,ispe)+g_qtot<a name='776'>
          qtot = qtot+moist(i,k,j,ispe)<a name='777'>
        end do<a name='778'>
        g_qf2 = -(g_qtot/((1.+qtot)*(1.+qtot)))<a name='779'>
        qf2 = 1./(1.+qtot)<a name='780'>
        g_qf1 = g_qf2*qtot+g_qtot*qf2<a name='781'>
        qf1 = qtot*qf2<a name='782'>
        g_p(i,k,j) = (-(g_mu(i,j)*(0.5/rdnw(k)/qf2)))-g_muts(i,j)*(0.5*qf1/rdnw(k)/qf2)-g_qf1*(0.5*muts(i,j)/rdnw(k)/qf2)+g_qf2*&amp;<a name='783'>
&amp;(0.5*(mu(i,j)+qf1*muts(i,j))/rdnw(k)/(qf2*qf2))<a name='784'>
        p(i,k,j) = -(0.5*(mu(i,j)+qf1*muts(i,j))/rdnw(k)/qf2)<a name='785'>
        g_qvf = g_moist(i,k,j,p_qv)*rvovrd<a name='786'>
        qvf = 1.+rvovrd*moist(i,k,j,p_qv)<a name='787'>
        g_al(i,k,j) = g_p(i,k,j)*r_d/p1000mb*(t(i,k,j)+t0)*qvf/p1000mb*cvpm*((p(i,k,j)+pb(i,k,j))/p1000mb)**(cvpm-1)+g_qvf*r_d/&amp;<a name='788'>
&amp;p1000mb*(t(i,k,j)+t0)*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm+g_t(i,k,j)*r_d/p1000mb*qvf*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm<a name='789'>
        al(i,k,j) = r_d/p1000mb*(t(i,k,j)+t0)*qvf*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm-alb(i,k,j)<a name='790'>
      end do<a name='791'>
      do k = ktf-1, kts, -1<a name='792'>
        do i = its, itf<a name='793'>
          g_qtot = 0.<a name='794'>
          qtot = 0.<a name='795'>
          do ispe = param_first_scalar, n_moist<a name='796'>
            g_qtot = 0.5*g_moist(i,k+1,j,ispe)+0.5*g_moist(i,k,j,ispe)+g_qtot<a name='797'>
            qtot = qtot+0.5*(moist(i,k,j,ispe)+moist(i,k+1,j,ispe))<a name='798'>
          end do<a name='799'>
          g_qf2 = -(g_qtot/((1.+qtot)*(1.+qtot)))<a name='800'>
          qf2 = 1./(1.+qtot)<a name='801'>
          g_qf1 = g_qf2*qtot+g_qtot*qf2<a name='802'>
          qf1 = qtot*qf2<a name='803'>
          g_p(i,k,j) = (-(g_mu(i,j)*(1/qf2/rdn(k+1))))-g_muts(i,j)*(qf1/qf2/rdn(k+1))+g_p(i,k+1,j)-g_qf1*(muts(i,j)/qf2/rdn(k+1))+&amp;<a name='804'>
&amp;g_qf2*((mu(i,j)+qf1*muts(i,j))/(qf2*qf2)/rdn(k+1))<a name='805'>
          p(i,k,j) = p(i,k+1,j)-(mu(i,j)+qf1*muts(i,j))/qf2/rdn(k+1)<a name='806'>
          g_qvf = g_moist(i,k,j,p_qv)*rvovrd<a name='807'>
          qvf = 1.+rvovrd*moist(i,k,j,p_qv)<a name='808'>
          g_al(i,k,j) = g_p(i,k,j)*r_d/p1000mb*(t(i,k,j)+t0)*qvf/p1000mb*cvpm*((p(i,k,j)+pb(i,k,j))/p1000mb)**(cvpm-1)+g_qvf*r_d/&amp;<a name='809'>
&amp;p1000mb*(t(i,k,j)+t0)*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm+g_t(i,k,j)*r_d/p1000mb*qvf*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm<a name='810'>
          al(i,k,j) = r_d/p1000mb*(t(i,k,j)+t0)*qvf*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm-alb(i,k,j)<a name='811'>
        end do<a name='812'>
      end do<a name='813'>
      do k = 2, ktf+1<a name='814'>
        do i = its, itf<a name='815'>
          g_ph(i,k,j) = (-(g_al(i,k-1,j)*dnw(k-1)*muts(i,j)))-g_mu(i,j)*dnw(k-1)*alb(i,k-1,j)-g_muts(i,j)*dnw(k-1)*al(i,k-1,j)+&amp;<a name='816'>
&amp;g_ph(i,k-1,j)<a name='817'>
          ph(i,k,j) = ph(i,k-1,j)-dnw(k-1)*(muts(i,j)*al(i,k-1,j)+mu(i,j)*alb(i,k-1,j))<a name='818'>
        end do<a name='819'>
      end do<a name='820'>
    end do<a name='821'>
  else<a name='822'>
    do j = jts, jtf<a name='823'>
      k = ktf<a name='824'>
      do i = its, itf<a name='825'>
        g_qtot = 0.<a name='826'>
        qtot = 0.<a name='827'>
        g_qf2 = -(g_qtot/((1.+qtot)*(1.+qtot)))<a name='828'>
        qf2 = 1./(1.+qtot)<a name='829'>
        g_qf1 = g_qf2*qtot+g_qtot*qf2<a name='830'>
        qf1 = qtot*qf2<a name='831'>
        g_p(i,k,j) = (-(g_mu(i,j)*(0.5/rdnw(k)/qf2)))-g_muts(i,j)*(0.5*qf1/rdnw(k)/qf2)-g_qf1*(0.5*muts(i,j)/rdnw(k)/qf2)+g_qf2*&amp;<a name='832'>
&amp;(0.5*(mu(i,j)+qf1*muts(i,j))/rdnw(k)/(qf2*qf2))<a name='833'>
        p(i,k,j) = -(0.5*(mu(i,j)+qf1*muts(i,j))/rdnw(k)/qf2)<a name='834'>
        g_qvf = 0.<a name='835'>
        qvf = 1.<a name='836'>
        g_al(i,k,j) = g_p(i,k,j)*r_d/p1000mb*(t(i,k,j)+t0)*qvf/p1000mb*cvpm*((p(i,k,j)+pb(i,k,j))/p1000mb)**(cvpm-1)+g_qvf*r_d/&amp;<a name='837'>
&amp;p1000mb*(t(i,k,j)+t0)*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm+g_t(i,k,j)*r_d/p1000mb*qvf*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm<a name='838'>
        al(i,k,j) = r_d/p1000mb*(t(i,k,j)+t0)*qvf*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm-alb(i,k,j)<a name='839'>
      end do<a name='840'>
      do k = ktf-1, kts, -1<a name='841'>
        do i = its, itf<a name='842'>
          g_qtot = 0.<a name='843'>
          qtot = 0.<a name='844'>
          g_qf2 = -(g_qtot/((1.+qtot)*(1.+qtot)))<a name='845'>
          qf2 = 1./(1.+qtot)<a name='846'>
          g_qf1 = g_qf2*qtot+g_qtot*qf2<a name='847'>
          qf1 = qtot*qf2<a name='848'>
          g_p(i,k,j) = (-(g_mu(i,j)*(1/qf2/rdn(k+1))))-g_muts(i,j)*(qf1/qf2/rdn(k+1))+g_p(i,k+1,j)-g_qf1*(muts(i,j)/qf2/rdn(k+1))+&amp;<a name='849'>
&amp;g_qf2*((mu(i,j)+qf1*muts(i,j))/(qf2*qf2)/rdn(k+1))<a name='850'>
          p(i,k,j) = p(i,k+1,j)-(mu(i,j)+qf1*muts(i,j))/qf2/rdn(k+1)<a name='851'>
          g_qvf = 0.<a name='852'>
          qvf = 1.<a name='853'>
          g_al(i,k,j) = g_p(i,k,j)*r_d/p1000mb*(t(i,k,j)+t0)*qvf/p1000mb*cvpm*((p(i,k,j)+pb(i,k,j))/p1000mb)**(cvpm-1)+g_qvf*r_d/&amp;<a name='854'>
&amp;p1000mb*(t(i,k,j)+t0)*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm+g_t(i,k,j)*r_d/p1000mb*qvf*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm<a name='855'>
          al(i,k,j) = r_d/p1000mb*(t(i,k,j)+t0)*qvf*((p(i,k,j)+pb(i,k,j))/p1000mb)**cvpm-alb(i,k,j)<a name='856'>
        end do<a name='857'>
      end do<a name='858'>
      do k = 2, ktf+1<a name='859'>
        do i = its, itf<a name='860'>
          g_ph(i,k,j) = (-(g_al(i,k-1,j)*dnw(k-1)*muts(i,j)))-g_mu(i,j)*dnw(k-1)*alb(i,k-1,j)-g_muts(i,j)*dnw(k-1)*al(i,k-1,j)+&amp;<a name='861'>
&amp;g_ph(i,k-1,j)<a name='862'>
          ph(i,k,j) = ph(i,k-1,j)-dnw(k-1)*(muts(i,j)*al(i,k-1,j)+mu(i,j)*alb(i,k-1,j))<a name='863'>
        end do<a name='864'>
      end do<a name='865'>
    end do<a name='866'>
  endif<a name='867'>
endif<a name='868'>
<a name='869'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_P_RHO_PHI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_50">("g_calc_p_rho_phi")<a name='870'>
<a name='871'>
end subroutine g_calc_p_rho_phi<a name='872'>
<a name='873'>
<a name='874'>
<A NAME='G_CALC_PHP'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_PHP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='875'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_php</font>( php, g_php, ph, g_ph, phb, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte ) <A href='../../call_to/G_CALC_PHP.html' TARGET='index'>1</A>,<A href='../../call_from/G_CALC_PHP.html' TARGET='index'>2</A><a name='876'>
<font color=#447700>!******************************************************************<a name='877'></font>
<font color=#447700>!******************************************************************<a name='878'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='879'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='880'></font>
<font color=#447700>!******************************************************************<a name='881'></font>
<font color=#447700>!******************************************************************<a name='882'></font>
<font color=#447700>!==============================================<a name='883'></font>
<font color=#447700>! all entries are defined explicitly<a name='884'></font>
<font color=#447700>!==============================================<a name='885'></font>
implicit none<a name='886'>
<a name='887'>
<font color=#447700>!==============================================<a name='888'></font>
<font color=#447700>! declare arguments<a name='889'></font>
<font color=#447700>!==============================================<a name='890'></font>
integer, intent(in) :: ime<a name='891'>
integer, intent(in) :: ims<a name='892'>
integer, intent(in) :: jme<a name='893'>
integer, intent(in) :: jms<a name='894'>
integer, intent(in) :: kme<a name='895'>
integer, intent(in) :: kms<a name='896'>
real, intent(in) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='897'>
real, intent(out) :: g_php(ims:ime,kms:kme,jms:jme)<a name='898'>
integer, intent(in) :: ide<a name='899'>
integer, intent(in) :: ite<a name='900'>
integer, intent(in) :: its<a name='901'>
integer, intent(in) :: jde<a name='902'>
integer, intent(in) :: jte<a name='903'>
integer, intent(in) :: jts<a name='904'>
integer, intent(in) :: kde<a name='905'>
integer, intent(in) :: kte<a name='906'>
integer, intent(in) :: kts<a name='907'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='908'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='909'>
real, intent(out) :: php(ims:ime,kms:kme,jms:jme)<a name='910'>
<a name='911'>
<font color=#447700>!==============================================<a name='912'></font>
<font color=#447700>! declare local variables<a name='913'></font>
<font color=#447700>!==============================================<a name='914'></font>
integer i<a name='915'>
integer itf<a name='916'>
integer j<a name='917'>
integer jtf<a name='918'>
integer k<a name='919'>
integer ktf<a name='920'>
<a name='921'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_PHP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_51">("g_calc_php")<a name='922'>
<a name='923'>
<font color=#447700>!----------------------------------------------<a name='924'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='925'></font>
<font color=#447700>!----------------------------------------------<a name='926'></font>
itf = min(ite,ide-1)<a name='927'>
jtf = min(jte,jde-1)<a name='928'>
ktf = min(kte,kde-1)<a name='929'>
do j = jts, jtf<a name='930'>
  do k = kts, ktf<a name='931'>
    do i = its, itf<a name='932'>
      g_php(i,k,j) = 0.5*g_ph(i,k+1,j)+0.5*g_ph(i,k,j)<a name='933'>
      php(i,k,j) = 0.5*(phb(i,k,j)+phb(i,k+1,j)+ph(i,k,j)+ph(i,k+1,j))<a name='934'>
    end do<a name='935'>
  end do<a name='936'>
end do<a name='937'>
<a name='938'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_PHP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_51">("g_calc_php")<a name='939'>
<a name='940'>
end subroutine g_calc_php<a name='941'>
<a name='942'>
<a name='943'>
<A NAME='G_CALC_WW_CP'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_WW_CP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='944'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calc_ww_cp</font>( u, g_u, v, g_v, mup, g_mup, mub, ww, g_ww, rdx, rdy, msft, msfu, msfv, dnw, ide, jde, kde, ims, ime, jms, &amp; <A href='../../call_to/G_CALC_WW_CP.html' TARGET='index'>1</A>,<A href='../../call_from/G_CALC_WW_CP.html' TARGET='index'>2</A><a name='945'>
&amp;jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='946'>
<font color=#447700>!******************************************************************<a name='947'></font>
<font color=#447700>!******************************************************************<a name='948'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='949'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='950'></font>
<font color=#447700>!******************************************************************<a name='951'></font>
<font color=#447700>!******************************************************************<a name='952'></font>
<font color=#447700>!==============================================<a name='953'></font>
<font color=#447700>! all entries are defined explicitly<a name='954'></font>
<font color=#447700>!==============================================<a name='955'></font>
implicit none<a name='956'>
<a name='957'>
<font color=#447700>!==============================================<a name='958'></font>
<font color=#447700>! declare arguments<a name='959'></font>
<font color=#447700>!==============================================<a name='960'></font>
integer, intent(in) :: kme<a name='961'>
integer, intent(in) :: kms<a name='962'>
real, intent(in) :: dnw(kms:kme)<a name='963'>
integer, intent(in) :: ime<a name='964'>
integer, intent(in) :: ims<a name='965'>
integer, intent(in) :: jme<a name='966'>
integer, intent(in) :: jms<a name='967'>
real, intent(in) :: g_mup(ims:ime,jms:jme)<a name='968'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='969'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='970'>
real, intent(out) :: g_ww(ims:ime,kms:kme,jms:jme)<a name='971'>
integer, intent(in) :: ide<a name='972'>
integer, intent(in) :: ite<a name='973'>
integer, intent(in) :: its<a name='974'>
integer, intent(in) :: jde<a name='975'>
integer, intent(in) :: jte<a name='976'>
integer, intent(in) :: jts<a name='977'>
integer, intent(in) :: kde<a name='978'>
integer, intent(in) :: kte<a name='979'>
integer, intent(in) :: kts<a name='980'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='981'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='982'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='983'>
real, intent(in) :: mub(ims:ime,jms:jme)<a name='984'>
real, intent(in) :: mup(ims:ime,jms:jme)<a name='985'>
real, intent(in) :: rdx<a name='986'>
real, intent(in) :: rdy<a name='987'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='988'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='989'>
real, intent(out) :: ww(ims:ime,kms:kme,jms:jme)<a name='990'>
<a name='991'>
<font color=#447700>!==============================================<a name='992'></font>
<font color=#447700>! declare local variables<a name='993'></font>
<font color=#447700>!==============================================<a name='994'></font>
real divv(its:ite,kts:kte)<a name='995'>
real dmdt(its:ite)<a name='996'>
real g_divv(its:ite,kts:kte)<a name='997'>
real g_dmdt(its:ite)<a name='998'>
real g_muu(its:ite+1,jts:jte+1)<a name='999'>
real g_muv(its:ite+1,jts:jte+1)<a name='1000'>
integer i<a name='1001'>
integer itf<a name='1002'>
integer j<a name='1003'>
integer jtf<a name='1004'>
integer k<a name='1005'>
integer ktf<a name='1006'>
real muu(its:ite+1,jts:jte+1)<a name='1007'>
real muv(its:ite+1,jts:jte+1)<a name='1008'>
<a name='1009'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_WW_CP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_52">("g_calc_ww_cp")<a name='1010'>
<a name='1011'>
<font color=#447700>!----------------------------------------------<a name='1012'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1013'></font>
<font color=#447700>!----------------------------------------------<a name='1014'></font>
jtf = min(jte,jde-1)<a name='1015'>
ktf = min(kte,kde-1)<a name='1016'>
itf = min(ite,ide-1)<a name='1017'>
do j = jts, jtf<a name='1018'>
  do i = its, min(ite+1,ide)<a name='1019'>
    g_muu(i,j) = (g_mup(i-1,j)+g_mup(i,j))*(0.5/msfu(i,j))<a name='1020'>
    muu(i,j) = 0.5*(mup(i,j)+mub(i,j)+mup(i-1,j)+mub(i-1,j))/msfu(i,j)<a name='1021'>
  end do<a name='1022'>
end do<a name='1023'>
do j = jts, min(jte+1,jde)<a name='1024'>
  do i = its, itf<a name='1025'>
    g_muv(i,j) = (g_mup(i,j-1)+g_mup(i,j))*(0.5/msfv(i,j))<a name='1026'>
    muv(i,j) = 0.5*(mup(i,j)+mub(i,j)+mup(i,j-1)+mub(i,j-1))/msfv(i,j)<a name='1027'>
  end do<a name='1028'>
end do<a name='1029'>
do j = jts, jtf<a name='1030'>
  do i = its, ite<a name='1031'>
    g_dmdt(i) = 0.<a name='1032'>
    dmdt(i) = 0.<a name='1033'>
    g_ww(i,1,j) = 0.<a name='1034'>
    ww(i,1,j) = 0.<a name='1035'>
    g_ww(i,kte,j) = 0.<a name='1036'>
    ww(i,kte,j) = 0.<a name='1037'>
  end do<a name='1038'>
  do k = kts, ktf<a name='1039'>
    do i = its, itf<a name='1040'>
      g_divv(i,k) = g_muu(i+1,j)*msft(i,j)*dnw(k)*rdx*u(i+1,k,j)-g_muu(i,j)*msft(i,j)*dnw(k)*rdx*u(i,k,j)+g_muv(i,j+1)*msft(i,j)*&amp;<a name='1041'>
&amp;dnw(k)*rdy*v(i,k,j+1)-g_muv(i,j)*msft(i,j)*dnw(k)*rdy*v(i,k,j)+g_u(i+1,k,j)*msft(i,j)*dnw(k)*rdx*muu(i+1,j)-g_u(i,k,j)*&amp;<a name='1042'>
&amp;msft(i,j)*dnw(k)*rdx*muu(i,j)+g_v(i,k,j+1)*msft(i,j)*dnw(k)*rdy*muv(i,j+1)-g_v(i,k,j)*msft(i,j)*dnw(k)*rdy*muv(i,j)<a name='1043'>
      divv(i,k) = msft(i,j)*dnw(k)*(rdx*(muu(i+1,j)*u(i+1,k,j)-muu(i,j)*u(i,k,j))+rdy*(muv(i,j+1)*v(i,k,j+1)-muv(i,j)*v(i,k,j)))<a name='1044'>
      g_dmdt(i) = g_divv(i,k)+g_dmdt(i)<a name='1045'>
      dmdt(i) = dmdt(i)+divv(i,k)<a name='1046'>
    end do<a name='1047'>
  end do<a name='1048'>
  do k = 2, ktf<a name='1049'>
    do i = its, itf<a name='1050'>
      g_ww(i,k,j) = (-g_divv(i,k-1))-g_dmdt(i)*dnw(k-1)+g_ww(i,k-1,j)<a name='1051'>
      ww(i,k,j) = ww(i,k-1,j)-dnw(k-1)*dmdt(i)-divv(i,k-1)<a name='1052'>
    end do<a name='1053'>
  end do<a name='1054'>
end do<a name='1055'>
<a name='1056'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_WW_CP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_52">("g_calc_ww_cp")<a name='1057'>
<a name='1058'>
end subroutine g_calc_ww_cp<a name='1059'>
<a name='1060'>
<a name='1061'>
<A NAME='G_CALCULATE_FULL'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALCULATE_FULL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1062'>
<font color=#993300>subroutine </font><font color=#cc0000>g_calculate_full</font>( rfield, g_rfield, rfieldb, rfieldp, g_rfieldp, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, &amp; <A href='../../call_to/G_CALCULATE_FULL.html' TARGET='index'>1</A>,<A href='../../call_from/G_CALCULATE_FULL.html' TARGET='index'>2</A><a name='1063'>
&amp;jts, jte, kts, kte )<a name='1064'>
<font color=#447700>!******************************************************************<a name='1065'></font>
<font color=#447700>!******************************************************************<a name='1066'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1067'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1068'></font>
<font color=#447700>!******************************************************************<a name='1069'></font>
<font color=#447700>!******************************************************************<a name='1070'></font>
<font color=#447700>!==============================================<a name='1071'></font>
<font color=#447700>! all entries are defined explicitly<a name='1072'></font>
<font color=#447700>!==============================================<a name='1073'></font>
implicit none<a name='1074'>
<a name='1075'>
<font color=#447700>!==============================================<a name='1076'></font>
<font color=#447700>! declare arguments<a name='1077'></font>
<font color=#447700>!==============================================<a name='1078'></font>
integer, intent(in) :: ime<a name='1079'>
integer, intent(in) :: ims<a name='1080'>
integer, intent(in) :: jme<a name='1081'>
integer, intent(in) :: jms<a name='1082'>
integer, intent(in) :: kme<a name='1083'>
integer, intent(in) :: kms<a name='1084'>
real, intent(out) :: g_rfield(ims:ime,kms:kme,jms:jme)<a name='1085'>
real, intent(in) :: g_rfieldp(ims:ime,kms:kme,jms:jme)<a name='1086'>
integer, intent(in) :: ide<a name='1087'>
integer, intent(in) :: ite<a name='1088'>
integer, intent(in) :: its<a name='1089'>
integer, intent(in) :: jde<a name='1090'>
integer, intent(in) :: jte<a name='1091'>
integer, intent(in) :: jts<a name='1092'>
integer, intent(in) :: kde<a name='1093'>
integer, intent(in) :: kte<a name='1094'>
integer, intent(in) :: kts<a name='1095'>
real, intent(out) :: rfield(ims:ime,kms:kme,jms:jme)<a name='1096'>
real, intent(in) :: rfieldb(ims:ime,kms:kme,jms:jme)<a name='1097'>
real, intent(in) :: rfieldp(ims:ime,kms:kme,jms:jme)<a name='1098'>
<a name='1099'>
<font color=#447700>!==============================================<a name='1100'></font>
<font color=#447700>! declare local variables<a name='1101'></font>
<font color=#447700>!==============================================<a name='1102'></font>
integer i<a name='1103'>
integer itf<a name='1104'>
integer j<a name='1105'>
integer jtf<a name='1106'>
integer k<a name='1107'>
integer ktf<a name='1108'>
<a name='1109'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALCULATE_FULL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_53">("g_calculate_full")<a name='1110'>
<a name='1111'>
<font color=#447700>!----------------------------------------------<a name='1112'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1113'></font>
<font color=#447700>!----------------------------------------------<a name='1114'></font>
itf = min(ite,ide-1)<a name='1115'>
jtf = min(jte,jde-1)<a name='1116'>
ktf = min(kte,kde-1)<a name='1117'>
do j = jts, jtf<a name='1118'>
  do k = kts, ktf<a name='1119'>
    do i = its, itf<a name='1120'>
      g_rfield(i,k,j) = g_rfieldp(i,k,j)<a name='1121'>
      rfield(i,k,j) = rfieldb(i,k,j)+rfieldp(i,k,j)<a name='1122'>
    end do<a name='1123'>
  end do<a name='1124'>
end do<a name='1125'>
<a name='1126'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALCULATE_FULL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_53">("g_calculate_full")<a name='1127'>
<a name='1128'>
end subroutine g_calculate_full<a name='1129'>
<a name='1130'>
<a name='1131'>
<A NAME='G_CORIOLIS'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CORIOLIS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1132'>
<font color=#993300>subroutine </font><font color=#cc0000>g_coriolis</font>( ru, g_ru, rv, g_rv, rw, g_rw, ru_tend, g_ru_tend, rv_tend, g_rv_tend, rw_tend, g_rw_tend, config_flags, f, &amp; <A href='../../call_to/G_CORIOLIS.html' TARGET='index'>1</A>,<A href='../../call_from/G_CORIOLIS.html' TARGET='index'>2</A><a name='1133'>
&amp;e, sina, cosa, fzm, fzp, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1134'>
<font color=#447700>!******************************************************************<a name='1135'></font>
<font color=#447700>!******************************************************************<a name='1136'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1137'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1138'></font>
<font color=#447700>!******************************************************************<a name='1139'></font>
<font color=#447700>!******************************************************************<a name='1140'></font>
<font color=#447700>!==============================================<a name='1141'></font>
<font color=#447700>! all entries are defined explicitly<a name='1142'></font>
<font color=#447700>!==============================================<a name='1143'></font>
implicit none<a name='1144'>
<a name='1145'>
<font color=#447700>!==============================================<a name='1146'></font>
<font color=#447700>! declare arguments<a name='1147'></font>
<font color=#447700>!==============================================<a name='1148'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='1149'>
integer, intent(in) :: ime<a name='1150'>
integer, intent(in) :: ims<a name='1151'>
integer, intent(in) :: jme<a name='1152'>
integer, intent(in) :: jms<a name='1153'>
real, intent(in) :: cosa(ims:ime,jms:jme)<a name='1154'>
real, intent(in) :: e(ims:ime,jms:jme)<a name='1155'>
real, intent(in) :: f(ims:ime,jms:jme)<a name='1156'>
integer, intent(in) :: kme<a name='1157'>
integer, intent(in) :: kms<a name='1158'>
real, intent(in) :: fzm(kms:kme)<a name='1159'>
real, intent(in) :: fzp(kms:kme)<a name='1160'>
real, intent(in) :: g_ru(ims:ime,kms:kme,jms:jme)<a name='1161'>
real, intent(inout) :: g_ru_tend(ims:ime,kms:kme,jms:jme)<a name='1162'>
real, intent(in) :: g_rv(ims:ime,kms:kme,jms:jme)<a name='1163'>
real, intent(inout) :: g_rv_tend(ims:ime,kms:kme,jms:jme)<a name='1164'>
real, intent(in) :: g_rw(ims:ime,kms:kme,jms:jme)<a name='1165'>
real, intent(inout) :: g_rw_tend(ims:ime,kms:kme,jms:jme)<a name='1166'>
integer, intent(in) :: ide<a name='1167'>
integer, intent(in) :: ids<a name='1168'>
integer, intent(in) :: ite<a name='1169'>
integer, intent(in) :: its<a name='1170'>
integer, intent(in) :: jde<a name='1171'>
integer, intent(in) :: jds<a name='1172'>
integer, intent(in) :: jte<a name='1173'>
integer, intent(in) :: jts<a name='1174'>
integer, intent(in) :: kde<a name='1175'>
integer, intent(in) :: kte<a name='1176'>
integer, intent(in) :: kts<a name='1177'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='1178'>
real, intent(inout) :: ru_tend(ims:ime,kms:kme,jms:jme)<a name='1179'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='1180'>
real, intent(inout) :: rv_tend(ims:ime,kms:kme,jms:jme)<a name='1181'>
real, intent(in) :: rw(ims:ime,kms:kme,jms:jme)<a name='1182'>
real, intent(inout) :: rw_tend(ims:ime,kms:kme,jms:jme)<a name='1183'>
real, intent(in) :: sina(ims:ime,jms:jme)<a name='1184'>
<a name='1185'>
<font color=#447700>!==============================================<a name='1186'></font>
<font color=#447700>! declare local variables<a name='1187'></font>
<font color=#447700>!==============================================<a name='1188'></font>
integer i<a name='1189'>
integer i_end<a name='1190'>
integer i_start<a name='1191'>
integer j<a name='1192'>
integer j_end<a name='1193'>
integer j_start<a name='1194'>
integer k<a name='1195'>
integer ktf<a name='1196'>
logical specified<a name='1197'>
<a name='1198'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CORIOLIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_54">("g_coriolis")<a name='1199'>
<a name='1200'>
<font color=#447700>!----------------------------------------------<a name='1201'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1202'></font>
<font color=#447700>!----------------------------------------------<a name='1203'></font>
specified =  .false. <a name='1204'>
if (config_flags%specified .or. config_flags%nested) then<a name='1205'>
  specified =  .true. <a name='1206'>
endif<a name='1207'>
ktf = min(kte,kde-1)<a name='1208'>
i_start = its<a name='1209'>
i_end = ite<a name='1210'>
if (config_flags%open_xs .or. specified .or. config_flags%nested) then<a name='1211'>
  i_start = max(ids+1,its)<a name='1212'>
endif<a name='1213'>
if (config_flags%open_xe .or. specified .or. config_flags%nested) then<a name='1214'>
  i_end = min(ide-1,ite)<a name='1215'>
endif<a name='1216'>
do j = jts, min(jte,jde-1)<a name='1217'>
  do k = kts, ktf<a name='1218'>
    do i = i_start, i_end<a name='1219'>
      g_ru_tend(i,k,j) = g_ru_tend(i,k,j)+0.125*g_rv(i-1,k,j+1)*(f(i,j)+f(i-1,j))+0.125*g_rv(i,k,j+1)*(f(i,j)+f(i-1,j))+0.125*&amp;<a name='1220'>
&amp;g_rv(i-1,k,j)*(f(i,j)+f(i-1,j))+0.125*g_rv(i,k,j)*(f(i,j)+f(i-1,j))-0.0625*g_rw(i-1,k+1,j)*(e(i,j)+e(i-1,j))*(cosa(i,j)+&amp;<a name='1221'>
&amp;cosa(i-1,j))-0.0625*g_rw(i,k+1,j)*(e(i,j)+e(i-1,j))*(cosa(i,j)+cosa(i-1,j))-0.0625*g_rw(i-1,k,j)*(e(i,j)+e(i-1,j))*(cosa(i,&amp;<a name='1222'>
&amp;j)+cosa(i-1,j))-0.0625*g_rw(i,k,j)*(e(i,j)+e(i-1,j))*(cosa(i,j)+cosa(i-1,j))<a name='1223'>
      ru_tend(i,k,j) = ru_tend(i,k,j)+0.5*(f(i,j)+f(i-1,j))*0.25*(rv(i-1,k,j+1)+rv(i,k,j+1)+rv(i-1,k,j)+rv(i,k,j))-0.5*(e(i,j)+e(i-&amp;<a name='1224'>
&amp;1,j))*0.5*(cosa(i,j)+cosa(i-1,j))*0.25*(rw(i-1,k+1,j)+rw(i-1,k,j)+rw(i,k+1,j)+rw(i,k,j))<a name='1225'>
    end do<a name='1226'>
  end do<a name='1227'>
  if (config_flags%open_xs .and. its .eq. ids) then<a name='1228'>
    do k = kts, ktf<a name='1229'>
      g_ru_tend(its,k,j) = g_ru_tend(its,k,j)+0.5*g_rv(its,k,j+1)*f(its,j)+0.5*g_rv(its,k,j)*f(its,j)-0.5*g_rw(its,k+1,j)*e(its,j)*&amp;<a name='1230'>
&amp;cosa(its,j)-0.5*g_rw(its,k,j)*e(its,j)*cosa(its,j)<a name='1231'>
      ru_tend(its,k,j) = ru_tend(its,k,j)+0.5*(f(its,j)+f(its,j))*0.25*(rv(its,k,j+1)+rv(its,k,j+1)+rv(its,k,j)+rv(its,k,j))-0.5*&amp;<a name='1232'>
&amp;(e(its,j)+e(its,j))*0.5*(cosa(its,j)+cosa(its,j))*0.25*(rw(its,k+1,j)+rw(its,k,j)+rw(its,k+1,j)+rw(its,k,j))<a name='1233'>
    end do<a name='1234'>
  endif<a name='1235'>
  if (config_flags%open_xe .and. ite .eq. ide) then<a name='1236'>
    do k = kts, ktf<a name='1237'>
      g_ru_tend(ite,k,j) = g_ru_tend(ite,k,j)+0.5*g_rv(ite-1,k,j+1)*f(ite-1,j)+0.5*g_rv(ite-1,k,j)*f(ite-1,j)-0.5*g_rw(ite-1,k+1,j)&amp;<a name='1238'>
&amp;*e(ite-1,j)*cosa(ite-1,j)-0.5*g_rw(ite-1,k,j)*e(ite-1,j)*cosa(ite-1,j)<a name='1239'>
      ru_tend(ite,k,j) = ru_tend(ite,k,j)+0.5*(f(ite-1,j)+f(ite-1,j))*0.25*(rv(ite-1,k,j+1)+rv(ite-1,k,j+1)+rv(ite-1,k,j)+rv(ite-1,&amp;<a name='1240'>
&amp;k,j))-0.5*(e(ite-1,j)+e(ite-1,j))*0.5*(cosa(ite-1,j)+cosa(ite-1,j))*0.25*(rw(ite-1,k+1,j)+rw(ite-1,k,j)+rw(ite-1,k+1,j)+&amp;<a name='1241'>
&amp;rw(ite-1,k,j))<a name='1242'>
    end do<a name='1243'>
  endif<a name='1244'>
end do<a name='1245'>
j_start = jts<a name='1246'>
j_end = jte<a name='1247'>
if (config_flags%open_ys .or. specified .or. config_flags%nested) then<a name='1248'>
  j_start = max(jds+1,jts)<a name='1249'>
endif<a name='1250'>
if (config_flags%open_ye .or. specified .or. config_flags%nested) then<a name='1251'>
  j_end = min(jde-1,jte)<a name='1252'>
endif<a name='1253'>
if (config_flags%open_ys .and. jts .eq. jds) then<a name='1254'>
  do k = kts, ktf<a name='1255'>
    do i = its, min(ide-1,ite)<a name='1256'>
      g_rv_tend(i,k,jts) = (-(0.5*g_ru(i+1,k,jts)*f(i,jts)))-0.5*g_ru(i,k,jts)*f(i,jts)+g_rv_tend(i,k,jts)+0.5*g_rw(i,k+1,jts)*e(i,&amp;<a name='1257'>
&amp;jts)*sina(i,jts)+0.5*g_rw(i,k,jts)*e(i,jts)*sina(i,jts)<a name='1258'>
      rv_tend(i,k,jts) = rv_tend(i,k,jts)-0.5*(f(i,jts)+f(i,jts))*0.25*(ru(i,k,jts)+ru(i+1,k,jts)+ru(i,k,jts)+ru(i+1,k,jts))+0.5*&amp;<a name='1259'>
&amp;(e(i,jts)+e(i,jts))*0.5*(sina(i,jts)+sina(i,jts))*0.25*(rw(i,k+1,jts)+rw(i,k,jts)+rw(i,k+1,jts)+rw(i,k,jts))<a name='1260'>
    end do<a name='1261'>
  end do<a name='1262'>
endif<a name='1263'>
do j = j_start, j_end<a name='1264'>
  do k = kts, ktf<a name='1265'>
    do i = its, min(ide-1,ite)<a name='1266'>
      g_rv_tend(i,k,j) = (-(0.125*g_ru(i+1,k,j-1)*(f(i,j)+f(i,j-1))))-0.125*g_ru(i,k,j-1)*(f(i,j)+f(i,j-1))-0.125*g_ru(i+1,k,j)*&amp;<a name='1267'>
&amp;(f(i,j)+f(i,j-1))-0.125*g_ru(i,k,j)*(f(i,j)+f(i,j-1))+g_rv_tend(i,k,j)+0.0625*g_rw(i,k+1,j-1)*(e(i,j)+e(i,j-1))*(sina(i,j)+&amp;<a name='1268'>
&amp;sina(i,j-1))+0.0625*g_rw(i,k+1,j)*(e(i,j)+e(i,j-1))*(sina(i,j)+sina(i,j-1))+0.0625*g_rw(i,k,j-1)*(e(i,j)+e(i,j-1))*(sina(i,&amp;<a name='1269'>
&amp;j)+sina(i,j-1))+0.0625*g_rw(i,k,j)*(e(i,j)+e(i,j-1))*(sina(i,j)+sina(i,j-1))<a name='1270'>
      rv_tend(i,k,j) = rv_tend(i,k,j)-0.5*(f(i,j)+f(i,j-1))*0.25*(ru(i,k,j)+ru(i+1,k,j)+ru(i,k,j-1)+ru(i+1,k,j-1))+0.5*(e(i,j)+e(i,&amp;<a name='1271'>
&amp;j-1))*0.5*(sina(i,j)+sina(i,j-1))*0.25*(rw(i,k+1,j-1)+rw(i,k,j-1)+rw(i,k+1,j)+rw(i,k,j))<a name='1272'>
    end do<a name='1273'>
  end do<a name='1274'>
end do<a name='1275'>
if (config_flags%open_ye .and. jte .eq. jde) then<a name='1276'>
  do k = kts, ktf<a name='1277'>
    do i = its, min(ide-1,ite)<a name='1278'>
      g_rv_tend(i,k,jte) = (-(0.5*g_ru(i+1,k,jte-1)*f(i,jte-1)))-0.5*g_ru(i,k,jte-1)*f(i,jte-1)+g_rv_tend(i,k,jte)+0.5*g_rw(i,k+1,&amp;<a name='1279'>
&amp;jte-1)*e(i,jte-1)*sina(i,jte-1)+0.5*g_rw(i,k,jte-1)*e(i,jte-1)*sina(i,jte-1)<a name='1280'>
      rv_tend(i,k,jte) = rv_tend(i,k,jte)-0.5*(f(i,jte-1)+f(i,jte-1))*0.25*(ru(i,k,jte-1)+ru(i+1,k,jte-1)+ru(i,k,jte-1)+ru(i+1,k,&amp;<a name='1281'>
&amp;jte-1))+0.5*(e(i,jte-1)+e(i,jte-1))*0.5*(sina(i,jte-1)+sina(i,jte-1))*0.25*(rw(i,k+1,jte-1)+rw(i,k,jte-1)+rw(i,k+1,jte-1)+&amp;<a name='1282'>
&amp;rw(i,k,jte-1))<a name='1283'>
    end do<a name='1284'>
  end do<a name='1285'>
endif<a name='1286'>
do j = jts, min(jte,jde-1)<a name='1287'>
  do k = kts+1, ktf<a name='1288'>
    do i = its, min(ite,ide-1)<a name='1289'>
      g_rw_tend(i,k,j) = 0.5*g_ru(i+1,k-1,j)*e(i,j)*cosa(i,j)*fzp(k)+0.5*g_ru(i,k-1,j)*e(i,j)*cosa(i,j)*fzp(k)+0.5*g_ru(i+1,k,j)*&amp;<a name='1290'>
&amp;e(i,j)*cosa(i,j)*fzm(k)+0.5*g_ru(i,k,j)*e(i,j)*cosa(i,j)*fzm(k)-0.5*g_rv(i,k-1,j+1)*e(i,j)*sina(i,j)*fzp(k)-0.5*g_rv(i,k-1,&amp;<a name='1291'>
&amp;j)*e(i,j)*sina(i,j)*fzp(k)-0.5*g_rv(i,k,j+1)*e(i,j)*sina(i,j)*fzm(k)-0.5*g_rv(i,k,j)*e(i,j)*sina(i,j)*fzm(k)+g_rw_tend(i,k,j)<a name='1292'>
      rw_tend(i,k,j) = rw_tend(i,k,j)+e(i,j)*(cosa(i,j)*0.5*(fzm(k)*(ru(i,k,j)+ru(i+1,k,j))+fzp(k)*(ru(i,k-1,j)+ru(i+1,k-1,j)))-&amp;<a name='1293'>
&amp;sina(i,j)*0.5*(fzm(k)*(rv(i,k,j)+rv(i,k,j+1))+fzp(k)*(rv(i,k-1,j)+rv(i,k-1,j+1))))<a name='1294'>
    end do<a name='1295'>
  end do<a name='1296'>
end do<a name='1297'>
<a name='1298'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CORIOLIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_54">("g_coriolis")<a name='1299'>
<a name='1300'>
end subroutine g_coriolis<a name='1301'>
<a name='1302'>
<a name='1303'>
<A NAME='G_COUPLE_MOMENTUM'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_COUPLE_MOMENTUM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1304'>
<font color=#993300>subroutine </font><font color=#cc0000>g_couple_momentum</font>( muu, g_muu, ru, g_ru, u, g_u, msfu, muv, g_muv, rv, g_rv, v, g_v, msfv, mut, g_mut, rw, g_rw, w, g_w,&amp; <A href='../../call_to/G_COUPLE_MOMENTUM.html' TARGET='index'>1</A>,<A href='../../call_from/G_COUPLE_MOMENTUM.html' TARGET='index'>2</A><a name='1305'>
&amp; msft, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1306'>
<font color=#447700>!******************************************************************<a name='1307'></font>
<font color=#447700>!******************************************************************<a name='1308'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1309'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1310'></font>
<font color=#447700>!******************************************************************<a name='1311'></font>
<font color=#447700>!******************************************************************<a name='1312'></font>
<font color=#447700>!==============================================<a name='1313'></font>
<font color=#447700>! all entries are defined explicitly<a name='1314'></font>
<font color=#447700>!==============================================<a name='1315'></font>
implicit none<a name='1316'>
<a name='1317'>
<font color=#447700>!==============================================<a name='1318'></font>
<font color=#447700>! declare arguments<a name='1319'></font>
<font color=#447700>!==============================================<a name='1320'></font>
integer, intent(in) :: ime<a name='1321'>
integer, intent(in) :: ims<a name='1322'>
integer, intent(in) :: jme<a name='1323'>
integer, intent(in) :: jms<a name='1324'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='1325'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='1326'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='1327'>
integer, intent(in) :: kme<a name='1328'>
integer, intent(in) :: kms<a name='1329'>
real, intent(out) :: g_ru(ims:ime,kms:kme,jms:jme)<a name='1330'>
real, intent(out) :: g_rv(ims:ime,kms:kme,jms:jme)<a name='1331'>
real, intent(out) :: g_rw(ims:ime,kms:kme,jms:jme)<a name='1332'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='1333'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='1334'>
real, intent(in) :: g_w(ims:ime,kms:kme,jms:jme)<a name='1335'>
integer, intent(in) :: ide<a name='1336'>
integer, intent(in) :: ite<a name='1337'>
integer, intent(in) :: its<a name='1338'>
integer, intent(in) :: jde<a name='1339'>
integer, intent(in) :: jte<a name='1340'>
integer, intent(in) :: jts<a name='1341'>
integer, intent(in) :: kde<a name='1342'>
integer, intent(in) :: kte<a name='1343'>
integer, intent(in) :: kts<a name='1344'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='1345'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='1346'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='1347'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='1348'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='1349'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='1350'>
real, intent(out) :: ru(ims:ime,kms:kme,jms:jme)<a name='1351'>
real, intent(out) :: rv(ims:ime,kms:kme,jms:jme)<a name='1352'>
real, intent(out) :: rw(ims:ime,kms:kme,jms:jme)<a name='1353'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='1354'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='1355'>
real, intent(in) :: w(ims:ime,kms:kme,jms:jme)<a name='1356'>
<a name='1357'>
<font color=#447700>!==============================================<a name='1358'></font>
<font color=#447700>! declare local variables<a name='1359'></font>
<font color=#447700>!==============================================<a name='1360'></font>
integer i<a name='1361'>
integer itf<a name='1362'>
integer j<a name='1363'>
integer jtf<a name='1364'>
integer k<a name='1365'>
integer ktf<a name='1366'>
<a name='1367'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_COUPLE_MOMENTUM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_55">("g_couple_momentum")<a name='1368'>
<a name='1369'>
<font color=#447700>!----------------------------------------------<a name='1370'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1371'></font>
<font color=#447700>!----------------------------------------------<a name='1372'></font>
ktf = min(kte,kde-1)<a name='1373'>
itf = ite<a name='1374'>
jtf = min(jte,jde-1)<a name='1375'>
do j = jts, jtf<a name='1376'>
  do k = kts, ktf<a name='1377'>
    do i = its, itf<a name='1378'>
      g_ru(i,k,j) = g_muu(i,j)*(u(i,k,j)/msfu(i,j))+g_u(i,k,j)*(muu(i,j)/msfu(i,j))<a name='1379'>
      ru(i,k,j) = u(i,k,j)*muu(i,j)/msfu(i,j)<a name='1380'>
    end do<a name='1381'>
  end do<a name='1382'>
end do<a name='1383'>
itf = min(ite,ide-1)<a name='1384'>
jtf = jte<a name='1385'>
do j = jts, jtf<a name='1386'>
  do k = kts, ktf<a name='1387'>
    do i = its, itf<a name='1388'>
      g_rv(i,k,j) = g_muv(i,j)*(v(i,k,j)/msfv(i,j))+g_v(i,k,j)*(muv(i,j)/msfv(i,j))<a name='1389'>
      rv(i,k,j) = v(i,k,j)*muv(i,j)/msfv(i,j)<a name='1390'>
    end do<a name='1391'>
  end do<a name='1392'>
end do<a name='1393'>
itf = min(ite,ide-1)<a name='1394'>
jtf = min(jte,jde-1)<a name='1395'>
do j = jts, jtf<a name='1396'>
  do k = kts, kte<a name='1397'>
    do i = its, itf<a name='1398'>
      g_rw(i,k,j) = g_mut(i,j)*(w(i,k,j)/msft(i,j))+g_w(i,k,j)*(mut(i,j)/msft(i,j))<a name='1399'>
      rw(i,k,j) = w(i,k,j)*mut(i,j)/msft(i,j)<a name='1400'>
    end do<a name='1401'>
  end do<a name='1402'>
end do<a name='1403'>
<a name='1404'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_COUPLE_MOMENTUM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_55">("g_couple_momentum")<a name='1405'>
<a name='1406'>
end subroutine g_couple_momentum<a name='1407'>
<a name='1408'>
<a name='1409'>
<A NAME='G_CURVATURE'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CURVATURE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1410'>
<font color=#993300>subroutine </font><font color=#cc0000>g_curvature</font>( ru, g_ru, rv, g_rv, rw, g_rw, u, g_u, v, g_v, ru_tend, g_ru_tend, rv_tend, g_rv_tend, rw_tend, g_rw_tend, &amp; <A href='../../call_to/G_CURVATURE.html' TARGET='index'>1</A>,<A href='../../call_from/G_CURVATURE.html' TARGET='index'>2</A><a name='1411'>
&amp;config_flags, msfu, msfv, fzm, fzp, rdx, rdy, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1412'>
<font color=#447700>!******************************************************************<a name='1413'></font>
<font color=#447700>!******************************************************************<a name='1414'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1415'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1416'></font>
<font color=#447700>!******************************************************************<a name='1417'></font>
<font color=#447700>!******************************************************************<a name='1418'></font>
<font color=#447700>!==============================================<a name='1419'></font>
<font color=#447700>! all entries are defined explicitly<a name='1420'></font>
<font color=#447700>!==============================================<a name='1421'></font>
implicit none<a name='1422'>
<a name='1423'>
<font color=#447700>!==============================================<a name='1424'></font>
<font color=#447700>! declare arguments<a name='1425'></font>
<font color=#447700>!==============================================<a name='1426'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='1427'>
integer, intent(in) :: kme<a name='1428'>
integer, intent(in) :: kms<a name='1429'>
real, intent(in) :: fzm(kms:kme)<a name='1430'>
real, intent(in) :: fzp(kms:kme)<a name='1431'>
integer, intent(in) :: ime<a name='1432'>
integer, intent(in) :: ims<a name='1433'>
integer, intent(in) :: jme<a name='1434'>
integer, intent(in) :: jms<a name='1435'>
real, intent(in) :: g_ru(ims:ime,kms:kme,jms:jme)<a name='1436'>
real, intent(inout) :: g_ru_tend(ims:ime,kms:kme,jms:jme)<a name='1437'>
real, intent(in) :: g_rv(ims:ime,kms:kme,jms:jme)<a name='1438'>
real, intent(inout) :: g_rv_tend(ims:ime,kms:kme,jms:jme)<a name='1439'>
real, intent(in) :: g_rw(ims:ime,kms:kme,jms:jme)<a name='1440'>
real, intent(inout) :: g_rw_tend(ims:ime,kms:kme,jms:jme)<a name='1441'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='1442'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='1443'>
integer, intent(in) :: ide<a name='1444'>
integer, intent(in) :: ids<a name='1445'>
integer, intent(in) :: ite<a name='1446'>
integer, intent(in) :: its<a name='1447'>
integer, intent(in) :: jde<a name='1448'>
integer, intent(in) :: jds<a name='1449'>
integer, intent(in) :: jte<a name='1450'>
integer, intent(in) :: jts<a name='1451'>
integer, intent(in) :: kde<a name='1452'>
integer, intent(in) :: kte<a name='1453'>
integer, intent(in) :: kts<a name='1454'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='1455'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='1456'>
real, intent(in) :: rdx<a name='1457'>
real, intent(in) :: rdy<a name='1458'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='1459'>
real, intent(inout) :: ru_tend(ims:ime,kms:kme,jms:jme)<a name='1460'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='1461'>
real, intent(inout) :: rv_tend(ims:ime,kms:kme,jms:jme)<a name='1462'>
real, intent(in) :: rw(ims:ime,kms:kme,jms:jme)<a name='1463'>
real, intent(inout) :: rw_tend(ims:ime,kms:kme,jms:jme)<a name='1464'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='1465'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='1466'>
<a name='1467'>
<font color=#447700>!==============================================<a name='1468'></font>
<font color=#447700>! declare local variables<a name='1469'></font>
<font color=#447700>!==============================================<a name='1470'></font>
real g_vxgm(its-1:ite,kts:kte,jts-1:jte)<a name='1471'>
integer i<a name='1472'>
integer i_end<a name='1473'>
integer i_start<a name='1474'>
integer j<a name='1475'>
integer j_end<a name='1476'>
integer j_start<a name='1477'>
integer k<a name='1478'>
integer ktf<a name='1479'>
logical specified<a name='1480'>
real vxgm(its-1:ite,kts:kte,jts-1:jte)<a name='1481'>
<a name='1482'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CURVATURE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_56">("g_curvature")<a name='1483'>
<a name='1484'>
<font color=#447700>!----------------------------------------------<a name='1485'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1486'></font>
<font color=#447700>!----------------------------------------------<a name='1487'></font>
specified =  .false. <a name='1488'>
if (config_flags%specified .or. config_flags%nested) then<a name='1489'>
  specified =  .true. <a name='1490'>
endif<a name='1491'>
ktf = min(kte,kde-1)<a name='1492'>
i_start = its-1<a name='1493'>
i_end = ite<a name='1494'>
j_start = jts-1<a name='1495'>
j_end = jte<a name='1496'>
if ((config_flags%open_xs .or. specified .or. config_flags%nested) .and. its .eq. ids) then<a name='1497'>
  i_start = its<a name='1498'>
endif<a name='1499'>
if ((config_flags%open_xe .or. specified .or. config_flags%nested) .and. ite .eq. ide) then<a name='1500'>
  i_end = ite-1<a name='1501'>
endif<a name='1502'>
if ((config_flags%open_ys .or. specified .or. config_flags%nested) .and. jts .eq. jds) then<a name='1503'>
  j_start = jts<a name='1504'>
endif<a name='1505'>
if ((config_flags%open_ye .or. specified .or. config_flags%nested) .and. jte .eq. jde) then<a name='1506'>
  j_end = jte-1<a name='1507'>
endif<a name='1508'>
do j = j_start, j_end<a name='1509'>
  do k = kts, ktf<a name='1510'>
    do i = i_start, i_end<a name='1511'>
      g_vxgm(i,k,j) = 0.5*g_u(i+1,k,j)*(msfv(i,j+1)-msfv(i,j))*rdy+0.5*g_u(i,k,j)*(msfv(i,j+1)-msfv(i,j))*rdy-0.5*g_v(i,k,j+1)*&amp;<a name='1512'>
&amp;(msfu(i+1,j)-msfu(i,j))*rdx-0.5*g_v(i,k,j)*(msfu(i+1,j)-msfu(i,j))*rdx<a name='1513'>
      vxgm(i,k,j) = 0.5*(u(i,k,j)+u(i+1,k,j))*(msfv(i,j+1)-msfv(i,j))*rdy-0.5*(v(i,k,j)+v(i,k,j+1))*(msfu(i+1,j)-msfu(i,j))*rdx<a name='1514'>
    end do<a name='1515'>
  end do<a name='1516'>
end do<a name='1517'>
if ((config_flags%open_xs .or. specified .or. config_flags%nested) .and. its .eq. ids) then<a name='1518'>
  do j = jts-1, jte<a name='1519'>
    do k = kts, ktf<a name='1520'>
      g_vxgm(its-1,k,j) = g_vxgm(its,k,j)<a name='1521'>
      vxgm(its-1,k,j) = vxgm(its,k,j)<a name='1522'>
    end do<a name='1523'>
  end do<a name='1524'>
endif<a name='1525'>
if ((config_flags%open_xe .or. specified .or. config_flags%nested) .and. ite .eq. ide) then<a name='1526'>
  do j = jts-1, jte<a name='1527'>
    do k = kts, ktf<a name='1528'>
      g_vxgm(ite,k,j) = g_vxgm(ite-1,k,j)<a name='1529'>
      vxgm(ite,k,j) = vxgm(ite-1,k,j)<a name='1530'>
    end do<a name='1531'>
  end do<a name='1532'>
endif<a name='1533'>
if ((config_flags%open_ys .or. specified .or. config_flags%nested) .and. jts .eq. jds) then<a name='1534'>
  do k = kts, ktf<a name='1535'>
    do i = its-1, ite<a name='1536'>
      g_vxgm(i,k,jts-1) = g_vxgm(i,k,jts)<a name='1537'>
      vxgm(i,k,jts-1) = vxgm(i,k,jts)<a name='1538'>
    end do<a name='1539'>
  end do<a name='1540'>
endif<a name='1541'>
if ((config_flags%open_ye .or. specified .or. config_flags%nested) .and. jte .eq. jde) then<a name='1542'>
  do k = kts, ktf<a name='1543'>
    do i = its-1, ite<a name='1544'>
      g_vxgm(i,k,jte) = g_vxgm(i,k,jte-1)<a name='1545'>
      vxgm(i,k,jte) = vxgm(i,k,jte-1)<a name='1546'>
    end do<a name='1547'>
  end do<a name='1548'>
endif<a name='1549'>
i_start = its<a name='1550'>
if (config_flags%open_xs .or. specified .or. config_flags%nested) then<a name='1551'>
  i_start = max(ids+1,its)<a name='1552'>
endif<a name='1553'>
if (config_flags%open_xe .or. specified .or. config_flags%nested) then<a name='1554'>
  i_end = min(ide-1,ite)<a name='1555'>
endif<a name='1556'>
do j = jts, min(jde-1,jte)<a name='1557'>
  do k = kts, ktf<a name='1558'>
    do i = i_start, i_end<a name='1559'>
      g_ru_tend(i,k,j) = g_ru_tend(i,k,j)+0.125*g_rv(i-1,k,j+1)*(vxgm(i,k,j)+vxgm(i-1,k,j))+0.125*g_rv(i,k,j+1)*(vxgm(i,k,j)+&amp;<a name='1560'>
&amp;vxgm(i-1,k,j))+0.125*g_rv(i-1,k,j)*(vxgm(i,k,j)+vxgm(i-1,k,j))+0.125*g_rv(i,k,j)*(vxgm(i,k,j)+vxgm(i-1,k,j))-0.25*g_rw(i-1,&amp;<a name='1561'>
&amp;k+1,j)*u(i,k,j)*reradius-0.25*g_rw(i,k+1,j)*u(i,k,j)*reradius-0.25*g_rw(i-1,k,j)*u(i,k,j)*reradius-0.25*g_rw(i,k,j)*u(i,k,j)&amp;<a name='1562'>
&amp;*reradius-0.25*g_u(i,k,j)*reradius*(rw(i-1,k+1,j)+rw(i-1,k,j)+rw(i,k+1,j)+rw(i,k,j))+0.125*g_vxgm(i-1,k,j)*(rv(i-1,k,j+1)+&amp;<a name='1563'>
&amp;rv(i,k,j+1)+rv(i-1,k,j)+rv(i,k,j))+0.125*g_vxgm(i,k,j)*(rv(i-1,k,j+1)+rv(i,k,j+1)+rv(i-1,k,j)+rv(i,k,j))<a name='1564'>
      ru_tend(i,k,j) = ru_tend(i,k,j)+0.5*(vxgm(i,k,j)+vxgm(i-1,k,j))*0.25*(rv(i-1,k,j+1)+rv(i,k,j+1)+rv(i-1,k,j)+rv(i,k,j))-u(i,k,&amp;<a name='1565'>
&amp;j)*reradius*0.25*(rw(i-1,k+1,j)+rw(i-1,k,j)+rw(i,k+1,j)+rw(i,k,j))<a name='1566'>
    end do<a name='1567'>
  end do<a name='1568'>
end do<a name='1569'>
j_start = jts<a name='1570'>
if (config_flags%open_ys .or. specified .or. config_flags%nested) then<a name='1571'>
  j_start = max(jds+1,jts)<a name='1572'>
endif<a name='1573'>
if (config_flags%open_ye .or. specified .or. config_flags%nested) then<a name='1574'>
  j_end = min(jde-1,jte)<a name='1575'>
endif<a name='1576'>
do j = j_start, j_end<a name='1577'>
  do k = kts, ktf<a name='1578'>
    do i = its, min(ite,ide-1)<a name='1579'>
      g_rv_tend(i,k,j) = (-(0.125*g_ru(i+1,k,j-1)*(vxgm(i,k,j)+vxgm(i,k,j-1))))-0.125*g_ru(i,k,j-1)*(vxgm(i,k,j)+vxgm(i,k,j-1))-&amp;<a name='1580'>
&amp;0.125*g_ru(i+1,k,j)*(vxgm(i,k,j)+vxgm(i,k,j-1))-0.125*g_ru(i,k,j)*(vxgm(i,k,j)+vxgm(i,k,j-1))+g_rv_tend(i,k,j)+0.25*g_rw(i,&amp;<a name='1581'>
&amp;k+1,j-1)*v(i,k,j)*reradius+0.25*g_rw(i,k+1,j)*v(i,k,j)*reradius+0.25*g_rw(i,k,j-1)*v(i,k,j)*reradius+0.25*g_rw(i,k,j)*v(i,k,&amp;<a name='1582'>
&amp;j)*reradius+0.25*g_v(i,k,j)*reradius*(rw(i,k+1,j-1)+rw(i,k,j-1)+rw(i,k+1,j)+rw(i,k,j))-0.125*g_vxgm(i,k,j-1)*(ru(i,k,j)+&amp;<a name='1583'>
&amp;ru(i+1,k,j)+ru(i,k,j-1)+ru(i+1,k,j-1))-0.125*g_vxgm(i,k,j)*(ru(i,k,j)+ru(i+1,k,j)+ru(i,k,j-1)+ru(i+1,k,j-1))<a name='1584'>
      rv_tend(i,k,j) = rv_tend(i,k,j)-0.5*(vxgm(i,k,j)+vxgm(i,k,j-1))*0.25*(ru(i,k,j)+ru(i+1,k,j)+ru(i,k,j-1)+ru(i+1,k,j-1))+v(i,k,&amp;<a name='1585'>
&amp;j)*reradius*0.25*(rw(i,k+1,j-1)+rw(i,k,j-1)+rw(i,k+1,j)+rw(i,k,j))<a name='1586'>
    end do<a name='1587'>
  end do<a name='1588'>
end do<a name='1589'>
do j = jts, min(jte,jde-1)<a name='1590'>
  do k = max(2,kts), ktf<a name='1591'>
    do i = its, min(ite,ide-1)<a name='1592'>
      g_rw_tend(i,k,j) = 0.25*g_ru(i+1,k-1,j)*reradius*fzp(k)*(fzm(k)*(u(i,k,j)+u(i+1,k,j))+fzp(k)*(u(i,k-1,j)+u(i+1,k-1,j)))+0.25*&amp;<a name='1593'>
&amp;g_ru(i,k-1,j)*reradius*fzp(k)*(fzm(k)*(u(i,k,j)+u(i+1,k,j))+fzp(k)*(u(i,k-1,j)+u(i+1,k-1,j)))+0.25*g_ru(i+1,k,j)*reradius*&amp;<a name='1594'>
&amp;fzm(k)*(fzm(k)*(u(i,k,j)+u(i+1,k,j))+fzp(k)*(u(i,k-1,j)+u(i+1,k-1,j)))+0.25*g_ru(i,k,j)*reradius*fzm(k)*(fzm(k)*(u(i,k,j)+&amp;<a name='1595'>
&amp;u(i+1,k,j))+fzp(k)*(u(i,k-1,j)+u(i+1,k-1,j)))+0.25*g_rv(i,k-1,j+1)*reradius*fzp(k)*(fzm(k)*(v(i,k,j)+v(i,k,j+1))+fzp(k)*&amp;<a name='1596'>
&amp;(v(i,k-1,j)+v(i,k-1,j+1)))+0.25*g_rv(i,k-1,j)*reradius*fzp(k)*(fzm(k)*(v(i,k,j)+v(i,k,j+1))+fzp(k)*(v(i,k-1,j)+v(i,k-1,j+1))&amp;<a name='1597'>
&amp;)+0.25*g_rv(i,k,j+1)*reradius*fzm(k)*(fzm(k)*(v(i,k,j)+v(i,k,j+1))+fzp(k)*(v(i,k-1,j)+v(i,k-1,j+1)))+0.25*g_rv(i,k,j)*&amp;<a name='1598'>
&amp;reradius*fzm(k)*(fzm(k)*(v(i,k,j)+v(i,k,j+1))+fzp(k)*(v(i,k-1,j)+v(i,k-1,j+1)))+g_rw_tend(i,k,j)+0.25*g_u(i+1,k-1,j)*&amp;<a name='1599'>
&amp;reradius*(fzm(k)*(ru(i,k,j)+ru(i+1,k,j))+fzp(k)*(ru(i,k-1,j)+ru(i+1,k-1,j)))*fzp(k)+0.25*g_u(i,k-1,j)*reradius*(fzm(k)*&amp;<a name='1600'>
&amp;(ru(i,k,j)+ru(i+1,k,j))+fzp(k)*(ru(i,k-1,j)+ru(i+1,k-1,j)))*fzp(k)+0.25*g_u(i+1,k,j)*reradius*(fzm(k)*(ru(i,k,j)+ru(i+1,k,j)&amp;<a name='1601'>
&amp;)+fzp(k)*(ru(i,k-1,j)+ru(i+1,k-1,j)))*fzm(k)+0.25*g_u(i,k,j)*reradius*(fzm(k)*(ru(i,k,j)+ru(i+1,k,j))+fzp(k)*(ru(i,k-1,j)+&amp;<a name='1602'>
&amp;ru(i+1,k-1,j)))*fzm(k)+0.25*g_v(i,k-1,j+1)*reradius*(fzm(k)*(rv(i,k,j)+rv(i,k,j+1))+fzp(k)*(rv(i,k-1,j)+rv(i,k-1,j+1)))*&amp;<a name='1603'>
&amp;fzp(k)+0.25*g_v(i,k-1,j)*reradius*(fzm(k)*(rv(i,k,j)+rv(i,k,j+1))+fzp(k)*(rv(i,k-1,j)+rv(i,k-1,j+1)))*fzp(k)+0.25*g_v(i,k,j+&amp;<a name='1604'>
&amp;1)*reradius*(fzm(k)*(rv(i,k,j)+rv(i,k,j+1))+fzp(k)*(rv(i,k-1,j)+rv(i,k-1,j+1)))*fzm(k)+0.25*g_v(i,k,j)*reradius*(fzm(k)*&amp;<a name='1605'>
&amp;(rv(i,k,j)+rv(i,k,j+1))+fzp(k)*(rv(i,k-1,j)+rv(i,k-1,j+1)))*fzm(k)<a name='1606'>
      rw_tend(i,k,j) = rw_tend(i,k,j)+reradius*(0.5*(fzm(k)*(ru(i,k,j)+ru(i+1,k,j))+fzp(k)*(ru(i,k-1,j)+ru(i+1,k-1,j)))*0.5*(fzm(k)&amp;<a name='1607'>
&amp;*(u(i,k,j)+u(i+1,k,j))+fzp(k)*(u(i,k-1,j)+u(i+1,k-1,j)))+0.5*(fzm(k)*(rv(i,k,j)+rv(i,k,j+1))+fzp(k)*(rv(i,k-1,j)+rv(i,k-1,j+&amp;<a name='1608'>
&amp;1)))*0.5*(fzm(k)*(v(i,k,j)+v(i,k,j+1))+fzp(k)*(v(i,k-1,j)+v(i,k-1,j+1))))<a name='1609'>
    end do<a name='1610'>
  end do<a name='1611'>
end do<a name='1612'>
<a name='1613'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CURVATURE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_56">("g_curvature")<a name='1614'>
<a name='1615'>
end subroutine g_curvature<a name='1616'>
<a name='1617'>
<a name='1618'>
<A NAME='G_DIAGNOSE_W'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_DIAGNOSE_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1619'>
<font color=#993300>subroutine </font><font color=#cc0000>g_diagnose_w</font>( ph_tend, g_ph_tend, ph_new, g_ph_new, ph_old, g_ph_old, w, g_w, mu, g_mu, dt, u, g_u, v, g_v, ht, cf1, &amp; <A href='../../call_to/G_DIAGNOSE_W.html' TARGET='index'>4</A>,<A href='../../call_from/G_DIAGNOSE_W.html' TARGET='index'>2</A><a name='1620'>
&amp;cf2, cf3, rdx, rdy, msft, ide, jde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kte )<a name='1621'>
<font color=#447700>!******************************************************************<a name='1622'></font>
<font color=#447700>!******************************************************************<a name='1623'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1624'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1625'></font>
<font color=#447700>!******************************************************************<a name='1626'></font>
<font color=#447700>!******************************************************************<a name='1627'></font>
<font color=#447700>!==============================================<a name='1628'></font>
<font color=#447700>! all entries are defined explicitly<a name='1629'></font>
<font color=#447700>!==============================================<a name='1630'></font>
implicit none<a name='1631'>
<a name='1632'>
<font color=#447700>!==============================================<a name='1633'></font>
<font color=#447700>! declare arguments<a name='1634'></font>
<font color=#447700>!==============================================<a name='1635'></font>
real, intent(in) :: cf1<a name='1636'>
real, intent(in) :: cf2<a name='1637'>
real, intent(in) :: cf3<a name='1638'>
real, intent(in) :: dt<a name='1639'>
integer, intent(in) :: ime<a name='1640'>
integer, intent(in) :: ims<a name='1641'>
integer, intent(in) :: jme<a name='1642'>
integer, intent(in) :: jms<a name='1643'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='1644'>
integer, intent(in) :: kme<a name='1645'>
integer, intent(in) :: kms<a name='1646'>
real, intent(in) :: g_ph_new(ims:ime,kms:kme,jms:jme)<a name='1647'>
real, intent(in) :: g_ph_old(ims:ime,kms:kme,jms:jme)<a name='1648'>
real, intent(in) :: g_ph_tend(ims:ime,kms:kme,jms:jme)<a name='1649'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='1650'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='1651'>
real, intent(out) :: g_w(ims:ime,kms:kme,jms:jme)<a name='1652'>
real, intent(in) :: ht(ims:ime,jms:jme)<a name='1653'>
integer, intent(in) :: ide<a name='1654'>
integer, intent(in) :: ite<a name='1655'>
integer, intent(in) :: its<a name='1656'>
integer, intent(in) :: jde<a name='1657'>
integer, intent(in) :: jte<a name='1658'>
integer, intent(in) :: jts<a name='1659'>
integer, intent(in) :: kte<a name='1660'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='1661'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='1662'>
real, intent(in) :: ph_new(ims:ime,kms:kme,jms:jme)<a name='1663'>
real, intent(in) :: ph_old(ims:ime,kms:kme,jms:jme)<a name='1664'>
real, intent(in) :: ph_tend(ims:ime,kms:kme,jms:jme)<a name='1665'>
real, intent(in) :: rdx<a name='1666'>
real, intent(in) :: rdy<a name='1667'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='1668'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='1669'>
real, intent(out) :: w(ims:ime,kms:kme,jms:jme)<a name='1670'>
<a name='1671'>
<font color=#447700>!==============================================<a name='1672'></font>
<font color=#447700>! declare local variables<a name='1673'></font>
<font color=#447700>!==============================================<a name='1674'></font>
integer i<a name='1675'>
integer itf<a name='1676'>
integer j<a name='1677'>
integer jtf<a name='1678'>
integer k<a name='1679'>
<a name='1680'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_DIAGNOSE_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_57">("g_diagnose_w")<a name='1681'>
<a name='1682'>
<font color=#447700>!----------------------------------------------<a name='1683'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1684'></font>
<font color=#447700>!----------------------------------------------<a name='1685'></font>
itf = min(ite,ide-1)<a name='1686'>
jtf = min(jte,jde-1)<a name='1687'>
do j = jts, jtf<a name='1688'>
  do i = its, itf<a name='1689'>
    g_w(i,1,j) = 0.5*g_u(i+1,3,j)*msft(i,j)*rdx*(ht(i+1,j)-ht(i,j))*cf3+0.5*g_u(i,3,j)*msft(i,j)*rdx*(ht(i,j)-ht(i,j-1))*cf3+0.5*&amp;<a name='1690'>
&amp;g_u(i+1,2,j)*msft(i,j)*rdx*(ht(i+1,j)-ht(i,j))*cf2+0.5*g_u(i,2,j)*msft(i,j)*rdx*(ht(i,j)-ht(i,j-1))*cf2+0.5*g_u(i+1,1,j)*&amp;<a name='1691'>
&amp;msft(i,j)*rdx*(ht(i+1,j)-ht(i,j))*cf1+0.5*g_u(i,1,j)*msft(i,j)*rdx*(ht(i,j)-ht(i,j-1))*cf1+0.5*g_v(i,3,j+1)*msft(i,j)*rdy*&amp;<a name='1692'>
&amp;(ht(i,j+1)-ht(i,j))*cf3+0.5*g_v(i,3,j)*msft(i,j)*rdy*(ht(i,j)-ht(i,j-1))*cf3+0.5*g_v(i,2,j+1)*msft(i,j)*rdy*(ht(i,j+1)-ht(i,j)&amp;<a name='1693'>
&amp;)*cf2+0.5*g_v(i,2,j)*msft(i,j)*rdy*(ht(i,j)-ht(i,j-1))*cf2+0.5*g_v(i,1,j+1)*msft(i,j)*rdy*(ht(i,j+1)-ht(i,j))*cf1+0.5*g_v(i,1,&amp;<a name='1694'>
&amp;j)*msft(i,j)*rdy*(ht(i,j)-ht(i,j-1))*cf1<a name='1695'>
    w(i,1,j) = msft(i,j)*(0.5*rdy*((ht(i,j+1)-ht(i,j))*(cf1*v(i,1,j+1)+cf2*v(i,2,j+1)+cf3*v(i,3,j+1))+(ht(i,j)-ht(i,j-1))*(cf1*v(i,&amp;<a name='1696'>
&amp;1,j)+cf2*v(i,2,j)+cf3*v(i,3,j)))+0.5*rdx*((ht(i+1,j)-ht(i,j))*(cf1*u(i+1,1,j)+cf2*u(i+1,2,j)+cf3*u(i+1,3,j))+(ht(i,j)-ht(i,j-&amp;<a name='1697'>
&amp;1))*(cf1*u(i,1,j)+cf2*u(i,2,j)+cf3*u(i,3,j))))<a name='1698'>
  end do<a name='1699'>
  do k = 2, kte<a name='1700'>
    do i = its, itf<a name='1701'>
      g_w(i,k,j) = g_mu(i,j)*(msft(i,j)*(ph_tend(i,k,j)/(mu(i,j)*mu(i,j)))/g)+g_ph_new(i,k,j)*(msft(i,j)/dt/g)-g_ph_old(i,k,j)*&amp;<a name='1702'>
&amp;(msft(i,j)/dt/g)-g_ph_tend(i,k,j)*(msft(i,j)/mu(i,j)/g)<a name='1703'>
      w(i,k,j) = msft(i,j)*((ph_new(i,k,j)-ph_old(i,k,j))/dt-ph_tend(i,k,j)/mu(i,j))/g<a name='1704'>
    end do<a name='1705'>
  end do<a name='1706'>
end do<a name='1707'>
<a name='1708'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_DIAGNOSE_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_57">("g_diagnose_w")<a name='1709'>
<a name='1710'>
end subroutine g_diagnose_w<a name='1711'>
<a name='1712'>
<a name='1713'>
<A NAME='G_HORIZONTAL_DIFFUSION'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_DIFFUSION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1714'>
<font color=#993300>subroutine </font><font color=#cc0000>g_horizontal_diffusion</font>( name, field, g_field, tendency, g_tendency, mu, g_mu, config_flags, msfu, msfv, msft, xkmhd, &amp; <A href='../../call_to/G_HORIZONTAL_DIFFUSION.html' TARGET='index'>8</A>,<A href='../../call_from/G_HORIZONTAL_DIFFUSION.html' TARGET='index'>2</A><a name='1715'>
&amp;g_xkmhd, rdx, rdy, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1716'>
<font color=#447700>!******************************************************************<a name='1717'></font>
<font color=#447700>!******************************************************************<a name='1718'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1719'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1720'></font>
<font color=#447700>!******************************************************************<a name='1721'></font>
<font color=#447700>!******************************************************************<a name='1722'></font>
<font color=#447700>!==============================================<a name='1723'></font>
<font color=#447700>! all entries are defined explicitly<a name='1724'></font>
<font color=#447700>!==============================================<a name='1725'></font>
implicit none<a name='1726'>
<a name='1727'>
<font color=#447700>!==============================================<a name='1728'></font>
<font color=#447700>! declare arguments<a name='1729'></font>
<font color=#447700>!==============================================<a name='1730'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='1731'>
integer, intent(in) :: ime<a name='1732'>
integer, intent(in) :: ims<a name='1733'>
integer, intent(in) :: jme<a name='1734'>
integer, intent(in) :: jms<a name='1735'>
integer, intent(in) :: kme<a name='1736'>
integer, intent(in) :: kms<a name='1737'>
real, intent(in) :: field(ims:ime,kms:kme,jms:jme)<a name='1738'>
real, intent(in) :: g_field(ims:ime,kms:kme,jms:jme)<a name='1739'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='1740'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='1741'>
real, intent(in) :: g_xkmhd(ims:ime,kms:kme,jms:jme)<a name='1742'>
integer, intent(in) :: ide<a name='1743'>
integer, intent(in) :: ids<a name='1744'>
integer, intent(in) :: ite<a name='1745'>
integer, intent(in) :: its<a name='1746'>
integer, intent(in) :: jde<a name='1747'>
integer, intent(in) :: jds<a name='1748'>
integer, intent(in) :: jte<a name='1749'>
integer, intent(in) :: jts<a name='1750'>
integer, intent(in) :: kde<a name='1751'>
integer, intent(in) :: kte<a name='1752'>
integer, intent(in) :: kts<a name='1753'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='1754'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='1755'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='1756'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='1757'>
character*(1), intent(in) :: name<a name='1758'>
real, intent(in) :: rdx<a name='1759'>
real, intent(in) :: rdy<a name='1760'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='1761'>
real, intent(in) :: xkmhd(ims:ime,kms:kme,jms:jme)<a name='1762'>
<a name='1763'>
<font color=#447700>!==============================================<a name='1764'></font>
<font color=#447700>! declare local variables<a name='1765'></font>
<font color=#447700>!==============================================<a name='1766'></font>
real g_mkrdxm<a name='1767'>
real g_mkrdxp<a name='1768'>
real g_mkrdym<a name='1769'>
real g_mkrdyp<a name='1770'>
real g_rcoup<a name='1771'>
integer i<a name='1772'>
integer i_end<a name='1773'>
integer i_start<a name='1774'>
integer j<a name='1775'>
integer j_end<a name='1776'>
integer j_start<a name='1777'>
integer k<a name='1778'>
integer ktf<a name='1779'>
real mkrdxm<a name='1780'>
real mkrdxp<a name='1781'>
real mkrdym<a name='1782'>
real mkrdyp<a name='1783'>
real mrdx<a name='1784'>
real mrdy<a name='1785'>
real :: pr = 3.<a name='1786'>
real rcoup<a name='1787'>
logical specified<a name='1788'>
<a name='1789'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_DIFFUSION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_58">("g_horizontal_diffusion")<a name='1790'>
<a name='1791'>
<font color=#447700>!----------------------------------------------<a name='1792'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1793'></font>
<font color=#447700>!----------------------------------------------<a name='1794'></font>
specified =  .false. <a name='1795'>
if (config_flags%specified .or. config_flags%nested) then<a name='1796'>
  specified =  .true. <a name='1797'>
endif<a name='1798'>
ktf = min(kte,kde-1)<a name='1799'>
if (name .eq. 'u') then<a name='1800'>
  i_start = its<a name='1801'>
  i_end = ite<a name='1802'>
  j_start = jts<a name='1803'>
  j_end = min(jte,jde-1)<a name='1804'>
  if (config_flags%open_xs .or. specified) then<a name='1805'>
    i_start = max(ids+1,its)<a name='1806'>
  endif<a name='1807'>
  if (config_flags%open_xe .or. specified) then<a name='1808'>
    i_end = min(ide-1,ite)<a name='1809'>
  endif<a name='1810'>
  if (config_flags%open_ys .or. specified) then<a name='1811'>
    j_start = max(jds+1,jts)<a name='1812'>
  endif<a name='1813'>
  if (config_flags%open_ye .or. specified) then<a name='1814'>
    j_end = min(jde-2,jte)<a name='1815'>
  endif<a name='1816'>
  do j = j_start, j_end<a name='1817'>
    do k = kts, ktf<a name='1818'>
      do i = i_start, i_end<a name='1819'>
        g_mkrdxm = g_xkmhd(i-1,k,j)*msft(i-1,j)*rdx<a name='1820'>
        mkrdxm = msft(i-1,j)*xkmhd(i-1,k,j)*rdx<a name='1821'>
        g_mkrdxp = g_xkmhd(i,k,j)*msft(i,j)*rdx<a name='1822'>
        mkrdxp = msft(i,j)*xkmhd(i,k,j)*rdx<a name='1823'>
        mrdx = msfu(i,j)*rdx<a name='1824'>
        g_mkrdym = 0.125*g_xkmhd(i-1,k,j-1)*(msfu(i,j)+msfu(i,j-1))*rdy+0.125*g_xkmhd(i,k,j-1)*(msfu(i,j)+msfu(i,j-1))*rdy+0.125*&amp;<a name='1825'>
&amp;g_xkmhd(i-1,k,j)*(msfu(i,j)+msfu(i,j-1))*rdy+0.125*g_xkmhd(i,k,j)*(msfu(i,j)+msfu(i,j-1))*rdy<a name='1826'>
        mkrdym = 0.5*(msfu(i,j)+msfu(i,j-1))*0.25*(xkmhd(i,k,j)+xkmhd(i,k,j-1)+xkmhd(i-1,k,j-1)+xkmhd(i-1,k,j))*rdy<a name='1827'>
        g_mkrdyp = 0.125*g_xkmhd(i-1,k,j+1)*(msfu(i,j)+msfu(i,j+1))*rdy+0.125*g_xkmhd(i,k,j+1)*(msfu(i,j)+msfu(i,j+1))*rdy+0.125*&amp;<a name='1828'>
&amp;g_xkmhd(i-1,k,j)*(msfu(i,j)+msfu(i,j+1))*rdy+0.125*g_xkmhd(i,k,j)*(msfu(i,j)+msfu(i,j+1))*rdy<a name='1829'>
        mkrdyp = 0.5*(msfu(i,j)+msfu(i,j+1))*0.25*(xkmhd(i,k,j)+xkmhd(i,k,j+1)+xkmhd(i-1,k,j+1)+xkmhd(i-1,k,j))*rdy<a name='1830'>
        mrdy = msfu(i,j)*rdy<a name='1831'>
        g_rcoup = 0.5*g_mu(i-1,j)+0.5*g_mu(i,j)<a name='1832'>
        rcoup = 0.5*(mu(i,j)+mu(i-1,j))<a name='1833'>
        g_tendency(i,k,j) = g_field(i,k,j-1)*rcoup*mrdy*mkrdym+g_field(i,k,j+1)*rcoup*mrdy*mkrdyp+g_field(i-1,k,j)*rcoup*mrdx*&amp;<a name='1834'>
&amp;mkrdxm+g_field(i+1,k,j)*rcoup*mrdx*mkrdxp+g_field(i,k,j)*rcoup*((-(mrdx*(mkrdxp+mkrdxm)))-mrdy*(mkrdyp+mkrdym))-g_mkrdxm*&amp;<a name='1835'>
&amp;rcoup*mrdx*(field(i,k,j)-field(i-1,k,j))+g_mkrdxp*rcoup*mrdx*(field(i+1,k,j)-field(i,k,j))-g_mkrdym*rcoup*mrdy*(field(i,k,&amp;<a name='1836'>
&amp;j)-field(i,k,j-1))+g_mkrdyp*rcoup*mrdy*(field(i,k,j+1)-field(i,k,j))+g_rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j))-&amp;<a name='1837'>
&amp;mkrdxm*(field(i,k,j)-field(i-1,k,j)))+mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1))))+&amp;<a name='1838'>
&amp;g_tendency(i,k,j)<a name='1839'>
        tendency(i,k,j) = tendency(i,k,j)+rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j))-mkrdxm*(field(i,k,j)-field(i-1,k,j)))+&amp;<a name='1840'>
&amp;mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1))))<a name='1841'>
      end do<a name='1842'>
    end do<a name='1843'>
  end do<a name='1844'>
else if (name .eq. 'v') then<a name='1845'>
  i_start = its<a name='1846'>
  i_end = min(ite,ide-1)<a name='1847'>
  j_start = jts<a name='1848'>
  j_end = jte<a name='1849'>
  if (config_flags%open_xs .or. specified) then<a name='1850'>
    i_start = max(ids+1,its)<a name='1851'>
  endif<a name='1852'>
  if (config_flags%open_xe .or. specified) then<a name='1853'>
    i_end = min(ide-2,ite)<a name='1854'>
  endif<a name='1855'>
  if (config_flags%open_ys .or. specified) then<a name='1856'>
    j_start = max(jds+1,jts)<a name='1857'>
  endif<a name='1858'>
  if (config_flags%open_ye .or. specified) then<a name='1859'>
    j_end = min(jde-1,jte)<a name='1860'>
  endif<a name='1861'>
  do j = j_start, j_end<a name='1862'>
    do k = kts, ktf<a name='1863'>
      do i = i_start, i_end<a name='1864'>
        g_mkrdxm = 0.125*g_xkmhd(i-1,k,j-1)*(msfv(i,j)+msfv(i-1,j))*rdx+0.125*g_xkmhd(i,k,j-1)*(msfv(i,j)+msfv(i-1,j))*rdx+0.125*&amp;<a name='1865'>
&amp;g_xkmhd(i-1,k,j)*(msfv(i,j)+msfv(i-1,j))*rdx+0.125*g_xkmhd(i,k,j)*(msfv(i,j)+msfv(i-1,j))*rdx<a name='1866'>
        mkrdxm = 0.5*(msfv(i,j)+msfv(i-1,j))*0.25*(xkmhd(i,k,j)+xkmhd(i,k,j-1)+xkmhd(i-1,k,j-1)+xkmhd(i-1,k,j))*rdx<a name='1867'>
        g_mkrdxp = 0.125*g_xkmhd(i+1,k,j-1)*(msfv(i,j)+msfv(i+1,j))*rdx+0.125*g_xkmhd(i,k,j-1)*(msfv(i,j)+msfv(i+1,j))*rdx+0.125*&amp;<a name='1868'>
&amp;g_xkmhd(i+1,k,j)*(msfv(i,j)+msfv(i+1,j))*rdx+0.125*g_xkmhd(i,k,j)*(msfv(i,j)+msfv(i+1,j))*rdx<a name='1869'>
        mkrdxp = 0.5*(msfv(i,j)+msfv(i+1,j))*0.25*(xkmhd(i,k,j)+xkmhd(i,k,j-1)+xkmhd(i+1,k,j-1)+xkmhd(i+1,k,j))*rdx<a name='1870'>
        mrdx = msfv(i,j)*rdx<a name='1871'>
        g_mkrdym = g_xkmhd(i,k,j-1)*msft(i,j-1)*rdy<a name='1872'>
        mkrdym = msft(i,j-1)*xkmhd(i,k,j-1)*rdy<a name='1873'>
        g_mkrdyp = g_xkmhd(i,k,j)*msft(i,j)*rdy<a name='1874'>
        mkrdyp = msft(i,j)*xkmhd(i,k,j)*rdy<a name='1875'>
        mrdy = msfv(i,j)*rdy<a name='1876'>
        g_rcoup = 0.5*g_mu(i,j-1)+0.5*g_mu(i,j)<a name='1877'>
        rcoup = 0.5*(mu(i,j)+mu(i,j-1))<a name='1878'>
        g_tendency(i,k,j) = g_field(i,k,j-1)*rcoup*mrdy*mkrdym+g_field(i,k,j+1)*rcoup*mrdy*mkrdyp+g_field(i-1,k,j)*rcoup*mrdx*&amp;<a name='1879'>
&amp;mkrdxm+g_field(i+1,k,j)*rcoup*mrdx*mkrdxp+g_field(i,k,j)*rcoup*((-(mrdx*(mkrdxp+mkrdxm)))-mrdy*(mkrdyp+mkrdym))-g_mkrdxm*&amp;<a name='1880'>
&amp;rcoup*mrdx*(field(i,k,j)-field(i-1,k,j))+g_mkrdxp*rcoup*mrdx*(field(i+1,k,j)-field(i,k,j))-g_mkrdym*rcoup*mrdy*(field(i,k,&amp;<a name='1881'>
&amp;j)-field(i,k,j-1))+g_mkrdyp*rcoup*mrdy*(field(i,k,j+1)-field(i,k,j))+g_rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j))-&amp;<a name='1882'>
&amp;mkrdxm*(field(i,k,j)-field(i-1,k,j)))+mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1))))+&amp;<a name='1883'>
&amp;g_tendency(i,k,j)<a name='1884'>
        tendency(i,k,j) = tendency(i,k,j)+rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j))-mkrdxm*(field(i,k,j)-field(i-1,k,j)))+&amp;<a name='1885'>
&amp;mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1))))<a name='1886'>
      end do<a name='1887'>
    end do<a name='1888'>
  end do<a name='1889'>
else if (name .eq. 'w') then<a name='1890'>
  i_start = its<a name='1891'>
  i_end = min(ite,ide-1)<a name='1892'>
  j_start = jts<a name='1893'>
  j_end = min(jte,jde-1)<a name='1894'>
  if (config_flags%open_xs .or. specified) then<a name='1895'>
    i_start = max(ids+1,its)<a name='1896'>
  endif<a name='1897'>
  if (config_flags%open_xe .or. specified) then<a name='1898'>
    i_end = min(ide-2,ite)<a name='1899'>
  endif<a name='1900'>
  if (config_flags%open_ys .or. specified) then<a name='1901'>
    j_start = max(jds+1,jts)<a name='1902'>
  endif<a name='1903'>
  if (config_flags%open_ye .or. specified) then<a name='1904'>
    j_end = min(jde-2,jte)<a name='1905'>
  endif<a name='1906'>
  do j = j_start, j_end<a name='1907'>
    do k = kts+1, ktf<a name='1908'>
      do i = i_start, i_end<a name='1909'>
        g_mkrdxm = 0.25*g_xkmhd(i-1,k-1,j)*msfu(i,j)*rdx+0.25*g_xkmhd(i,k-1,j)*msfu(i,j)*rdx+0.25*g_xkmhd(i-1,k,j)*msfu(i,j)*rdx+&amp;<a name='1910'>
&amp;0.25*g_xkmhd(i,k,j)*msfu(i,j)*rdx<a name='1911'>
        mkrdxm = msfu(i,j)*0.25*(xkmhd(i,k,j)+xkmhd(i-1,k,j)+xkmhd(i,k-1,j)+xkmhd(i-1,k-1,j))*rdx<a name='1912'>
        g_mkrdxp = 0.25*g_xkmhd(i+1,k-1,j)*msfu(i+1,j)*rdx+0.25*g_xkmhd(i,k-1,j)*msfu(i+1,j)*rdx+0.25*g_xkmhd(i+1,k,j)*msfu(i+1,j)*&amp;<a name='1913'>
&amp;rdx+0.25*g_xkmhd(i,k,j)*msfu(i+1,j)*rdx<a name='1914'>
        mkrdxp = msfu(i+1,j)*0.25*(xkmhd(i+1,k,j)+xkmhd(i,k,j)+xkmhd(i+1,k-1,j)+xkmhd(i,k-1,j))*rdx<a name='1915'>
        mrdx = msft(i,j)*rdx<a name='1916'>
        g_mkrdym = 0.25*g_xkmhd(i,k-1,j-1)*msfv(i,j)*rdy+0.25*g_xkmhd(i,k-1,j)*msfv(i,j)*rdy+0.25*g_xkmhd(i,k,j-1)*msfv(i,j)*rdy+&amp;<a name='1917'>
&amp;0.25*g_xkmhd(i,k,j)*msfv(i,j)*rdy<a name='1918'>
        mkrdym = msfv(i,j)*0.25*(xkmhd(i,k,j)+xkmhd(i,k,j-1)+xkmhd(i,k-1,j)+xkmhd(i,k-1,j-1))*rdy<a name='1919'>
        g_mkrdyp = 0.25*g_xkmhd(i,k-1,j+1)*msfv(i,j+1)*rdy+0.25*g_xkmhd(i,k-1,j)*msfv(i,j+1)*rdy+0.25*g_xkmhd(i,k,j+1)*msfv(i,j+1)*&amp;<a name='1920'>
&amp;rdy+0.25*g_xkmhd(i,k,j)*msfv(i,j+1)*rdy<a name='1921'>
        mkrdyp = msfv(i,j+1)*0.25*(xkmhd(i,k,j+1)+xkmhd(i,k,j)+xkmhd(i,k-1,j+1)+xkmhd(i,k-1,j))*rdy<a name='1922'>
        mrdy = msft(i,j)*rdy<a name='1923'>
        g_rcoup = g_mu(i,j)<a name='1924'>
        rcoup = 0.5*(mu(i,j)+mu(i,j))<a name='1925'>
        g_tendency(i,k,j) = g_field(i,k,j-1)*rcoup*mrdy*mkrdym+g_field(i,k,j+1)*rcoup*mrdy*mkrdyp+g_field(i-1,k,j)*rcoup*mrdx*&amp;<a name='1926'>
&amp;mkrdxm+g_field(i+1,k,j)*rcoup*mrdx*mkrdxp+g_field(i,k,j)*rcoup*((-(mrdx*(mkrdxp+mkrdxm)))-mrdy*(mkrdyp+mkrdym))-g_mkrdxm*&amp;<a name='1927'>
&amp;rcoup*mrdx*(field(i,k,j)-field(i-1,k,j))+g_mkrdxp*rcoup*mrdx*(field(i+1,k,j)-field(i,k,j))-g_mkrdym*rcoup*mrdy*(field(i,k,&amp;<a name='1928'>
&amp;j)-field(i,k,j-1))+g_mkrdyp*rcoup*mrdy*(field(i,k,j+1)-field(i,k,j))+g_rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j))-&amp;<a name='1929'>
&amp;mkrdxm*(field(i,k,j)-field(i-1,k,j)))+mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1))))+&amp;<a name='1930'>
&amp;g_tendency(i,k,j)<a name='1931'>
        tendency(i,k,j) = tendency(i,k,j)+rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j))-mkrdxm*(field(i,k,j)-field(i-1,k,j)))+&amp;<a name='1932'>
&amp;mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1))))<a name='1933'>
      end do<a name='1934'>
    end do<a name='1935'>
  end do<a name='1936'>
else<a name='1937'>
  i_start = its<a name='1938'>
  i_end = min(ite,ide-1)<a name='1939'>
  j_start = jts<a name='1940'>
  j_end = min(jte,jde-1)<a name='1941'>
  if (config_flags%open_xs .or. specified) then<a name='1942'>
    i_start = max(ids+1,its)<a name='1943'>
  endif<a name='1944'>
  if (config_flags%open_xe .or. specified) then<a name='1945'>
    i_end = min(ide-2,ite)<a name='1946'>
  endif<a name='1947'>
  if (config_flags%open_ys .or. specified) then<a name='1948'>
    j_start = max(jds+1,jts)<a name='1949'>
  endif<a name='1950'>
  if (config_flags%open_ye .or. specified) then<a name='1951'>
    j_end = min(jde-2,jte)<a name='1952'>
  endif<a name='1953'>
  do j = j_start, j_end<a name='1954'>
    do k = kts, ktf<a name='1955'>
      do i = i_start, i_end<a name='1956'>
        g_mkrdxm = 0.5*g_xkmhd(i-1,k,j)*msfu(i,j)*rdx*pr+0.5*g_xkmhd(i,k,j)*msfu(i,j)*rdx*pr<a name='1957'>
        mkrdxm = msfu(i,j)*0.5*(xkmhd(i,k,j)+xkmhd(i-1,k,j))*rdx*pr<a name='1958'>
        g_mkrdxp = 0.5*g_xkmhd(i+1,k,j)*msfu(i+1,j)*rdx*pr+0.5*g_xkmhd(i,k,j)*msfu(i+1,j)*rdx*pr<a name='1959'>
        mkrdxp = msfu(i+1,j)*0.5*(xkmhd(i+1,k,j)+xkmhd(i,k,j))*rdx*pr<a name='1960'>
        mrdx = msft(i,j)*rdx<a name='1961'>
        g_mkrdym = 0.5*g_xkmhd(i,k,j-1)*msfv(i,j)*rdy*pr+0.5*g_xkmhd(i,k,j)*msfv(i,j)*rdy*pr<a name='1962'>
        mkrdym = msfv(i,j)*0.5*(xkmhd(i,k,j)+xkmhd(i,k,j-1))*rdy*pr<a name='1963'>
        g_mkrdyp = 0.5*g_xkmhd(i,k,j+1)*msfv(i,j+1)*rdy*pr+0.5*g_xkmhd(i,k,j)*msfv(i,j+1)*rdy*pr<a name='1964'>
        mkrdyp = msfv(i,j+1)*0.5*(xkmhd(i,k,j+1)+xkmhd(i,k,j))*rdy*pr<a name='1965'>
        mrdy = msft(i,j)*rdy<a name='1966'>
        g_rcoup = g_mu(i,j)<a name='1967'>
        rcoup = mu(i,j)<a name='1968'>
        g_tendency(i,k,j) = g_field(i,k,j-1)*rcoup*mrdy*mkrdym+g_field(i,k,j+1)*rcoup*mrdy*mkrdyp+g_field(i-1,k,j)*rcoup*mrdx*&amp;<a name='1969'>
&amp;mkrdxm+g_field(i+1,k,j)*rcoup*mrdx*mkrdxp+g_field(i,k,j)*rcoup*((-(mrdx*(mkrdxp+mkrdxm)))-mrdy*(mkrdyp+mkrdym))-g_mkrdxm*&amp;<a name='1970'>
&amp;rcoup*mrdx*(field(i,k,j)-field(i-1,k,j))+g_mkrdxp*rcoup*mrdx*(field(i+1,k,j)-field(i,k,j))-g_mkrdym*rcoup*mrdy*(field(i,k,&amp;<a name='1971'>
&amp;j)-field(i,k,j-1))+g_mkrdyp*rcoup*mrdy*(field(i,k,j+1)-field(i,k,j))+g_rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j))-&amp;<a name='1972'>
&amp;mkrdxm*(field(i,k,j)-field(i-1,k,j)))+mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1))))+&amp;<a name='1973'>
&amp;g_tendency(i,k,j)<a name='1974'>
        tendency(i,k,j) = tendency(i,k,j)+rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j))-mkrdxm*(field(i,k,j)-field(i-1,k,j)))+&amp;<a name='1975'>
&amp;mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1))))<a name='1976'>
      end do<a name='1977'>
    end do<a name='1978'>
  end do<a name='1979'>
endif<a name='1980'>
<a name='1981'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_DIFFUSION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_58">("g_horizontal_diffusion")<a name='1982'>
<a name='1983'>
end subroutine g_horizontal_diffusion<a name='1984'>
<a name='1985'>
<a name='1986'>
<A NAME='G_HORIZONTAL_DIFFUSION_3DMP'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_DIFFUSION_3DMP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1987'>
<font color=#993300>subroutine </font><font color=#cc0000>g_horizontal_diffusion_3dmp</font>( field, g_field, tendency, g_tendency, mu, g_mu, config_flags, base_3d, msfu, msfv, msft, &amp; <A href='../../call_to/G_HORIZONTAL_DIFFUSION_3DMP.html' TARGET='index'>2</A>,<A href='../../call_from/G_HORIZONTAL_DIFFUSION_3DMP.html' TARGET='index'>2</A><a name='1988'>
&amp;xkmhd, g_xkmhd, rdx, rdy, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1989'>
<font color=#447700>!******************************************************************<a name='1990'></font>
<font color=#447700>!******************************************************************<a name='1991'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1992'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1993'></font>
<font color=#447700>!******************************************************************<a name='1994'></font>
<font color=#447700>!******************************************************************<a name='1995'></font>
<font color=#447700>!==============================================<a name='1996'></font>
<font color=#447700>! all entries are defined explicitly<a name='1997'></font>
<font color=#447700>!==============================================<a name='1998'></font>
implicit none<a name='1999'>
<a name='2000'>
<font color=#447700>!==============================================<a name='2001'></font>
<font color=#447700>! declare arguments<a name='2002'></font>
<font color=#447700>!==============================================<a name='2003'></font>
integer, intent(in) :: ime<a name='2004'>
integer, intent(in) :: ims<a name='2005'>
integer, intent(in) :: jme<a name='2006'>
integer, intent(in) :: jms<a name='2007'>
integer, intent(in) :: kme<a name='2008'>
integer, intent(in) :: kms<a name='2009'>
real, intent(in) :: base_3d(ims:ime,kms:kme,jms:jme)<a name='2010'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='2011'>
real, intent(in) :: field(ims:ime,kms:kme,jms:jme)<a name='2012'>
real, intent(in) :: g_field(ims:ime,kms:kme,jms:jme)<a name='2013'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='2014'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='2015'>
real, intent(in) :: g_xkmhd(ims:ime,kms:kme,jms:jme)<a name='2016'>
integer, intent(in) :: ide<a name='2017'>
integer, intent(in) :: ids<a name='2018'>
integer, intent(in) :: ite<a name='2019'>
integer, intent(in) :: its<a name='2020'>
integer, intent(in) :: jde<a name='2021'>
integer, intent(in) :: jds<a name='2022'>
integer, intent(in) :: jte<a name='2023'>
integer, intent(in) :: jts<a name='2024'>
integer, intent(in) :: kde<a name='2025'>
integer, intent(in) :: kte<a name='2026'>
integer, intent(in) :: kts<a name='2027'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='2028'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='2029'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='2030'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='2031'>
real, intent(in) :: rdx<a name='2032'>
real, intent(in) :: rdy<a name='2033'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='2034'>
real, intent(in) :: xkmhd(ims:ime,kms:kme,jms:jme)<a name='2035'>
<a name='2036'>
<font color=#447700>!==============================================<a name='2037'></font>
<font color=#447700>! declare local variables<a name='2038'></font>
<font color=#447700>!==============================================<a name='2039'></font>
real g_mkrdxm<a name='2040'>
real g_mkrdxp<a name='2041'>
real g_mkrdym<a name='2042'>
real g_mkrdyp<a name='2043'>
real g_rcoup<a name='2044'>
integer i<a name='2045'>
integer i_end<a name='2046'>
integer i_start<a name='2047'>
integer j<a name='2048'>
integer j_end<a name='2049'>
integer j_start<a name='2050'>
integer k<a name='2051'>
integer ktf<a name='2052'>
real mkrdxm<a name='2053'>
real mkrdxp<a name='2054'>
real mkrdym<a name='2055'>
real mkrdyp<a name='2056'>
real mrdx<a name='2057'>
real mrdy<a name='2058'>
real :: pr = 3.<a name='2059'>
real rcoup<a name='2060'>
logical specified<a name='2061'>
<a name='2062'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_DIFFUSION_3DMP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_59">("g_horizontal_diffusion_3dmp")<a name='2063'>
<a name='2064'>
<font color=#447700>!----------------------------------------------<a name='2065'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='2066'></font>
<font color=#447700>!----------------------------------------------<a name='2067'></font>
specified =  .false. <a name='2068'>
if (config_flags%specified .or. config_flags%nested) then<a name='2069'>
  specified =  .true. <a name='2070'>
endif<a name='2071'>
ktf = min(kte,kde-1)<a name='2072'>
i_start = its<a name='2073'>
i_end = min(ite,ide-1)<a name='2074'>
j_start = jts<a name='2075'>
j_end = min(jte,jde-1)<a name='2076'>
if (config_flags%open_xs .or. specified) then<a name='2077'>
  i_start = max(ids+1,its)<a name='2078'>
endif<a name='2079'>
if (config_flags%open_xe .or. specified) then<a name='2080'>
  i_end = min(ide-2,ite)<a name='2081'>
endif<a name='2082'>
if (config_flags%open_ys .or. specified) then<a name='2083'>
  j_start = max(jds+1,jts)<a name='2084'>
endif<a name='2085'>
if (config_flags%open_ye .or. specified) then<a name='2086'>
  j_end = min(jde-2,jte)<a name='2087'>
endif<a name='2088'>
do j = j_start, j_end<a name='2089'>
  do k = kts, ktf<a name='2090'>
    do i = i_start, i_end<a name='2091'>
      g_mkrdxm = 0.5*g_xkmhd(i-1,k,j)*msfu(i,j)*rdx*pr+0.5*g_xkmhd(i,k,j)*msfu(i,j)*rdx*pr<a name='2092'>
      mkrdxm = msfu(i,j)*0.5*(xkmhd(i,k,j)+xkmhd(i-1,k,j))*rdx*pr<a name='2093'>
      g_mkrdxp = 0.5*g_xkmhd(i+1,k,j)*msfu(i+1,j)*rdx*pr+0.5*g_xkmhd(i,k,j)*msfu(i+1,j)*rdx*pr<a name='2094'>
      mkrdxp = msfu(i+1,j)*0.5*(xkmhd(i+1,k,j)+xkmhd(i,k,j))*rdx*pr<a name='2095'>
      mrdx = msft(i,j)*rdx<a name='2096'>
      g_mkrdym = 0.5*g_xkmhd(i,k,j-1)*msfv(i,j)*rdy*pr+0.5*g_xkmhd(i,k,j)*msfv(i,j)*rdy*pr<a name='2097'>
      mkrdym = msfv(i,j)*0.5*(xkmhd(i,k,j)+xkmhd(i,k,j-1))*rdy*pr<a name='2098'>
      g_mkrdyp = 0.5*g_xkmhd(i,k,j+1)*msfv(i,j+1)*rdy*pr+0.5*g_xkmhd(i,k,j)*msfv(i,j+1)*rdy*pr<a name='2099'>
      mkrdyp = msfv(i,j+1)*0.5*(xkmhd(i,k,j+1)+xkmhd(i,k,j))*rdy*pr<a name='2100'>
      mrdy = msft(i,j)*rdy<a name='2101'>
      g_rcoup = g_mu(i,j)<a name='2102'>
      rcoup = mu(i,j)<a name='2103'>
      g_tendency(i,k,j) = g_field(i,k,j-1)*rcoup*mrdy*mkrdym+g_field(i,k,j+1)*rcoup*mrdy*mkrdyp+g_field(i-1,k,j)*rcoup*mrdx*mkrdxm+&amp;<a name='2104'>
&amp;g_field(i+1,k,j)*rcoup*mrdx*mkrdxp+g_field(i,k,j)*rcoup*((-(mrdx*(mkrdxp+mkrdxm)))-mrdy*(mkrdyp+mkrdym))-g_mkrdxm*rcoup*&amp;<a name='2105'>
&amp;mrdx*(field(i,k,j)-field(i-1,k,j)-base_3d(i,k,j)+base_3d(i-1,k,j))+g_mkrdxp*rcoup*mrdx*(field(i+1,k,j)-field(i,k,j)-&amp;<a name='2106'>
&amp;base_3d(i+1,k,j)+base_3d(i,k,j))-g_mkrdym*rcoup*mrdy*(field(i,k,j)-field(i,k,j-1)-base_3d(i,k,j)+base_3d(i,k,j-1))+g_mkrdyp*&amp;<a name='2107'>
&amp;rcoup*mrdy*(field(i,k,j+1)-field(i,k,j)-base_3d(i,k,j+1)+base_3d(i,k,j))+g_rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j)-&amp;<a name='2108'>
&amp;base_3d(i+1,k,j)+base_3d(i,k,j))-mkrdxm*(field(i,k,j)-field(i-1,k,j)-base_3d(i,k,j)+base_3d(i-1,k,j)))+mrdy*(mkrdyp*&amp;<a name='2109'>
&amp;(field(i,k,j+1)-field(i,k,j)-base_3d(i,k,j+1)+base_3d(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1)-base_3d(i,k,j)+base_3d(i,&amp;<a name='2110'>
&amp;k,j-1))))+g_tendency(i,k,j)<a name='2111'>
      tendency(i,k,j) = tendency(i,k,j)+rcoup*(mrdx*(mkrdxp*(field(i+1,k,j)-field(i,k,j)-base_3d(i+1,k,j)+base_3d(i,k,j))-mkrdxm*&amp;<a name='2112'>
&amp;(field(i,k,j)-field(i-1,k,j)-base_3d(i,k,j)+base_3d(i-1,k,j)))+mrdy*(mkrdyp*(field(i,k,j+1)-field(i,k,j)-base_3d(i,k,j+1)+&amp;<a name='2113'>
&amp;base_3d(i,k,j))-mkrdym*(field(i,k,j)-field(i,k,j-1)-base_3d(i,k,j)+base_3d(i,k,j-1))))<a name='2114'>
    end do<a name='2115'>
  end do<a name='2116'>
end do<a name='2117'>
<a name='2118'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_DIFFUSION_3DMP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_59">("g_horizontal_diffusion_3dmp")<a name='2119'>
<a name='2120'>
end subroutine g_horizontal_diffusion_3dmp<a name='2121'>
<a name='2122'>
<a name='2123'>
<A NAME='G_HORIZONTAL_PRESSURE_GRADIENT'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_PRESSURE_GRADIENT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2124'>
<font color=#993300>subroutine </font><font color=#cc0000>g_horizontal_pressure_gradient</font>( ru_tend, g_ru_tend, rv_tend, g_rv_tend, ph, g_ph, alt, g_alt, p, g_p, pb, al, g_al, php,&amp; <A href='../../call_to/G_HORIZONTAL_PRESSURE_GRADIENT.html' TARGET='index'>1</A>,<A href='../../call_from/G_HORIZONTAL_PRESSURE_GRADIENT.html' TARGET='index'>2</A><a name='2125'>
&amp; g_php, cqu, g_cqu, cqv, g_cqv, muu, g_muu, muv, g_muv, mu, g_mu, fnm, fnp, rdnw, cf1, cf2, cf3, rdx, rdy, config_flags, &amp;<a name='2126'>
&amp;non_hydrostatic, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kte )<a name='2127'>
<font color=#447700>!******************************************************************<a name='2128'></font>
<font color=#447700>!******************************************************************<a name='2129'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='2130'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='2131'></font>
<font color=#447700>!******************************************************************<a name='2132'></font>
<font color=#447700>!******************************************************************<a name='2133'></font>
<font color=#447700>!==============================================<a name='2134'></font>
<font color=#447700>! all entries are defined explicitly<a name='2135'></font>
<font color=#447700>!==============================================<a name='2136'></font>
implicit none<a name='2137'>
<a name='2138'>
<font color=#447700>!==============================================<a name='2139'></font>
<font color=#447700>! declare arguments<a name='2140'></font>
<font color=#447700>!==============================================<a name='2141'></font>
integer, intent(in) :: ime<a name='2142'>
integer, intent(in) :: ims<a name='2143'>
integer, intent(in) :: jme<a name='2144'>
integer, intent(in) :: jms<a name='2145'>
integer, intent(in) :: kme<a name='2146'>
integer, intent(in) :: kms<a name='2147'>
real, intent(in) :: al(ims:ime,kms:kme,jms:jme)<a name='2148'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='2149'>
real, intent(in) :: cf1<a name='2150'>
real, intent(in) :: cf2<a name='2151'>
real, intent(in) :: cf3<a name='2152'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='2153'>
real, intent(in) :: cqu(ims:ime,kms:kme,jms:jme)<a name='2154'>
real, intent(in) :: cqv(ims:ime,kms:kme,jms:jme)<a name='2155'>
real, intent(in) :: fnm(kms:kme)<a name='2156'>
real, intent(in) :: fnp(kms:kme)<a name='2157'>
real, intent(in) :: g_al(ims:ime,kms:kme,jms:jme)<a name='2158'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='2159'>
real, intent(in) :: g_cqu(ims:ime,kms:kme,jms:jme)<a name='2160'>
real, intent(in) :: g_cqv(ims:ime,kms:kme,jms:jme)<a name='2161'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='2162'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='2163'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='2164'>
real, intent(in) :: g_p(ims:ime,kms:kme,jms:jme)<a name='2165'>
real, intent(in) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='2166'>
real, intent(in) :: g_php(ims:ime,kms:kme,jms:jme)<a name='2167'>
real, intent(inout) :: g_ru_tend(ims:ime,kms:kme,jms:jme)<a name='2168'>
real, intent(inout) :: g_rv_tend(ims:ime,kms:kme,jms:jme)<a name='2169'>
integer, intent(in) :: ide<a name='2170'>
integer, intent(in) :: ids<a name='2171'>
integer, intent(in) :: ite<a name='2172'>
integer, intent(in) :: its<a name='2173'>
integer, intent(in) :: jde<a name='2174'>
integer, intent(in) :: jds<a name='2175'>
integer, intent(in) :: jte<a name='2176'>
integer, intent(in) :: jts<a name='2177'>
integer, intent(in) :: kde<a name='2178'>
integer, intent(in) :: kte<a name='2179'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='2180'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='2181'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='2182'>
logical, intent(in) :: non_hydrostatic<a name='2183'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='2184'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='2185'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='2186'>
real, intent(in) :: php(ims:ime,kms:kme,jms:jme)<a name='2187'>
real, intent(in) :: rdnw(kms:kme)<a name='2188'>
real, intent(in) :: rdx<a name='2189'>
real, intent(in) :: rdy<a name='2190'>
real, intent(inout) :: ru_tend(ims:ime,kms:kme,jms:jme)<a name='2191'>
real, intent(inout) :: rv_tend(ims:ime,kms:kme,jms:jme)<a name='2192'>
<a name='2193'>
<font color=#447700>!==============================================<a name='2194'></font>
<font color=#447700>! declare local variables<a name='2195'></font>
<font color=#447700>!==============================================<a name='2196'></font>
real dpn(ims:ime,kms:kme)<a name='2197'>
real dpx<a name='2198'>
real dpy<a name='2199'>
real g_dpn(ims:ime,kms:kme)<a name='2200'>
real g_dpx<a name='2201'>
real g_dpy<a name='2202'>
integer i<a name='2203'>
integer i_start<a name='2204'>
integer itf<a name='2205'>
integer j<a name='2206'>
integer j_start<a name='2207'>
integer jtf<a name='2208'>
integer k<a name='2209'>
integer ktf<a name='2210'>
logical specified<a name='2211'>
<a name='2212'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_PRESSURE_GRADIENT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_60">("g_horizontal_pressure_gradient")<a name='2213'>
<a name='2214'>
<font color=#447700>!----------------------------------------------<a name='2215'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='2216'></font>
<font color=#447700>!----------------------------------------------<a name='2217'></font>
specified =  .false. <a name='2218'>
if (config_flags%specified .or. config_flags%nested) then<a name='2219'>
  specified =  .true. <a name='2220'>
endif<a name='2221'>
itf = min(ite,ide-1)<a name='2222'>
jtf = jte<a name='2223'>
ktf = min(kte,kde-1)<a name='2224'>
i_start = its<a name='2225'>
j_start = jts<a name='2226'>
if ((config_flags%open_ys .or. specified .or. config_flags%nested) .and. jts .eq. jds) then<a name='2227'>
  j_start = jts+1<a name='2228'>
endif<a name='2229'>
if ((config_flags%open_ye .or. specified .or. config_flags%nested) .and. jte .eq. jde) then<a name='2230'>
  jtf = jtf-1<a name='2231'>
endif<a name='2232'>
do j = j_start, jtf<a name='2233'>
  if (non_hydrostatic) then<a name='2234'>
    k = 1<a name='2235'>
    do i = i_start, itf<a name='2236'>
      g_dpn(i,k) = 0.5*g_p(i,k+2,j-1)*cf3+0.5*g_p(i,k+2,j)*cf3+0.5*g_p(i,k+1,j-1)*cf2+0.5*g_p(i,k+1,j)*cf2+0.5*g_p(i,k,j-1)*cf1+&amp;<a name='2237'>
&amp;0.5*g_p(i,k,j)*cf1<a name='2238'>
      dpn(i,k) = 0.5*(cf1*(p(i,k,j-1)+p(i,k,j))+cf2*(p(i,k+1,j-1)+p(i,k+1,j))+cf3*(p(i,k+2,j-1)+p(i,k+2,j)))<a name='2239'>
      g_dpn(i,kde) = 0.<a name='2240'>
      dpn(i,kde) = 0.<a name='2241'>
    end do<a name='2242'>
    do k = 2, ktf<a name='2243'>
      do i = i_start, itf<a name='2244'>
        g_dpn(i,k) = 0.5*g_p(i,k-1,j-1)*fnp(k)+0.5*g_p(i,k-1,j)*fnp(k)+0.5*g_p(i,k,j-1)*fnm(k)+0.5*g_p(i,k,j)*fnm(k)<a name='2245'>
        dpn(i,k) = 0.5*(fnm(k)*(p(i,k,j-1)+p(i,k,j))+fnp(k)*(p(i,k-1,j-1)+p(i,k-1,j)))<a name='2246'>
      end do<a name='2247'>
    end do<a name='2248'>
    do k = 1, ktf<a name='2249'>
      do i = i_start, itf<a name='2250'>
        g_dpy = 0.5*g_al(i,k,j-1)*rdy*muv(i,j)*(pb(i,k,j)-pb(i,k,j-1))+0.5*g_al(i,k,j)*rdy*muv(i,j)*(pb(i,k,j)-pb(i,k,j-1))+0.5*&amp;<a name='2251'>
&amp;g_alt(i,k,j-1)*rdy*muv(i,j)*(p(i,k,j)-p(i,k,j-1))+0.5*g_alt(i,k,j)*rdy*muv(i,j)*(p(i,k,j)-p(i,k,j-1))+0.5*g_muv(i,j)*rdy*&amp;<a name='2252'>
&amp;(ph(i,k+1,j)-ph(i,k+1,j-1)+ph(i,k,j)-ph(i,k,j-1)+(alt(i,k,j)+alt(i,k,j-1))*(p(i,k,j)-p(i,k,j-1))+(al(i,k,j)+al(i,k,j-1))*&amp;<a name='2253'>
&amp;(pb(i,k,j)-pb(i,k,j-1)))-0.5*g_p(i,k,j-1)*rdy*muv(i,j)*(alt(i,k,j)+alt(i,k,j-1))+0.5*g_p(i,k,j)*rdy*muv(i,j)*(alt(i,k,j)+&amp;<a name='2254'>
&amp;alt(i,k,j-1))-0.5*g_ph(i,k+1,j-1)*rdy*muv(i,j)+0.5*g_ph(i,k+1,j)*rdy*muv(i,j)-0.5*g_ph(i,k,j-1)*rdy*muv(i,j)+0.5*g_ph(i,k,&amp;<a name='2255'>
&amp;j)*rdy*muv(i,j)<a name='2256'>
        dpy = 0.5*rdy*muv(i,j)*(ph(i,k+1,j)-ph(i,k+1,j-1)+ph(i,k,j)-ph(i,k,j-1)+(alt(i,k,j)+alt(i,k,j-1))*(p(i,k,j)-p(i,k,j-1))+&amp;<a name='2257'>
&amp;(al(i,k,j)+al(i,k,j-1))*(pb(i,k,j)-pb(i,k,j-1)))<a name='2258'>
        g_dpy = g_dpn(i,k+1)*rdy*(php(i,k,j)-php(i,k,j-1))*rdnw(k)-g_dpn(i,k)*rdy*(php(i,k,j)-php(i,k,j-1))*rdnw(k)+g_dpy-0.5*&amp;<a name='2259'>
&amp;g_mu(i,j-1)*rdy*(php(i,k,j)-php(i,k,j-1))-0.5*g_mu(i,j)*rdy*(php(i,k,j)-php(i,k,j-1))-g_php(i,k,j-1)*rdy*(rdnw(k)*(dpn(i,&amp;<a name='2260'>
&amp;k+1)-dpn(i,k))-0.5*(mu(i,j-1)+mu(i,j)))+g_php(i,k,j)*rdy*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i,j-1)+mu(i,j)))<a name='2261'>
        dpy = dpy+rdy*(php(i,k,j)-php(i,k,j-1))*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i,j-1)+mu(i,j)))<a name='2262'>
        g_rv_tend(i,k,j) = (-(g_cqv(i,k,j)*dpy))-g_dpy*cqv(i,k,j)+g_rv_tend(i,k,j)<a name='2263'>
        rv_tend(i,k,j) = rv_tend(i,k,j)-cqv(i,k,j)*dpy<a name='2264'>
      end do<a name='2265'>
    end do<a name='2266'>
  else<a name='2267'>
    do k = 1, ktf<a name='2268'>
      do i = i_start, itf<a name='2269'>
        g_dpy = 0.5*g_al(i,k,j-1)*rdy*muv(i,j)*(pb(i,k,j)-pb(i,k,j-1))+0.5*g_al(i,k,j)*rdy*muv(i,j)*(pb(i,k,j)-pb(i,k,j-1))+0.5*&amp;<a name='2270'>
&amp;g_alt(i,k,j-1)*rdy*muv(i,j)*(p(i,k,j)-p(i,k,j-1))+0.5*g_alt(i,k,j)*rdy*muv(i,j)*(p(i,k,j)-p(i,k,j-1))+0.5*g_muv(i,j)*rdy*&amp;<a name='2271'>
&amp;(ph(i,k+1,j)-ph(i,k+1,j-1)+ph(i,k,j)-ph(i,k,j-1)+(alt(i,k,j)+alt(i,k,j-1))*(p(i,k,j)-p(i,k,j-1))+(al(i,k,j)+al(i,k,j-1))*&amp;<a name='2272'>
&amp;(pb(i,k,j)-pb(i,k,j-1)))-0.5*g_p(i,k,j-1)*rdy*muv(i,j)*(alt(i,k,j)+alt(i,k,j-1))+0.5*g_p(i,k,j)*rdy*muv(i,j)*(alt(i,k,j)+&amp;<a name='2273'>
&amp;alt(i,k,j-1))-0.5*g_ph(i,k+1,j-1)*rdy*muv(i,j)+0.5*g_ph(i,k+1,j)*rdy*muv(i,j)-0.5*g_ph(i,k,j-1)*rdy*muv(i,j)+0.5*g_ph(i,k,&amp;<a name='2274'>
&amp;j)*rdy*muv(i,j)<a name='2275'>
        dpy = 0.5*rdy*muv(i,j)*(ph(i,k+1,j)-ph(i,k+1,j-1)+ph(i,k,j)-ph(i,k,j-1)+(alt(i,k,j)+alt(i,k,j-1))*(p(i,k,j)-p(i,k,j-1))+&amp;<a name='2276'>
&amp;(al(i,k,j)+al(i,k,j-1))*(pb(i,k,j)-pb(i,k,j-1)))<a name='2277'>
        g_rv_tend(i,k,j) = (-(g_cqv(i,k,j)*dpy))-g_dpy*cqv(i,k,j)+g_rv_tend(i,k,j)<a name='2278'>
        rv_tend(i,k,j) = rv_tend(i,k,j)-cqv(i,k,j)*dpy<a name='2279'>
      end do<a name='2280'>
    end do<a name='2281'>
  endif<a name='2282'>
end do<a name='2283'>
itf = ite<a name='2284'>
jtf = min(jte,jde-1)<a name='2285'>
ktf = min(kte,kde-1)<a name='2286'>
i_start = its<a name='2287'>
j_start = jts<a name='2288'>
if ((config_flags%open_xs .or. specified .or. config_flags%nested) .and. its .eq. ids) then<a name='2289'>
  i_start = its+1<a name='2290'>
endif<a name='2291'>
if ((config_flags%open_xe .or. specified .or. config_flags%nested) .and. ite .eq. ide) then<a name='2292'>
  itf = itf-1<a name='2293'>
endif<a name='2294'>
do j = j_start, jtf<a name='2295'>
  if (non_hydrostatic) then<a name='2296'>
    k = 1<a name='2297'>
    do i = i_start, itf<a name='2298'>
      g_dpn(i,k) = 0.5*g_p(i-1,k+2,j)*cf3+0.5*g_p(i,k+2,j)*cf3+0.5*g_p(i-1,k+1,j)*cf2+0.5*g_p(i,k+1,j)*cf2+0.5*g_p(i-1,k,j)*cf1+&amp;<a name='2299'>
&amp;0.5*g_p(i,k,j)*cf1<a name='2300'>
      dpn(i,k) = 0.5*(cf1*(p(i-1,k,j)+p(i,k,j))+cf2*(p(i-1,k+1,j)+p(i,k+1,j))+cf3*(p(i-1,k+2,j)+p(i,k+2,j)))<a name='2301'>
      g_dpn(i,kde) = 0.<a name='2302'>
      dpn(i,kde) = 0.<a name='2303'>
    end do<a name='2304'>
    do k = 2, ktf<a name='2305'>
      do i = i_start, itf<a name='2306'>
        g_dpn(i,k) = 0.5*g_p(i-1,k-1,j)*fnp(k)+0.5*g_p(i,k-1,j)*fnp(k)+0.5*g_p(i-1,k,j)*fnm(k)+0.5*g_p(i,k,j)*fnm(k)<a name='2307'>
        dpn(i,k) = 0.5*(fnm(k)*(p(i-1,k,j)+p(i,k,j))+fnp(k)*(p(i-1,k-1,j)+p(i,k-1,j)))<a name='2308'>
      end do<a name='2309'>
    end do<a name='2310'>
    do k = 1, ktf<a name='2311'>
      do i = i_start, itf<a name='2312'>
        g_dpx = 0.5*g_al(i-1,k,j)*rdx*muu(i,j)*(pb(i,k,j)-pb(i-1,k,j))+0.5*g_al(i,k,j)*rdx*muu(i,j)*(pb(i,k,j)-pb(i-1,k,j))+0.5*&amp;<a name='2313'>
&amp;g_alt(i-1,k,j)*rdx*muu(i,j)*(p(i,k,j)-p(i-1,k,j))+0.5*g_alt(i,k,j)*rdx*muu(i,j)*(p(i,k,j)-p(i-1,k,j))+0.5*g_muu(i,j)*rdx*&amp;<a name='2314'>
&amp;(ph(i,k+1,j)-ph(i-1,k+1,j)+ph(i,k,j)-ph(i-1,k,j)+(alt(i,k,j)+alt(i-1,k,j))*(p(i,k,j)-p(i-1,k,j))+(al(i,k,j)+al(i-1,k,j))*&amp;<a name='2315'>
&amp;(pb(i,k,j)-pb(i-1,k,j)))-0.5*g_p(i-1,k,j)*rdx*muu(i,j)*(alt(i,k,j)+alt(i-1,k,j))+0.5*g_p(i,k,j)*rdx*muu(i,j)*(alt(i,k,j)+&amp;<a name='2316'>
&amp;alt(i-1,k,j))-0.5*g_ph(i-1,k+1,j)*rdx*muu(i,j)+0.5*g_ph(i,k+1,j)*rdx*muu(i,j)-0.5*g_ph(i-1,k,j)*rdx*muu(i,j)+0.5*g_ph(i,k,&amp;<a name='2317'>
&amp;j)*rdx*muu(i,j)<a name='2318'>
        dpx = 0.5*rdx*muu(i,j)*(ph(i,k+1,j)-ph(i-1,k+1,j)+ph(i,k,j)-ph(i-1,k,j)+(alt(i,k,j)+alt(i-1,k,j))*(p(i,k,j)-p(i-1,k,j))+&amp;<a name='2319'>
&amp;(al(i,k,j)+al(i-1,k,j))*(pb(i,k,j)-pb(i-1,k,j)))<a name='2320'>
        g_dpx = g_dpn(i,k+1)*rdx*(php(i,k,j)-php(i-1,k,j))*rdnw(k)-g_dpn(i,k)*rdx*(php(i,k,j)-php(i-1,k,j))*rdnw(k)+g_dpx-0.5*&amp;<a name='2321'>
&amp;g_mu(i-1,j)*rdx*(php(i,k,j)-php(i-1,k,j))-0.5*g_mu(i,j)*rdx*(php(i,k,j)-php(i-1,k,j))-g_php(i-1,k,j)*rdx*(rdnw(k)*(dpn(i,&amp;<a name='2322'>
&amp;k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))+g_php(i,k,j)*rdx*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))<a name='2323'>
        dpx = dpx+rdx*(php(i,k,j)-php(i-1,k,j))*(rdnw(k)*(dpn(i,k+1)-dpn(i,k))-0.5*(mu(i-1,j)+mu(i,j)))<a name='2324'>
        g_ru_tend(i,k,j) = (-(g_cqu(i,k,j)*dpx))-g_dpx*cqu(i,k,j)+g_ru_tend(i,k,j)<a name='2325'>
        ru_tend(i,k,j) = ru_tend(i,k,j)-cqu(i,k,j)*dpx<a name='2326'>
      end do<a name='2327'>
    end do<a name='2328'>
  else<a name='2329'>
    do k = 1, ktf<a name='2330'>
      do i = i_start, itf<a name='2331'>
        g_dpx = 0.5*g_al(i-1,k,j)*rdx*muu(i,j)*(pb(i,k,j)-pb(i-1,k,j))+0.5*g_al(i,k,j)*rdx*muu(i,j)*(pb(i,k,j)-pb(i-1,k,j))+0.5*&amp;<a name='2332'>
&amp;g_alt(i-1,k,j)*rdx*muu(i,j)*(p(i,k,j)-p(i-1,k,j))+0.5*g_alt(i,k,j)*rdx*muu(i,j)*(p(i,k,j)-p(i-1,k,j))+0.5*g_muu(i,j)*rdx*&amp;<a name='2333'>
&amp;(ph(i,k+1,j)-ph(i-1,k+1,j)+ph(i,k,j)-ph(i-1,k,j)+(alt(i,k,j)+alt(i-1,k,j))*(p(i,k,j)-p(i-1,k,j))+(al(i,k,j)+al(i-1,k,j))*&amp;<a name='2334'>
&amp;(pb(i,k,j)-pb(i-1,k,j)))-0.5*g_p(i-1,k,j)*rdx*muu(i,j)*(alt(i,k,j)+alt(i-1,k,j))+0.5*g_p(i,k,j)*rdx*muu(i,j)*(alt(i,k,j)+&amp;<a name='2335'>
&amp;alt(i-1,k,j))-0.5*g_ph(i-1,k+1,j)*rdx*muu(i,j)+0.5*g_ph(i,k+1,j)*rdx*muu(i,j)-0.5*g_ph(i-1,k,j)*rdx*muu(i,j)+0.5*g_ph(i,k,&amp;<a name='2336'>
&amp;j)*rdx*muu(i,j)<a name='2337'>
        dpx = 0.5*rdx*muu(i,j)*(ph(i,k+1,j)-ph(i-1,k+1,j)+ph(i,k,j)-ph(i-1,k,j)+(alt(i,k,j)+alt(i-1,k,j))*(p(i,k,j)-p(i-1,k,j))+&amp;<a name='2338'>
&amp;(al(i,k,j)+al(i-1,k,j))*(pb(i,k,j)-pb(i-1,k,j)))<a name='2339'>
        g_ru_tend(i,k,j) = (-(g_cqu(i,k,j)*dpx))-g_dpx*cqu(i,k,j)+g_ru_tend(i,k,j)<a name='2340'>
        ru_tend(i,k,j) = ru_tend(i,k,j)-cqu(i,k,j)*dpx<a name='2341'>
      end do<a name='2342'>
    end do<a name='2343'>
  endif<a name='2344'>
end do<a name='2345'>
<a name='2346'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_HORIZONTAL_PRESSURE_GRADIENT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_60">("g_horizontal_pressure_gradient")<a name='2347'>
<a name='2348'>
end subroutine g_horizontal_pressure_gradient<a name='2349'>
<a name='2350'>
<a name='2351'>
<A NAME='G_PERTURBATION_CORIOLIS'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PERTURBATION_CORIOLIS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2352'>
<font color=#993300>subroutine </font><font color=#cc0000>g_perturbation_coriolis</font>( ru_in, g_ru_in, rv_in, g_rv_in, rw, g_rw, ru_tend, g_ru_tend, rv_tend, g_rv_tend, rw_tend, &amp; <A href='../../call_to/G_PERTURBATION_CORIOLIS.html' TARGET='index'>1</A>,<A href='../../call_from/G_PERTURBATION_CORIOLIS.html' TARGET='index'>2</A><a name='2353'>
&amp;g_rw_tend, config_flags, u_base, v_base, z_base, muu, g_muu, muv, g_muv, phb, ph, g_ph, f, e, sina, cosa, fzm, fzp, ids, ide, jds,&amp;<a name='2354'>
&amp; jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='2355'>
<font color=#447700>!******************************************************************<a name='2356'></font>
<font color=#447700>!******************************************************************<a name='2357'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='2358'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='2359'></font>
<font color=#447700>!******************************************************************<a name='2360'></font>
<font color=#447700>!******************************************************************<a name='2361'></font>
<font color=#447700>!==============================================<a name='2362'></font>
<font color=#447700>! all entries are defined explicitly<a name='2363'></font>
<font color=#447700>!==============================================<a name='2364'></font>
implicit none<a name='2365'>
<a name='2366'>
<font color=#447700>!==============================================<a name='2367'></font>
<font color=#447700>! declare arguments<a name='2368'></font>
<font color=#447700>!==============================================<a name='2369'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='2370'>
integer, intent(in) :: ime<a name='2371'>
integer, intent(in) :: ims<a name='2372'>
integer, intent(in) :: jme<a name='2373'>
integer, intent(in) :: jms<a name='2374'>
real, intent(in) :: cosa(ims:ime,jms:jme)<a name='2375'>
real, intent(in) :: e(ims:ime,jms:jme)<a name='2376'>
real, intent(in) :: f(ims:ime,jms:jme)<a name='2377'>
integer, intent(in) :: kme<a name='2378'>
integer, intent(in) :: kms<a name='2379'>
real, intent(in) :: fzm(kms:kme)<a name='2380'>
real, intent(in) :: fzp(kms:kme)<a name='2381'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='2382'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='2383'>
real, intent(in) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='2384'>
real, intent(in) :: g_ru_in(ims:ime,kms:kme,jms:jme)<a name='2385'>
real, intent(inout) :: g_ru_tend(ims:ime,kms:kme,jms:jme)<a name='2386'>
real, intent(in) :: g_rv_in(ims:ime,kms:kme,jms:jme)<a name='2387'>
real, intent(inout) :: g_rv_tend(ims:ime,kms:kme,jms:jme)<a name='2388'>
real, intent(in) :: g_rw(ims:ime,kms:kme,jms:jme)<a name='2389'>
real, intent(inout) :: g_rw_tend(ims:ime,kms:kme,jms:jme)<a name='2390'>
integer, intent(in) :: ide<a name='2391'>
integer, intent(in) :: ids<a name='2392'>
integer, intent(in) :: ite<a name='2393'>
integer, intent(in) :: its<a name='2394'>
integer, intent(in) :: jde<a name='2395'>
integer, intent(in) :: jds<a name='2396'>
integer, intent(in) :: jte<a name='2397'>
integer, intent(in) :: jts<a name='2398'>
integer, intent(in) :: kde<a name='2399'>
integer, intent(in) :: kte<a name='2400'>
integer, intent(in) :: kts<a name='2401'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='2402'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='2403'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='2404'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='2405'>
real, intent(in) :: ru_in(ims:ime,kms:kme,jms:jme)<a name='2406'>
real, intent(inout) :: ru_tend(ims:ime,kms:kme,jms:jme)<a name='2407'>
real, intent(in) :: rv_in(ims:ime,kms:kme,jms:jme)<a name='2408'>
real, intent(inout) :: rv_tend(ims:ime,kms:kme,jms:jme)<a name='2409'>
real, intent(in) :: rw(ims:ime,kms:kme,jms:jme)<a name='2410'>
real, intent(inout) :: rw_tend(ims:ime,kms:kme,jms:jme)<a name='2411'>
real, intent(in) :: sina(ims:ime,jms:jme)<a name='2412'>
real, intent(in) :: u_base(kms:kme)<a name='2413'>
real, intent(in) :: v_base(kms:kme)<a name='2414'>
real, intent(in) :: z_base(kms:kme)<a name='2415'>
<a name='2416'>
<font color=#447700>!==============================================<a name='2417'></font>
<font color=#447700>! declare local variables<a name='2418'></font>
<font color=#447700>!==============================================<a name='2419'></font>
real g_ru(ims:ime,kms:kme,jms:jme)<a name='2420'>
real g_rv(ims:ime,kms:kme,jms:jme)<a name='2421'>
real g_wk<a name='2422'>
real g_wkm1<a name='2423'>
real g_wkp1<a name='2424'>
real g_z_at_u<a name='2425'>
real g_z_at_v<a name='2426'>
integer i<a name='2427'>
integer i_end<a name='2428'>
integer i_start<a name='2429'>
integer j<a name='2430'>
integer j_end<a name='2431'>
integer j_start<a name='2432'>
integer k<a name='2433'>
integer ktf<a name='2434'>
real ru(ims:ime,kms:kme,jms:jme)<a name='2435'>
real rv(ims:ime,kms:kme,jms:jme)<a name='2436'>
logical specified<a name='2437'>
real wk<a name='2438'>
real wkm1<a name='2439'>
real wkp1<a name='2440'>
real z_at_u<a name='2441'>
real z_at_v<a name='2442'>
<a name='2443'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PERTURBATION_CORIOLIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_61">("g_perturbation_coriolis")<a name='2444'>
<a name='2445'>
<font color=#447700>!----------------------------------------------<a name='2446'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='2447'></font>
<font color=#447700>!----------------------------------------------<a name='2448'></font>
specified =  .false. <a name='2449'>
if (config_flags%specified .or. config_flags%nested) then<a name='2450'>
  specified =  .true. <a name='2451'>
endif<a name='2452'>
ktf = min(kte,kde-1)<a name='2453'>
i_start = its<a name='2454'>
i_end = ite<a name='2455'>
if (config_flags%open_xs .or. specified .or. config_flags%nested) then<a name='2456'>
  i_start = max(ids+1,its)<a name='2457'>
endif<a name='2458'>
if (config_flags%open_xe .or. specified .or. config_flags%nested) then<a name='2459'>
  i_end = min(ide-1,ite)<a name='2460'>
endif<a name='2461'>
do j = jts, min(jte,jde-1)+1<a name='2462'>
  do k = kts+1, ktf-1<a name='2463'>
    do i = i_start-1, i_end<a name='2464'>
      g_z_at_v = (g_ph(i,k+1,j-1)+g_ph(i,k+1,j)+g_ph(i,k,j-1)+g_ph(i,k,j))*(0.25/g)<a name='2465'>
      z_at_v = 0.25*(phb(i,k,j)+phb(i,k+1,j)+phb(i,k,j-1)+phb(i,k+1,j-1)+ph(i,k,j)+ph(i,k+1,j)+ph(i,k,j-1)+ph(i,k+1,j-1))/g<a name='2466'>
      g_wkp1 = g_z_at_v*(0.5-sign(0.5,max(0.,z_at_v-z_base(k))/(z_base(k+1)-z_base(k))-1.))*((0.5-sign(0.5,0.-(z_at_v-z_base(k))))/&amp;<a name='2467'>
&amp;(z_base(k+1)-z_base(k)))<a name='2468'>
      wkp1 = min(1.,max(0.,z_at_v-z_base(k))/(z_base(k+1)-z_base(k)))<a name='2469'>
      g_wkm1 = -(g_z_at_v*(0.5-sign(0.5,max(0.,z_base(k)-z_at_v)/(z_base(k)-z_base(k-1))-1.))*((0.5-sign(0.5,0.-(z_base(k)-z_at_v))&amp;<a name='2470'>
&amp;)/(z_base(k)-z_base(k-1))))<a name='2471'>
      wkm1 = min(1.,max(0.,z_base(k)-z_at_v)/(z_base(k)-z_base(k-1)))<a name='2472'>
      g_wk = (-g_wkm1)-g_wkp1<a name='2473'>
      wk = 1.-wkp1-wkm1<a name='2474'>
      g_rv(i,k,j) = (-(g_muv(i,j)*(wkm1*v_base(k-1)+wk*v_base(k)+wkp1*v_base(k+1))))+g_rv_in(i,k,j)-g_wk*muv(i,j)*v_base(k)-g_wkm1*&amp;<a name='2475'>
&amp;muv(i,j)*v_base(k-1)-g_wkp1*muv(i,j)*v_base(k+1)<a name='2476'>
      rv(i,k,j) = rv_in(i,k,j)-muv(i,j)*(wkm1*v_base(k-1)+wk*v_base(k)+wkp1*v_base(k+1))<a name='2477'>
    end do<a name='2478'>
  end do<a name='2479'>
end do<a name='2480'>
do j = jts, min(jte,jde-1)+1<a name='2481'>
  do i = i_start-1, i_end<a name='2482'>
    k = kts<a name='2483'>
    g_z_at_v = (g_ph(i,k+1,j-1)+g_ph(i,k+1,j)+g_ph(i,k,j-1)+g_ph(i,k,j))*(0.25/g)<a name='2484'>
    z_at_v = 0.25*(phb(i,k,j)+phb(i,k+1,j)+phb(i,k,j-1)+phb(i,k+1,j-1)+ph(i,k,j)+ph(i,k+1,j)+ph(i,k,j-1)+ph(i,k+1,j-1))/g<a name='2485'>
    g_wkp1 = g_z_at_v*(0.5-sign(0.5,max(0.,z_at_v-z_base(k))/(z_base(k+1)-z_base(k))-1.))*((0.5-sign(0.5,0.-(z_at_v-z_base(k))))/&amp;<a name='2486'>
&amp;(z_base(k+1)-z_base(k)))<a name='2487'>
    wkp1 = min(1.,max(0.,z_at_v-z_base(k))/(z_base(k+1)-z_base(k)))<a name='2488'>
    g_wk = -g_wkp1<a name='2489'>
    wk = 1.-wkp1<a name='2490'>
    g_rv(i,k,j) = (-(g_muv(i,j)*(wk*v_base(k)+wkp1*v_base(k+1))))+g_rv_in(i,k,j)-g_wk*muv(i,j)*v_base(k)-g_wkp1*muv(i,j)*v_base(k+1)<a name='2491'>
    rv(i,k,j) = rv_in(i,k,j)-muv(i,j)*(wk*v_base(k)+wkp1*v_base(k+1))<a name='2492'>
    k = ktf<a name='2493'>
    g_z_at_v = (g_ph(i,k+1,j-1)+g_ph(i,k+1,j)+g_ph(i,k,j-1)+g_ph(i,k,j))*(0.25/g)<a name='2494'>
    z_at_v = 0.25*(phb(i,k,j)+phb(i,k+1,j)+phb(i,k,j-1)+phb(i,k+1,j-1)+ph(i,k,j)+ph(i,k+1,j)+ph(i,k,j-1)+ph(i,k+1,j-1))/g<a name='2495'>
    g_wkm1 = -(g_z_at_v*(0.5-sign(0.5,max(0.,z_base(k)-z_at_v)/(z_base(k)-z_base(k-1))-1.))*((0.5-sign(0.5,0.-(z_base(k)-z_at_v)))/&amp;<a name='2496'>
&amp;(z_base(k)-z_base(k-1))))<a name='2497'>
    wkm1 = min(1.,max(0.,z_base(k)-z_at_v)/(z_base(k)-z_base(k-1)))<a name='2498'>
    g_wk = -g_wkm1<a name='2499'>
    wk = 1.-wkm1<a name='2500'>
    g_rv(i,k,j) = (-(g_muv(i,j)*(wkm1*v_base(k-1)+wk*v_base(k))))+g_rv_in(i,k,j)-g_wk*muv(i,j)*v_base(k)-g_wkm1*muv(i,j)*v_base(k-1)<a name='2501'>
    rv(i,k,j) = rv_in(i,k,j)-muv(i,j)*(wkm1*v_base(k-1)+wk*v_base(k))<a name='2502'>
  end do<a name='2503'>
end do<a name='2504'>
do j = jts, min(jte,jde-1)<a name='2505'>
  do k = kts, ktf<a name='2506'>
    do i = i_start, i_end<a name='2507'>
      g_ru_tend(i,k,j) = g_ru_tend(i,k,j)+0.125*g_rv(i-1,k,j+1)*(f(i,j)+f(i-1,j))+0.125*g_rv(i,k,j+1)*(f(i,j)+f(i-1,j))+0.125*&amp;<a name='2508'>
&amp;g_rv(i-1,k,j)*(f(i,j)+f(i-1,j))+0.125*g_rv(i,k,j)*(f(i,j)+f(i-1,j))-0.0625*g_rw(i-1,k+1,j)*(e(i,j)+e(i-1,j))*(cosa(i,j)+&amp;<a name='2509'>
&amp;cosa(i-1,j))-0.0625*g_rw(i,k+1,j)*(e(i,j)+e(i-1,j))*(cosa(i,j)+cosa(i-1,j))-0.0625*g_rw(i-1,k,j)*(e(i,j)+e(i-1,j))*(cosa(i,&amp;<a name='2510'>
&amp;j)+cosa(i-1,j))-0.0625*g_rw(i,k,j)*(e(i,j)+e(i-1,j))*(cosa(i,j)+cosa(i-1,j))<a name='2511'>
      ru_tend(i,k,j) = ru_tend(i,k,j)+0.5*(f(i,j)+f(i-1,j))*0.25*(rv(i-1,k,j+1)+rv(i,k,j+1)+rv(i-1,k,j)+rv(i,k,j))-0.5*(e(i,j)+e(i-&amp;<a name='2512'>
&amp;1,j))*0.5*(cosa(i,j)+cosa(i-1,j))*0.25*(rw(i-1,k+1,j)+rw(i-1,k,j)+rw(i,k+1,j)+rw(i,k,j))<a name='2513'>
    end do<a name='2514'>
  end do<a name='2515'>
  if (config_flags%open_xs .and. its .eq. ids) then<a name='2516'>
    do k = kts, ktf<a name='2517'>
      g_ru_tend(its,k,j) = g_ru_tend(its,k,j)+0.5*g_rv(its,k,j+1)*f(its,j)+0.5*g_rv(its,k,j)*f(its,j)-0.5*g_rw(its,k+1,j)*e(its,j)*&amp;<a name='2518'>
&amp;cosa(its,j)-0.5*g_rw(its,k,j)*e(its,j)*cosa(its,j)<a name='2519'>
      ru_tend(its,k,j) = ru_tend(its,k,j)+0.5*(f(its,j)+f(its,j))*0.25*(rv(its,k,j+1)+rv(its,k,j+1)+rv(its,k,j)+rv(its,k,j))-0.5*&amp;<a name='2520'>
&amp;(e(its,j)+e(its,j))*0.5*(cosa(its,j)+cosa(its,j))*0.25*(rw(its,k+1,j)+rw(its,k,j)+rw(its,k+1,j)+rw(its,k,j))<a name='2521'>
    end do<a name='2522'>
  endif<a name='2523'>
  if (config_flags%open_xe .and. ite .eq. ide) then<a name='2524'>
    do k = kts, ktf<a name='2525'>
      g_ru_tend(ite,k,j) = g_ru_tend(ite,k,j)+0.5*g_rv(ite-1,k,j+1)*f(ite-1,j)+0.5*g_rv(ite-1,k,j)*f(ite-1,j)-0.5*g_rw(ite-1,k+1,j)&amp;<a name='2526'>
&amp;*e(ite-1,j)*cosa(ite-1,j)-0.5*g_rw(ite-1,k,j)*e(ite-1,j)*cosa(ite-1,j)<a name='2527'>
      ru_tend(ite,k,j) = ru_tend(ite,k,j)+0.5*(f(ite-1,j)+f(ite-1,j))*0.25*(rv(ite-1,k,j+1)+rv(ite-1,k,j+1)+rv(ite-1,k,j)+rv(ite-1,&amp;<a name='2528'>
&amp;k,j))-0.5*(e(ite-1,j)+e(ite-1,j))*0.5*(cosa(ite-1,j)+cosa(ite-1,j))*0.25*(rw(ite-1,k+1,j)+rw(ite-1,k,j)+rw(ite-1,k+1,j)+&amp;<a name='2529'>
&amp;rw(ite-1,k,j))<a name='2530'>
    end do<a name='2531'>
  endif<a name='2532'>
end do<a name='2533'>
j_start = jts<a name='2534'>
j_end = jte<a name='2535'>
if (config_flags%open_ys .or. specified .or. config_flags%nested) then<a name='2536'>
  j_start = max(jds+1,jts)<a name='2537'>
endif<a name='2538'>
if (config_flags%open_ye .or. specified .or. config_flags%nested) then<a name='2539'>
  j_end = min(jde-1,jte)<a name='2540'>
endif<a name='2541'>
do j = j_start-1, j_end<a name='2542'>
  do k = kts+1, ktf-1<a name='2543'>
    do i = its, min(ite,ide-1)+1<a name='2544'>
      g_z_at_u = (g_ph(i-1,k+1,j)+g_ph(i,k+1,j)+g_ph(i-1,k,j)+g_ph(i,k,j))*(0.25/g)<a name='2545'>
      z_at_u = 0.25*(phb(i,k,j)+phb(i,k+1,j)+phb(i-1,k,j)+phb(i-1,k+1,j)+ph(i,k,j)+ph(i,k+1,j)+ph(i-1,k,j)+ph(i-1,k+1,j))/g<a name='2546'>
      g_wkp1 = g_z_at_u*(0.5-sign(0.5,max(0.,z_at_u-z_base(k))/(z_base(k+1)-z_base(k))-1.))*((0.5-sign(0.5,0.-(z_at_u-z_base(k))))/&amp;<a name='2547'>
&amp;(z_base(k+1)-z_base(k)))<a name='2548'>
      wkp1 = min(1.,max(0.,z_at_u-z_base(k))/(z_base(k+1)-z_base(k)))<a name='2549'>
      g_wkm1 = -(g_z_at_u*(0.5-sign(0.5,max(0.,z_base(k)-z_at_u)/(z_base(k)-z_base(k-1))-1.))*((0.5-sign(0.5,0.-(z_base(k)-z_at_u))&amp;<a name='2550'>
&amp;)/(z_base(k)-z_base(k-1))))<a name='2551'>
      wkm1 = min(1.,max(0.,z_base(k)-z_at_u)/(z_base(k)-z_base(k-1)))<a name='2552'>
      g_wk = (-g_wkm1)-g_wkp1<a name='2553'>
      wk = 1.-wkp1-wkm1<a name='2554'>
      g_ru(i,k,j) = (-(g_muu(i,j)*(wkm1*u_base(k-1)+wk*u_base(k)+wkp1*u_base(k+1))))+g_ru_in(i,k,j)-g_wk*muu(i,j)*u_base(k)-g_wkm1*&amp;<a name='2555'>
&amp;muu(i,j)*u_base(k-1)-g_wkp1*muu(i,j)*u_base(k+1)<a name='2556'>
      ru(i,k,j) = ru_in(i,k,j)-muu(i,j)*(wkm1*u_base(k-1)+wk*u_base(k)+wkp1*u_base(k+1))<a name='2557'>
    end do<a name='2558'>
  end do<a name='2559'>
end do<a name='2560'>
do j = j_start-1, j_end<a name='2561'>
  do i = its, min(ite,ide-1)+1<a name='2562'>
    k = kts<a name='2563'>
    g_z_at_u = (g_ph(i-1,k+1,j)+g_ph(i,k+1,j)+g_ph(i-1,k,j)+g_ph(i,k,j))*(0.25/g)<a name='2564'>
    z_at_u = 0.25*(phb(i,k,j)+phb(i,k+1,j)+phb(i-1,k,j)+phb(i-1,k+1,j)+ph(i,k,j)+ph(i,k+1,j)+ph(i-1,k,j)+ph(i-1,k+1,j))/g<a name='2565'>
    g_wkp1 = g_z_at_u*(0.5-sign(0.5,max(0.,z_at_u-z_base(k))/(z_base(k+1)-z_base(k))-1.))*((0.5-sign(0.5,0.-(z_at_u-z_base(k))))/&amp;<a name='2566'>
&amp;(z_base(k+1)-z_base(k)))<a name='2567'>
    wkp1 = min(1.,max(0.,z_at_u-z_base(k))/(z_base(k+1)-z_base(k)))<a name='2568'>
    g_wk = -g_wkp1<a name='2569'>
    wk = 1.-wkp1<a name='2570'>
    g_ru(i,k,j) = (-(g_muu(i,j)*(wk*u_base(k)+wkp1*u_base(k+1))))+g_ru_in(i,k,j)-g_wk*muu(i,j)*u_base(k)-g_wkp1*muu(i,j)*u_base(k+1)<a name='2571'>
    ru(i,k,j) = ru_in(i,k,j)-muu(i,j)*(wk*u_base(k)+wkp1*u_base(k+1))<a name='2572'>
    k = ktf<a name='2573'>
    g_z_at_u = (g_ph(i-1,k+1,j)+g_ph(i,k+1,j)+g_ph(i-1,k,j)+g_ph(i,k,j))*(0.25/g)<a name='2574'>
    z_at_u = 0.25*(phb(i,k,j)+phb(i,k+1,j)+phb(i-1,k,j)+phb(i-1,k+1,j)+ph(i,k,j)+ph(i,k+1,j)+ph(i-1,k,j)+ph(i-1,k+1,j))/g<a name='2575'>
    g_wkm1 = -(g_z_at_u*(0.5-sign(0.5,max(0.,z_base(k)-z_at_u)/(z_base(k)-z_base(k-1))-1.))*((0.5-sign(0.5,0.-(z_base(k)-z_at_u)))/&amp;<a name='2576'>
&amp;(z_base(k)-z_base(k-1))))<a name='2577'>
    wkm1 = min(1.,max(0.,z_base(k)-z_at_u)/(z_base(k)-z_base(k-1)))<a name='2578'>
    g_wk = -g_wkm1<a name='2579'>
    wk = 1.-wkm1<a name='2580'>
    g_ru(i,k,j) = (-(g_muu(i,j)*(wkm1*u_base(k-1)+wk*u_base(k))))+g_ru_in(i,k,j)-g_wk*muu(i,j)*u_base(k)-g_wkm1*muu(i,j)*u_base(k-1)<a name='2581'>
    ru(i,k,j) = ru_in(i,k,j)-muu(i,j)*(wkm1*u_base(k-1)+wk*u_base(k))<a name='2582'>
  end do<a name='2583'>
end do<a name='2584'>
if (config_flags%open_ys .and. jts .eq. jds) then<a name='2585'>
  do k = kts, ktf<a name='2586'>
    do i = its, min(ide-1,ite)<a name='2587'>
      g_rv_tend(i,k,jts) = (-(0.5*g_ru(i+1,k,jts)*f(i,jts)))-0.5*g_ru(i,k,jts)*f(i,jts)+g_rv_tend(i,k,jts)+0.5*g_rw(i,k+1,jts)*e(i,&amp;<a name='2588'>
&amp;jts)*sina(i,jts)+0.5*g_rw(i,k,jts)*e(i,jts)*sina(i,jts)<a name='2589'>
      rv_tend(i,k,jts) = rv_tend(i,k,jts)-0.5*(f(i,jts)+f(i,jts))*0.25*(ru(i,k,jts)+ru(i+1,k,jts)+ru(i,k,jts)+ru(i+1,k,jts))+0.5*&amp;<a name='2590'>
&amp;(e(i,jts)+e(i,jts))*0.5*(sina(i,jts)+sina(i,jts))*0.25*(rw(i,k+1,jts)+rw(i,k,jts)+rw(i,k+1,jts)+rw(i,k,jts))<a name='2591'>
    end do<a name='2592'>
  end do<a name='2593'>
endif<a name='2594'>
do j = j_start, j_end<a name='2595'>
  do k = kts, ktf<a name='2596'>
    do i = its, min(ide-1,ite)<a name='2597'>
      g_rv_tend(i,k,j) = (-(0.125*g_ru(i+1,k,j-1)*(f(i,j)+f(i,j-1))))-0.125*g_ru(i,k,j-1)*(f(i,j)+f(i,j-1))-0.125*g_ru(i+1,k,j)*&amp;<a name='2598'>
&amp;(f(i,j)+f(i,j-1))-0.125*g_ru(i,k,j)*(f(i,j)+f(i,j-1))+g_rv_tend(i,k,j)+0.0625*g_rw(i,k+1,j-1)*(e(i,j)+e(i,j-1))*(sina(i,j)+&amp;<a name='2599'>
&amp;sina(i,j-1))+0.0625*g_rw(i,k+1,j)*(e(i,j)+e(i,j-1))*(sina(i,j)+sina(i,j-1))+0.0625*g_rw(i,k,j-1)*(e(i,j)+e(i,j-1))*(sina(i,&amp;<a name='2600'>
&amp;j)+sina(i,j-1))+0.0625*g_rw(i,k,j)*(e(i,j)+e(i,j-1))*(sina(i,j)+sina(i,j-1))<a name='2601'>
      rv_tend(i,k,j) = rv_tend(i,k,j)-0.5*(f(i,j)+f(i,j-1))*0.25*(ru(i,k,j)+ru(i+1,k,j)+ru(i,k,j-1)+ru(i+1,k,j-1))+0.5*(e(i,j)+e(i,&amp;<a name='2602'>
&amp;j-1))*0.5*(sina(i,j)+sina(i,j-1))*0.25*(rw(i,k+1,j-1)+rw(i,k,j-1)+rw(i,k+1,j)+rw(i,k,j))<a name='2603'>
    end do<a name='2604'>
  end do<a name='2605'>
end do<a name='2606'>
if (config_flags%open_ye .and. jte .eq. jde) then<a name='2607'>
  do k = kts, ktf<a name='2608'>
    do i = its, min(ide-1,ite)<a name='2609'>
      g_rv_tend(i,k,jte) = (-(0.5*g_ru(i+1,k,jte-1)*f(i,jte-1)))-0.5*g_ru(i,k,jte-1)*f(i,jte-1)+g_rv_tend(i,k,jte)+0.5*g_rw(i,k+1,&amp;<a name='2610'>
&amp;jte-1)*e(i,jte-1)*sina(i,jte-1)+0.5*g_rw(i,k,jte-1)*e(i,jte-1)*sina(i,jte-1)<a name='2611'>
      rv_tend(i,k,jte) = rv_tend(i,k,jte)-0.5*(f(i,jte-1)+f(i,jte-1))*0.25*(ru(i,k,jte-1)+ru(i+1,k,jte-1)+ru(i,k,jte-1)+ru(i+1,k,&amp;<a name='2612'>
&amp;jte-1))+0.5*(e(i,jte-1)+e(i,jte-1))*0.5*(sina(i,jte-1)+sina(i,jte-1))*0.25*(rw(i,k+1,jte-1)+rw(i,k,jte-1)+rw(i,k+1,jte-1)+&amp;<a name='2613'>
&amp;rw(i,k,jte-1))<a name='2614'>
    end do<a name='2615'>
  end do<a name='2616'>
endif<a name='2617'>
do j = jts, min(jte,jde-1)<a name='2618'>
  do k = kts+1, ktf<a name='2619'>
    do i = its, min(ite,ide-1)<a name='2620'>
      g_rw_tend(i,k,j) = 0.5*g_ru(i+1,k-1,j)*e(i,j)*cosa(i,j)*fzp(k)+0.5*g_ru(i,k-1,j)*e(i,j)*cosa(i,j)*fzp(k)+0.5*g_ru(i+1,k,j)*&amp;<a name='2621'>
&amp;e(i,j)*cosa(i,j)*fzm(k)+0.5*g_ru(i,k,j)*e(i,j)*cosa(i,j)*fzm(k)-0.5*g_rv(i,k-1,j+1)*e(i,j)*sina(i,j)*fzp(k)-0.5*g_rv(i,k-1,&amp;<a name='2622'>
&amp;j)*e(i,j)*sina(i,j)*fzp(k)-0.5*g_rv(i,k,j+1)*e(i,j)*sina(i,j)*fzm(k)-0.5*g_rv(i,k,j)*e(i,j)*sina(i,j)*fzm(k)+g_rw_tend(i,k,j)<a name='2623'>
      rw_tend(i,k,j) = rw_tend(i,k,j)+e(i,j)*(cosa(i,j)*0.5*(fzm(k)*(ru(i,k,j)+ru(i+1,k,j))+fzp(k)*(ru(i,k-1,j)+ru(i+1,k-1,j)))-&amp;<a name='2624'>
&amp;sina(i,j)*0.5*(fzm(k)*(rv(i,k,j)+rv(i,k,j+1))+fzp(k)*(rv(i,k-1,j)+rv(i,k-1,j+1))))<a name='2625'>
    end do<a name='2626'>
  end do<a name='2627'>
end do<a name='2628'>
<a name='2629'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PERTURBATION_CORIOLIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_61">("g_perturbation_coriolis")<a name='2630'>
<a name='2631'>
end subroutine g_perturbation_coriolis<a name='2632'>
<a name='2633'>
<a name='2634'>
<A NAME='G_PG_BUOY_W'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PG_BUOY_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2635'>
<font color=#993300>subroutine </font><font color=#cc0000>g_pg_buoy_w</font>( rw_tend, g_rw_tend, p, g_p, cqw, g_cqw, mu, g_mu, mub, rdnw, rdn, g, msft, ide, jde, kde, ims, ime, jms, &amp; <A href='../../call_to/G_PG_BUOY_W.html' TARGET='index'>1</A>,<A href='../../call_from/G_PG_BUOY_W.html' TARGET='index'>2</A><a name='2636'>
&amp;jme, kms, kme, its, ite, jts, jte )<a name='2637'>
<font color=#447700>!******************************************************************<a name='2638'></font>
<font color=#447700>!******************************************************************<a name='2639'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='2640'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='2641'></font>
<font color=#447700>!******************************************************************<a name='2642'></font>
<font color=#447700>!******************************************************************<a name='2643'></font>
<font color=#447700>!==============================================<a name='2644'></font>
<font color=#447700>! all entries are defined explicitly<a name='2645'></font>
<font color=#447700>!==============================================<a name='2646'></font>
implicit none<a name='2647'>
<a name='2648'>
<font color=#447700>!==============================================<a name='2649'></font>
<font color=#447700>! declare arguments<a name='2650'></font>
<font color=#447700>!==============================================<a name='2651'></font>
integer, intent(in) :: ime<a name='2652'>
integer, intent(in) :: ims<a name='2653'>
integer, intent(in) :: jme<a name='2654'>
integer, intent(in) :: jms<a name='2655'>
integer, intent(in) :: kme<a name='2656'>
integer, intent(in) :: kms<a name='2657'>
real, intent(inout) :: cqw(ims:ime,kms:kme,jms:jme)<a name='2658'>
real, intent(in) :: g<a name='2659'>
real, intent(inout) :: g_cqw(ims:ime,kms:kme,jms:jme)<a name='2660'>
real, intent(in) :: g_mu(ims:ime,jms:jme)<a name='2661'>
real, intent(in) :: g_p(ims:ime,kms:kme,jms:jme)<a name='2662'>
real, intent(inout) :: g_rw_tend(ims:ime,kms:kme,jms:jme)<a name='2663'>
integer, intent(in) :: ide<a name='2664'>
integer, intent(in) :: ite<a name='2665'>
integer, intent(in) :: its<a name='2666'>
integer, intent(in) :: jde<a name='2667'>
integer, intent(in) :: jte<a name='2668'>
integer, intent(in) :: jts<a name='2669'>
integer, intent(in) :: kde<a name='2670'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='2671'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='2672'>
real, intent(in) :: mub(ims:ime,jms:jme)<a name='2673'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='2674'>
real, intent(in) :: rdn(kms:kme)<a name='2675'>
real, intent(in) :: rdnw(kms:kme)<a name='2676'>
real, intent(inout) :: rw_tend(ims:ime,kms:kme,jms:jme)<a name='2677'>
<a name='2678'>
<font color=#447700>!==============================================<a name='2679'></font>
<font color=#447700>! declare local variables<a name='2680'></font>
<font color=#447700>!==============================================<a name='2681'></font>
real cq1<a name='2682'>
real cq2<a name='2683'>
real g_cq1<a name='2684'>
real g_cq2<a name='2685'>
integer i<a name='2686'>
integer itf<a name='2687'>
integer j<a name='2688'>
integer jtf<a name='2689'>
integer k<a name='2690'>
<a name='2691'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PG_BUOY_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_62">("g_pg_buoy_w")<a name='2692'>
<a name='2693'>
<font color=#447700>!----------------------------------------------<a name='2694'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='2695'></font>
<font color=#447700>!----------------------------------------------<a name='2696'></font>
itf = min(ite,ide-1)<a name='2697'>
jtf = min(jte,jde-1)<a name='2698'>
do j = jts, jtf<a name='2699'>
  k = kde<a name='2700'>
  do i = its, itf<a name='2701'>
    g_cq1 = -(g_cqw(i,k-1,j)/((1.+cqw(i,k-1,j))*(1.+cqw(i,k-1,j))))<a name='2702'>
    cq1 = 1./(1.+cqw(i,k-1,j))<a name='2703'>
    g_cq2 = g_cq1*cqw(i,k-1,j)+g_cqw(i,k-1,j)*cq1<a name='2704'>
    cq2 = cqw(i,k-1,j)*cq1<a name='2705'>
    g_rw_tend(i,k,j) = (-(2*g_cq1*1./msft(i,j)*g*rdnw(k-1)*p(i,k-1,j)))-g_cq2*1./msft(i,j)*g*mub(i,j)-g_mu(i,j)*1./msft(i,j)*g-2*&amp;<a name='2706'>
&amp;g_p(i,k-1,j)*1./msft(i,j)*g*cq1*rdnw(k-1)+g_rw_tend(i,k,j)<a name='2707'>
    rw_tend(i,k,j) = rw_tend(i,k,j)+1./msft(i,j)*g*(cq1*2.*rdnw(k-1)*(-p(i,k-1,j))-mu(i,j)-cq2*mub(i,j))<a name='2708'>
  end do<a name='2709'>
  do k = 2, kde-1<a name='2710'>
    do i = its, itf<a name='2711'>
      g_cq1 = -(g_cqw(i,k,j)/((1.+cqw(i,k,j))*(1.+cqw(i,k,j))))<a name='2712'>
      cq1 = 1./(1.+cqw(i,k,j))<a name='2713'>
      g_cq2 = g_cq1*cqw(i,k,j)+g_cqw(i,k,j)*cq1<a name='2714'>
      cq2 = cqw(i,k,j)*cq1<a name='2715'>
      g_cqw(i,k,j) = g_cq1<a name='2716'>
      cqw(i,k,j) = cq1<a name='2717'>
      g_rw_tend(i,k,j) = g_cq1*1./msft(i,j)*g*rdn(k)*(p(i,k,j)-p(i,k-1,j))-g_cq2*1./msft(i,j)*g*mub(i,j)-g_mu(i,j)*1./msft(i,j)*g-&amp;<a name='2718'>
&amp;g_p(i,k-1,j)*1./msft(i,j)*g*cq1*rdn(k)+g_p(i,k,j)*1./msft(i,j)*g*cq1*rdn(k)+g_rw_tend(i,k,j)<a name='2719'>
      rw_tend(i,k,j) = rw_tend(i,k,j)+1./msft(i,j)*g*(cq1*rdn(k)*(p(i,k,j)-p(i,k-1,j))-mu(i,j)-cq2*mub(i,j))<a name='2720'>
    end do<a name='2721'>
  end do<a name='2722'>
end do<a name='2723'>
<a name='2724'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PG_BUOY_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_62">("g_pg_buoy_w")<a name='2725'>
<a name='2726'>
end subroutine g_pg_buoy_w<a name='2727'>
<a name='2728'>
<a name='2729'>
<A NAME='G_PHY_PREP'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PHY_PREP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2730'>
<font color=#993300>subroutine </font><font color=#cc0000>g_phy_prep</font>( p, g_p, pb, ph, g_ph, phb, t, g_t, mu_3d, rho, th_phy, g_th_phy, p_phy, g_p_phy, pi_phy, g_pi_phy, u_phy, &amp; <A href='../../call_to/G_PHY_PREP.html' TARGET='index'>3</A>,<A href='../../call_from/G_PHY_PREP.html' TARGET='index'>2</A><a name='2731'>
&amp;v_phy, p8w, g_p8w, t_phy, g_t_phy, t8w, g_t8w, z, g_z, z_at_w, g_z_at_w, dz8w, fzm, fzp, rthraten, rthblten, rublten, rvblten, &amp;<a name='2732'>
&amp;rqvblten, rqcblten, rqiblten, rthcuten, rqvcuten, rqccuten, rqrcuten, rqicuten, rqscuten, rthften, rqvften, ide, jde, kde, ims, &amp;<a name='2733'>
&amp;ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='2734'>
<font color=#447700>!******************************************************************<a name='2735'></font>
<font color=#447700>!******************************************************************<a name='2736'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='2737'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='2738'></font>
<font color=#447700>!******************************************************************<a name='2739'></font>
<font color=#447700>!******************************************************************<a name='2740'></font>
<font color=#447700>!==============================================<a name='2741'></font>
<font color=#447700>! all entries are defined explicitly<a name='2742'></font>
<font color=#447700>!==============================================<a name='2743'></font>
implicit none<a name='2744'>
<a name='2745'>
<font color=#447700>!==============================================<a name='2746'></font>
<font color=#447700>! declare arguments<a name='2747'></font>
<font color=#447700>!==============================================<a name='2748'></font>
integer, intent(in) :: ime<a name='2749'>
integer, intent(in) :: ims<a name='2750'>
integer, intent(in) :: jme<a name='2751'>
integer, intent(in) :: jms<a name='2752'>
integer, intent(in) :: kme<a name='2753'>
integer, intent(in) :: kms<a name='2754'>
real, intent(out) :: dz8w(ims:ime,kms:kme,jms:jme)<a name='2755'>
real, intent(in) :: fzm(kms:kme)<a name='2756'>
real, intent(in) :: fzp(kms:kme)<a name='2757'>
real, intent(in) :: g_p(ims:ime,kms:kme,jms:jme)<a name='2758'>
real, intent(out) :: g_p8w(ims:ime,kms:kme,jms:jme)<a name='2759'>
real, intent(out) :: g_p_phy(ims:ime,kms:kme,jms:jme)<a name='2760'>
real, intent(in) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='2761'>
real, intent(out) :: g_pi_phy(ims:ime,kms:kme,jms:jme)<a name='2762'>
real, intent(in) :: g_t(ims:ime,kms:kme,jms:jme)<a name='2763'>
real, intent(out) :: g_t8w(ims:ime,kms:kme,jms:jme)<a name='2764'>
real, intent(out) :: g_t_phy(ims:ime,kms:kme,jms:jme)<a name='2765'>
real, intent(out) :: g_th_phy(ims:ime,kms:kme,jms:jme)<a name='2766'>
real, intent(out) :: g_z(ims:ime,kms:kme,jms:jme)<a name='2767'>
real, intent(out) :: g_z_at_w(ims:ime,kms:kme,jms:jme)<a name='2768'>
integer, intent(in) :: ide<a name='2769'>
integer, intent(in) :: ite<a name='2770'>
integer, intent(in) :: its<a name='2771'>
integer, intent(in) :: jde<a name='2772'>
integer, intent(in) :: jte<a name='2773'>
integer, intent(in) :: jts<a name='2774'>
integer, intent(in) :: kde<a name='2775'>
integer, intent(in) :: kte<a name='2776'>
integer, intent(in) :: kts<a name='2777'>
real, intent(out) :: mu_3d(ims:ime,kms:kme,jms:jme)<a name='2778'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='2779'>
real, intent(out) :: p8w(ims:ime,kms:kme,jms:jme)<a name='2780'>
real, intent(out) :: p_phy(ims:ime,kms:kme,jms:jme)<a name='2781'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='2782'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='2783'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='2784'>
real, intent(out) :: pi_phy(ims:ime,kms:kme,jms:jme)<a name='2785'>
real, intent(out) :: rho(ims:ime,kms:kme,jms:jme)<a name='2786'>
real, intent(inout) :: rqcblten(ims:ime,kms:kme,jms:jme)<a name='2787'>
real, intent(inout) :: rqccuten(ims:ime,kms:kme,jms:jme)<a name='2788'>
real, intent(inout) :: rqiblten(ims:ime,kms:kme,jms:jme)<a name='2789'>
real, intent(inout) :: rqicuten(ims:ime,kms:kme,jms:jme)<a name='2790'>
real, intent(inout) :: rqrcuten(ims:ime,kms:kme,jms:jme)<a name='2791'>
real, intent(inout) :: rqscuten(ims:ime,kms:kme,jms:jme)<a name='2792'>
real, intent(inout) :: rqvblten(ims:ime,kms:kme,jms:jme)<a name='2793'>
real, intent(inout) :: rqvcuten(ims:ime,kms:kme,jms:jme)<a name='2794'>
real, intent(inout) :: rqvften(ims:ime,kms:kme,jms:jme)<a name='2795'>
real, intent(inout) :: rthblten(ims:ime,kms:kme,jms:jme)<a name='2796'>
real, intent(inout) :: rthcuten(ims:ime,kms:kme,jms:jme)<a name='2797'>
real, intent(inout) :: rthften(ims:ime,kms:kme,jms:jme)<a name='2798'>
real, intent(inout) :: rthraten(ims:ime,kms:kme,jms:jme)<a name='2799'>
real, intent(inout) :: rublten(ims:ime,kms:kme,jms:jme)<a name='2800'>
real, intent(inout) :: rvblten(ims:ime,kms:kme,jms:jme)<a name='2801'>
real, intent(in) :: t(ims:ime,kms:kme,jms:jme)<a name='2802'>
real, intent(out) :: t8w(ims:ime,kms:kme,jms:jme)<a name='2803'>
real, intent(out) :: t_phy(ims:ime,kms:kme,jms:jme)<a name='2804'>
real, intent(out) :: th_phy(ims:ime,kms:kme,jms:jme)<a name='2805'>
real, intent(out) :: u_phy(ims:ime,kms:kme,jms:jme)<a name='2806'>
real, intent(out) :: v_phy(ims:ime,kms:kme,jms:jme)<a name='2807'>
real, intent(out) :: z(ims:ime,kms:kme,jms:jme)<a name='2808'>
real, intent(out) :: z_at_w(ims:ime,kms:kme,jms:jme)<a name='2809'>
<a name='2810'>
<font color=#447700>!==============================================<a name='2811'></font>
<font color=#447700>! declare local variables<a name='2812'></font>
<font color=#447700>!==============================================<a name='2813'></font>
real g_w1<a name='2814'>
real g_w2<a name='2815'>
real g_z0<a name='2816'>
real g_z1<a name='2817'>
real g_z2<a name='2818'>
integer i<a name='2819'>
integer i_end<a name='2820'>
integer i_start<a name='2821'>
integer j<a name='2822'>
integer j_end<a name='2823'>
integer j_start<a name='2824'>
integer k<a name='2825'>
integer k_end<a name='2826'>
integer k_start<a name='2827'>
real w1<a name='2828'>
real w2<a name='2829'>
real z0<a name='2830'>
real z1<a name='2831'>
real z2<a name='2832'>
<a name='2833'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PHY_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_63">("g_phy_prep")<a name='2834'>
<a name='2835'>
<font color=#447700>!----------------------------------------------<a name='2836'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='2837'></font>
<font color=#447700>!----------------------------------------------<a name='2838'></font>
i_start = its<a name='2839'>
i_end = min(ite,ide-1)<a name='2840'>
j_start = jts<a name='2841'>
j_end = min(jte,jde-1)<a name='2842'>
k_start = kts<a name='2843'>
k_end = min(kte,kde-1)<a name='2844'>
do j = j_start, j_end<a name='2845'>
  do k = k_start, k_end<a name='2846'>
    do i = i_start, i_end<a name='2847'>
      g_th_phy(i,k,j) = g_t(i,k,j)<a name='2848'>
      th_phy(i,k,j) = t(i,k,j)+t0<a name='2849'>
      g_p_phy(i,k,j) = g_p(i,k,j)<a name='2850'>
      p_phy(i,k,j) = p(i,k,j)+pb(i,k,j)<a name='2851'>
      g_pi_phy(i,k,j) = g_p_phy(i,k,j)/p1000mb*rcp*(p_phy(i,k,j)/p1000mb)**(rcp-1)<a name='2852'>
      pi_phy(i,k,j) = (p_phy(i,k,j)/p1000mb)**rcp<a name='2853'>
      g_t_phy(i,k,j) = g_pi_phy(i,k,j)*th_phy(i,k,j)+g_th_phy(i,k,j)*pi_phy(i,k,j)<a name='2854'>
      t_phy(i,k,j) = th_phy(i,k,j)*pi_phy(i,k,j)<a name='2855'>
    end do<a name='2856'>
  end do<a name='2857'>
end do<a name='2858'>
do j = j_start, j_end<a name='2859'>
  do k = k_start, kte<a name='2860'>
    do i = i_start, i_end<a name='2861'>
      g_z_at_w(i,k,j) = g_ph(i,k,j)/g<a name='2862'>
      z_at_w(i,k,j) = (phb(i,k,j)+ph(i,k,j))/g<a name='2863'>
    end do<a name='2864'>
  end do<a name='2865'>
end do<a name='2866'>
do j = j_start, j_end<a name='2867'>
  do k = k_start, k_end<a name='2868'>
    do i = i_start, i_end<a name='2869'>
      g_z(i,k,j) = 0.5*g_z_at_w(i,k+1,j)+0.5*g_z_at_w(i,k,j)<a name='2870'>
      z(i,k,j) = 0.5*(z_at_w(i,k,j)+z_at_w(i,k+1,j))<a name='2871'>
    end do<a name='2872'>
  end do<a name='2873'>
end do<a name='2874'>
do j = j_start, j_end<a name='2875'>
  do k = 2, k_end<a name='2876'>
    do i = i_start, i_end<a name='2877'>
      g_p8w(i,k,j) = g_p_phy(i,k-1,j)*fzp(k)+g_p_phy(i,k,j)*fzm(k)<a name='2878'>
      p8w(i,k,j) = fzm(k)*p_phy(i,k,j)+fzp(k)*p_phy(i,k-1,j)<a name='2879'>
      g_t8w(i,k,j) = g_t_phy(i,k-1,j)*fzp(k)+g_t_phy(i,k,j)*fzm(k)<a name='2880'>
      t8w(i,k,j) = fzm(k)*t_phy(i,k,j)+fzp(k)*t_phy(i,k-1,j)<a name='2881'>
    end do<a name='2882'>
  end do<a name='2883'>
end do<a name='2884'>
do j = j_start, j_end<a name='2885'>
  do i = i_start, i_end<a name='2886'>
    g_z0 = g_z_at_w(i,1,j)<a name='2887'>
    z0 = z_at_w(i,1,j)<a name='2888'>
    g_z1 = g_z(i,1,j)<a name='2889'>
    z1 = z(i,1,j)<a name='2890'>
    g_z2 = g_z(i,2,j)<a name='2891'>
    z2 = z(i,2,j)<a name='2892'>
    g_w1 = g_z0/(z1-z2)-g_z1*((z0-z2)/((z1-z2)*(z1-z2)))+g_z2*((-1)/(z1-z2)+(z0-z2)/((z1-z2)*(z1-z2)))<a name='2893'>
    w1 = (z0-z2)/(z1-z2)<a name='2894'>
    g_w2 = -g_w1<a name='2895'>
    w2 = 1.-w1<a name='2896'>
    g_p8w(i,1,j) = g_p_phy(i,2,j)*w2+g_p_phy(i,1,j)*w1+g_w1*p_phy(i,1,j)+g_w2*p_phy(i,2,j)<a name='2897'>
    p8w(i,1,j) = w1*p_phy(i,1,j)+w2*p_phy(i,2,j)<a name='2898'>
    g_t8w(i,1,j) = g_t_phy(i,2,j)*w2+g_t_phy(i,1,j)*w1+g_w1*t_phy(i,1,j)+g_w2*t_phy(i,2,j)<a name='2899'>
    t8w(i,1,j) = w1*t_phy(i,1,j)+w2*t_phy(i,2,j)<a name='2900'>
    g_z0 = g_z_at_w(i,kte,j)<a name='2901'>
    z0 = z_at_w(i,kte,j)<a name='2902'>
    g_z1 = g_z(i,k_end,j)<a name='2903'>
    z1 = z(i,k_end,j)<a name='2904'>
    g_z2 = g_z(i,k_end-1,j)<a name='2905'>
    z2 = z(i,k_end-1,j)<a name='2906'>
    g_w1 = g_z0/(z1-z2)-g_z1*((z0-z2)/((z1-z2)*(z1-z2)))+g_z2*((-1)/(z1-z2)+(z0-z2)/((z1-z2)*(z1-z2)))<a name='2907'>
    w1 = (z0-z2)/(z1-z2)<a name='2908'>
    g_w2 = -g_w1<a name='2909'>
    w2 = 1.-w1<a name='2910'>
    g_p8w(i,kde,j) = (g_p_phy(i,kde-2,j)*w2*(1./p_phy(i,kde-2,j))+g_p_phy(i,kde-1,j)*w1*(1./p_phy(i,kde-1,j)))*exp(w1*log(p_phy(i,&amp;<a name='2911'>
&amp;kde-1,j))+w2*log(p_phy(i,kde-2,j)))+g_w1*exp(w1*log(p_phy(i,kde-1,j))+w2*log(p_phy(i,kde-2,j)))*log(p_phy(i,kde-1,j))+g_w2*&amp;<a name='2912'>
&amp;exp(w1*log(p_phy(i,kde-1,j))+w2*log(p_phy(i,kde-2,j)))*log(p_phy(i,kde-2,j))<a name='2913'>
    p8w(i,kde,j) = exp(w1*log(p_phy(i,kde-1,j))+w2*log(p_phy(i,kde-2,j)))<a name='2914'>
    g_t8w(i,kde,j) = g_t_phy(i,kde-2,j)*w2+g_t_phy(i,kde-1,j)*w1+g_w1*t_phy(i,kde-1,j)+g_w2*t_phy(i,kde-2,j)<a name='2915'>
    t8w(i,kde,j) = w1*t_phy(i,kde-1,j)+w2*t_phy(i,kde-2,j)<a name='2916'>
  end do<a name='2917'>
end do<a name='2918'>
<a name='2919'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PHY_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_63">("g_phy_prep")<a name='2920'>
<a name='2921'>
end subroutine g_phy_prep<a name='2922'>
<a name='2923'>
<a name='2924'>
<A NAME='G_RHS_PH'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_RHS_PH' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2925'>
<font color=#993300>subroutine </font><font color=#cc0000>g_rhs_ph</font>( ph_tend, g_ph_tend, u, g_u, v, g_v, ww, g_ww, ph, g_ph, ph_old, g_ph_old, phb, w, g_w, mut, g_mut, muu, g_muu,&amp; <A href='../../call_to/G_RHS_PH.html' TARGET='index'>2</A>,<A href='../../call_from/G_RHS_PH.html' TARGET='index'>2</A><a name='2926'>
&amp; muv, g_muv, fnm, fnp, rdnw, cfn, cfn1, rdx, rdy, msft, non_hydrostatic, config_flags, ids, ide, jds, jde, kde, ims, ime, jms, &amp;<a name='2927'>
&amp;jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='2928'>
<font color=#447700>!******************************************************************<a name='2929'></font>
<font color=#447700>!******************************************************************<a name='2930'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='2931'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='2932'></font>
<font color=#447700>!******************************************************************<a name='2933'></font>
<font color=#447700>!******************************************************************<a name='2934'></font>
<font color=#447700>!==============================================<a name='2935'></font>
<font color=#447700>! all entries are defined explicitly<a name='2936'></font>
<font color=#447700>!==============================================<a name='2937'></font>
implicit none<a name='2938'>
<a name='2939'>
<font color=#447700>!==============================================<a name='2940'></font>
<font color=#447700>! declare arguments<a name='2941'></font>
<font color=#447700>!==============================================<a name='2942'></font>
real, intent(in) :: cfn<a name='2943'>
real, intent(in) :: cfn1<a name='2944'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='2945'>
integer, intent(in) :: kme<a name='2946'>
integer, intent(in) :: kms<a name='2947'>
real, intent(in) :: fnm(kms:kme)<a name='2948'>
real, intent(in) :: fnp(kms:kme)<a name='2949'>
integer, intent(in) :: ime<a name='2950'>
integer, intent(in) :: ims<a name='2951'>
integer, intent(in) :: jme<a name='2952'>
integer, intent(in) :: jms<a name='2953'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='2954'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='2955'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='2956'>
real, intent(in) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='2957'>
real, intent(in) :: g_ph_old(ims:ime,kms:kme,jms:jme)<a name='2958'>
real, intent(inout) :: g_ph_tend(ims:ime,kms:kme,jms:jme)<a name='2959'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='2960'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='2961'>
real, intent(in) :: g_w(ims:ime,kms:kme,jms:jme)<a name='2962'>
real, intent(in) :: g_ww(ims:ime,kms:kme,jms:jme)<a name='2963'>
integer, intent(in) :: ide<a name='2964'>
integer, intent(in) :: ids<a name='2965'>
integer, intent(in) :: ite<a name='2966'>
integer, intent(in) :: its<a name='2967'>
integer, intent(in) :: jde<a name='2968'>
integer, intent(in) :: jds<a name='2969'>
integer, intent(in) :: jte<a name='2970'>
integer, intent(in) :: jts<a name='2971'>
integer, intent(in) :: kde<a name='2972'>
integer, intent(in) :: kte<a name='2973'>
integer, intent(in) :: kts<a name='2974'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='2975'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='2976'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='2977'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='2978'>
logical, intent(in) :: non_hydrostatic<a name='2979'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='2980'>
real, intent(in) :: ph_old(ims:ime,kms:kme,jms:jme)<a name='2981'>
real, intent(inout) :: ph_tend(ims:ime,kms:kme,jms:jme)<a name='2982'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='2983'>
real, intent(in) :: rdnw(kms:kme)<a name='2984'>
real, intent(in) :: rdx<a name='2985'>
real, intent(in) :: rdy<a name='2986'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='2987'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='2988'>
real, intent(in) :: w(ims:ime,kms:kme,jms:jme)<a name='2989'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='2990'>
<a name='2991'>
<font color=#447700>!==============================================<a name='2992'></font>
<font color=#447700>! declare local variables<a name='2993'></font>
<font color=#447700>!==============================================<a name='2994'></font>
integer advective_order<a name='2995'>
real g_ub<a name='2996'>
real g_ul<a name='2997'>
real g_ur<a name='2998'>
real g_vb<a name='2999'>
real g_vl<a name='3000'>
real g_vr<a name='3001'>
real g_wdwn(its:ite,kts:kte)<a name='3002'>
integer i<a name='3003'>
integer i_start<a name='3004'>
integer itf<a name='3005'>
integer j<a name='3006'>
integer j_start<a name='3007'>
integer jtf<a name='3008'>
integer k<a name='3009'>
integer kz<a name='3010'>
logical specified<a name='3011'>
real ub<a name='3012'>
real ul<a name='3013'>
real ur<a name='3014'>
real vb<a name='3015'>
real vl<a name='3016'>
real vr<a name='3017'>
real wdwn(its:ite,kts:kte)<a name='3018'>
<a name='3019'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_RHS_PH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_64">("g_rhs_ph")<a name='3020'>
<a name='3021'>
<font color=#447700>!----------------------------------------------<a name='3022'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='3023'></font>
<font color=#447700>!----------------------------------------------<a name='3024'></font>
specified =  .false. <a name='3025'>
if (config_flags%specified .or. config_flags%nested) then<a name='3026'>
  specified =  .true. <a name='3027'>
endif<a name='3028'>
advective_order = config_flags%h_sca_adv_order<a name='3029'>
itf = min(ite,ide-1)<a name='3030'>
jtf = min(jte,jde-1)<a name='3031'>
do j = jts, jtf<a name='3032'>
  do k = 2, kte<a name='3033'>
    do i = its, itf<a name='3034'>
      g_wdwn(i,k) = (-0.5)*g_ph(i,k-1,j)*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)+0.5*g_ph(i,k,j)*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)+0.5*&amp;<a name='3035'>
&amp;g_ww(i,k-1,j)*rdnw(k-1)*(ph(i,k,j)-ph(i,k-1,j)+phb(i,k,j)-phb(i,k-1,j))+0.5*g_ww(i,k,j)*rdnw(k-1)*(ph(i,k,j)-ph(i,k-1,j)+&amp;<a name='3036'>
&amp;phb(i,k,j)-phb(i,k-1,j))<a name='3037'>
      wdwn(i,k) = 0.5*(ww(i,k,j)+ww(i,k-1,j))*rdnw(k-1)*(ph(i,k,j)-ph(i,k-1,j)+phb(i,k,j)-phb(i,k-1,j))<a name='3038'>
    end do<a name='3039'>
  end do<a name='3040'>
  do k = 2, kte-1<a name='3041'>
    do i = its, itf<a name='3042'>
      g_ph_tend(i,k,j) = g_ph_tend(i,k,j)-g_wdwn(i,k+1)*fnm(k)-g_wdwn(i,k)*fnp(k)<a name='3043'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-(fnm(k)*wdwn(i,k+1)+fnp(k)*wdwn(i,k))<a name='3044'>
    end do<a name='3045'>
  end do<a name='3046'>
end do<a name='3047'>
if (non_hydrostatic) then<a name='3048'>
  do j = jts, jtf<a name='3049'>
    do i = its, itf<a name='3050'>
      g_ph_tend(i,kde,j) = 0.<a name='3051'>
      ph_tend(i,kde,j) = 0.<a name='3052'>
    end do<a name='3053'>
    do k = 2, kte<a name='3054'>
      do i = its, itf<a name='3055'>
        g_ph_tend(i,k,j) = g_mut(i,j)*(g*w(i,k,j)/msft(i,j))+g_ph_tend(i,k,j)+g_w(i,k,j)*(mut(i,j)*g/msft(i,j))<a name='3056'>
        ph_tend(i,k,j) = ph_tend(i,k,j)+mut(i,j)*g*w(i,k,j)/msft(i,j)<a name='3057'>
      end do<a name='3058'>
    end do<a name='3059'>
  end do<a name='3060'>
endif<a name='3061'>
if (advective_order .le. 2) then<a name='3062'>
  i_start = its<a name='3063'>
  j_start = jts<a name='3064'>
  itf = min(ite,ide-1)<a name='3065'>
  jtf = min(jte,jde-1)<a name='3066'>
  if (config_flags%open_ys .and. jts .eq. jds) then<a name='3067'>
    j_start = jts+1<a name='3068'>
  endif<a name='3069'>
  if (config_flags%open_ye .and. jte .eq. jde) then<a name='3070'>
    jtf = jtf-1<a name='3071'>
  endif<a name='3072'>
  do j = j_start, jtf<a name='3073'>
    do k = 2, kte-1<a name='3074'>
      do i = i_start, itf<a name='3075'>
        g_ph_tend(i,k,j) = (-(0.25*g_muv(i,j+1)*rdy*(v(i,k,j+1)+v(i,k-1,j+1))*(phb(i,k,j+1)-phb(i,k,j)+ph(i,k,j+1)-ph(i,k,j))))-&amp;<a name='3076'>
&amp;0.25*g_muv(i,j)*rdy*(v(i,k,j)+v(i,k-1,j))*(phb(i,k,j)-phb(i,k,j-1)+ph(i,k,j)-ph(i,k,j-1))+0.25*g_ph(i,k,j-1)*rdy*muv(i,j)*&amp;<a name='3077'>
&amp;(v(i,k,j)+v(i,k-1,j))-0.25*g_ph(i,k,j+1)*rdy*muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))-0.25*g_ph(i,k,j)*rdy*((-(muv(i,j+1)*&amp;<a name='3078'>
&amp;(v(i,k,j+1)+v(i,k-1,j+1))))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))+g_ph_tend(i,k,j)-0.25*g_v(i,k-1,j+1)*rdy*muv(i,j+1)*(phb(i,k,&amp;<a name='3079'>
&amp;j+1)-phb(i,k,j)+ph(i,k,j+1)-ph(i,k,j))-0.25*g_v(i,k-1,j)*rdy*muv(i,j)*(phb(i,k,j)-phb(i,k,j-1)+ph(i,k,j)-ph(i,k,j-1))-&amp;<a name='3080'>
&amp;0.25*g_v(i,k,j+1)*rdy*muv(i,j+1)*(phb(i,k,j+1)-phb(i,k,j)+ph(i,k,j+1)-ph(i,k,j))-0.25*g_v(i,k,j)*rdy*muv(i,j)*(phb(i,k,j)-&amp;<a name='3081'>
&amp;phb(i,k,j-1)+ph(i,k,j)-ph(i,k,j-1))<a name='3082'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))*(phb(i,k,j+1)-phb(i,k,j)+ph(i,k,j+1)-ph(i,k,&amp;<a name='3083'>
&amp;j))+muv(i,j)*(v(i,k,j)+v(i,k-1,j))*(phb(i,k,j)-phb(i,k,j-1)+ph(i,k,j)-ph(i,k,j-1)))<a name='3084'>
      end do<a name='3085'>
    end do<a name='3086'>
    k = kte<a name='3087'>
    do i = i_start, itf<a name='3088'>
      g_ph_tend(i,k,j) = (-(0.5*g_muv(i,j+1)*rdy*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))*(phb(i,k,j+1)-phb(i,k,j)+ph(i,k,j+1)-ph(i,k,&amp;<a name='3089'>
&amp;j))))-0.5*g_muv(i,j)*rdy*(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j))*(phb(i,k,j)-phb(i,k,j-1)+ph(i,k,j)-ph(i,k,j-1))+0.5*g_ph(i,k,j-1)*&amp;<a name='3090'>
&amp;rdy*muv(i,j)*(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j))-0.5*g_ph(i,k,j+1)*rdy*muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))-0.5*&amp;<a name='3091'>
&amp;g_ph(i,k,j)*rdy*((-(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))))+muv(i,j)*(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j)))+&amp;<a name='3092'>
&amp;g_ph_tend(i,k,j)-0.5*g_v(i,k-2,j+1)*rdy*muv(i,j+1)*cfn1*(phb(i,k,j+1)-phb(i,k,j)+ph(i,k,j+1)-ph(i,k,j))-0.5*g_v(i,k-2,j)*&amp;<a name='3093'>
&amp;rdy*muv(i,j)*cfn1*(phb(i,k,j)-phb(i,k,j-1)+ph(i,k,j)-ph(i,k,j-1))-0.5*g_v(i,k-1,j+1)*rdy*muv(i,j+1)*cfn*(phb(i,k,j+1)-phb(i,&amp;<a name='3094'>
&amp;k,j)+ph(i,k,j+1)-ph(i,k,j))-0.5*g_v(i,k-1,j)*rdy*muv(i,j)*cfn*(phb(i,k,j)-phb(i,k,j-1)+ph(i,k,j)-ph(i,k,j-1))<a name='3095'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))*(phb(i,k,j+1)-phb(i,k,j)+ph(i,k,j+1)&amp;<a name='3096'>
&amp;-ph(i,k,j))+muv(i,j)*(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j))*(phb(i,k,j)-phb(i,k,j-1)+ph(i,k,j)-ph(i,k,j-1)))<a name='3097'>
    end do<a name='3098'>
  end do<a name='3099'>
  i_start = its<a name='3100'>
  j_start = jts<a name='3101'>
  itf = min(ite,ide-1)<a name='3102'>
  jtf = min(jte,jde-1)<a name='3103'>
  if (config_flags%open_xs .and. its .eq. ids) then<a name='3104'>
    i_start = its+1<a name='3105'>
  endif<a name='3106'>
  if (config_flags%open_xe .and. ite .eq. ide) then<a name='3107'>
    itf = itf-1<a name='3108'>
  endif<a name='3109'>
  do j = j_start, jtf<a name='3110'>
    do k = 2, kte-1<a name='3111'>
      do i = i_start, itf<a name='3112'>
        g_ph_tend(i,k,j) = (-(0.25*g_muu(i+1,j)*rdx*(u(i+1,k,j)+u(i+1,k-1,j))*(phb(i+1,k,j)-phb(i,k,j)+ph(i+1,k,j)-ph(i,k,j))))-&amp;<a name='3113'>
&amp;0.25*g_muu(i,j)*rdx*(u(i,k,j)+u(i,k-1,j))*(phb(i,k,j)-phb(i-1,k,j)+ph(i,k,j)-ph(i-1,k,j))+0.25*g_ph(i-1,k,j)*rdx*muu(i,j)*&amp;<a name='3114'>
&amp;(u(i,k,j)+u(i,k-1,j))-0.25*g_ph(i+1,k,j)*rdx*muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))-0.25*g_ph(i,k,j)*rdx*((-(muu(i+1,j)*&amp;<a name='3115'>
&amp;(u(i+1,k,j)+u(i+1,k-1,j))))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))+g_ph_tend(i,k,j)-0.25*g_u(i+1,k-1,j)*rdx*muu(i+1,j)*(phb(i+1,&amp;<a name='3116'>
&amp;k,j)-phb(i,k,j)+ph(i+1,k,j)-ph(i,k,j))-0.25*g_u(i,k-1,j)*rdx*muu(i,j)*(phb(i,k,j)-phb(i-1,k,j)+ph(i,k,j)-ph(i-1,k,j))-&amp;<a name='3117'>
&amp;0.25*g_u(i+1,k,j)*rdx*muu(i+1,j)*(phb(i+1,k,j)-phb(i,k,j)+ph(i+1,k,j)-ph(i,k,j))-0.25*g_u(i,k,j)*rdx*muu(i,j)*(phb(i,k,j)-&amp;<a name='3118'>
&amp;phb(i-1,k,j)+ph(i,k,j)-ph(i-1,k,j))<a name='3119'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))*(phb(i+1,k,j)-phb(i,k,j)+ph(i+1,k,j)-ph(i,k,&amp;<a name='3120'>
&amp;j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j))*(phb(i,k,j)-phb(i-1,k,j)+ph(i,k,j)-ph(i-1,k,j)))<a name='3121'>
      end do<a name='3122'>
    end do<a name='3123'>
    k = kte<a name='3124'>
    do i = i_start, itf<a name='3125'>
      g_ph_tend(i,k,j) = (-(0.5*g_muu(i+1,j)*rdx*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))*(phb(i+1,k,j)-phb(i,k,j)+ph(i+1,k,j)-ph(i,k,&amp;<a name='3126'>
&amp;j))))-0.5*g_muu(i,j)*rdx*(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j))*(phb(i,k,j)-phb(i-1,k,j)+ph(i,k,j)-ph(i-1,k,j))+0.5*g_ph(i-1,k,j)*&amp;<a name='3127'>
&amp;rdx*muu(i,j)*(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j))-0.5*g_ph(i+1,k,j)*rdx*muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))-0.5*&amp;<a name='3128'>
&amp;g_ph(i,k,j)*rdx*((-(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))))+muu(i,j)*(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j)))+&amp;<a name='3129'>
&amp;g_ph_tend(i,k,j)-0.5*g_u(i+1,k-2,j)*rdx*muu(i+1,j)*cfn1*(phb(i+1,k,j)-phb(i,k,j)+ph(i+1,k,j)-ph(i,k,j))-0.5*g_u(i,k-2,j)*&amp;<a name='3130'>
&amp;rdx*muu(i,j)*cfn1*(phb(i,k,j)-phb(i-1,k,j)+ph(i,k,j)-ph(i-1,k,j))-0.5*g_u(i+1,k-1,j)*rdx*muu(i+1,j)*cfn*(phb(i+1,k,j)-phb(i,&amp;<a name='3131'>
&amp;k,j)+ph(i+1,k,j)-ph(i,k,j))-0.5*g_u(i,k-1,j)*rdx*muu(i,j)*cfn*(phb(i,k,j)-phb(i-1,k,j)+ph(i,k,j)-ph(i-1,k,j))<a name='3132'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))*(phb(i+1,k,j)-phb(i,k,j)+ph(i+1,k,j)&amp;<a name='3133'>
&amp;-ph(i,k,j))+muu(i,j)*(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j))*(phb(i,k,j)-phb(i-1,k,j)+ph(i,k,j)-ph(i-1,k,j)))<a name='3134'>
    end do<a name='3135'>
  end do<a name='3136'>
else if (advective_order .le. 4) then<a name='3137'>
  i_start = its<a name='3138'>
  j_start = jts<a name='3139'>
  itf = min(ite,ide-1)<a name='3140'>
  jtf = min(jte,jde-1)<a name='3141'>
  if (config_flags%open_ys .and. jts .eq. jds) then<a name='3142'>
    j_start = jts+1<a name='3143'>
  endif<a name='3144'>
  if (config_flags%open_ye .and. jte .eq. jde) then<a name='3145'>
    jtf = jtf-1<a name='3146'>
  endif<a name='3147'>
  do j = j_start, jtf<a name='3148'>
    do k = 2, kte-1<a name='3149'>
      do i = i_start, itf<a name='3150'>
        g_ph_tend(i,k,j) = (-(0.083333333*0.25*g_muv(i,j+1)*rdy*(v(i,k,j+1)+v(i,k-1,j+1))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+&amp;<a name='3151'>
&amp;2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))))-0.083333333*0.25*g_muv(i,j)*rdy*(v(i,k,j)+&amp;<a name='3152'>
&amp;v(i,k-1,j))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,&amp;<a name='3153'>
&amp;j-2)))-0.083333333*0.25*g_ph(i,k,j-2)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-(-&amp;<a name='3154'>
&amp;0.66666667)*0.25*g_ph(i,k,j-1)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-(-0.083333333)*&amp;<a name='3155'>
&amp;0.25*g_ph(i,k,j+2)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-0.66666667*0.25*g_ph(i,k,j+1)&amp;<a name='3156'>
&amp;*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))+g_ph_tend(i,k,j)-0.083333333*0.25*g_v(i,k-1,j+&amp;<a name='3157'>
&amp;1)*rdy*muv(i,j+1)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3158'>
&amp;phb(i,k,j-2)))-0.083333333*0.25*g_v(i,k-1,j)*rdy*muv(i,j)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*&amp;<a name='3159'>
&amp;(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.25*g_v(i,k,j+1)*rdy*muv(i,j+1)*(8.*(ph(i,k,j+1)-&amp;<a name='3160'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.25*g_v(i,&amp;<a name='3161'>
&amp;k,j)*rdy*muv(i,j)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3162'>
&amp;phb(i,k,j-2)))<a name='3163'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))*(1./12.)*&amp;<a name='3164'>
&amp;(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3165'>
      end do<a name='3166'>
    end do<a name='3167'>
    k = kte<a name='3168'>
    do i = i_start, itf<a name='3169'>
      g_ph_tend(i,k,j) = (-(0.083333333*0.5*g_muv(i,j+1)*rdy*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-&amp;<a name='3170'>
&amp;(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))))-0.083333333*0.5*g_muv(i,j)*rdy*(cfn*&amp;<a name='3171'>
&amp;v(i,k-1,j)+cfn1*v(i,k-2,j))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,&amp;<a name='3172'>
&amp;j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_ph(i,k,j-2)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-&amp;<a name='3173'>
&amp;1,j)+cfn1*v(i,k-2,j)))-(-0.66666667)*0.5*g_ph(i,k,j-1)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*&amp;<a name='3174'>
&amp;v(i,k-1,j)+cfn1*v(i,k-2,j)))-(-0.083333333)*0.5*g_ph(i,k,j+2)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*&amp;<a name='3175'>
&amp;(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j)))-0.66666667*0.5*g_ph(i,k,j+1)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)&amp;<a name='3176'>
&amp;*(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j)))+g_ph_tend(i,k,j)-0.083333333*0.5*g_v(i,k-2,j+1)*rdy*muv(i,j+1)*cfn1*(8.*(ph(i,k,j+1)-&amp;<a name='3177'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-&amp;<a name='3178'>
&amp;2,j)*rdy*muv(i,j)*cfn1*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3179'>
&amp;phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-1,j+1)*rdy*muv(i,j+1)*cfn*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*&amp;<a name='3180'>
&amp;(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-1,j)*rdy*muv(i,j)*cfn*(8.*(ph(i,k,j+1)-&amp;<a name='3181'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3182'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,j)+cfn1*v(i,k-&amp;<a name='3183'>
&amp;2,j)))*(1./12.)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3184'>
    end do<a name='3185'>
  end do<a name='3186'>
  i_start = its<a name='3187'>
  j_start = jts<a name='3188'>
  itf = min(ite,ide-1)<a name='3189'>
  jtf = min(jte,jde-1)<a name='3190'>
  if (config_flags%open_xs .and. its .eq. ids) then<a name='3191'>
    i_start = its+1<a name='3192'>
  endif<a name='3193'>
  if (config_flags%open_xe .and. ite .eq. ide) then<a name='3194'>
    itf = itf-1<a name='3195'>
  endif<a name='3196'>
  do j = j_start, jtf<a name='3197'>
    do k = 2, kte-1<a name='3198'>
      do i = i_start, itf<a name='3199'>
        g_ph_tend(i,k,j) = (-(0.083333333*0.25*g_muu(i+1,j)*rdx*(u(i+1,k,j)+u(i+1,k-1,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,&amp;<a name='3200'>
&amp;j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))))-0.083333333*0.25*g_muu(i,j)*rdx*(u(i,k,j)+&amp;<a name='3201'>
&amp;u(i,k-1,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,&amp;<a name='3202'>
&amp;k,j)))-0.083333333*0.25*g_ph(i-2,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-(-&amp;<a name='3203'>
&amp;0.66666667)*0.25*g_ph(i-1,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-(-0.083333333)*&amp;<a name='3204'>
&amp;0.25*g_ph(i+2,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-0.66666667*0.25*g_ph(i+1,k,j)&amp;<a name='3205'>
&amp;*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))+g_ph_tend(i,k,j)-0.083333333*0.25*g_u(i+1,k-1,&amp;<a name='3206'>
&amp;j)*rdx*muu(i+1,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3207'>
&amp;phb(i-2,k,j)))-0.083333333*0.25*g_u(i,k-1,j)*rdx*muu(i,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*&amp;<a name='3208'>
&amp;(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.25*g_u(i+1,k,j)*rdx*muu(i+1,j)*(8.*(ph(i+1,k,j)-&amp;<a name='3209'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.25*g_u(i,&amp;<a name='3210'>
&amp;k,j)*rdx*muu(i,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3211'>
&amp;phb(i-2,k,j)))<a name='3212'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))*(1./12.)*&amp;<a name='3213'>
&amp;(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3214'>
      end do<a name='3215'>
    end do<a name='3216'>
    k = kte<a name='3217'>
    do i = i_start, itf<a name='3218'>
      g_ph_tend(i,k,j) = (-(0.083333333*0.5*g_muu(i+1,j)*rdx*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-&amp;<a name='3219'>
&amp;(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))))-0.083333333*0.5*g_muu(i,j)*rdx*(cfn*&amp;<a name='3220'>
&amp;u(i,k-1,j)+cfn1*u(i,k-2,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,&amp;<a name='3221'>
&amp;k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_ph(i-2,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-&amp;<a name='3222'>
&amp;1,j)+cfn1*u(i,k-2,j)))-(-0.66666667)*0.5*g_ph(i-1,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*&amp;<a name='3223'>
&amp;u(i,k-1,j)+cfn1*u(i,k-2,j)))-(-0.083333333)*0.5*g_ph(i+2,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*&amp;<a name='3224'>
&amp;(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j)))-0.66666667*0.5*g_ph(i+1,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)&amp;<a name='3225'>
&amp;*(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j)))+g_ph_tend(i,k,j)-0.083333333*0.5*g_u(i+1,k-2,j)*rdx*muu(i+1,j)*cfn1*(8.*(ph(i+1,k,j)-&amp;<a name='3226'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_u(i,k-&amp;<a name='3227'>
&amp;2,j)*rdx*muu(i,j)*cfn1*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3228'>
&amp;phb(i-2,k,j)))-0.083333333*0.5*g_u(i+1,k-1,j)*rdx*muu(i+1,j)*cfn*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*&amp;<a name='3229'>
&amp;(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_u(i,k-1,j)*rdx*muu(i,j)*cfn*(8.*(ph(i+1,k,j)-&amp;<a name='3230'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3231'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,j)+cfn1*u(i,k-&amp;<a name='3232'>
&amp;2,j)))*(1./12.)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3233'>
    end do<a name='3234'>
  end do<a name='3235'>
else if (advective_order .le. 6) then<a name='3236'>
  i_start = its<a name='3237'>
  j_start = jts<a name='3238'>
  itf = min(ite,ide-1)<a name='3239'>
  jtf = min(jte,jde-1)<a name='3240'>
  if (config_flags%open_ys .or. specified) then<a name='3241'>
    j_start = max(jts,jds+2)<a name='3242'>
  endif<a name='3243'>
  if (config_flags%open_ye .or. specified) then<a name='3244'>
    jtf = min(jtf,jde-3)<a name='3245'>
  endif<a name='3246'>
  do j = j_start, jtf<a name='3247'>
    do k = 2, kte-1<a name='3248'>
      do i = i_start, itf<a name='3249'>
        g_ph_tend(i,k,j) = (-(0.016666667*0.25*g_muv(i,j+1)*rdy*(v(i,k,j+1)+v(i,k-1,j+1))*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,&amp;<a name='3250'>
&amp;k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-&amp;<a name='3251'>
&amp;phb(i,k,j-3))))-0.016666667*0.25*g_muv(i,j)*rdy*(v(i,k,j)+v(i,k-1,j))*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,&amp;<a name='3252'>
&amp;k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))-&amp;<a name='3253'>
&amp;(-0.016666667)*0.25*g_ph(i,k,j-3)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-0.15*0.25*&amp;<a name='3254'>
&amp;g_ph(i,k,j-2)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-(-0.75)*0.25*g_ph(i,k,j-1)*rdy*&amp;<a name='3255'>
&amp;(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-0.016666667*0.25*g_ph(i,k,j+3)*rdy*(muv(i,j+1)*(v(i,&amp;<a name='3256'>
&amp;k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-(-0.15)*0.25*g_ph(i,k,j+2)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+&amp;<a name='3257'>
&amp;muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-0.75*0.25*g_ph(i,k,j+1)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,&amp;<a name='3258'>
&amp;k-1,j)))+g_ph_tend(i,k,j)-0.016666667*0.25*g_v(i,k-1,j+1)*rdy*muv(i,j+1)*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-&amp;<a name='3259'>
&amp;ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,&amp;<a name='3260'>
&amp;j-3))-0.016666667*0.25*g_v(i,k-1,j)*rdy*muv(i,j)*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-&amp;<a name='3261'>
&amp;ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))-0.016666667*0.25*&amp;<a name='3262'>
&amp;g_v(i,k,j+1)*rdy*muv(i,j+1)*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*&amp;<a name='3263'>
&amp;(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))-0.016666667*0.25*g_v(i,k,j)*rdy*&amp;<a name='3264'>
&amp;muv(i,j)*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-&amp;<a name='3265'>
&amp;1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))<a name='3266'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))*(1./60.)*&amp;<a name='3267'>
&amp;(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*&amp;<a name='3268'>
&amp;(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))<a name='3269'>
      end do<a name='3270'>
    end do<a name='3271'>
    k = kte<a name='3272'>
    do i = i_start, itf<a name='3273'>
      g_ph_tend(i,k,j) = (-(0.016666667*0.5*g_muv(i,j+1)*rdy*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-&amp;<a name='3274'>
&amp;9.*(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,&amp;<a name='3275'>
&amp;j+3)-phb(i,k,j-3))))-0.016666667*0.5*g_muv(i,j)*rdy*(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j))*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*&amp;<a name='3276'>
&amp;(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+&amp;<a name='3277'>
&amp;3)-phb(i,k,j-3))-(-0.016666667)*0.5*g_ph(i,k,j-3)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-&amp;<a name='3278'>
&amp;1,j)+cfn1*v(i,k-2,j)))-0.15*0.5*g_ph(i,k,j-2)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,j)+&amp;<a name='3279'>
&amp;cfn1*v(i,k-2,j)))-(-0.75)*0.5*g_ph(i,k,j-1)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,j)+&amp;<a name='3280'>
&amp;cfn1*v(i,k-2,j)))-0.016666667*0.5*g_ph(i,k,j+3)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,&amp;<a name='3281'>
&amp;j)+cfn1*v(i,k-2,j)))-(-0.15)*0.5*g_ph(i,k,j+2)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,j)&amp;<a name='3282'>
&amp;+cfn1*v(i,k-2,j)))-0.75*0.5*g_ph(i,k,j+1)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,j)+&amp;<a name='3283'>
&amp;cfn1*v(i,k-2,j)))+g_ph_tend(i,k,j)-0.016666667*0.5*g_v(i,k-2,j+1)*rdy*muv(i,j+1)*cfn1*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*&amp;<a name='3284'>
&amp;(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+&amp;<a name='3285'>
&amp;3)-phb(i,k,j-3))-0.016666667*0.5*g_v(i,k-2,j)*rdy*muv(i,j)*cfn1*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,k,j-2))+&amp;<a name='3286'>
&amp;ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))-&amp;<a name='3287'>
&amp;0.016666667*0.5*g_v(i,k-1,j+1)*rdy*muv(i,j+1)*cfn*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-&amp;<a name='3288'>
&amp;ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))-0.016666667*0.5*g_v(i,&amp;<a name='3289'>
&amp;k-1,j)*rdy*muv(i,j)*cfn*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+&amp;<a name='3290'>
&amp;1)-phb(i,k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))<a name='3291'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,j)+cfn1*v(i,k-&amp;<a name='3292'>
&amp;2,j)))*(1./60.)*(45.*(ph(i,k,j+1)-ph(i,k,j-1))-9.*(ph(i,k,j+2)-ph(i,k,j-2))+ph(i,k,j+3)-ph(i,k,j-3)+45.*(phb(i,k,j+1)-phb(i,&amp;<a name='3293'>
&amp;k,j-1))-9.*(phb(i,k,j+2)-phb(i,k,j-2))+phb(i,k,j+3)-phb(i,k,j-3))<a name='3294'>
    end do<a name='3295'>
  end do<a name='3296'>
  if (config_flags%open_ys .and. jts .le. jds+1) then<a name='3297'>
    j = jds+1<a name='3298'>
    do k = 2, kte-1<a name='3299'>
      do i = i_start, itf<a name='3300'>
        g_ph_tend(i,k,j) = (-(0.083333333*0.25*g_muv(i,j+1)*rdy*(v(i,k,j+1)+v(i,k-1,j+1))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+&amp;<a name='3301'>
&amp;2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))))-0.083333333*0.25*g_muv(i,j)*rdy*(v(i,k,j)+&amp;<a name='3302'>
&amp;v(i,k-1,j))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,&amp;<a name='3303'>
&amp;j-2)))-0.083333333*0.25*g_ph(i,k,j-2)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-(-&amp;<a name='3304'>
&amp;0.66666667)*0.25*g_ph(i,k,j-1)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-(-0.083333333)*&amp;<a name='3305'>
&amp;0.25*g_ph(i,k,j+2)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-0.66666667*0.25*g_ph(i,k,j+1)&amp;<a name='3306'>
&amp;*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))+g_ph_tend(i,k,j)-0.083333333*0.25*g_v(i,k-1,j+&amp;<a name='3307'>
&amp;1)*rdy*muv(i,j+1)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3308'>
&amp;phb(i,k,j-2)))-0.083333333*0.25*g_v(i,k-1,j)*rdy*muv(i,j)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*&amp;<a name='3309'>
&amp;(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.25*g_v(i,k,j+1)*rdy*muv(i,j+1)*(8.*(ph(i,k,j+1)-&amp;<a name='3310'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.25*g_v(i,&amp;<a name='3311'>
&amp;k,j)*rdy*muv(i,j)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3312'>
&amp;phb(i,k,j-2)))<a name='3313'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))*(1./12.)*&amp;<a name='3314'>
&amp;(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3315'>
      end do<a name='3316'>
    end do<a name='3317'>
    k = kte<a name='3318'>
    do i = i_start, itf<a name='3319'>
      g_ph_tend(i,k,j) = (-(0.083333333*0.5*g_muv(i,j+1)*rdy*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-&amp;<a name='3320'>
&amp;(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))))-0.083333333*0.5*g_muv(i,j)*rdy*(cfn*&amp;<a name='3321'>
&amp;v(i,k-1,j)+cfn1*v(i,k-2,j))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,&amp;<a name='3322'>
&amp;j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_ph(i,k,j-2)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-&amp;<a name='3323'>
&amp;1,j)+cfn1*v(i,k-2,j)))-(-0.66666667)*0.5*g_ph(i,k,j-1)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*&amp;<a name='3324'>
&amp;v(i,k-1,j)+cfn1*v(i,k-2,j)))-(-0.083333333)*0.5*g_ph(i,k,j+2)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*&amp;<a name='3325'>
&amp;(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j)))-0.66666667*0.5*g_ph(i,k,j+1)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)&amp;<a name='3326'>
&amp;*(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j)))+g_ph_tend(i,k,j)-0.083333333*0.5*g_v(i,k-2,j+1)*rdy*muv(i,j+1)*cfn1*(8.*(ph(i,k,j+1)-&amp;<a name='3327'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-&amp;<a name='3328'>
&amp;2,j)*rdy*muv(i,j)*cfn1*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3329'>
&amp;phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-1,j+1)*rdy*muv(i,j+1)*cfn*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*&amp;<a name='3330'>
&amp;(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-1,j)*rdy*muv(i,j)*cfn*(8.*(ph(i,k,j+1)-&amp;<a name='3331'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3332'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,j)+cfn1*v(i,k-&amp;<a name='3333'>
&amp;2,j)))*(1./12.)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3334'>
    end do<a name='3335'>
  endif<a name='3336'>
  if (config_flags%open_ye .and. jte .ge. jde-2) then<a name='3337'>
    j = jde-2<a name='3338'>
    do k = 2, kte-1<a name='3339'>
      do i = i_start, itf<a name='3340'>
        g_ph_tend(i,k,j) = (-(0.083333333*0.25*g_muv(i,j+1)*rdy*(v(i,k,j+1)+v(i,k-1,j+1))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+&amp;<a name='3341'>
&amp;2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))))-0.083333333*0.25*g_muv(i,j)*rdy*(v(i,k,j)+&amp;<a name='3342'>
&amp;v(i,k-1,j))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,&amp;<a name='3343'>
&amp;j-2)))-0.083333333*0.25*g_ph(i,k,j-2)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-(-&amp;<a name='3344'>
&amp;0.66666667)*0.25*g_ph(i,k,j-1)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-(-0.083333333)*&amp;<a name='3345'>
&amp;0.25*g_ph(i,k,j+2)*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))-0.66666667*0.25*g_ph(i,k,j+1)&amp;<a name='3346'>
&amp;*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))+g_ph_tend(i,k,j)-0.083333333*0.25*g_v(i,k-1,j+&amp;<a name='3347'>
&amp;1)*rdy*muv(i,j+1)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3348'>
&amp;phb(i,k,j-2)))-0.083333333*0.25*g_v(i,k-1,j)*rdy*muv(i,j)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*&amp;<a name='3349'>
&amp;(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.25*g_v(i,k,j+1)*rdy*muv(i,j+1)*(8.*(ph(i,k,j+1)-&amp;<a name='3350'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.25*g_v(i,&amp;<a name='3351'>
&amp;k,j)*rdy*muv(i,j)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3352'>
&amp;phb(i,k,j-2)))<a name='3353'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdy*(muv(i,j+1)*(v(i,k,j+1)+v(i,k-1,j+1))+muv(i,j)*(v(i,k,j)+v(i,k-1,j)))*(1./12.)*&amp;<a name='3354'>
&amp;(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3355'>
      end do<a name='3356'>
    end do<a name='3357'>
    k = kte<a name='3358'>
    do i = i_start, itf<a name='3359'>
      g_ph_tend(i,k,j) = (-(0.083333333*0.5*g_muv(i,j+1)*rdy*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-&amp;<a name='3360'>
&amp;(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))))-0.083333333*0.5*g_muv(i,j)*rdy*(cfn*&amp;<a name='3361'>
&amp;v(i,k-1,j)+cfn1*v(i,k-2,j))*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,&amp;<a name='3362'>
&amp;j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_ph(i,k,j-2)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-&amp;<a name='3363'>
&amp;1,j)+cfn1*v(i,k-2,j)))-(-0.66666667)*0.5*g_ph(i,k,j-1)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*&amp;<a name='3364'>
&amp;v(i,k-1,j)+cfn1*v(i,k-2,j)))-(-0.083333333)*0.5*g_ph(i,k,j+2)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*&amp;<a name='3365'>
&amp;(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j)))-0.66666667*0.5*g_ph(i,k,j+1)*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)&amp;<a name='3366'>
&amp;*(cfn*v(i,k-1,j)+cfn1*v(i,k-2,j)))+g_ph_tend(i,k,j)-0.083333333*0.5*g_v(i,k-2,j+1)*rdy*muv(i,j+1)*cfn1*(8.*(ph(i,k,j+1)-&amp;<a name='3367'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-&amp;<a name='3368'>
&amp;2,j)*rdy*muv(i,j)*cfn1*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-&amp;<a name='3369'>
&amp;phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-1,j+1)*rdy*muv(i,j+1)*cfn*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*&amp;<a name='3370'>
&amp;(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))-0.083333333*0.5*g_v(i,k-1,j)*rdy*muv(i,j)*cfn*(8.*(ph(i,k,j+1)-&amp;<a name='3371'>
&amp;ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3372'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdy*(muv(i,j+1)*(cfn*v(i,k-1,j+1)+cfn1*v(i,k-2,j+1))+muv(i,j)*(cfn*v(i,k-1,j)+cfn1*v(i,k-&amp;<a name='3373'>
&amp;2,j)))*(1./12.)*(8.*(ph(i,k,j+1)-ph(i,k,j-1))-(ph(i,k,j+2)-ph(i,k,j-2))+8.*(phb(i,k,j+1)-phb(i,k,j-1))-(phb(i,k,j+2)-phb(i,k,j-2)))<a name='3374'>
    end do<a name='3375'>
  endif<a name='3376'>
  i_start = its<a name='3377'>
  j_start = jts<a name='3378'>
  itf = min(ite,ide-1)<a name='3379'>
  jtf = min(jte,jde-1)<a name='3380'>
  if (config_flags%open_xs .or. specified) then<a name='3381'>
    i_start = max(its,ids+2)<a name='3382'>
  endif<a name='3383'>
  if (config_flags%open_xe .or. specified) then<a name='3384'>
    itf = min(itf,ide-3)<a name='3385'>
  endif<a name='3386'>
  do j = j_start, jtf<a name='3387'>
    do k = 2, kte-1<a name='3388'>
      do i = i_start, itf<a name='3389'>
        g_ph_tend(i,k,j) = (-(0.016666667*0.25*g_muu(i+1,j)*rdx*(u(i+1,k,j)+u(i+1,k-1,j))*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+&amp;<a name='3390'>
&amp;2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-&amp;<a name='3391'>
&amp;phb(i-3,k,j))))-0.016666667*0.25*g_muu(i,j)*rdx*(u(i,k,j)+u(i,k-1,j))*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-&amp;<a name='3392'>
&amp;2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))-&amp;<a name='3393'>
&amp;(-0.016666667)*0.25*g_ph(i-3,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-0.15*0.25*&amp;<a name='3394'>
&amp;g_ph(i-2,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-(-0.75)*0.25*g_ph(i-1,k,j)*rdx*&amp;<a name='3395'>
&amp;(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-0.016666667*0.25*g_ph(i+3,k,j)*rdx*(muu(i+1,j)*(u(i+&amp;<a name='3396'>
&amp;1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-(-0.15)*0.25*g_ph(i+2,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+&amp;<a name='3397'>
&amp;muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-0.75*0.25*g_ph(i+1,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,&amp;<a name='3398'>
&amp;k-1,j)))+g_ph_tend(i,k,j)-0.016666667*0.25*g_u(i+1,k-1,j)*rdx*muu(i+1,j)*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-&amp;<a name='3399'>
&amp;ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,&amp;<a name='3400'>
&amp;k,j))-0.016666667*0.25*g_u(i,k-1,j)*rdx*muu(i,j)*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-&amp;<a name='3401'>
&amp;ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))-0.016666667*0.25*&amp;<a name='3402'>
&amp;g_u(i+1,k,j)*rdx*muu(i+1,j)*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*&amp;<a name='3403'>
&amp;(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))-0.016666667*0.25*g_u(i,k,j)*rdx*&amp;<a name='3404'>
&amp;muu(i,j)*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,&amp;<a name='3405'>
&amp;j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))<a name='3406'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))*(1./60.)*&amp;<a name='3407'>
&amp;(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*&amp;<a name='3408'>
&amp;(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))<a name='3409'>
      end do<a name='3410'>
    end do<a name='3411'>
    k = kte<a name='3412'>
    do i = i_start, itf<a name='3413'>
      g_ph_tend(i,k,j) = (-(0.016666667*0.5*g_muu(i+1,j)*rdx*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-&amp;<a name='3414'>
&amp;9.*(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,&amp;<a name='3415'>
&amp;k,j)-phb(i-3,k,j))))-0.016666667*0.5*g_muu(i,j)*rdx*(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j))*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*&amp;<a name='3416'>
&amp;(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,&amp;<a name='3417'>
&amp;j)-phb(i-3,k,j))-(-0.016666667)*0.5*g_ph(i-3,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-&amp;<a name='3418'>
&amp;1,j)+cfn1*u(i,k-2,j)))-0.15*0.5*g_ph(i-2,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,j)+&amp;<a name='3419'>
&amp;cfn1*u(i,k-2,j)))-(-0.75)*0.5*g_ph(i-1,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,j)+&amp;<a name='3420'>
&amp;cfn1*u(i,k-2,j)))-0.016666667*0.5*g_ph(i+3,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,&amp;<a name='3421'>
&amp;j)+cfn1*u(i,k-2,j)))-(-0.15)*0.5*g_ph(i+2,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,j)&amp;<a name='3422'>
&amp;+cfn1*u(i,k-2,j)))-0.75*0.5*g_ph(i+1,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,j)+&amp;<a name='3423'>
&amp;cfn1*u(i,k-2,j)))+g_ph_tend(i,k,j)-0.016666667*0.5*g_u(i+1,k-2,j)*rdx*muu(i+1,j)*cfn1*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*&amp;<a name='3424'>
&amp;(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,&amp;<a name='3425'>
&amp;j)-phb(i-3,k,j))-0.016666667*0.5*g_u(i,k-2,j)*rdx*muu(i,j)*cfn1*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-2,k,j))+&amp;<a name='3426'>
&amp;ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))-&amp;<a name='3427'>
&amp;0.016666667*0.5*g_u(i+1,k-1,j)*rdx*muu(i+1,j)*cfn*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-&amp;<a name='3428'>
&amp;ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))-0.016666667*0.5*g_u(i,&amp;<a name='3429'>
&amp;k-1,j)*rdx*muu(i,j)*cfn*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,&amp;<a name='3430'>
&amp;j)-phb(i-1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))<a name='3431'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,j)+cfn1*u(i,k-&amp;<a name='3432'>
&amp;2,j)))*(1./60.)*(45.*(ph(i+1,k,j)-ph(i-1,k,j))-9.*(ph(i+2,k,j)-ph(i-2,k,j))+ph(i+3,k,j)-ph(i-3,k,j)+45.*(phb(i+1,k,j)-phb(i-&amp;<a name='3433'>
&amp;1,k,j))-9.*(phb(i+2,k,j)-phb(i-2,k,j))+phb(i+3,k,j)-phb(i-3,k,j))<a name='3434'>
    end do<a name='3435'>
  end do<a name='3436'>
  if (config_flags%open_xs .and. its .le. ids+1) then<a name='3437'>
    i = ids+1<a name='3438'>
    do j = j_start, jtf<a name='3439'>
      do k = 2, kte-1<a name='3440'>
        g_ph_tend(i,k,j) = (-(0.083333333*0.25*g_muu(i+1,j)*rdx*(u(i+1,k,j)+u(i+1,k-1,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,&amp;<a name='3441'>
&amp;j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))))-0.083333333*0.25*g_muu(i,j)*rdx*(u(i,k,j)+&amp;<a name='3442'>
&amp;u(i,k-1,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,&amp;<a name='3443'>
&amp;k,j)))-0.083333333*0.25*g_ph(i-2,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-(-&amp;<a name='3444'>
&amp;0.66666667)*0.25*g_ph(i-1,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-(-0.083333333)*&amp;<a name='3445'>
&amp;0.25*g_ph(i+2,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-0.66666667*0.25*g_ph(i+1,k,j)&amp;<a name='3446'>
&amp;*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))+g_ph_tend(i,k,j)-0.083333333*0.25*g_u(i+1,k-1,&amp;<a name='3447'>
&amp;j)*rdx*muu(i+1,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3448'>
&amp;phb(i-2,k,j)))-0.083333333*0.25*g_u(i,k-1,j)*rdx*muu(i,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*&amp;<a name='3449'>
&amp;(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.25*g_u(i+1,k,j)*rdx*muu(i+1,j)*(8.*(ph(i+1,k,j)-&amp;<a name='3450'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.25*g_u(i,&amp;<a name='3451'>
&amp;k,j)*rdx*muu(i,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3452'>
&amp;phb(i-2,k,j)))<a name='3453'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))*(1./12.)*&amp;<a name='3454'>
&amp;(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3455'>
      end do<a name='3456'>
      k = kte<a name='3457'>
      g_ph_tend(i,k,j) = (-(0.083333333*0.5*g_muu(i+1,j)*rdx*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-&amp;<a name='3458'>
&amp;(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))))-0.083333333*0.5*g_muu(i,j)*rdx*(cfn*&amp;<a name='3459'>
&amp;u(i,k-1,j)+cfn1*u(i,k-2,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,&amp;<a name='3460'>
&amp;k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_ph(i-2,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-&amp;<a name='3461'>
&amp;1,j)+cfn1*u(i,k-2,j)))-(-0.66666667)*0.5*g_ph(i-1,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*&amp;<a name='3462'>
&amp;u(i,k-1,j)+cfn1*u(i,k-2,j)))-(-0.083333333)*0.5*g_ph(i+2,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*&amp;<a name='3463'>
&amp;(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j)))-0.66666667*0.5*g_ph(i+1,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)&amp;<a name='3464'>
&amp;*(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j)))+g_ph_tend(i,k,j)-0.083333333*0.5*g_u(i+1,k-2,j)*rdx*muu(i+1,j)*cfn1*(8.*(ph(i+1,k,j)-&amp;<a name='3465'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_u(i,k-&amp;<a name='3466'>
&amp;2,j)*rdx*muu(i,j)*cfn1*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3467'>
&amp;phb(i-2,k,j)))-0.083333333*0.5*g_u(i+1,k-1,j)*rdx*muu(i+1,j)*cfn*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*&amp;<a name='3468'>
&amp;(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_u(i,k-1,j)*rdx*muu(i,j)*cfn*(8.*(ph(i+1,k,j)-&amp;<a name='3469'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3470'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,j)+cfn1*u(i,k-&amp;<a name='3471'>
&amp;2,j)))*(1./12.)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3472'>
    end do<a name='3473'>
  endif<a name='3474'>
  if (config_flags%open_xe .and. ite .ge. ide-2) then<a name='3475'>
    i = ide-2<a name='3476'>
    do j = j_start, jtf<a name='3477'>
      do k = 2, kte-1<a name='3478'>
        g_ph_tend(i,k,j) = (-(0.083333333*0.25*g_muu(i+1,j)*rdx*(u(i+1,k,j)+u(i+1,k-1,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,&amp;<a name='3479'>
&amp;j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))))-0.083333333*0.25*g_muu(i,j)*rdx*(u(i,k,j)+&amp;<a name='3480'>
&amp;u(i,k-1,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,&amp;<a name='3481'>
&amp;k,j)))-0.083333333*0.25*g_ph(i-2,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-(-&amp;<a name='3482'>
&amp;0.66666667)*0.25*g_ph(i-1,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-(-0.083333333)*&amp;<a name='3483'>
&amp;0.25*g_ph(i+2,k,j)*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))-0.66666667*0.25*g_ph(i+1,k,j)&amp;<a name='3484'>
&amp;*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))+g_ph_tend(i,k,j)-0.083333333*0.25*g_u(i+1,k-1,&amp;<a name='3485'>
&amp;j)*rdx*muu(i+1,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3486'>
&amp;phb(i-2,k,j)))-0.083333333*0.25*g_u(i,k-1,j)*rdx*muu(i,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*&amp;<a name='3487'>
&amp;(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.25*g_u(i+1,k,j)*rdx*muu(i+1,j)*(8.*(ph(i+1,k,j)-&amp;<a name='3488'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.25*g_u(i,&amp;<a name='3489'>
&amp;k,j)*rdx*muu(i,j)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3490'>
&amp;phb(i-2,k,j)))<a name='3491'>
        ph_tend(i,k,j) = ph_tend(i,k,j)-0.25*rdx*(muu(i+1,j)*(u(i+1,k,j)+u(i+1,k-1,j))+muu(i,j)*(u(i,k,j)+u(i,k-1,j)))*(1./12.)*&amp;<a name='3492'>
&amp;(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3493'>
      end do<a name='3494'>
      k = kte<a name='3495'>
      g_ph_tend(i,k,j) = (-(0.083333333*0.5*g_muu(i+1,j)*rdx*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-&amp;<a name='3496'>
&amp;(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))))-0.083333333*0.5*g_muu(i,j)*rdx*(cfn*&amp;<a name='3497'>
&amp;u(i,k-1,j)+cfn1*u(i,k-2,j))*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,&amp;<a name='3498'>
&amp;k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_ph(i-2,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-&amp;<a name='3499'>
&amp;1,j)+cfn1*u(i,k-2,j)))-(-0.66666667)*0.5*g_ph(i-1,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*&amp;<a name='3500'>
&amp;u(i,k-1,j)+cfn1*u(i,k-2,j)))-(-0.083333333)*0.5*g_ph(i+2,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*&amp;<a name='3501'>
&amp;(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j)))-0.66666667*0.5*g_ph(i+1,k,j)*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)&amp;<a name='3502'>
&amp;*(cfn*u(i,k-1,j)+cfn1*u(i,k-2,j)))+g_ph_tend(i,k,j)-0.083333333*0.5*g_u(i+1,k-2,j)*rdx*muu(i+1,j)*cfn1*(8.*(ph(i+1,k,j)-&amp;<a name='3503'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_u(i,k-&amp;<a name='3504'>
&amp;2,j)*rdx*muu(i,j)*cfn1*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-&amp;<a name='3505'>
&amp;phb(i-2,k,j)))-0.083333333*0.5*g_u(i+1,k-1,j)*rdx*muu(i+1,j)*cfn*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*&amp;<a name='3506'>
&amp;(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))-0.083333333*0.5*g_u(i,k-1,j)*rdx*muu(i,j)*cfn*(8.*(ph(i+1,k,j)-&amp;<a name='3507'>
&amp;ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3508'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-0.5*rdx*(muu(i+1,j)*(cfn*u(i+1,k-1,j)+cfn1*u(i+1,k-2,j))+muu(i,j)*(cfn*u(i,k-1,j)+cfn1*u(i,k-&amp;<a name='3509'>
&amp;2,j)))*(1./12.)*(8.*(ph(i+1,k,j)-ph(i-1,k,j))-(ph(i+2,k,j)-ph(i-2,k,j))+8.*(phb(i+1,k,j)-phb(i-1,k,j))-(phb(i+2,k,j)-phb(i-2,k,j)))<a name='3510'>
    end do<a name='3511'>
  endif<a name='3512'>
endif<a name='3513'>
itf = min(ite,ide-1)<a name='3514'>
if (config_flags%open_ys .and. jts .eq. jds) then<a name='3515'>
  j = jts<a name='3516'>
  do k = 2, kde<a name='3517'>
    kz = min(k,kde-1)<a name='3518'>
    do i = its, itf<a name='3519'>
      g_vb = 0.5*g_v(i,kz-1,j+1)*fnp(kz)+0.5*g_v(i,kz-1,j)*fnp(kz)+0.5*g_v(i,kz,j+1)*fnm(kz)+0.5*g_v(i,kz,j)*fnm(kz)<a name='3520'>
      vb = 0.5*(fnm(kz)*(v(i,kz,j+1)+v(i,kz,j))+fnp(kz)*(v(i,kz-1,j+1)+v(i,kz-1,j)))<a name='3521'>
      g_vl = g_vb*(0.5+sign(0.5,0.-vb))<a name='3522'>
      vl = amin1(vb,0.)<a name='3523'>
      g_ph_tend(i,k,j) = (-(g_mut(i,j)*rdy*vl*(ph_old(i,k,j+1)-ph_old(i,k,j))))-g_ph_old(i,k,j+1)*rdy*mut(i,j)*vl+g_ph_old(i,k,j)*&amp;<a name='3524'>
&amp;rdy*mut(i,j)*vl+g_ph_tend(i,k,j)-g_vl*rdy*mut(i,j)*(ph_old(i,k,j+1)-ph_old(i,k,j))<a name='3525'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-rdy*mut(i,j)*vl*(ph_old(i,k,j+1)-ph_old(i,k,j))<a name='3526'>
    end do<a name='3527'>
  end do<a name='3528'>
endif<a name='3529'>
if (config_flags%open_ye .and. jte .eq. jde) then<a name='3530'>
  j = jte-1<a name='3531'>
  do k = 2, kde<a name='3532'>
    kz = min(k,kde-1)<a name='3533'>
    do i = its, itf<a name='3534'>
      g_vb = 0.5*g_v(i,kz-1,j+1)*fnp(kz)+0.5*g_v(i,kz-1,j)*fnp(kz)+0.5*g_v(i,kz,j+1)*fnm(kz)+0.5*g_v(i,kz,j)*fnm(kz)<a name='3535'>
      vb = 0.5*(fnm(kz)*(v(i,kz,j+1)+v(i,kz,j))+fnp(kz)*(v(i,kz-1,j+1)+v(i,kz-1,j)))<a name='3536'>
      g_vr = g_vb*(0.5+sign(0.5,vb-0.))<a name='3537'>
      vr = amax1(vb,0.)<a name='3538'>
      g_ph_tend(i,k,j) = (-(g_mut(i,j)*rdy*vr*(ph_old(i,k,j)-ph_old(i,k,j-1))))+g_ph_old(i,k,j-1)*rdy*mut(i,j)*vr-g_ph_old(i,k,j)*&amp;<a name='3539'>
&amp;rdy*mut(i,j)*vr+g_ph_tend(i,k,j)-g_vr*rdy*mut(i,j)*(ph_old(i,k,j)-ph_old(i,k,j-1))<a name='3540'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-rdy*mut(i,j)*vr*(ph_old(i,k,j)-ph_old(i,k,j-1))<a name='3541'>
    end do<a name='3542'>
  end do<a name='3543'>
endif<a name='3544'>
jtf = min(jte,jde-1)<a name='3545'>
if (config_flags%open_xs .and. its .eq. ids) then<a name='3546'>
  i = its<a name='3547'>
  do j = jts, jtf<a name='3548'>
    do k = 2, kde-1<a name='3549'>
      kz = k<a name='3550'>
      g_ub = 0.5*g_u(i+1,kz-1,j)*fnp(kz)+0.5*g_u(i,kz-1,j)*fnp(kz)+0.5*g_u(i+1,kz,j)*fnm(kz)+0.5*g_u(i,kz,j)*fnm(kz)<a name='3551'>
      ub = 0.5*(fnm(kz)*(u(i+1,kz,j)+u(i,kz,j))+fnp(kz)*(u(i+1,kz-1,j)+u(i,kz-1,j)))<a name='3552'>
      g_ul = g_ub*(0.5+sign(0.5,0.-ub))<a name='3553'>
      ul = amin1(ub,0.)<a name='3554'>
      g_ph_tend(i,k,j) = (-(g_mut(i,j)*rdx*ul*(ph_old(i+1,k,j)-ph_old(i,k,j))))-g_ph_old(i+1,k,j)*rdx*mut(i,j)*ul+g_ph_old(i,k,j)*&amp;<a name='3555'>
&amp;rdx*mut(i,j)*ul+g_ph_tend(i,k,j)-g_ul*rdx*mut(i,j)*(ph_old(i+1,k,j)-ph_old(i,k,j))<a name='3556'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-rdx*mut(i,j)*ul*(ph_old(i+1,k,j)-ph_old(i,k,j))<a name='3557'>
    end do<a name='3558'>
    k = kde<a name='3559'>
    kz = k<a name='3560'>
    g_ub = 0.5*g_u(i+1,kz-1,j)*fnp(kz)+0.5*g_u(i,kz-1,j)*fnp(kz)+0.5*g_u(i+1,kz,j)*fnm(kz)+0.5*g_u(i,kz,j)*fnm(kz)<a name='3561'>
    ub = 0.5*(fnm(kz)*(u(i+1,kz,j)+u(i,kz,j))+fnp(kz)*(u(i+1,kz-1,j)+u(i,kz-1,j)))<a name='3562'>
    g_ul = g_ub*(0.5+sign(0.5,0.-ub))<a name='3563'>
    ul = amin1(ub,0.)<a name='3564'>
    g_ph_tend(i,k,j) = (-(g_mut(i,j)*rdx*ul*(ph_old(i+1,k,j)-ph_old(i,k,j))))-g_ph_old(i+1,k,j)*rdx*mut(i,j)*ul+g_ph_old(i,k,j)*&amp;<a name='3565'>
&amp;rdx*mut(i,j)*ul+g_ph_tend(i,k,j)-g_ul*rdx*mut(i,j)*(ph_old(i+1,k,j)-ph_old(i,k,j))<a name='3566'>
    ph_tend(i,k,j) = ph_tend(i,k,j)-rdx*mut(i,j)*ul*(ph_old(i+1,k,j)-ph_old(i,k,j))<a name='3567'>
  end do<a name='3568'>
endif<a name='3569'>
if (config_flags%open_xe .and. ite .eq. ide) then<a name='3570'>
  i = ite-1<a name='3571'>
  do j = jts, jtf<a name='3572'>
    do k = 2, kde-1<a name='3573'>
      kz = k<a name='3574'>
      g_ub = 0.5*g_u(i+1,kz-1,j)*fnp(kz)+0.5*g_u(i,kz-1,j)*fnp(kz)+0.5*g_u(i+1,kz,j)*fnm(kz)+0.5*g_u(i,kz,j)*fnm(kz)<a name='3575'>
      ub = 0.5*(fnm(kz)*(u(i+1,kz,j)+u(i,kz,j))+fnp(kz)*(u(i+1,kz-1,j)+u(i,kz-1,j)))<a name='3576'>
      g_ur = g_ub*(0.5+sign(0.5,ub-0.))<a name='3577'>
      ur = amax1(ub,0.)<a name='3578'>
      g_ph_tend(i,k,j) = (-(g_mut(i,j)*rdx*ur*(ph_old(i,k,j)-ph_old(i-1,k,j))))+g_ph_old(i-1,k,j)*rdx*mut(i,j)*ur-g_ph_old(i,k,j)*&amp;<a name='3579'>
&amp;rdx*mut(i,j)*ur+g_ph_tend(i,k,j)-g_ur*rdx*mut(i,j)*(ph_old(i,k,j)-ph_old(i-1,k,j))<a name='3580'>
      ph_tend(i,k,j) = ph_tend(i,k,j)-rdx*mut(i,j)*ur*(ph_old(i,k,j)-ph_old(i-1,k,j))<a name='3581'>
    end do<a name='3582'>
    k = kde<a name='3583'>
    kz = k-1<a name='3584'>
    g_ub = 0.5*g_u(i+1,kz-1,j)*fnp(kz)+0.5*g_u(i,kz-1,j)*fnp(kz)+0.5*g_u(i+1,kz,j)*fnm(kz)+0.5*g_u(i,kz,j)*fnm(kz)<a name='3585'>
    ub = 0.5*(fnm(kz)*(u(i+1,kz,j)+u(i,kz,j))+fnp(kz)*(u(i+1,kz-1,j)+u(i,kz-1,j)))<a name='3586'>
    g_ur = g_ub*(0.5+sign(0.5,ub-0.))<a name='3587'>
    ur = amax1(ub,0.)<a name='3588'>
    g_ph_tend(i,k,j) = (-(g_mut(i,j)*rdx*ur*(ph_old(i,k,j)-ph_old(i-1,k,j))))+g_ph_old(i-1,k,j)*rdx*mut(i,j)*ur-g_ph_old(i,k,j)*&amp;<a name='3589'>
&amp;rdx*mut(i,j)*ur+g_ph_tend(i,k,j)-g_ur*rdx*mut(i,j)*(ph_old(i,k,j)-ph_old(i-1,k,j))<a name='3590'>
    ph_tend(i,k,j) = ph_tend(i,k,j)-rdx*mut(i,j)*ur*(ph_old(i,k,j)-ph_old(i-1,k,j))<a name='3591'>
  end do<a name='3592'>
endif<a name='3593'>
<a name='3594'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_RHS_PH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_64">("g_rhs_ph")<a name='3595'>
<a name='3596'>
end subroutine g_rhs_ph<a name='3597'>
<a name='3598'>
<a name='3599'>
<A NAME='G_VERTICAL_DIFFUSION'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3600'>
<font color=#993300>subroutine </font><font color=#cc0000>g_vertical_diffusion</font>( name, field, g_field, tendency, g_tendency, alt, g_alt, mut, g_mut, rdn, rdnw, kvdif, ide, jde, &amp; <A href='../../call_to/G_VERTICAL_DIFFUSION.html' TARGET='index'>4</A>,<A href='../../call_from/G_VERTICAL_DIFFUSION.html' TARGET='index'>2</A><a name='3601'>
&amp;kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='3602'>
<font color=#447700>!******************************************************************<a name='3603'></font>
<font color=#447700>!******************************************************************<a name='3604'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='3605'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='3606'></font>
<font color=#447700>!******************************************************************<a name='3607'></font>
<font color=#447700>!******************************************************************<a name='3608'></font>
<font color=#447700>!==============================================<a name='3609'></font>
<font color=#447700>! all entries are defined explicitly<a name='3610'></font>
<font color=#447700>!==============================================<a name='3611'></font>
implicit none<a name='3612'>
<a name='3613'>
<font color=#447700>!==============================================<a name='3614'></font>
<font color=#447700>! declare arguments<a name='3615'></font>
<font color=#447700>!==============================================<a name='3616'></font>
integer, intent(in) :: ime<a name='3617'>
integer, intent(in) :: ims<a name='3618'>
integer, intent(in) :: jme<a name='3619'>
integer, intent(in) :: jms<a name='3620'>
integer, intent(in) :: kme<a name='3621'>
integer, intent(in) :: kms<a name='3622'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='3623'>
real, intent(in) :: field(ims:ime,kms:kme,jms:jme)<a name='3624'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='3625'>
real, intent(in) :: g_field(ims:ime,kms:kme,jms:jme)<a name='3626'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='3627'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='3628'>
integer, intent(in) :: ide<a name='3629'>
integer, intent(in) :: ite<a name='3630'>
integer, intent(in) :: its<a name='3631'>
integer, intent(in) :: jde<a name='3632'>
integer, intent(in) :: jte<a name='3633'>
integer, intent(in) :: jts<a name='3634'>
integer, intent(in) :: kde<a name='3635'>
integer, intent(in) :: kte<a name='3636'>
integer, intent(in) :: kts<a name='3637'>
real, intent(in) :: kvdif<a name='3638'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='3639'>
character*(1), intent(in) :: name<a name='3640'>
real, intent(in) :: rdn(kms:kme)<a name='3641'>
real, intent(in) :: rdnw(kms:kme)<a name='3642'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='3643'>
<a name='3644'>
<font color=#447700>!==============================================<a name='3645'></font>
<font color=#447700>! declare local variables<a name='3646'></font>
<font color=#447700>!==============================================<a name='3647'></font>
real g_vflux(its:ite,0:kte+1)<a name='3648'>
integer i<a name='3649'>
integer i_end<a name='3650'>
integer i_start<a name='3651'>
integer j<a name='3652'>
integer j_end<a name='3653'>
integer j_start<a name='3654'>
integer k<a name='3655'>
integer ktf<a name='3656'>
real vflux(its:ite,0:kte+1)<a name='3657'>
<a name='3658'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_65">("g_vertical_diffusion")<a name='3659'>
<a name='3660'>
<font color=#447700>!----------------------------------------------<a name='3661'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='3662'></font>
<font color=#447700>!----------------------------------------------<a name='3663'></font>
ktf = min(kte,kde-1)<a name='3664'>
if (name .eq. 'w') then<a name='3665'>
  i_start = its<a name='3666'>
  i_end = min(ite,ide-1)<a name='3667'>
  j_start = jts<a name='3668'>
  j_end = min(jte,jde-1)<a name='3669'>
  j_loop_w: do j = j_start, j_end<a name='3670'>
    do k = kts, ktf-1<a name='3671'>
      do i = i_start, i_end<a name='3672'>
        g_vflux(i,k) = (-(g_alt(i,k,j)*kvdif/(alt(i,k,j)*alt(i,k,j))*rdnw(k)*(field(i,k+1,j)-field(i,k,j))))+g_field(i,k+1,j)*&amp;<a name='3673'>
&amp;kvdif/alt(i,k,j)*rdnw(k)-g_field(i,k,j)*kvdif/alt(i,k,j)*rdnw(k)<a name='3674'>
        vflux(i,k) = kvdif/alt(i,k,j)*rdnw(k)*(field(i,k+1,j)-field(i,k,j))<a name='3675'>
      end do<a name='3676'>
    end do<a name='3677'>
    do i = i_start, i_end<a name='3678'>
      g_vflux(i,ktf) = 0.<a name='3679'>
      vflux(i,ktf) = 0.<a name='3680'>
    end do<a name='3681'>
    do k = kts+1, ktf<a name='3682'>
      do i = i_start, i_end<a name='3683'>
        g_tendency(i,k,j) = (-(g_alt(i,k-1,j)*0.5*(rdn(k)*g*g/mut(i,j))/(0.5*0.5*(alt(i,k,j)+alt(i,k-1,j))*(alt(i,k,j)+alt(i,k-1,j)&amp;<a name='3684'>
&amp;))*(vflux(i,k)-vflux(i,k-1))))-g_alt(i,k,j)*0.5*(rdn(k)*g*g/mut(i,j))/(0.5*0.5*(alt(i,k,j)+alt(i,k-1,j))*(alt(i,k,j)+&amp;<a name='3685'>
&amp;alt(i,k-1,j)))*(vflux(i,k)-vflux(i,k-1))-g_mut(i,j)*rdn(k)*g*g/(mut(i,j)*mut(i,j))/(0.5*(alt(i,k,j)+alt(i,k-1,j)))*&amp;<a name='3686'>
&amp;(vflux(i,k)-vflux(i,k-1))+g_tendency(i,k,j)-g_vflux(i,k-1)*(rdn(k)*g*g/mut(i,j)/(0.5*(alt(i,k,j)+alt(i,k-1,j))))+&amp;<a name='3687'>
&amp;g_vflux(i,k)*(rdn(k)*g*g/mut(i,j)/(0.5*(alt(i,k,j)+alt(i,k-1,j))))<a name='3688'>
        tendency(i,k,j) = tendency(i,k,j)+rdn(k)*g*g/mut(i,j)/(0.5*(alt(i,k,j)+alt(i,k-1,j)))*(vflux(i,k)-vflux(i,k-1))<a name='3689'>
      end do<a name='3690'>
    end do<a name='3691'>
  end do j_loop_w<a name='3692'>
else if (name .eq. 'm') then<a name='3693'>
  i_start = its<a name='3694'>
  i_end = min(ite,ide-1)<a name='3695'>
  j_start = jts<a name='3696'>
  j_end = min(jte,jde-1)<a name='3697'>
  j_loop_s: do j = j_start, j_end<a name='3698'>
    do k = kts, ktf-1<a name='3699'>
      do i = i_start, i_end<a name='3700'>
        g_vflux(i,k) = (-(g_alt(i,k+1,j)*0.5*kvdif*rdn(k+1)/(0.5*0.5*(alt(i,k,j)+alt(i,k+1,j))*(alt(i,k,j)+alt(i,k+1,j)))*(field(i,&amp;<a name='3701'>
&amp;k+1,j)-field(i,k,j))))-g_alt(i,k,j)*0.5*kvdif*rdn(k+1)/(0.5*0.5*(alt(i,k,j)+alt(i,k+1,j))*(alt(i,k,j)+alt(i,k+1,j)))*&amp;<a name='3702'>
&amp;(field(i,k+1,j)-field(i,k,j))+g_field(i,k+1,j)*(kvdif*rdn(k+1)/(0.5*(alt(i,k,j)+alt(i,k+1,j))))-g_field(i,k,j)*(kvdif*&amp;<a name='3703'>
&amp;rdn(k+1)/(0.5*(alt(i,k,j)+alt(i,k+1,j))))<a name='3704'>
        vflux(i,k) = kvdif*rdn(k+1)/(0.5*(alt(i,k,j)+alt(i,k+1,j)))*(field(i,k+1,j)-field(i,k,j))<a name='3705'>
      end do<a name='3706'>
    end do<a name='3707'>
    do i = i_start, i_end<a name='3708'>
      g_vflux(i,0) = g_vflux(i,1)<a name='3709'>
      vflux(i,0) = vflux(i,1)<a name='3710'>
    end do<a name='3711'>
    do i = i_start, i_end<a name='3712'>
      g_vflux(i,ktf) = 0.<a name='3713'>
      vflux(i,ktf) = 0.<a name='3714'>
    end do<a name='3715'>
    do k = kts, ktf<a name='3716'>
      do i = i_start, i_end<a name='3717'>
        g_tendency(i,k,j) = (-(g_alt(i,k,j)*g*g/mut(i,j)/(alt(i,k,j)*alt(i,k,j))*rdnw(k)*(vflux(i,k)-vflux(i,k-1))))-g_mut(i,j)*g*&amp;<a name='3718'>
&amp;g/(mut(i,j)*mut(i,j))/alt(i,k,j)*rdnw(k)*(vflux(i,k)-vflux(i,k-1))+g_tendency(i,k,j)-g_vflux(i,k-1)*g*g/mut(i,j)/alt(i,k,&amp;<a name='3719'>
&amp;j)*rdnw(k)+g_vflux(i,k)*g*g/mut(i,j)/alt(i,k,j)*rdnw(k)<a name='3720'>
        tendency(i,k,j) = tendency(i,k,j)+g*g/mut(i,j)/alt(i,k,j)*rdnw(k)*(vflux(i,k)-vflux(i,k-1))<a name='3721'>
      end do<a name='3722'>
    end do<a name='3723'>
  end do j_loop_s<a name='3724'>
endif<a name='3725'>
<a name='3726'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_65">("g_vertical_diffusion")<a name='3727'>
<a name='3728'>
end subroutine g_vertical_diffusion<a name='3729'>
<a name='3730'>
<a name='3731'>
<A NAME='G_VERTICAL_DIFFUSION_3DMP'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_3DMP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3732'>
<font color=#993300>subroutine </font><font color=#cc0000>g_vertical_diffusion_3dmp</font>( field, g_field, tendency, g_tendency, base_3d, alt, g_alt, mut, g_mut, rdn, rdnw, kvdif, ide,&amp; <A href='../../call_to/G_VERTICAL_DIFFUSION_3DMP.html' TARGET='index'>2</A>,<A href='../../call_from/G_VERTICAL_DIFFUSION_3DMP.html' TARGET='index'>2</A><a name='3733'>
&amp; jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='3734'>
<font color=#447700>!******************************************************************<a name='3735'></font>
<font color=#447700>!******************************************************************<a name='3736'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='3737'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='3738'></font>
<font color=#447700>!******************************************************************<a name='3739'></font>
<font color=#447700>!******************************************************************<a name='3740'></font>
<font color=#447700>!==============================================<a name='3741'></font>
<font color=#447700>! all entries are defined explicitly<a name='3742'></font>
<font color=#447700>!==============================================<a name='3743'></font>
implicit none<a name='3744'>
<a name='3745'>
<font color=#447700>!==============================================<a name='3746'></font>
<font color=#447700>! declare arguments<a name='3747'></font>
<font color=#447700>!==============================================<a name='3748'></font>
integer, intent(in) :: ime<a name='3749'>
integer, intent(in) :: ims<a name='3750'>
integer, intent(in) :: jme<a name='3751'>
integer, intent(in) :: jms<a name='3752'>
integer, intent(in) :: kme<a name='3753'>
integer, intent(in) :: kms<a name='3754'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='3755'>
real, intent(in) :: base_3d(ims:ime,kms:kme,jms:jme)<a name='3756'>
real, intent(in) :: field(ims:ime,kms:kme,jms:jme)<a name='3757'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='3758'>
real, intent(in) :: g_field(ims:ime,kms:kme,jms:jme)<a name='3759'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='3760'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='3761'>
integer, intent(in) :: ide<a name='3762'>
integer, intent(in) :: ite<a name='3763'>
integer, intent(in) :: its<a name='3764'>
integer, intent(in) :: jde<a name='3765'>
integer, intent(in) :: jte<a name='3766'>
integer, intent(in) :: jts<a name='3767'>
integer, intent(in) :: kde<a name='3768'>
integer, intent(in) :: kte<a name='3769'>
integer, intent(in) :: kts<a name='3770'>
real, intent(in) :: kvdif<a name='3771'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='3772'>
real, intent(in) :: rdn(kms:kme)<a name='3773'>
real, intent(in) :: rdnw(kms:kme)<a name='3774'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='3775'>
<a name='3776'>
<font color=#447700>!==============================================<a name='3777'></font>
<font color=#447700>! declare local variables<a name='3778'></font>
<font color=#447700>!==============================================<a name='3779'></font>
real g_vflux(its:ite,0:kte+1)<a name='3780'>
integer i<a name='3781'>
integer i_end<a name='3782'>
integer i_start<a name='3783'>
integer j<a name='3784'>
integer j_end<a name='3785'>
integer j_start<a name='3786'>
integer k<a name='3787'>
integer ktf<a name='3788'>
real vflux(its:ite,0:kte+1)<a name='3789'>
<a name='3790'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_3DMP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_66">("g_vertical_diffusion_3dmp")<a name='3791'>
<a name='3792'>
<font color=#447700>!----------------------------------------------<a name='3793'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='3794'></font>
<font color=#447700>!----------------------------------------------<a name='3795'></font>
ktf = min(kte,kde-1)<a name='3796'>
i_start = its<a name='3797'>
i_end = min(ite,ide-1)<a name='3798'>
j_start = jts<a name='3799'>
j_end = min(jte,jde-1)<a name='3800'>
j_loop_s: do j = j_start, j_end<a name='3801'>
  do k = kts, ktf-1<a name='3802'>
    do i = i_start, i_end<a name='3803'>
      g_vflux(i,k) = (-(g_alt(i,k+1,j)*0.5*kvdif*rdn(k+1)/(0.5*0.5*(alt(i,k,j)+alt(i,k+1,j))*(alt(i,k,j)+alt(i,k+1,j)))*(field(i,k+&amp;<a name='3804'>
&amp;1,j)-field(i,k,j)-base_3d(i,k+1,j)+base_3d(i,k,j))))-g_alt(i,k,j)*0.5*kvdif*rdn(k+1)/(0.5*0.5*(alt(i,k,j)+alt(i,k+1,j))*&amp;<a name='3805'>
&amp;(alt(i,k,j)+alt(i,k+1,j)))*(field(i,k+1,j)-field(i,k,j)-base_3d(i,k+1,j)+base_3d(i,k,j))+g_field(i,k+1,j)*(kvdif*rdn(k+1)/&amp;<a name='3806'>
&amp;(0.5*(alt(i,k,j)+alt(i,k+1,j))))-g_field(i,k,j)*(kvdif*rdn(k+1)/(0.5*(alt(i,k,j)+alt(i,k+1,j))))<a name='3807'>
      vflux(i,k) = kvdif*rdn(k+1)/(0.5*(alt(i,k,j)+alt(i,k+1,j)))*(field(i,k+1,j)-field(i,k,j)-base_3d(i,k+1,j)+base_3d(i,k,j))<a name='3808'>
    end do<a name='3809'>
  end do<a name='3810'>
  do i = i_start, i_end<a name='3811'>
    g_vflux(i,0) = g_vflux(i,1)<a name='3812'>
    vflux(i,0) = vflux(i,1)<a name='3813'>
  end do<a name='3814'>
  do i = i_start, i_end<a name='3815'>
    g_vflux(i,ktf) = 0.<a name='3816'>
    vflux(i,ktf) = 0.<a name='3817'>
  end do<a name='3818'>
  do k = kts, ktf<a name='3819'>
    do i = i_start, i_end<a name='3820'>
      g_tendency(i,k,j) = (-(g_alt(i,k,j)*g*g/mut(i,j)/(alt(i,k,j)*alt(i,k,j))*rdnw(k)*(vflux(i,k)-vflux(i,k-1))))-g_mut(i,j)*g*g/&amp;<a name='3821'>
&amp;(mut(i,j)*mut(i,j))/alt(i,k,j)*rdnw(k)*(vflux(i,k)-vflux(i,k-1))+g_tendency(i,k,j)-g_vflux(i,k-1)*g*g/mut(i,j)/alt(i,k,j)*&amp;<a name='3822'>
&amp;rdnw(k)+g_vflux(i,k)*g*g/mut(i,j)/alt(i,k,j)*rdnw(k)<a name='3823'>
      tendency(i,k,j) = tendency(i,k,j)+g*g/mut(i,j)/alt(i,k,j)*rdnw(k)*(vflux(i,k)-vflux(i,k-1))<a name='3824'>
    end do<a name='3825'>
  end do<a name='3826'>
end do j_loop_s<a name='3827'>
<a name='3828'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_3DMP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_66">("g_vertical_diffusion_3dmp")<a name='3829'>
<a name='3830'>
end subroutine g_vertical_diffusion_3dmp<a name='3831'>
<a name='3832'>
<a name='3833'>
<A NAME='G_VERTICAL_DIFFUSION_MP'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_MP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3834'>
<font color=#993300>subroutine </font><font color=#cc0000>g_vertical_diffusion_mp</font>( field, g_field, tendency, g_tendency, base, alt, g_alt, mut, g_mut, rdn, rdnw, kvdif, ide, jde,&amp; <A href='../../call_to/G_VERTICAL_DIFFUSION_MP.html' TARGET='index'>2</A>,<A href='../../call_from/G_VERTICAL_DIFFUSION_MP.html' TARGET='index'>2</A><a name='3835'>
&amp; kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='3836'>
<font color=#447700>!******************************************************************<a name='3837'></font>
<font color=#447700>!******************************************************************<a name='3838'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='3839'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='3840'></font>
<font color=#447700>!******************************************************************<a name='3841'></font>
<font color=#447700>!******************************************************************<a name='3842'></font>
<font color=#447700>!==============================================<a name='3843'></font>
<font color=#447700>! all entries are defined explicitly<a name='3844'></font>
<font color=#447700>!==============================================<a name='3845'></font>
implicit none<a name='3846'>
<a name='3847'>
<font color=#447700>!==============================================<a name='3848'></font>
<font color=#447700>! declare arguments<a name='3849'></font>
<font color=#447700>!==============================================<a name='3850'></font>
integer, intent(in) :: ime<a name='3851'>
integer, intent(in) :: ims<a name='3852'>
integer, intent(in) :: jme<a name='3853'>
integer, intent(in) :: jms<a name='3854'>
integer, intent(in) :: kme<a name='3855'>
integer, intent(in) :: kms<a name='3856'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='3857'>
real, intent(in) :: base(kms:kme)<a name='3858'>
real, intent(in) :: field(ims:ime,kms:kme,jms:jme)<a name='3859'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='3860'>
real, intent(in) :: g_field(ims:ime,kms:kme,jms:jme)<a name='3861'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='3862'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='3863'>
integer, intent(in) :: ide<a name='3864'>
integer, intent(in) :: ite<a name='3865'>
integer, intent(in) :: its<a name='3866'>
integer, intent(in) :: jde<a name='3867'>
integer, intent(in) :: jte<a name='3868'>
integer, intent(in) :: jts<a name='3869'>
integer, intent(in) :: kde<a name='3870'>
integer, intent(in) :: kte<a name='3871'>
integer, intent(in) :: kts<a name='3872'>
real, intent(in) :: kvdif<a name='3873'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='3874'>
real, intent(in) :: rdn(kms:kme)<a name='3875'>
real, intent(in) :: rdnw(kms:kme)<a name='3876'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='3877'>
<a name='3878'>
<font color=#447700>!==============================================<a name='3879'></font>
<font color=#447700>! declare local variables<a name='3880'></font>
<font color=#447700>!==============================================<a name='3881'></font>
real g_vflux(its:ite,0:kte+1)<a name='3882'>
integer i<a name='3883'>
integer i_end<a name='3884'>
integer i_start<a name='3885'>
integer j<a name='3886'>
integer j_end<a name='3887'>
integer j_start<a name='3888'>
integer k<a name='3889'>
integer ktf<a name='3890'>
real vflux(its:ite,0:kte+1)<a name='3891'>
<a name='3892'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_MP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_67">("g_vertical_diffusion_mp")<a name='3893'>
<a name='3894'>
<font color=#447700>!----------------------------------------------<a name='3895'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='3896'></font>
<font color=#447700>!----------------------------------------------<a name='3897'></font>
ktf = min(kte,kde-1)<a name='3898'>
i_start = its<a name='3899'>
i_end = min(ite,ide-1)<a name='3900'>
j_start = jts<a name='3901'>
j_end = min(jte,jde-1)<a name='3902'>
j_loop_s: do j = j_start, j_end<a name='3903'>
  do k = kts, ktf-1<a name='3904'>
    do i = i_start, i_end<a name='3905'>
      g_vflux(i,k) = (-(g_alt(i,k+1,j)*0.5*kvdif*rdn(k+1)/(0.5*0.5*(alt(i,k,j)+alt(i,k+1,j))*(alt(i,k,j)+alt(i,k+1,j)))*(field(i,k+&amp;<a name='3906'>
&amp;1,j)-field(i,k,j)-base(k+1)+base(k))))-g_alt(i,k,j)*0.5*kvdif*rdn(k+1)/(0.5*0.5*(alt(i,k,j)+alt(i,k+1,j))*(alt(i,k,j)+alt(i,&amp;<a name='3907'>
&amp;k+1,j)))*(field(i,k+1,j)-field(i,k,j)-base(k+1)+base(k))+g_field(i,k+1,j)*(kvdif*rdn(k+1)/(0.5*(alt(i,k,j)+alt(i,k+1,j))))-&amp;<a name='3908'>
&amp;g_field(i,k,j)*(kvdif*rdn(k+1)/(0.5*(alt(i,k,j)+alt(i,k+1,j))))<a name='3909'>
      vflux(i,k) = kvdif*rdn(k+1)/(0.5*(alt(i,k,j)+alt(i,k+1,j)))*(field(i,k+1,j)-field(i,k,j)-base(k+1)+base(k))<a name='3910'>
    end do<a name='3911'>
  end do<a name='3912'>
  do i = i_start, i_end<a name='3913'>
    g_vflux(i,0) = g_vflux(i,1)<a name='3914'>
    vflux(i,0) = vflux(i,1)<a name='3915'>
  end do<a name='3916'>
  do i = i_start, i_end<a name='3917'>
    g_vflux(i,ktf) = 0.<a name='3918'>
    vflux(i,ktf) = 0.<a name='3919'>
  end do<a name='3920'>
  do k = kts, ktf<a name='3921'>
    do i = i_start, i_end<a name='3922'>
      g_tendency(i,k,j) = (-(g_alt(i,k,j)*g*g/mut(i,j)/(alt(i,k,j)*alt(i,k,j))*rdnw(k)*(vflux(i,k)-vflux(i,k-1))))-g_mut(i,j)*g*g/&amp;<a name='3923'>
&amp;(mut(i,j)*mut(i,j))/alt(i,k,j)*rdnw(k)*(vflux(i,k)-vflux(i,k-1))+g_tendency(i,k,j)-g_vflux(i,k-1)*g*g/mut(i,j)/alt(i,k,j)*&amp;<a name='3924'>
&amp;rdnw(k)+g_vflux(i,k)*g*g/mut(i,j)/alt(i,k,j)*rdnw(k)<a name='3925'>
      tendency(i,k,j) = tendency(i,k,j)+g*g/mut(i,j)/alt(i,k,j)*rdnw(k)*(vflux(i,k)-vflux(i,k-1))<a name='3926'>
    end do<a name='3927'>
  end do<a name='3928'>
end do j_loop_s<a name='3929'>
<a name='3930'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_MP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_67">("g_vertical_diffusion_mp")<a name='3931'>
<a name='3932'>
end subroutine g_vertical_diffusion_mp<a name='3933'>
<a name='3934'>
<a name='3935'>
<A NAME='G_VERTICAL_DIFFUSION_U'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_U' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3936'>
<font color=#993300>subroutine </font><font color=#cc0000>g_vertical_diffusion_u</font>( field, g_field, tendency, g_tendency, config_flags, u_base, alt, g_alt, muu, g_muu, rdn, rdnw, &amp; <A href='../../call_to/G_VERTICAL_DIFFUSION_U.html' TARGET='index'>2</A>,<A href='../../call_from/G_VERTICAL_DIFFUSION_U.html' TARGET='index'>2</A><a name='3937'>
&amp;kvdif, ids, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='3938'>
<font color=#447700>!******************************************************************<a name='3939'></font>
<font color=#447700>!******************************************************************<a name='3940'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='3941'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='3942'></font>
<font color=#447700>!******************************************************************<a name='3943'></font>
<font color=#447700>!******************************************************************<a name='3944'></font>
<font color=#447700>!==============================================<a name='3945'></font>
<font color=#447700>! all entries are defined explicitly<a name='3946'></font>
<font color=#447700>!==============================================<a name='3947'></font>
implicit none<a name='3948'>
<a name='3949'>
<font color=#447700>!==============================================<a name='3950'></font>
<font color=#447700>! declare arguments<a name='3951'></font>
<font color=#447700>!==============================================<a name='3952'></font>
integer, intent(in) :: ime<a name='3953'>
integer, intent(in) :: ims<a name='3954'>
integer, intent(in) :: jme<a name='3955'>
integer, intent(in) :: jms<a name='3956'>
integer, intent(in) :: kme<a name='3957'>
integer, intent(in) :: kms<a name='3958'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='3959'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='3960'>
real, intent(in) :: field(ims:ime,kms:kme,jms:jme)<a name='3961'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='3962'>
real, intent(in) :: g_field(ims:ime,kms:kme,jms:jme)<a name='3963'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='3964'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='3965'>
integer, intent(in) :: ide<a name='3966'>
integer, intent(in) :: ids<a name='3967'>
integer, intent(in) :: ite<a name='3968'>
integer, intent(in) :: its<a name='3969'>
integer, intent(in) :: jde<a name='3970'>
integer, intent(in) :: jte<a name='3971'>
integer, intent(in) :: jts<a name='3972'>
integer, intent(in) :: kde<a name='3973'>
integer, intent(in) :: kte<a name='3974'>
integer, intent(in) :: kts<a name='3975'>
real, intent(in) :: kvdif<a name='3976'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='3977'>
real, intent(in) :: rdn(kms:kme)<a name='3978'>
real, intent(in) :: rdnw(kms:kme)<a name='3979'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='3980'>
real, intent(in) :: u_base(kms:kme)<a name='3981'>
<a name='3982'>
<font color=#447700>!==============================================<a name='3983'></font>
<font color=#447700>! declare local variables<a name='3984'></font>
<font color=#447700>!==============================================<a name='3985'></font>
real g_vflux(its:ite,0:kte+1)<a name='3986'>
integer i<a name='3987'>
integer i_end<a name='3988'>
integer i_start<a name='3989'>
integer j<a name='3990'>
integer j_end<a name='3991'>
integer j_start<a name='3992'>
integer k<a name='3993'>
integer ktf<a name='3994'>
logical specified<a name='3995'>
real vflux(its:ite,0:kte+1)<a name='3996'>
<a name='3997'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_U' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_68">("g_vertical_diffusion_u")<a name='3998'>
<a name='3999'>
<font color=#447700>!----------------------------------------------<a name='4000'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='4001'></font>
<font color=#447700>!----------------------------------------------<a name='4002'></font>
specified =  .false. <a name='4003'>
if (config_flags%specified .or. config_flags%nested) then<a name='4004'>
  specified =  .true. <a name='4005'>
endif<a name='4006'>
ktf = min(kte,kde-1)<a name='4007'>
i_start = its<a name='4008'>
i_end = ite<a name='4009'>
j_start = jts<a name='4010'>
j_end = min(jte,jde-1)<a name='4011'>
if (config_flags%open_xs .or. specified) then<a name='4012'>
  i_start = max(ids+1,its)<a name='4013'>
endif<a name='4014'>
if (config_flags%open_xe .or. specified) then<a name='4015'>
  i_end = min(ide-1,ite)<a name='4016'>
endif<a name='4017'>
j_loop_u: do j = j_start, j_end<a name='4018'>
  do k = kts, ktf-1<a name='4019'>
    do i = i_start, i_end<a name='4020'>
      g_vflux(i,k) = (-(g_alt(i-1,k+1,j)*0.25*kvdif*rdn(k+1)/(0.25*0.25*(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j))*&amp;<a name='4021'>
&amp;(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j)))*(field(i,k+1,j)-field(i,k,j)-u_base(k+1)+u_base(k))))-g_alt(i,k+1,j)*&amp;<a name='4022'>
&amp;0.25*kvdif*rdn(k+1)/(0.25*0.25*(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j))*(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+&amp;<a name='4023'>
&amp;alt(i-1,k+1,j)))*(field(i,k+1,j)-field(i,k,j)-u_base(k+1)+u_base(k))-g_alt(i-1,k,j)*0.25*kvdif*rdn(k+1)/(0.25*0.25*(alt(i,k,&amp;<a name='4024'>
&amp;j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j))*(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j)))*(field(i,k+1,j)-field(i,&amp;<a name='4025'>
&amp;k,j)-u_base(k+1)+u_base(k))-g_alt(i,k,j)*0.25*kvdif*rdn(k+1)/(0.25*0.25*(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j)&amp;<a name='4026'>
&amp;)*(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j)))*(field(i,k+1,j)-field(i,k,j)-u_base(k+1)+u_base(k))+g_field(i,k+1,&amp;<a name='4027'>
&amp;j)*(kvdif*rdn(k+1)/(0.25*(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j))))-g_field(i,k,j)*(kvdif*rdn(k+1)/(0.25*&amp;<a name='4028'>
&amp;(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j))))<a name='4029'>
      vflux(i,k) = kvdif*rdn(k+1)/(0.25*(alt(i,k,j)+alt(i-1,k,j)+alt(i,k+1,j)+alt(i-1,k+1,j)))*(field(i,k+1,j)-field(i,k,j)-&amp;<a name='4030'>
&amp;u_base(k+1)+u_base(k))<a name='4031'>
    end do<a name='4032'>
  end do<a name='4033'>
  do i = i_start, i_end<a name='4034'>
    g_vflux(i,0) = g_vflux(i,1)<a name='4035'>
    vflux(i,0) = vflux(i,1)<a name='4036'>
  end do<a name='4037'>
  do i = i_start, i_end<a name='4038'>
    g_vflux(i,ktf) = 0.<a name='4039'>
    vflux(i,ktf) = 0.<a name='4040'>
  end do<a name='4041'>
  do k = kts, ktf-1<a name='4042'>
    do i = i_start, i_end<a name='4043'>
      g_tendency(i,k,j) = (-(g_alt(i-1,k,j)*0.5*(g*g*rdnw(k)/muu(i,j))/(0.5*0.5*(alt(i-1,k,j)+alt(i,k,j))*(alt(i-1,k,j)+alt(i,k,j))&amp;<a name='4044'>
&amp;)*(vflux(i,k)-vflux(i,k-1))))-g_alt(i,k,j)*0.5*(g*g*rdnw(k)/muu(i,j))/(0.5*0.5*(alt(i-1,k,j)+alt(i,k,j))*(alt(i-1,k,j)+&amp;<a name='4045'>
&amp;alt(i,k,j)))*(vflux(i,k)-vflux(i,k-1))-g_muu(i,j)*g*g*rdnw(k)/(muu(i,j)*muu(i,j))/(0.5*(alt(i-1,k,j)+alt(i,k,j)))*(vflux(i,&amp;<a name='4046'>
&amp;k)-vflux(i,k-1))+g_tendency(i,k,j)-g_vflux(i,k-1)*(g*g*rdnw(k)/muu(i,j)/(0.5*(alt(i-1,k,j)+alt(i,k,j))))+g_vflux(i,k)*(g*g*&amp;<a name='4047'>
&amp;rdnw(k)/muu(i,j)/(0.5*(alt(i-1,k,j)+alt(i,k,j))))<a name='4048'>
      tendency(i,k,j) = tendency(i,k,j)+g*g*rdnw(k)/muu(i,j)/(0.5*(alt(i-1,k,j)+alt(i,k,j)))*(vflux(i,k)-vflux(i,k-1))<a name='4049'>
    end do<a name='4050'>
  end do<a name='4051'>
end do j_loop_u<a name='4052'>
<a name='4053'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_U' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_68">("g_vertical_diffusion_u")<a name='4054'>
<a name='4055'>
end subroutine g_vertical_diffusion_u<a name='4056'>
<a name='4057'>
<a name='4058'>
<A NAME='G_VERTICAL_DIFFUSION_V'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_V' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4059'>
<font color=#993300>subroutine </font><font color=#cc0000>g_vertical_diffusion_v</font>( field, g_field, tendency, g_tendency, config_flags, v_base, alt, g_alt, muv, g_muv, rdn, rdnw, &amp; <A href='../../call_to/G_VERTICAL_DIFFUSION_V.html' TARGET='index'>2</A>,<A href='../../call_from/G_VERTICAL_DIFFUSION_V.html' TARGET='index'>2</A><a name='4060'>
&amp;kvdif, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='4061'>
<font color=#447700>!******************************************************************<a name='4062'></font>
<font color=#447700>!******************************************************************<a name='4063'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='4064'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='4065'></font>
<font color=#447700>!******************************************************************<a name='4066'></font>
<font color=#447700>!******************************************************************<a name='4067'></font>
<font color=#447700>!==============================================<a name='4068'></font>
<font color=#447700>! all entries are defined explicitly<a name='4069'></font>
<font color=#447700>!==============================================<a name='4070'></font>
implicit none<a name='4071'>
<a name='4072'>
<font color=#447700>!==============================================<a name='4073'></font>
<font color=#447700>! declare arguments<a name='4074'></font>
<font color=#447700>!==============================================<a name='4075'></font>
integer, intent(in) :: ime<a name='4076'>
integer, intent(in) :: ims<a name='4077'>
integer, intent(in) :: jme<a name='4078'>
integer, intent(in) :: jms<a name='4079'>
integer, intent(in) :: kme<a name='4080'>
integer, intent(in) :: kms<a name='4081'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='4082'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='4083'>
real, intent(in) :: field(ims:ime,kms:kme,jms:jme)<a name='4084'>
real, intent(in) :: g_alt(ims:ime,kms:kme,jms:jme)<a name='4085'>
real, intent(in) :: g_field(ims:ime,kms:kme,jms:jme)<a name='4086'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='4087'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='4088'>
integer, intent(in) :: ide<a name='4089'>
integer, intent(in) :: ite<a name='4090'>
integer, intent(in) :: its<a name='4091'>
integer, intent(in) :: jde<a name='4092'>
integer, intent(in) :: jds<a name='4093'>
integer, intent(in) :: jte<a name='4094'>
integer, intent(in) :: jts<a name='4095'>
integer, intent(in) :: kde<a name='4096'>
integer, intent(in) :: kte<a name='4097'>
integer, intent(in) :: kts<a name='4098'>
real, intent(in) :: kvdif<a name='4099'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='4100'>
real, intent(in) :: rdn(kms:kme)<a name='4101'>
real, intent(in) :: rdnw(kms:kme)<a name='4102'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='4103'>
real, intent(in) :: v_base(kms:kme)<a name='4104'>
<a name='4105'>
<font color=#447700>!==============================================<a name='4106'></font>
<font color=#447700>! declare local variables<a name='4107'></font>
<font color=#447700>!==============================================<a name='4108'></font>
real g_vflux(its:ite,0:kte+1)<a name='4109'>
integer i<a name='4110'>
integer i_end<a name='4111'>
integer i_start<a name='4112'>
integer j<a name='4113'>
integer j_end<a name='4114'>
integer j_start<a name='4115'>
integer jm1<a name='4116'>
integer k<a name='4117'>
integer ktf<a name='4118'>
logical specified<a name='4119'>
real vflux(its:ite,0:kte+1)<a name='4120'>
<a name='4121'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_V' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_69">("g_vertical_diffusion_v")<a name='4122'>
<a name='4123'>
<font color=#447700>!----------------------------------------------<a name='4124'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='4125'></font>
<font color=#447700>!----------------------------------------------<a name='4126'></font>
specified =  .false. <a name='4127'>
if (config_flags%specified .or. config_flags%nested) then<a name='4128'>
  specified =  .true. <a name='4129'>
endif<a name='4130'>
ktf = min(kte,kde-1)<a name='4131'>
i_start = its<a name='4132'>
i_end = min(ite,ide-1)<a name='4133'>
j_start = jts<a name='4134'>
j_end = min(jte,jde-1)<a name='4135'>
if (config_flags%open_ys .or. specified) then<a name='4136'>
  j_start = max(jds+1,jts)<a name='4137'>
endif<a name='4138'>
if (config_flags%open_ye .or. specified) then<a name='4139'>
  j_end = min(jde-1,jte)<a name='4140'>
endif<a name='4141'>
j_loop_v: do j = j_start, j_end<a name='4142'>
  jm1 = j-1<a name='4143'>
  do k = kts, ktf-1<a name='4144'>
    do i = i_start, i_end<a name='4145'>
      g_vflux(i,k) = (-(g_alt(i,k+1,j)*0.25*kvdif*rdn(k+1)/(0.25*0.25*(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1))*(alt(i,&amp;<a name='4146'>
&amp;k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1)))*(field(i,k+1,j)-field(i,k,j)-v_base(k+1)+v_base(k))))-g_alt(i,k+1,jm1)*0.25*&amp;<a name='4147'>
&amp;kvdif*rdn(k+1)/(0.25*0.25*(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1))*(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,&amp;<a name='4148'>
&amp;k+1,jm1)))*(field(i,k+1,j)-field(i,k,j)-v_base(k+1)+v_base(k))-g_alt(i,k,j)*0.25*kvdif*rdn(k+1)/(0.25*0.25*(alt(i,k,j)+&amp;<a name='4149'>
&amp;alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1))*(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1)))*(field(i,k+1,j)-field(i,k,&amp;<a name='4150'>
&amp;j)-v_base(k+1)+v_base(k))-g_alt(i,k,jm1)*0.25*kvdif*rdn(k+1)/(0.25*0.25*(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1)&amp;<a name='4151'>
&amp;)*(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1)))*(field(i,k+1,j)-field(i,k,j)-v_base(k+1)+v_base(k))+g_field(i,k+1,&amp;<a name='4152'>
&amp;j)*(kvdif*rdn(k+1)/(0.25*(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1))))-g_field(i,k,j)*(kvdif*rdn(k+1)/(0.25*&amp;<a name='4153'>
&amp;(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1))))<a name='4154'>
      vflux(i,k) = kvdif*rdn(k+1)/(0.25*(alt(i,k,j)+alt(i,k,jm1)+alt(i,k+1,j)+alt(i,k+1,jm1)))*(field(i,k+1,j)-field(i,k,j)-&amp;<a name='4155'>
&amp;v_base(k+1)+v_base(k))<a name='4156'>
    end do<a name='4157'>
  end do<a name='4158'>
  do i = i_start, i_end<a name='4159'>
    g_vflux(i,0) = g_vflux(i,1)<a name='4160'>
    vflux(i,0) = vflux(i,1)<a name='4161'>
  end do<a name='4162'>
  do i = i_start, i_end<a name='4163'>
    g_vflux(i,ktf) = 0.<a name='4164'>
    vflux(i,ktf) = 0.<a name='4165'>
  end do<a name='4166'>
  do k = kts, ktf-1<a name='4167'>
    do i = i_start, i_end<a name='4168'>
      g_tendency(i,k,j) = (-(g_alt(i,k,j)*0.5*(g*g*rdnw(k)/muv(i,j))/(0.5*0.5*(alt(i,k,jm1)+alt(i,k,j))*(alt(i,k,jm1)+alt(i,k,j)))*&amp;<a name='4169'>
&amp;(vflux(i,k)-vflux(i,k-1))))-g_alt(i,k,jm1)*0.5*(g*g*rdnw(k)/muv(i,j))/(0.5*0.5*(alt(i,k,jm1)+alt(i,k,j))*(alt(i,k,jm1)+&amp;<a name='4170'>
&amp;alt(i,k,j)))*(vflux(i,k)-vflux(i,k-1))-g_muv(i,j)*g*g*rdnw(k)/(muv(i,j)*muv(i,j))/(0.5*(alt(i,k,jm1)+alt(i,k,j)))*(vflux(i,&amp;<a name='4171'>
&amp;k)-vflux(i,k-1))+g_tendency(i,k,j)-g_vflux(i,k-1)*(g*g*rdnw(k)/muv(i,j)/(0.5*(alt(i,k,jm1)+alt(i,k,j))))+g_vflux(i,k)*(g*g*&amp;<a name='4172'>
&amp;rdnw(k)/muv(i,j)/(0.5*(alt(i,k,jm1)+alt(i,k,j))))<a name='4173'>
      tendency(i,k,j) = tendency(i,k,j)+g*g*rdnw(k)/muv(i,j)/(0.5*(alt(i,k,jm1)+alt(i,k,j)))*(vflux(i,k)-vflux(i,k-1))<a name='4174'>
    end do<a name='4175'>
  end do<a name='4176'>
end do j_loop_v<a name='4177'>
<a name='4178'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_VERTICAL_DIFFUSION_V' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_69">("g_vertical_diffusion_v")<a name='4179'>
<a name='4180'>
end subroutine g_vertical_diffusion_v<a name='4181'>
<a name='4182'>
<a name='4183'>
<A NAME='G_W_DAMP'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_W_DAMP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4184'>
<font color=#993300>subroutine </font><font color=#cc0000>g_w_damp</font>( rw_tend, g_rw_tend, ww, g_ww, w, g_w, mut, g_mut, rdnw, dt, ide, jde, kde, ims, ime, jms, jme, kms, kme, its, &amp; <A href='../../call_to/G_W_DAMP.html' TARGET='index'>1</A>,<A href='../../call_from/G_W_DAMP.html' TARGET='index'>2</A><a name='4185'>
&amp;ite, jts, jte )<a name='4186'>
<font color=#447700>!******************************************************************<a name='4187'></font>
<font color=#447700>!******************************************************************<a name='4188'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='4189'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='4190'></font>
<font color=#447700>!******************************************************************<a name='4191'></font>
<font color=#447700>!******************************************************************<a name='4192'></font>
<font color=#447700>!==============================================<a name='4193'></font>
<font color=#447700>! all entries are defined explicitly<a name='4194'></font>
<font color=#447700>!==============================================<a name='4195'></font>
implicit none<a name='4196'>
<a name='4197'>
<font color=#447700>!==============================================<a name='4198'></font>
<font color=#447700>! declare arguments<a name='4199'></font>
<font color=#447700>!==============================================<a name='4200'></font>
real, intent(in) :: dt<a name='4201'>
integer, intent(in) :: ime<a name='4202'>
integer, intent(in) :: ims<a name='4203'>
integer, intent(in) :: jme<a name='4204'>
integer, intent(in) :: jms<a name='4205'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='4206'>
integer, intent(in) :: kme<a name='4207'>
integer, intent(in) :: kms<a name='4208'>
real, intent(inout) :: g_rw_tend(ims:ime,kms:kme,jms:jme)<a name='4209'>
real, intent(in) :: g_w(ims:ime,kms:kme,jms:jme)<a name='4210'>
real, intent(in) :: g_ww(ims:ime,kms:kme,jms:jme)<a name='4211'>
integer, intent(in) :: ide<a name='4212'>
integer, intent(in) :: ite<a name='4213'>
integer, intent(in) :: its<a name='4214'>
integer, intent(in) :: jde<a name='4215'>
integer, intent(in) :: jte<a name='4216'>
integer, intent(in) :: jts<a name='4217'>
integer, intent(in) :: kde<a name='4218'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='4219'>
real, intent(in) :: rdnw(kms:kme)<a name='4220'>
real, intent(inout) :: rw_tend(ims:ime,kms:kme,jms:jme)<a name='4221'>
real, intent(in) :: w(ims:ime,kms:kme,jms:jme)<a name='4222'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='4223'>
<a name='4224'>
<font color=#447700>!==============================================<a name='4225'></font>
<font color=#447700>! declare local variables<a name='4226'></font>
<font color=#447700>!==============================================<a name='4227'></font>
real cf_d<a name='4228'>
real cf_n<a name='4229'>
real cfl<a name='4230'>
real g_cf_d<a name='4231'>
real g_cf_n<a name='4232'>
integer i<a name='4233'>
integer itf<a name='4234'>
integer j<a name='4235'>
integer jtf<a name='4236'>
integer k<a name='4237'>
<a name='4238'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_W_DAMP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_70">("g_w_damp")<a name='4239'>
<a name='4240'>
<font color=#447700>!----------------------------------------------<a name='4241'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='4242'></font>
<font color=#447700>!----------------------------------------------<a name='4243'></font>
itf = min(ite,ide-1)<a name='4244'>
jtf = min(jte,jde-1)<a name='4245'>
do j = jts, jtf<a name='4246'>
  do k = 2, kde-1<a name='4247'>
    do i = its, itf<a name='4248'>
      g_cf_n = g_ww(i,k,j)*sign(1.,ww(i,k,j))<a name='4249'>
      cf_n = abs(ww(i,k,j))<a name='4250'>
      g_cf_d = g_mut(i,j)*rdnw(k)*dt*sign(1.,mut(i,j)*rdnw(k)*dt)<a name='4251'>
      cf_d = abs(mut(i,j)*rdnw(k)*dt)<a name='4252'>
      if (cf_n .gt. cf_d*w_beta) then<a name='4253'>
        g_rw_tend(i,k,j) = (-(g_mut(i,j)*w_alpha*(cfl-w_beta)*sign(1.,w(i,k,j))))+g_rw_tend(i,k,j)<a name='4254'>
        rw_tend(i,k,j) = rw_tend(i,k,j)-sign(1.,w(i,k,j))*w_alpha*(cfl-w_beta)*mut(i,j)<a name='4255'>
      endif<a name='4256'>
    end do<a name='4257'>
  end do<a name='4258'>
end do<a name='4259'>
<a name='4260'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_W_DAMP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_70">("g_w_damp")<a name='4261'>
<a name='4262'>
end subroutine g_w_damp<a name='4263'>
<a name='4264'>
<a name='4265'>
<A NAME='G_ZERO_TEND'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_ZERO_TEND' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4266'>
<font color=#993300>subroutine </font><font color=#cc0000>g_zero_tend</font>( tendency, g_tendency, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte ) <A href='../../call_to/G_ZERO_TEND.html' TARGET='index'>18</A><a name='4267'>
<font color=#447700>!******************************************************************<a name='4268'></font>
<font color=#447700>!******************************************************************<a name='4269'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='4270'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='4271'></font>
<font color=#447700>!******************************************************************<a name='4272'></font>
<font color=#447700>!******************************************************************<a name='4273'></font>
<font color=#447700>!==============================================<a name='4274'></font>
<font color=#447700>! all entries are defined explicitly<a name='4275'></font>
<font color=#447700>!==============================================<a name='4276'></font>
implicit none<a name='4277'>
<a name='4278'>
<font color=#447700>!==============================================<a name='4279'></font>
<font color=#447700>! declare arguments<a name='4280'></font>
<font color=#447700>!==============================================<a name='4281'></font>
integer, intent(in) :: ime<a name='4282'>
integer, intent(in) :: ims<a name='4283'>
integer, intent(in) :: jme<a name='4284'>
integer, intent(in) :: jms<a name='4285'>
integer, intent(in) :: kme<a name='4286'>
integer, intent(in) :: kms<a name='4287'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='4288'>
integer, intent(in) :: ite<a name='4289'>
integer, intent(in) :: its<a name='4290'>
integer, intent(in) :: jte<a name='4291'>
integer, intent(in) :: jts<a name='4292'>
integer, intent(in) :: kte<a name='4293'>
integer, intent(in) :: kts<a name='4294'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='4295'>
<a name='4296'>
<font color=#447700>!==============================================<a name='4297'></font>
<font color=#447700>! declare local variables<a name='4298'></font>
<font color=#447700>!==============================================<a name='4299'></font>
integer i<a name='4300'>
integer j<a name='4301'>
integer k<a name='4302'>
<a name='4303'>
<font color=#447700>!----------------------------------------------<a name='4304'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='4305'></font>
<font color=#447700>!----------------------------------------------<a name='4306'></font>
do j = jts, jte<a name='4307'>
  do k = kts, kte<a name='4308'>
    do i = its, ite<a name='4309'>
      g_tendency(i,k,j) = 0.<a name='4310'>
      tendency(i,k,j) = 0.<a name='4311'>
    end do<a name='4312'>
  end do<a name='4313'>
end do<a name='4314'>
<a name='4315'>
end subroutine g_zero_tend<a name='4316'>
<font color=#447700>!Zhang Xiaoyan 11/02/2006 <a name='4317'></font>
<a name='4318'>
<font color=#447700>!=======================================================================================================<a name='4319'></font>
<A NAME='G_SURFACE_DRAG'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_SURFACE_DRAG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4320'>
<font color=#993300>subroutine </font><font color=#cc0000>g_surface_drag</font>( ru_tendf, g_ru_tendf, rv_tendf, g_rv_tendf, u, g_u, v, g_v, xland, muu, g_muu, muv, &amp; <A href='../../call_to/G_SURFACE_DRAG.html' TARGET='index'>3</A>,<A href='../../call_from/G_SURFACE_DRAG.html' TARGET='index'>2</A><a name='4321'>
&amp;g_muv, z, g_z, z_at_w, g_z_at_w, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='4322'>
<font color=#447700>!******************************************************************<a name='4323'></font>
<font color=#447700>!******************************************************************<a name='4324'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='4325'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.8.71  **<a name='4326'></font>
<font color=#447700>!******************************************************************<a name='4327'></font>
<font color=#447700>!******************************************************************<a name='4328'></font>
<font color=#447700>!==============================================<a name='4329'></font>
<font color=#447700>! all entries are defined explicitly<a name='4330'></font>
<font color=#447700>!==============================================<a name='4331'></font>
implicit none<a name='4332'>
<a name='4333'>
<font color=#447700>!==============================================<a name='4334'></font>
<font color=#447700>! declare arguments<a name='4335'></font>
<font color=#447700>!==============================================<a name='4336'></font>
integer, intent(in) :: ime<a name='4337'>
integer, intent(in) :: ims<a name='4338'>
integer, intent(in) :: jme<a name='4339'>
integer, intent(in) :: jms<a name='4340'>
real, intent(in) :: g_muu(ims:ime,jms:jme)<a name='4341'>
real, intent(in) :: g_muv(ims:ime,jms:jme)<a name='4342'>
integer, intent(in) :: kme<a name='4343'>
integer, intent(in) :: kms<a name='4344'>
real, intent(inout) :: g_ru_tendf(ims:ime,kms:kme,jms:jme)<a name='4345'>
real, intent(inout) :: g_rv_tendf(ims:ime,kms:kme,jms:jme)<a name='4346'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='4347'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='4348'>
real, intent(in) :: g_z(ims:ime,kms:kme,jms:jme)<a name='4349'>
real, intent(in) :: g_z_at_w(ims:ime,kms:kme,jms:jme)<a name='4350'>
integer, intent(in) :: ide<a name='4351'>
integer, intent(in) :: ids<a name='4352'>
integer, intent(in) :: ite<a name='4353'>
integer, intent(in) :: its<a name='4354'>
integer, intent(in) :: jde<a name='4355'>
integer, intent(in) :: jds<a name='4356'>
integer, intent(in) :: jte<a name='4357'>
integer, intent(in) :: jts<a name='4358'>
integer, intent(in) :: kde<a name='4359'>
integer, intent(in) :: kds<a name='4360'>
integer, intent(in) :: kte<a name='4361'>
integer, intent(in) :: kts<a name='4362'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='4363'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='4364'>
<font color=#447700>!integer, intent(in) :: rk_step<a name='4365'></font>
real, intent(inout) :: ru_tendf(ims:ime,kms:kme,jms:jme)<a name='4366'>
real, intent(inout) :: rv_tendf(ims:ime,kms:kme,jms:jme)<a name='4367'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='4368'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='4369'>
real, intent(in) :: xland(ims:ime,jms:jme)<a name='4370'>
real, intent(in) :: z(ims:ime,kms:kme,jms:jme)<a name='4371'>
real, intent(in) :: z_at_w(ims:ime,kms:kme,jms:jme)<a name='4372'>
<a name='4373'>
<font color=#447700>!==============================================<a name='4374'></font>
<font color=#447700>! declare local variables<a name='4375'></font>
<font color=#447700>!==============================================<a name='4376'></font>
real cd<a name='4377'>
real g_cd<a name='4378'>
real g_tao_xz<a name='4379'>
real g_tao_yz<a name='4380'>
real g_v0_u<a name='4381'>
real g_v0_v<a name='4382'>
real g_zu<a name='4383'>
real g_zv<a name='4384'>
real g_zwt<a name='4385'>
integer i<a name='4386'>
integer i_end<a name='4387'>
integer i_endu<a name='4388'>
integer i_start<a name='4389'>
integer j<a name='4390'>
integer j_end<a name='4391'>
integer j_endv<a name='4392'>
integer j_start<a name='4393'>
integer k<a name='4394'>
real tao_xz<a name='4395'>
real tao_yz<a name='4396'>
real v0_u<a name='4397'>
real v0_uh<a name='4398'>
real v0_v<a name='4399'>
real v0_vh<a name='4400'>
real zu<a name='4401'>
real zv<a name='4402'>
real zwt<a name='4403'>
<a name='4404'>
REAL, PARAMETER :: epsilon = 1.e-10<a name='4405'>
<a name='4406'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_SURFACE_DRAG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_71">("g_surface_drag")<a name='4407'>
<a name='4408'>
<font color=#447700>!----------------------------------------------<a name='4409'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='4410'></font>
<font color=#447700>!----------------------------------------------<a name='4411'></font>
i_start = its<a name='4412'>
i_end = min(ite,ide-1)<a name='4413'>
i_endu = ite<a name='4414'>
j_start = jts<a name='4415'>
j_end = min(jte,jde-1)<a name='4416'>
j_endv = jte<a name='4417'>
do j = j_start, j_end<a name='4418'>
  do i = i_start, i_endu<a name='4419'>
    v0_uh = u(i,kts,j)**2+((v(i,kts,j)+v(i,kts,j+1)+v(i-1,kts,j)+v(i-1,kts,j+1))/4)**2<a name='4420'>
    g_v0_u = (2*g_u(i,kts,j)*u(i,kts,j)+2*g_v(i-1,kts,j+1)/float(4)*((v(i,kts,j)+v(i,kts,j+1)+v(i-1,kts,j)+v(i-1,kts,j+1))/float(4)&amp;<a name='4421'>
&amp;)+2*g_v(i,kts,j+1)/float(4)*((v(i,kts,j)+v(i,kts,j+1)+v(i-1,kts,j)+v(i-1,kts,j+1))/float(4))+2*g_v(i-1,kts,j)/float(4)*((v(i,&amp;<a name='4422'>
&amp;kts,j)+v(i,kts,j+1)+v(i-1,kts,j)+v(i-1,kts,j+1))/float(4))+2*g_v(i,kts,j)/float(4)*((v(i,kts,j)+v(i,kts,j+1)+v(i-1,kts,j)+v(i-&amp;<a name='4423'>
&amp;1,kts,j+1))/float(4)))*(1./(2.*sqrt(v0_uh)))<a name='4424'>
    v0_u = sqrt(v0_uh)+epsilon<a name='4425'>
    if (xland(i,j) .eq. xland(i-1,j)) then<a name='4426'>
      if (xland(i,j) .lt. 1.5) then<a name='4427'>
        g_cd = 0.<a name='4428'>
        cd = 0.01<a name='4429'>
      else<a name='4430'>
        g_cd = 0.<a name='4431'>
        cd = 0.001<a name='4432'>
        g_cd = g_cd*(0.5+sign(0.5,cd-0.0001*v0_u))+0.0001*g_v0_u*(0.5-sign(0.5,cd-0.0001*v0_u))<a name='4433'>
        cd = max(cd,0.0001*v0_u)<a name='4434'>
        g_cd = g_cd*(0.5+sign(0.5,0.003-cd))<a name='4435'>
        cd = min(cd,0.003)<a name='4436'>
      endif<a name='4437'>
    else<a name='4438'>
      g_cd = 0.<a name='4439'>
      cd = 0.003<a name='4440'>
    endif<a name='4441'>
    g_tao_xz = g_cd*v0_u*u(i,kts,j)+g_u(i,kts,j)*cd*v0_u+g_v0_u*cd*u(i,kts,j)<a name='4442'>
    tao_xz = cd*v0_u*u(i,kts,j)<a name='4443'>
    do k = kts, kte<a name='4444'>
      g_zu = 0.5*g_z(i-1,k,j)+0.5*g_z(i,k,j)-0.5*g_z_at_w(i-1,kts,j)-0.5*g_z_at_w(i,kts,j)<a name='4445'>
      zu = 0.5*(z(i,k,j)+z(i-1,k,j)-z_at_w(i,kts,j)-z_at_w(i-1,kts,j))<a name='4446'>
      if (zu .lt. 1000.) then<a name='4447'>
        g_zwt = (-0.002)*g_zu<a name='4448'>
        zwt = 2.*(1000.-zu)/1000.<a name='4449'>
        g_ru_tendf(i,k,j) = (-(g_muu(i,j)*(0.5*zwt*tao_xz/1000.)))+g_ru_tendf(i,k,j)-g_tao_xz*(0.5*zwt*muu(i,j)/1000.)-g_zwt*(0.5*&amp;<a name='4450'>
&amp;muu(i,j)*tao_xz/1000.)<a name='4451'>
<font color=#447700>!X        ru_tendf(i,k,j) = ru_tendf(i,k,j)-zwt*0.5*muu(i,j)*tao_xz/1000.<a name='4452'></font>
      endif<a name='4453'>
    end do<a name='4454'>
  end do<a name='4455'>
end do<a name='4456'>
do j = j_start, j_endv<a name='4457'>
  do i = i_start, i_end<a name='4458'>
    v0_vh = v(i,kts,j)**2+((u(i,kts,j)+u(i,kts,j-1)+u(i+1,kts,j)+u(i+1,kts,j-1))/4)**2<a name='4459'>
    g_v0_v = (2*g_u(i+1,kts,j-1)/float(4)*((u(i,kts,j)+u(i,kts,j-1)+u(i+1,kts,j)+u(i+1,kts,j-1))/float(4))+2*g_u(i,kts,j-1)/&amp;<a name='4460'>
&amp;float(4)*((u(i,kts,j)+u(i,kts,j-1)+u(i+1,kts,j)+u(i+1,kts,j-1))/float(4))+2*g_u(i+1,kts,j)/float(4)*((u(i,kts,j)+u(i,kts,j-1)+&amp; <a name='4461'>
&amp;u(i+1,kts,j)+u(i+1,kts,j-1))/float(4))+2*g_u(i,kts,j)/float(4)*((u(i,kts,j)+u(i,kts,j-1)+u(i+1,kts,j)+u(i+1,kts,j-1))/float(4)&amp; <a name='4462'>
&amp;)+2*g_v(i,kts,j)*v(i,kts,j))*(1./(2.*sqrt(v0_vh)))<a name='4463'>
    v0_v = sqrt(v0_vh)+epsilon<a name='4464'>
    if (xland(i,j) .eq. xland(i,j-1)) then<a name='4465'>
      if (xland(i,j) .lt. 1.5) then<a name='4466'>
        g_cd = 0.<a name='4467'>
        cd = 0.01<a name='4468'>
      else<a name='4469'>
        g_cd = 0.<a name='4470'>
        cd = 0.001<a name='4471'>
        g_cd = g_cd*(0.5+sign(0.5,cd-0.0001*v0_v))+0.0001*g_v0_v*(0.5-sign(0.5,cd-0.0001*v0_v))<a name='4472'>
        cd = max(cd,0.0001*v0_v)<a name='4473'>
        g_cd = g_cd*(0.5+sign(0.5,0.003-cd))<a name='4474'>
        cd = min(cd,0.003)<a name='4475'>
      endif <a name='4476'>
    else<a name='4477'>
      g_cd = 0.<a name='4478'>
      cd = 0.003<a name='4479'>
    endif<a name='4480'>
    g_tao_yz = g_cd*v0_v*v(i,kts,j)+g_v(i,kts,j)*cd*v0_v+g_v0_v*cd*v(i,kts,j)<a name='4481'>
    tao_yz = cd*v0_v*v(i,kts,j)<a name='4482'>
    do k = kts, kte<a name='4483'>
      g_zv = 0.5*g_z(i,k,j-1)+0.5*g_z(i,k,j)-0.5*g_z_at_w(i,kts,j-1)-0.5*g_z_at_w(i,kts,j)<a name='4484'>
      zv = 0.5*(z(i,k,j)+z(i,k,j-1)-z_at_w(i,kts,j)-z_at_w(i,kts,j-1))<a name='4485'>
      if (zv .lt. 1000.) then<a name='4486'>
     g_zwt = (-0.002)*g_zv<a name='4487'>
        zwt = 2.*(1000.-zv)/1000.<a name='4488'>
        g_rv_tendf(i,k,j) = (-(g_muv(i,j)*(0.5*zwt*tao_yz/1000.)))+g_rv_tendf(i,k,j)-g_tao_yz*(0.5*zwt*muv(i,j)/1000.)-g_zwt*(0.5*&amp;<a name='4489'>
&amp;muv(i,j)*tao_yz/1000.)<a name='4490'>
<font color=#447700>!X        rv_tendf(i,k,j) = rv_tendf(i,k,j)-zwt*0.5*muv(i,j)*tao_yz/1000.<a name='4491'></font>
      endif<a name='4492'>
    end do<a name='4493'>
  end do<a name='4494'>
end do<a name='4495'>
<a name='4496'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_SURFACE_DRAG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_71">("g_surface_drag")<a name='4497'>
<a name='4498'>
end subroutine g_surface_drag<a name='4499'>
<a name='4500'>
<a name='4501'>
<a name='4502'>
<font color=#447700>!                           DISCLAIMER<a name='4503'></font>
<font color=#447700>!<a name='4504'></font>
<font color=#447700>!   This file was generated by TAF version 1.8.81<a name='4505'></font>
<font color=#447700>!<a name='4506'></font>
<font color=#447700>!   FASTOPT DISCLAIMS  ALL  WARRANTIES,  EXPRESS  OR  IMPLIED,<a name='4507'></font>
<font color=#447700>!   INCLUDING (WITHOUT LIMITATION) ALL IMPLIED  WARRANTIES  OF<a name='4508'></font>
<font color=#447700>!   MERCHANTABILITY  OR FITNESS FOR A PARTICULAR PURPOSE, WITH<a name='4509'></font>
<font color=#447700>!   RESPECT TO THE SOFTWARE AND USER PROGRAMS.   IN  NO  EVENT<a name='4510'></font>
<font color=#447700>!   SHALL  FASTOPT BE LIABLE FOR ANY LOST OR ANTICIPATED PROF-<a name='4511'></font>
<font color=#447700>!   ITS, OR ANY INDIRECT, INCIDENTAL, EXEMPLARY,  SPECIAL,  OR<a name='4512'></font>
<font color=#447700>!   CONSEQUENTIAL  DAMAGES, WHETHER OR NOT FASTOPT WAS ADVISED<a name='4513'></font>
<font color=#447700>!   OF THE POSSIBILITY OF SUCH DAMAGES.<a name='4514'></font>
<font color=#447700>!<a name='4515'></font>
<font color=#447700>!                           Haftungsbeschraenkung<a name='4516'></font>
<font color=#447700>!   FastOpt gibt ausdruecklich keine Gewaehr, explizit oder indirekt,<a name='4517'></font>
<font color=#447700>!   bezueglich der Brauchbarkeit  der Software  fuer einen bestimmten<a name='4518'></font>
<font color=#447700>!   Zweck.   Unter  keinen  Umstaenden   ist  FastOpt   haftbar  fuer<a name='4519'></font>
<font color=#447700>!   irgendeinen Verlust oder nicht eintretenden erwarteten Gewinn und<a name='4520'></font>
<font color=#447700>!   allen indirekten,  zufaelligen,  exemplarischen  oder  speziellen<a name='4521'></font>
<font color=#447700>!   Schaeden  oder  Folgeschaeden  unabhaengig  von einer eventuellen<a name='4522'></font>
<font color=#447700>!   Mitteilung darueber an FastOpt.<a name='4523'></font>
<font color=#447700>!<a name='4524'></font>
<A NAME='G_MOIST_PHYSICS_PREP_EM'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MOIST_PHYSICS_PREP_EM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4525'>
<font color=#993300>subroutine </font><font color=#cc0000>g_moist_physics_prep_em</font>( t_new, g_t_new, t_old, g_t_old, t0, rho, g_rho, al, g_al, alb, p, g_p, p8w, g_p8w, p0, &amp; <A href='../../call_to/G_MOIST_PHYSICS_PREP_EM.html' TARGET='index'>3</A>,<A href='../../call_from/G_MOIST_PHYSICS_PREP_EM.html' TARGET='index'>2</A><a name='4526'>
&amp;pb, ph, g_ph, phb, pii, g_pii, pf, g_pf, z, g_z, z_at_w, g_z_at_w, dz8w, g_dz8w, dt, h_diabatic, g_h_diabatic, &amp;<a name='4527'>
&amp;config_flags, fzm, fzp, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='4528'>
<font color=#447700>!******************************************************************<a name='4529'></font>
<font color=#447700>!******************************************************************<a name='4530'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='4531'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.8.81  **<a name='4532'></font>
<font color=#447700>!******************************************************************<a name='4533'></font>
<font color=#447700>!******************************************************************<a name='4534'></font>
<font color=#447700>!==============================================<a name='4535'></font>
<font color=#447700>! all entries are defined explicitly<a name='4536'></font>
<font color=#447700>!==============================================<a name='4537'></font>
implicit none<a name='4538'>
<a name='4539'>
<font color=#447700>!==============================================<a name='4540'></font>
<font color=#447700>! declare arguments<a name='4541'></font>
<font color=#447700>!==============================================<a name='4542'></font>
integer, intent(in) :: ime<a name='4543'>
integer, intent(in) :: ims<a name='4544'>
integer, intent(in) :: jme<a name='4545'>
integer, intent(in) :: jms<a name='4546'>
integer, intent(in) :: kme<a name='4547'>
integer, intent(in) :: kms<a name='4548'>
real, intent(in) :: al(ims:ime,kms:kme,jms:jme)<a name='4549'>
real, intent(in) :: alb(ims:ime,kms:kme,jms:jme)<a name='4550'>
type(grid_config_rec_type), intent(in) :: config_flags<a name='4551'>
real, intent(in) :: dt<a name='4552'>
real, intent(out) :: dz8w(ims:ime,kms:kme,jms:jme)<a name='4553'>
real, intent(in) :: fzm(kms:kme)<a name='4554'>
real, intent(in) :: fzp(kms:kme)<a name='4555'>
real, intent(in) :: g_al(ims:ime,kms:kme,jms:jme)<a name='4556'>
real             :: g_alb(ims:ime,kms:kme,jms:jme)<a name='4557'>
real, intent(out) :: g_dz8w(ims:ime,kms:kme,jms:jme)<a name='4558'>
real, intent(inout) :: g_h_diabatic(ims:ime,kms:kme,jms:jme)<a name='4559'>
real, intent(in) :: g_p(ims:ime,kms:kme,jms:jme)<a name='4560'>
real, intent(out) :: g_p8w(ims:ime,kms:kme,jms:jme)<a name='4561'>
real             :: g_pb(ims:ime,kms:kme,jms:jme)<a name='4562'>
real, intent(out) :: g_pf(ims:ime,kms:kme,jms:jme)<a name='4563'>
real, intent(in) :: g_ph(ims:ime,kms:kme,jms:jme)<a name='4564'>
real             :: g_phb(ims:ime,kms:kme,jms:jme)<a name='4565'>
real, intent(out) :: g_pii(ims:ime,kms:kme,jms:jme)<a name='4566'>
real, intent(out) :: g_rho(ims:ime,kms:kme,jms:jme)<a name='4567'>
real, intent(inout) :: g_t_new(ims:ime,kms:kme,jms:jme)<a name='4568'>
real, intent(inout) :: g_t_old(ims:ime,kms:kme,jms:jme)<a name='4569'>
real, intent(out) :: g_z(ims:ime,kms:kme,jms:jme)<a name='4570'>
real, intent(out) :: g_z_at_w(ims:ime,kms:kme,jms:jme)<a name='4571'>
real, intent(inout) :: h_diabatic(ims:ime,kms:kme,jms:jme)<a name='4572'>
integer, intent(in) :: ide<a name='4573'>
integer, intent(in) :: ids<a name='4574'>
integer, intent(in) :: ite<a name='4575'>
integer, intent(in) :: its<a name='4576'>
integer, intent(in) :: jde<a name='4577'>
integer, intent(in) :: jds<a name='4578'>
integer, intent(in) :: jte<a name='4579'>
integer, intent(in) :: jts<a name='4580'>
integer, intent(in) :: kde<a name='4581'>
integer, intent(in) :: kds<a name='4582'>
integer, intent(in) :: kte<a name='4583'>
integer, intent(in) :: kts<a name='4584'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='4585'>
real, intent(in) :: p0<a name='4586'>
real, intent(out) :: p8w(ims:ime,kms:kme,jms:jme)<a name='4587'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='4588'>
real, intent(out) :: pf(ims:ime,kms:kme,jms:jme)<a name='4589'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='4590'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='4591'>
real, intent(out) :: pii(ims:ime,kms:kme,jms:jme)<a name='4592'>
real, intent(out) :: rho(ims:ime,kms:kme,jms:jme)<a name='4593'>
real, intent(in) :: t0<a name='4594'>
real, intent(inout) :: t_new(ims:ime,kms:kme,jms:jme)<a name='4595'>
real, intent(inout) :: t_old(ims:ime,kms:kme,jms:jme)<a name='4596'>
real, intent(out) :: z(ims:ime,kms:kme,jms:jme)<a name='4597'>
real, intent(out) :: z_at_w(ims:ime,kms:kme,jms:jme)<a name='4598'>
<a name='4599'>
<font color=#447700>!==============================================<a name='4600'></font>
<font color=#447700>! declare local variables<a name='4601'></font>
<font color=#447700>!==============================================<a name='4602'></font>
real g_w1<a name='4603'>
real g_w2<a name='4604'>
real g_z0<a name='4605'>
real g_z1<a name='4606'>
real g_z2<a name='4607'>
integer i<a name='4608'>
integer i_end<a name='4609'>
integer i_start<a name='4610'>
integer j<a name='4611'>
integer j_end<a name='4612'>
integer j_start<a name='4613'>
integer k<a name='4614'>
integer k_end<a name='4615'>
integer k_start<a name='4616'>
real w1<a name='4617'>
real w2<a name='4618'>
real z0<a name='4619'>
real z1<a name='4620'>
real z2<a name='4621'>
<a name='4622'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MOIST_PHYSICS_PREP_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_72">("g_moist_physics_prep_em")<a name='4623'>
<a name='4624'>
<font color=#447700>!----------------------------------------------<a name='4625'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='4626'></font>
<font color=#447700>!----------------------------------------------<a name='4627'></font>
g_pb(:,:,:)=0.<a name='4628'>
g_phb(:,:,:)=0.<a name='4629'>
g_alb(:,:,:)=0.<a name='4630'>
<a name='4631'>
i_start = its<a name='4632'>
i_end = min(ite,ide-1)<a name='4633'>
j_start = jts<a name='4634'>
j_end = min(jte,jde-1)<a name='4635'>
k_start = kts<a name='4636'>
k_end = min(kte,kde-1)<a name='4637'>
do j = j_start, j_end<a name='4638'>
  do k = k_start, kte<a name='4639'>
    do i = i_start, i_end<a name='4640'>
      g_z_at_w(i,k,j) = g_ph(i,k,j)/g+g_phb(i,k,j)/g<a name='4641'>
      z_at_w(i,k,j) = (ph(i,k,j)+phb(i,k,j))/g<a name='4642'>
    end do<a name='4643'>
  end do<a name='4644'>
end do<a name='4645'>
do j = j_start, j_end<a name='4646'>
  do k = k_start, kte-1<a name='4647'>
    do i = i_start, i_end<a name='4648'>
      g_dz8w(i,k,j) = g_z_at_w(i,k+1,j)-g_z_at_w(i,k,j)<a name='4649'>
      dz8w(i,k,j) = z_at_w(i,k+1,j)-z_at_w(i,k,j)<a name='4650'>
    end do<a name='4651'>
  end do<a name='4652'>
end do<a name='4653'>
do j = j_start, j_end<a name='4654'>
  do i = i_start, i_end<a name='4655'>
    g_dz8w(i,kte,j) = 0.<a name='4656'>
    dz8w(i,kte,j) = 0.<a name='4657'>
  end do<a name='4658'>
end do<a name='4659'>
do j = j_start, j_end<a name='4660'>
  do k = k_start, k_end<a name='4661'>
    do i = i_start, i_end<a name='4662'>
      t_new(i,k,j) = t_new(i,k,j)+t0<a name='4663'>
      t_old(i,k,j) = t_old(i,k,j)+t0<a name='4664'>
      g_rho(i,k,j) = -(g_al(i,k,j)/((al(i,k,j)+alb(i,k,j))*(al(i,k,j)+alb(i,k,j)))+g_alb(i,k,j)/((al(i,k,j)+alb(i,k,j))*(al(i,k,j)+&amp;<a name='4665'>
&amp;alb(i,k,j))))<a name='4666'>
      rho(i,k,j) = 1./(al(i,k,j)+alb(i,k,j))<a name='4667'>
      g_pii(i,k,j) = (g_p(i,k,j)/p0+g_pb(i,k,j)/p0)*rcp*((p(i,k,j)+pb(i,k,j))/p0)**(rcp-1)<a name='4668'>
      pii(i,k,j) = ((p(i,k,j)+pb(i,k,j))/p0)**rcp<a name='4669'>
      g_z(i,k,j) = 0.5*g_z_at_w(i,k+1,j)+0.5*g_z_at_w(i,k,j)<a name='4670'>
      z(i,k,j) = 0.5*(z_at_w(i,k,j)+z_at_w(i,k+1,j))<a name='4671'>
      g_pf(i,k,j) = g_p(i,k,j)+g_pb(i,k,j)<a name='4672'>
      pf(i,k,j) = p(i,k,j)+pb(i,k,j)<a name='4673'>
    end do<a name='4674'>
  end do<a name='4675'>
end do<a name='4676'>
<a name='4677'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MOIST_PHYSICS_PREP_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_72">("g_moist_physics_prep_em")<a name='4678'>
<a name='4679'>
end subroutine g_moist_physics_prep_em<a name='4680'>
<a name='4681'>
<a name='4682'>
<font color=#447700>!                           DISCLAIMER<a name='4683'></font>
<font color=#447700>!<a name='4684'></font>
<font color=#447700>!   This file was generated by TAF version 1.8.81<a name='4685'></font>
<font color=#447700>!<a name='4686'></font>
<font color=#447700>!   FASTOPT DISCLAIMS  ALL  WARRANTIES,  EXPRESS  OR  IMPLIED,<a name='4687'></font>
<font color=#447700>!   INCLUDING (WITHOUT LIMITATION) ALL IMPLIED  WARRANTIES  OF<a name='4688'></font>
<font color=#447700>!   MERCHANTABILITY  OR FITNESS FOR A PARTICULAR PURPOSE, WITH<a name='4689'></font>
<font color=#447700>!   RESPECT TO THE SOFTWARE AND USER PROGRAMS.   IN  NO  EVENT<a name='4690'></font>
<font color=#447700>!   SHALL  FASTOPT BE LIABLE FOR ANY LOST OR ANTICIPATED PROF-<a name='4691'></font>
<font color=#447700>!   ITS, OR ANY INDIRECT, INCIDENTAL, EXEMPLARY,  SPECIAL,  OR<a name='4692'></font>
<font color=#447700>!   CONSEQUENTIAL  DAMAGES, WHETHER OR NOT FASTOPT WAS ADVISED<a name='4693'></font>
<font color=#447700>!   OF THE POSSIBILITY OF SUCH DAMAGES.<a name='4694'></font>
<font color=#447700>!<a name='4695'></font>
<font color=#447700>!                           Haftungsbeschraenkung<a name='4696'></font>
<font color=#447700>!   FastOpt gibt ausdruecklich keine Gewaehr, explizit oder indirekt,<a name='4697'></font>
<font color=#447700>!   bezueglich der Brauchbarkeit  der Software  fuer einen bestimmten<a name='4698'></font>
<font color=#447700>!   Zweck.   Unter  keinen  Umstaenden   ist  FastOpt   haftbar  fuer<a name='4699'></font>
<font color=#447700>!   irgendeinen Verlust oder nicht eintretenden erwarteten Gewinn und<a name='4700'></font>
<font color=#447700>!   allen indirekten,  zufaelligen,  exemplarischen  oder  speziellen<a name='4701'></font>
<font color=#447700>!   Schaeden  oder  Folgeschaeden  unabhaengig  von einer eventuellen<a name='4702'></font>
<font color=#447700>!   Mitteilung darueber an FastOpt.<a name='4703'></font>
<font color=#447700>!<a name='4704'></font>
<A NAME='G_MOIST_PHYSICS_FINISH_EM'><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MOIST_PHYSICS_FINISH_EM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4705'>
<font color=#993300>subroutine </font><font color=#cc0000>g_moist_physics_finish_em</font>( t_new, g_t_new, t_old, g_t_old, t0, mut, g_mut, h_diabatic, g_h_diabatic, dt, config_flags, &amp; <A href='../../call_to/G_MOIST_PHYSICS_FINISH_EM.html' TARGET='index'>1</A>,<A href='../../call_from/G_MOIST_PHYSICS_FINISH_EM.html' TARGET='index'>2</A><a name='4706'>
&amp;ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='4707'>
<font color=#447700>!******************************************************************<a name='4708'></font>
<font color=#447700>!******************************************************************<a name='4709'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='4710'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.8.81  **<a name='4711'></font>
<font color=#447700>!******************************************************************<a name='4712'></font>
<font color=#447700>!******************************************************************<a name='4713'></font>
<font color=#447700>!==============================================<a name='4714'></font>
<font color=#447700>! all entries are defined explicitly<a name='4715'></font>
<font color=#447700>!==============================================<a name='4716'></font>
implicit none<a name='4717'>
<a name='4718'>
<font color=#447700>!==============================================<a name='4719'></font>
<font color=#447700>! declare arguments<a name='4720'></font>
<font color=#447700>!==============================================<a name='4721'></font>
type(grid_config_rec_type), intent(in) :: config_flags<a name='4722'>
real, intent(in) :: dt<a name='4723'>
integer, intent(in) :: ime<a name='4724'>
integer, intent(in) :: ims<a name='4725'>
integer, intent(in) :: jme<a name='4726'>
integer, intent(in) :: jms<a name='4727'>
integer, intent(in) :: kme<a name='4728'>
integer, intent(in) :: kms<a name='4729'>
real, intent(inout) :: g_h_diabatic(ims:ime,kms:kme,jms:jme)<a name='4730'>
real, intent(inout) :: g_mut(ims:ime,jms:jme)<a name='4731'>
real, intent(inout) :: g_t_new(ims:ime,kms:kme,jms:jme)<a name='4732'>
real, intent(inout) :: g_t_old(ims:ime,kms:kme,jms:jme)<a name='4733'>
real, intent(inout) :: h_diabatic(ims:ime,kms:kme,jms:jme)<a name='4734'>
integer, intent(in) :: ide<a name='4735'>
integer, intent(in) :: ids<a name='4736'>
integer, intent(in) :: ite<a name='4737'>
integer, intent(in) :: its<a name='4738'>
integer, intent(in) :: jde<a name='4739'>
integer, intent(in) :: jds<a name='4740'>
integer, intent(in) :: jte<a name='4741'>
integer, intent(in) :: jts<a name='4742'>
integer, intent(in) :: kde<a name='4743'>
integer, intent(in) :: kds<a name='4744'>
integer, intent(in) :: kte<a name='4745'>
integer, intent(in) :: kts<a name='4746'>
real, intent(inout) :: mut(ims:ime,jms:jme)<a name='4747'>
real, intent(in) :: t0<a name='4748'>
real, intent(inout) :: t_new(ims:ime,kms:kme,jms:jme)<a name='4749'>
real, intent(inout) :: t_old(ims:ime,kms:kme,jms:jme)<a name='4750'>
<a name='4751'>
<font color=#447700>!==============================================<a name='4752'></font>
<font color=#447700>! declare local variables<a name='4753'></font>
<font color=#447700>!==============================================<a name='4754'></font>
integer i<a name='4755'>
integer i_end<a name='4756'>
integer i_start<a name='4757'>
integer j<a name='4758'>
integer j_end<a name='4759'>
integer j_start<a name='4760'>
integer k<a name='4761'>
integer k_end<a name='4762'>
integer k_start<a name='4763'>
<a name='4764'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MOIST_PHYSICS_FINISH_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_73">("g_moist_physics_finish_em")<a name='4765'>
<a name='4766'>
<font color=#447700>!----------------------------------------------<a name='4767'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='4768'></font>
<font color=#447700>!----------------------------------------------<a name='4769'></font>
i_start = its<a name='4770'>
i_end = min(ite,ide-1)<a name='4771'>
j_start = jts<a name='4772'>
j_end = min(jte,jde-1)<a name='4773'>
k_start = kts<a name='4774'>
k_end = min(kte,kde-1)<a name='4775'>
do j = j_start, j_end<a name='4776'>
  do k = k_start, k_end<a name='4777'>
    do i = i_start, i_end<a name='4778'>
      g_t_new(i,k,j) = g_t_new(i,k,j)<a name='4779'>
      t_new(i,k,j) = t_new(i,k,j)-t0<a name='4780'>
<a name='4781'>
      g_t_old(i,k,j) = g_t_old(i,k,j)<a name='4782'>
      t_old(i,k,j) = t_old(i,k,j)-t0<a name='4783'>
<a name='4784'>
    end do<a name='4785'>
  end do<a name='4786'>
end do<a name='4787'>
<a name='4788'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MOIST_PHYSICS_FINISH_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_73">("g_moist_physics_finish_em")<a name='4789'>
<a name='4790'>
end subroutine g_moist_physics_finish_em<a name='4791'>
<a name='4792'>
<a name='4793'>
end module g_module_big_step_utilities_em<a name='4794'>
</pre></body></html>