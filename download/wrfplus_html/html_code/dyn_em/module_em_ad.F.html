<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!                           DISCLAIMER<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<font color=#447700>!   This file was generated by TAF version 1.7.18<a name='4'></font>
<font color=#447700>!<a name='5'></font>
<font color=#447700>!   FASTOPT DISCLAIMS  ALL  WARRANTIES,  EXPRESS  OR  IMPLIED,<a name='6'></font>
<font color=#447700>!   INCLUDING (WITHOUT LIMITATION) ALL IMPLIED  WARRANTIES  OF<a name='7'></font>
<font color=#447700>!   MERCHANTABILITY  OR FITNESS FOR A PARTICULAR PURPOSE, WITH<a name='8'></font>
<font color=#447700>!   RESPECT TO THE SOFTWARE AND USER PROGRAMS.   IN  NO  EVENT<a name='9'></font>
<font color=#447700>!   SHALL  FASTOPT BE LIABLE FOR ANY LOST OR ANTICIPATED PROF-<a name='10'></font>
<font color=#447700>!   ITS, OR ANY INDIRECT, INCIDENTAL, EXEMPLARY,  SPECIAL,  OR<a name='11'></font>
<font color=#447700>!   CONSEQUENTIAL  DAMAGES, WHETHER OR NOT FASTOPT WAS ADVISED<a name='12'></font>
<font color=#447700>!   OF THE POSSIBILITY OF SUCH DAMAGES.<a name='13'></font>
<font color=#447700>!<a name='14'></font>
<font color=#447700>!                           Haftungsbeschraenkung<a name='15'></font>
<font color=#447700>!   FastOpt gibt ausdruecklich keine Gewaehr, explizit oder indirekt,<a name='16'></font>
<font color=#447700>!   bezueglich der Brauchbarkeit  der Software  fuer einen bestimmten<a name='17'></font>
<font color=#447700>!   Zweck.   Unter  keinen  Umstaenden   ist  FastOpt   haftbar  fuer<a name='18'></font>
<font color=#447700>!   irgendeinen Verlust oder nicht eintretenden erwarteten Gewinn und<a name='19'></font>
<font color=#447700>!   allen indirekten,  zufaelligen,  exemplarischen  oder  speziellen<a name='20'></font>
<font color=#447700>!   Schaeden  oder  Folgeschaeden  unabhaengig  von einer eventuellen<a name='21'></font>
<font color=#447700>!   Mitteilung darueber an FastOpt.<a name='22'></font>
<font color=#447700>!<a name='23'></font>
<A NAME='A_MODULE_EM'><A href='../../html_code/dyn_em/module_em_ad.F.html#A_MODULE_EM' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='24'>
<font color=#993300>module     </font><font color=#cc0000>a_module_em</font> <A href='../../call_to/A_MODULE_EM.html' TARGET='index'>2</A><a name='25'>
<font color=#447700>!******************************************************************<a name='26'></font>
<font color=#447700>!******************************************************************<a name='27'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='28'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='29'></font>
<font color=#447700>!******************************************************************<a name='30'></font>
<font color=#447700>!******************************************************************<a name='31'></font>
<font color=#447700>!==============================================<a name='32'></font>
<font color=#447700>! referencing used modules<a name='33'></font>
<font color=#447700>!==============================================<a name='34'></font>
use <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/module_em_ad.F.html#module_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_11"><a name='35'>
use <A href='../../html_code/dyn_em/module_advect_em.F.html#MODULE_ADVECT_EM'>module_advect_em</A><A href='../../html_code/dyn_em/module_em_ad.F.html#module_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ADVECT_EM_4"><a name='36'>
use <A href='../../html_code/dyn_em/module_advect_em_ad.F.html#A_MODULE_ADVECT_EM'>a_module_advect_em</A><A href='../../html_code/dyn_em/module_em_ad.F.html#module_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MODULE_ADVECT_EM_2"><a name='37'>
use <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#MODULE_BIG_STEP_UTILITIES_EM'>module_big_step_utilities_em</A><A href='../../html_code/dyn_em/module_em_ad.F.html#module_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BIG_STEP_UTILITIES_EM_9"><a name='38'>
use <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_MODULE_BIG_STEP_UTILITIES_EM'>a_module_big_step_utilities_em</A><A href='../../html_code/dyn_em/module_em_ad.F.html#module_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MODULE_BIG_STEP_UTILITIES_EM_3"><a name='39'>
use module_state_description<a name='40'>
use <A href='../../html_code/dyn_em/module_em.F.html#MODULE_EM'>module_em</A><A href='../../html_code/dyn_em/module_em_ad.F.html#module_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_EM_1"><a name='41'>
<a name='42'>
USE <A href='../../html_code/frame/module_trace.F.html#MODULE_TRACE'>module_trace</A><A href='../../html_code/dyn_em/module_em_ad.F.html#module_em_ad.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TRACE_8">, only : trace_entry, trace_exit<a name='43'>
<a name='44'>
<font color=#447700>!==============================================<a name='45'></font>
<font color=#447700>! all entries are defined explicitly<a name='46'></font>
<font color=#447700>!==============================================<a name='47'></font>
implicit none<a name='48'>
<a name='49'>
<a name='50'>
contains<a name='51'>
<a name='52'>
<A NAME='A_INIT_ZERO_TENDENCY'><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='53'>
<font color=#993300>subroutine </font><font color=#cc0000>a_init_zero_tendency</font>( a_ru_tendf, a_rv_tendf, a_rw_tendf, a_ph_tendf, a_t_tendf, a_moist_tendf, n_moist, ims, ime, jms, &amp; <A href='../../call_to/A_INIT_ZERO_TENDENCY.html' TARGET='index'>2</A>,<A href='../../call_from/A_INIT_ZERO_TENDENCY.html' TARGET='index'>8</A><a name='54'>
&amp;jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='55'>
<font color=#447700>!******************************************************************<a name='56'></font>
<font color=#447700>!******************************************************************<a name='57'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='58'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='59'></font>
<font color=#447700>!******************************************************************<a name='60'></font>
<font color=#447700>!******************************************************************<a name='61'></font>
<font color=#447700>!==============================================<a name='62'></font>
<font color=#447700>! all entries are defined explicitly<a name='63'></font>
<font color=#447700>!==============================================<a name='64'></font>
implicit none<a name='65'>
<a name='66'>
<font color=#447700>!==============================================<a name='67'></font>
<font color=#447700>! declare arguments<a name='68'></font>
<font color=#447700>!==============================================<a name='69'></font>
integer, intent(in) :: ime<a name='70'>
integer, intent(in) :: ims<a name='71'>
integer, intent(in) :: jme<a name='72'>
integer, intent(in) :: jms<a name='73'>
integer, intent(in) :: kme<a name='74'>
integer, intent(in) :: kms<a name='75'>
integer, intent(in) :: n_moist<a name='76'>
real, intent(inout) :: a_moist_tendf(ims:ime,kms:kme,jms:jme,n_moist)<a name='77'>
real, intent(inout) :: a_ph_tendf(ims:ime,kms:kme,jms:jme)<a name='78'>
real, intent(inout) :: a_ru_tendf(ims:ime,kms:kme,jms:jme)<a name='79'>
real, intent(inout) :: a_rv_tendf(ims:ime,kms:kme,jms:jme)<a name='80'>
real, intent(inout) :: a_rw_tendf(ims:ime,kms:kme,jms:jme)<a name='81'>
real, intent(inout) :: a_t_tendf(ims:ime,kms:kme,jms:jme)<a name='82'>
integer, intent(in) :: ite<a name='83'>
integer, intent(in) :: its<a name='84'>
integer, intent(in) :: jte<a name='85'>
integer, intent(in) :: jts<a name='86'>
integer, intent(in) :: kte<a name='87'>
integer, intent(in) :: kts<a name='88'>
<a name='89'>
<font color=#447700>!==============================================<a name='90'></font>
<font color=#447700>! declare local variables<a name='91'></font>
<font color=#447700>!==============================================<a name='92'></font>
integer im<a name='93'>
<a name='94'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_74">("a_init_zero_tendency")<a name='95'>
<a name='96'>
<font color=#447700>!----------------------------------------------<a name='97'></font>
<font color=#447700>! ROUTINE BODY<a name='98'></font>
<font color=#447700>!----------------------------------------------<a name='99'></font>
do im = n_moist, 1, -1<a name='100'>
  call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_1">( a_moist_tendf(ims,kms,jms,im),ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='101'>
end do<a name='102'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_2">( a_t_tendf,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='103'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_3">( a_ph_tendf,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='104'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_4">( a_rw_tendf,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='105'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_5">( a_rv_tendf,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='106'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_6">( a_ru_tendf,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='107'>
<a name='108'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_74">("a_init_zero_tendency")<a name='109'>
<a name='110'>
end subroutine a_init_zero_tendency<a name='111'>
<a name='112'>
<a name='113'>
<A NAME='A_RK_ADDTEND_DRY'><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_ADDTEND_DRY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='114'>
<font color=#993300>subroutine </font><font color=#cc0000>a_rk_addtend_dry</font>( a_ru_tend, a_rv_tend, a_rw_tend, a_ph_tend, a_t_tend, a_ru_tendf, a_rv_tendf, a_rw_tendf, a_ph_tendf, &amp; <A href='../../call_to/A_RK_ADDTEND_DRY.html' TARGET='index'>2</A>,<A href='../../call_from/A_RK_ADDTEND_DRY.html' TARGET='index'>2</A><a name='115'>
&amp;a_t_tendf, a_u_save, a_v_save, a_w_save, a_ph_save, a_t_save, rk_step, h_diabatic, a_mut, msft, msfu, msfv, ide, jde, ims, ime, &amp;<a name='116'>
&amp;jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='117'>
<font color=#447700>!******************************************************************<a name='118'></font>
<font color=#447700>!******************************************************************<a name='119'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='120'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='121'></font>
<font color=#447700>!******************************************************************<a name='122'></font>
<font color=#447700>!******************************************************************<a name='123'></font>
<font color=#447700>!==============================================<a name='124'></font>
<font color=#447700>! all entries are defined explicitly<a name='125'></font>
<font color=#447700>!==============================================<a name='126'></font>
implicit none<a name='127'>
<a name='128'>
<font color=#447700>!==============================================<a name='129'></font>
<font color=#447700>! declare arguments<a name='130'></font>
<font color=#447700>!==============================================<a name='131'></font>
integer, intent(in) :: ime<a name='132'>
integer, intent(in) :: ims<a name='133'>
integer, intent(in) :: jme<a name='134'>
integer, intent(in) :: jms<a name='135'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='136'>
integer, intent(in) :: kme<a name='137'>
integer, intent(in) :: kms<a name='138'>
real, intent(inout) :: a_ph_save(ims:ime,kms:kme,jms:jme)<a name='139'>
real, intent(inout) :: a_ph_tend(ims:ime,kms:kme,jms:jme)<a name='140'>
real, intent(inout) :: a_ph_tendf(ims:ime,kms:kme,jms:jme)<a name='141'>
real, intent(inout) :: a_ru_tend(ims:ime,kms:kme,jms:jme)<a name='142'>
real, intent(inout) :: a_ru_tendf(ims:ime,kms:kme,jms:jme)<a name='143'>
real, intent(inout) :: a_rv_tend(ims:ime,kms:kme,jms:jme)<a name='144'>
real, intent(inout) :: a_rv_tendf(ims:ime,kms:kme,jms:jme)<a name='145'>
real, intent(inout) :: a_rw_tend(ims:ime,kms:kme,jms:jme)<a name='146'>
real, intent(inout) :: a_rw_tendf(ims:ime,kms:kme,jms:jme)<a name='147'>
real, intent(inout) :: a_t_save(ims:ime,kms:kme,jms:jme)<a name='148'>
real, intent(inout) :: a_t_tend(ims:ime,kms:kme,jms:jme)<a name='149'>
real, intent(inout) :: a_t_tendf(ims:ime,kms:kme,jms:jme)<a name='150'>
real, intent(inout) :: a_u_save(ims:ime,kms:kme,jms:jme)<a name='151'>
real, intent(inout) :: a_v_save(ims:ime,kms:kme,jms:jme)<a name='152'>
real, intent(inout) :: a_w_save(ims:ime,kms:kme,jms:jme)<a name='153'>
real, intent(in) :: h_diabatic(ims:ime,kms:kme,jms:jme)<a name='154'>
integer, intent(in) :: ide<a name='155'>
integer, intent(in) :: ite<a name='156'>
integer, intent(in) :: its<a name='157'>
integer, intent(in) :: jde<a name='158'>
integer, intent(in) :: jte<a name='159'>
integer, intent(in) :: jts<a name='160'>
integer, intent(in) :: kte<a name='161'>
integer, intent(in) :: kts<a name='162'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='163'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='164'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='165'>
integer, intent(in) :: rk_step<a name='166'>
<a name='167'>
<font color=#447700>!==============================================<a name='168'></font>
<font color=#447700>! declare local variables<a name='169'></font>
<font color=#447700>!==============================================<a name='170'></font>
integer i<a name='171'>
integer j<a name='172'>
integer k<a name='173'>
<a name='174'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_ADDTEND_DRY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_75">("a_rk_addtend_dry")<a name='175'>
<a name='176'>
<font color=#447700>!----------------------------------------------<a name='177'></font>
<font color=#447700>! ROUTINE BODY<a name='178'></font>
<font color=#447700>!----------------------------------------------<a name='179'></font>
do j = jts, min(jte,jde-1)<a name='180'>
  do k = kts, kte-1<a name='181'>
    do i = its, min(ite,ide-1)<a name='182'>
      a_mut(i,j) = a_mut(i,j)+a_t_tend(i,k,j)*(h_diabatic(i,k,j)/msft(i,j))<a name='183'>
      a_t_tendf(i,k,j) = a_t_tendf(i,k,j)+a_t_tend(i,k,j)/msft(i,j)<a name='184'>
      if (rk_step .eq. 1) then<a name='185'>
        a_t_save(i,k,j) = a_t_save(i,k,j)+a_t_tendf(i,k,j)<a name='186'>
      endif<a name='187'>
    end do<a name='188'>
  end do<a name='189'>
end do<a name='190'>
do j = jts, min(jte,jde-1)<a name='191'>
  do k = kts, kte<a name='192'>
    do i = its, min(ite,ide-1)<a name='193'>
      a_ph_tendf(i,k,j) = a_ph_tendf(i,k,j)+a_ph_tend(i,k,j)/msft(i,j)<a name='194'>
      if (rk_step .eq. 1) then<a name='195'>
        a_ph_save(i,k,j) = a_ph_save(i,k,j)+a_ph_tendf(i,k,j)<a name='196'>
      endif<a name='197'>
      a_rw_tendf(i,k,j) = a_rw_tendf(i,k,j)+a_rw_tend(i,k,j)/msft(i,j)<a name='198'>
      if (rk_step .eq. 1) then<a name='199'>
        a_w_save(i,k,j) = a_w_save(i,k,j)+a_rw_tendf(i,k,j)*msft(i,j)<a name='200'>
      endif<a name='201'>
    end do<a name='202'>
  end do<a name='203'>
end do<a name='204'>
do j = jts, jte<a name='205'>
  do k = kts, kte-1<a name='206'>
    do i = its, min(ite,ide-1)<a name='207'>
      a_rv_tendf(i,k,j) = a_rv_tendf(i,k,j)+a_rv_tend(i,k,j)/msfv(i,j)<a name='208'>
      if (rk_step .eq. 1) then<a name='209'>
        a_v_save(i,k,j) = a_v_save(i,k,j)+a_rv_tendf(i,k,j)*msfv(i,j)<a name='210'>
      endif<a name='211'>
    end do<a name='212'>
  end do<a name='213'>
end do<a name='214'>
do j = jts, min(jte,jde-1)<a name='215'>
  do k = kts, kte-1<a name='216'>
    do i = its, ite<a name='217'>
      a_ru_tendf(i,k,j) = a_ru_tendf(i,k,j)+a_ru_tend(i,k,j)/msfu(i,j)<a name='218'>
      if (rk_step .eq. 1) then<a name='219'>
        a_u_save(i,k,j) = a_u_save(i,k,j)+a_ru_tendf(i,k,j)*msfu(i,j)<a name='220'>
      endif<a name='221'>
    end do<a name='222'>
  end do<a name='223'>
end do<a name='224'>
<a name='225'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_ADDTEND_DRY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_75">("a_rk_addtend_dry")<a name='226'>
<a name='227'>
end subroutine a_rk_addtend_dry<a name='228'>
<a name='229'>
<a name='230'>
<A NAME='A_RK_SCALAR_TEND'><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='231'>
<font color=#993300>subroutine </font><font color=#cc0000>a_rk_scalar_tend</font>( scs, sce, config_flags, rk_step, ru, a_ru, rv, a_rv, ww, a_ww, mut, a_mut, alt, a_alt, scalar_old, &amp; <A href='../../call_to/A_RK_SCALAR_TEND.html' TARGET='index'>2</A>,<A href='../../call_from/A_RK_SCALAR_TEND.html' TARGET='index'>11</A><a name='232'>
&amp;a_scalar_old, scalar, a_scalar, a_scalar_tends, a_advect_tend, base, moist_step, fnm, fnp, msfu, msfv, msft, rdx, rdy, rdn, rdnw, &amp;<a name='233'>
&amp;kvdif, xkmhd, a_xkmhd, leapfrog, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='234'>
<font color=#447700>!******************************************************************<a name='235'></font>
<font color=#447700>!******************************************************************<a name='236'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='237'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='238'></font>
<font color=#447700>!******************************************************************<a name='239'></font>
<font color=#447700>!******************************************************************<a name='240'></font>
<font color=#447700>!==============================================<a name='241'></font>
<font color=#447700>! all entries are defined explicitly<a name='242'></font>
<font color=#447700>!==============================================<a name='243'></font>
implicit none<a name='244'>
<a name='245'>
<font color=#447700>!==============================================<a name='246'></font>
<font color=#447700>! declare arguments<a name='247'></font>
<font color=#447700>!==============================================<a name='248'></font>
integer, intent(in) :: ime<a name='249'>
integer, intent(in) :: ims<a name='250'>
integer, intent(in) :: jme<a name='251'>
integer, intent(in) :: jms<a name='252'>
integer, intent(in) :: kme<a name='253'>
integer, intent(in) :: kms<a name='254'>
real a_advect_tend(ims:ime,kms:kme,jms:jme)<a name='255'>
real, intent(inout) :: a_alt(ims:ime,kms:kme,jms:jme)<a name='256'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='257'>
real, intent(inout) :: a_ru(ims:ime,kms:kme,jms:jme)<a name='258'>
real, intent(inout) :: a_rv(ims:ime,kms:kme,jms:jme)<a name='259'>
integer, intent(in) :: sce<a name='260'>
integer, intent(in) :: scs<a name='261'>
real, intent(inout) :: a_scalar(ims:ime,kms:kme,jms:jme,scs:sce)<a name='262'>
real, intent(inout) :: a_scalar_old(ims:ime,kms:kme,jms:jme,scs:sce)<a name='263'>
real, intent(inout) :: a_scalar_tends(ims:ime,kms:kme,jms:jme,scs:sce)<a name='264'>
real, intent(inout) :: a_ww(ims:ime,kms:kme,jms:jme)<a name='265'>
real, intent(inout) :: a_xkmhd(ims:ime,kms:kme,jms:jme)<a name='266'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='267'>
real, intent(in) :: base(kms:kme)<a name='268'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='269'>
real, intent(in) :: fnm(kms:kme)<a name='270'>
real, intent(in) :: fnp(kms:kme)<a name='271'>
integer, intent(in) :: ide<a name='272'>
integer, intent(in) :: ids<a name='273'>
integer, intent(in) :: ite<a name='274'>
integer, intent(in) :: its<a name='275'>
integer, intent(in) :: jde<a name='276'>
integer, intent(in) :: jds<a name='277'>
integer, intent(in) :: jte<a name='278'>
integer, intent(in) :: jts<a name='279'>
integer, intent(in) :: kde<a name='280'>
integer, intent(in) :: kte<a name='281'>
integer, intent(in) :: kts<a name='282'>
real, intent(in) :: kvdif<a name='283'>
logical, intent(in) :: leapfrog<a name='284'>
logical, intent(in) :: moist_step<a name='285'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='286'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='287'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='288'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='289'>
real, intent(in) :: rdn(kms:kme)<a name='290'>
real, intent(in) :: rdnw(kms:kme)<a name='291'>
real, intent(in) :: rdx<a name='292'>
real, intent(in) :: rdy<a name='293'>
integer, intent(in) :: rk_step<a name='294'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='295'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='296'>
real, intent(inout) :: scalar(ims:ime,kms:kme,jms:jme,scs:sce)<a name='297'>
real, intent(inout) :: scalar_old(ims:ime,kms:kme,jms:jme,scs:sce)<a name='298'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='299'>
real, intent(in) :: xkmhd(ims:ime,kms:kme,jms:jme)<a name='300'>
<a name='301'>
<font color=#447700>!==============================================<a name='302'></font>
<font color=#447700>! declare local variables<a name='303'></font>
<font color=#447700>!==============================================<a name='304'></font>
integer im<a name='305'>
real kvdq<a name='306'>
<a name='307'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_76">("a_rk_scalar_tend")<a name='308'>
<a name='309'>
<font color=#447700>!----------------------------------------------<a name='310'></font>
<font color=#447700>! ROUTINE BODY<a name='311'></font>
<font color=#447700>!----------------------------------------------<a name='312'></font>
kvdq = kvdif/prandtl<a name='313'>
<font color=#447700>! recompute : kvdq<a name='314'></font>
a_scalar_loop: do im = sce, scs, -1<a name='315'>
  a_diff_opt1: if (config_flags%diff_opt .eq. 1) then<a name='316'>
    a_rk_step_1: if (rk_step .eq. 1) then<a name='317'>
      if ( .not. leapfrog) then<a name='318'>
        a_pbl_test: if (config_flags%bl_pbl_physics .eq. 0) then<a name='319'>
          if (moist_step .and. im .eq. p_qv) then<a name='320'>
            call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION_MP'>a_vertical_diffusion_mp</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_MP_1">( scalar(ims,kms,jms,im),a_scalar(ims,kms,jms,im),a_scalar_tends(ims,kms,jms,im),base,alt,&amp;<a name='321'>
&amp;a_alt,mut,a_mut,rdn,rdnw,kvdq,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='322'>
          else<a name='323'>
            call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION'>a_vertical_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_1">( 'm',scalar(ims,kms,jms,im),a_scalar(ims,kms,jms,im),a_scalar_tends(ims,kms,jms,im),alt,&amp;<a name='324'>
&amp;a_alt,mut,a_mut,rdn,rdnw,kvdq,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='325'>
          endif<a name='326'>
        endif a_pbl_test<a name='327'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION'>a_horizontal_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_1">( 'm',scalar(ims,kms,jms,im),a_scalar(ims,kms,jms,im),a_scalar_tends(ims,kms,jms,im),mut,a_mut,&amp;<a name='328'>
&amp;config_flags,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='329'>
      else<a name='330'>
        a_pbl_test_lf: if (config_flags%bl_pbl_physics .eq. 0) then<a name='331'>
          if (moist_step .and. im .eq. p_qv) then<a name='332'>
            call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION_MP'>a_vertical_diffusion_mp</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_MP_2">( scalar_old(ims,kms,jms,im),a_scalar_old(ims,kms,jms,im),a_scalar_tends(ims,kms,jms,im),&amp;<a name='333'>
&amp;base,alt,a_alt,mut,a_mut,rdn,rdnw,kvdq,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='334'>
          else<a name='335'>
            call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION'>a_vertical_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_2">( 'm',scalar_old(ims,kms,jms,im),a_scalar_old(ims,kms,jms,im),a_scalar_tends(ims,kms,jms,im),&amp;<a name='336'>
&amp;alt,a_alt,mut,a_mut,rdn,rdnw,kvdq,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='337'>
          endif<a name='338'>
        endif a_pbl_test_lf<a name='339'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION'>a_horizontal_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_2">( 'm',scalar_old(ims,kms,jms,im),a_scalar_old(ims,kms,jms,im),a_scalar_tends(ims,kms,jms,im),&amp;<a name='340'>
&amp;mut,a_mut,config_flags,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='341'>
      endif<a name='342'>
    endif a_rk_step_1<a name='343'>
  endif a_diff_opt1<a name='344'>
  if ( .not. leapfrog) then<a name='345'>
<a name='346'>
    call <A href='../../html_code/dyn_em/module_advect_em_ad.F.html#A_ADVECT_SCALAR'>a_advect_scalar</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVECT_SCALAR_2">( scalar(ims,kms,jms,im),a_scalar(ims,kms,jms,im),scalar(ims,kms,jms,im),a_scalar(ims,kms,jms,im),&amp;<a name='347'>
&amp;a_advect_tend(ims,kms,jms),ru,a_ru,rv,a_rv,ww,a_ww,config_flags,msft,fnm,fnp,rdx,rdy,rdnw,ids,ide,jds,jde,kde,ims,ime,jms,jme,&amp;<a name='348'>
&amp;kms,kme,its,ite,jts,jte,kts,kte )<a name='349'>
<a name='350'>
  else<a name='351'>
    call <A href='../../html_code/dyn_em/module_advect_em_ad.F.html#A_ADVECT_SCALAR'>a_advect_scalar</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVECT_SCALAR_3">( scalar(ims,kms,jms,im),a_scalar(ims,kms,jms,im),scalar_old(ims,kms,jms,im),a_scalar_old(ims,kms,jms,im),&amp;<a name='352'>
&amp;a_advect_tend(ims,kms,jms),ru,a_ru,rv,a_rv,ww,a_ww,config_flags,msft,fnm,fnp,rdx,rdy,rdnw,ids,ide,jds,jde,kde,ims,ime,jms,jme,&amp;<a name='353'>
&amp;kms,kme,its,ite,jts,jte,kts,kte )<a name='354'>
  endif<a name='355'>
  call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_7">( a_advect_tend(ims,kms,jms),ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='356'>
end do a_scalar_loop<a name='357'>
<a name='358'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_76">("a_rk_scalar_tend")<a name='359'>
<a name='360'>
end subroutine a_rk_scalar_tend<a name='361'>
<a name='362'>
<a name='363'>
<A NAME='A_RK_STEP_PREP'><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='364'>
<font color=#993300>subroutine </font><font color=#cc0000>a_rk_step_prep</font>( config_flags, u, a_u, v, a_v, w, a_w, a_ph, mu, a_mu, moist, a_moist, a_ru, a_rv, a_rw, a_ww, a_php, &amp; <A href='../../call_to/A_RK_STEP_PREP.html' TARGET='index'>2</A>,<A href='../../call_from/A_RK_STEP_PREP.html' TARGET='index'>11</A><a name='365'>
&amp;a_alt, muu, a_muu, muv, a_muv, mub, mut, a_mut, a_al, a_cqu, a_cqv, a_cqw, msfu, msfv, msft, dnw, rdx, rdy, n_moist, ids, ide, &amp;<a name='366'>
&amp;jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='367'>
<font color=#447700>!******************************************************************<a name='368'></font>
<font color=#447700>!******************************************************************<a name='369'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='370'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='371'></font>
<font color=#447700>!******************************************************************<a name='372'></font>
<font color=#447700>!******************************************************************<a name='373'></font>
<font color=#447700>!==============================================<a name='374'></font>
<font color=#447700>! all entries are defined explicitly<a name='375'></font>
<font color=#447700>!==============================================<a name='376'></font>
implicit none<a name='377'>
<a name='378'>
<font color=#447700>!==============================================<a name='379'></font>
<font color=#447700>! declare arguments<a name='380'></font>
<font color=#447700>!==============================================<a name='381'></font>
integer, intent(in) :: ime<a name='382'>
integer, intent(in) :: ims<a name='383'>
integer, intent(in) :: jme<a name='384'>
integer, intent(in) :: jms<a name='385'>
integer, intent(in) :: kme<a name='386'>
integer, intent(in) :: kms<a name='387'>
real, intent(inout) :: a_al(ims:ime,kms:kme,jms:jme)<a name='388'>
real, intent(inout) :: a_alt(ims:ime,kms:kme,jms:jme)<a name='389'>
real, intent(inout) :: a_cqu(ims:ime,kms:kme,jms:jme)<a name='390'>
real, intent(inout) :: a_cqv(ims:ime,kms:kme,jms:jme)<a name='391'>
real, intent(inout) :: a_cqw(ims:ime,kms:kme,jms:jme)<a name='392'>
integer, intent(in) :: n_moist<a name='393'>
real, intent(inout) :: a_moist(ims:ime,kms:kme,jms:jme,n_moist)<a name='394'>
real, intent(inout) :: a_mu(ims:ime,jms:jme)<a name='395'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='396'>
real, intent(inout) :: a_muu(ims:ime,jms:jme)<a name='397'>
real, intent(inout) :: a_muv(ims:ime,jms:jme)<a name='398'>
real, intent(inout) :: a_ph(ims:ime,kms:kme,jms:jme)<a name='399'>
real, intent(inout) :: a_php(ims:ime,kms:kme,jms:jme)<a name='400'>
real, intent(inout) :: a_ru(ims:ime,kms:kme,jms:jme)<a name='401'>
real, intent(inout) :: a_rv(ims:ime,kms:kme,jms:jme)<a name='402'>
real, intent(inout) :: a_rw(ims:ime,kms:kme,jms:jme)<a name='403'>
real, intent(inout) :: a_u(ims:ime,kms:kme,jms:jme)<a name='404'>
real, intent(inout) :: a_v(ims:ime,kms:kme,jms:jme)<a name='405'>
real, intent(inout) :: a_w(ims:ime,kms:kme,jms:jme)<a name='406'>
real, intent(inout) :: a_ww(ims:ime,kms:kme,jms:jme)<a name='407'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='408'>
real, intent(in) :: dnw(kms:kme)<a name='409'>
integer, intent(in) :: ide<a name='410'>
integer, intent(in) :: ids<a name='411'>
integer, intent(in) :: ite<a name='412'>
integer, intent(in) :: its<a name='413'>
integer, intent(in) :: jde<a name='414'>
integer, intent(in) :: jds<a name='415'>
integer, intent(in) :: jte<a name='416'>
integer, intent(in) :: jts<a name='417'>
integer, intent(in) :: kde<a name='418'>
integer, intent(in) :: kte<a name='419'>
integer, intent(in) :: kts<a name='420'>
real, intent(in) :: moist(ims:ime,kms:kme,jms:jme,n_moist)<a name='421'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='422'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='423'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='424'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='425'>
real, intent(in) :: mub(ims:ime,jms:jme)<a name='426'>
real, intent(out) :: mut(ims:ime,jms:jme)<a name='427'>
real, intent(out) :: muu(ims:ime,jms:jme)<a name='428'>
real, intent(out) :: muv(ims:ime,jms:jme)<a name='429'>
real, intent(in) :: rdx<a name='430'>
real, intent(in) :: rdy<a name='431'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='432'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='433'>
real, intent(in) :: w(ims:ime,kms:kme,jms:jme)<a name='434'>
<a name='435'>
<font color=#447700>!==============================================<a name='436'></font>
<font color=#447700>! declare local variables<a name='437'></font>
<font color=#447700>!==============================================<a name='438'></font>
integer kds<a name='439'>
<a name='440'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_77">("a_rk_step_prep")<a name='441'>
<a name='442'>
<font color=#447700>!----------------------------------------------<a name='443'></font>
<font color=#447700>! ROUTINE BODY<a name='444'></font>
<font color=#447700>!----------------------------------------------<a name='445'></font>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALCULATE_FULL'>calculate_full</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_FULL_2">( mut,mub,mu,ids,ide,jds,jde,1,2,ims,ime,jms,jme,1,1,its,ite,jts,jte,1,1 )<a name='446'>
<font color=#447700>! recompute : mut<a name='447'></font>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_MU_UV'>calc_mu_uv</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_MU_UV_2">( config_flags,mu,mub,muu,muv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='448'>
<font color=#447700>! recompute : muu,muv<a name='449'></font>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALC_PHP'>a_calc_php</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_PHP_1">( a_php,a_ph,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='450'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALC_ALT'>a_calc_alt</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_ALT_1">( a_alt,a_al,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='451'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALC_CQ'>a_calc_cq</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_CQ_1">( moist,a_moist,a_cqu,a_cqv,a_cqw,n_moist,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='452'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALC_WW_CP'>a_calc_ww_cp</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_WW_CP_1">( u,a_u,v,a_v,mu,a_mu,mub,a_ww,rdx,rdy,msft,msfu,msfv,dnw,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,&amp;<a name='453'>
&amp;kte )<a name='454'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_COUPLE_MOMENTUM'>a_couple_momentum</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_COUPLE_MOMENTUM_1">( muu,a_muu,a_ru,u,a_u,msfu,muv,a_muv,a_rv,v,a_v,msfv,mut,a_mut,a_rw,w,a_w,msft,ide,jde,kde,ims,ime,jms,jme,&amp;<a name='455'>
&amp;kms,kme,its,ite,jts,jte,kts,kte )<a name='456'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALC_MU_UV'>a_calc_mu_uv</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_MU_UV_1">( config_flags,a_mu,a_muu,a_muv,ids,ide,jds,jde,ims,ime,jms,jme,its,ite,jts,jte )<a name='457'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALCULATE_FULL'>a_calculate_full</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALCULATE_FULL_1">( a_mut,a_mu,ide,jde,2,ims,ime,jms,jme,1,1,its,ite,jts,jte,1,1 )<a name='458'>
<a name='459'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_77">("a_rk_step_prep")<a name='460'>
<a name='461'>
end subroutine a_rk_step_prep<a name='462'>
<a name='463'>
<a name='464'>
<A NAME='A_RK_TENDENCY1'><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='465'>
<font color=#993300>subroutine </font><font color=#cc0000>a_rk_tendency1</font>( config_flags, rk_step, a_ru_tend, a_rv_tend, a_rw_tend, a_ph_tend, a_t_tend, a_ru_tendf, a_rv_tendf, &amp; <A href='../../call_to/A_RK_TENDENCY1.html' TARGET='index'>2</A>,<A href='../../call_from/A_RK_TENDENCY1.html' TARGET='index'>25</A><a name='466'>
&amp;a_rw_tendf, a_t_tendf, a_mu_tend, a_u_save, a_v_save, a_w_save, a_ph_save, a_t_save, ru, a_ru, rv, a_rv, rw, a_rw, ww, a_ww, u, &amp;<a name='467'>
&amp;a_u, v, a_v, w, a_w, t, a_t, ph, a_ph, u_old, a_u_old, v_old, a_v_old, w_old, a_w_old, t_old, a_t_old, ph_old, a_ph_old, phb, &amp;<a name='468'>
&amp;t_init, mu, a_mu, mut, a_mut, muu, a_muu, muv, a_muv, mub, al, a_al, alt, a_alt, p, a_p, pb, php, a_php, cqu, a_cqu, cqv, a_cqv, &amp;<a name='469'>
&amp;cqw, a_cqw, u_base, v_base, z_base, msfu, msfv, msft, f, e, sina, cosa, fnm, fnp, rdn, rdnw, dt, rdx, rdy, kvdif, xkmhd, a_xkmhd, &amp;<a name='470'>
&amp;cf1, cf2, cf3, cfn, cfn1, non_hydrostatic, leapfrog, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, &amp;<a name='471'>
&amp;kts, kte )<a name='472'>
<font color=#447700>!******************************************************************<a name='473'></font>
<font color=#447700>!******************************************************************<a name='474'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='475'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='476'></font>
<font color=#447700>!******************************************************************<a name='477'></font>
<font color=#447700>!******************************************************************<a name='478'></font>
<font color=#447700>!==============================================<a name='479'></font>
<font color=#447700>! all entries are defined explicitly<a name='480'></font>
<font color=#447700>!==============================================<a name='481'></font>
implicit none<a name='482'>
<a name='483'>
<font color=#447700>!==============================================<a name='484'></font>
<font color=#447700>! declare arguments<a name='485'></font>
<font color=#447700>!==============================================<a name='486'></font>
integer, intent(in) :: ime<a name='487'>
integer, intent(in) :: ims<a name='488'>
integer, intent(in) :: jme<a name='489'>
integer, intent(in) :: jms<a name='490'>
integer, intent(in) :: kme<a name='491'>
integer, intent(in) :: kms<a name='492'>
real, intent(inout) :: a_al(ims:ime,kms:kme,jms:jme)<a name='493'>
real, intent(inout) :: a_alt(ims:ime,kms:kme,jms:jme)<a name='494'>
real, intent(inout) :: a_cqu(ims:ime,kms:kme,jms:jme)<a name='495'>
real, intent(inout) :: a_cqv(ims:ime,kms:kme,jms:jme)<a name='496'>
real, intent(inout) :: a_cqw(ims:ime,kms:kme,jms:jme)<a name='497'>
real, intent(inout) :: a_mu(ims:ime,jms:jme)<a name='498'>
real, intent(inout) :: a_mu_tend(ims:ime,jms:jme)<a name='499'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='500'>
real, intent(inout) :: a_muu(ims:ime,jms:jme)<a name='501'>
real, intent(inout) :: a_muv(ims:ime,jms:jme)<a name='502'>
real, intent(inout) :: a_p(ims:ime,kms:kme,jms:jme)<a name='503'>
real, intent(inout) :: a_ph(ims:ime,kms:kme,jms:jme)<a name='504'>
real, intent(inout) :: a_ph_old(ims:ime,kms:kme,jms:jme)<a name='505'>
real, intent(inout) :: a_ph_save(ims:ime,kms:kme,jms:jme)<a name='506'>
real, intent(inout) :: a_ph_tend(ims:ime,kms:kme,jms:jme)<a name='507'>
real, intent(inout) :: a_php(ims:ime,kms:kme,jms:jme)<a name='508'>
real, intent(inout) :: a_ru(ims:ime,kms:kme,jms:jme)<a name='509'>
real, intent(inout) :: a_ru_tend(ims:ime,kms:kme,jms:jme)<a name='510'>
real, intent(inout) :: a_ru_tendf(ims:ime,kms:kme,jms:jme)<a name='511'>
real, intent(inout) :: a_rv(ims:ime,kms:kme,jms:jme)<a name='512'>
real, intent(inout) :: a_rv_tend(ims:ime,kms:kme,jms:jme)<a name='513'>
real, intent(inout) :: a_rv_tendf(ims:ime,kms:kme,jms:jme)<a name='514'>
real, intent(inout) :: a_rw(ims:ime,kms:kme,jms:jme)<a name='515'>
real, intent(inout) :: a_rw_tend(ims:ime,kms:kme,jms:jme)<a name='516'>
real, intent(inout) :: a_rw_tendf(ims:ime,kms:kme,jms:jme)<a name='517'>
real, intent(inout) :: a_t(ims:ime,kms:kme,jms:jme)<a name='518'>
real, intent(inout) :: a_t_old(ims:ime,kms:kme,jms:jme)<a name='519'>
real, intent(inout) :: a_t_save(ims:ime,kms:kme,jms:jme)<a name='520'>
real, intent(inout) :: a_t_tend(ims:ime,kms:kme,jms:jme)<a name='521'>
real, intent(inout) :: a_t_tendf(ims:ime,kms:kme,jms:jme)<a name='522'>
real, intent(inout) :: a_u(ims:ime,kms:kme,jms:jme)<a name='523'>
real, intent(inout) :: a_u_old(ims:ime,kms:kme,jms:jme)<a name='524'>
real, intent(inout) :: a_u_save(ims:ime,kms:kme,jms:jme)<a name='525'>
real, intent(inout) :: a_v(ims:ime,kms:kme,jms:jme)<a name='526'>
real, intent(inout) :: a_v_old(ims:ime,kms:kme,jms:jme)<a name='527'>
real, intent(inout) :: a_v_save(ims:ime,kms:kme,jms:jme)<a name='528'>
real, intent(inout) :: a_w(ims:ime,kms:kme,jms:jme)<a name='529'>
real, intent(inout) :: a_w_old(ims:ime,kms:kme,jms:jme)<a name='530'>
real, intent(inout) :: a_w_save(ims:ime,kms:kme,jms:jme)<a name='531'>
real, intent(inout) :: a_ww(ims:ime,kms:kme,jms:jme)<a name='532'>
real, intent(inout) :: a_xkmhd(ims:ime,kms:kme,jms:jme)<a name='533'>
real, intent(in) :: al(ims:ime,kms:kme,jms:jme)<a name='534'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='535'>
real cf1<a name='536'>
real cf2<a name='537'>
real cf3<a name='538'>
real cfn<a name='539'>
real cfn1<a name='540'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='541'>
real, intent(in) :: cosa(ims:ime,jms:jme)<a name='542'>
real, intent(in) :: cqu(ims:ime,kms:kme,jms:jme)<a name='543'>
real, intent(in) :: cqv(ims:ime,kms:kme,jms:jme)<a name='544'>
real, intent(inout) :: cqw(ims:ime,kms:kme,jms:jme)<a name='545'>
real, intent(in) :: dt<a name='546'>
real, intent(in) :: e(ims:ime,jms:jme)<a name='547'>
real, intent(in) :: f(ims:ime,jms:jme)<a name='548'>
real, intent(in) :: fnm(kms:kme)<a name='549'>
real, intent(in) :: fnp(kms:kme)<a name='550'>
integer, intent(in) :: ide<a name='551'>
integer, intent(in) :: ids<a name='552'>
integer, intent(in) :: ite<a name='553'>
integer, intent(in) :: its<a name='554'>
integer, intent(in) :: jde<a name='555'>
integer, intent(in) :: jds<a name='556'>
integer, intent(in) :: jte<a name='557'>
integer, intent(in) :: jts<a name='558'>
integer, intent(in) :: kde<a name='559'>
integer, intent(in) :: kte<a name='560'>
integer, intent(in) :: kts<a name='561'>
real, intent(in) :: kvdif<a name='562'>
logical, intent(in) :: leapfrog<a name='563'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='564'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='565'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='566'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='567'>
real, intent(in) :: mub(ims:ime,jms:jme)<a name='568'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='569'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='570'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='571'>
logical, intent(in) :: non_hydrostatic<a name='572'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='573'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='574'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='575'>
real, intent(in) :: ph_old(ims:ime,kms:kme,jms:jme)<a name='576'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='577'>
real, intent(in) :: php(ims:ime,kms:kme,jms:jme)<a name='578'>
real, intent(in) :: rdn(kms:kme)<a name='579'>
real, intent(in) :: rdnw(kms:kme)<a name='580'>
real, intent(in) :: rdx<a name='581'>
real, intent(in) :: rdy<a name='582'>
integer, intent(in) :: rk_step<a name='583'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='584'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='585'>
real, intent(in) :: rw(ims:ime,kms:kme,jms:jme)<a name='586'>
real, intent(in) :: sina(ims:ime,jms:jme)<a name='587'>
real, intent(in) :: t(ims:ime,kms:kme,jms:jme)<a name='588'>
real, intent(in) :: t_init(ims:ime,kms:kme,jms:jme)<a name='589'>
real, intent(in) :: t_old(ims:ime,kms:kme,jms:jme)<a name='590'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='591'>
real, intent(in) :: u_base(kms:kme)<a name='592'>
real, intent(in) :: u_old(ims:ime,kms:kme,jms:jme)<a name='593'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='594'>
real, intent(in) :: v_base(kms:kme)<a name='595'>
real, intent(in) :: v_old(ims:ime,kms:kme,jms:jme)<a name='596'>
real, intent(in) :: w(ims:ime,kms:kme,jms:jme)<a name='597'>
real, intent(in) :: w_old(ims:ime,kms:kme,jms:jme)<a name='598'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='599'>
real, intent(in) :: xkmhd(ims:ime,kms:kme,jms:jme)<a name='600'>
real, intent(in) :: z_base(kms:kme)<a name='601'>
<a name='602'>
<font color=#447700>!==============================================<a name='603'></font>
<font color=#447700>! declare local variables<a name='604'></font>
<font color=#447700>!==============================================<a name='605'></font>
real kvdq<a name='606'>
<a name='607'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_78">("a_rk_tendency1")<a name='608'>
<a name='609'>
<font color=#447700>!----------------------------------------------<a name='610'></font>
<font color=#447700>! ROUTINE BODY<a name='611'></font>
<font color=#447700>!----------------------------------------------<a name='612'></font>
a_forward_step: if (rk_step .eq. 1) then<a name='613'>
  a_diff_opt1: if (config_flags%diff_opt .eq. 1) then<a name='614'>
    a_leapfrog_test: if ( .not. leapfrog) then<a name='615'>
      a_pbl_test: if (config_flags%bl_pbl_physics .eq. 0) then<a name='616'>
        kvdq = 3.*kvdif<a name='617'>
<font color=#447700>! recompute : kvdq<a name='618'></font>
<a name='619'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION_3DMP'>a_vertical_diffusion_3dmp</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_3DMP_1">( t,a_t,a_t_tendf,t_init,alt,a_alt,mut,a_mut,rdn,rdnw,kvdq,ide,jde,kde,ims,ime,jms,jme,kms,&amp;<a name='620'>
&amp;kme,its,ite,jts,jte,kts,kte )<a name='621'>
        if (non_hydrostatic) then<a name='622'>
          call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION'>a_vertical_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_3">( 'w',w,a_w,a_rw_tendf,alt,a_alt,mut,a_mut,rdn,rdnw,kvdif,ide,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='623'>
&amp;its,ite,jts,jte,kts,kte )<a name='624'>
        endif<a name='625'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION_V'>a_vertical_diffusion_v</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_V_1">( v,a_v,a_rv_tendf,config_flags,v_base,alt,a_alt,muv,a_muv,rdn,rdnw,kvdif,ide,jds,jde,kde,ims,&amp;<a name='626'>
&amp;ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='627'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION_U'>a_vertical_diffusion_u</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_U_1">( u,a_u,a_ru_tendf,config_flags,u_base,alt,a_alt,muu,a_muu,rdn,rdnw,kvdif,ids,ide,jde,kde,ims,&amp;<a name='628'>
&amp;ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='629'>
      endif a_pbl_test<a name='630'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION_3DMP'>a_horizontal_diffusion_3dmp</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_3DMP_1">( t,a_t,a_t_tendf,mut,a_mut,config_flags,t_init,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,ide,&amp;<a name='631'>
&amp;jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='632'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION'>a_horizontal_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_3">( 'w',w,a_w,a_rw_tendf,mut,a_mut,config_flags,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,ide,jds,&amp;<a name='633'>
&amp;jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='634'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION'>a_horizontal_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_4">( 'v',v,a_v,a_rv_tendf,mut,a_mut,config_flags,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,ide,jds,&amp;<a name='635'>
&amp;jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='636'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION'>a_horizontal_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_5">( 'u',u,a_u,a_ru_tendf,mut,a_mut,config_flags,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,ide,jds,&amp;<a name='637'>
&amp;jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='638'>
    else a_leapfrog_test<a name='639'>
      a_pbl_test_lf: if (config_flags%bl_pbl_physics .eq. 0) then<a name='640'>
        kvdq = 3.*kvdif<a name='641'>
<font color=#447700>! recompute : kvdq<a name='642'></font>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION_3DMP'>a_vertical_diffusion_3dmp</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_3DMP_2">( t_old,a_t_old,a_t_tendf,t_init,alt,a_alt,mut,a_mut,rdn,rdnw,kvdq,ide,jde,kde,ims,ime,jms,&amp;<a name='643'>
&amp;jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='644'>
        if (non_hydrostatic) then<a name='645'>
          call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION'>a_vertical_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_4">( 'w',w_old,a_w_old,a_rw_tendf,alt,a_alt,mut,a_mut,rdn,rdnw,kvdif,ide,jde,kde,ims,ime,jms,jme,&amp;<a name='646'>
&amp;kms,kme,its,ite,jts,jte,kts,kte )<a name='647'>
        endif<a name='648'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION_V'>a_vertical_diffusion_v</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_V_2">( v_old,a_v_old,a_rv_tendf,config_flags,v_base,alt,a_alt,muv,a_muv,rdn,rdnw,kvdif,ide,jds,jde,&amp;<a name='649'>
&amp;kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='650'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_VERTICAL_DIFFUSION_U'>a_vertical_diffusion_u</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_VERTICAL_DIFFUSION_U_2">( u_old,a_u_old,a_ru_tendf,config_flags,u_base,alt,a_alt,muu,a_muu,rdn,rdnw,kvdif,ids,ide,jde,&amp;<a name='651'>
&amp;kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='652'>
      endif a_pbl_test_lf<a name='653'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION_3DMP'>a_horizontal_diffusion_3dmp</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_3DMP_2">( t_old,a_t_old,a_t_tendf,mut,a_mut,config_flags,t_init,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,&amp;<a name='654'>
&amp;ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='655'>
      if (non_hydrostatic) then<a name='656'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION'>a_horizontal_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_6">( 'w',w_old,a_w_old,a_rw_tendf,mut,a_mut,config_flags,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,&amp;<a name='657'>
&amp;ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='658'>
      endif<a name='659'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION'>a_horizontal_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_7">( 'v',v_old,a_v_old,a_rv_tendf,mut,a_mut,config_flags,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,&amp;<a name='660'>
&amp;ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='661'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_DIFFUSION'>a_horizontal_diffusion</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_DIFFUSION_8">( 'u',u_old,a_u_old,a_ru_tendf,mut,a_mut,config_flags,msfu,msfv,msft,xkmhd,a_xkmhd,rdx,rdy,ids,&amp;<a name='662'>
&amp;ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='663'>
    endif a_leapfrog_test<a name='664'>
  endif a_diff_opt1<a name='665'>
endif a_forward_step<a name='666'>
<a name='667'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CURVATURE'>a_curvature</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CURVATURE_1">( ru,a_ru,rv,a_rv,rw,a_rw,u,a_u,v,a_v,a_ru_tend,a_rv_tend,a_rw_tend,config_flags,msfu,msfv,fnm,fnp,rdx,rdy,ids,ide,&amp;<a name='668'>
&amp;jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='669'>
<a name='670'>
if (config_flags%pert_coriolis) then<a name='671'>
  call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_PERTURBATION_CORIOLIS'>a_perturbation_coriolis</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_PERTURBATION_CORIOLIS_1">( a_ru,a_rv,a_rw,a_ru_tend,a_rv_tend,a_rw_tend,config_flags,u_base,v_base,z_base,muu,a_muu,muv,a_muv,&amp;<a name='672'>
&amp;phb,ph,a_ph,f,e,sina,cosa,fnm,fnp,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='673'>
else<a name='674'>
  call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CORIOLIS'>a_coriolis</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CORIOLIS_1">( a_ru,a_rv,a_rw,a_ru_tend,a_rv_tend,a_rw_tend,config_flags,f,e,sina,cosa,fnm,fnp,ids,ide,jds,jde,kde,ims,ime,jms,&amp;<a name='675'>
&amp;jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='676'>
endif<a name='677'>
if (config_flags%w_damping .eq. 1) then<a name='678'>
  call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_W_DAMP'>a_w_damp</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_W_DAMP_1">( a_rw_tend,ww,a_ww,w,a_w,mut,a_mut,rdnw,dt,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte )<a name='679'>
endif<a name='680'>
if (non_hydrostatic) then<a name='681'>
  call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_PG_BUOY_W'>a_pg_buoy_w</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_PG_BUOY_W_1">( a_rw_tend,p,a_p,cqw,a_cqw,a_mu,mub,rdnw,rdn,g,msft,ide,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte )<a name='682'>
endif<a name='683'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_HORIZONTAL_PRESSURE_GRADIENT'>a_horizontal_pressure_gradient</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_HORIZONTAL_PRESSURE_GRADIENT_1">( a_ru_tend,a_rv_tend,ph,a_ph,alt,a_alt,p,a_p,pb,al,a_al,php,a_php,cqu,a_cqu,cqv,a_cqv,muu,&amp;<a name='684'>
&amp;a_muu,muv,a_muv,mu,a_mu,fnm,fnp,rdnw,cf1,cf2,cf3,rdx,rdy,config_flags,non_hydrostatic,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='685'>
&amp;its,ite,jts,jte,kte )<a name='686'>
  call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_RHS_PH'>a_rhs_ph</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_RHS_PH_1">( a_ph_tend,u,a_u,v,a_v,ww,a_ww,ph,a_ph,ph,a_ph,phb,w,a_w,mut,a_mut,muu,a_muu,muv,a_muv,fnm,fnp,rdnw,cfn,cfn1,rdx,&amp;<a name='687'>
&amp;rdy,msft,non_hydrostatic,config_flags,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='688'>
<a name='689'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_78">("a_rk_tendency1")<a name='690'>
<a name='691'>
end subroutine a_rk_tendency1<a name='692'>
<a name='693'>
<a name='694'>
<A NAME='A_RK_TENDENCY2'><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='695'>
<font color=#993300>subroutine </font><font color=#cc0000>a_rk_tendency2</font>( config_flags, rk_step, a_ru_tend, a_rv_tend, a_rw_tend, a_ph_tend, a_t_tend, a_ru_tendf, a_rv_tendf, &amp; <A href='../../call_to/A_RK_TENDENCY2.html' TARGET='index'>2</A>,<A href='../../call_from/A_RK_TENDENCY2.html' TARGET='index'>17</A><a name='696'>
&amp;a_rw_tendf, a_t_tendf, a_mu_tend, a_u_save, a_v_save, a_w_save, a_ph_save, a_t_save, ru, a_ru, rv, a_rv, rw, a_rw, ww, a_ww, u, &amp;<a name='697'>
&amp;a_u, v, a_v, w, a_w, t, a_t, ph, a_ph, u_old, a_u_old, v_old, a_v_old, w_old, a_w_old, t_old, a_t_old, ph_old, a_ph_old, phb, &amp;<a name='698'>
&amp;t_init, mu, a_mu, mut, a_mut, muu, a_muu, muv, a_muv, mub, al, a_al, alt, a_alt, p, a_p, pb, php, a_php, cqu, a_cqu, cqv, a_cqv, &amp;<a name='699'>
&amp;cqw, a_cqw, u_base, v_base, z_base, msfu, msfv, msft, f, e, sina, cosa, fnm, fnp, rdn, rdnw, dt, rdx, rdy, kvdif, xkmhd, a_xkmhd, &amp;<a name='700'>
&amp;cf1, cf2, cf3, cfn, cfn1, non_hydrostatic, leapfrog, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, &amp;<a name='701'>
&amp;kts, kte )<a name='702'>
<font color=#447700>!******************************************************************<a name='703'></font>
<font color=#447700>!******************************************************************<a name='704'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='705'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='706'></font>
<font color=#447700>!******************************************************************<a name='707'></font>
<font color=#447700>!******************************************************************<a name='708'></font>
<font color=#447700>!==============================================<a name='709'></font>
<font color=#447700>! all entries are defined explicitly<a name='710'></font>
<font color=#447700>!==============================================<a name='711'></font>
implicit none<a name='712'>
<a name='713'>
<font color=#447700>!==============================================<a name='714'></font>
<font color=#447700>! declare arguments<a name='715'></font>
<font color=#447700>!==============================================<a name='716'></font>
integer, intent(in) :: ime<a name='717'>
integer, intent(in) :: ims<a name='718'>
integer, intent(in) :: jme<a name='719'>
integer, intent(in) :: jms<a name='720'>
integer, intent(in) :: kme<a name='721'>
integer, intent(in) :: kms<a name='722'>
real, intent(inout) :: a_al(ims:ime,kms:kme,jms:jme)<a name='723'>
real, intent(inout) :: a_alt(ims:ime,kms:kme,jms:jme)<a name='724'>
real, intent(inout) :: a_cqu(ims:ime,kms:kme,jms:jme)<a name='725'>
real, intent(inout) :: a_cqv(ims:ime,kms:kme,jms:jme)<a name='726'>
real, intent(inout) :: a_cqw(ims:ime,kms:kme,jms:jme)<a name='727'>
real, intent(inout) :: a_mu(ims:ime,jms:jme)<a name='728'>
real, intent(inout) :: a_mu_tend(ims:ime,jms:jme)<a name='729'>
real, intent(inout) :: a_mut(ims:ime,jms:jme)<a name='730'>
real, intent(inout) :: a_muu(ims:ime,jms:jme)<a name='731'>
real, intent(inout) :: a_muv(ims:ime,jms:jme)<a name='732'>
real, intent(inout) :: a_p(ims:ime,kms:kme,jms:jme)<a name='733'>
real, intent(inout) :: a_ph(ims:ime,kms:kme,jms:jme)<a name='734'>
real, intent(inout) :: a_ph_old(ims:ime,kms:kme,jms:jme)<a name='735'>
real, intent(inout) :: a_ph_save(ims:ime,kms:kme,jms:jme)<a name='736'>
real, intent(inout) :: a_ph_tend(ims:ime,kms:kme,jms:jme)<a name='737'>
real, intent(inout) :: a_php(ims:ime,kms:kme,jms:jme)<a name='738'>
real, intent(inout) :: a_ru(ims:ime,kms:kme,jms:jme)<a name='739'>
real, intent(inout) :: a_ru_tend(ims:ime,kms:kme,jms:jme)<a name='740'>
real, intent(inout) :: a_ru_tendf(ims:ime,kms:kme,jms:jme)<a name='741'>
real, intent(inout) :: a_rv(ims:ime,kms:kme,jms:jme)<a name='742'>
real, intent(inout) :: a_rv_tend(ims:ime,kms:kme,jms:jme)<a name='743'>
real, intent(inout) :: a_rv_tendf(ims:ime,kms:kme,jms:jme)<a name='744'>
real, intent(inout) :: a_rw(ims:ime,kms:kme,jms:jme)<a name='745'>
real, intent(inout) :: a_rw_tend(ims:ime,kms:kme,jms:jme)<a name='746'>
real, intent(inout) :: a_rw_tendf(ims:ime,kms:kme,jms:jme)<a name='747'>
real, intent(inout) :: a_t(ims:ime,kms:kme,jms:jme)<a name='748'>
real, intent(inout) :: a_t_old(ims:ime,kms:kme,jms:jme)<a name='749'>
real, intent(inout) :: a_t_save(ims:ime,kms:kme,jms:jme)<a name='750'>
real, intent(inout) :: a_t_tend(ims:ime,kms:kme,jms:jme)<a name='751'>
real, intent(inout) :: a_t_tendf(ims:ime,kms:kme,jms:jme)<a name='752'>
real, intent(inout) :: a_u(ims:ime,kms:kme,jms:jme)<a name='753'>
real, intent(inout) :: a_u_old(ims:ime,kms:kme,jms:jme)<a name='754'>
real, intent(inout) :: a_u_save(ims:ime,kms:kme,jms:jme)<a name='755'>
real, intent(inout) :: a_v(ims:ime,kms:kme,jms:jme)<a name='756'>
real, intent(inout) :: a_v_old(ims:ime,kms:kme,jms:jme)<a name='757'>
real, intent(inout) :: a_v_save(ims:ime,kms:kme,jms:jme)<a name='758'>
real, intent(inout) :: a_w(ims:ime,kms:kme,jms:jme)<a name='759'>
real, intent(inout) :: a_w_old(ims:ime,kms:kme,jms:jme)<a name='760'>
real, intent(inout) :: a_w_save(ims:ime,kms:kme,jms:jme)<a name='761'>
real, intent(inout) :: a_ww(ims:ime,kms:kme,jms:jme)<a name='762'>
real, intent(inout) :: a_xkmhd(ims:ime,kms:kme,jms:jme)<a name='763'>
real, intent(in) :: al(ims:ime,kms:kme,jms:jme)<a name='764'>
real, intent(in) :: alt(ims:ime,kms:kme,jms:jme)<a name='765'>
real cf1<a name='766'>
real cf2<a name='767'>
real cf3<a name='768'>
real cfn<a name='769'>
real cfn1<a name='770'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='771'>
real, intent(in) :: cosa(ims:ime,jms:jme)<a name='772'>
real, intent(in) :: cqu(ims:ime,kms:kme,jms:jme)<a name='773'>
real, intent(in) :: cqv(ims:ime,kms:kme,jms:jme)<a name='774'>
real, intent(inout) :: cqw(ims:ime,kms:kme,jms:jme)<a name='775'>
real, intent(in) :: dt<a name='776'>
real, intent(in) :: e(ims:ime,jms:jme)<a name='777'>
real, intent(in) :: f(ims:ime,jms:jme)<a name='778'>
real, intent(in) :: fnm(kms:kme)<a name='779'>
real, intent(in) :: fnp(kms:kme)<a name='780'>
integer, intent(in) :: ide<a name='781'>
integer, intent(in) :: ids<a name='782'>
integer, intent(in) :: ite<a name='783'>
integer, intent(in) :: its<a name='784'>
integer, intent(in) :: jde<a name='785'>
integer, intent(in) :: jds<a name='786'>
integer, intent(in) :: jte<a name='787'>
integer, intent(in) :: jts<a name='788'>
integer, intent(in) :: kde<a name='789'>
integer, intent(in) :: kte<a name='790'>
integer, intent(in) :: kts<a name='791'>
real, intent(in) :: kvdif<a name='792'>
logical, intent(in) :: leapfrog<a name='793'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='794'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='795'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='796'>
real, intent(in) :: mu(ims:ime,jms:jme)<a name='797'>
real, intent(in) :: mub(ims:ime,jms:jme)<a name='798'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='799'>
real, intent(in) :: muu(ims:ime,jms:jme)<a name='800'>
real, intent(in) :: muv(ims:ime,jms:jme)<a name='801'>
logical, intent(in) :: non_hydrostatic<a name='802'>
real, intent(in) :: p(ims:ime,kms:kme,jms:jme)<a name='803'>
real, intent(in) :: pb(ims:ime,kms:kme,jms:jme)<a name='804'>
real, intent(in) :: ph(ims:ime,kms:kme,jms:jme)<a name='805'>
real, intent(in) :: ph_old(ims:ime,kms:kme,jms:jme)<a name='806'>
real, intent(in) :: phb(ims:ime,kms:kme,jms:jme)<a name='807'>
real, intent(in) :: php(ims:ime,kms:kme,jms:jme)<a name='808'>
real, intent(in) :: rdn(kms:kme)<a name='809'>
real, intent(in) :: rdnw(kms:kme)<a name='810'>
real, intent(in) :: rdx<a name='811'>
real, intent(in) :: rdy<a name='812'>
integer, intent(in) :: rk_step<a name='813'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='814'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='815'>
real, intent(in) :: rw(ims:ime,kms:kme,jms:jme)<a name='816'>
real, intent(in) :: sina(ims:ime,jms:jme)<a name='817'>
real, intent(in) :: t(ims:ime,kms:kme,jms:jme)<a name='818'>
real, intent(in) :: t_init(ims:ime,kms:kme,jms:jme)<a name='819'>
real, intent(in) :: t_old(ims:ime,kms:kme,jms:jme)<a name='820'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='821'>
real, intent(in) :: u_base(kms:kme)<a name='822'>
real, intent(in) :: u_old(ims:ime,kms:kme,jms:jme)<a name='823'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='824'>
real, intent(in) :: v_base(kms:kme)<a name='825'>
real, intent(in) :: v_old(ims:ime,kms:kme,jms:jme)<a name='826'>
real, intent(in) :: w(ims:ime,kms:kme,jms:jme)<a name='827'>
real, intent(in) :: w_old(ims:ime,kms:kme,jms:jme)<a name='828'>
real, intent(in) :: ww(ims:ime,kms:kme,jms:jme)<a name='829'>
real, intent(in) :: xkmhd(ims:ime,kms:kme,jms:jme)<a name='830'>
real, intent(in) :: z_base(kms:kme)<a name='831'>
<a name='832'>
<font color=#447700>!==============================================<a name='833'></font>
<font color=#447700>! declare local variables<a name='834'></font>
<font color=#447700>!==============================================<a name='835'></font>
real kvdq<a name='836'>
<a name='837'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_79">("a_rk_tendency2")<a name='838'>
<a name='839'>
  call <A href='../../html_code/dyn_em/module_advect_em_ad.F.html#A_ADVECT_SCALAR'>a_advect_scalar</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVECT_SCALAR_4">( t,a_t,t,a_t,a_t_tend,ru,a_ru,rv,a_rv,ww,a_ww,config_flags,msft,fnm,fnp,rdx,rdy,rdnw,ids,ide,jds,jde,kde,&amp;<a name='840'>
&amp;ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='841'>
  if (non_hydrostatic) then<a name='842'>
    call <A href='../../html_code/dyn_em/module_advect_em_ad.F.html#A_ADVECT_W'>a_advect_w</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVECT_W_1">( w,a_w,w,a_w,a_rw_tend,ru,a_ru,rv,a_rv,ww,a_ww,config_flags,msft,fnm,fnp,rdx,rdy,rdn,ids,ide,jds,jde,kde,ims,&amp;<a name='843'>
&amp;ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='844'>
  endif<a name='845'>
  call <A href='../../html_code/dyn_em/module_advect_em_ad.F.html#A_ADVECT_V'>a_advect_v</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVECT_V_1">( v,a_v,v,a_v,a_rv_tend,ru,a_ru,rv,a_rv,ww,a_ww,mut,a_mut,config_flags,msfv,fnm,fnp,rdx,rdy,rdnw,ids,ide,jds,jde,&amp;<a name='846'>
&amp;kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='847'>
<a name='848'>
  call <A href='../../html_code/dyn_em/module_advect_em_ad.F.html#A_ADVECT_U'>a_advect_u</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVECT_U_1">( u,a_u,u,a_u,a_ru_tend,ru,a_ru,rv,a_rv,ww,a_ww,mut,a_mut,config_flags,msfu,fnm,fnp,rdx,rdy,rdnw,ids,ide,jds,jde,&amp;<a name='849'>
&amp;kde,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='850'>
<a name='851'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_8">( a_mu_tend,ims,ime,jms,jme,1,1,its,ite,jts,jte,1,1 )<a name='852'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_9">( a_t_save,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='853'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_10">( a_ph_save,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='854'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_11">( a_w_save,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='855'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_12">( a_v_save,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='856'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_13">( a_u_save,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='857'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_14">( a_ph_tend,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='858'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_15">( a_t_tend,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='859'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_16">( a_rw_tend,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='860'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_17">( a_rv_tend,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='861'>
call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_ZERO_TEND'>a_zero_tend</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_TEND_18">( a_ru_tend,ims,ime,jms,jme,kms,kme,its,ite,jts,jte,kts,kte )<a name='862'>
<a name='863'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_79">("a_rk_tendency2")<a name='864'>
<a name='865'>
end subroutine a_rk_tendency2<a name='866'>
<a name='867'>
<a name='868'>
<A NAME='A_RK_UPDATE_SCALAR'><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_UPDATE_SCALAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='869'>
<font color=#993300>subroutine </font><font color=#cc0000>a_rk_update_scalar</font>( scs, sce, scalar_1, a_scalar_1, scalar_2, a_scalar_2, sc_tend, a_sc_tend, advect_tend, &amp; <A href='../../call_to/A_RK_UPDATE_SCALAR.html' TARGET='index'>2</A>,<A href='../../call_from/A_RK_UPDATE_SCALAR.html' TARGET='index'>2</A><a name='870'>
&amp;a_advect_tend, msft, mu_old, a_mu_old, mu_new, a_mu_new, mu_base, rk_step, dt, spec_zone, epsts, leapfrog, config_flags, ids, ide,&amp;<a name='871'>
&amp; jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='872'>
<font color=#447700>!******************************************************************<a name='873'></font>
<font color=#447700>!******************************************************************<a name='874'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='875'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='876'></font>
<font color=#447700>!******************************************************************<a name='877'></font>
<font color=#447700>!******************************************************************<a name='878'></font>
<font color=#447700>!==============================================<a name='879'></font>
<font color=#447700>! all entries are defined explicitly<a name='880'></font>
<font color=#447700>!==============================================<a name='881'></font>
implicit none<a name='882'>
<a name='883'>
<font color=#447700>!==============================================<a name='884'></font>
<font color=#447700>! declare arguments<a name='885'></font>
<font color=#447700>!==============================================<a name='886'></font>
integer, intent(in) :: ime<a name='887'>
integer, intent(in) :: ims<a name='888'>
integer, intent(in) :: jme<a name='889'>
integer, intent(in) :: jms<a name='890'>
integer, intent(in) :: kme<a name='891'>
integer, intent(in) :: kms<a name='892'>
real, intent(inout) :: a_advect_tend(ims:ime,kms:kme,jms:jme)<a name='893'>
real, intent(inout) :: a_mu_new(ims:ime,jms:jme)<a name='894'>
real, intent(inout) :: a_mu_old(ims:ime,jms:jme)<a name='895'>
integer, intent(in) :: sce<a name='896'>
integer, intent(in) :: scs<a name='897'>
real, intent(inout) :: a_sc_tend(ims:ime,kms:kme,jms:jme,scs:sce)<a name='898'>
real, intent(inout) :: a_scalar_1(ims:ime,kms:kme,jms:jme,scs:sce)<a name='899'>
real, intent(inout) :: a_scalar_2(ims:ime,kms:kme,jms:jme,scs:sce)<a name='900'>
real, intent(in) :: advect_tend(ims:ime,kms:kme,jms:jme)<a name='901'>
type (grid_config_rec_type), intent(in) :: config_flags<a name='902'>
real, intent(in) :: dt<a name='903'>
real, intent(in) :: epsts<a name='904'>
integer, intent(in) :: ide<a name='905'>
integer, intent(in) :: ids<a name='906'>
integer, intent(in) :: ite<a name='907'>
integer, intent(in) :: its<a name='908'>
integer, intent(in) :: jde<a name='909'>
integer, intent(in) :: jds<a name='910'>
integer, intent(in) :: jte<a name='911'>
integer, intent(in) :: jts<a name='912'>
integer, intent(in) :: kde<a name='913'>
integer, intent(in) :: kte<a name='914'>
integer, intent(in) :: kts<a name='915'>
logical, intent(in) :: leapfrog<a name='916'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='917'>
real, intent(in) :: mu_base(ims:ime,jms:jme)<a name='918'>
real, intent(in) :: mu_new(ims:ime,jms:jme)<a name='919'>
real, intent(in) :: mu_old(ims:ime,jms:jme)<a name='920'>
integer, intent(in) :: rk_step<a name='921'>
real, intent(inout) :: sc_tend(ims:ime,kms:kme,jms:jme,scs:sce)<a name='922'>
real, intent(inout) :: scalar_1(ims:ime,kms:kme,jms:jme,scs:sce)<a name='923'>
real, intent(inout) :: scalar_2(ims:ime,kms:kme,jms:jme,scs:sce)<a name='924'>
integer, intent(in) :: spec_zone<a name='925'>
<a name='926'>
<font color=#447700>!==============================================<a name='927'></font>
<font color=#447700>! declare local variables<a name='928'></font>
<font color=#447700>!==============================================<a name='929'></font>
real a_muold(its:ite)<a name='930'>
real a_r_munew(its:ite)<a name='931'>
real a_sc_middle<a name='932'>
real a_tendency(its:ite,kts:kte,jts:jte)<a name='933'>
integer i<a name='934'>
integer i_end<a name='935'>
integer i_end_spc<a name='936'>
integer i_start<a name='937'>
integer i_start_spc<a name='938'>
integer im<a name='939'>
integer j<a name='940'>
integer j_end<a name='941'>
integer j_end_spc<a name='942'>
integer j_start<a name='943'>
integer j_start_spc<a name='944'>
integer k<a name='945'>
integer k_end<a name='946'>
integer k_end_spc<a name='947'>
integer k_start<a name='948'>
integer k_start_spc<a name='949'>
real muold(its:ite)<a name='950'>
real r_munew(its:ite)<a name='951'>
real tendency(its:ite,kts:kte,jts:jte)<a name='952'>
<a name='953'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_UPDATE_SCALAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_80">("a_rk_update_scalar")<a name='954'>
<a name='955'>
<font color=#447700>!----------------------------------------------<a name='956'></font>
<font color=#447700>! RESET LOCAL ADJOINT VARIABLES<a name='957'></font>
<font color=#447700>!----------------------------------------------<a name='958'></font>
a_muold(:) = 0.<a name='959'>
a_r_munew(:) = 0.<a name='960'>
a_sc_middle = 0.<a name='961'>
a_tendency(:,:,:) = 0.<a name='962'>
<a name='963'>
<font color=#447700>!----------------------------------------------<a name='964'></font>
<font color=#447700>! ROUTINE BODY<a name='965'></font>
<font color=#447700>!----------------------------------------------<a name='966'></font>
i_start = its<a name='967'>
<font color=#447700>! recompute : i_start<a name='968'></font>
i_end = ite<a name='969'>
<font color=#447700>! recompute : i_end<a name='970'></font>
j_start = jts<a name='971'>
<font color=#447700>! recompute : j_start<a name='972'></font>
j_end = jte<a name='973'>
<font color=#447700>! recompute : j_end<a name='974'></font>
k_start = kts<a name='975'>
<font color=#447700>! recompute : k_start<a name='976'></font>
k_end = kte-1<a name='977'>
<font color=#447700>! recompute : k_end<a name='978'></font>
if (j_end .eq. jde) then<a name='979'>
  j_end = j_end-1<a name='980'>
endif<a name='981'>
<font color=#447700>! recompute : j_end<a name='982'></font>
if (i_end .eq. ide) then<a name='983'>
  i_end = i_end-1<a name='984'>
endif<a name='985'>
<font color=#447700>! recompute : i_end<a name='986'></font>
i_start_spc = i_start<a name='987'>
<font color=#447700>! recompute : i_start_spc<a name='988'></font>
i_end_spc = i_end<a name='989'>
<font color=#447700>! recompute : i_end_spc<a name='990'></font>
j_start_spc = j_start<a name='991'>
<font color=#447700>! recompute : j_start_spc<a name='992'></font>
j_end_spc = j_end<a name='993'>
<font color=#447700>! recompute : j_end_spc<a name='994'></font>
k_start_spc = k_start<a name='995'>
<font color=#447700>! recompute : k_start_spc<a name='996'></font>
k_end_spc = k_end<a name='997'>
<font color=#447700>! recompute : k_end_spc<a name='998'></font>
if (config_flags%nested .or. config_flags%specified) then<a name='999'>
  i_start = max(its,ids+spec_zone)<a name='1000'>
  i_end = min(ite,ide-spec_zone-1)<a name='1001'>
  j_start = max(jts,jds+spec_zone)<a name='1002'>
  j_end = min(jte,jde-spec_zone-1)<a name='1003'>
  k_start = kts<a name='1004'>
  k_end = min(kte,kde-1)<a name='1005'>
endif<a name='1006'>
<font color=#447700>! recompute : i_end,i_start,j_end,j_start,k_end,k_start<a name='1007'></font>
if ( .not. leapfrog) then<a name='1008'>
  if (rk_step .eq. 1) then<a name='1009'>
    do im = scs, sce<a name='1010'>
      do j = jts, min(jte,jde-1)<a name='1011'>
        do k = kts, min(kte,kde-1)<a name='1012'>
          do i = its, min(ite,ide-1)<a name='1013'>
            tendency(i,k,j) = 0.<a name='1014'>
          end do<a name='1015'>
        end do<a name='1016'>
      end do<a name='1017'>
      do j = j_start, j_end<a name='1018'>
        do k = k_start, k_end<a name='1019'>
          do i = i_start, i_end<a name='1020'>
            tendency(i,k,j) = advect_tend(i,k,j)*msft(i,j)<a name='1021'>
          end do<a name='1022'>
        end do<a name='1023'>
      end do<a name='1024'>
<font color=#447700>! recompute : tendency<a name='1025'></font>
      do j = j_start_spc, j_end_spc<a name='1026'>
        do k = k_start_spc, k_end_spc<a name='1027'>
          do i = i_start_spc, i_end_spc<a name='1028'>
            tendency(i,k,j) = tendency(i,k,j)+sc_tend(i,k,j,im)<a name='1029'>
          end do<a name='1030'>
        end do<a name='1031'>
      end do<a name='1032'>
<font color=#447700>! recompute : tendency<a name='1033'></font>
      do j = jts, min(jte,jde-1)<a name='1034'>
        do i = its, min(ite,ide-1)<a name='1035'>
          muold(i) = mu_old(i,j)+mu_base(i,j)<a name='1036'>
          r_munew(i) = 1./(mu_new(i,j)+mu_base(i,j))<a name='1037'>
        end do<a name='1038'>
<font color=#447700>! recompute : muold,r_munew<a name='1039'></font>
        do k = kts, min(kte,kde-1)<a name='1040'>
          do i = its, min(ite,ide-1)<a name='1041'>
            scalar_1(i,k,j,im) = scalar_2(i,k,j,im)<a name='1042'>
<font color=#447700>! recompute : scalar_1<a name='1043'></font>
            a_muold(i) = a_muold(i)+a_scalar_2(i,k,j,im)*scalar_1(i,k,j,im)*r_munew(i)<a name='1044'>
            a_r_munew(i) = a_r_munew(i)+a_scalar_2(i,k,j,im)*(muold(i)*scalar_1(i,k,j,im)+dt*tendency(i,k,j))<a name='1045'>
            a_scalar_1(i,k,j,im) = a_scalar_1(i,k,j,im)+a_scalar_2(i,k,j,im)*muold(i)*r_munew(i)<a name='1046'>
            a_tendency(i,k,j) = a_tendency(i,k,j)+a_scalar_2(i,k,j,im)*dt*r_munew(i)<a name='1047'>
            a_scalar_2(i,k,j,im) = 0.<a name='1048'>
            a_scalar_2(i,k,j,im) = a_scalar_2(i,k,j,im)+a_scalar_1(i,k,j,im)<a name='1049'>
            a_scalar_1(i,k,j,im) = 0.<a name='1050'>
          end do<a name='1051'>
        end do<a name='1052'>
        do i = its, min(ite,ide-1)<a name='1053'>
          a_mu_new(i,j) = a_mu_new(i,j)-a_r_munew(i)/((mu_new(i,j)+mu_base(i,j))*(mu_new(i,j)+mu_base(i,j)))<a name='1054'>
          a_r_munew(i) = 0.<a name='1055'>
          a_mu_old(i,j) = a_mu_old(i,j)+a_muold(i)<a name='1056'>
          a_muold(i) = 0.<a name='1057'>
        end do<a name='1058'>
      end do<a name='1059'>
      do j = j_start_spc, j_end_spc<a name='1060'>
        do k = k_start_spc, k_end_spc<a name='1061'>
          do i = i_start_spc, i_end_spc<a name='1062'>
            a_sc_tend(i,k,j,im) = a_sc_tend(i,k,j,im)+a_tendency(i,k,j)<a name='1063'>
          end do<a name='1064'>
        end do<a name='1065'>
      end do<a name='1066'>
      do j = j_start, j_end<a name='1067'>
        do k = k_start, k_end<a name='1068'>
          do i = i_start, i_end<a name='1069'>
            a_advect_tend(i,k,j) = a_advect_tend(i,k,j)+a_tendency(i,k,j)*msft(i,j)<a name='1070'>
            a_tendency(i,k,j) = 0.<a name='1071'>
          end do<a name='1072'>
        end do<a name='1073'>
      end do<a name='1074'>
      do j = jts, min(jte,jde-1)<a name='1075'>
        do k = kts, min(kte,kde-1)<a name='1076'>
          do i = its, min(ite,ide-1)<a name='1077'>
            a_tendency(i,k,j) = 0.<a name='1078'>
          end do<a name='1079'>
        end do<a name='1080'>
      end do<a name='1081'>
    end do<a name='1082'>
  else<a name='1083'>
    do im = scs, sce<a name='1084'>
      do j = jts, min(jte,jde-1)<a name='1085'>
        do k = kts, min(kte,kde-1)<a name='1086'>
          do i = its, min(ite,ide-1)<a name='1087'>
            tendency(i,k,j) = 0.<a name='1088'>
          end do<a name='1089'>
        end do<a name='1090'>
      end do<a name='1091'>
      do j = j_start, j_end<a name='1092'>
        do k = k_start, k_end<a name='1093'>
          do i = i_start, i_end<a name='1094'>
            tendency(i,k,j) = advect_tend(i,k,j)*msft(i,j)<a name='1095'>
          end do<a name='1096'>
        end do<a name='1097'>
      end do<a name='1098'>
<font color=#447700>! recompute : tendency<a name='1099'></font>
      do j = j_start_spc, j_end_spc<a name='1100'>
        do k = k_start_spc, k_end_spc<a name='1101'>
          do i = i_start_spc, i_end_spc<a name='1102'>
            tendency(i,k,j) = tendency(i,k,j)+sc_tend(i,k,j,im)<a name='1103'>
          end do<a name='1104'>
        end do<a name='1105'>
      end do<a name='1106'>
<font color=#447700>! recompute : tendency<a name='1107'></font>
      do j = jts, min(jte,jde-1)<a name='1108'>
        do i = its, min(ite,ide-1)<a name='1109'>
          muold(i) = mu_old(i,j)+mu_base(i,j)<a name='1110'>
          r_munew(i) = 1./(mu_new(i,j)+mu_base(i,j))<a name='1111'>
        end do<a name='1112'>
<font color=#447700>! recompute : muold,r_munew<a name='1113'></font>
        do k = kts, min(kte,kde-1)<a name='1114'>
          do i = its, min(ite,ide-1)<a name='1115'>
            a_muold(i) = a_muold(i)+a_scalar_2(i,k,j,im)*scalar_1(i,k,j,im)*r_munew(i)<a name='1116'>
            a_r_munew(i) = a_r_munew(i)+a_scalar_2(i,k,j,im)*(muold(i)*scalar_1(i,k,j,im)+dt*tendency(i,k,j))<a name='1117'>
            a_scalar_1(i,k,j,im) = a_scalar_1(i,k,j,im)+a_scalar_2(i,k,j,im)*muold(i)*r_munew(i)<a name='1118'>
            a_tendency(i,k,j) = a_tendency(i,k,j)+a_scalar_2(i,k,j,im)*dt*r_munew(i)<a name='1119'>
            a_scalar_2(i,k,j,im) = 0.<a name='1120'>
          end do<a name='1121'>
        end do<a name='1122'>
        do i = its, min(ite,ide-1)<a name='1123'>
          a_mu_new(i,j) = a_mu_new(i,j)-a_r_munew(i)/((mu_new(i,j)+mu_base(i,j))*(mu_new(i,j)+mu_base(i,j)))<a name='1124'>
          a_r_munew(i) = 0.<a name='1125'>
          a_mu_old(i,j) = a_mu_old(i,j)+a_muold(i)<a name='1126'>
          a_muold(i) = 0.<a name='1127'>
        end do<a name='1128'>
      end do<a name='1129'>
      do j = j_start_spc, j_end_spc<a name='1130'>
        do k = k_start_spc, k_end_spc<a name='1131'>
          do i = i_start_spc, i_end_spc<a name='1132'>
            a_sc_tend(i,k,j,im) = a_sc_tend(i,k,j,im)+a_tendency(i,k,j)<a name='1133'>
          end do<a name='1134'>
        end do<a name='1135'>
      end do<a name='1136'>
      do j = j_start, j_end<a name='1137'>
        do k = k_start, k_end<a name='1138'>
          do i = i_start, i_end<a name='1139'>
            a_advect_tend(i,k,j) = a_advect_tend(i,k,j)+a_tendency(i,k,j)*msft(i,j)<a name='1140'>
            a_tendency(i,k,j) = 0.<a name='1141'>
          end do<a name='1142'>
        end do<a name='1143'>
      end do<a name='1144'>
      do j = jts, min(jte,jde-1)<a name='1145'>
        do k = kts, min(kte,kde-1)<a name='1146'>
          do i = its, min(ite,ide-1)<a name='1147'>
            a_tendency(i,k,j) = 0.<a name='1148'>
          end do<a name='1149'>
        end do<a name='1150'>
      end do<a name='1151'>
    end do<a name='1152'>
  endif<a name='1153'>
else<a name='1154'>
  do im = scs, sce<a name='1155'>
    a_sc_middle = 0.<a name='1156'>
    do j = jts, min(jte,jde-1)<a name='1157'>
      do k = kts, min(kte,kde-1)<a name='1158'>
        do i = its, min(ite,ide-1)<a name='1159'>
          tendency(i,k,j) = 0.<a name='1160'>
        end do<a name='1161'>
      end do<a name='1162'>
    end do<a name='1163'>
    do j = j_start, j_end<a name='1164'>
      do k = k_start, k_end<a name='1165'>
        do i = i_start, i_end<a name='1166'>
          tendency(i,k,j) = advect_tend(i,k,j)<a name='1167'>
        end do<a name='1168'>
      end do<a name='1169'>
    end do<a name='1170'>
<font color=#447700>! recompute : tendency<a name='1171'></font>
    do j = j_start_spc, j_end_spc<a name='1172'>
      do k = k_start_spc, k_end_spc<a name='1173'>
        do i = i_start_spc, i_end_spc<a name='1174'>
          tendency(i,k,j) = tendency(i,k,j)+sc_tend(i,k,j,im)<a name='1175'>
        end do<a name='1176'>
      end do<a name='1177'>
    end do<a name='1178'>
<font color=#447700>! recompute : tendency<a name='1179'></font>
    do j = jts, min(jte,jde-1)<a name='1180'>
      a_sc_middle = 0.<a name='1181'>
      do i = its, min(ite,ide-1)<a name='1182'>
        muold(i) = mu_old(i,j)+mu_base(i,j)<a name='1183'>
        r_munew(i) = 1./(mu_new(i,j)+mu_base(i,j))<a name='1184'>
      end do<a name='1185'>
<font color=#447700>! recompute : muold,r_munew<a name='1186'></font>
      do k = kts, min(kte,kde-1)<a name='1187'>
        a_sc_middle = 0.<a name='1188'>
        do i = its, min(ite,ide-1)<a name='1189'>
          a_sc_middle = 0.<a name='1190'>
          a_sc_middle = a_sc_middle+a_scalar_1(i,k,j,im)*(1+(-2)*epsts)<a name='1191'>
          a_scalar_2(i,k,j,im) = a_scalar_2(i,k,j,im)+a_scalar_1(i,k,j,im)*epsts<a name='1192'>
          a_scalar_1(i,k,j,im) = a_scalar_1(i,k,j,im)*epsts<a name='1193'>
          a_muold(i) = a_muold(i)+a_scalar_2(i,k,j,im)*scalar_1(i,k,j,im)*r_munew(i)<a name='1194'>
          a_r_munew(i) = a_r_munew(i)+a_scalar_2(i,k,j,im)*(muold(i)*scalar_1(i,k,j,im)+2*msft(i,j)**2*dt*tendency(i,k,j))<a name='1195'>
          a_scalar_1(i,k,j,im) = a_scalar_1(i,k,j,im)+a_scalar_2(i,k,j,im)*muold(i)*r_munew(i)<a name='1196'>
          a_tendency(i,k,j) = a_tendency(i,k,j)+2*a_scalar_2(i,k,j,im)*msft(i,j)**2*dt*r_munew(i)<a name='1197'>
          a_scalar_2(i,k,j,im) = 0.<a name='1198'>
          a_scalar_2(i,k,j,im) = a_scalar_2(i,k,j,im)+a_sc_middle<a name='1199'>
          a_sc_middle = 0.<a name='1200'>
        end do<a name='1201'>
      end do<a name='1202'>
      do i = its, min(ite,ide-1)<a name='1203'>
        a_mu_new(i,j) = a_mu_new(i,j)-a_r_munew(i)/((mu_new(i,j)+mu_base(i,j))*(mu_new(i,j)+mu_base(i,j)))<a name='1204'>
        a_r_munew(i) = 0.<a name='1205'>
        a_mu_old(i,j) = a_mu_old(i,j)+a_muold(i)<a name='1206'>
        a_muold(i) = 0.<a name='1207'>
      end do<a name='1208'>
    end do<a name='1209'>
    do j = j_start_spc, j_end_spc<a name='1210'>
      do k = k_start_spc, k_end_spc<a name='1211'>
        do i = i_start_spc, i_end_spc<a name='1212'>
          a_sc_tend(i,k,j,im) = a_sc_tend(i,k,j,im)+a_tendency(i,k,j)<a name='1213'>
        end do<a name='1214'>
      end do<a name='1215'>
    end do<a name='1216'>
    do j = j_start, j_end<a name='1217'>
      do k = k_start, k_end<a name='1218'>
        do i = i_start, i_end<a name='1219'>
          a_advect_tend(i,k,j) = a_advect_tend(i,k,j)+a_tendency(i,k,j)<a name='1220'>
          a_tendency(i,k,j) = 0.<a name='1221'>
        end do<a name='1222'>
      end do<a name='1223'>
    end do<a name='1224'>
    do j = jts, min(jte,jde-1)<a name='1225'>
      do k = kts, min(kte,kde-1)<a name='1226'>
        do i = its, min(ite,ide-1)<a name='1227'>
          a_tendency(i,k,j) = 0.<a name='1228'>
        end do<a name='1229'>
      end do<a name='1230'>
    end do<a name='1231'>
  end do<a name='1232'>
endif<a name='1233'>
<a name='1234'>
  call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_UPDATE_SCALAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_80">("a_rk_update_scalar")<a name='1235'>
<a name='1236'>
end subroutine a_rk_update_scalar<a name='1237'>
<a name='1238'>
<a name='1239'>
end module     a_module_em<a name='1240'>
<a name='1241'>
<a name='1242'>
</pre></body></html>