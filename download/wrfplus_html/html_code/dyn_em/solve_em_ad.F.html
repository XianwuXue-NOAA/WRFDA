<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>! TBH:  Use this to turn off halo tests.  <a name='2'></font>
#define NO_HALO_FIX<a name='3'>
<a name='4'>
#define FAST_CPY<a name='5'>
<font color=#447700>!#define BENCH<a name='6'></font>
<font color=#447700>!                           DISCLAIMER<a name='7'></font>
<font color=#447700>!<a name='8'></font>
<font color=#447700>!   This file was generated by TAF version 1.7.18<a name='9'></font>
<font color=#447700>!***********************************************************<a name='10'></font>
<font color=#447700>!***********************************************************<a name='11'></font>
<a name='12'>
<font color=#447700>!  revised by Qingnong Xiao and Zaizhong Ma in June 08,2005<a name='13'></font>
<a name='14'>
<font color=#447700>!***********************************************************<a name='15'></font>
<font color=#447700>!***********************************************************<a name='16'></font>
<font color=#447700>!<a name='17'></font>
<font color=#447700>!   FASTOPT DISCLAIMS  ALL  WARRANTIES,  EXPRESS  OR  IMPLIED,<a name='18'></font>
<font color=#447700>!   INCLUDING (WITHOUT LIMITATION) ALL IMPLIED  WARRANTIES  OF<a name='19'></font>
<font color=#447700>!   MERCHANTABILITY  OR FITNESS FOR A PARTICULAR PURPOSE, WITH<a name='20'></font>
<font color=#447700>!   RESPECT TO THE SOFTWARE AND USER PROGRAMS.   IN  NO  EVENT<a name='21'></font>
<font color=#447700>!   SHALL  FASTOPT BE LIABLE FOR ANY LOST OR ANTICIPATED PROF-<a name='22'></font>
<font color=#447700>!   ITS, OR ANY INDIRECT, INCIDENTAL, EXEMPLARY,  SPECIAL,  OR<a name='23'></font>
<font color=#447700>!   CONSEQUENTIAL  DAMAGES, WHETHER OR NOT FASTOPT WAS ADVISED<a name='24'></font>
<font color=#447700>!   OF THE POSSIBILITY OF SUCH DAMAGES.<a name='25'></font>
<font color=#447700>!<a name='26'></font>
<font color=#447700>!                           Haftungsbeschraenkung<a name='27'></font>
<font color=#447700>!   FastOpt gibt ausdruecklich keine Gewaehr, explizit oder indirekt,<a name='28'></font>
<font color=#447700>!   bezueglich der Brauchbarkeit  der Software  fuer einen bestimmten<a name='29'></font>
<font color=#447700>!   Zweck.   Unter  keinen  Umstaenden   ist  FastOpt   haftbar  fuer<a name='30'></font>
<font color=#447700>!   irgendeinen Verlust oder nicht eintretenden erwarteten Gewinn und<a name='31'></font>
<font color=#447700>!   allen indirekten,  zufaelligen,  exemplarischen  oder  speziellen<a name='32'></font>
<font color=#447700>!   Schaeden  oder  Folgeschaeden  unabhaengig  von einer eventuellen<a name='33'></font>
<font color=#447700>!   Mitteilung darueber an FastOpt.<a name='34'></font>
<font color=#447700>!<a name='35'></font>
<font color=#447700>!******************************************************************<a name='36'></font>
<font color=#447700>!******************************************************************<a name='37'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='38'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='39'></font>
<font color=#447700>!******************************************************************<a name='40'></font>
<font color=#447700>!******************************************************************<a name='41'></font>
<font color=#447700>!WRF:MEDIATION_LAYER:SOLVER<a name='42'></font>
<a name='43'>
<A NAME='SOLVE_EM_AD'><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='44'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>solve_em_ad</font> ( grid , config_flags , &amp; <A href='../../call_to/SOLVE_EM_AD.html' TARGET='index'>2</A>,<A href='../../call_from/SOLVE_EM_AD.html' TARGET='index'>841</A><a name='45'>
<font color=#447700>!<a name='46'></font>
#include "<A href='../../html_code/include/em_dummy_args.inc.html'>em_dummy_args.inc</A>"<A NAME="em_dummy_args.inc_1"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='47'>
<font color=#447700>!<a name='48'></font>
                 )<a name='49'>
<a name='50'>
<font color=#447700>! Driver layer modules<a name='51'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_15"><a name='52'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_28"><a name='53'>
   USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_3"><a name='54'>
   USE <A href='../../html_code/frame/module_machine.F.html#MODULE_MACHINE'>module_machine</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MACHINE_3"><a name='55'>
   USE <A href='../../html_code/frame/module_tiles.F.html#MODULE_TILES'>module_tiles</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TILES_3"><a name='56'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_12"><a name='57'>
<font color=#447700>! Mediation layer modules<a name='58'></font>
<font color=#447700>! Model layer modules<a name='59'></font>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_24"><a name='60'>
   USE <A href='../../html_code/dyn_em/module_small_step_em.F.html#MODULE_SMALL_STEP_EM'>module_small_step_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SMALL_STEP_EM_4"><a name='61'>
   USE <A href='../../html_code/dyn_em/module_em.F.html#MODULE_EM'>module_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_EM_4"><a name='62'>
   USE <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#MODULE_BIG_STEP_UTILITIES_EM'>module_big_step_utilities_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BIG_STEP_UTILITIES_EM_12"><a name='63'>
   USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_21"><a name='64'>
   USE <A href='../../html_code/dyn_em/module_bc_em.F.html#MODULE_BC_EM'>module_bc_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_EM_4"><a name='65'>
   USE <A href='../../html_code/dyn_em/module_solvedebug_em.F.html#MODULE_SOLVEDEBUG_EM'>module_solvedebug_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SOLVEDEBUG_EM_2"><a name='66'>
   USE <A href='../../html_code/phys/module_physics_addtendc.F.html#MODULE_PHYSICS_ADDTENDC'>module_physics_addtendc</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_PHYSICS_ADDTENDC_2"><a name='67'>
   USE <A href='../../html_code/dyn_em/module_diffusion_em.F.html#MODULE_DIFFUSION_EM'>module_diffusion_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DIFFUSION_EM_4"><a name='68'>
<font color=#447700>! Registry generated module<a name='69'></font>
   USE module_state_description<a name='70'>
   USE <A href='../../html_code/phys/module_radiation_driver.F.html#MODULE_RADIATION_DRIVER'>module_radiation_driver</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RADIATION_DRIVER_2"><a name='71'>
   USE <A href='../../html_code/phys/module_surface_driver.F.html#MODULE_SURFACE_DRIVER'>module_surface_driver</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SURFACE_DRIVER_2"><a name='72'>
   USE <A href='../../html_code/phys/module_cumulus_driver.F.html#MODULE_CUMULUS_DRIVER'>module_cumulus_driver</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CUMULUS_DRIVER_2"><a name='73'>
   USE <A href='../../html_code/phys/module_cu_du.F.html#MODULE_CU_DU'>module_cu_du</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CU_DU_3"> , only : DUCU_B, DUCU  <font color=#447700>!Xiaoyan Zhang 12 July, 2007<a name='74'></font>
   USE <A href='../../html_code/phys/module_microphysics_driver.F.html#MODULE_MICROPHYSICS_DRIVER'>module_microphysics_driver</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MICROPHYSICS_DRIVER_2"><a name='75'>
   USE <A href='../../html_code/phys/module_pbl_driver.F.html#MODULE_PBL_DRIVER'>module_pbl_driver</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_PBL_DRIVER_2"><a name='76'>
   USE <A href='../../html_code/phys/module_mp_nconvp.F.html#MODULE_MP_NCONVP'>module_mp_nconvp</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_NCONVP_3">   <font color=#447700>!Xiaoyan Zhang<a name='77'></font>
#ifdef WRF_CHEM<a name='78'>
   USE module_input_chem_data<a name='79'>
#endif<a name='80'>
<a name='81'>
   USE <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_MODULE_SMALL_STEP_EM'>a_module_small_step_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MODULE_SMALL_STEP_EM_2"><a name='82'>
   USE <A href='../../html_code/dyn_em/module_em_ad.F.html#A_MODULE_EM'>a_module_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MODULE_EM_2"><a name='83'>
   USE <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_MODULE_BIG_STEP_UTILITIES_EM'>a_module_big_step_utilities_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MODULE_BIG_STEP_UTILITIES_EM_4"><a name='84'>
   USE <A href='../../html_code/dyn_em/module_bc_ad.F.html#A_MODULE_BC'>a_module_bc</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MODULE_BC_4"><a name='85'>
   USE <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_MODULE_BC_EM'>a_module_bc_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MODULE_BC_EM_2"><a name='86'>
   USE <A href='../../html_code/dyn_em/module_diffusion_em_ad.F.html#A_MODULE_DIFFUSION_EM'>a_module_diffusion_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MODULE_DIFFUSION_EM_2"><a name='87'>
<a name='88'>
   USE <A href='../../html_code/dyn_em/module_4dvaropt.F.html#MODULE_4DVAROPT'>module_4dvaropt</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_4DVAROPT_3"><a name='89'>
<a name='90'>
   USE <A href='../../html_code/frame/module_trace.F.html#MODULE_TRACE'>module_trace</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TRACE_13">, only : trace_entry, trace_exit<a name='91'>
<a name='92'>
   IMPLICIT NONE<a name='93'>
<a name='94'>
   <font color=#447700>!  Input data.<a name='95'></font>
<a name='96'>
   TYPE(domain) , TARGET          :: grid<a name='97'>
<a name='98'>
   <font color=#447700>!  Definitions of dummy arguments to solve<a name='99'></font>
#include &lt;<A href='../../html_code/include/em_dummy_decl.inc.html'>em_dummy_decl.inc</A>&gt;<A NAME="em_dummy_decl.inc_2"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='100'>
<a name='101'>
   <font color=#447700>!  WRF state bcs<a name='102'></font>
   TYPE (grid_config_rec_type) , INTENT(IN)          :: config_flags<a name='103'>
<a name='104'>
   <font color=#447700>! WRF state data<a name='105'></font>
<a name='106'>
<font color=#447700>!#include "../phys/physics_drive.int"<a name='107'></font>
<a name='108'>
   <font color=#447700>! Local data<a name='109'></font>
<a name='110'>
   INTEGER                         :: k_start , k_end, its, ite, jts, jte<a name='111'>
   INTEGER                         :: ids , ide , jds , jde , kds , kde , &amp;<a name='112'>
                                      ims , ime , jms , jme , kms , kme , &amp;<a name='113'>
                                      ips , ipe , jps , jpe , kps , kpe<a name='114'>
   INTEGER                         :: ij , iteration<a name='115'>
   INTEGER                         :: im , num_3d_m , ic , num_3d_c<a name='116'>
   INTEGER                         :: loop<a name='117'>
   INTEGER                         :: ijds, ijde<a name='118'>
   INTEGER                         :: itmpstep<a name='119'>
   INTEGER                         :: sz<a name='120'>
#ifndef NO_HALO_FIX<a name='121'>
   INTEGER                         :: filecount<a name='122'>
<font color=#447700>!   INTEGER,PARAMETER               :: min_filecount=0<a name='123'></font>
<font color=#447700>!   INTEGER,PARAMETER               :: max_filecount=1026<a name='124'></font>
   INTEGER,PARAMETER               :: min_filecount=19000<a name='125'>
   INTEGER,PARAMETER               :: max_filecount=99999<a name='126'>
   CHARACTER*256     :: msg<a name='127'>
#endif<a name='128'>
<a name='129'>
<font color=#447700>! storage for tendencies and decoupled state (generated from Registry)<a name='130'></font>
#include &lt;<A href='../../html_code/include/em_i1_decl.inc.html'>em_i1_decl.inc</A>&gt;<A NAME="em_i1_decl.inc_3"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='131'>
<a name='132'>
#ifdef WRFVAR<a name='133'>
<a name='134'>
   INTEGER :: rc <a name='135'>
   INTEGER :: number_of_small_timesteps, rk_step<a name='136'>
   INTEGER :: klevel,ijm,ijp,i,j,k,size1,size2    <font color=#447700>! for prints/plots only<a name='137'></font>
   INTEGER :: idum1, idum2, dynamics_option<a name='138'>
<a name='139'>
   INTEGER :: rk_order, iwmax, jwmax, kwmax<a name='140'>
   REAL :: dt_rk, dts_rk, dtm, wmax<a name='141'>
   LOGICAL :: leapfrog<a name='142'>
   INTEGER :: l,kte,kk<a name='143'>
integer myproc<a name='144'>
   INTEGER :: n3d_elem, n2d_elem, nbd_elem<a name='145'>
<a name='146'>
real a_z_at_wh(1+grid%em31-grid%sm31,1+grid%em32-grid%sm32,1+grid%em33-grid%sm33)<a name='147'>
real ah(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='148'>
real alh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='149'>
real ali(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='150'>
real alj(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='151'>
real alphah(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='152'>
real dnwh(grid%sm32:grid%em32)<a name='153'>
real dt_rkh<a name='154'>
real dts_rkh<a name='155'>
real gammah(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='156'>
integer iteration1<a name='157'>
real moist_1h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)<a name='158'>
real moist_1i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)<a name='159'>
real moist_2h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)<a name='160'>
real moist_2i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)<a name='161'>
real moist_tendh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)<a name='162'>
real moist_tendi(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)<a name='163'>
real mu_1h(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='164'>
real mu_1i(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='165'>
real mu_2h(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='166'>
real mu_2i(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='167'>
real mu_2j(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='168'>
integer number_of_small_timestepsh<a name='169'>
real ph(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='170'>
real ph_1h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='171'>
real ph_1i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='172'>
real ph_2h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='173'>
real ph_2i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='174'>
real ph_2j(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='175'>
real ph_tendfh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='176'>
real ph_tendfi(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='177'>
real pi(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='178'>
real pj(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='179'>
real pm1h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='180'>
real pm1i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='181'>
integer rk_step1<a name='182'>
real ru_mh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='183'>
real ru_tendfh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='184'>
real ru_tendfi(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='185'>
real rv_mh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='186'>
real rv_tendfh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='187'>
real rv_tendfi(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='188'>
real rw_tendfh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='189'>
real rw_tendfi(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='190'>
real t_1h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='191'>
real t_1i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='192'>
real t_2h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='193'>
real t_2i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='194'>
real t_2j(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='195'>
real t_tendfh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='196'>
real t_tendfi(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='197'>
real u_1h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='198'>
real u_1i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='199'>
real u_2h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='200'>
real u_2i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='201'>
real v_1h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='202'>
real v_1i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='203'>
real v_2h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='204'>
real v_2i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='205'>
real w_1h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='206'>
real w_1i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='207'>
real w_2h(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='208'>
real w_2i(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='209'>
real w_2j(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='210'>
real ww_mh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='211'>
real wwh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='212'>
real xkmhdh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='213'>
real xkmhdi(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='214'>
<a name='215'>
real a_pi_phyh(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='216'>
<a name='217'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)                  :: a_bn2h<a name='218'>
<a name='219'>
real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)           :: a_rqc_bth<a name='220'>
real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)           :: a_rqr_bth<a name='221'>
real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)           :: a_rqi_bth<a name='222'>
real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)           :: a_rqs_bth<a name='223'>
real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)           :: a_rqg_bth<a name='224'>
<a name='225'>
<font color=#447700>!JM real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)        :: a_moist_tend<a name='226'></font>
<a name='227'>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='228'></font>
<font color=#447700>!defined by Zaizhong Ma for saving the basic states<a name='229'></font>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='230'></font>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='231'></font>
<font color=#447700>!*********************************************************************<a name='232'></font>
real u_1o(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='233'>
real u_2o(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='234'>
real v_1o(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='235'>
real v_2o(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='236'>
real w_1o(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='237'>
real w_2o(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='238'>
real t_1o(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='239'>
real t_2o(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='240'>
real mu_1o(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='241'>
real mu_2o(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='242'>
real po(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='243'>
<a name='244'>
<a name='245'>
real alp(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='246'>
real pp(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='247'>
real ph_2p(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='248'>
real t_2p(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='249'>
real mu_2p(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='250'>
<a name='251'>
real alq(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='252'>
real mu_2q(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='253'>
real pq(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='254'>
real ph_2q(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='255'>
<a name='256'>
real wwr(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='257'>
real u_2r(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='258'>
real v_2r(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='259'>
<a name='260'>
real w_2s(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='261'>
real wws(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='262'>
real u_2s(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='263'>
real v_2s(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='264'>
real t_2s(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='265'>
real mu_2s(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='266'>
real ph_2s(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='267'>
real as(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='268'>
real t_2saves(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='269'>
<a name='270'>
real mudf_ma(grid%sm31:grid%em31,grid%sm33:grid%em33)<a name='271'>
<font color=#447700>!*********************************************************************<a name='272'></font>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='273'></font>
real ww_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='274'>
real xkmhd_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='275'>
real ru_tendf_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='276'>
real rv_tendf_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='277'>
real rw_tendf_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='278'>
real t_tendf_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='279'>
real ph_tendf_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='280'>
real pm1_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='281'>
real moist_tend_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)<a name='282'>
real dnw_keep3(grid%sm32:grid%em32)<a name='283'>
<a name='284'>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='285'></font>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='286'></font>
real ww_m_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='287'>
real ru_m_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='288'>
real rv_m_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='289'>
real a_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='290'>
real alpha_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='291'>
real gamma_keep3(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='292'>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='293'></font>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='294'></font>
<a name='295'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: u_1_keep3<a name='296'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: u_2_keep3<a name='297'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: v_1_keep3<a name='298'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: v_2_keep3<a name='299'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: w_1_keep3<a name='300'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: w_2_keep3<a name='301'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: t_1_keep3<a name='302'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: t_2_keep3<a name='303'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: ph_1_keep3<a name='304'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: ph_2_keep3<a name='305'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33) :: mu_1_keep3<a name='306'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33) :: mu_2_keep3<a name='307'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: p_keep3<a name='308'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: al_keep3<a name='309'>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='310'></font>
<a name='311'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: u_1_keep4<a name='312'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: u_2_keep4<a name='313'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: v_1_keep4<a name='314'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: v_2_keep4<a name='315'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: w_1_keep4<a name='316'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: w_2_keep4<a name='317'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: t_1_keep4<a name='318'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: t_2_keep4<a name='319'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: ph_1_keep4<a name='320'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: ph_2_keep4<a name='321'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33) :: mu_1_keep4<a name='322'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33) :: mu_2_keep4<a name='323'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist) :: moist_1_keep4<a name='324'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist) :: moist_2_keep4<a name='325'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: p_keep4<a name='326'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33) :: al_keep4<a name='327'>
<font color=#447700>!----------------------------------------------------------------------------------------<a name='328'></font>
integer :: iy<a name='329'>
<font color=#447700>! TBH:  Buffer IDs for store/restore<a name='330'></font>
INTEGER, PARAMETER :: BUF_RK_LOOR = 1<a name='331'>
INTEGER, PARAMETER :: BUF_SMALL_STEP = 2<a name='332'>
INTEGER, PARAMETER :: BUF_RKTEND_THRU_SS = 3<a name='333'>
INTEGER, PARAMETER :: BUF_RKTEND = 4<a name='334'>
INTEGER, PARAMETER :: BUF_RK_STEP_PREP = 5<a name='335'>
<a name='336'>
real ru_mz(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='337'>
real rv_mz(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='338'>
real ru_tendfz(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)<a name='339'>
real moist_tendz(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist)<a name='340'>
<font color=#447700>!----------------------------------------<a name='341'></font>
<a name='342'>
<font color=#447700>!Xiaoyan Zhang add<a name='343'></font>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: a_h_diabatic<a name='344'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: a_rainnc<a name='345'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: a_rainncv<a name='346'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: a_rainc<a name='347'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: a_raincv<a name='348'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: a_rqvcuten<a name='349'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: a_rthcuten<a name='350'>
<font color=#447700>!<a name='351'></font>
<font color=#447700>!XIAO<a name='352'></font>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: rho_save,u_phy_save,v_phy_save,rthcuten_save,rqvcuten_save,th_phy_save,t_phy_save,p_phy_save,pi_phy_save,w_2_save,z_save,dz8w_save<a name='353'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist) :: moist_2_save<a name='354'>
real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: raincv_save<a name='355'>
<a name='356'>
#ifdef DEREF_KLUDGE<a name='357'>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='358'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='359'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='360'>
#endif<a name='361'>
<a name='362'>
#include &lt;<A href='../../html_code/include/bench_solve_em_a_def.h.html'>bench_solve_em_a_def.h</A>&gt;<A NAME="bench_solve_em_a_def.h_4"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='363'>
<a name='364'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_5"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='365'>
<a name='366'>
#define COPY_IN<a name='367'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_6"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='368'>
#ifdef DM_PARALLEL<a name='369'>
#    define REGISTER_I1<a name='370'>
#      include &lt;<A href='../../html_code/include/em_data_calls.inc.html'>em_data_calls.inc</A>&gt;<A NAME="em_data_calls.inc_7"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='371'>
#endif<a name='372'>
<a name='373'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='374'></font>
<font color=#447700>!&lt;pre&gt;<a name='375'></font>
<font color=#447700>! solve_em is the main driver for advancing a grid a single timestep.<a name='376'></font>
<font color=#447700>! It is a mediation-layer routine -&gt; DM and SM calls are made where <a name='377'></font>
<font color=#447700>! needed for parallel processing.  <a name='378'></font>
<font color=#447700>!<a name='379'></font>
<font color=#447700>! solve_em can integrate the equations using 3 time-integration methods<a name='380'></font>
<font color=#447700>!      <a name='381'></font>
<font color=#447700>!    - 3rd order Runge-Kutta time integration (recommended)<a name='382'></font>
<font color=#447700>!      <a name='383'></font>
<font color=#447700>!    - 2nd order Runge-Kutta time integration<a name='384'></font>
<font color=#447700>!      <a name='385'></font>
<font color=#447700>!    - Leapfrog time integration<a name='386'></font>
<font color=#447700>!      (note: the leapfrog scheme is not correctly implemented<a name='387'></font>
<font color=#447700>!      for most of the physics)<a name='388'></font>
<font color=#447700>!<a name='389'></font>
<font color=#447700>! The main sections of solve_em are<a name='390'></font>
<font color=#447700>!     <a name='391'></font>
<font color=#447700>! (1) Runge-Kutta (RK) loop<a name='392'></font>
<font color=#447700>!     <a name='393'></font>
<font color=#447700>! (2) Non-timesplit physics (i.e., tendencies computed for updating<a name='394'></font>
<font color=#447700>!     model state variables during the first RK sub-step (loop)<a name='395'></font>
<font color=#447700>!     <a name='396'></font>
<font color=#447700>! (3) Small (acoustic, sound) timestep loop - within the RK sub-steps<a name='397'></font>
<font color=#447700>!     <a name='398'></font>
<font color=#447700>! (4) Scalar advance for moist and chem scalar variables (and TKE)<a name='399'></font>
<font color=#447700>!     within the RK sub-steps.<a name='400'></font>
<font color=#447700>!     <a name='401'></font>
<font color=#447700>! (5) time-split physics (after the RK step), currently this includes<a name='402'></font>
<font color=#447700>!     only microphyics<a name='403'></font>
<font color=#447700>!<a name='404'></font>
<font color=#447700>! A more detailed description of these sections follows.<a name='405'></font>
<font color=#447700>!&lt;/pre&gt;<a name='406'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='407'></font>
<a name='408'>
#include &lt;<A href='../../html_code/include/bench_solve_em_a_init.h.html'>bench_solve_em_a_init.h</A>&gt;<A NAME="bench_solve_em_a_init.h_8"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='409'>
<a name='410'>
   if(grid%trace_use) call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_104">("solve_em_ad")<a name='411'>
<a name='412'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_10"> ( 10 , 'DEBUG:  begin solve_em_ad()' )<a name='413'>
CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#MODULE_4DVAROPT_START'>module_4dvaropt_start</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_4DVAROPT_START_1"><a name='414'>
<a name='415'>
call <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_5">( grid,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe )<a name='416'>
<a name='417'>
BENCH_START(exch1)<a name='418'>
#ifdef DM_PARALLEL<a name='419'>
lineno = __LINE__<a name='420'>
#   include "<A href='../../html_code/include/HALO_0376.inc.html'>HALO_0376.inc</A>"<A NAME="HALO_0376.inc_9"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='421'>
<a name='422'>
<a name='423'>
<a name='424'>
<a name='425'>
<a name='426'>
<a name='427'>
<a name='428'>
<a name='429'>
#endif<a name='430'>
<a name='431'>
  n2d_elem = (ime-ims+1)*(jme-jms+1)<a name='432'>
  n3d_elem = n2d_elem*(kme-kms+1)<a name='433'>
  nbd_elem = max(grid%ed31,grid%ed33)*(grid%ed32-grid%sd32+1)*grid%spec_bdy_width*4<a name='434'>
<a name='435'>
ij = 1<a name='436'>
<a name='437'>
<font color=#447700>!----------------------------------------------<a name='438'></font>
<font color=#447700>! SAVE REQUIRED INPUT VARIABLES<a name='439'></font>
<font color=#447700>!----------------------------------------------<a name='440'></font>
#ifdef DM_PARALLEL<a name='441'>
lineno = __LINE__<a name='442'>
#include "<A href='../../html_code/include/HALO_0394.inc.html'>HALO_0394.inc</A>"<A NAME="HALO_0394.inc_10"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='443'>
#endif<a name='444'>
BENCH_END(exch1)<a name='445'>
<a name='446'>
BENCH_START(comp1)<a name='447'>
<a name='448'>
#ifndef FAST_CPY<a name='449'>
xkmhdi(:,:,:) = xkmhd(:,:,:)<a name='450'>
ww_mh(:,:,:) = ww_m(:,:,:)<a name='451'>
w_2j(:,:,:) = w_2(:,:,:)<a name='452'>
w_1i(:,:,:) = w_1(:,:,:)<a name='453'>
v_2i(:,:,:) = v_2(:,:,:)<a name='454'>
v_1i(:,:,:) = v_1(:,:,:)<a name='455'>
u_2i(:,:,:) = u_2(:,:,:)<a name='456'>
u_1i(:,:,:) = u_1(:,:,:)<a name='457'>
t_tendfi(:,:,:) = t_tendf(:,:,:)<a name='458'>
t_2j(:,:,:) = t_2(:,:,:)<a name='459'>
t_1i(:,:,:) = t_1(:,:,:)<a name='460'>
rw_tendfi(:,:,:) = rw_tendf(:,:,:)<a name='461'>
rv_tendfi(:,:,:) = rv_tendf(:,:,:)<a name='462'>
rv_mh(:,:,:) = rv_m(:,:,:)<a name='463'>
ru_tendfi(:,:,:) = ru_tendf(:,:,:)<a name='464'>
ru_mh(:,:,:) = ru_m(:,:,:)<a name='465'>
pm1i(:,:,:) = pm1(:,:,:)<a name='466'>
ph_tendfi(:,:,:) = ph_tendf(:,:,:)<a name='467'>
ph_2j(:,:,:) = ph_2(:,:,:)<a name='468'>
ph_1i(:,:,:) = ph_1(:,:,:)<a name='469'>
pj(:,:,:) = p(:,:,:)<a name='470'>
mu_2j(:,:) = mu_2(:,:)<a name='471'>
mu_1i(:,:) = mu_1(:,:)<a name='472'>
moist_tendi(:,:,:,:) = moist_tend(:,:,:,:)<a name='473'>
moist_2i(:,:,:,:) = moist_2(:,:,:,:)<a name='474'>
moist_1i(:,:,:,:) = moist_1(:,:,:,:)<a name='475'>
gammah(:,:,:) = gamma(:,:,:)<a name='476'>
alphah(:,:,:) = alpha(:,:,:)<a name='477'>
alj(:,:,:) = al(:,:,:)<a name='478'>
ah(:,:,:) = a(:,:,:)<a name='479'>
#else<a name='480'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_3">( xkmhdi , xkmhd , n3d_elem )<a name='481'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_4">( ww_mh , ww_m , n3d_elem )<a name='482'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_5">( w_2j , w_2 , n3d_elem )<a name='483'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_6">( w_1i , w_1 , n3d_elem )<a name='484'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_7">( v_2i , v_2 , n3d_elem )<a name='485'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_8">( v_1i , v_1 , n3d_elem )<a name='486'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_9">( u_2i , u_2 , n3d_elem )<a name='487'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_10">( u_1i , u_1 , n3d_elem )<a name='488'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_11">( t_tendfi , t_tendf , n3d_elem )<a name='489'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_12">( t_2j , t_2 , n3d_elem )<a name='490'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_13">( t_1i , t_1 , n3d_elem )<a name='491'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_14">( rw_tendfi , rw_tendf , n3d_elem )<a name='492'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_15">( rv_tendfi , rv_tendf , n3d_elem )<a name='493'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_16">( rv_mh , rv_m , n3d_elem )<a name='494'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_17">( ru_tendfi , ru_tendf , n3d_elem )<a name='495'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_18">( ru_mh , ru_m , n3d_elem )<a name='496'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_19">( pm1i , pm1 , n3d_elem )<a name='497'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_20">( ph_tendfi , ph_tendf , n3d_elem )<a name='498'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_21">( ph_2j , ph_2 , n3d_elem )<a name='499'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_22">( ph_1i , ph_1 , n3d_elem )<a name='500'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_23">( pj , p , n3d_elem )<a name='501'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_24">( mu_2j , mu_2 , n2d_elem )<a name='502'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_25">( mu_1i , mu_1 , n2d_elem )<a name='503'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_26">( moist_tendi(ims,kms,jms,2) , moist_tend(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='504'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_27">( moist_2i(ims,kms,jms,2) , moist_2(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='505'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_28">( moist_1i(ims,kms,jms,2) , moist_1(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='506'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_29">( gammah , gamma , n3d_elem )<a name='507'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_30">( alphah , alpha , n3d_elem )<a name='508'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_31">( alj , al , n3d_elem )<a name='509'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_32">( ah , a , n3d_elem )<a name='510'>
#endif<a name='511'>
<a name='512'>
number_of_small_timestepsh = number_of_small_timesteps<a name='513'>
dts_rkh = dts_rk<a name='514'>
dt_rkh = dt_rk<a name='515'>
<a name='516'>
<font color=#447700>!----------------------------------------------<a name='517'></font>
<font color=#447700>! RESET LOCAL ADJOINT VARIABLES<a name='518'></font>
<font color=#447700>!----------------------------------------------<a name='519'></font>
#ifndef FAST_CPY<a name='520'>
a_a(:,:,:) = 0.<a name='521'>
a_advect_tend(:,:,:) = 0.<a name='522'>
a_alpha(:,:,:) = 0.<a name='523'>
a_bn2h(:,:,:) = 0.<a name='524'>
a_c2a(:,:,:) = 0.<a name='525'>
a_cqu(:,:,:) = 0.<a name='526'>
a_cqv(:,:,:) = 0.<a name='527'>
a_cqw(:,:,:) = 0.<a name='528'>
a_gamma(:,:,:) = 0.<a name='529'>
a_moist_tend(:,:,:,:) = 0.<a name='530'>
a_mu_save(:,:) = 0.<a name='531'>
a_mu_tend(:,:) = 0.<a name='532'>
a_muave(:,:) = 0.<a name='533'>
a_mut(:,:) = 0.<a name='534'>
a_muts(:,:) = 0.<a name='535'>
a_muu(:,:) = 0.<a name='536'>
a_muus(:,:) = 0.<a name='537'>
a_muv(:,:) = 0.<a name='538'>
a_muvs(:,:) = 0.<a name='539'>
a_p8w(:,:,:) = 0.<a name='540'>
a_p_phy(:,:,:) = 0.<a name='541'>
a_ph_save(:,:,:) = 0.<a name='542'>
a_ph_tend(:,:,:) = 0.<a name='543'>
a_ph_tendf(:,:,:) = 0.<a name='544'>
a_pi_phyh(:,:,:) = 0.<a name='545'>
a_pm1(:,:,:) = 0.<a name='546'>
a_rqc_bth(:,:,:,:) = 0.<a name='547'>
a_rqg_bth(:,:,:,:) = 0.<a name='548'>
a_rqi_bth(:,:,:,:) = 0.<a name='549'>
a_rqr_bth(:,:,:,:) = 0.<a name='550'>
a_rqs_bth(:,:,:,:) = 0.<a name='551'>
a_ru_m(:,:,:) = 0.<a name='552'>
a_ru_tend(:,:,:) = 0.<a name='553'>
a_ru_tendf(:,:,:) = 0.<a name='554'>
a_rv_m(:,:,:) = 0.<a name='555'>
a_rv_tend(:,:,:) = 0.<a name='556'>
a_rv_tendf(:,:,:) = 0.<a name='557'>
a_rw_tend(:,:,:) = 0.<a name='558'>
a_rw_tendf(:,:,:) = 0.<a name='559'>
a_t8w(:,:,:) = 0.<a name='560'>
a_t_2save(:,:,:) = 0.<a name='561'>
a_t_phy(:,:,:) = 0.<a name='562'>
a_t_save(:,:,:) = 0.<a name='563'>
a_t_tend(:,:,:) = 0.<a name='564'>
a_t_tendf(:,:,:) = 0.<a name='565'>
a_th_phy(:,:,:) = 0.<a name='566'>
a_u_save(:,:,:) = 0.<a name='567'>
a_v_save(:,:,:) = 0.<a name='568'>
a_w_save(:,:,:) = 0.<a name='569'>
a_ww1(:,:,:) = 0.<a name='570'>
a_ww_m(:,:,:) = 0.<a name='571'>
a_z_at_wh(:,:,:) = 0.<a name='572'>
#else<a name='573'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_1">( a_a , n3d_elem )<a name='574'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_2">( a_advect_tend , n3d_elem )<a name='575'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_3">( a_alpha , n3d_elem )<a name='576'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_4">( a_bn2h , n3d_elem )<a name='577'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_5">( a_c2a , n3d_elem )<a name='578'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_6">( a_cqu , n3d_elem )<a name='579'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_7">( a_cqv , n3d_elem )<a name='580'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_8">( a_cqw , n3d_elem )<a name='581'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_9">( a_gamma , n3d_elem )<a name='582'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_10">( a_moist_tend(ims,kms,jms,2) , n3d_elem * ( num_moist - 1 ))<a name='583'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_11">( a_mu_save , n2d_elem )<a name='584'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_12">( a_mu_tend , n2d_elem )<a name='585'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_13">( a_muave , n2d_elem )<a name='586'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_14">( a_mut , n2d_elem )<a name='587'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_15">( a_muts , n2d_elem )<a name='588'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_16">( a_muu , n2d_elem )<a name='589'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_17">( a_muus , n2d_elem )<a name='590'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_18">( a_muv , n2d_elem )<a name='591'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_19">( a_muvs , n2d_elem )<a name='592'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_20">( a_p8w , n3d_elem )<a name='593'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_21">( a_p_phy , n3d_elem )<a name='594'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_22">( a_ph_save , n3d_elem )<a name='595'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_23">( a_ph_tend , n3d_elem )<a name='596'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_24">( a_ph_tendf , n3d_elem )<a name='597'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_25">( a_pi_phyh , n3d_elem )<a name='598'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_26">( a_pm1 , n3d_elem )<a name='599'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_27">( a_rqc_bth , nbd_elem )<a name='600'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_28">( a_rqg_bth , nbd_elem )<a name='601'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_29">( a_rqi_bth , nbd_elem )<a name='602'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_30">( a_rqr_bth , nbd_elem )<a name='603'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_31">( a_rqs_bth , nbd_elem )<a name='604'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_32">( a_ru_m , n3d_elem )<a name='605'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_33">( a_ru_tend , n3d_elem )<a name='606'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_34">( a_ru_tendf , n3d_elem )<a name='607'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_35">( a_rv_m , n3d_elem )<a name='608'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_36">( a_rv_tend , n3d_elem )<a name='609'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_37">( a_rv_tendf , n3d_elem )<a name='610'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_38">( a_rw_tend , n3d_elem )<a name='611'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_39">( a_rw_tendf , n3d_elem )<a name='612'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_40">( a_t8w , n3d_elem )<a name='613'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_41">( a_t_2save , n3d_elem )<a name='614'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_42">( a_t_phy , n3d_elem )<a name='615'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_43">( a_t_save , n3d_elem )<a name='616'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_44">( a_t_tend , n3d_elem )<a name='617'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_45">( a_t_tendf , n3d_elem )<a name='618'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_46">( a_th_phy , n3d_elem )<a name='619'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_47">( a_u_save , n3d_elem )<a name='620'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_48">( a_v_save , n3d_elem )<a name='621'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_49">( a_w_save , n3d_elem )<a name='622'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_50">( a_ww1 , n3d_elem )<a name='623'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_51">( a_ww_m , n3d_elem )<a name='624'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_ZERO_LINT'>fast_zero_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_ZERO_LINT_52">( a_z_at_wh , n3d_elem )<a name='625'>
#endif<a name='626'>
<a name='627'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='628'></font>
#ifndef NO_HALO_FIX<a name='629'>
  filecount = 0<a name='630'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_11"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='631'>
#endif<a name='632'>
<a name='633'>
<font color=#447700>!----------------------------------------------<a name='634'></font>
<font color=#447700>! ROUTINE BODY<a name='635'></font>
<font color=#447700>!----------------------------------------------<a name='636'></font>
cfn = grid%cfn<a name='637'>
<font color=#447700>! recompute : cfn<a name='638'></font>
cfn1 = grid%cfn1<a name='639'>
<font color=#447700>! recompute : cfn1<a name='640'></font>
epsts = grid%epsts<a name='641'>
<font color=#447700>! recompute : epsts<a name='642'></font>
step_number = grid%step_number<a name='643'>
<font color=#447700>! recompute : step_number<a name='644'></font>
rdx = grid%rdx<a name='645'>
<font color=#447700>! recompute : rdx<a name='646'></font>
rdy = grid%rdy<a name='647'>
<font color=#447700>! recompute : rdy<a name='648'></font>
cf1 = grid%cf1<a name='649'>
<font color=#447700>! recompute : cf1<a name='650'></font>
cf2 = grid%cf2<a name='651'>
<font color=#447700>! recompute : cf2<a name='652'></font>
cf3 = grid%cf3<a name='653'>
<font color=#447700>! recompute : cf3<a name='654'></font>
dtbc = grid%dtbc<a name='655'>
<font color=#447700>! recompute : dtbc<a name='656'></font>
dx = grid%dx<a name='657'>
<font color=#447700>! recompute : dx<a name='658'></font>
dy = grid%dy<a name='659'>
<font color=#447700>! recompute : dy<a name='660'></font>
dt = grid%dt<a name='661'>
<font color=#447700>! recompute : dt<a name='662'></font>
rk_ord = grid%rk_ord<a name='663'>
<font color=#447700>! recompute : rk_ord<a name='664'></font>
diff_opt = grid%diff_opt<a name='665'>
<font color=#447700>! recompute : diff_opt<a name='666'></font>
damp_opt = grid%damp_opt<a name='667'>
<font color=#447700>! recompute : damp_opt<a name='668'></font>
zdamp = grid%zdamp<a name='669'>
<font color=#447700>! recompute : zdamp<a name='670'></font>
dampcoef = grid%dampcoef<a name='671'>
<font color=#447700>! recompute : dampcoef<a name='672'></font>
khdif = grid%khdif<a name='673'>
<font color=#447700>! recompute : khdif<a name='674'></font>
kvdif = grid%kvdif<a name='675'>
<font color=#447700>! recompute : kvdif<a name='676'></font>
smdiv = grid%smdiv<a name='677'>
<font color=#447700>! recompute : smdiv<a name='678'></font>
emdiv = grid%emdiv<a name='679'>
<font color=#447700>! recompute : emdiv<a name='680'></font>
epssm = grid%epssm<a name='681'>
<font color=#447700>! recompute : epssm<a name='682'></font>
non_hydrostatic = grid%non_hydrostatic<a name='683'>
<font color=#447700>! recompute : non_hydrostatic<a name='684'></font>
time_step_sound = grid%time_step_sound<a name='685'>
<font color=#447700>! recompute : time_step_sound<a name='686'></font>
kh_tke_upper_bound = grid%kh_tke_upper_bound<a name='687'>
<font color=#447700>! recompute : kh_tke_upper_bound<a name='688'></font>
spec_bdy_width = grid%spec_bdy_width<a name='689'>
<font color=#447700>! recompute : spec_bdy_width<a name='690'></font>
spec_zone = grid%spec_zone<a name='691'>
<font color=#447700>! recompute : spec_zone<a name='692'></font>
relax_zone = grid%relax_zone<a name='693'>
<font color=#447700>! recompute : relax_zone<a name='694'></font>
call <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_6">( grid,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe )<a name='695'>
<font color=#447700>!  recompute : ide,ids,ime,ims,ipe,ips,jde,jds,jme,jms,jpe,jps,kde,kds,k<a name='696'></font>
<font color=#447700>! me,kms,kpe,kps<a name='697'></font>
k_start = kps<a name='698'>
<font color=#447700>! recompute : k_start<a name='699'></font>
k_end = kpe<a name='700'>
<font color=#447700>! recompute : k_end<a name='701'></font>
ijds = min(ids,jds)<a name='702'>
<font color=#447700>! recompute : ijds<a name='703'></font>
ijde = max(ide,jde)<a name='704'>
<font color=#447700>! recompute : ijde<a name='705'></font>
num_3d_m = num_moist<a name='706'>
<font color=#447700>! recompute : num_3d_m<a name='707'></font>
call <A href='../../html_code/frame/module_tiles.F.html#SET_TILES'>set_tiles</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_TILES_2">( grid,ids,ide,jds,jde,ips,ipe,jps,jpe )<a name='708'>
if ( grid%num_tiles &gt; 1 ) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_48">( "Adjoint code is not thread safe" )<a name='709'>
<font color=#447700>! recompute : grid<a name='710'></font>
rk_order = config_flags%rk_ord<a name='711'>
<font color=#447700>! recompute : rk_order<a name='712'></font>
leapfrog =  .false. <a name='713'>
<font color=#447700>! recompute : leapfrog<a name='714'></font>
dts = dt/float(time_step_sound)<a name='715'>
<font color=#447700>! recompute : dts<a name='716'></font>
if (rk_ord .eq. 1) then<a name='717'>
  leapfrog =  .true. <a name='718'>
endif<a name='719'>
<font color=#447700>! recompute : leapfrog<a name='720'></font>
BENCH_END(comp1)<a name='721'>
<a name='722'>
<font color=#447700>!------------------------------<a name='723'></font>
runge_kutta_looq: do rk_step = 1, rk_order<a name='724'>
BENCH_START(comp2)<a name='725'>
  dtm=dt<a name='726'>
  if (rk_order .eq. 1) then<a name='727'>
    if (step_number .ne. 1) then<a name='728'>
      number_of_small_timesteps = 2*time_step_sound<a name='729'>
      dt_rk = dt<a name='730'>
      dtm=2*dt<a name='731'>
    else<a name='732'>
      number_of_small_timesteps = time_step_sound<a name='733'>
      dt_rk = dt/2.<a name='734'>
      dtm=dt<a name='735'>
    endif<a name='736'>
    dts_rk = dts<a name='737'>
  else if (rk_order .eq. 2) then<a name='738'>
    if (rk_step .eq. 1) then<a name='739'>
      dt_rk = 0.5*dt<a name='740'>
      dts_rk = dts<a name='741'>
      number_of_small_timesteps = time_step_sound/2<a name='742'>
    else<a name='743'>
      dt_rk = dt<a name='744'>
      dts_rk = dts<a name='745'>
      number_of_small_timesteps = time_step_sound<a name='746'>
    endif<a name='747'>
  else if (rk_order .eq. 3) then<a name='748'>
    if (rk_step .eq. 1) then<a name='749'>
      dt_rk = dt/3.<a name='750'>
      dts_rk = dt_rk<a name='751'>
      number_of_small_timesteps = 1<a name='752'>
    else if (rk_step .eq. 2) then<a name='753'>
      dt_rk = 0.5*dt<a name='754'>
      dts_rk = dts<a name='755'>
      number_of_small_timesteps = time_step_sound/2<a name='756'>
    else<a name='757'>
      dt_rk = dt<a name='758'>
      dts_rk = dts<a name='759'>
      number_of_small_timesteps = time_step_sound<a name='760'>
    endif<a name='761'>
  endif<a name='762'>
BENCH_END(comp2)<a name='763'>
<a name='764'>
BENCH_START(exch2)<a name='765'>
#ifdef DM_PARALLEL<a name='766'>
lineno = __LINE__<a name='767'>
#    include "<A href='../../html_code/include/HALO_0616.inc.html'>HALO_0616.inc</A>"<A NAME="HALO_0616.inc_12"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='768'>
<a name='769'>
<a name='770'>
<a name='771'>
<a name='772'>
<a name='773'>
#endif<a name='774'>
<a name='775'>
#ifdef DM_PARALLEL<a name='776'>
lineno = __LINE__<a name='777'>
#    include "<A href='../../html_code/include/HALO_0626.inc.html'>HALO_0626.inc</A>"<A NAME="HALO_0626.inc_13"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='778'>
#endif<a name='779'>
BENCH_END(exch2)<a name='780'>
<a name='781'>
BENCH_START(comp3)<a name='782'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_4">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='783'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='784'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='785'>
BENCH_END(comp3)<a name='786'>
<a name='787'>
BENCH_START(exch3)<a name='788'>
#ifdef DM_PARALLEL<a name='789'>
lineno = __LINE__<a name='790'>
#    include "<A href='../../html_code/include/HALO_0637.inc.html'>HALO_0637.inc</A>"<A NAME="HALO_0637.inc_14"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='791'>
#endif<a name='792'>
BENCH_END(exch3)<a name='793'>
<a name='794'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='795'></font>
#ifndef NO_HALO_FIX<a name='796'>
  filecount = (rk_step*100) + 3<a name='797'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_15"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='798'>
#endif<a name='799'>
<a name='800'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='801'></font>
<font color=#447700>! TBH:  Save fields re-computed later by calls to rk_step_prep.  <a name='802'></font>
 store_rk_step_prep: if ( config_flags%remove_rk_step_prep ) then<a name='803'>
BENCH_START(compstore_rk_step_prep_tim)<a name='804'>
   WRITE(wrf_err_message,*)'DEBUG:  store_rk_step_prep:  rk_step, rk_order = ',rk_step,rk_order<a name='805'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_11"> ( 10 , TRIM(wrf_err_message) )<a name='806'>
   <font color=#447700>! store fields<a name='807'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_1">(rk_step, BUF_RK_STEP_PREP)<a name='808'>
#include "<A href='../../html_code/include/store_rk_step_prep.h.html'>store_rk_step_prep.h</A>"<A NAME="store_rk_step_prep.h_16"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='809'>
BENCH_END(compstore_rk_step_prep_tim)<a name='810'>
 endif store_rk_step_prep<a name='811'>
<a name='812'>
  rk_step_is_ong: if (rk_step .eq. 1) then<a name='813'>
BENCH_START(comp4)<a name='814'>
      call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_4">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,rk_step,&amp;<a name='815'>
&amp;ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='816'>
BENCH_END(comp4)<a name='817'>
<a name='818'>
BENCH_START(exch4)<a name='819'>
#ifdef DM_PARALLEL<a name='820'>
lineno = __LINE__<a name='821'>
#     include "<A href='../../html_code/include/HALO_0648.inc.html'>HALO_0648.inc</A>"<A NAME="HALO_0648.inc_17"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='822'>
#endif<a name='823'>
BENCH_END(exch4)<a name='824'>
<a name='825'>
BENCH_START(comp5)<a name='826'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_4">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,v_phy,&amp;<a name='827'>
&amp;p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,rqccuten,&amp;<a name='828'>
&amp;rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='829'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='830'>
BENCH_END(comp5)<a name='831'>
<a name='832'>
BENCH_START(exch5)<a name='833'>
#ifdef DM_PARALLEL<a name='834'>
lineno = __LINE__<a name='835'>
#     include "<A href='../../html_code/include/HALO_0660.inc.html'>HALO_0660.inc</A>"<A NAME="HALO_0660.inc_18"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='836'>
<a name='837'>
<a name='838'>
<a name='839'>
#endif<a name='840'>
BENCH_END(exch5)<a name='841'>
<a name='842'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='843'></font>
#ifndef NO_HALO_FIX<a name='844'>
  filecount = (rk_step*100) + 5<a name='845'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_19"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='846'>
#endif<a name='847'>
<a name='848'>
BENCH_START(comp6)<a name='849'>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='850'>
        call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_4">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='851'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='852'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='853'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='854'>
    endif<a name='855'>
BENCH_END(comp6)<a name='856'>
<a name='857'>
  endif rk_step_is_ong<a name='858'>
<a name='859'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='860'></font>
#ifndef NO_HALO_FIX<a name='861'>
  filecount = (rk_step*100) + 6<a name='862'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_20"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='863'>
#endif<a name='864'>
<a name='865'>
BENCH_START(exch6)<a name='866'>
#ifdef DM_PARALLEL<a name='867'>
lineno = __LINE__<a name='868'>
#     include "<A href='../../html_code/include/HALO_0679.inc.html'>HALO_0679.inc</A>"<A NAME="HALO_0679.inc_21"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='869'>
<a name='870'>
<a name='871'>
<a name='872'>
#endif<a name='873'>
BENCH_END(exch6)<a name='874'>
<a name='875'>
WRITE(wrf_err_message,*) 'DEBUG:  calling rk_tendency before_small_stepu, rk_step = ',rk_step<a name='876'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_12">( 10, TRIM(wrf_err_message) )<a name='877'>
BENCH_START(comp7771)<a name='878'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_4">( config_flags,rk_step,ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,&amp;<a name='879'>
&amp;mu_tend,u_save,v_save,w_save,ph_save,t_save,mu_save,rthften,ru,rv,rw,ww,u_2,v_2,w_2,t_2,ph_2,u_1,v_1,w_1,t_1,ph_1,h_diabatic,&amp;<a name='880'>
&amp;phb,t_init,mu_2,mut,muu,muv,mub,al,alt,p,pb,php,cqu,cqv,cqw,u_base,v_base,t_base,qv_base,z_base,msfu,msfv,msft,f,e,sina,cosa,&amp;<a name='881'>
&amp;fnm,fnp,rdn,rdnw,dt,rdx,rdy,khdif,kvdif,xkmhd,cf1,cf2,cf3,cfn,cfn1,num_3d_m,non_hydrostatic,leapfrog,ids,ide,jds,jde,kds,kde,&amp;<a name='882'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='883'>
BENCH_END(comp7771)<a name='884'>
<a name='885'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='886'></font>
#ifndef NO_HALO_FIX<a name='887'>
  filecount = (rk_step*100) + 7<a name='888'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_22"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='889'>
#endif<a name='890'>
<a name='891'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='892'></font>
<font color=#447700>! TBH:  Save fields re-computed later by calls to rk_tendency.  <a name='893'></font>
<font color=#447700>! TBH:  NOTE:  This optimization can co-exist with remove_rktend_thru_ss <a name='894'></font>
<font color=#447700>! TBH:  NOTE:  because its main benefit occurs prior to the small-step loop.  <a name='895'></font>
 store_rktend: if ( config_flags%remove_rktend ) then<a name='896'>
BENCH_START(compstore_rktend_tim)<a name='897'>
   WRITE(wrf_err_message,*)'DEBUG:  store_rktend:  rk_step, rk_order = ',rk_step,rk_order<a name='898'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_13"> ( 10 , TRIM(wrf_err_message) )<a name='899'>
   <font color=#447700>! store fields<a name='900'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_2">(rk_step, BUF_RKTEND)<a name='901'>
#include "<A href='../../html_code/include/store_rktend.h.html'>store_rktend.h</A>"<A NAME="store_rktend.h_23"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='902'>
BENCH_END(compstore_rktend_tim)<a name='903'>
 endif store_rktend<a name='904'>
<a name='905'>
BENCH_START(comp7)<a name='906'>
    if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='907'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_DRY'>relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_DRY_4">( config_flags,u_save,v_save,ph_save,t_save,w_save,mu_tend,ru,rv,ph_2,t_2,w_2,mu_2,mut,u_b,v_b,ph_b,t_b,&amp;<a name='908'>
&amp;w_b,mu_b,u_bt,v_bt,ph_bt,t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,kde,&amp;<a name='909'>
&amp;ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='910'>
    endif<a name='911'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_ADDTEND_DRY'>rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_ADDTEND_DRY_4">( ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,u_save,v_save,w_save,&amp;<a name='912'>
&amp;ph_save,t_save,rk_step,h_diabatic,mut,msft,msfu,msfv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='913'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='914'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='915'></font>
#ifndef NO_HALO_FIX<a name='916'>
  filecount = (rk_step*100) + 8<a name='917'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_24"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='918'>
#endif<a name='919'>
    if (config_flags%specified .or. config_flags%nested) then<a name='920'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_DRY'>spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_DRY_4">( config_flags,ru_tend,rv_tend,ph_tend,t_tend,rw_tend,mu_tend,u_b,v_b,ph_b,t_b,w_b,mu_b,u_bt,v_bt,ph_bt,&amp;<a name='921'>
&amp;t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='922'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='923'>
    endif<a name='924'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='925'></font>
#ifndef NO_HALO_FIX<a name='926'>
  filecount = (rk_step*100) + 9<a name='927'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_25"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='928'>
#endif<a name='929'>
<a name='930'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_PREP'>small_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_PREP_4">( u_1,u_2,v_1,v_2,w_1,w_2,t_1,t_2,ph_1,ph_2,mub,mu_1,mu_2,muu,muus,muv,muvs,mut,muts,mudf,u_save,v_save,&amp;<a name='931'>
&amp;w_save,t_save,ph_save,mu_save,ww,ww1,dnw,c2a,pb,p,alt,msfu,msfv,msft,rk_step,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='932'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='933'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_5">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,0,ids,ide,jds,jde,kds,kde,&amp;<a name='934'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='935'>
    if (non_hydrostatic) then<a name='936'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_COEF_W'>calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_COEF_W_4">( a,alpha,gamma,mut,cqw,rdn,rdnw,c2a,dts,g,epssm,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='937'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='938'>
    endif<a name='939'>
BENCH_END(comp7)<a name='940'>
<a name='941'>
BENCH_START(exch7)<a name='942'>
#ifdef DM_PARALLEL<a name='943'>
lineno = __LINE__<a name='944'>
#      include "<A href='../../html_code/include/HALO_0718.inc.html'>HALO_0718.inc</A>"<A NAME="HALO_0718.inc_26"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='945'>
#endif<a name='946'>
BENCH_END(exch7)<a name='947'>
<a name='948'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='949'></font>
#ifndef NO_HALO_FIX<a name='950'>
  filecount = (rk_step*100) + 10<a name='951'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_27"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='952'>
#endif<a name='953'>
<a name='954'>
  small_stepu: do iteration = 1, number_of_small_timesteps<a name='955'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='956'></font>
#ifndef NO_HALO_FIX<a name='957'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 0<a name='958'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_28"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='959'>
#endif<a name='960'>
WRITE(wrf_err_message,*) 'DEBUG:  begin small_stepu, iteration = ',iteration<a name='961'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_14">( 10, TRIM(wrf_err_message) )<a name='962'>
BENCH_START(comp8)<a name='963'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_UV'>advance_uv</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_UV_4">( u_2,ru_tend,v_2,rv_tend,p,pb,ph_2,php,alt,al,mu_2,muu,cqu,muv,cqv,mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,&amp;<a name='964'>
&amp;emdiv,rdnw,config_flags,spec_zone,non_hydrostatic,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='965'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='966'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='967'></font>
#ifndef NO_HALO_FIX<a name='968'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 1<a name='969'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_29"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='970'>
#endif<a name='971'>
      if (config_flags%specified .or. config_flags%nested) then<a name='972'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_9">( u_2,ru_tend,dts_rk,'u',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='973'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='974'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_10">( v_2,rv_tend,dts_rk,'v',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='975'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='976'>
      endif<a name='977'>
BENCH_END(comp8)<a name='978'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='979'></font>
#ifndef NO_HALO_FIX<a name='980'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 2<a name='981'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_30"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='982'>
#endif<a name='983'>
<a name='984'>
BENCH_START(exch8)<a name='985'>
#ifdef DM_PARALLEL<a name='986'>
lineno = __LINE__<a name='987'>
#     include "<A href='../../html_code/include/HALO_0736.inc.html'>HALO_0736.inc</A>"<A NAME="HALO_0736.inc_31"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='988'>
#endif<a name='989'>
BENCH_END(exch8)<a name='990'>
<a name='991'>
BENCH_START(comp9)<a name='992'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_MU_T'>advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_MU_T_4">( ww,ww1,u_2,u_save,v_2,v_save,mu_2,mut,muave,muts,muu,muv,mudf,ru_m,rv_m,ww_m,t_2,t_save,t_2save,t_tend,&amp;<a name='993'>
&amp;mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,msfv,msft,iteration,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='994'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='995'>
BENCH_END(comp9)<a name='996'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='997'></font>
#ifndef NO_HALO_FIX<a name='998'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 3<a name='999'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_32"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1000'>
#endif<a name='1001'>
<a name='1002'>
BENCH_START(exch9)<a name='1003'>
#ifdef DM_PARALLEL<a name='1004'>
lineno = __LINE__<a name='1005'>
#include "<A href='../../html_code/include/HALO_0747.inc.html'>HALO_0747.inc</A>"<A NAME="HALO_0747.inc_33"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1006'>
<a name='1007'>
<a name='1008'>
<a name='1009'>
<a name='1010'>
#endif<a name='1011'>
BENCH_END(exch9)<a name='1012'>
<a name='1013'>
BENCH_START(comp10)<a name='1014'>
      if (config_flags%specified .or. config_flags%nested) then<a name='1015'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_11">( t_2,t_tend,dts_rk,'t',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='1016'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1017'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_12">( mu_2,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='1018'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='1019'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_13">( muts,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='1020'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='1021'>
      endif<a name='1022'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1023'></font>
#ifndef NO_HALO_FIX<a name='1024'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 4<a name='1025'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_34"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1026'>
#endif<a name='1027'>
<a name='1028'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SUMFLUX'>sumflux</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUMFLUX_4">( u_2,v_2,ww,u_save,v_save,ww1,muu,muv,ru_m,rv_m,ww_m,epssm,msfu,msfv,iteration,number_of_small_timesteps,ids,&amp;<a name='1029'>
&amp;ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1030'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1031'></font>
#ifndef NO_HALO_FIX<a name='1032'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 5<a name='1033'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_35"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1034'>
#endif<a name='1035'>
      if (non_hydrostatic) then<a name='1036'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_W'>advance_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_W_4">( w_2,rw_tend,ww,u_2,v_2,mu_2,mut,muave,muts,t_2save,t_2,t_save,ph_2,ph_save,phb,ph_tend,ht,c2a,cqw,alt,alb,&amp;<a name='1037'>
&amp;a,alpha,gamma,rdx,rdy,dts,t0,epssm,dnw,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,&amp;<a name='1038'>
&amp;jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1039'>
      endif<a name='1040'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1041'></font>
#ifndef NO_HALO_FIX<a name='1042'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 6<a name='1043'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_36"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1044'>
#endif<a name='1045'>
      if (config_flags%specified .or. config_flags%nested) then<a name='1046'>
        if (non_hydrostatic) then<a name='1047'>
          call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDYUPDATE_PH'>spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_PH_4">( ph_save,ph_2,ph_tend,mu_tend,muts,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,&amp;<a name='1048'>
&amp;ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1049'>
          if (config_flags%specified) then<a name='1050'>
            call <A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY'>zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_GRAD_BDY_2">( w_2,'w',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,&amp;<a name='1051'>
&amp;kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1052'>
          else<a name='1053'>
            call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_14">( w_2,rw_tend,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='1054'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1055'>
          endif<a name='1056'>
        endif<a name='1057'>
      endif<a name='1058'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1059'></font>
#ifndef NO_HALO_FIX<a name='1060'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 7<a name='1061'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_37"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1062'>
#endif<a name='1063'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_6">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,iteration,ids,ide,jds,jde,&amp;<a name='1064'>
&amp;kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1065'>
BENCH_END(comp10)<a name='1066'>
<a name='1067'>
BENCH_START(exch10)<a name='1068'>
#ifdef DM_PARALLEL<a name='1069'>
lineno = __LINE__<a name='1070'>
#      include "<A href='../../html_code/include/HALO_0790.inc.html'>HALO_0790.inc</A>"<A NAME="HALO_0790.inc_38"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1071'>
#endif<a name='1072'>
BENCH_END(exch10)<a name='1073'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1074'></font>
#ifndef NO_HALO_FIX<a name='1075'>
  filecount = 5000 + (rk_step*100) + (iteration*10) + 8<a name='1076'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_39"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1077'>
#endif<a name='1078'>
<a name='1079'>
  end do small_stepu<a name='1080'>
<a name='1081'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1082'></font>
#ifndef NO_HALO_FIX<a name='1083'>
  filecount = 6000 + (rk_step*100) + 10<a name='1084'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_40"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1085'>
#endif<a name='1086'>
<a name='1087'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='1088'></font>
<font color=#447700>! TBH:  Save fields re-computed later by small_step loops.  <a name='1089'></font>
 store_small_step: if ( config_flags%remove_small_step .and. &amp;<a name='1090'>
                ( .not. config_flags%remove_rktend_thru_ss ) ) then<a name='1091'>
BENCH_START(compstore_small_step_tim)<a name='1092'>
   WRITE(wrf_err_message,*)'DEBUG:  store_small_step:  rk_step, rk_order = ',rk_step,rk_order<a name='1093'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_15"> ( 10 , TRIM(wrf_err_message) )<a name='1094'>
   <font color=#447700>! store fields<a name='1095'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_3">(rk_step, BUF_SMALL_STEP)<a name='1096'>
#include "<A href='../../html_code/include/store_small_step.h.html'>store_small_step.h</A>"<A NAME="store_small_step.h_41"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1097'>
BENCH_END(compstore_small_step_tim)<a name='1098'>
 endif store_small_step<a name='1099'>
<a name='1100'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='1101'></font>
<font color=#447700>! TBH:  Save fields computed between the call to rk_tendency and <a name='1102'></font>
<font color=#447700>! TBH:  the end of small_stepu loop.  <a name='1103'></font>
 store_rktend_thru_ss: if ( config_flags%remove_rktend_thru_ss ) then<a name='1104'>
BENCH_START(compstore_rktend_thru_ss_tim)<a name='1105'>
   WRITE(wrf_err_message,*)'DEBUG:  store_rktend_thru_ss:  rk_step, rk_order = ',rk_step,rk_order<a name='1106'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_16"> ( 10 , TRIM(wrf_err_message) )<a name='1107'>
   <font color=#447700>! store fields<a name='1108'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_4">(rk_step, BUF_RKTEND_THRU_SS)<a name='1109'>
#include "<A href='../../html_code/include/store_rktend_thru_ss.h.html'>store_rktend_thru_ss.h</A>"<A NAME="store_rktend_thru_ss.h_42"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1110'>
BENCH_END(compstore_rktend_thru_ss_tim)<a name='1111'>
 endif store_rktend_thru_ss<a name='1112'>
<a name='1113'>
BENCH_START(comp11)<a name='1114'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_MU_UV_1'>calc_mu_uv_1</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_MU_UV_1_4">( config_flags,muts,muus,muvs,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='1115'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1116'>
<a name='1117'>
<font color=#447700>!    call small_step_finish( u_2,u_1,v_2,v_1,w_2,w_1,t_2,t_1,ph_2,ph_1,ww,ww1,mu_2,mu_1,mut,muts,muu,muus,muv,muvs,u_save,v_save,&amp;<a name='1118'></font>
<font color=#447700>!&amp;w_save,t_save,ph_save,mu_save,msfu,msfv,msft,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='1119'></font>
<font color=#447700>!&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1120'></font>
<font color=#447700>!-----The original<a name='1121'></font>
      CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_FINISH'>small_step_finish</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_FINISH_4">( u_2, u_1, v_2, v_1, w_2, w_1,     &amp;<a name='1122'>
                              t_2, t_1, ph_2, ph_1, ww, ww1,    &amp;<a name='1123'>
                              mu_2, mu_1,                       &amp;<a name='1124'>
                              mut, muts, muu, muus, muv, muvs,  &amp;<a name='1125'>
                              u_save, v_save, w_save,           &amp;<a name='1126'>
                              t_save, ph_save, mu_save,         &amp;<a name='1127'>
                              msfu, msfv, msft,                 &amp;<a name='1128'>
                              h_diabatic,                       &amp;<a name='1129'>
                              number_of_small_timesteps,dts_rk, &amp;<a name='1130'>
                              ids, ide, jds, jde, kds, kde,     &amp;<a name='1131'>
                              ims, ime, jms, jme, kms, kme,     &amp;<a name='1132'>
                              grid%i_start(ij), grid%i_end(ij), &amp;<a name='1133'>
                              grid%j_start(ij), grid%j_end(ij), &amp;<a name='1134'>
                              k_start    , k_end               )<a name='1135'>
BENCH_END(comp11)<a name='1136'>
<a name='1137'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1138'></font>
#ifndef NO_HALO_FIX<a name='1139'>
  filecount = 6000 + (rk_step*100) + 11<a name='1140'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_43"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1141'>
#endif<a name='1142'>
<a name='1143'>
BENCH_START(exch11)<a name='1144'>
#ifdef DM_PARALLEL<a name='1145'>
lineno = __LINE__<a name='1146'>
#  include "<A href='../../html_code/include/HALO_0821.inc.html'>HALO_0821.inc</A>"<A NAME="HALO_0821.inc_44"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1147'>
#endif<a name='1148'>
BENCH_END(exch11)<a name='1149'>
<a name='1150'>
BENCH_START(comp12)<a name='1151'>
  moist_scalar_advancg: if (num_3d_m .ge. param_first_scalar) then<a name='1152'>
    moist_variable_loor: do im = param_first_scalar, num_3d_m<a name='1153'>
        call <A href='../../html_code/dyn_em/module_em.F.html#RK_SCALAR_TEND'>rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_SCALAR_TEND_6">( im,im,config_flags,rk_step,dt_rk,ru_m,rv_m,ww_m,mut,alt,moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,&amp;<a name='1154'>
&amp;im),moist_tend(ims,kms,jms,im),advect_tend,rqvften,qv_base, .true. ,fnm,fnp,msfu,msfv,msft,rdx,rdy,rdn,rdnw,khdif,kvdif,&amp;<a name='1155'>
&amp;xkmhd,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%&amp;<a name='1156'>
&amp;j_end(ij),k_start,k_end )<a name='1157'>
        if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='1158'>
          if (im .eq. p_qv) then<a name='1159'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_9">( moist_tend(ims,kms,jms,im),rqv_b,rqv_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1160'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1161'>
          endif<a name='1162'>
        endif<a name='1163'>
        if (config_flags%nested .and. rk_step .eq. 1) then<a name='1164'>
          if (im .eq. p_qc) then<a name='1165'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_10">( moist_tend(ims,kms,jms,im),rqc_b,rqc_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1166'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1167'>
          else if (im .eq. p_qr) then<a name='1168'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_11">( moist_tend(ims,kms,jms,im),rqr_b,rqr_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1169'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1170'>
          else if (im .eq. p_qi) then<a name='1171'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_12">( moist_tend(ims,kms,jms,im),rqi_b,rqi_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1172'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1173'>
          else if (im .eq. p_qs) then<a name='1174'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_13">( moist_tend(ims,kms,jms,im),rqs_b,rqs_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1175'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1176'>
          else if (im .eq. p_qg) then<a name='1177'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_14">( moist_tend(ims,kms,jms,im),rqg_b,rqg_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1178'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1179'>
          endif<a name='1180'>
        endif<a name='1181'>
        call <A href='../../html_code/dyn_em/module_em.F.html#RK_UPDATE_SCALAR'>rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_UPDATE_SCALAR_6">( im,im,moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,im),moist_tend(ims,kms,jms,im),advect_tend,msft,&amp;<a name='1182'>
&amp;mu_1,mu_2,mub,rk_step,dt_rk,spec_zone,epsts,leapfrog,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='1183'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1184'>
    end do moist_variable_loor<a name='1185'>
  endif moist_scalar_advancg<a name='1186'>
<a name='1187'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_P_RHO_PHI'>calc_p_rho_phi</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_PHI_5">( moist_2,num_3d_m,al,alb,mu_2,muts,ph_2,p,pb,t_2,p0,t0,znu,dnw,rdnw,rdn,non_hydrostatic,ids,ide,jds,jde,&amp;<a name='1188'>
&amp;kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1189'>
    if ( .not. non_hydrostatic) then<a name='1190'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#DIAGNOSE_W'>diagnose_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DIAGNOSE_W_5">( ph_tend,ph_2,ph_1,w_2,muts,dt_rk,u_2,v_2,ht,cf1,cf2,cf3,rdx,rdy,msft,ids,ide,jds,jde,kds,kde,ims,ime,jms,&amp;<a name='1191'>
&amp;jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1192'>
    endif<a name='1193'>
BENCH_END(comp12)<a name='1194'>
<a name='1195'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1196'></font>
#ifndef NO_HALO_FIX<a name='1197'>
  filecount = 6000 + (rk_step*100) + 12<a name='1198'>
#include &lt;<A href='../../html_code/include/no_a_debug_halo.h.html'>no_a_debug_halo.h</A>&gt;<A NAME="no_a_debug_halo.h_45"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1199'>
#endif<a name='1200'>
<a name='1201'>
BENCH_START(exch12)<a name='1202'>
#ifdef DM_PARALLEL<a name='1203'>
lineno = __LINE__<a name='1204'>
#  include "<A href='../../html_code/include/HALO_0871.inc.html'>HALO_0871.inc</A>"<A NAME="HALO_0871.inc_46"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1205'>
<a name='1206'>
<a name='1207'>
<a name='1208'>
<a name='1209'>
#endif<a name='1210'>
BENCH_END(exch12)<a name='1211'>
<a name='1212'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='1213'></font>
<font color=#447700>! TBH:  Save fields re-computed later by runge_kutta_loor...  <a name='1214'></font>
 store_runge_kutta_loor: if (config_flags%remove_runge_kutta_loor) then<a name='1215'>
BENCH_START(compstore_runge_kutta_loor_tim)<a name='1216'>
   if ( rk_step &lt; rk_order ) then<a name='1217'>
     WRITE(wrf_err_message,*)'DEBUG:  store_runge_kutta_loor:  rk_step, rk_order = ',rk_step,rk_order<a name='1218'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_17"> ( 10 , TRIM(wrf_err_message) )<a name='1219'>
     <font color=#447700>! store fields<a name='1220'></font>
     CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_5">(rk_step, BUF_RK_LOOR)<a name='1221'>
#include "<A href='../../html_code/include/store_runge_kutta_loor.h.html'>store_runge_kutta_loor.h</A>"<A NAME="store_runge_kutta_loor.h_47"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1222'>
   endif<a name='1223'>
BENCH_END(compstore_runge_kutta_loor_tim)<a name='1224'>
 endif store_runge_kutta_loor<a name='1225'>
<a name='1226'>
end do runge_kutta_looq<a name='1227'>
<a name='1228'>
<a name='1229'>
if (config_flags%mp_physics == 0) then<a name='1230'>
  if (config_flags%specified .or. config_flags%nested) then<a name='1231'>
    sz = spec_zone<a name='1232'>
  else<a name='1233'>
    sz = 0<a name='1234'>
  endif<a name='1235'>
<a name='1236'>
    if ( .not. non_hydrostatic) then<a name='1237'>
<a name='1238'>
BENCH_START(exch13)<a name='1239'>
#ifdef DM_PARALLEL<a name='1240'>
lineno = __LINE__<a name='1241'>
<a name='1242'>
<a name='1243'>
#endif<a name='1244'>
BENCH_END(exch13)<a name='1245'>
<a name='1246'>
BENCH_START(comp13)<a name='1247'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_DIAGNOSE_W'>a_diagnose_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_DIAGNOSE_W_2">( ph_tend,a_ph_tend,a_ph_2,a_ph_1,&amp;<a name='1248'>
                     a_w_2,muts,a_muts,dt_rk,a_u_2,a_v_2,ht,cf1,cf2,cf3,rdx,rdy,msft,ide,jde,&amp;<a name='1249'>
                     ims,ime,jms,jme,kms,kme,&amp;<a name='1250'>
                     max(grid%i_start(ij),ids+sz),  &amp;<a name='1251'>
                     min(grid%i_end(ij),ide-1-sz),    &amp;<a name='1252'>
                     max(grid%j_start(ij),jds+sz),  &amp;<a name='1253'>
                     min(grid%j_end(ij),jde-1-sz),k_end )<a name='1254'>
BENCH_END(comp13)<a name='1255'>
<a name='1256'>
    endif<a name='1257'>
<a name='1258'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1259'></font>
#ifndef NO_HALO_FIX<a name='1260'>
  filecount = 7000 + 13<a name='1261'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_48"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1262'>
#endif<a name='1263'>
<a name='1264'>
BENCH_START(comp14)<a name='1265'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALC_P_RHO_PHI'>a_calc_p_rho_phi</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_P_RHO_PHI_2">( moist_2,a_moist_2,num_3d_m,al,a_al,alb,mu_2,&amp;<a name='1266'>
                      a_mu_2,muts,a_muts,ph_2,a_ph_2,p,a_p,pb,t_2,a_t_2,p0,t0,dnw,&amp;<a name='1267'>
                      rdnw,rdn,non_hydrostatic,ide,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='1268'>
                      max(grid%i_start(ij),ids+sz),  &amp;<a name='1269'>
                      min(grid%i_end(ij),ide-1-sz),    &amp;<a name='1270'>
                      max(grid%j_start(ij),jds+sz),  &amp;<a name='1271'>
                      min(grid%j_end(ij),jde-1-sz),k_start,k_end )<a name='1272'>
BENCH_END(comp14)<a name='1273'>
<a name='1274'>
BENCH_START(comp_a_moist_physics_finish_tim)<a name='1275'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_MOIST_PHYSICS_FINISH_EM'>a_moist_physics_finish_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MOIST_PHYSICS_FINISH_EM_1">( a_t_2, a_t_1, t0, &amp;<a name='1276'>
                    a_h_diabatic, dtm, ide, jde, kde, &amp;<a name='1277'>
                    ims, ime, jms, jme, kms, kme, &amp;<a name='1278'>
                    max(grid%i_start(ij),ids+sz),  &amp;<a name='1279'>
                    min(grid%i_end(ij),ide-1-sz),    &amp;<a name='1280'>
                    max(grid%j_start(ij),jds+sz),  &amp;<a name='1281'>
                    min(grid%j_end(ij),jde-1-sz),k_start,k_end )<a name='1282'>
BENCH_END(comp_a_moist_physics_finish_tim)<a name='1283'>
<a name='1284'>
<a name='1285'>
BENCH_START(comp_moist_physics_prep_tim)<a name='1286'>
       CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#MOIST_PHYSICS_PREP_EM'>moist_physics_prep_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MOIST_PHYSICS_PREP_EM_4">( t_2, t_1, t0, rho,                &amp;<a name='1287'>
                                   al, alb, p, p8w, p0, pb,          &amp;<a name='1288'>
                                   ph_2, phb, pi_phy, p_phy,         &amp;<a name='1289'>
                                   z, z_at_w, dz8w,                  &amp;<a name='1290'>
                                   dtm, h_diabatic,                  &amp;<a name='1291'>
                                   config_flags,fnm, fnp,            &amp;<a name='1292'>
                                   ids, ide, jds, jde, kds, kde,     &amp;<a name='1293'>
                                   ims, ime, jms, jme, kms, kme,     &amp;<a name='1294'>
                                   max(grid%i_start(ij),ids+sz),  &amp;<a name='1295'>
                                   min(grid%i_end(ij),ide-1-sz),    &amp;<a name='1296'>
                                   max(grid%j_start(ij),jds+sz),  &amp;<a name='1297'>
                                   min(grid%j_end(ij),jde-1-sz),k_start,k_end )<a name='1298'>
BENCH_END(comp_moist_physics_prep_tim)<a name='1299'>
<a name='1300'>
BENCH_START(comp_a_lscond_tim)<a name='1301'>
       CALL <A href='../../html_code/phys/module_mp_nconvp.F.html#A_LSCOND'>a_lscond</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_LSCOND_2"> ( t_2,a_t_2,p_phy,a_p_phy,moist_2(ims,kms,jms,P_QV), &amp;<a name='1302'>
                       a_moist_2(ims,kms,jms,P_QV),rho,a_rho,&amp;<a name='1303'>
                       pi_phy,a_pi_phy,r_v,xlv,cp,ep_2,svp1,svp2,svp3,svpt0,dz8w,a_dz8w, &amp;<a name='1304'>
                       rainnc,a_rainnc,rainncv,a_rainncv,ims,ime,jms,jme,kms,kme, &amp;<a name='1305'>
                       max(grid%i_start(ij),ids+sz),  &amp;<a name='1306'>
                       min(grid%i_end(ij),ide-1-sz),    &amp;<a name='1307'>
                       max(grid%j_start(ij),jds+sz),  &amp;<a name='1308'>
                       min(grid%j_end(ij),jde-1-sz),min(k_end,kde-1) )<a name='1309'>
BENCH_END(comp_a_lscond_tim)<a name='1310'>
<a name='1311'>
BENCH_START(comp_a_moist_physics_prep_tim)<a name='1312'>
       call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_MOIST_PHYSICS_PREP_EM'>a_moist_physics_prep_em</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_MOIST_PHYSICS_PREP_EM_2">( t_2, a_t_2, t_1, a_t_1, t0, rho, a_rho, &amp;<a name='1313'>
                                     al, a_al, alb, p, a_p, p8w, a_p8w, p0, &amp;<a name='1314'>
                                     pb, ph_2, a_ph_2, phb, pi_phy, a_pi_phy, &amp;<a name='1315'>
                                     p_phy, a_p_phy, z, a_z, z_at_w, a_z_at_w, &amp;<a name='1316'>
                                     dz8w, a_dz8w, h_diabatic, a_h_diabatic, fnm, fnp, &amp;<a name='1317'>
                                     ide, jde, kde, ims, ime, jms, jme, kms, kme, &amp;<a name='1318'>
                                     max(grid%i_start(ij),ids+sz),  &amp;<a name='1319'>
                                     min(grid%i_end(ij),ide-1-sz),    &amp;<a name='1320'>
                                     max(grid%j_start(ij),jds+sz),  &amp;<a name='1321'>
                                     min(grid%j_end(ij),jde-1-sz),k_start,k_end )<a name='1322'>
BENCH_END(comp_a_moist_physics_prep_tim)<a name='1323'>
<a name='1324'>
endif<a name='1325'>
<a name='1326'>
<font color=#447700>!------------------------------<a name='1327'></font>
<font color=#447700>!------------------------------<a name='1328'></font>
<a name='1329'>
a_runge_kutta_loop: do rk_step = rk_order, 1, -1<a name='1330'>
<a name='1331'>
BENCH_START(comp15)<a name='1332'>
<a name='1333'>
<font color=#447700>! TBH:  Eliminate this copy when rk_step &gt; 1 and <a name='1334'></font>
<font color=#447700>! TBH:  config_flags%remove_runge_kutta_loor == .TRUE.<a name='1335'></font>
if ( .not. ( config_flags%remove_runge_kutta_loor .and. &amp;<a name='1336'>
           ( rk_step &gt; 1 ) ) ) then<a name='1337'>
#ifndef FAST_CPY<a name='1338'>
  a(:,:,:) = ah(:,:,:)<a name='1339'>
  al(:,:,:) = alj(:,:,:)<a name='1340'>
  alpha(:,:,:) = alphah(:,:,:)<a name='1341'>
  gamma(:,:,:) = gammah(:,:,:)<a name='1342'>
  moist_1(:,:,:,:) = moist_1i(:,:,:,:)<a name='1343'>
  moist_2(:,:,:,:) = moist_2i(:,:,:,:)<a name='1344'>
  moist_tend(:,:,:,:) = moist_tendi(:,:,:,:)<a name='1345'>
  mu_1(:,:) = mu_1i(:,:)<a name='1346'>
  mu_2(:,:) = mu_2j(:,:)<a name='1347'>
  p(:,:,:) = pj(:,:,:)<a name='1348'>
  ph_1(:,:,:) = ph_1i(:,:,:)<a name='1349'>
  ph_2(:,:,:) = ph_2j(:,:,:)<a name='1350'>
  ph_tendf(:,:,:) = ph_tendfi(:,:,:)<a name='1351'>
  pm1(:,:,:) = pm1i(:,:,:)<a name='1352'>
  ru_m(:,:,:) = ru_mh(:,:,:)<a name='1353'>
  ru_tendf(:,:,:) = ru_tendfi(:,:,:)<a name='1354'>
  rv_m(:,:,:) = rv_mh(:,:,:)<a name='1355'>
  rv_tendf(:,:,:) = rv_tendfi(:,:,:)<a name='1356'>
  rw_tendf(:,:,:) = rw_tendfi(:,:,:)<a name='1357'>
  t_1(:,:,:) = t_1i(:,:,:)<a name='1358'>
  t_2(:,:,:) = t_2j(:,:,:)<a name='1359'>
  t_tendf(:,:,:) = t_tendfi(:,:,:)<a name='1360'>
  u_1(:,:,:) = u_1i(:,:,:)<a name='1361'>
  u_2(:,:,:) = u_2i(:,:,:)<a name='1362'>
  v_1(:,:,:) = v_1i(:,:,:)<a name='1363'>
  v_2(:,:,:) = v_2i(:,:,:)<a name='1364'>
  w_1(:,:,:) = w_1i(:,:,:)<a name='1365'>
  w_2(:,:,:) = w_2j(:,:,:)<a name='1366'>
  ww_m(:,:,:) = ww_mh(:,:,:)<a name='1367'>
  xkmhd(:,:,:) = xkmhdi(:,:,:)<a name='1368'>
#else<a name='1369'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_33">(  a , ah , n3d_elem )<a name='1370'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_34">(  al , alj , n3d_elem )<a name='1371'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_35">(  alpha , alphah , n3d_elem )<a name='1372'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_36">(  gamma , gammah , n3d_elem )<a name='1373'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_37">(  moist_1(ims,kms,jms,2) , moist_1i(ims,kms,jms,2) , n3d_elem * ( num_moist - 1 ) )<a name='1374'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_38">(  moist_2(ims,kms,jms,2) , moist_2i(ims,kms,jms,2) , n3d_elem * ( num_moist - 1 ) )<a name='1375'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_39">(  moist_tend(ims,kms,jms,2) , moist_tendi(ims,kms,jms,2) , n3d_elem * ( num_moist - 1 ) )<a name='1376'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_40">(  mu_1 , mu_1i , n2d_elem )<a name='1377'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_41">(  mu_2 , mu_2j , n2d_elem )<a name='1378'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_42">(  p , pj , n3d_elem )<a name='1379'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_43">(  ph_1 , ph_1i , n3d_elem )<a name='1380'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_44">(  ph_2 , ph_2j , n3d_elem )<a name='1381'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_45">(  ph_tendf , ph_tendfi , n3d_elem )<a name='1382'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_46">(  pm1 , pm1i , n3d_elem )<a name='1383'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_47">(  ru_m , ru_mh , n3d_elem )<a name='1384'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_48">(  ru_tendf , ru_tendfi , n3d_elem )<a name='1385'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_49">(  rv_m , rv_mh , n3d_elem )<a name='1386'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_50">(  rv_tendf , rv_tendfi , n3d_elem )<a name='1387'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_51">(  rw_tendf , rw_tendfi , n3d_elem )<a name='1388'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_52">(  t_1 , t_1i , n3d_elem )<a name='1389'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_53">(  t_2 , t_2j , n3d_elem )<a name='1390'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_54">(  t_tendf , t_tendfi , n3d_elem )<a name='1391'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_55">(  u_1 , u_1i , n3d_elem )<a name='1392'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_56">(  u_2 , u_2i , n3d_elem )<a name='1393'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_57">(  v_1 , v_1i , n3d_elem )<a name='1394'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_58">(  v_2 , v_2i , n3d_elem )<a name='1395'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_59">(  w_1 , w_1i , n3d_elem )<a name='1396'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_60">(  w_2 , w_2j , n3d_elem )<a name='1397'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_61">(  ww_m , ww_mh , n3d_elem )<a name='1398'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_62">(  xkmhd , xkmhdi , n3d_elem )<a name='1399'>
#endif<a name='1400'>
endif<a name='1401'>
<a name='1402'>
BENCH_END(comp15)<a name='1403'>
<a name='1404'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='1405'></font>
 restore_runge_kutta_loor: if (.not. config_flags%remove_runge_kutta_loor) then<a name='1406'>
<a name='1407'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_18"> ( 10 , 'DEBUG:  begin runge_kutta_loor' )<a name='1408'>
  runge_kutta_loor: do rk_step1 = 1, rk_step-1<a name='1409'>
    dtm = dt<a name='1410'>
    if (rk_order .eq. 1) then<a name='1411'>
      if (step_number .ne. 1) then<a name='1412'>
        number_of_small_timesteps = 2*time_step_sound<a name='1413'>
        dt_rk = dt<a name='1414'>
        dtm = 2*dt<a name='1415'>
      else<a name='1416'>
        number_of_small_timesteps = time_step_sound<a name='1417'>
        dt_rk = dt/2.<a name='1418'>
        dtm = dt<a name='1419'>
      endif<a name='1420'>
      dts_rk = dts<a name='1421'>
    else if (rk_order .eq. 2) then<a name='1422'>
      if (rk_step1 .eq. 1) then<a name='1423'>
        dt_rk = 0.5*dt<a name='1424'>
        dts_rk = dts<a name='1425'>
        number_of_small_timesteps = time_step_sound/2<a name='1426'>
      else<a name='1427'>
        dt_rk = dt<a name='1428'>
        dts_rk = dts<a name='1429'>
        number_of_small_timesteps = time_step_sound<a name='1430'>
      endif<a name='1431'>
    else if (rk_order .eq. 3) then<a name='1432'>
      if (rk_step1 .eq. 1) then<a name='1433'>
        dt_rk = dt/3.<a name='1434'>
        dts_rk = dt_rk<a name='1435'>
        number_of_small_timesteps = 1<a name='1436'>
      else if (rk_step1 .eq. 2) then<a name='1437'>
        dt_rk = 0.5*dt<a name='1438'>
        dts_rk = dts<a name='1439'>
        number_of_small_timesteps = time_step_sound/2<a name='1440'>
      else<a name='1441'>
        dt_rk = dt<a name='1442'>
        dts_rk = dts<a name='1443'>
        number_of_small_timesteps = time_step_sound<a name='1444'>
      endif<a name='1445'>
    endif<a name='1446'>
<a name='1447'>
BENCH_START(exch14)<a name='1448'>
#ifdef DM_PARALLEL<a name='1449'>
lineno = __LINE__<a name='1450'>
<font color=#447700>! not sure this is needed here. add it for now; can remove later<a name='1451'></font>
#    include "<A href='../../html_code/include/HALO_1015.inc.html'>HALO_1015.inc</A>"<A NAME="HALO_1015.inc_49"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1452'>
#endif<a name='1453'>
BENCH_END(exch14)<a name='1454'>
<a name='1455'>
BENCH_START(comp16)<a name='1456'>
      call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_5">( config_flags,rk_step1,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,&amp;<a name='1457'>
&amp;alb,cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij)&amp;<a name='1458'>
&amp;,grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1459'>
BENCH_END(comp16)<a name='1460'>
BENCH_START(exch15)<a name='1461'>
#ifdef DM_PARALLEL<a name='1462'>
lineno = __LINE__<a name='1463'>
#    include "<A href='../../html_code/include/HALO_1026.inc.html'>HALO_1026.inc</A>"<A NAME="HALO_1026.inc_50"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1464'>
#endif<a name='1465'>
<a name='1466'>
#ifdef DM_PARALLEL<a name='1467'>
lineno = __LINE__<a name='1468'>
#    include "<A href='../../html_code/include/HALO_1031.inc.html'>HALO_1031.inc</A>"<A NAME="HALO_1031.inc_51"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1469'>
#endif<a name='1470'>
BENCH_END(exch15)<a name='1471'>
<a name='1472'>
    rk_step_is_onze: if (rk_step1 .eq. 1) then<a name='1473'>
BENCH_START(comp17)<a name='1474'>
        call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_5">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,&amp;<a name='1475'>
&amp;rk_step1,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),&amp;<a name='1476'>
&amp;k_start,k_end )<a name='1477'>
BENCH_END(comp17)<a name='1478'>
<a name='1479'>
BENCH_START(exch16)<a name='1480'>
#ifdef DM_PARALLEL<a name='1481'>
lineno = __LINE__<a name='1482'>
#     include "<A href='../../html_code/include/HALO_1043.inc.html'>HALO_1043.inc</A>"<A NAME="HALO_1043.inc_52"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1483'>
#endif<a name='1484'>
BENCH_END(exch16)<a name='1485'>
<a name='1486'>
BENCH_START(comp18)<a name='1487'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_5">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,&amp;<a name='1488'>
&amp;v_phy,p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,&amp;<a name='1489'>
&amp;rqccuten,rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='1490'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1491'>
BENCH_END(comp18)<a name='1492'>
      if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='1493'>
<a name='1494'>
BENCH_START(exch17)<a name='1495'>
#ifdef DM_PARALLEL<a name='1496'>
lineno = __LINE__<a name='1497'>
<a name='1498'>
<a name='1499'>
<a name='1500'>
<a name='1501'>
#endif<a name='1502'>
BENCH_END(exch17)<a name='1503'>
<a name='1504'>
BENCH_START(comp19)<a name='1505'>
          call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_5">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='1506'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='1507'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='1508'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1509'>
BENCH_END(comp19)<a name='1510'>
      endif<a name='1511'>
    endif rk_step_is_onze<a name='1512'>
<a name='1513'>
BENCH_START(exch18)<a name='1514'>
#ifdef DM_PARALLEL<a name='1515'>
lineno = __LINE__<a name='1516'>
#     include "<A href='../../html_code/include/HALO_1073.inc.html'>HALO_1073.inc</A>"<A NAME="HALO_1073.inc_53"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1517'>
<a name='1518'>
<a name='1519'>
<a name='1520'>
#endif<a name='1521'>
BENCH_END(exch18)<a name='1522'>
<a name='1523'>
WRITE(wrf_err_message,*) 'DEBUG:  calling rk_tendency before_small_stepzt, rk_step1 = ',rk_step1<a name='1524'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_19">( 10, TRIM(wrf_err_message) )<a name='1525'>
BENCH_START(comp7772)<a name='1526'>
      call <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_5">( config_flags,rk_step1,ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,&amp;<a name='1527'>
&amp;mu_tend,u_save,v_save,w_save,ph_save,t_save,mu_save,rthften,ru,rv,rw,ww,u_2,v_2,w_2,t_2,ph_2,u_1,v_1,w_1,t_1,ph_1,&amp;<a name='1528'>
&amp;h_diabatic,phb,t_init,mu_2,mut,muu,muv,mub,al,alt,p,pb,php,cqu,cqv,cqw,u_base,v_base,t_base,qv_base,z_base,msfu,msfv,msft,f,&amp;<a name='1529'>
&amp;e,sina,cosa,fnm,fnp,rdn,rdnw,dt,rdx,rdy,khdif,kvdif,xkmhd,cf1,cf2,cf3,cfn,cfn1,num_3d_m,non_hydrostatic,leapfrog,ids,ide,&amp;<a name='1530'>
&amp;jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1531'>
BENCH_END(comp7772)<a name='1532'>
BENCH_START(comp20)<a name='1533'>
<a name='1534'>
      if ((config_flags%specified .or. config_flags%nested) .and. rk_step1 .eq. 1) then<a name='1535'>
        call <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_DRY'>relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_DRY_5">( config_flags,u_save,v_save,ph_save,t_save,w_save,mu_tend,ru,rv,ph_2,t_2,w_2,mu_2,mut,u_b,v_b,ph_b,t_b,&amp;<a name='1536'>
&amp;w_b,mu_b,u_bt,v_bt,ph_bt,t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1537'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1538'>
      endif<a name='1539'>
      call <A href='../../html_code/dyn_em/module_em.F.html#RK_ADDTEND_DRY'>rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_ADDTEND_DRY_5">( ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,u_save,v_save,w_save,&amp;<a name='1540'>
&amp;ph_save,t_save,rk_step1,h_diabatic,mut,msft,msfu,msfv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,&amp;<a name='1541'>
&amp;kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1542'>
      if (config_flags%specified .or. config_flags%nested) then<a name='1543'>
        call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_DRY'>spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_DRY_5">( config_flags,ru_tend,rv_tend,ph_tend,t_tend,rw_tend,mu_tend,u_b,v_b,ph_b,t_b,w_b,mu_b,u_bt,v_bt,ph_bt,&amp;<a name='1544'>
&amp;t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,&amp;<a name='1545'>
&amp;kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1546'>
      endif<a name='1547'>
<a name='1548'>
<a name='1549'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_PREP'>small_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_PREP_5">( u_1,u_2,v_1,v_2,w_1,w_2,t_1,t_2,ph_1,ph_2,mub,mu_1,mu_2,muu,muus,muv,muvs,mut,muts,mudf,u_save,v_save,&amp;<a name='1550'>
&amp;w_save,t_save,ph_save,mu_save,ww,ww1,dnw,c2a,pb,p,alt,msfu,msfv,msft,rk_step1,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,&amp;<a name='1551'>
&amp;jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1552'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_7">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,0,ids,ide,jds,jde,kds,kde,&amp;<a name='1553'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1554'>
      if (non_hydrostatic) then<a name='1555'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_COEF_W'>calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_COEF_W_5">( a,alpha,gamma,mut,cqw,rdn,rdnw,c2a,dts,g,epssm,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='1556'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1557'>
      endif<a name='1558'>
BENCH_END(comp20)<a name='1559'>
<a name='1560'>
BENCH_START(exch19)<a name='1561'>
#ifdef DM_PARALLEL<a name='1562'>
lineno = __LINE__<a name='1563'>
#      include "<A href='../../html_code/include/HALO_1114.inc.html'>HALO_1114.inc</A>"<A NAME="HALO_1114.inc_54"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1564'>
<a name='1565'>
#endif<a name='1566'>
BENCH_END(exch19)<a name='1567'>
<a name='1568'>
    small_stepzt: do iteration = 1, number_of_small_timesteps<a name='1569'>
WRITE(wrf_err_message,*) 'DEBUG:  begin small_stepzt, iteration = ',iteration<a name='1570'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_20">( 10, TRIM(wrf_err_message) )<a name='1571'>
<a name='1572'>
BENCH_START(comp21)<a name='1573'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_UV'>advance_uv</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_UV_5">( u_2,ru_tend,v_2,rv_tend,p,pb,ph_2,php,alt,al,mu_2,muu,cqu,muv,cqv,mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,&amp;<a name='1574'>
&amp;emdiv,rdnw,config_flags,spec_zone,non_hydrostatic,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='1575'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1576'>
        if (config_flags%specified .or. config_flags%nested) then<a name='1577'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_15">( u_2,ru_tend,dts_rk,'u',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='1578'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1579'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_16">( v_2,rv_tend,dts_rk,'v',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='1580'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1581'>
        endif<a name='1582'>
BENCH_END(comp21)<a name='1583'>
<a name='1584'>
<a name='1585'>
BENCH_START(exch20)<a name='1586'>
#ifdef DM_PARALLEL<a name='1587'>
lineno = __LINE__<a name='1588'>
#     include "<A href='../../html_code/include/HALO_1135.inc.html'>HALO_1135.inc</A>"<A NAME="HALO_1135.inc_55"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1589'>
#endif<a name='1590'>
BENCH_END(exch20)<a name='1591'>
<a name='1592'>
BENCH_START(comp22)<a name='1593'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_MU_T'>advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_MU_T_5">( ww,ww1,u_2,u_save,v_2,v_save,mu_2,mut,muave,muts,muu,muv,mudf,ru_m,rv_m,ww_m,t_2,t_save,t_2save,t_tend,&amp;<a name='1594'>
&amp;mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,msfv,msft,iteration,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='1595'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1596'>
BENCH_END(comp22)<a name='1597'>
<a name='1598'>
BENCH_START(exch21)<a name='1599'>
#ifdef DM_PARALLEL<a name='1600'>
lineno = __LINE__<a name='1601'>
#include "<A href='../../html_code/include/HALO_1146.inc.html'>HALO_1146.inc</A>"<A NAME="HALO_1146.inc_56"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1602'>
<a name='1603'>
<a name='1604'>
<a name='1605'>
<a name='1606'>
#endif<a name='1607'>
BENCH_END(exch21)<a name='1608'>
<a name='1609'>
BENCH_START(comp23)<a name='1610'>
        if (config_flags%specified .or. config_flags%nested) then<a name='1611'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_17">( t_2,t_tend,dts_rk,'t',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='1612'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1613'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_18">( mu_2,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='1614'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='1615'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_19">( muts,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='1616'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='1617'>
        endif<a name='1618'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SUMFLUX'>sumflux</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUMFLUX_5">( u_2,v_2,ww,u_save,v_save,ww1,muu,muv,ru_m,rv_m,ww_m,epssm,msfu,msfv,iteration,number_of_small_timesteps,ids,&amp;<a name='1619'>
&amp;ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1620'>
        if (non_hydrostatic) then<a name='1621'>
          call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_W'>advance_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_W_5">( w_2,rw_tend,ww,u_2,v_2,mu_2,mut,muave,muts,t_2save,t_2,t_save,ph_2,ph_save,phb,ph_tend,ht,c2a,cqw,alt,&amp;<a name='1622'>
&amp;alb,a,alpha,gamma,rdx,rdy,dts,t0,epssm,dnw,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,ide,jds,jde,kds,kde,ims,&amp;<a name='1623'>
&amp;ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1624'>
        endif<a name='1625'>
        if (config_flags%specified .or. config_flags%nested) then<a name='1626'>
          if (non_hydrostatic) then<a name='1627'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDYUPDATE_PH'>spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_PH_5">( ph_save,ph_2,ph_tend,mu_tend,muts,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,&amp;<a name='1628'>
&amp;ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1629'>
            if (config_flags%specified) then<a name='1630'>
              call <A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY'>zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_GRAD_BDY_3">( w_2,'w',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,&amp;<a name='1631'>
&amp;kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1632'>
            else<a name='1633'>
              call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_20">( w_2,rw_tend,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='1634'>
&amp;ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1635'>
            endif<a name='1636'>
          endif<a name='1637'>
        endif<a name='1638'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_8">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,iteration,ids,ide,jds,&amp;<a name='1639'>
&amp;jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1640'>
BENCH_END(comp23)<a name='1641'>
<a name='1642'>
<a name='1643'>
BENCH_START(exch22)<a name='1644'>
#ifdef DM_PARALLEL<a name='1645'>
lineno = __LINE__<a name='1646'>
#      include "<A href='../../html_code/include/HALO_1189.inc.html'>HALO_1189.inc</A>"<A NAME="HALO_1189.inc_57"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1647'>
<a name='1648'>
#endif<a name='1649'>
BENCH_END(exch22)<a name='1650'>
<a name='1651'>
    end do small_stepzt<a name='1652'>
BENCH_START(comp24)<a name='1653'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_MU_UV_1'>calc_mu_uv_1</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_MU_UV_1_5">( config_flags,muts,muus,muvs,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='1654'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1655'>
<font color=#447700>!      call small_step_finish( u_2,u_1,v_2,v_1,w_2,w_1,t_2,t_1,ph_2,ph_1,ww,ww1,mu_2,mu_1,mut,muts,muu,muus,muv,muvs,u_save,v_save,&amp;<a name='1656'></font>
<font color=#447700>!&amp;w_save,t_save,ph_save,mu_save,msfu,msfv,msft,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij)&amp;<a name='1657'></font>
<font color=#447700>!&amp;,grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1658'></font>
<font color=#447700>!-----The original<a name='1659'></font>
<a name='1660'>
      CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_FINISH'>small_step_finish</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_FINISH_5">( u_2, u_1, v_2, v_1, w_2, w_1,     &amp;<a name='1661'>
                              t_2, t_1, ph_2, ph_1, ww, ww1,    &amp;<a name='1662'>
                              mu_2, mu_1,                       &amp;<a name='1663'>
                              mut, muts, muu, muus, muv, muvs,  &amp;<a name='1664'>
                              u_save, v_save, w_save,           &amp;<a name='1665'>
                              t_save, ph_save, mu_save,         &amp;<a name='1666'>
                              msfu, msfv, msft,                 &amp;<a name='1667'>
                              h_diabatic,                       &amp;<a name='1668'>
                              number_of_small_timesteps,dts_rk, &amp;<a name='1669'>
                              ids, ide, jds, jde, kds, kde,     &amp;<a name='1670'>
                              ims, ime, jms, jme, kms, kme,     &amp;<a name='1671'>
                              grid%i_start(ij), grid%i_end(ij), &amp;<a name='1672'>
                              grid%j_start(ij), grid%j_end(ij), &amp;<a name='1673'>
                              k_start    , k_end               )<a name='1674'>
BENCH_END(comp24)<a name='1675'>
BENCH_START(exch23)<a name='1676'>
#ifdef DM_PARALLEL<a name='1677'>
lineno = __LINE__<a name='1678'>
#  include "<A href='../../html_code/include/HALO_1219.inc.html'>HALO_1219.inc</A>"<A NAME="HALO_1219.inc_58"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1679'>
#endif<a name='1680'>
BENCH_END(exch23)<a name='1681'>
<a name='1682'>
BENCH_START(comp25)<a name='1683'>
    moist_scalar_advancj: if (num_3d_m .ge. param_first_scalar) then<a name='1684'>
      moist_variable_loou: do im = param_first_scalar, num_3d_m<a name='1685'>
<a name='1686'>
          call <A href='../../html_code/dyn_em/module_em.F.html#RK_SCALAR_TEND'>rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_SCALAR_TEND_7">( im,im,config_flags,rk_step1,dt_rk,ru_m,rv_m,ww_m,mut,alt,moist_1(ims,kms,jms,im),moist_2(ims,kms,&amp;<a name='1687'>
&amp;jms,im),moist_tend(ims,kms,jms,im),advect_tend,rqvften,qv_base, .true. ,fnm,fnp,msfu,msfv,msft,rdx,rdy,rdn,rdnw,khdif,&amp;<a name='1688'>
&amp;kvdif,xkmhd,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),&amp;<a name='1689'>
&amp;grid%j_end(ij),k_start,k_end )<a name='1690'>
          if ((config_flags%specified .or. config_flags%nested) .and. rk_step1 .eq. 1) then<a name='1691'>
            if (im .eq. p_qv) then<a name='1692'>
              call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_15">( moist_tend(ims,kms,jms,im),rqv_b,rqv_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1693'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1694'>
            endif<a name='1695'>
          endif<a name='1696'>
          if (config_flags%nested .and. rk_step1 .eq. 1) then<a name='1697'>
            if (im .eq. p_qc) then<a name='1698'>
              call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_16">( moist_tend(ims,kms,jms,im),rqc_b,rqc_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1699'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1700'>
            else if (im .eq. p_qr) then<a name='1701'>
              call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_17">( moist_tend(ims,kms,jms,im),rqr_b,rqr_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1702'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1703'>
            else if (im .eq. p_qi) then<a name='1704'>
              call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_18">( moist_tend(ims,kms,jms,im),rqi_b,rqi_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1705'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1706'>
            else if (im .eq. p_qs) then<a name='1707'>
              call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_19">( moist_tend(ims,kms,jms,im),rqs_b,rqs_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1708'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1709'>
            else if (im .eq. p_qg) then<a name='1710'>
              call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_20">( moist_tend(ims,kms,jms,im),rqg_b,rqg_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='1711'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1712'>
            endif<a name='1713'>
          endif<a name='1714'>
<a name='1715'>
          call <A href='../../html_code/dyn_em/module_em.F.html#RK_UPDATE_SCALAR'>rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_UPDATE_SCALAR_7">( im,im,moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,im),moist_tend(ims,kms,jms,im),advect_tend,msft,&amp;<a name='1716'>
&amp;mu_1,mu_2,mub,rk_step1,dt_rk,spec_zone,epsts,leapfrog,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='1717'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1718'>
      end do moist_variable_loou<a name='1719'>
    endif moist_scalar_advancj<a name='1720'>
BENCH_END(comp25)<a name='1721'>
<a name='1722'>
BENCH_START(comp26)<a name='1723'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_P_RHO_PHI'>calc_p_rho_phi</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_PHI_6">( moist_2,num_3d_m,al,alb,mu_2,muts,ph_2,p,pb,t_2,p0,t0,znu,dnw,rdnw,rdn,non_hydrostatic,ids,ide,jds,jde,&amp;<a name='1724'>
&amp;kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1725'>
      if ( .not. non_hydrostatic) then<a name='1726'>
        call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#DIAGNOSE_W'>diagnose_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DIAGNOSE_W_6">( ph_tend,ph_2,ph_1,w_2,muts,dt_rk,u_2,v_2,ht,cf1,cf2,cf3,rdx,rdy,msft,ids,ide,jds,jde,kds,kde,ims,ime,jms,&amp;<a name='1727'>
&amp;jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1728'>
      endif<a name='1729'>
BENCH_END(comp26)<a name='1730'>
<a name='1731'>
BENCH_START(exch25)<a name='1732'>
#ifdef DM_PARALLEL<a name='1733'>
lineno = __LINE__<a name='1734'>
#    include "<A href='../../html_code/include/HALO_1278.inc.html'>HALO_1278.inc</A>"<A NAME="HALO_1278.inc_59"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1735'>
<a name='1736'>
<a name='1737'>
<a name='1738'>
#endif<a name='1739'>
BENCH_END(exch25)<a name='1740'>
<a name='1741'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_21"> ( 10 , 'DEBUG:  end runge_kutta_loor' )<a name='1742'>
  end do runge_kutta_loor<a name='1743'>
<a name='1744'>
BENCH_START(exch26)<a name='1745'>
#ifdef DM_PARALLEL<a name='1746'>
lineno = __LINE__<a name='1747'>
#    include "<A href='../../html_code/include/HALO_1290.inc.html'>HALO_1290.inc</A>"<A NAME="HALO_1290.inc_60"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1748'>
#endif<a name='1749'>
BENCH_END(exch26)<a name='1750'>
<a name='1751'>
 else <font color=#447700>! restore_runge_kutta_loor<a name='1752'></font>
BENCH_START(comprestore_runge_kutta_loor_tim)<a name='1753'>
   if (rk_step &gt; 1) then<a name='1754'>
     WRITE(wrf_err_message,*)'DEBUG:  restore_runge_kutta_loor:  rk_step, rk_order = ',rk_step,rk_order<a name='1755'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_22"> ( 10 , TRIM(wrf_err_message) )<a name='1756'>
     <font color=#447700>! restore saved fields<a name='1757'></font>
     CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_6">(rk_step-1, BUF_RK_LOOR)<a name='1758'>
#include "<A href='../../html_code/include/restore_runge_kutta_loor.h.html'>restore_runge_kutta_loor.h</A>"<A NAME="restore_runge_kutta_loor.h_61"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1759'>
     WRITE(wrf_err_message,*)'DEBUG:  restore_runge_kutta_loor:  done for rk_step-1 = ',(rk_step-1)<a name='1760'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_23"> ( 10 , TRIM(wrf_err_message) )<a name='1761'>
   endif<a name='1762'>
BENCH_END(comprestore_runge_kutta_loor_tim)<a name='1763'>
 endif restore_runge_kutta_loor<a name='1764'>
<a name='1765'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='1766'></font>
#ifndef NO_HALO_FIX<a name='1767'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 26<a name='1768'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_62"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1769'>
#endif<a name='1770'>
<a name='1771'>
BENCH_START(comp27)<a name='1772'>
<a name='1773'>
#ifndef FAST_CPY<a name='1774'>
<font color=#447700>!------------------------------<a name='1775'></font>
  ww_m_keep3(:,:,:) = ww_m(:,:,:)<a name='1776'>
  rv_m_keep3(:,:,:) = rv_m(:,:,:)<a name='1777'>
  ru_m_keep3(:,:,:) = ru_m(:,:,:)<a name='1778'>
  a_keep3(:,:,:) = a(:,:,:)<a name='1779'>
  alpha_keep3(:,:,:) = alpha(:,:,:)<a name='1780'>
  gamma_keep3(:,:,:) = gamma(:,:,:)<a name='1781'>
<font color=#447700>!------------------------------<a name='1782'></font>
<a name='1783'>
  xkmhdh(:,:,:) = xkmhd(:,:,:)<a name='1784'>
  w_2h(:,:,:) = w_2(:,:,:)<a name='1785'>
  w_1h(:,:,:) = w_1(:,:,:)<a name='1786'>
  v_2h(:,:,:) = v_2(:,:,:)<a name='1787'>
  v_1h(:,:,:) = v_1(:,:,:)<a name='1788'>
  u_2h(:,:,:) = u_2(:,:,:)<a name='1789'>
  u_1h(:,:,:) = u_1(:,:,:)<a name='1790'>
  t_tendfh(:,:,:) = t_tendf(:,:,:)<a name='1791'>
  t_2h(:,:,:) = t_2(:,:,:)<a name='1792'>
  t_1h(:,:,:) = t_1(:,:,:)<a name='1793'>
  rw_tendfh(:,:,:) = rw_tendf(:,:,:)<a name='1794'>
  rv_tendfh(:,:,:) = rv_tendf(:,:,:)<a name='1795'>
  ru_tendfh(:,:,:) = ru_tendf(:,:,:)<a name='1796'>
  pm1h(:,:,:) = pm1(:,:,:)<a name='1797'>
  ph_tendfh(:,:,:) = ph_tendf(:,:,:)<a name='1798'>
  ph_2h(:,:,:) = ph_2(:,:,:)<a name='1799'>
  ph_1h(:,:,:) = ph_1(:,:,:)<a name='1800'>
  ph(:,:,:) = p(:,:,:)<a name='1801'>
  mu_2h(:,:) = mu_2(:,:)<a name='1802'>
  mu_1h(:,:) = mu_1(:,:)<a name='1803'>
  moist_tendh(:,:,:,:) = moist_tend(:,:,:,:)<a name='1804'>
  moist_2h(:,:,:,:) = moist_2(:,:,:,:)<a name='1805'>
  moist_1h(:,:,:,:) = moist_1(:,:,:,:)<a name='1806'>
  dnwh(:) = dnw(:)<a name='1807'>
  alh(:,:,:) = al(:,:,:)<a name='1808'>
<font color=#447700>!----------------------------------------<a name='1809'></font>
  mudf_ma(:,:) = mudf(:,:)<a name='1810'>
<font color=#447700>!----------------------------------------<a name='1811'></font>
#else<a name='1812'>
<font color=#447700>!------------------------------<a name='1813'></font>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_63">(  ww_m_keep3 , ww_m , n3d_elem )<a name='1814'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_64">(  rv_m_keep3 , rv_m , n3d_elem )<a name='1815'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_65">(  ru_m_keep3 , ru_m , n3d_elem )<a name='1816'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_66">(  a_keep3 , a , n3d_elem )<a name='1817'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_67">(  alpha_keep3 , alpha , n3d_elem )<a name='1818'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_68">(  gamma_keep3 , gamma , n3d_elem )<a name='1819'>
<font color=#447700>!------------------------------<a name='1820'></font>
<a name='1821'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_69">(  xkmhdh , xkmhd , n3d_elem )<a name='1822'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_70">(  w_2h , w_2 , n3d_elem )<a name='1823'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_71">(  w_1h , w_1 , n3d_elem )<a name='1824'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_72">(  v_2h , v_2 , n3d_elem )<a name='1825'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_73">(  v_1h , v_1 , n3d_elem )<a name='1826'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_74">(  u_2h , u_2 , n3d_elem )<a name='1827'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_75">(  u_1h , u_1 , n3d_elem )<a name='1828'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_76">(  t_tendfh , t_tendf , n3d_elem )<a name='1829'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_77">(  t_2h , t_2 , n3d_elem )<a name='1830'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_78">(  t_1h , t_1 , n3d_elem )<a name='1831'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_79">(  rw_tendfh , rw_tendf , n3d_elem )<a name='1832'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_80">(  rv_tendfh , rv_tendf , n3d_elem )<a name='1833'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_81">(  ru_tendfh , ru_tendf , n3d_elem )<a name='1834'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_82">(  pm1h , pm1 , n3d_elem )<a name='1835'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_83">(  ph_tendfh , ph_tendf , n3d_elem )<a name='1836'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_84">(  ph_2h , ph_2 , n3d_elem )<a name='1837'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_85">(  ph_1h , ph_1 , n3d_elem )<a name='1838'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_86">(  ph , p , n3d_elem )<a name='1839'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_87">(  mu_2h , mu_2 , n2d_elem )<a name='1840'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_88">(  mu_1h , mu_1 , n2d_elem )<a name='1841'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_89">(  moist_tendh(ims,kms,jms,2) , moist_tend(ims,kms,jms,2) , n3d_elem * ( num_moist - 1 ) )<a name='1842'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_90">(  moist_2h(ims,kms,jms,2) , moist_2(ims,kms,jms,2) , n3d_elem * ( num_moist - 1 ) )<a name='1843'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_91">(  moist_1h(ims,kms,jms,2) , moist_1(ims,kms,jms,2) , n3d_elem * ( num_moist - 1 ) )<a name='1844'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_92">(  dnwh , dnw , kme-kms+1 )<a name='1845'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_93">(  alh , al , n3d_elem )<a name='1846'>
<font color=#447700>!----------------------------------------<a name='1847'></font>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_94">(  mudf_ma , mudf , n2d_elem )<a name='1848'>
<font color=#447700>!----------------------------------------<a name='1849'></font>
#endif<a name='1850'>
<a name='1851'>
  dtm = dt<a name='1852'>
  if (rk_order .eq. 1) then<a name='1853'>
    if (step_number .ne. 1) then<a name='1854'>
      number_of_small_timesteps = 2*time_step_sound<a name='1855'>
      dt_rk = dt<a name='1856'>
      dtm = 2*dt<a name='1857'>
    else<a name='1858'>
      number_of_small_timesteps = time_step_sound<a name='1859'>
      dt_rk = dt/2.<a name='1860'>
      dtm = dt<a name='1861'>
    endif<a name='1862'>
    dts_rk = dts<a name='1863'>
  else if (rk_order .eq. 2) then<a name='1864'>
    if (rk_step .eq. 1) then<a name='1865'>
      dt_rk = 0.5*dt<a name='1866'>
      dts_rk = dts<a name='1867'>
      number_of_small_timesteps = time_step_sound/2<a name='1868'>
    else<a name='1869'>
      dt_rk = dt<a name='1870'>
      dts_rk = dts<a name='1871'>
      number_of_small_timesteps = time_step_sound<a name='1872'>
    endif<a name='1873'>
  else if (rk_order .eq. 3) then<a name='1874'>
    if (rk_step .eq. 1) then<a name='1875'>
      dt_rk = dt/3.<a name='1876'>
      dts_rk = dt_rk<a name='1877'>
      number_of_small_timesteps = 1<a name='1878'>
    else if (rk_step .eq. 2) then<a name='1879'>
      dt_rk = 0.5*dt<a name='1880'>
      dts_rk = dts<a name='1881'>
      number_of_small_timesteps = time_step_sound/2<a name='1882'>
    else<a name='1883'>
      dt_rk = dt<a name='1884'>
      dts_rk = dts<a name='1885'>
      number_of_small_timesteps = time_step_sound<a name='1886'>
    endif<a name='1887'>
  endif<a name='1888'>
BENCH_END(comp27)<a name='1889'>
<font color=#447700>! recompute : dt_rk,dts_rk,number_of_small_timesteps<a name='1890'></font>
<a name='1891'>
BENCH_START(exch23)<a name='1892'>
#ifdef DM_PARALLEL<a name='1893'>
lineno = __LINE__<a name='1894'>
#    include "<A href='../../html_code/include/HALO_1373.inc.html'>HALO_1373.inc</A>"<A NAME="HALO_1373.inc_63"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1895'>
#endif<a name='1896'>
BENCH_END(exch23)<a name='1897'>
<a name='1898'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='1899'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_step_prep.  <a name='1900'></font>
 restore_rk_step_prepzq: if ( config_flags%remove_rk_step_prep ) then<a name='1901'>
BENCH_START(comprestore_rk_step_prep_tim)<a name='1902'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rk_step_prepzq:  rk_step, rk_order = ',rk_step,rk_order<a name='1903'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_24"> ( 10 , TRIM(wrf_err_message) )<a name='1904'>
   <font color=#447700>! store fields<a name='1905'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_7">(rk_step, BUF_RK_STEP_PREP)<a name='1906'>
#include "<A href='../../html_code/include/restore_rk_step_prep.h.html'>restore_rk_step_prep.h</A>"<A NAME="restore_rk_step_prep.h_64"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1907'>
BENCH_END(comprestore_rk_step_prep_tim)<a name='1908'>
 else  <font color=#447700>! restore_rk_step_prepzq<a name='1909'></font>
<a name='1910'>
BENCH_START(comp28)<a name='1911'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_6">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='1912'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='1913'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1914'>
BENCH_END(comp28)<a name='1915'>
<a name='1916'>
BENCH_START(exch24)<a name='1917'>
#ifdef DM_PARALLEL<a name='1918'>
lineno = __LINE__<a name='1919'>
#    include "<A href='../../html_code/include/HALO_1389.inc.html'>HALO_1389.inc</A>"<A NAME="HALO_1389.inc_65"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1920'>
#endif<a name='1921'>
<a name='1922'>
#ifdef DM_PARALLEL<a name='1923'>
lineno = __LINE__<a name='1924'>
#     include "<A href='../../html_code/include/HALO_1394.inc.html'>HALO_1394.inc</A>"<A NAME="HALO_1394.inc_66"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1925'>
#endif<a name='1926'>
BENCH_END(exch24)<a name='1927'>
<a name='1928'>
 endif restore_rk_step_prepzq<a name='1929'>
<a name='1930'>
BENCH_START(exch24)<a name='1931'>
#ifdef DM_PARALLEL<a name='1932'>
lineno = __LINE__<a name='1933'>
#    include "<A href='../../html_code/include/HALO_1390.inc.html'>HALO_1390.inc</A>"<A NAME="HALO_1390.inc_67"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1934'>
#endif<a name='1935'>
<a name='1936'>
#ifdef DM_PARALLEL<a name='1937'>
lineno = __LINE__<a name='1938'>
#     include "<A href='../../html_code/include/HALO_1394.inc.html'>HALO_1394.inc</A>"<A NAME="HALO_1394.inc_68"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1939'>
#endif<a name='1940'>
BENCH_END(exch24)<a name='1941'>
<a name='1942'>
<font color=#447700>! recompute : alt,cqu,cqv,cqw,mut,muu,muv,php,ru,rv,rw,ww<a name='1943'></font>
  rk_step_is_onzc: if (rk_step .eq. 1) then<a name='1944'>
<a name='1945'>
BENCH_START(comp29)<a name='1946'>
      call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_6">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,rk_step,&amp;<a name='1947'>
&amp;ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1948'>
BENCH_END(comp29)<a name='1949'>
<a name='1950'>
BENCH_START(exch25)<a name='1951'>
#ifdef DM_PARALLEL<a name='1952'>
lineno = __LINE__<a name='1953'>
#     include "<A href='../../html_code/include/HALO_1407.inc.html'>HALO_1407.inc</A>"<A NAME="HALO_1407.inc_69"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1954'>
#endif<a name='1955'>
BENCH_END(exch25)<a name='1956'>
<a name='1957'>
BENCH_START(comp30)<a name='1958'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_6">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,v_phy,&amp;<a name='1959'>
&amp;p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,rqccuten,&amp;<a name='1960'>
&amp;rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='1961'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1962'>
BENCH_END(comp30)<a name='1963'>
<a name='1964'>
BENCH_START(exch26)<a name='1965'>
#ifdef DM_PARALLEL<a name='1966'>
lineno = __LINE__<a name='1967'>
#     include "<A href='../../html_code/include/HALO_1419.inc.html'>HALO_1419.inc</A>"<A NAME="HALO_1419.inc_70"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1968'>
<a name='1969'>
<a name='1970'>
<a name='1971'>
#endif<a name='1972'>
BENCH_END(exch26)<a name='1973'>
<a name='1974'>
BENCH_START(comp31)<a name='1975'>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='1976'>
<a name='1977'>
        call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_6">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='1978'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='1979'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='1980'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1981'>
<a name='1982'>
    endif<a name='1983'>
BENCH_END(comp31)<a name='1984'>
  endif rk_step_is_onzc<a name='1985'>
<font color=#447700>!  recompute : moist_tend,ph_tendf,ru_tendf,rv_tendf,rw_tendf,t_tendf,xk<a name='1986'></font>
<font color=#447700>! mhd<a name='1987'></font>
<a name='1988'>
BENCH_START(exch27)<a name='1989'>
#ifdef DM_PARALLEL<a name='1990'>
lineno = __LINE__<a name='1991'>
#     include "<A href='../../html_code/include/HALO_1441.inc.html'>HALO_1441.inc</A>"<A NAME="HALO_1441.inc_71"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1992'>
<a name='1993'>
<a name='1994'>
<a name='1995'>
#endif<a name='1996'>
BENCH_END(exch27)<a name='1997'>
WRITE(wrf_err_message,*) 'DEBUG:  calling rk_tendency before_small_stepzq, rk_step = ',rk_step<a name='1998'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_25">( 10, TRIM(wrf_err_message) )<a name='1999'>
<a name='2000'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='2001'></font>
<font color=#447700>! TBH:  Restore fields computed earlier between the call to rk_tendency and <a name='2002'></font>
<font color=#447700>! TBH:  the end of small_stepu loop.  <a name='2003'></font>
 restore_rktend_thru_sszq: if ( config_flags%remove_rktend_thru_ss ) then<a name='2004'>
BENCH_START(comprestore_rktend_thru_ss_tim)<a name='2005'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktend_thru_sszq:  rk_step, rk_order = ',rk_step,rk_order<a name='2006'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_26"> ( 10 , TRIM(wrf_err_message) )<a name='2007'>
   <font color=#447700>! store fields<a name='2008'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_8">(rk_step, BUF_RKTEND_THRU_SS)<a name='2009'>
#include "<A href='../../html_code/include/restore_rktend_thru_ss.h.html'>restore_rktend_thru_ss.h</A>"<A NAME="restore_rktend_thru_ss.h_72"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2010'>
BENCH_END(comprestore_rktend_thru_ss_tim)<a name='2011'>
 else  <font color=#447700>! restore_rktend_thru_sszq<a name='2012'></font>
<a name='2013'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='2014'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_tendency.  <a name='2015'></font>
 restore_rktendzq: if ( config_flags%remove_rktend ) then<a name='2016'>
BENCH_START(comprestore_rktend_tim)<a name='2017'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktendzq:  rk_step, rk_order = ',rk_step,rk_order<a name='2018'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_27"> ( 10 , TRIM(wrf_err_message) )<a name='2019'>
   <font color=#447700>! store fields<a name='2020'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_9">(rk_step, BUF_RKTEND)<a name='2021'>
#include "<A href='../../html_code/include/restore_rktend.h.html'>restore_rktend.h</A>"<A NAME="restore_rktend.h_73"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2022'>
BENCH_END(comprestore_rktend_tim)<a name='2023'>
 else  <font color=#447700>! restore_rktendzq<a name='2024'></font>
<a name='2025'>
BENCH_START(comp7773)<a name='2026'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_6">( config_flags,rk_step,ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,&amp;<a name='2027'>
&amp;mu_tend,u_save,v_save,w_save,ph_save,t_save,mu_save,rthften,ru,rv,rw,ww,u_2,v_2,w_2,t_2,ph_2,u_1,v_1,w_1,t_1,ph_1,h_diabatic,&amp;<a name='2028'>
&amp;phb,t_init,mu_2,mut,muu,muv,mub,al,alt,p,pb,php,cqu,cqv,cqw,u_base,v_base,t_base,qv_base,z_base,msfu,msfv,msft,f,e,sina,cosa,&amp;<a name='2029'>
&amp;fnm,fnp,rdn,rdnw,dt,rdx,rdy,khdif,kvdif,xkmhd,cf1,cf2,cf3,cfn,cfn1,num_3d_m,non_hydrostatic,leapfrog,ids,ide,jds,jde,kds,kde,&amp;<a name='2030'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2031'>
BENCH_END(comp7773)<a name='2032'>
<a name='2033'>
 endif restore_rktendzq<a name='2034'>
<a name='2035'>
<font color=#447700>!  end do<a name='2036'></font>
BENCH_START(comp32)<a name='2037'>
<a name='2038'>
<font color=#447700>!  recompute : cqw,mu_tend,ph_save,ph_tend,ru_tend,ru_tendf,rv_tend,rv_t<a name='2039'></font>
<font color=#447700>! endf,rw_tend,rw_tendf,t_save,t_tend,t_tendf,u_save,v_save,w_save<a name='2040'></font>
<font color=#447700>!  do ij = 1, grid%num_tiles<a name='2041'></font>
    if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='2042'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_DRY'>relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_DRY_6">( config_flags,u_save,v_save,ph_save,t_save,w_save,mu_tend,ru,rv,ph_2,t_2,w_2,mu_2,mut,u_b,v_b,ph_b,t_b,&amp;<a name='2043'>
&amp;w_b,mu_b,u_bt,v_bt,ph_bt,t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,kde,&amp;<a name='2044'>
&amp;ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2045'>
    endif<a name='2046'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_ADDTEND_DRY'>rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_ADDTEND_DRY_6">( ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,u_save,v_save,w_save,&amp;<a name='2047'>
&amp;ph_save,t_save,rk_step,h_diabatic,mut,msft,msfu,msfv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='2048'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2049'>
    if (config_flags%specified .or. config_flags%nested) then<a name='2050'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_DRY'>spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_DRY_6">( config_flags,ru_tend,rv_tend,ph_tend,t_tend,rw_tend,mu_tend,u_b,v_b,ph_b,t_b,w_b,mu_b,u_bt,v_bt,ph_bt,&amp;<a name='2051'>
&amp;t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='2052'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2053'>
    endif<a name='2054'>
<a name='2055'>
<font color=#447700>! recompute : mu_tend,ph_tend,ru_tend,rv_tend,rw_tend,t_tend<a name='2056'></font>
<a name='2057'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_PREP'>small_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_PREP_6">( u_1,u_2,v_1,v_2,w_1,w_2,t_1,t_2,ph_1,ph_2,mub,mu_1,mu_2,muu,muus,muv,muvs,mut,muts,mudf,u_save,v_save,&amp;<a name='2058'>
&amp;w_save,t_save,ph_save,mu_save,ww,ww1,dnw,c2a,pb,p,alt,msfu,msfv,msft,rk_step,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='2059'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2060'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_9">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,0,ids,ide,jds,jde,kds,kde,&amp;<a name='2061'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2062'>
    if (non_hydrostatic) then<a name='2063'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_COEF_W'>calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_COEF_W_6">( a,alpha,gamma,mut,cqw,rdn,rdnw,c2a,dts,g,epssm,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='2064'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2065'>
    endif<a name='2066'>
BENCH_END(comp32)<a name='2067'>
<a name='2068'>
BENCH_START(exch28)<a name='2069'>
#ifdef DM_PARALLEL<a name='2070'>
lineno = __LINE__<a name='2071'>
#      include "<A href='../../html_code/include/HALO_1487.inc.html'>HALO_1487.inc</A>"<A NAME="HALO_1487.inc_74"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2072'>
<a name='2073'>
#endif<a name='2074'>
BENCH_END(exch28)<a name='2075'>
<a name='2076'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='2077'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by small_stepu loop.  <a name='2078'></font>
 restore_small_stepzq: if (config_flags%remove_small_step) then<a name='2079'>
BENCH_START(comprestore_small_step_tim)<a name='2080'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_small_stepzq:  rk_step, rk_order = ',rk_step,rk_order<a name='2081'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_28"> ( 10 , TRIM(wrf_err_message) )<a name='2082'>
   <font color=#447700>! store fields<a name='2083'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_10">(rk_step, BUF_SMALL_STEP)<a name='2084'>
#include "<A href='../../html_code/include/restore_small_step.h.html'>restore_small_step.h</A>"<A NAME="restore_small_step.h_75"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2085'>
BENCH_END(comprestore_small_step_tim)<a name='2086'>
 else  <font color=#447700>! restore_small_stepzq<a name='2087'></font>
<a name='2088'>
  small_stepzq: do iteration = 1, number_of_small_timesteps<a name='2089'>
WRITE(wrf_err_message,*) 'DEBUG:  begin small_stepzq, iteration = ',iteration<a name='2090'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_29">( 10, TRIM(wrf_err_message) )<a name='2091'>
<a name='2092'>
BENCH_START(comp33)<a name='2093'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_UV'>advance_uv</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_UV_6">( u_2,ru_tend,v_2,rv_tend,p,pb,ph_2,php,alt,al,mu_2,muu,cqu,muv,cqv,mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,&amp;<a name='2094'>
&amp;emdiv,rdnw,config_flags,spec_zone,non_hydrostatic,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='2095'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2096'>
      if (config_flags%specified .or. config_flags%nested) then<a name='2097'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_21">( u_2,ru_tend,dts_rk,'u',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='2098'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2099'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_22">( v_2,rv_tend,dts_rk,'v',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='2100'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2101'>
      endif<a name='2102'>
BENCH_END(comp33)<a name='2103'>
<a name='2104'>
BENCH_START(exch29)<a name='2105'>
#ifdef DM_PARALLEL<a name='2106'>
lineno = __LINE__<a name='2107'>
#     include "<A href='../../html_code/include/HALO_1507.inc.html'>HALO_1507.inc</A>"<A NAME="HALO_1507.inc_76"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2108'>
#endif<a name='2109'>
BENCH_END(exch29)<a name='2110'>
<a name='2111'>
BENCH_START(comp34)<a name='2112'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_MU_T'>advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_MU_T_6">( ww,ww1,u_2,u_save,v_2,v_save,mu_2,mut,muave,muts,muu,muv,mudf,ru_m,rv_m,ww_m,t_2,t_save,t_2save,t_tend,&amp;<a name='2113'>
&amp;mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,msfv,msft,iteration,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='2114'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2115'>
BENCH_END(comp34)<a name='2116'>
<a name='2117'>
BENCH_START(exch30)<a name='2118'>
#ifdef DM_PARALLEL<a name='2119'>
lineno = __LINE__<a name='2120'>
#include "<A href='../../html_code/include/HALO_1518.inc.html'>HALO_1518.inc</A>"<A NAME="HALO_1518.inc_77"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2121'>
<a name='2122'>
<a name='2123'>
<a name='2124'>
<a name='2125'>
#endif<a name='2126'>
BENCH_END(exch30)<a name='2127'>
<a name='2128'>
BENCH_START(comp35)<a name='2129'>
      if (config_flags%specified .or. config_flags%nested) then<a name='2130'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_23">( t_2,t_tend,dts_rk,'t',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='2131'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2132'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_24">( mu_2,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='2133'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='2134'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_25">( muts,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='2135'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='2136'>
      endif<a name='2137'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SUMFLUX'>sumflux</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUMFLUX_6">( u_2,v_2,ww,u_save,v_save,ww1,muu,muv,ru_m,rv_m,ww_m,epssm,msfu,msfv,iteration,number_of_small_timesteps,ids,&amp;<a name='2138'>
&amp;ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2139'>
      if (non_hydrostatic) then<a name='2140'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_W'>advance_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_W_6">( w_2,rw_tend,ww,u_2,v_2,mu_2,mut,muave,muts,t_2save,t_2,t_save,ph_2,ph_save,phb,ph_tend,ht,c2a,cqw,alt,alb,&amp;<a name='2141'>
&amp;a,alpha,gamma,rdx,rdy,dts,t0,epssm,dnw,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,&amp;<a name='2142'>
&amp;jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2143'>
      endif<a name='2144'>
      if (config_flags%specified .or. config_flags%nested) then<a name='2145'>
        if (non_hydrostatic) then<a name='2146'>
          call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDYUPDATE_PH'>spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_PH_6">( ph_save,ph_2,ph_tend,mu_tend,muts,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,&amp;<a name='2147'>
&amp;ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2148'>
          if (config_flags%specified) then<a name='2149'>
            call <A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY'>zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_GRAD_BDY_4">( w_2,'w',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,&amp;<a name='2150'>
&amp;kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2151'>
          else<a name='2152'>
            call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_26">( w_2,rw_tend,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='2153'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2154'>
          endif<a name='2155'>
        endif<a name='2156'>
      endif<a name='2157'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_10">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,iteration,ids,ide,jds,jde,&amp;<a name='2158'>
&amp;kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2159'>
BENCH_END(comp35)<a name='2160'>
<a name='2161'>
BENCH_START(exch31)<a name='2162'>
#ifdef DM_PARALLEL<a name='2163'>
lineno = __LINE__<a name='2164'>
#      include "<A href='../../html_code/include/HALO_1560.inc.html'>HALO_1560.inc</A>"<A NAME="HALO_1560.inc_78"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2165'>
<a name='2166'>
#endif<a name='2167'>
BENCH_END(exch31)<a name='2168'>
<a name='2169'>
  end do small_stepzq<a name='2170'>
<a name='2171'>
 endif restore_small_stepzq<a name='2172'>
<a name='2173'>
 endif restore_rktend_thru_sszq<a name='2174'>
<a name='2175'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='2176'></font>
#ifndef NO_HALO_FIX<a name='2177'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 35<a name='2178'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_79"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2179'>
#endif<a name='2180'>
<a name='2181'>
<font color=#447700>! recompute : mu_2,mudf,muts,ph_2,pm1,ru_m,rv_m,t_2,u_2,v_2,w_2,ww_m<a name='2182'></font>
<a name='2183'>
BENCH_START(comp36)<a name='2184'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_MU_UV_1'>calc_mu_uv_1</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_MU_UV_1_6">( config_flags,muts,muus,muvs,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='2185'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2186'>
<font color=#447700>!    call small_step_finish( u_2,u_1,v_2,v_1,w_2,w_1,t_2,t_1,ph_2,ph_1,ww,ww1,mu_2,mu_1,mut,muts,muu,muus,muv,muvs,u_save,v_save,&amp;<a name='2187'></font>
<font color=#447700>!&amp;w_save,t_save,ph_save,mu_save,msfu,msfv,msft,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='2188'></font>
<font color=#447700>!&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2189'></font>
<font color=#447700>!-----The original<a name='2190'></font>
      CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_FINISH'>small_step_finish</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_FINISH_6">( u_2, u_1, v_2, v_1, w_2, w_1,     &amp;<a name='2191'>
                              t_2, t_1, ph_2, ph_1, ww, ww1,    &amp;<a name='2192'>
                              mu_2, mu_1,                       &amp;<a name='2193'>
                              mut, muts, muu, muus, muv, muvs,  &amp;<a name='2194'>
                              u_save, v_save, w_save,           &amp;<a name='2195'>
                              t_save, ph_save, mu_save,         &amp;<a name='2196'>
                              msfu, msfv, msft,                 &amp;<a name='2197'>
                              h_diabatic,                       &amp;<a name='2198'>
                              number_of_small_timesteps,dts_rk, &amp;<a name='2199'>
                              ids, ide, jds, jde, kds, kde,     &amp;<a name='2200'>
                              ims, ime, jms, jme, kms, kme,     &amp;<a name='2201'>
                              grid%i_start(ij), grid%i_end(ij), &amp;<a name='2202'>
                              grid%j_start(ij), grid%j_end(ij), &amp;<a name='2203'>
                              k_start    , k_end               )<a name='2204'>
BENCH_END(comp36)<a name='2205'>
<a name='2206'>
BENCH_START(exch32)<a name='2207'>
#ifdef DM_PARALLEL<a name='2208'>
lineno = __LINE__<a name='2209'>
#  include "<A href='../../html_code/include/HALO_1592.inc.html'>HALO_1592.inc</A>"<A NAME="HALO_1592.inc_80"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2210'>
#endif<a name='2211'>
BENCH_END(exch32)<a name='2212'>
<a name='2213'>
<font color=#447700>! recompute : mu_2,ph_2,t_2<a name='2214'></font>
<a name='2215'>
BENCH_START(comp37)<a name='2216'>
  moist_scalar_advanch: if (num_3d_m .ge. param_first_scalar) then<a name='2217'>
    moist_variable_loos: do im = param_first_scalar, num_3d_m<a name='2218'>
<a name='2219'>
        call <A href='../../html_code/dyn_em/module_em.F.html#RK_SCALAR_TEND'>rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_SCALAR_TEND_8">( im,im,config_flags,rk_step,dt_rk,ru_m,rv_m,ww_m,mut,alt,moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,&amp;<a name='2220'>
&amp;im),moist_tend(ims,kms,jms,im),advect_tend,rqvften,qv_base, .true. ,fnm,fnp,msfu,msfv,msft,rdx,rdy,rdn,rdnw,khdif,kvdif,&amp;<a name='2221'>
&amp;xkmhd,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%&amp;<a name='2222'>
&amp;j_end(ij),k_start,k_end )<a name='2223'>
        if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='2224'>
          if (im .eq. p_qv) then<a name='2225'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_21">( moist_tend(ims,kms,jms,im),rqv_b,rqv_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2226'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2227'>
          endif<a name='2228'>
        endif<a name='2229'>
        if (config_flags%nested .and. rk_step .eq. 1) then<a name='2230'>
          if (im .eq. p_qc) then<a name='2231'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_22">( moist_tend(ims,kms,jms,im),rqc_b,rqc_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2232'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2233'>
          else if (im .eq. p_qr) then<a name='2234'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_23">( moist_tend(ims,kms,jms,im),rqr_b,rqr_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2235'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2236'>
          else if (im .eq. p_qi) then<a name='2237'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_24">( moist_tend(ims,kms,jms,im),rqi_b,rqi_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2238'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2239'>
          else if (im .eq. p_qs) then<a name='2240'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_25">( moist_tend(ims,kms,jms,im),rqs_b,rqs_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2241'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2242'>
          else if (im .eq. p_qg) then<a name='2243'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_26">( moist_tend(ims,kms,jms,im),rqg_b,rqg_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2244'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2245'>
          endif<a name='2246'>
        endif<a name='2247'>
<a name='2248'>
        call <A href='../../html_code/dyn_em/module_em.F.html#RK_UPDATE_SCALAR'>rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_UPDATE_SCALAR_8">( im,im,moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,im),moist_tend(ims,kms,jms,im),advect_tend,msft,&amp;<a name='2249'>
&amp;mu_1,mu_2,mub,rk_step,dt_rk,spec_zone,epsts,leapfrog,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='2250'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2251'>
<a name='2252'>
    end do moist_variable_loos<a name='2253'>
  endif moist_scalar_advanch<a name='2254'>
BENCH_END(comp37)<a name='2255'>
<a name='2256'>
<font color=#447700>! recompute : moist_2<a name='2257'></font>
<a name='2258'>
BENCH_START(comp37_calc_p_rho_phi)<a name='2259'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_P_RHO_PHI'>calc_p_rho_phi</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_PHI_7">( moist_2,num_3d_m,al,alb,mu_2,muts,ph_2,p,pb,t_2,p0,t0,znu,dnw,rdnw,rdn,non_hydrostatic,ids,ide,jds,jde,&amp;<a name='2260'>
&amp;kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2261'>
BENCH_END(comp37_calc_p_rho_phi)<a name='2262'>
<a name='2263'>
BENCH_START(comp37_a_diagnose_w)<a name='2264'>
    if ( .not. non_hydrostatic) then<a name='2265'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_DIAGNOSE_W'>a_diagnose_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_DIAGNOSE_W_3">( ph_tend,a_ph_tend,a_ph_2,a_ph_1,a_w_2,muts,a_muts,dt_rk,a_u_2,a_v_2,ht,cf1,cf2,cf3,rdx,rdy,msft,ide,jde,&amp;<a name='2266'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_end )<a name='2267'>
    endif<a name='2268'>
BENCH_END(comp37_a_diagnose_w)<a name='2269'>
<a name='2270'>
BENCH_START(comp37_a_calc_p_rho_phi)<a name='2271'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALC_P_RHO_PHI'>a_calc_p_rho_phi</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_P_RHO_PHI_3">( moist_2,a_moist_2,num_3d_m,al,a_al,alb,mu_2,a_mu_2,muts,a_muts,ph_2,a_ph_2,p,a_p,pb,t_2,a_t_2,p0,t0,dnw,&amp;<a name='2272'>
&amp;rdnw,rdn,non_hydrostatic,ide,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),&amp;<a name='2273'>
&amp;k_start,k_end )<a name='2274'>
BENCH_END(comp37_a_calc_p_rho_phi)<a name='2275'>
<a name='2276'>
BENCH_START(exch33)<a name='2277'>
#ifdef DM_PARALLEL<a name='2278'>
lineno = __LINE__<a name='2279'>
#    include "<A href='../../html_code/include/HALO_1654.inc.html'>HALO_1654.inc</A>"<A NAME="HALO_1654.inc_81"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2280'>
<a name='2281'>
<a name='2282'>
<a name='2283'>
<a name='2284'>
<a name='2285'>
#endif<a name='2286'>
<a name='2287'>
#ifdef DM_PARALLEL<a name='2288'>
lineno = __LINE__<a name='2289'>
#    include "<A href='../../html_code/include/HALO_1664.inc.html'>HALO_1664.inc</A>"<A NAME="HALO_1664.inc_82"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2290'>
#endif<a name='2291'>
BENCH_END(exch33)<a name='2292'>
<a name='2293'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='2294'></font>
#ifndef NO_HALO_FIX<a name='2295'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 37<a name='2296'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_83"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2297'>
#endif<a name='2298'>
<a name='2299'>
<font color=#447700>!------------------------------<a name='2300'></font>
<font color=#447700>!------------------------------<a name='2301'></font>
<a name='2302'>
BENCH_START(comp38)<a name='2303'>
#ifndef FAST_CPY<a name='2304'>
  ww_m(:,:,:) = ww_m_keep3(:,:,:)<a name='2305'>
  rv_m(:,:,:) = rv_m_keep3(:,:,:)<a name='2306'>
  ru_m(:,:,:) = ru_m_keep3(:,:,:)<a name='2307'>
  a(:,:,:) = a_keep3(:,:,:)<a name='2308'>
  alpha(:,:,:) = alpha_keep3(:,:,:)<a name='2309'>
  gamma(:,:,:) = gamma_keep3(:,:,:)<a name='2310'>
<font color=#447700>!------------------------------<a name='2311'></font>
<a name='2312'>
  xkmhd(:,:,:) = xkmhdh(:,:,:)<a name='2313'>
  w_2(:,:,:) = w_2h(:,:,:)<a name='2314'>
  w_1(:,:,:) = w_1h(:,:,:)<a name='2315'>
  v_2(:,:,:) = v_2h(:,:,:)<a name='2316'>
  v_1(:,:,:) = v_1h(:,:,:)<a name='2317'>
  u_2(:,:,:) = u_2h(:,:,:)<a name='2318'>
  u_1(:,:,:) = u_1h(:,:,:)<a name='2319'>
  t_tendf(:,:,:) = t_tendfh(:,:,:)<a name='2320'>
  t_2(:,:,:) = t_2h(:,:,:)<a name='2321'>
  t_1(:,:,:) = t_1h(:,:,:)<a name='2322'>
  rw_tendf(:,:,:) = rw_tendfh(:,:,:)<a name='2323'>
  rv_tendf(:,:,:) = rv_tendfh(:,:,:)<a name='2324'>
  ru_tendf(:,:,:) = ru_tendfh(:,:,:)<a name='2325'>
  pm1(:,:,:) = pm1h(:,:,:)<a name='2326'>
  ph_tendf(:,:,:) = ph_tendfh(:,:,:)<a name='2327'>
  ph_2(:,:,:) = ph_2h(:,:,:)<a name='2328'>
  ph_1(:,:,:) = ph_1h(:,:,:)<a name='2329'>
  p(:,:,:) = ph(:,:,:)<a name='2330'>
  mu_2(:,:) = mu_2h(:,:)<a name='2331'>
  mu_1(:,:) = mu_1h(:,:)<a name='2332'>
  moist_tend(:,:,:,:) = moist_tendh(:,:,:,:)<a name='2333'>
  moist_2(:,:,:,:) = moist_2h(:,:,:,:)<a name='2334'>
  moist_1(:,:,:,:) = moist_1h(:,:,:,:)<a name='2335'>
  dnw(:) = dnwh(:)<a name='2336'>
  al(:,:,:) = alh(:,:,:)<a name='2337'>
<font color=#447700>!----------------------------------------<a name='2338'></font>
  mudf(:,:) = mudf_ma(:,:)<a name='2339'>
<font color=#447700>!----------------------------------------<a name='2340'></font>
#else<a name='2341'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_95">(  ww_m , ww_m_keep3 , n3d_elem ) <a name='2342'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_96">(  rv_m , rv_m_keep3 , n3d_elem ) <a name='2343'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_97">(  ru_m , ru_m_keep3 , n3d_elem ) <a name='2344'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_98">(  a , a_keep3 , n3d_elem ) <a name='2345'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_99">(  alpha , alpha_keep3 , n3d_elem ) <a name='2346'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_100">(  gamma , gamma_keep3 , n3d_elem ) <a name='2347'>
<font color=#447700>!------------------------------<a name='2348'></font>
<a name='2349'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_101">(  xkmhd , xkmhdh , n3d_elem ) <a name='2350'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_102">(  w_2 , w_2h , n3d_elem ) <a name='2351'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_103">(  w_1 , w_1h , n3d_elem ) <a name='2352'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_104">(  v_2 , v_2h , n3d_elem ) <a name='2353'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_105">(  v_1 , v_1h , n3d_elem ) <a name='2354'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_106">(  u_2 , u_2h , n3d_elem ) <a name='2355'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_107">(  u_1 , u_1h , n3d_elem ) <a name='2356'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_108">(  t_tendf , t_tendfh , n3d_elem ) <a name='2357'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_109">(  t_2 , t_2h , n3d_elem ) <a name='2358'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_110">(  t_1 , t_1h , n3d_elem ) <a name='2359'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_111">(  rw_tendf , rw_tendfh , n3d_elem ) <a name='2360'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_112">(  rv_tendf , rv_tendfh , n3d_elem ) <a name='2361'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_113">(  ru_tendf , ru_tendfh , n3d_elem ) <a name='2362'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_114">(  pm1 , pm1h , n3d_elem ) <a name='2363'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_115">(  ph_tendf , ph_tendfh , n3d_elem ) <a name='2364'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_116">(  ph_2 , ph_2h , n3d_elem ) <a name='2365'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_117">(  ph_1 , ph_1h , n3d_elem ) <a name='2366'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_118">(  p , ph , n3d_elem ) <a name='2367'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_119">(  mu_2 , mu_2h , n2d_elem ) <a name='2368'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_120">(  mu_1 , mu_1h , n2d_elem ) <a name='2369'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_121">(  moist_tend(ims,kms,jms,2) , moist_tendh(ims,kms,jms,2) , n3d_elem * (num_moist-1) ) <a name='2370'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_122">(  moist_2(ims,kms,jms,2) , moist_2h(ims,kms,jms,2) , n3d_elem * (num_moist-1) ) <a name='2371'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_123">(  moist_1(ims,kms,jms,2) , moist_1h(ims,kms,jms,2) , n3d_elem * (num_moist-1) ) <a name='2372'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_124">(  dnw , dnwh , kme-kms+1 ) <a name='2373'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_125">(  al , alh , n3d_elem ) <a name='2374'>
<font color=#447700>!----------------------------------------<a name='2375'></font>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_126">(  mudf , mudf_ma , n2d_elem ) <a name='2376'>
<font color=#447700>!----------------------------------------<a name='2377'></font>
#endif<a name='2378'>
<a name='2379'>
  dtm = dt<a name='2380'>
  if (rk_order .eq. 1) then<a name='2381'>
    if (step_number .ne. 1) then<a name='2382'>
      number_of_small_timesteps = 2*time_step_sound<a name='2383'>
      dt_rk = dt<a name='2384'>
      dtm = 2*dt<a name='2385'>
    else<a name='2386'>
      number_of_small_timesteps = time_step_sound<a name='2387'>
      dt_rk = dt/2.<a name='2388'>
      dtm = dt<a name='2389'>
    endif<a name='2390'>
    dts_rk = dts<a name='2391'>
  else if (rk_order .eq. 2) then<a name='2392'>
    if (rk_step .eq. 1) then<a name='2393'>
      dt_rk = 0.5*dt<a name='2394'>
      dts_rk = dts<a name='2395'>
      number_of_small_timesteps = time_step_sound/2<a name='2396'>
    else<a name='2397'>
      dt_rk = dt<a name='2398'>
      dts_rk = dts<a name='2399'>
      number_of_small_timesteps = time_step_sound<a name='2400'>
    endif<a name='2401'>
  else if (rk_order .eq. 3) then<a name='2402'>
    if (rk_step .eq. 1) then<a name='2403'>
      dt_rk = dt/3.<a name='2404'>
      dts_rk = dt_rk<a name='2405'>
      number_of_small_timesteps = 1<a name='2406'>
    else if (rk_step .eq. 2) then<a name='2407'>
      dt_rk = 0.5*dt<a name='2408'>
      dts_rk = dts<a name='2409'>
      number_of_small_timesteps = time_step_sound/2<a name='2410'>
    else<a name='2411'>
      dt_rk = dt<a name='2412'>
      dts_rk = dts<a name='2413'>
      number_of_small_timesteps = time_step_sound<a name='2414'>
    endif<a name='2415'>
  endif<a name='2416'>
BENCH_END(comp38)<a name='2417'>
<font color=#447700>! recompute : dt_rk,dts_rk,number_of_small_timesteps<a name='2418'></font>
<a name='2419'>
BENCH_START(exch34)<a name='2420'>
#ifdef DM_PARALLEL<a name='2421'>
lineno = __LINE__<a name='2422'>
#   include "<A href='../../html_code/include/HALO_1748.inc.html'>HALO_1748.inc</A>"<A NAME="HALO_1748.inc_84"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2423'>
#endif<a name='2424'>
BENCH_END(exch34)<a name='2425'>
<a name='2426'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='2427'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_step_prep.  <a name='2428'></font>
 restore_rk_step_prepzw: if ( config_flags%remove_rk_step_prep ) then<a name='2429'>
BENCH_START(comprestore_rk_step_prep_tim)<a name='2430'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rk_step_prepzw:  rk_step, rk_order = ',rk_step,rk_order<a name='2431'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_30"> ( 10 , TRIM(wrf_err_message) )<a name='2432'>
   <font color=#447700>! store fields<a name='2433'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_11">(rk_step, BUF_RK_STEP_PREP)<a name='2434'>
#include "<A href='../../html_code/include/restore_rk_step_prep.h.html'>restore_rk_step_prep.h</A>"<A NAME="restore_rk_step_prep.h_85"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2435'>
BENCH_END(comprestore_rk_step_prep_tim)<a name='2436'>
 else  <font color=#447700>! restore_rk_step_prepzw<a name='2437'></font>
<a name='2438'>
BENCH_START(comp39)<a name='2439'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_7">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='2440'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='2441'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2442'>
BENCH_END(comp39)<a name='2443'>
<a name='2444'>
 endif restore_rk_step_prepzw<a name='2445'>
<a name='2446'>
#ifdef DM_PARALLEL<a name='2447'>
lineno = __LINE__<a name='2448'>
#    include "<A href='../../html_code/include/HALO_1757.inc.html'>HALO_1757.inc</A>"<A NAME="HALO_1757.inc_86"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2449'>
#endif<a name='2450'>
<a name='2451'>
BENCH_START(exch35)<a name='2452'>
#ifdef DM_PARALLEL<a name='2453'>
lineno = __LINE__<a name='2454'>
#    include "<A href='../../html_code/include/HALO_1763.inc.html'>HALO_1763.inc</A>"<A NAME="HALO_1763.inc_87"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2455'>
#endif<a name='2456'>
BENCH_END(exch35)<a name='2457'>
<a name='2458'>
<font color=#447700>! recompute : alt,cqu,cqv,cqw,mut,muu,muv,php,ru,rv,rw,ww<a name='2459'></font>
  rk_step_is_onzg: if (rk_step .eq. 1) then<a name='2460'>
<a name='2461'>
BENCH_START(comp40)<a name='2462'>
      call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_7">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,rk_step,&amp;<a name='2463'>
&amp;ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2464'>
BENCH_END(comp40)<a name='2465'>
<a name='2466'>
BENCH_START(exch36)<a name='2467'>
#ifdef DM_PARALLEL<a name='2468'>
lineno = __LINE__<a name='2469'>
<a name='2470'>
#endif<a name='2471'>
BENCH_END(exch36)<a name='2472'>
<a name='2473'>
BENCH_START(comp41)<a name='2474'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_7">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,v_phy,&amp;<a name='2475'>
&amp;p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,rqccuten,&amp;<a name='2476'>
&amp;rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='2477'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2478'>
BENCH_END(comp41)<a name='2479'>
<a name='2480'>
BENCH_START(exch37)<a name='2481'>
#ifdef DM_PARALLEL<a name='2482'>
lineno = __LINE__<a name='2483'>
<a name='2484'>
<a name='2485'>
<a name='2486'>
<a name='2487'>
#endif<a name='2488'>
BENCH_END(exch37)<a name='2489'>
<a name='2490'>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='2491'>
<a name='2492'>
BENCH_START(comp42)<a name='2493'>
        call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_7">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='2494'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='2495'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='2496'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2497'>
BENCH_END(comp42)<a name='2498'>
<a name='2499'>
    endif<a name='2500'>
<a name='2501'>
  endif rk_step_is_onzg<a name='2502'>
<a name='2503'>
BENCH_START(exch38)<a name='2504'>
#ifdef DM_PARALLEL<a name='2505'>
lineno = __LINE__<a name='2506'>
#     include "<A href='../../html_code/include/HALO_1809.inc.html'>HALO_1809.inc</A>"<A NAME="HALO_1809.inc_88"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2507'>
<a name='2508'>
<a name='2509'>
<a name='2510'>
#endif<a name='2511'>
BENCH_END(exch38)<a name='2512'>
<a name='2513'>
<font color=#447700>!  recompute : moist_tend,ph_tendf,ru_tendf,rv_tendf,rw_tendf,t_tendf,xk<a name='2514'></font>
<font color=#447700>! mhd<a name='2515'></font>
<a name='2516'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='2517'></font>
<font color=#447700>! TBH:  Restore fields computed earlier between the call to rk_tendency and <a name='2518'></font>
<font color=#447700>! TBH:  the end of small_stepu loop.  <a name='2519'></font>
 restore_rktend_thru_sszw: if ( config_flags%remove_rktend_thru_ss ) then<a name='2520'>
BENCH_START(comprestore_rktend_thru_ss_tim)<a name='2521'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktend_thru_sszw:  rk_step, rk_order = ',rk_step,rk_order<a name='2522'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_31"> ( 10 , TRIM(wrf_err_message) )<a name='2523'>
   <font color=#447700>! store fields<a name='2524'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_12">(rk_step, BUF_RKTEND_THRU_SS)<a name='2525'>
#include "<A href='../../html_code/include/restore_rktend_thru_ss.h.html'>restore_rktend_thru_ss.h</A>"<A NAME="restore_rktend_thru_ss.h_89"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2526'>
BENCH_END(comprestore_rktend_thru_ss_tim)<a name='2527'>
 else  <font color=#447700>! restore_rktend_thru_sszw<a name='2528'></font>
<a name='2529'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='2530'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_tendency.  <a name='2531'></font>
 restore_rktendzw: if ( config_flags%remove_rktend ) then<a name='2532'>
BENCH_START(comprestore_rktend_tim)<a name='2533'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktendzw:  rk_step, rk_order = ',rk_step,rk_order<a name='2534'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_32"> ( 10 , TRIM(wrf_err_message) )<a name='2535'>
   <font color=#447700>! store fields<a name='2536'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_13">(rk_step, BUF_RKTEND)<a name='2537'>
#include "<A href='../../html_code/include/restore_rktend.h.html'>restore_rktend.h</A>"<A NAME="restore_rktend.h_90"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2538'>
BENCH_END(comprestore_rktend_tim)<a name='2539'>
 else  <font color=#447700>! restore_rktendzw<a name='2540'></font>
<a name='2541'>
WRITE(wrf_err_message,*) 'DEBUG:  calling rk_tendency before_small_stepzw, rk_step = ',rk_step<a name='2542'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_33">( 10, TRIM(wrf_err_message) )<a name='2543'>
BENCH_START(comp7774)<a name='2544'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_7">( config_flags,rk_step,ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,&amp;<a name='2545'>
&amp;mu_tend,u_save,v_save,w_save,ph_save,t_save,mu_save,rthften,ru,rv,rw,ww,u_2,v_2,w_2,t_2,ph_2,u_1,v_1,w_1,t_1,ph_1,h_diabatic,&amp;<a name='2546'>
&amp;phb,t_init,mu_2,mut,muu,muv,mub,al,alt,p,pb,php,cqu,cqv,cqw,u_base,v_base,t_base,qv_base,z_base,msfu,msfv,msft,f,e,sina,cosa,&amp;<a name='2547'>
&amp;fnm,fnp,rdn,rdnw,dt,rdx,rdy,khdif,kvdif,xkmhd,cf1,cf2,cf3,cfn,cfn1,num_3d_m,non_hydrostatic,leapfrog,ids,ide,jds,jde,kds,kde,&amp;<a name='2548'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2549'>
BENCH_END(comp7774)<a name='2550'>
<a name='2551'>
 endif restore_rktendzw<a name='2552'>
<a name='2553'>
BENCH_START(comp43)<a name='2554'>
<font color=#447700>!  recompute : cqw,mu_tend,ph_save,ph_tend,ru_tend,ru_tendf,rv_tend,rv_t<a name='2555'></font>
<font color=#447700>! endf,rw_tend,rw_tendf,t_save,t_tend,t_tendf,u_save,v_save,w_save<a name='2556'></font>
<a name='2557'>
    if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='2558'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_DRY'>relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_DRY_7">( config_flags,u_save,v_save,ph_save,t_save,w_save,mu_tend,ru,rv,ph_2,t_2,w_2,mu_2,mut,u_b,v_b,ph_b,t_b,&amp;<a name='2559'>
&amp;w_b,mu_b,u_bt,v_bt,ph_bt,t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,kde,&amp;<a name='2560'>
&amp;ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2561'>
    endif<a name='2562'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_ADDTEND_DRY'>rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_ADDTEND_DRY_7">( ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,u_save,v_save,w_save,&amp;<a name='2563'>
&amp;ph_save,t_save,rk_step,h_diabatic,mut,msft,msfu,msfv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='2564'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2565'>
    if (config_flags%specified .or. config_flags%nested) then<a name='2566'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_DRY'>spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_DRY_7">( config_flags,ru_tend,rv_tend,ph_tend,t_tend,rw_tend,mu_tend,u_b,v_b,ph_b,t_b,w_b,mu_b,u_bt,v_bt,ph_bt,&amp;<a name='2567'>
&amp;t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='2568'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2569'>
    endif<a name='2570'>
<a name='2571'>
<font color=#447700>! recompute : mu_tend,ph_tend,ru_tend,rv_tend,rw_tend,t_tend<a name='2572'></font>
<a name='2573'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_PREP'>small_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_PREP_7">( u_1,u_2,v_1,v_2,w_1,w_2,t_1,t_2,ph_1,ph_2,mub,mu_1,mu_2,muu,muus,muv,muvs,mut,muts,mudf,u_save,v_save,&amp;<a name='2574'>
&amp;w_save,t_save,ph_save,mu_save,ww,ww1,dnw,c2a,pb,p,alt,msfu,msfv,msft,rk_step,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='2575'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2576'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_11">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,0,ids,ide,jds,jde,kds,kde,&amp;<a name='2577'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2578'>
    if (non_hydrostatic) then<a name='2579'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_COEF_W'>calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_COEF_W_7">( a,alpha,gamma,mut,cqw,rdn,rdnw,c2a,dts,g,epssm,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='2580'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2581'>
    endif<a name='2582'>
BENCH_END(comp43)<a name='2583'>
<a name='2584'>
BENCH_START(exch39)<a name='2585'>
#ifdef DM_PARALLEL<a name='2586'>
lineno = __LINE__<a name='2587'>
#      include "<A href='../../html_code/include/HALO_1857.inc.html'>HALO_1857.inc</A>"<A NAME="HALO_1857.inc_91"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2588'>
<a name='2589'>
#endif<a name='2590'>
BENCH_END(exch39)<a name='2591'>
<a name='2592'>
<font color=#447700>!------------------------------<a name='2593'></font>
<font color=#447700>!------------------------------<a name='2594'></font>
<a name='2595'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='2596'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by small_stepu loop.  <a name='2597'></font>
 restore_small_stepzw: if (config_flags%remove_small_step) then<a name='2598'>
BENCH_START(comprestore_small_step_tim)<a name='2599'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_small_stepzw:  rk_step, rk_order = ',rk_step,rk_order<a name='2600'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_34"> ( 10 , TRIM(wrf_err_message) )<a name='2601'>
   <font color=#447700>! store fields<a name='2602'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_14">(rk_step, BUF_SMALL_STEP)<a name='2603'>
#include "<A href='../../html_code/include/restore_small_step.h.html'>restore_small_step.h</A>"<A NAME="restore_small_step.h_92"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2604'>
BENCH_END(comprestore_small_step_tim)<a name='2605'>
 else  <font color=#447700>! restore_small_stepzw<a name='2606'></font>
<a name='2607'>
  small_stepzw: do iteration = 1, number_of_small_timesteps<a name='2608'>
WRITE(wrf_err_message,*) 'DEBUG:  begin small_stepzw, iteration = ',iteration<a name='2609'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_35">( 10, TRIM(wrf_err_message) )<a name='2610'>
<a name='2611'>
BENCH_START(comp44)<a name='2612'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_UV'>advance_uv</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_UV_7">( u_2,ru_tend,v_2,rv_tend,p,pb,ph_2,php,alt,al,mu_2,muu,cqu,muv,cqv,mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,&amp;<a name='2613'>
&amp;emdiv,rdnw,config_flags,spec_zone,non_hydrostatic,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='2614'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2615'>
      if (config_flags%specified .or. config_flags%nested) then<a name='2616'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_27">( u_2,ru_tend,dts_rk,'u',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='2617'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2618'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_28">( v_2,rv_tend,dts_rk,'v',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='2619'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2620'>
      endif<a name='2621'>
BENCH_END(comp44)<a name='2622'>
<a name='2623'>
BENCH_START(exch40)<a name='2624'>
#ifdef DM_PARALLEL<a name='2625'>
lineno = __LINE__<a name='2626'>
#     include "<A href='../../html_code/include/HALO_1880.inc.html'>HALO_1880.inc</A>"<A NAME="HALO_1880.inc_93"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2627'>
#endif<a name='2628'>
BENCH_END(exch40)<a name='2629'>
BENCH_START(comp444)<a name='2630'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_MU_T'>advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_MU_T_7">( ww,ww1,u_2,u_save,v_2,v_save,mu_2,mut,muave,muts,muu,muv,mudf,ru_m,rv_m,ww_m,t_2,t_save,t_2save,t_tend,&amp;<a name='2631'>
&amp;mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,msfv,msft,iteration,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='2632'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2633'>
BENCH_END(comp444)<a name='2634'>
BENCH_START(exch41)<a name='2635'>
#ifdef DM_PARALLEL<a name='2636'>
lineno = __LINE__<a name='2637'>
#include "<A href='../../html_code/include/HALO_1889.inc.html'>HALO_1889.inc</A>"<A NAME="HALO_1889.inc_94"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2638'>
<a name='2639'>
<a name='2640'>
<a name='2641'>
<a name='2642'>
#endif<a name='2643'>
BENCH_END(exch41)<a name='2644'>
BENCH_START(comp45)<a name='2645'>
      if (config_flags%specified .or. config_flags%nested) then<a name='2646'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_29">( t_2,t_tend,dts_rk,'t',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='2647'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2648'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_30">( mu_2,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='2649'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='2650'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_31">( muts,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='2651'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='2652'>
      endif<a name='2653'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SUMFLUX'>sumflux</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUMFLUX_7">( u_2,v_2,ww,u_save,v_save,ww1,muu,muv,ru_m,rv_m,ww_m,epssm,msfu,msfv,iteration,number_of_small_timesteps,ids,&amp;<a name='2654'>
&amp;ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2655'>
      if (non_hydrostatic) then<a name='2656'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_W'>advance_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_W_7">( w_2,rw_tend,ww,u_2,v_2,mu_2,mut,muave,muts,t_2save,t_2,t_save,ph_2,ph_save,phb,ph_tend,ht,c2a,cqw,alt,alb,&amp;<a name='2657'>
&amp;a,alpha,gamma,rdx,rdy,dts,t0,epssm,dnw,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,&amp;<a name='2658'>
&amp;jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2659'>
      endif<a name='2660'>
      if (config_flags%specified .or. config_flags%nested) then<a name='2661'>
        if (non_hydrostatic) then<a name='2662'>
          call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDYUPDATE_PH'>spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_PH_7">( ph_save,ph_2,ph_tend,mu_tend,muts,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,&amp;<a name='2663'>
&amp;ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2664'>
          if (config_flags%specified) then<a name='2665'>
            call <A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY'>zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_GRAD_BDY_5">( w_2,'w',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,&amp;<a name='2666'>
&amp;kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2667'>
          else<a name='2668'>
            call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_32">( w_2,rw_tend,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='2669'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2670'>
          endif<a name='2671'>
        endif<a name='2672'>
      endif<a name='2673'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_12">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,iteration,ids,ide,jds,jde,&amp;<a name='2674'>
&amp;kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2675'>
BENCH_END(comp45)<a name='2676'>
<a name='2677'>
BENCH_START(exch42)<a name='2678'>
#ifdef DM_PARALLEL<a name='2679'>
lineno = __LINE__<a name='2680'>
#   include "<A href='../../html_code/include/HALO_1930.inc.html'>HALO_1930.inc</A>"<A NAME="HALO_1930.inc_95"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2681'>
<a name='2682'>
#endif<a name='2683'>
BENCH_END(exch42)<a name='2684'>
<a name='2685'>
  end do small_stepzw<a name='2686'>
<a name='2687'>
 endif restore_small_stepzw<a name='2688'>
<a name='2689'>
 endif restore_rktend_thru_sszw<a name='2690'>
<a name='2691'>
<font color=#447700>! recompute : mu_2,mudf,muts,ph_2,pm1,ru_m,rv_m,t_2,u_2,v_2,w_2,ww_m<a name='2692'></font>
<a name='2693'>
BENCH_START(exch43)<a name='2694'>
#ifdef DM_PARALLEL<a name='2695'>
lineno = __LINE__<a name='2696'>
<a name='2697'>
#endif<a name='2698'>
BENCH_END(exch43)<a name='2699'>
<a name='2700'>
BENCH_START(comp46)<a name='2701'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_MU_UV_1'>calc_mu_uv_1</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_MU_UV_1_7">( config_flags,muts,muus,muvs,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='2702'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2703'>
<font color=#447700>!    call small_step_finish( u_2,u_1,v_2,v_1,w_2,w_1,t_2,t_1,ph_2,ph_1,ww,ww1,mu_2,mu_1,mut,muts,muu,muus,muv,muvs,u_save,v_save,&amp;<a name='2704'></font>
<font color=#447700>!&amp;w_save,t_save,ph_save,mu_save,msfu,msfv,msft,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='2705'></font>
<font color=#447700>!&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2706'></font>
<font color=#447700>!-----The original<a name='2707'></font>
      CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_FINISH'>small_step_finish</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_FINISH_7">( u_2, u_1, v_2, v_1, w_2, w_1,     &amp;<a name='2708'>
                              t_2, t_1, ph_2, ph_1, ww, ww1,    &amp;<a name='2709'>
                              mu_2, mu_1,                       &amp;<a name='2710'>
                              mut, muts, muu, muus, muv, muvs,  &amp;<a name='2711'>
                              u_save, v_save, w_save,           &amp;<a name='2712'>
                              t_save, ph_save, mu_save,         &amp;<a name='2713'>
                              msfu, msfv, msft,                 &amp;<a name='2714'>
                              h_diabatic,                       &amp;<a name='2715'>
                              number_of_small_timesteps,dts_rk, &amp;<a name='2716'>
                              ids, ide, jds, jde, kds, kde,     &amp;<a name='2717'>
                              ims, ime, jms, jme, kms, kme,     &amp;<a name='2718'>
                              grid%i_start(ij), grid%i_end(ij), &amp;<a name='2719'>
                              grid%j_start(ij), grid%j_end(ij), &amp;<a name='2720'>
                              k_start    , k_end               )<a name='2721'>
BENCH_END(comp46)<a name='2722'>
<a name='2723'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='2724'></font>
#ifndef NO_HALO_FIX<a name='2725'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 46<a name='2726'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_96"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2727'>
#endif<a name='2728'>
<a name='2729'>
<font color=#447700>! recompute : mu_2,ph_2,t_2<a name='2730'></font>
<font color=#447700>!---------------------------------------------------------------------------------<a name='2731'></font>
<a name='2732'>
  a_moist_scalar_advance: if (num_3d_m .ge. param_first_scalar) then<a name='2733'>
<a name='2734'>
BENCH_START(exch44)<a name='2735'>
#ifdef DM_PARALLEL<a name='2736'>
lineno = __LINE__<a name='2737'>
#  include "<A href='../../html_code/include/HALO_1974.inc.html'>HALO_1974.inc</A>"<A NAME="HALO_1974.inc_97"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2738'>
#endif<a name='2739'>
BENCH_END(exch44)<a name='2740'>
BENCH_START(comp47)<a name='2741'>
<font color=#447700>!----------------------------------------<a name='2742'></font>
<font color=#447700>!1111<a name='2743'></font>
<font color=#447700>!saved by Zaizhong Ma<a name='2744'></font>
<font color=#447700>!----------------------------------------<a name='2745'></font>
#ifndef FAST_CPY<a name='2746'>
u_1_keep4(:,:,:) = u_1(:,:,:)<a name='2747'>
u_2_keep4(:,:,:) = u_2(:,:,:)<a name='2748'>
v_1_keep4(:,:,:) = v_1(:,:,:)<a name='2749'>
v_2_keep4(:,:,:) = v_2(:,:,:)<a name='2750'>
w_1_keep4(:,:,:) = w_1(:,:,:)<a name='2751'>
w_2_keep4(:,:,:) = w_2(:,:,:)<a name='2752'>
ph_1_keep4(:,:,:) = ph_1(:,:,:)<a name='2753'>
ph_2_keep4(:,:,:) = ph_2(:,:,:)<a name='2754'>
t_1_keep4(:,:,:) = t_1(:,:,:)<a name='2755'>
t_2_keep4(:,:,:) = t_2(:,:,:)<a name='2756'>
mu_1_keep4(:,:) = mu_1(:,:)<a name='2757'>
mu_2_keep4(:,:) = mu_2(:,:)<a name='2758'>
p_keep4(:,:,:) = p(:,:,:)<a name='2759'>
al_keep4(:,:,:) = al(:,:,:)<a name='2760'>
moist_1_keep4(:,:,:,:) = moist_1(:,:,:,:)<a name='2761'>
moist_2_keep4(:,:,:,:) = moist_2(:,:,:,:)<a name='2762'>
<font color=#447700>!----------------------------------------<a name='2763'></font>
rv_mz(:,:,:) = rv_m(:,:,:)<a name='2764'>
ru_tendfz(:,:,:) = ru_tendf(:,:,:)<a name='2765'>
ru_mz(:,:,:) = ru_m(:,:,:)<a name='2766'>
moist_tendz(:,:,:,:) = moist_tend(:,:,:,:)<a name='2767'>
#else<a name='2768'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_127">(u_1_keep4 , u_1 , n3d_elem )<a name='2769'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_128">(u_2_keep4 , u_2 , n3d_elem )<a name='2770'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_129">(v_1_keep4 , v_1 , n3d_elem )<a name='2771'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_130">(v_2_keep4 , v_2 , n3d_elem )<a name='2772'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_131">(w_1_keep4 , w_1 , n3d_elem )<a name='2773'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_132">(w_2_keep4 , w_2 , n3d_elem )<a name='2774'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_133">(ph_1_keep4 , ph_1 , n3d_elem )<a name='2775'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_134">(ph_2_keep4 , ph_2 , n3d_elem )<a name='2776'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_135">(t_1_keep4 , t_1 , n3d_elem )<a name='2777'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_136">(t_2_keep4 , t_2 , n3d_elem )<a name='2778'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_137">(mu_1_keep4 , mu_1 , n2d_elem )<a name='2779'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_138">(mu_2_keep4 , mu_2 , n2d_elem )<a name='2780'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_139">(p_keep4 , p , n3d_elem )<a name='2781'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_140">(al_keep4 , al , n3d_elem )<a name='2782'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_141">(moist_1_keep4(ims,kms,jms,2) , moist_1(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='2783'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_142">(moist_2_keep4(ims,kms,jms,2) , moist_2(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='2784'>
<font color=#447700>!----------------------------------------<a name='2785'></font>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_143">(rv_mz , rv_m , n3d_elem )<a name='2786'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_144">(ru_tendfz , ru_tendf , n3d_elem )<a name='2787'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_145">(ru_mz , ru_m , n3d_elem )<a name='2788'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_146">(moist_tendz(ims,kms,jms,2) , moist_tend(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='2789'>
#endif<a name='2790'>
<font color=#447700>!----------------------------------------<a name='2791'></font>
BENCH_END(comp47)<a name='2792'>
<a name='2793'>
    do im = num_3d_m, param_first_scalar, -1<a name='2794'>
BENCH_START(comp48)<a name='2795'>
<font color=#447700>!----------------------------------------<a name='2796'></font>
<font color=#447700>!  1111<a name='2797'></font>
<font color=#447700>!recovered by Zaizhong Ma<a name='2798'></font>
<font color=#447700>!----------------------------------------<a name='2799'></font>
#ifndef FAST_CPY<a name='2800'>
u_1(:,:,:) = u_1_keep4(:,:,:)<a name='2801'>
u_2(:,:,:) = u_2_keep4(:,:,:)<a name='2802'>
v_1(:,:,:) = v_1_keep4(:,:,:)<a name='2803'>
v_2(:,:,:) = v_2_keep4(:,:,:)<a name='2804'>
w_1(:,:,:) = w_1_keep4(:,:,:)<a name='2805'>
w_2(:,:,:) = w_2_keep4(:,:,:)<a name='2806'>
ph_1(:,:,:) = ph_1_keep4(:,:,:)<a name='2807'>
ph_2(:,:,:) = ph_2_keep4(:,:,:)<a name='2808'>
t_1(:,:,:) = t_1_keep4(:,:,:)<a name='2809'>
t_2(:,:,:) = t_2_keep4(:,:,:)<a name='2810'>
mu_1(:,:) = mu_1_keep4(:,:)<a name='2811'>
mu_2(:,:) = mu_2_keep4(:,:)<a name='2812'>
p(:,:,:) = p_keep4(:,:,:)<a name='2813'>
al(:,:,:) = al_keep4(:,:,:)<a name='2814'>
moist_1(:,:,:,:) = moist_1_keep4(:,:,:,:)<a name='2815'>
moist_2(:,:,:,:) = moist_2_keep4(:,:,:,:)<a name='2816'>
<font color=#447700>!----------------------------------------<a name='2817'></font>
<font color=#447700>!----------------------------------------<a name='2818'></font>
rv_m(:,:,:) = rv_mz(:,:,:)<a name='2819'>
ru_tendf(:,:,:) = ru_tendfz(:,:,:)<a name='2820'>
ru_m(:,:,:) = ru_mz(:,:,:)<a name='2821'>
moist_tend(:,:,:,:) = moist_tendz(:,:,:,:)<a name='2822'>
<font color=#447700>!----------------------------------------<a name='2823'></font>
#else<a name='2824'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_147">(u_1 , u_1_keep4 , n3d_elem )<a name='2825'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_148">(u_2 , u_2_keep4 , n3d_elem )<a name='2826'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_149">(v_1 , v_1_keep4 , n3d_elem )<a name='2827'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_150">(v_2 , v_2_keep4 , n3d_elem )<a name='2828'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_151">(w_1 , w_1_keep4 , n3d_elem )<a name='2829'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_152">(w_2 , w_2_keep4 , n3d_elem )<a name='2830'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_153">(ph_1 , ph_1_keep4 , n3d_elem )<a name='2831'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_154">(ph_2 , ph_2_keep4 , n3d_elem )<a name='2832'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_155">(t_1 , t_1_keep4 , n3d_elem )<a name='2833'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_156">(t_2 , t_2_keep4 , n3d_elem )<a name='2834'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_157">(mu_1 , mu_1_keep4 , n2d_elem )<a name='2835'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_158">(mu_2 , mu_2_keep4 , n2d_elem )<a name='2836'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_159">(p , p_keep4 , n3d_elem )<a name='2837'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_160">(al , al_keep4 , n3d_elem )<a name='2838'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_161">(moist_1(ims,kms,jms,2) , moist_1_keep4(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='2839'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_162">(moist_2(ims,kms,jms,2) , moist_2_keep4(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='2840'>
<font color=#447700>!----------------------------------------<a name='2841'></font>
<font color=#447700>!----------------------------------------<a name='2842'></font>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_163">(rv_m , rv_mz , n3d_elem )<a name='2843'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_164">(ru_tendf , ru_tendfz , n3d_elem )<a name='2844'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_165">(ru_m , ru_mz , n3d_elem )<a name='2845'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_166">(moist_tend(ims,kms,jms,2) , moist_tendz(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='2846'>
<font color=#447700>!----------------------------------------<a name='2847'></font>
#endif<a name='2848'>
BENCH_END(comp48)<a name='2849'>
<a name='2850'>
BENCH_START(exch45)<a name='2851'>
#ifdef DM_PARALLEL<a name='2852'>
lineno = __LINE__<a name='2853'>
#   include "<A href='../../html_code/include/HALO_2036.inc.html'>HALO_2036.inc</A>"<A NAME="HALO_2036.inc_98"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2854'>
<a name='2855'>
#endif<a name='2856'>
BENCH_END(exch45)<a name='2857'>
<a name='2858'>
BENCH_START(comp49)<a name='2859'>
     moist_variable_loor2:  do iy = param_first_scalar, num_3d_m - 1<a name='2860'>
<a name='2861'>
        call <A href='../../html_code/dyn_em/module_em.F.html#RK_SCALAR_TEND'>rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_SCALAR_TEND_9">( iy,iy,config_flags,rk_step,dt_rk,ru_m,rv_m,ww_m,mut,alt,moist_1(ims,kms,jms,iy),moist_2(ims,kms,jms,&amp;<a name='2862'>
&amp;iy),moist_tend(ims,kms,jms,iy),advect_tend,rqvften,qv_base, .true. ,fnm,fnp,msfu,msfv,msft,rdx,rdy,rdn,rdnw,khdif,kvdif,&amp;<a name='2863'>
&amp;xkmhd,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%&amp;<a name='2864'>
&amp;j_end(ij),k_start,k_end )<a name='2865'>
        if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='2866'>
          if (iy .eq. p_qv) then<a name='2867'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_27">( moist_tend(ims,kms,jms,iy),rqv_b,rqv_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2868'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2869'>
          endif<a name='2870'>
        endif<a name='2871'>
        if (config_flags%nested .and. rk_step .eq. 1) then<a name='2872'>
          if (iy .eq. p_qc) then<a name='2873'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_28">( moist_tend(ims,kms,jms,iy),rqc_b,rqc_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2874'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2875'>
          else if (iy .eq. p_qr) then<a name='2876'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_29">( moist_tend(ims,kms,jms,iy),rqr_b,rqr_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2877'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2878'>
          else if (iy .eq. p_qi) then<a name='2879'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_30">( moist_tend(ims,kms,jms,iy),rqi_b,rqi_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2880'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2881'>
          else if (iy .eq. p_qs) then<a name='2882'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_31">( moist_tend(ims,kms,jms,iy),rqs_b,rqs_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2883'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2884'>
          else if (iy .eq. p_qg) then<a name='2885'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_32">( moist_tend(ims,kms,jms,iy),rqg_b,rqg_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2886'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2887'>
          endif<a name='2888'>
        endif<a name='2889'>
<a name='2890'>
        call <A href='../../html_code/dyn_em/module_em.F.html#RK_UPDATE_SCALAR'>rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_UPDATE_SCALAR_9">( iy,iy,moist_1(ims,kms,jms,iy),moist_2(ims,kms,jms,iy),moist_tend(ims,kms,jms,iy),advect_tend,msft,&amp;<a name='2891'>
&amp;mu_1,mu_2,mub,rk_step,dt_rk,spec_zone,epsts,leapfrog,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='2892'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2893'>
<a name='2894'>
    end do moist_variable_loor2<a name='2895'>
<a name='2896'>
        call <A href='../../html_code/dyn_em/module_em.F.html#RK_SCALAR_TEND'>rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_SCALAR_TEND_10">( im,im,config_flags,rk_step,dt_rk,ru_m,rv_m,ww_m,mut,alt,moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,&amp;<a name='2897'>
&amp;im),moist_tend(ims,kms,jms,im),advect_tend,rqvften,qv_base, .true. ,fnm,fnp,msfu,msfv,msft,rdx,rdy,rdn,rdnw,khdif,kvdif,&amp;<a name='2898'>
&amp;xkmhd,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%&amp;<a name='2899'>
&amp;j_end(ij),k_start,k_end )<a name='2900'>
        if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='2901'>
          if (im .eq. p_qv) then<a name='2902'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_33">( moist_tend(ims,kms,jms,im),rqv_b,rqv_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2903'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2904'>
          endif<a name='2905'>
        endif<a name='2906'>
        if (config_flags%nested .and. rk_step .eq. 1) then<a name='2907'>
          if (im .eq. p_qc) then<a name='2908'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_34">( moist_tend(ims,kms,jms,im),rqc_b,rqc_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2909'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2910'>
          else if (im .eq. p_qr) then<a name='2911'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_35">( moist_tend(ims,kms,jms,im),rqr_b,rqr_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2912'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2913'>
          else if (im .eq. p_qi) then<a name='2914'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_36">( moist_tend(ims,kms,jms,im),rqi_b,rqi_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2915'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2916'>
          else if (im .eq. p_qs) then<a name='2917'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_37">( moist_tend(ims,kms,jms,im),rqs_b,rqs_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2918'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2919'>
          else if (im .eq. p_qg) then<a name='2920'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_38">( moist_tend(ims,kms,jms,im),rqg_b,rqg_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2921'>
&amp;kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2922'>
          endif<a name='2923'>
        endif<a name='2924'>
BENCH_END(comp49)<a name='2925'>
<a name='2926'>
<font color=#447700>!-------------------------------------------------------<a name='2927'></font>
<a name='2928'>
BENCH_START(exch46)<a name='2929'>
#ifdef DM_PARALLEL<a name='2930'>
lineno = __LINE__<a name='2931'>
#   include "<A href='../../html_code/include/HALO_2112.inc.html'>HALO_2112.inc</A>"<A NAME="HALO_2112.inc_99"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2932'>
#endif<a name='2933'>
BENCH_END(exch46)<a name='2934'>
<a name='2935'>
<font color=#447700>! recompute : advect_tend,moist_tend<a name='2936'></font>
<a name='2937'>
BENCH_START(comp50)<a name='2938'>
        call <A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_UPDATE_SCALAR'>a_rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_RK_UPDATE_SCALAR_2">( im,im,moist_1(ims,kms,jms,im),a_moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,im),a_moist_2(ims,kms,&amp;<a name='2939'>
&amp;jms,im),moist_tend(ims,kms,jms,im),a_moist_tend(ims,kms,jms,im),advect_tend,a_advect_tend,msft,mu_1,a_mu_1,mu_2,a_mu_2,&amp;<a name='2940'>
&amp;mub,rk_step,dt_rk,spec_zone,epsts,leapfrog,config_flags,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme, &amp;<a name='2941'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='2942'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='2943'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='2944'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='2945'>
<a name='2946'>
        if (config_flags%nested .and. rk_step .eq. 1) then<a name='2947'>
          if (im .eq. p_qc) then<a name='2948'>
            call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_SPEC_BDY_SCALAR'>a_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDY_SCALAR_2">( a_moist_tend(ims,kms,jms,im),a_rqc_bth,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2949'>
&amp;kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2950'>
          else if (im .eq. p_qr) then<a name='2951'>
            call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_SPEC_BDY_SCALAR'>a_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDY_SCALAR_3">( a_moist_tend(ims,kms,jms,im),a_rqr_bth,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2952'>
&amp;kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2953'>
          else if (im .eq. p_qi) then<a name='2954'>
            call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_SPEC_BDY_SCALAR'>a_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDY_SCALAR_4">( a_moist_tend(ims,kms,jms,im),a_rqi_bth,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2955'>
&amp;kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2956'>
          else if (im .eq. p_qs) then<a name='2957'>
            call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_SPEC_BDY_SCALAR'>a_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDY_SCALAR_5">( a_moist_tend(ims,kms,jms,im),a_rqs_bth,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2958'>
&amp;kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2959'>
          else if (im .eq. p_qg) then<a name='2960'>
            call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_SPEC_BDY_SCALAR'>a_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDY_SCALAR_6">( a_moist_tend(ims,kms,jms,im),a_rqg_bth,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2961'>
&amp;kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2962'>
          endif<a name='2963'>
        endif<a name='2964'>
        if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='2965'>
          if (im .eq. p_qv) then<a name='2966'>
            call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_SPEC_BDY_SCALAR'>a_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDY_SCALAR_7">( a_moist_tend(ims,kms,jms,im),a_rqv_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,&amp;<a name='2967'>
&amp;kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2968'>
          endif<a name='2969'>
        endif<a name='2970'>
BENCH_END(comp50)<a name='2971'>
<a name='2972'>
BENCH_START(exch47)<a name='2973'>
#ifdef DM_PARALLEL<a name='2974'>
lineno = __LINE__<a name='2975'>
# include "<A href='../../html_code/include/HALO_2154.inc.html'>HALO_2154.inc</A>"<A NAME="HALO_2154.inc_100"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2976'>
#endif<a name='2977'>
BENCH_END(exch47)<a name='2978'>
<a name='2979'>
BENCH_START(comp51)<a name='2980'>
        call <A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_SCALAR_TEND'>a_rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_RK_SCALAR_TEND_2">( im,im,config_flags,rk_step,ru_m,a_ru_m,rv_m,a_rv_m,ww_m,a_ww_m,mut,a_mut,alt,a_alt,moist_1(ims,kms,&amp;<a name='2981'>
&amp;jms,im),a_moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,im),a_moist_2(ims,kms,jms,im),a_moist_tend(ims,kms,jms,im),&amp;<a name='2982'>
&amp;a_advect_tend,qv_base, .true. ,fnm,fnp,msfu,msfv,msft,rdx,rdy,rdn,rdnw,kvdif,xkmhd,a_xkmhd,leapfrog,ids,ide,jds,jde,kde,&amp;<a name='2983'>
&amp;ims,ime,jms,jme,kms,kme,&amp;<a name='2984'>
        max(grid%i_start(ij)-3,ids),  &amp;<a name='2985'>
        min(grid%i_end(ij)+3,ide),    &amp;<a name='2986'>
        max(grid%j_start(ij)-3,jds),  &amp;<a name='2987'>
        min(grid%j_end(ij)+3,jde),k_start,k_end )<a name='2988'>
BENCH_END(comp51)<a name='2989'>
<a name='2990'>
    end do<a name='2991'>
  endif a_moist_scalar_advance<a name='2992'>
<a name='2993'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='2994'></font>
#ifndef NO_HALO_FIX<a name='2995'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 51<a name='2996'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_101"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2997'>
#endif<a name='2998'>
<a name='2999'>
<font color=#447700>!------------------------------<a name='3000'></font>
<font color=#447700>!------------------------------<a name='3001'></font>
<a name='3002'>
BENCH_START(comp52)<a name='3003'>
#ifndef FAST_CPY<a name='3004'>
<font color=#447700>!------------------------------<a name='3005'></font>
  ww_m(:,:,:) = ww_m_keep3(:,:,:)<a name='3006'>
  rv_m(:,:,:) = rv_m_keep3(:,:,:)<a name='3007'>
  ru_m(:,:,:) = ru_m_keep3(:,:,:)<a name='3008'>
  a(:,:,:) = a_keep3(:,:,:)<a name='3009'>
  alpha(:,:,:) = alpha_keep3(:,:,:)<a name='3010'>
  gamma(:,:,:) = gamma_keep3(:,:,:)<a name='3011'>
<font color=#447700>!------------------------------<a name='3012'></font>
<a name='3013'>
  xkmhd(:,:,:) = xkmhdh(:,:,:)<a name='3014'>
  w_2(:,:,:) = w_2h(:,:,:)<a name='3015'>
  w_1(:,:,:) = w_1h(:,:,:)<a name='3016'>
  v_2(:,:,:) = v_2h(:,:,:)<a name='3017'>
  v_1(:,:,:) = v_1h(:,:,:)<a name='3018'>
  u_2(:,:,:) = u_2h(:,:,:)<a name='3019'>
  u_1(:,:,:) = u_1h(:,:,:)<a name='3020'>
  t_tendf(:,:,:) = t_tendfh(:,:,:)<a name='3021'>
  t_2(:,:,:) = t_2h(:,:,:)<a name='3022'>
  t_1(:,:,:) = t_1h(:,:,:)<a name='3023'>
  rw_tendf(:,:,:) = rw_tendfh(:,:,:)<a name='3024'>
  rv_tendf(:,:,:) = rv_tendfh(:,:,:)<a name='3025'>
  ru_tendf(:,:,:) = ru_tendfh(:,:,:)<a name='3026'>
  pm1(:,:,:) = pm1h(:,:,:)<a name='3027'>
  ph_tendf(:,:,:) = ph_tendfh(:,:,:)<a name='3028'>
  ph_2(:,:,:) = ph_2h(:,:,:)<a name='3029'>
  ph_1(:,:,:) = ph_1h(:,:,:)<a name='3030'>
  p(:,:,:) = ph(:,:,:)<a name='3031'>
  mu_2(:,:) = mu_2h(:,:)<a name='3032'>
  mu_1(:,:) = mu_1h(:,:)<a name='3033'>
  moist_tend(:,:,:,:) = moist_tendh(:,:,:,:)<a name='3034'>
  moist_2(:,:,:,:) = moist_2h(:,:,:,:)<a name='3035'>
  moist_1(:,:,:,:) = moist_1h(:,:,:,:)<a name='3036'>
  dnw(:) = dnwh(:)<a name='3037'>
  al(:,:,:) = alh(:,:,:)<a name='3038'>
<font color=#447700>!----------------------------------------<a name='3039'></font>
  mudf(:,:) = mudf_ma(:,:)<a name='3040'>
<font color=#447700>!----------------------------------------<a name='3041'></font>
#else<a name='3042'>
<font color=#447700>!------------------------------<a name='3043'></font>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_167">(  ww_m , ww_m_keep3, n3d_elem )<a name='3044'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_168">(  rv_m , rv_m_keep3, n3d_elem )<a name='3045'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_169">(  ru_m , ru_m_keep3, n3d_elem )<a name='3046'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_170">(  a , a_keep3, n3d_elem )<a name='3047'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_171">(  alpha , alpha_keep3, n3d_elem )<a name='3048'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_172">(  gamma , gamma_keep3, n3d_elem )<a name='3049'>
<font color=#447700>!------------------------------<a name='3050'></font>
<a name='3051'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_173">(  xkmhd , xkmhdh, n3d_elem )<a name='3052'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_174">(  w_2 , w_2h, n3d_elem )<a name='3053'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_175">(  w_1 , w_1h, n3d_elem )<a name='3054'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_176">(  v_2 , v_2h, n3d_elem )<a name='3055'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_177">(  v_1 , v_1h, n3d_elem )<a name='3056'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_178">(  u_2 , u_2h, n3d_elem )<a name='3057'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_179">(  u_1 , u_1h, n3d_elem )<a name='3058'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_180">(  t_tendf , t_tendfh, n3d_elem )<a name='3059'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_181">(  t_2 , t_2h, n3d_elem )<a name='3060'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_182">(  t_1 , t_1h, n3d_elem )<a name='3061'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_183">(  rw_tendf , rw_tendfh, n3d_elem )<a name='3062'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_184">(  rv_tendf , rv_tendfh, n3d_elem )<a name='3063'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_185">(  ru_tendf , ru_tendfh, n3d_elem )<a name='3064'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_186">(  pm1 , pm1h, n3d_elem )<a name='3065'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_187">(  ph_tendf , ph_tendfh, n3d_elem )<a name='3066'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_188">(  ph_2 , ph_2h, n3d_elem )<a name='3067'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_189">(  ph_1 , ph_1h, n3d_elem )<a name='3068'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_190">(  p , ph, n3d_elem )<a name='3069'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_191">(  mu_2 , mu_2h, n2d_elem )<a name='3070'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_192">(  mu_1 , mu_1h, n2d_elem )<a name='3071'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_193">(  moist_tend(ims,kms,jms,2) , moist_tendh(ims,kms,jms,2), n3d_elem*(num_moist-1) )<a name='3072'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_194">(  moist_2(ims,kms,jms,2) , moist_2h(ims,kms,jms,2), n3d_elem*(num_moist-1) )<a name='3073'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_195">(  moist_1(ims,kms,jms,2) , moist_1h(ims,kms,jms,2), n3d_elem*(num_moist-1) )<a name='3074'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_196">(  dnw , dnwh , kme-kms+1 )<a name='3075'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_197">(  al , alh, n3d_elem )<a name='3076'>
<font color=#447700>!----------------------------------------<a name='3077'></font>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_198">(  mudf , mudf_ma, n2d_elem )<a name='3078'>
<font color=#447700>!----------------------------------------<a name='3079'></font>
#endif<a name='3080'>
  dtm = dt<a name='3081'>
  if (rk_order .eq. 1) then<a name='3082'>
    if (step_number .ne. 1) then<a name='3083'>
      number_of_small_timesteps = 2*time_step_sound<a name='3084'>
      dt_rk = dt<a name='3085'>
      dtm = 2*dt<a name='3086'>
    else<a name='3087'>
      number_of_small_timesteps = time_step_sound<a name='3088'>
      dt_rk = dt/2.<a name='3089'>
      dtm = dt<a name='3090'>
    endif<a name='3091'>
    dts_rk = dts<a name='3092'>
  else if (rk_order .eq. 2) then<a name='3093'>
    if (rk_step .eq. 1) then<a name='3094'>
      dt_rk = 0.5*dt<a name='3095'>
      dts_rk = dts<a name='3096'>
      number_of_small_timesteps = time_step_sound/2<a name='3097'>
    else<a name='3098'>
      dt_rk = dt<a name='3099'>
      dts_rk = dts<a name='3100'>
      number_of_small_timesteps = time_step_sound<a name='3101'>
    endif<a name='3102'>
  else if (rk_order .eq. 3) then<a name='3103'>
    if (rk_step .eq. 1) then<a name='3104'>
      dt_rk = dt/3.<a name='3105'>
      dts_rk = dt_rk<a name='3106'>
      number_of_small_timesteps = 1<a name='3107'>
    else if (rk_step .eq. 2) then<a name='3108'>
      dt_rk = 0.5*dt<a name='3109'>
      dts_rk = dts<a name='3110'>
      number_of_small_timesteps = time_step_sound/2<a name='3111'>
    else<a name='3112'>
      dt_rk = dt<a name='3113'>
      dts_rk = dts<a name='3114'>
      number_of_small_timesteps = time_step_sound<a name='3115'>
    endif<a name='3116'>
  endif<a name='3117'>
<font color=#447700>! recompute : dt_rk,dts_rk,number_of_small_timesteps<a name='3118'></font>
BENCH_END(comp52)<a name='3119'>
<a name='3120'>
BENCH_START(exch48)<a name='3121'>
#ifdef DM_PARALLEL<a name='3122'>
lineno = __LINE__<a name='3123'>
#  include "<A href='../../html_code/include/HALO_2249.inc.html'>HALO_2249.inc</A>"<A NAME="HALO_2249.inc_102"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3124'>
#endif<a name='3125'>
BENCH_END(exch48)<a name='3126'>
<a name='3127'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='3128'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_step_prep.  <a name='3129'></font>
 restore_rk_step_prepzz: if ( config_flags%remove_rk_step_prep ) then<a name='3130'>
BENCH_START(comprestore_rk_step_prep_tim)<a name='3131'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rk_step_prepzz:  rk_step, rk_order = ',rk_step,rk_order<a name='3132'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_36"> ( 10 , TRIM(wrf_err_message) )<a name='3133'>
   <font color=#447700>! store fields<a name='3134'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_15">(rk_step, BUF_RK_STEP_PREP)<a name='3135'>
#include "<A href='../../html_code/include/restore_rk_step_prep.h.html'>restore_rk_step_prep.h</A>"<A NAME="restore_rk_step_prep.h_103"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3136'>
BENCH_END(comprestore_rk_step_prep_tim)<a name='3137'>
 else  <font color=#447700>! restore_rk_step_prepzz<a name='3138'></font>
<a name='3139'>
BENCH_START(comp53)<a name='3140'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_8">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='3141'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='3142'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3143'>
BENCH_END(comp53)<a name='3144'>
<a name='3145'>
 endif restore_rk_step_prepzz<a name='3146'>
<a name='3147'>
#ifdef DM_PARALLEL<a name='3148'>
lineno = __LINE__<a name='3149'>
#    include "<A href='../../html_code/include/HALO_2258.inc.html'>HALO_2258.inc</A>"<A NAME="HALO_2258.inc_104"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3150'>
#endif<a name='3151'>
<a name='3152'>
BENCH_START(exch49)<a name='3153'>
#ifdef DM_PARALLEL<a name='3154'>
lineno = __LINE__<a name='3155'>
#    include "<A href='../../html_code/include/HALO_2264.inc.html'>HALO_2264.inc</A>"<A NAME="HALO_2264.inc_105"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3156'>
#endif<a name='3157'>
BENCH_END(exch49)<a name='3158'>
<a name='3159'>
<font color=#447700>! recompute : alt,cqu,cqv,cqw,mut,muu,muv,php,ru,rv,rw,ww<a name='3160'></font>
  rk_step_is_onzz: if (rk_step .eq. 1) then<a name='3161'>
<a name='3162'>
BENCH_START(comp54)<a name='3163'>
      call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_8">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,rk_step,&amp;<a name='3164'>
&amp;ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3165'>
BENCH_END(comp54)<a name='3166'>
<a name='3167'>
BENCH_START(exch50)<a name='3168'>
#ifdef DM_PARALLEL<a name='3169'>
lineno = __LINE__<a name='3170'>
<a name='3171'>
#endif<a name='3172'>
BENCH_END(exch50)<a name='3173'>
<a name='3174'>
BENCH_START(comp55)<a name='3175'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_8">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,v_phy,&amp;<a name='3176'>
&amp;p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,rqccuten,&amp;<a name='3177'>
&amp;rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='3178'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3179'>
BENCH_END(comp55)<a name='3180'>
<a name='3181'>
BENCH_START(exch51)<a name='3182'>
#ifdef DM_PARALLEL<a name='3183'>
lineno = __LINE__<a name='3184'>
<a name='3185'>
<a name='3186'>
<a name='3187'>
<a name='3188'>
#endif<a name='3189'>
BENCH_END(exch51)<a name='3190'>
<a name='3191'>
BENCH_START(comp56)<a name='3192'>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='3193'>
<a name='3194'>
        call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_8">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='3195'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='3196'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='3197'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3198'>
<a name='3199'>
    endif<a name='3200'>
BENCH_END(comp56)<a name='3201'>
  endif rk_step_is_onzz<a name='3202'>
<a name='3203'>
BENCH_START(exch52)<a name='3204'>
#ifdef DM_PARALLEL<a name='3205'>
lineno = __LINE__<a name='3206'>
#     include "<A href='../../html_code/include/HALO_2309.inc.html'>HALO_2309.inc</A>"<A NAME="HALO_2309.inc_106"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3207'>
<a name='3208'>
<a name='3209'>
<a name='3210'>
#endif<a name='3211'>
BENCH_END(exch52)<a name='3212'>
<a name='3213'>
<font color=#447700>!  recompute : moist_tend,ph_tendf,ru_tendf,rv_tendf,rw_tendf,t_tendf,xk<a name='3214'></font>
<font color=#447700>! mhd<a name='3215'></font>
<a name='3216'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='3217'></font>
<font color=#447700>! TBH:  Restore fields computed earlier between the call to rk_tendency and <a name='3218'></font>
<font color=#447700>! TBH:  the end of small_stepu loop.  <a name='3219'></font>
 restore_rktend_thru_sszz: if ( config_flags%remove_rktend_thru_ss ) then<a name='3220'>
BENCH_START(comprestore_rktend_thru_ss_tim)<a name='3221'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktend_thru_sszz:  rk_step, rk_order = ',rk_step,rk_order<a name='3222'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_37"> ( 10 , TRIM(wrf_err_message) )<a name='3223'>
   <font color=#447700>! store fields<a name='3224'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_16">(rk_step, BUF_RKTEND_THRU_SS)<a name='3225'>
#include "<A href='../../html_code/include/restore_rktend_thru_ss.h.html'>restore_rktend_thru_ss.h</A>"<A NAME="restore_rktend_thru_ss.h_107"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3226'>
BENCH_END(comprestore_rktend_thru_ss_tim)<a name='3227'>
 else  <font color=#447700>! restore_rktend_thru_sszz<a name='3228'></font>
<a name='3229'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='3230'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_tendency.  <a name='3231'></font>
 restore_rktendzz: if ( config_flags%remove_rktend ) then<a name='3232'>
BENCH_START(comprestore_rktend_tim)<a name='3233'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktendzz:  rk_step, rk_order = ',rk_step,rk_order<a name='3234'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_38"> ( 10 , TRIM(wrf_err_message) )<a name='3235'>
   <font color=#447700>! store fields<a name='3236'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_17">(rk_step, BUF_RKTEND)<a name='3237'>
#include "<A href='../../html_code/include/restore_rktend.h.html'>restore_rktend.h</A>"<A NAME="restore_rktend.h_108"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3238'>
BENCH_END(comprestore_rktend_tim)<a name='3239'>
 else  <font color=#447700>! restore_rktendzz<a name='3240'></font>
<a name='3241'>
WRITE(wrf_err_message,*) 'DEBUG:  calling rk_tendency before_small_stepzz, rk_step = ',rk_step<a name='3242'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_39">( 10, TRIM(wrf_err_message) )<a name='3243'>
BENCH_START(comp7775)<a name='3244'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_8">( config_flags,rk_step,ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,&amp;<a name='3245'>
&amp;mu_tend,u_save,v_save,w_save,ph_save,t_save,mu_save,rthften,ru,rv,rw,ww,u_2,v_2,w_2,t_2,ph_2,u_1,v_1,w_1,t_1,ph_1,h_diabatic,&amp;<a name='3246'>
&amp;phb,t_init,mu_2,mut,muu,muv,mub,al,alt,p,pb,php,cqu,cqv,cqw,u_base,v_base,t_base,qv_base,z_base,msfu,msfv,msft,f,e,sina,cosa,&amp;<a name='3247'>
&amp;fnm,fnp,rdn,rdnw,dt,rdx,rdy,khdif,kvdif,xkmhd,cf1,cf2,cf3,cfn,cfn1,num_3d_m,non_hydrostatic,leapfrog,ids,ide,jds,jde,kds,kde,&amp;<a name='3248'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3249'>
BENCH_END(comp7775)<a name='3250'>
<a name='3251'>
 endif restore_rktendzz<a name='3252'>
<a name='3253'>
BENCH_START(comp57)<a name='3254'>
<font color=#447700>!  recompute : cqw,mu_tend,ph_save,ph_tend,ru_tend,ru_tendf,rv_tend,rv_t<a name='3255'></font>
<font color=#447700>! endf,rw_tend,rw_tendf,t_save,t_tend,t_tendf,u_save,v_save,w_save<a name='3256'></font>
<a name='3257'>
    if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='3258'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_DRY'>relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_DRY_8">( config_flags,u_save,v_save,ph_save,t_save,w_save,mu_tend,ru,rv,ph_2,t_2,w_2,mu_2,mut,u_b,v_b,ph_b,t_b,&amp;<a name='3259'>
&amp;w_b,mu_b,u_bt,v_bt,ph_bt,t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,kde,&amp;<a name='3260'>
&amp;ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3261'>
    endif<a name='3262'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_ADDTEND_DRY'>rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_ADDTEND_DRY_8">( ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,u_save,v_save,w_save,&amp;<a name='3263'>
&amp;ph_save,t_save,rk_step,h_diabatic,mut,msft,msfu,msfv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='3264'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3265'>
    if (config_flags%specified .or. config_flags%nested) then<a name='3266'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_DRY'>spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_DRY_8">( config_flags,ru_tend,rv_tend,ph_tend,t_tend,rw_tend,mu_tend,u_b,v_b,ph_b,t_b,w_b,mu_b,u_bt,v_bt,ph_bt,&amp;<a name='3267'>
&amp;t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='3268'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3269'>
    endif<a name='3270'>
<a name='3271'>
<font color=#447700>! recompute : mu_tend,ph_tend,ru_tend,rv_tend,rw_tend,t_tend<a name='3272'></font>
<a name='3273'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_PREP'>small_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_PREP_8">( u_1,u_2,v_1,v_2,w_1,w_2,t_1,t_2,ph_1,ph_2,mub,mu_1,mu_2,muu,muus,muv,muvs,mut,muts,mudf,u_save,v_save,&amp;<a name='3274'>
&amp;w_save,t_save,ph_save,mu_save,ww,ww1,dnw,c2a,pb,p,alt,msfu,msfv,msft,rk_step,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='3275'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3276'>
<a name='3277'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_13">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,0,ids,ide,jds,jde,kds,kde,&amp;<a name='3278'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3279'>
    if (non_hydrostatic) then<a name='3280'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_COEF_W'>calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_COEF_W_8">( a,alpha,gamma,mut,cqw,rdn,rdnw,c2a,dts,g,epssm,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='3281'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3282'>
    endif<a name='3283'>
BENCH_END(comp57)<a name='3284'>
<a name='3285'>
BENCH_START(exch53)<a name='3286'>
#ifdef DM_PARALLEL<a name='3287'>
lineno = __LINE__<a name='3288'>
#      include "<A href='../../html_code/include/HALO_2358.inc.html'>HALO_2358.inc</A>"<A NAME="HALO_2358.inc_109"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3289'>
<a name='3290'>
#endif<a name='3291'>
BENCH_END(exch53)<a name='3292'>
<a name='3293'>
<font color=#447700>!  recompute : a,al,alpha,c2a,gamma,mu_1,mu_2,mu_save,mudf,p,ph_1,ph_2,p<a name='3294'></font>
<font color=#447700>! h_save,pm1,t_1,t_2,t_save,u_1,u_2,u_save,v_1,v_2,v_save,w_1,w_2,w_save<a name='3295'></font>
<font color=#447700>! ,ww1<a name='3296'></font>
<a name='3297'>
<font color=#447700>!------------------------------<a name='3298'></font>
<font color=#447700>!------------------------------<a name='3299'></font>
<a name='3300'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='3301'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by small_stepu loop.  <a name='3302'></font>
 restore_small_stepzz: if (config_flags%remove_small_step) then<a name='3303'>
BENCH_START(comprestore_small_step_tim)<a name='3304'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_small_stepzz:  rk_step, rk_order = ',rk_step,rk_order<a name='3305'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_40"> ( 10 , TRIM(wrf_err_message) )<a name='3306'>
   <font color=#447700>! store fields<a name='3307'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_18">(rk_step, BUF_SMALL_STEP)<a name='3308'>
#include "<A href='../../html_code/include/restore_small_step.h.html'>restore_small_step.h</A>"<A NAME="restore_small_step.h_110"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3309'>
BENCH_END(comprestore_small_step_tim)<a name='3310'>
 else  <font color=#447700>! restore_small_stepzz<a name='3311'></font>
<a name='3312'>
  small_stepzz: do iteration = 1, number_of_small_timesteps<a name='3313'>
WRITE(wrf_err_message,*) 'DEBUG:  begin small_stepzz, iteration = ',iteration<a name='3314'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_41">( 10, TRIM(wrf_err_message) )<a name='3315'>
<a name='3316'>
BENCH_START(comp58)<a name='3317'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_UV'>advance_uv</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_UV_8">( u_2,ru_tend,v_2,rv_tend,p,pb,ph_2,php,alt,al,mu_2,muu,cqu,muv,cqv,mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,&amp;<a name='3318'>
&amp;emdiv,rdnw,config_flags,spec_zone,non_hydrostatic,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='3319'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3320'>
<a name='3321'>
      if (config_flags%specified .or. config_flags%nested) then<a name='3322'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_33">( u_2,ru_tend,dts_rk,'u',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='3323'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3324'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_34">( v_2,rv_tend,dts_rk,'v',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='3325'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3326'>
      endif<a name='3327'>
BENCH_END(comp58)<a name='3328'>
<a name='3329'>
BENCH_START(exch54)<a name='3330'>
#ifdef DM_PARALLEL<a name='3331'>
lineno = __LINE__<a name='3332'>
#     include "<A href='../../html_code/include/HALO_2386.inc.html'>HALO_2386.inc</A>"<A NAME="HALO_2386.inc_111"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3333'>
#endif<a name='3334'>
BENCH_END(exch54)<a name='3335'>
<a name='3336'>
BENCH_START(comp59)<a name='3337'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_MU_T'>advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_MU_T_8">( ww,ww1,u_2,u_save,v_2,v_save,mu_2,mut,muave,muts,muu,muv,mudf,ru_m,rv_m,ww_m,t_2,t_save,t_2save,t_tend,&amp;<a name='3338'>
&amp;mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,msfv,msft,iteration,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='3339'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3340'>
BENCH_END(comp59)<a name='3341'>
<a name='3342'>
BENCH_START(exch55)<a name='3343'>
#ifdef DM_PARALLEL<a name='3344'>
lineno = __LINE__<a name='3345'>
#include "<A href='../../html_code/include/HALO_2397.inc.html'>HALO_2397.inc</A>"<A NAME="HALO_2397.inc_112"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3346'>
<a name='3347'>
<a name='3348'>
<a name='3349'>
<a name='3350'>
#endif<a name='3351'>
BENCH_END(exch55)<a name='3352'>
<a name='3353'>
BENCH_START(comp60)<a name='3354'>
      if (config_flags%specified .or. config_flags%nested) then<a name='3355'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_35">( t_2,t_tend,dts_rk,'t',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='3356'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3357'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_36">( mu_2,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='3358'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='3359'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_37">( muts,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='3360'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='3361'>
      endif<a name='3362'>
<a name='3363'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SUMFLUX'>sumflux</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUMFLUX_8">( u_2,v_2,ww,u_save,v_save,ww1,muu,muv,ru_m,rv_m,ww_m,epssm,msfu,msfv,iteration,number_of_small_timesteps,ids,&amp;<a name='3364'>
&amp;ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3365'>
<a name='3366'>
      if (non_hydrostatic) then<a name='3367'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_W'>advance_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_W_8">( w_2,rw_tend,ww,u_2,v_2,mu_2,mut,muave,muts,t_2save,t_2,t_save,ph_2,ph_save,phb,ph_tend,ht,c2a,cqw,alt,alb,&amp;<a name='3368'>
&amp;a,alpha,gamma,rdx,rdy,dts,t0,epssm,dnw,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,&amp;<a name='3369'>
&amp;jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3370'>
      endif<a name='3371'>
      if (config_flags%specified .or. config_flags%nested) then<a name='3372'>
        if (non_hydrostatic) then<a name='3373'>
          call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDYUPDATE_PH'>spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_PH_8">( ph_save,ph_2,ph_tend,mu_tend,muts,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,&amp;<a name='3374'>
&amp;ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3375'>
          if (config_flags%specified) then<a name='3376'>
            call <A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY'>zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_GRAD_BDY_6">( w_2,'w',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,&amp;<a name='3377'>
&amp;kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3378'>
          else<a name='3379'>
            call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_38">( w_2,rw_tend,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='3380'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3381'>
          endif<a name='3382'>
        endif<a name='3383'>
      endif<a name='3384'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_14">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,iteration,ids,ide,jds,jde,&amp;<a name='3385'>
&amp;kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3386'>
BENCH_END(comp60)<a name='3387'>
<a name='3388'>
BENCH_START(exch56)<a name='3389'>
#ifdef DM_PARALLEL<a name='3390'>
lineno = __LINE__<a name='3391'>
#      include "<A href='../../html_code/include/HALO_2441.inc.html'>HALO_2441.inc</A>"<A NAME="HALO_2441.inc_113"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3392'>
<a name='3393'>
#endif<a name='3394'>
BENCH_END(exch56)<a name='3395'>
<a name='3396'>
  end do small_stepzz<a name='3397'>
<a name='3398'>
 endif restore_small_stepzz<a name='3399'>
<a name='3400'>
 endif restore_rktend_thru_sszz<a name='3401'>
<a name='3402'>
<font color=#447700>!------------------------------------------------------<a name='3403'></font>
<a name='3404'>
BENCH_START(comp61)<a name='3405'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_MU_UV_1'>calc_mu_uv_1</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_MU_UV_1_8">( config_flags,muts,muus,muvs,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='3406'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3407'>
BENCH_END(comp61)<a name='3408'>
<a name='3409'>
BENCH_START(exch57)<a name='3410'>
#ifdef DM_PARALLEL<a name='3411'>
<a name='3412'>
<a name='3413'>
#endif<a name='3414'>
BENCH_END(exch57)<a name='3415'>
<a name='3416'>
<font color=#447700>! recompute : muus,muvs<a name='3417'></font>
<a name='3418'>
BENCH_START(comp62)<a name='3419'>
    call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SMALL_STEP_FINISH'>a_small_step_finish</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SMALL_STEP_FINISH_2">( u_2,a_u_2,v_2,a_v_2,w_2,a_w_2,t_2,a_t_2,a_ph_2,a_mu_2,mut,a_mut,muts,a_muts,muu,a_muu,muus,a_muus,&amp;<a name='3420'>
&amp;muv,a_muv,muvs,a_muvs,u_save,a_u_save,v_save,a_v_save,w_save,a_w_save,t_save,a_t_save,a_ph_save,a_mu_save,msfu,msfv,msft,ide,&amp;<a name='3421'>
&amp;jde,kds,kde,ims,ime,jms,jme,kms,kme, &amp;<a name='3422'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='3423'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='3424'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='3425'>
        min(grid%j_end(ij)+1,jde) )<a name='3426'>
BENCH_END(comp62)<a name='3427'>
<a name='3428'>
<a name='3429'>
BENCH_START(exch58)<a name='3430'>
#ifdef DM_PARALLEL<a name='3431'>
lineno = __LINE__<a name='3432'>
#  include "<A href='../../html_code/include/HALO_2474.inc.html'>HALO_2474.inc</A>"<A NAME="HALO_2474.inc_114"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3433'>
#endif<a name='3434'>
BENCH_END(exch58)<a name='3435'>
<a name='3436'>
BENCH_START(comp63)<a name='3437'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_CALC_MU_UV_1'>a_calc_mu_uv_1</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_MU_UV_1_2">( config_flags,a_muts,a_muus,a_muvs,ids,ide,jds,jde,ims,ime,jms,jme, &amp;<a name='3438'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='3439'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='3440'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='3441'>
        min(grid%j_end(ij)+1,jde) )<a name='3442'>
BENCH_END(comp63)<a name='3443'>
<a name='3444'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='3445'></font>
#ifndef NO_HALO_FIX<a name='3446'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 63<a name='3447'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_115"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3448'>
#endif<a name='3449'>
<a name='3450'>
<font color=#447700>!------------------------------<a name='3451'></font>
<font color=#447700>!------------------------------<a name='3452'></font>
<a name='3453'>
  a_small_steps: do iteration = number_of_small_timesteps, 1, -1<a name='3454'>
<a name='3455'>
BENCH_START(comp64)<a name='3456'>
#ifndef FAST_CPY<a name='3457'>
<font color=#447700>!------------------------------<a name='3458'></font>
  ww_m(:,:,:) = ww_m_keep3(:,:,:)<a name='3459'>
  rv_m(:,:,:) = rv_m_keep3(:,:,:)<a name='3460'>
  ru_m(:,:,:) = ru_m_keep3(:,:,:)<a name='3461'>
  a(:,:,:) = a_keep3(:,:,:)<a name='3462'>
  alpha(:,:,:) = alpha_keep3(:,:,:)<a name='3463'>
  gamma(:,:,:) = gamma_keep3(:,:,:)<a name='3464'>
<font color=#447700>!------------------------------<a name='3465'></font>
<a name='3466'>
  xkmhd(:,:,:) = xkmhdh(:,:,:)<a name='3467'>
  w_2(:,:,:) = w_2h(:,:,:)<a name='3468'>
  w_1(:,:,:) = w_1h(:,:,:)<a name='3469'>
  v_2(:,:,:) = v_2h(:,:,:)<a name='3470'>
  v_1(:,:,:) = v_1h(:,:,:)<a name='3471'>
  u_2(:,:,:) = u_2h(:,:,:)<a name='3472'>
  u_1(:,:,:) = u_1h(:,:,:)<a name='3473'>
  t_tendf(:,:,:) = t_tendfh(:,:,:)<a name='3474'>
  t_2(:,:,:) = t_2h(:,:,:)<a name='3475'>
  t_1(:,:,:) = t_1h(:,:,:)<a name='3476'>
  rw_tendf(:,:,:) = rw_tendfh(:,:,:)<a name='3477'>
  rv_tendf(:,:,:) = rv_tendfh(:,:,:)<a name='3478'>
  ru_tendf(:,:,:) = ru_tendfh(:,:,:)<a name='3479'>
  pm1(:,:,:) = pm1h(:,:,:)<a name='3480'>
  ph_tendf(:,:,:) = ph_tendfh(:,:,:)<a name='3481'>
  ph_2(:,:,:) = ph_2h(:,:,:)<a name='3482'>
  ph_1(:,:,:) = ph_1h(:,:,:)<a name='3483'>
  p(:,:,:) = ph(:,:,:)<a name='3484'>
  mu_2(:,:) = mu_2h(:,:)<a name='3485'>
  mu_1(:,:) = mu_1h(:,:)<a name='3486'>
  moist_tend(:,:,:,:) = moist_tendh(:,:,:,:)<a name='3487'>
  moist_2(:,:,:,:) = moist_2h(:,:,:,:)<a name='3488'>
  moist_1(:,:,:,:) = moist_1h(:,:,:,:)<a name='3489'>
  dnw(:) = dnwh(:)<a name='3490'>
  al(:,:,:) = alh(:,:,:)<a name='3491'>
#else<a name='3492'>
<a name='3493'>
<font color=#447700>!------------------------------<a name='3494'></font>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_199">( ww_m , ww_m_keep3 , n3d_elem )<a name='3495'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_200">( rv_m , rv_m_keep3 , n3d_elem )<a name='3496'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_201">( ru_m , ru_m_keep3 , n3d_elem )<a name='3497'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_202">( a , a_keep3 , n3d_elem )<a name='3498'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_203">( alpha , alpha_keep3 , n3d_elem )<a name='3499'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_204">( gamma , gamma_keep3 , n3d_elem )<a name='3500'>
<font color=#447700>!------------------------------<a name='3501'></font>
<a name='3502'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_205">( xkmhd , xkmhdh , n3d_elem )<a name='3503'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_206">( w_2 , w_2h , n3d_elem )<a name='3504'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_207">( w_1 , w_1h , n3d_elem )<a name='3505'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_208">( v_2 , v_2h , n3d_elem )<a name='3506'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_209">( v_1 , v_1h , n3d_elem )<a name='3507'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_210">( u_2 , u_2h , n3d_elem )<a name='3508'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_211">( u_1 , u_1h , n3d_elem )<a name='3509'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_212">( t_tendf , t_tendfh , n3d_elem )<a name='3510'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_213">( t_2 , t_2h , n3d_elem )<a name='3511'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_214">( t_1 , t_1h , n3d_elem )<a name='3512'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_215">( rw_tendf , rw_tendfh , n3d_elem )<a name='3513'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_216">( rv_tendf , rv_tendfh , n3d_elem )<a name='3514'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_217">( ru_tendf , ru_tendfh , n3d_elem )<a name='3515'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_218">( pm1 , pm1h , n3d_elem )<a name='3516'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_219">( ph_tendf , ph_tendfh , n3d_elem )<a name='3517'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_220">( ph_2 , ph_2h , n3d_elem )<a name='3518'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_221">( ph_1 , ph_1h , n3d_elem )<a name='3519'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_222">( p , ph , n3d_elem )<a name='3520'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_223">( mu_2 , mu_2h , n2d_elem )<a name='3521'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_224">( mu_1 , mu_1h , n2d_elem )<a name='3522'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_225">( moist_tend(ims,kms,jms,2) , moist_tendh(ims,kms,jms,2) , n3d_elem * (num_moist - 1) )<a name='3523'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_226">( moist_2(ims,kms,jms,2) , moist_2h(ims,kms,jms,2) , n3d_elem  * (num_moist - 1) )<a name='3524'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_227">( moist_1(ims,kms,jms,2) , moist_1h(ims,kms,jms,2) , n3d_elem  * (num_moist - 1) )<a name='3525'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_228">( dnw , dnwh, kme-kms+1 )<a name='3526'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_229">( al , alh , n3d_elem )<a name='3527'>
<a name='3528'>
#endif<a name='3529'>
BENCH_END(comp64)<a name='3530'>
<a name='3531'>
BENCH_START(exch59)<a name='3532'>
#ifdef DM_PARALLEL<a name='3533'>
lineno = __LINE__<a name='3534'>
#    include "<A href='../../html_code/include/HALO_2527.inc.html'>HALO_2527.inc</A>"<A NAME="HALO_2527.inc_116"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3535'>
<a name='3536'>
<a name='3537'>
<a name='3538'>
<a name='3539'>
<a name='3540'>
#endif<a name='3541'>
BENCH_END(exch59)<a name='3542'>
<a name='3543'>
BENCH_START(comp65)<a name='3544'>
<font color=#447700>!----------------------------------------<a name='3545'></font>
  mudf(:,:) = mudf_ma(:,:)<a name='3546'>
<font color=#447700>!----------------------------------------<a name='3547'></font>
  dtm = dt<a name='3548'>
  if (rk_order .eq. 1) then<a name='3549'>
    if (step_number .ne. 1) then<a name='3550'>
      number_of_small_timesteps = 2*time_step_sound<a name='3551'>
      dt_rk = dt<a name='3552'>
      dtm = 2*dt<a name='3553'>
    else<a name='3554'>
      number_of_small_timesteps = time_step_sound<a name='3555'>
      dt_rk = dt/2.<a name='3556'>
      dtm = dt<a name='3557'>
    endif<a name='3558'>
    dts_rk = dts<a name='3559'>
  else if (rk_order .eq. 2) then<a name='3560'>
    if (rk_step .eq. 1) then<a name='3561'>
      dt_rk = 0.5*dt<a name='3562'>
      dts_rk = dts<a name='3563'>
      number_of_small_timesteps = time_step_sound/2<a name='3564'>
    else<a name='3565'>
      dt_rk = dt<a name='3566'>
      dts_rk = dts<a name='3567'>
      number_of_small_timesteps = time_step_sound<a name='3568'>
    endif<a name='3569'>
  else if (rk_order .eq. 3) then<a name='3570'>
    if (rk_step .eq. 1) then<a name='3571'>
      dt_rk = dt/3.<a name='3572'>
      dts_rk = dt_rk<a name='3573'>
      number_of_small_timesteps = 1<a name='3574'>
    else if (rk_step .eq. 2) then<a name='3575'>
      dt_rk = 0.5*dt<a name='3576'>
      dts_rk = dts<a name='3577'>
      number_of_small_timesteps = time_step_sound/2<a name='3578'>
    else<a name='3579'>
      dt_rk = dt<a name='3580'>
      dts_rk = dts<a name='3581'>
      number_of_small_timesteps = time_step_sound<a name='3582'>
    endif<a name='3583'>
  endif<a name='3584'>
<font color=#447700>! recompute : dt_rk,dts_rk,number_of_small_timesteps<a name='3585'></font>
BENCH_END(comp65)<a name='3586'>
<a name='3587'>
BENCH_START(exch60)<a name='3588'>
#ifdef DM_PARALLEL<a name='3589'>
lineno = __LINE__<a name='3590'>
<a name='3591'>
#endif<a name='3592'>
BENCH_END(exch60)<a name='3593'>
<a name='3594'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='3595'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_step_prep.  <a name='3596'></font>
 restore_rk_step_prepzr: if ( config_flags%remove_rk_step_prep ) then<a name='3597'>
BENCH_START(comprestore_rk_step_prep_tim)<a name='3598'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rk_step_prepzr:  rk_step, rk_order = ',rk_step,rk_order<a name='3599'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_42"> ( 10 , TRIM(wrf_err_message) )<a name='3600'>
   <font color=#447700>! store fields<a name='3601'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_19">(rk_step, BUF_RK_STEP_PREP)<a name='3602'>
#include "<A href='../../html_code/include/restore_rk_step_prep.h.html'>restore_rk_step_prep.h</A>"<A NAME="restore_rk_step_prep.h_117"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3603'>
BENCH_END(comprestore_rk_step_prep_tim)<a name='3604'>
 else  <font color=#447700>! restore_rk_step_prepzr<a name='3605'></font>
<a name='3606'>
BENCH_START(comp66)<a name='3607'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_9">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='3608'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='3609'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3610'>
BENCH_END(comp66)<a name='3611'>
<a name='3612'>
 endif restore_rk_step_prepzr<a name='3613'>
<a name='3614'>
BENCH_START(exch61)<a name='3615'>
#ifdef DM_PARALLEL<a name='3616'>
lineno = __LINE__<a name='3617'>
#    include "<A href='../../html_code/include/HALO_2588.inc.html'>HALO_2588.inc</A>"<A NAME="HALO_2588.inc_118"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3618'>
#endif<a name='3619'>
<a name='3620'>
#ifdef DM_PARALLEL<a name='3621'>
lineno = __LINE__<a name='3622'>
#    include "<A href='../../html_code/include/HALO_2593.inc.html'>HALO_2593.inc</A>"<A NAME="HALO_2593.inc_119"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3623'>
#endif<a name='3624'>
BENCH_END(exch61)<a name='3625'>
<a name='3626'>
  rk_step_is_onzd: if (rk_step .eq. 1) then<a name='3627'>
<a name='3628'>
BENCH_START(comp67)<a name='3629'>
      call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_9">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,rk_step,&amp;<a name='3630'>
&amp;ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3631'>
BENCH_END(comp67)<a name='3632'>
<a name='3633'>
BENCH_START(exch62)<a name='3634'>
#ifdef DM_PARALLEL<a name='3635'>
lineno = __LINE__<a name='3636'>
#     include "<A href='../../html_code/include/HALO_2605.inc.html'>HALO_2605.inc</A>"<A NAME="HALO_2605.inc_120"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3637'>
#endif<a name='3638'>
BENCH_END(exch62)<a name='3639'>
<a name='3640'>
BENCH_START(comp68)<a name='3641'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_9">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,v_phy,&amp;<a name='3642'>
&amp;p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,rqccuten,&amp;<a name='3643'>
&amp;rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='3644'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3645'>
BENCH_END(comp68)<a name='3646'>
<a name='3647'>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='3648'>
<a name='3649'>
BENCH_START(exch63)<a name='3650'>
#ifdef DM_PARALLEL<a name='3651'>
lineno = __LINE__<a name='3652'>
<a name='3653'>
<a name='3654'>
<a name='3655'>
<a name='3656'>
#endif<a name='3657'>
BENCH_END(exch63)<a name='3658'>
BENCH_START(comp69)<a name='3659'>
        call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_9">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='3660'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='3661'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='3662'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3663'>
BENCH_END(comp69)<a name='3664'>
<a name='3665'>
    endif<a name='3666'>
  endif rk_step_is_onzd<a name='3667'>
<a name='3668'>
BENCH_START(exch64)<a name='3669'>
#ifdef DM_PARALLEL<a name='3670'>
lineno = __LINE__<a name='3671'>
#     include "<A href='../../html_code/include/HALO_2636.inc.html'>HALO_2636.inc</A>"<A NAME="HALO_2636.inc_121"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3672'>
<a name='3673'>
<a name='3674'>
<a name='3675'>
#endif<a name='3676'>
BENCH_END(exch64)<a name='3677'>
<a name='3678'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='3679'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_tendency.  <a name='3680'></font>
 restore_rktendzr: if ( config_flags%remove_rktend ) then<a name='3681'>
BENCH_START(comprestore_rktend_tim)<a name='3682'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktendzr:  rk_step, rk_order = ',rk_step,rk_order<a name='3683'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_43"> ( 10 , TRIM(wrf_err_message) )<a name='3684'>
   <font color=#447700>! store fields<a name='3685'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_20">(rk_step, BUF_RKTEND)<a name='3686'>
#include "<A href='../../html_code/include/restore_rktend.h.html'>restore_rktend.h</A>"<A NAME="restore_rktend.h_122"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3687'>
BENCH_END(comprestore_rktend_tim)<a name='3688'>
 else  <font color=#447700>! restore_rktendzr<a name='3689'></font>
<a name='3690'>
WRITE(wrf_err_message,*) 'DEBUG:  calling rk_tendency before_small_stepzr, rk_step = ',rk_step<a name='3691'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_44">( 10, TRIM(wrf_err_message) )<a name='3692'>
BENCH_START(comp7776)<a name='3693'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_9">( config_flags,rk_step,ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,&amp;<a name='3694'>
&amp;mu_tend,u_save,v_save,w_save,ph_save,t_save,mu_save,rthften,ru,rv,rw,ww,u_2,v_2,w_2,t_2,ph_2,u_1,v_1,w_1,t_1,ph_1,h_diabatic,&amp;<a name='3695'>
&amp;phb,t_init,mu_2,mut,muu,muv,mub,al,alt,p,pb,php,cqu,cqv,cqw,u_base,v_base,t_base,qv_base,z_base,msfu,msfv,msft,f,e,sina,cosa,&amp;<a name='3696'>
&amp;fnm,fnp,rdn,rdnw,dt,rdx,rdy,khdif,kvdif,xkmhd,cf1,cf2,cf3,cfn,cfn1,num_3d_m,non_hydrostatic,leapfrog,ids,ide,jds,jde,kds,kde,&amp;<a name='3697'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3698'>
BENCH_END(comp7776)<a name='3699'>
<a name='3700'>
 endif restore_rktendzr<a name='3701'>
<a name='3702'>
BENCH_START(comp70_relax_bdy_dry)<a name='3703'>
    if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='3704'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_DRY'>relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_DRY_9">( config_flags,u_save,v_save,ph_save,t_save,w_save,mu_tend,ru,rv,ph_2,t_2,w_2,mu_2,mut,u_b,v_b,ph_b,t_b,&amp;<a name='3705'>
&amp;w_b,mu_b,u_bt,v_bt,ph_bt,t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,kde,&amp;<a name='3706'>
&amp;ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3707'>
    endif<a name='3708'>
BENCH_END(comp70_relax_bdy_dry)<a name='3709'>
BENCH_START(comp70_rk_addtend_dry)<a name='3710'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_ADDTEND_DRY'>rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_ADDTEND_DRY_9">( ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,u_save,v_save,w_save,&amp;<a name='3711'>
&amp;ph_save,t_save,rk_step,h_diabatic,mut,msft,msfu,msfv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='3712'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3713'>
BENCH_END(comp70_rk_addtend_dry)<a name='3714'>
BENCH_START(comp70_spec_bdy_dry)<a name='3715'>
    if (config_flags%specified .or. config_flags%nested) then<a name='3716'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_DRY'>spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_DRY_9">( config_flags,ru_tend,rv_tend,ph_tend,t_tend,rw_tend,mu_tend,u_b,v_b,ph_b,t_b,w_b,mu_b,u_bt,v_bt,ph_bt,&amp;<a name='3717'>
&amp;t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='3718'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3719'>
    endif<a name='3720'>
BENCH_END(comp70_spec_bdy_dry)<a name='3721'>
<a name='3722'>
BENCH_START(comp70_small_step_prep)<a name='3723'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_PREP'>small_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_PREP_9">( u_1,u_2,v_1,v_2,w_1,w_2,t_1,t_2,ph_1,ph_2,mub,mu_1,mu_2,muu,muus,muv,muvs,mut,muts,mudf,u_save,v_save,&amp;<a name='3724'>
&amp;w_save,t_save,ph_save,mu_save,ww,ww1,dnw,c2a,pb,p,alt,msfu,msfv,msft,rk_step,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='3725'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3726'>
BENCH_END(comp70_small_step_prep)<a name='3727'>
BENCH_START(comp70_calc_p_rho)<a name='3728'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_15">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,0,ids,ide,jds,jde,kds,kde,&amp;<a name='3729'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3730'>
BENCH_END(comp70_calc_p_rho)<a name='3731'>
BENCH_START(comp70_calc_coef_w)<a name='3732'>
    if (non_hydrostatic) then<a name='3733'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_COEF_W'>calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_COEF_W_9">( a,alpha,gamma,mut,cqw,rdn,rdnw,c2a,dts,g,epssm,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='3734'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3735'>
    endif<a name='3736'>
BENCH_END(comp70_calc_coef_w)<a name='3737'>
<a name='3738'>
BENCH_START(exch65)<a name='3739'>
#ifdef DM_PARALLEL<a name='3740'>
lineno = __LINE__<a name='3741'>
#      include "<A href='../../html_code/include/HALO_2676.inc.html'>HALO_2676.inc</A>"<A NAME="HALO_2676.inc_123"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3742'>
<a name='3743'>
#endif<a name='3744'>
BENCH_END(exch65)<a name='3745'>
<a name='3746'>
    small_stepzr: do iteration1 = 1, iteration-1<a name='3747'>
WRITE(wrf_err_message,*) 'DEBUG:  begin small_stepzr, iteration1 = ',iteration1<a name='3748'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_45">( 10, TRIM(wrf_err_message) )<a name='3749'>
<a name='3750'>
BENCH_START(comp71)<a name='3751'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_UV'>advance_uv</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_UV_9">( u_2,ru_tend,v_2,rv_tend,p,pb,ph_2,php,alt,al,mu_2,muu,cqu,muv,cqv,mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,&amp;<a name='3752'>
&amp;emdiv,rdnw,config_flags,spec_zone,non_hydrostatic,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='3753'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3754'>
        if (config_flags%specified .or. config_flags%nested) then<a name='3755'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_39">( u_2,ru_tend,dts_rk,'u',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='3756'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3757'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_40">( v_2,rv_tend,dts_rk,'v',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='3758'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3759'>
        endif<a name='3760'>
BENCH_END(comp71)<a name='3761'>
<a name='3762'>
BENCH_START(exch66)<a name='3763'>
#ifdef DM_PARALLEL<a name='3764'>
lineno = __LINE__<a name='3765'>
#     include "<A href='../../html_code/include/HALO_2696.inc.html'>HALO_2696.inc</A>"<A NAME="HALO_2696.inc_124"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3766'>
#endif<a name='3767'>
BENCH_END(exch66)<a name='3768'>
<a name='3769'>
BENCH_START(comp72)<a name='3770'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_MU_T'>advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_MU_T_9">( ww,ww1,u_2,u_save,v_2,v_save,mu_2,mut,muave,muts,muu,muv,mudf,ru_m,rv_m,ww_m,t_2,t_save,t_2save,t_tend,&amp;<a name='3771'>
&amp;mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,msfv,msft,iteration1,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='3772'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3773'>
        if (config_flags%specified .or. config_flags%nested) then<a name='3774'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_41">( t_2,t_tend,dts_rk,'t',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,&amp;<a name='3775'>
&amp;ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3776'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_42">( mu_2,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='3777'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='3778'>
          call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_43">( muts,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='3779'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='3780'>
        endif<a name='3781'>
BENCH_END(comp72)<a name='3782'>
<a name='3783'>
BENCH_START(exch67)<a name='3784'>
#ifdef DM_PARALLEL<a name='3785'>
lineno = __LINE__<a name='3786'>
#include "<A href='../../html_code/include/HALO_2715.inc.html'>HALO_2715.inc</A>"<A NAME="HALO_2715.inc_125"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3787'>
<a name='3788'>
<a name='3789'>
<a name='3790'>
<a name='3791'>
#endif<a name='3792'>
BENCH_END(exch67)<a name='3793'>
<a name='3794'>
BENCH_START(comp73)<a name='3795'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SUMFLUX'>sumflux</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUMFLUX_9">( u_2,v_2,ww,u_save,v_save,ww1,muu,muv,ru_m,rv_m,ww_m,epssm,msfu,msfv,iteration1,number_of_small_timesteps,ids,&amp;<a name='3796'>
&amp;ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3797'>
<a name='3798'>
        if (non_hydrostatic) then<a name='3799'>
          call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_W'>advance_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_W_9">( w_2,rw_tend,ww,u_2,v_2,mu_2,mut,muave,muts,t_2save,t_2,t_save,ph_2,ph_save,phb,ph_tend,ht,c2a,cqw,alt,&amp;<a name='3800'>
&amp;alb,a,alpha,gamma,rdx,rdy,dts,t0,epssm,dnw,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,ide,jds,jde,kds,kde,ims,&amp;<a name='3801'>
&amp;ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3802'>
        endif<a name='3803'>
<a name='3804'>
        if (config_flags%specified .or. config_flags%nested) then<a name='3805'>
          if (non_hydrostatic) then<a name='3806'>
            call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDYUPDATE_PH'>spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_PH_9">( ph_save,ph_2,ph_tend,mu_tend,muts,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,&amp;<a name='3807'>
&amp;ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3808'>
            if (config_flags%specified) then<a name='3809'>
<a name='3810'>
               CALL <A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY'>zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_GRAD_BDY_7"> ( w_2,                        &amp;<a name='3811'>
                                    'w'         , config_flags, &amp;<a name='3812'>
                                    spec_zone,                  &amp;<a name='3813'>
                                    ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='3814'></font>
                                    ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='3815'></font>
                                    ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='3816'></font>
                                    grid%i_start(ij), grid%i_end(ij),         &amp;<a name='3817'>
                                    grid%j_start(ij), grid%j_end(ij),         &amp;<a name='3818'>
                                    k_start    , k_end             )<a name='3819'>
<a name='3820'>
            else<a name='3821'>
              call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_44">( w_2,rw_tend,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='3822'>
&amp;ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3823'>
            endif<a name='3824'>
          endif<a name='3825'>
        endif<a name='3826'>
<a name='3827'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_16">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,iteration1,ids,ide,jds,&amp;<a name='3828'>
&amp;jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3829'>
BENCH_END(comp73)<a name='3830'>
<a name='3831'>
<a name='3832'>
BENCH_START(exch68)<a name='3833'>
#ifdef DM_PARALLEL<a name='3834'>
lineno = __LINE__<a name='3835'>
#      include "<A href='../../html_code/include/HALO_2762.inc.html'>HALO_2762.inc</A>"<A NAME="HALO_2762.inc_126"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3836'>
<a name='3837'>
#endif<a name='3838'>
BENCH_END(exch68)<a name='3839'>
<a name='3840'>
    end do small_stepzr<a name='3841'>
<a name='3842'>
<font color=#447700>!----------------------------------------<a name='3843'></font>
BENCH_START(exch69)<a name='3844'>
#ifdef DM_PARALLEL<a name='3845'>
lineno = __LINE__<a name='3846'>
#      include "<A href='../../html_code/include/HALO_2773.inc.html'>HALO_2773.inc</A>"<A NAME="HALO_2773.inc_127"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3847'>
#endif<a name='3848'>
BENCH_END(exch69)<a name='3849'>
BENCH_START(comp74)<a name='3850'>
#ifndef FAST_CPY<a name='3851'>
alq(:,:,:) = al(:,:,:)<a name='3852'>
mu_2q(:,:) = mu_2(:,:)<a name='3853'>
pq(:,:,:) = p(:,:,:)<a name='3854'>
ph_2q(:,:,:) = ph_2(:,:,:)<a name='3855'>
#else<a name='3856'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_230"> ( alq , al , n3d_elem ) <a name='3857'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_231"> ( mu_2q , mu_2 , n2d_elem ) <a name='3858'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_232"> ( pq , p , n3d_elem ) <a name='3859'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_233"> ( ph_2q , ph_2 , n3d_elem ) <a name='3860'>
#endif<a name='3861'>
BENCH_END(comp74)<a name='3862'>
<a name='3863'>
BENCH_START(exch70)<a name='3864'>
#ifdef DM_PARALLEL<a name='3865'>
lineno = __LINE__<a name='3866'>
#      include "<A href='../../html_code/include/HALO_2784.inc.html'>HALO_2784.inc</A>"<A NAME="HALO_2784.inc_128"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3867'>
#endif<a name='3868'>
BENCH_END(exch70)<a name='3869'>
<a name='3870'>
BENCH_START(comp75)<a name='3871'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_UV'>advance_uv</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_UV_10">( u_2,ru_tend,v_2,rv_tend,p,pb,ph_2,php,alt,al,mu_2,muu,cqu,muv,cqv,mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,&amp;<a name='3872'>
&amp;emdiv,rdnw,config_flags,spec_zone,non_hydrostatic,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='3873'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3874'>
      if (config_flags%specified .or. config_flags%nested) then<a name='3875'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_45">( u_2,ru_tend,dts_rk,'u',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='3876'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3877'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_46">( v_2,rv_tend,dts_rk,'v',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='3878'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3879'>
      endif<a name='3880'>
BENCH_END(comp75)<a name='3881'>
<a name='3882'>
<font color=#447700>!----------------------------------------<a name='3883'></font>
BENCH_START(exch71)<a name='3884'>
#ifdef DM_PARALLEL<a name='3885'>
lineno = __LINE__<a name='3886'>
#       include "<A href='../../html_code/include/HALO_2802.inc.html'>HALO_2802.inc</A>"<A NAME="HALO_2802.inc_129"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3887'>
#endif<a name='3888'>
BENCH_END(exch71)<a name='3889'>
BENCH_START(comp76)<a name='3890'>
#ifndef FAST_CPY<a name='3891'>
wwr(:,:,:) = ww(:,:,:)<a name='3892'>
u_2r(:,:,:) = u_2(:,:,:)<a name='3893'>
v_2r(:,:,:) = v_2(:,:,:)<a name='3894'>
#else<a name='3895'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_234"> ( wwr , ww , n3d_elem )<a name='3896'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_235"> ( u_2r , u_2 , n3d_elem )<a name='3897'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_236"> ( v_2r , v_2 , n3d_elem )<a name='3898'>
#endif<a name='3899'>
BENCH_END(comp76)<a name='3900'>
<a name='3901'>
BENCH_START(exch71b)<a name='3902'>
#ifdef DM_PARALLEL<a name='3903'>
lineno = __LINE__<a name='3904'>
#     include "<A href='../../html_code/include/HALO_2810.inc.html'>HALO_2810.inc</A>"<A NAME="HALO_2810.inc_130"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3905'>
#endif<a name='3906'>
BENCH_END(exch71b)<a name='3907'>
<a name='3908'>
BENCH_START(comp77)<a name='3909'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_MU_T'>advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_MU_T_10">( ww,ww1,u_2,u_save,v_2,v_save,mu_2,mut,muave,muts,muu,muv,mudf,ru_m,rv_m,ww_m,t_2,t_save,t_2save,t_tend,&amp;<a name='3910'>
&amp;mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,msfv,msft,iteration,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='3911'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3912'>
BENCH_END(comp77)<a name='3913'>
<a name='3914'>
BENCH_START(exch72)<a name='3915'>
#ifdef DM_PARALLEL<a name='3916'>
lineno = __LINE__<a name='3917'>
#    include "<A href='../../html_code/include/HALO_2821.inc.html'>HALO_2821.inc</A>"<A NAME="HALO_2821.inc_131"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3918'>
<a name='3919'>
<a name='3920'>
<a name='3921'>
<a name='3922'>
#endif<a name='3923'>
BENCH_END(exch72)<a name='3924'>
<a name='3925'>
BENCH_START(comp78)<a name='3926'>
      if (config_flags%specified .or. config_flags%nested) then<a name='3927'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_47">( t_2,t_tend,dts_rk,'t',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,&amp;<a name='3928'>
&amp;jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3929'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_48">( mu_2,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='3930'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='3931'>
        call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_49">( muts,mu_tend,dts_rk,'m',config_flags,spec_zone,ids,ide,jds,jde,1,1,ims,ime,jms,jme,1,1,ips,ipe,jps,&amp;<a name='3932'>
&amp;jpe,1,1,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='3933'>
      endif<a name='3934'>
<a name='3935'>
      call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SUMFLUX'>sumflux</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUMFLUX_10">( u_2,v_2,ww,u_save,v_save,ww1,muu,muv,ru_m,rv_m,ww_m,epssm,msfu,msfv,iteration,number_of_small_timesteps,ids,&amp;<a name='3936'>
&amp;ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3937'>
BENCH_END(comp78)<a name='3938'>
<a name='3939'>
BENCH_START(exch73)<a name='3940'>
#ifdef DM_PARALLEL<a name='3941'>
lineno = __LINE__<a name='3942'>
#       include "<A href='../../html_code/include/HALO_2844.inc.html'>HALO_2844.inc</A>"<A NAME="HALO_2844.inc_132"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3943'>
#endif<a name='3944'>
BENCH_END(exch73)<a name='3945'>
<font color=#447700>!----------------------------------------<a name='3946'></font>
#ifndef FAST_CPY<a name='3947'>
w_2s(:,:,:) = w_2(:,:,:)<a name='3948'>
wws(:,:,:) = ww(:,:,:)<a name='3949'>
u_2s(:,:,:) = u_2(:,:,:)<a name='3950'>
v_2s(:,:,:) = v_2(:,:,:)<a name='3951'>
mu_2s(:,:) = mu_2(:,:)<a name='3952'>
t_2s(:,:,:) = t_2(:,:,:)<a name='3953'>
ph_2s(:,:,:) = ph_2(:,:,:)<a name='3954'>
as(:,:,:) = a(:,:,:)<a name='3955'>
t_2saves(:,:,:) = t_2save(:,:,:) <a name='3956'>
#else<a name='3957'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_237">( w_2s , w_2 , n3d_elem )<a name='3958'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_238">( wws , ww , n3d_elem )<a name='3959'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_239">( u_2s , u_2 , n3d_elem )<a name='3960'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_240">( v_2s , v_2 , n3d_elem )<a name='3961'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_241">( mu_2s , mu_2 , n2d_elem )<a name='3962'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_242">( t_2s , t_2 , n3d_elem )<a name='3963'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_243">( ph_2s , ph_2 , n3d_elem )<a name='3964'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_244">( as , a , n3d_elem )<a name='3965'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_245">( t_2saves , t_2save , n3d_elem )<a name='3966'>
#endif<a name='3967'>
<a name='3968'>
BENCH_START(comp79)<a name='3969'>
      if (non_hydrostatic) then<a name='3970'>
        call <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_W'>advance_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_W_10">( w_2,rw_tend,ww,u_2,v_2,mu_2,mut,muave,muts,t_2save,t_2,t_save,ph_2,ph_save,phb,ph_tend,ht,c2a,cqw,alt,alb,&amp;<a name='3971'>
&amp;a,alpha,gamma,rdx,rdy,dts,t0,epssm,dnw,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,ide,jds,jde,kds,kde,ims,ime,jms,&amp;<a name='3972'>
&amp;jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3973'>
      endif<a name='3974'>
      if (config_flags%specified .or. config_flags%nested) then<a name='3975'>
        if (non_hydrostatic) then<a name='3976'>
<a name='3977'>
          call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDYUPDATE_PH'>spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_PH_10">( ph_save,ph_2,ph_tend,mu_tend,muts,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,&amp;<a name='3978'>
&amp;ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3979'>
          if (config_flags%specified) then<a name='3980'>
            call <A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY'>zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_GRAD_BDY_8">( w_2,'w',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,&amp;<a name='3981'>
&amp;kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3982'>
          else<a name='3983'>
            call <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_50">( w_2,rw_tend,dts_rk,'h',config_flags,spec_zone,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='3984'>
&amp;ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='3985'>
          endif<a name='3986'>
        endif<a name='3987'>
      endif<a name='3988'>
BENCH_END(comp79)<a name='3989'>
<a name='3990'>
BENCH_START(exch74)<a name='3991'>
#ifdef DM_PARALLEL<a name='3992'>
lineno = __LINE__<a name='3993'>
#    include "<A href='../../html_code/include/HALO_2881.inc.html'>HALO_2881.inc</A>"<A NAME="HALO_2881.inc_133"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3994'>
<a name='3995'>
<a name='3996'>
<a name='3997'>
<a name='3998'>
<a name='3999'>
<a name='4000'>
<a name='4001'>
<a name='4002'>
#endif<a name='4003'>
BENCH_END(exch74)<a name='4004'>
<a name='4005'>
BENCH_START(comp80)<a name='4006'>
      call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_P_RHO'>a_calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_P_RHO_2">( al,a_al,p,a_p,ph_2,a_ph_2,alt,a_alt,t_2,a_t_2,t_save,a_t_save,c2a,a_c2a,a_pm1,mu_2,a_mu_2,muts,a_muts,znu,&amp;<a name='4007'>
&amp;t0,rdnw,dnw,smdiv,non_hydrostatic,iteration,ide,jde,kde,ims,ime,jms,jme,kms,kme, &amp;<a name='4008'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='4009'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4010'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4011'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='4012'>
BENCH_END(comp80)<a name='4013'>
<a name='4014'>
BENCH_START(exch75)<a name='4015'>
#ifdef DM_PARALLEL<a name='4016'>
lineno = __LINE__<a name='4017'>
#    include "<A href='../../html_code/include/HALO_2903.inc.html'>HALO_2903.inc</A>"<A NAME="HALO_2903.inc_134"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4018'>
<a name='4019'>
<a name='4020'>
<a name='4021'>
<a name='4022'>
<a name='4023'>
<a name='4024'>
<a name='4025'>
<a name='4026'>
#endif<a name='4027'>
BENCH_END(exch75)<a name='4028'>
<a name='4029'>
BENCH_START(comp81)<a name='4030'>
      if (config_flags%specified .or. config_flags%nested) then<a name='4031'>
        if (non_hydrostatic) then<a name='4032'>
          if (config_flags%specified) then<a name='4033'>
            call <A href='../../html_code/dyn_em/module_bc_ad.F.html#A_ZERO_GRAD_BDY'>a_zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ZERO_GRAD_BDY_1">( a_w_2,'w',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='4034'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='4035'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4036'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4037'>
        min(grid%j_end(ij)+1,jde),k_start)<a name='4038'>
          else<a name='4039'>
            call <A href='../../html_code/dyn_em/module_bc_ad.F.html#A_SPEC_BDYUPDATE'>a_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDYUPDATE_2">( a_w_2,a_rw_tend,dts_rk,'h',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='4040'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='4041'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4042'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4043'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='4044'>
          endif<a name='4045'>
<a name='4046'>
          call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_SPEC_BDYUPDATE_PH'>a_spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDYUPDATE_PH_2">( ph_save,a_ph_save,ph_2,a_ph_2,ph_tend,a_ph_tend,mu_tend,a_mu_tend,muts,a_muts,dts_rk,'h',&amp;<a name='4047'>
&amp;spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='4048'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='4049'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4050'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4051'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='4052'>
        endif<a name='4053'>
      endif<a name='4054'>
<a name='4055'>
<font color=#447700>!----------------------------------------<a name='4056'></font>
#ifndef FAST_CPY<a name='4057'>
w_2(:,:,:) = w_2s(:,:,:)<a name='4058'>
ww(:,:,:) = wws(:,:,:)<a name='4059'>
u_2(:,:,:) = u_2s(:,:,:)<a name='4060'>
v_2(:,:,:) = v_2s(:,:,:)<a name='4061'>
mu_2(:,:) = mu_2s(:,:)<a name='4062'>
t_2(:,:,:) = t_2s(:,:,:)<a name='4063'>
ph_2(:,:,:) = ph_2s(:,:,:)<a name='4064'>
a(:,:,:) = as(:,:,:)<a name='4065'>
t_2save(:,:,:) = t_2saves(:,:,:) <a name='4066'>
#else<a name='4067'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_246">( w_2 , w_2s , n3d_elem )<a name='4068'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_247">( ww , wws , n3d_elem )<a name='4069'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_248">( u_2 , u_2s , n3d_elem )<a name='4070'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_249">( v_2 , v_2s , n3d_elem )<a name='4071'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_250">( mu_2 , mu_2s , n2d_elem )<a name='4072'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_251">( t_2 , t_2s , n3d_elem )<a name='4073'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_252">( ph_2 , ph_2s , n3d_elem )<a name='4074'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_253">( a , as , n3d_elem )<a name='4075'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_254">( t_2save , t_2saves , n3d_elem )<a name='4076'>
#endif<a name='4077'>
BENCH_END(comp81)<a name='4078'>
<a name='4079'>
<a name='4080'>
BENCH_START(exch76)<a name='4081'>
#ifdef DM_PARALLEL<a name='4082'>
lineno = __LINE__<a name='4083'>
#  include "<A href='../../html_code/include/HALO_2955.inc.html'>HALO_2955.inc</A>"<A NAME="HALO_2955.inc_135"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4084'>
<a name='4085'>
<a name='4086'>
<a name='4087'>
<a name='4088'>
<a name='4089'>
<a name='4090'>
<a name='4091'>
<a name='4092'>
<a name='4093'>
#endif<a name='4094'>
BENCH_END(exch76)<a name='4095'>
<a name='4096'>
      if (non_hydrostatic) then<a name='4097'>
<a name='4098'>
BENCH_START(exch77)<a name='4099'>
#ifdef DM_PARALLEL<a name='4100'>
lineno = __LINE__<a name='4101'>
#  include "<A href='../../html_code/include/HALO_2973.inc.html'>HALO_2973.inc</A>"<A NAME="HALO_2973.inc_136"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4102'>
#endif<a name='4103'>
BENCH_END(exch77)<a name='4104'>
<a name='4105'>
BENCH_START(comp82)<a name='4106'>
        call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_W'>a_advance_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVANCE_W_2">( w_2,a_w_2,rw_tend,a_rw_tend,ww,a_ww,u_2,a_u_2,v_2,a_v_2,mu_2,a_mu_2,mut,a_mut,muave,a_muave,muts,a_muts,&amp;<a name='4107'>
&amp;t_2save,a_t_2save,t_2,a_t_2,t_save,a_t_save,ph_2,a_ph_2,ph_save,a_ph_save,phb,ph_tend,a_ph_tend,ht,c2a,a_c2a,cqw,a_cqw,&amp;<a name='4108'>
&amp;alt,a_alt,alb,a,a_a,alpha,a_alpha,gamma,a_gamma,rdx,rdy,dts,t0,epssm,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,&amp;<a name='4109'>
&amp;ide,jds,jde,ims,ime,jms,jme,kms,kme, &amp;<a name='4110'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='4111'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4112'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4113'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='4114'>
BENCH_END(comp82)<a name='4115'>
<a name='4116'>
      endif<a name='4117'>
<a name='4118'>
BENCH_START(exch78)<a name='4119'>
#ifdef DM_PARALLEL<a name='4120'>
lineno = __LINE__<a name='4121'>
# include "<A href='../../html_code/include/HALO_2991.inc.html'>HALO_2991.inc</A>"<A NAME="HALO_2991.inc_137"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4122'>
<a name='4123'>
<a name='4124'>
<a name='4125'>
<a name='4126'>
<a name='4127'>
<a name='4128'>
<a name='4129'>
<a name='4130'>
#endif<a name='4131'>
BENCH_END(exch78)<a name='4132'>
<a name='4133'>
BENCH_START(comp83)<a name='4134'>
      call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SUMFLUX'>a_sumflux</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SUMFLUX_2">( a_u_2,a_v_2,a_ww,u_save,a_u_save,v_save,a_v_save,a_ww1,muu,a_muu,muv,a_muv,a_ru_m,a_rv_m,a_ww_m,msfu,msfv,&amp;<a name='4135'>
&amp;iteration,number_of_small_timesteps,ide,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='4136'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='4137'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4138'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4139'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='4140'>
BENCH_END(comp83)<a name='4141'>
<a name='4142'>
BENCH_START(exch79)<a name='4143'>
#ifdef DM_PARALLEL<a name='4144'>
lineno = __LINE__<a name='4145'>
#  include "<A href='../../html_code/include/HALO_3013.inc.html'>HALO_3013.inc</A>"<A NAME="HALO_3013.inc_138"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4146'>
<a name='4147'>
<a name='4148'>
<a name='4149'>
<a name='4150'>
<a name='4151'>
<a name='4152'>
<a name='4153'>
<a name='4154'>
#endif<a name='4155'>
BENCH_END(exch79)<a name='4156'>
<a name='4157'>
BENCH_START(comp84)<a name='4158'>
      if (config_flags%specified .or. config_flags%nested) then<a name='4159'>
        call <A href='../../html_code/dyn_em/module_bc_ad.F.html#A_SPEC_BDYUPDATE'>a_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDYUPDATE_3">( a_muts,a_mu_tend,dts_rk,'m',spec_zone,ids,ide,jds,jde,1,ims,ime,jms,jme,1,1,grid%i_start(ij),grid%&amp;<a name='4160'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='4161'>
        call <A href='../../html_code/dyn_em/module_bc_ad.F.html#A_SPEC_BDYUPDATE'>a_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDYUPDATE_4">( a_mu_2,a_mu_tend,dts_rk,'m',spec_zone,ids,ide,jds,jde,1,ims,ime,jms,jme,1,1,grid%i_start(ij),grid%&amp;<a name='4162'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='4163'>
        call <A href='../../html_code/dyn_em/module_bc_ad.F.html#A_SPEC_BDYUPDATE'>a_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDYUPDATE_5">( a_t_2,a_t_tend,dts_rk,'t',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),&amp;<a name='4164'>
&amp;grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4165'>
      endif<a name='4166'>
<a name='4167'>
<font color=#447700>!----------------------------------------<a name='4168'></font>
#ifndef FAST_CPY<a name='4169'>
u_2(:,:,:) = u_2r(:,:,:)<a name='4170'>
v_2(:,:,:) = v_2r(:,:,:)<a name='4171'>
ww(:,:,:) = wwr(:,:,:)<a name='4172'>
#else<a name='4173'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_255">( u_2 , u_2r , n3d_elem )<a name='4174'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_256">( v_2 , v_2r , n3d_elem )<a name='4175'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_257">( ww , wwr , n3d_elem )<a name='4176'>
#endif<a name='4177'>
BENCH_END(comp84)<a name='4178'>
<a name='4179'>
BENCH_START(exch80)<a name='4180'>
#ifdef DM_PARALLEL<a name='4181'>
lineno = __LINE__<a name='4182'>
#  include "<A href='../../html_code/include/HALO_3042.inc.html'>HALO_3042.inc</A>"<A NAME="HALO_3042.inc_139"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4183'>
<a name='4184'>
<a name='4185'>
<a name='4186'>
<a name='4187'>
<a name='4188'>
<a name='4189'>
<a name='4190'>
<a name='4191'>
<a name='4192'>
#endif<a name='4193'>
BENCH_END(exch80)<a name='4194'>
<a name='4195'>
BENCH_START(comp85_a_advance_mu_t)<a name='4196'>
      call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_MU_T'>a_advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVANCE_MU_T_2">( ww,a_ww,ww1,a_ww1,u_2,a_u_2,u_save,a_u_save,v_2,a_v_2,v_save,a_v_save,a_mu_2,a_mut,a_muave,a_muts,muu,&amp;<a name='4197'>
&amp;a_muu,muv,a_muv,a_mudf,a_t_2,t_save,a_t_save,a_t_2save,a_t_tend,mu_tend,a_mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,&amp;<a name='4198'>
&amp;msfv,msft,config_flags,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme, &amp;<a name='4199'>
        max(grid%i_start(ij)-2,ids),  &amp;   <font color=#447700>! compute out an extra row/col on halo<a name='4200'></font>
        min(grid%i_end(ij)+2,ide),    &amp;<a name='4201'>
        max(grid%j_start(ij)-2,jds),  &amp;<a name='4202'>
        min(grid%j_end(ij)+2,jde),k_start,k_end )<a name='4203'>
BENCH_END(comp85_a_advance_mu_t)<a name='4204'>
<a name='4205'>
BENCH_START(comp85)<a name='4206'>
<font color=#447700>!----------------------------------------<a name='4207'></font>
#ifndef FAST_CPY<a name='4208'>
    al(:,:,:) = alq(:,:,:)<a name='4209'>
    mu_2(:,:) = mu_2q(:,:)<a name='4210'>
    p(:,:,:) = pq(:,:,:)<a name='4211'>
    ph_2(:,:,:) = ph_2q(:,:,:)<a name='4212'>
#else<a name='4213'>
    call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_258"> ( al , alq , n3d_elem )<a name='4214'>
    call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_259"> ( mu_2 , mu_2q , n2d_elem )<a name='4215'>
    call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_260"> ( p , pq , n3d_elem )<a name='4216'>
    call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_261"> ( ph_2 , ph_2q , n3d_elem )<a name='4217'>
#endif<a name='4218'>
BENCH_END(comp85)<a name='4219'>
<a name='4220'>
BENCH_START(exch81)<a name='4221'>
#ifdef DM_PARALLEL<a name='4222'>
lineno = __LINE__<a name='4223'>
#  include "<A href='../../html_code/include/HALO_3072.inc.html'>HALO_3072.inc</A>"<A NAME="HALO_3072.inc_140"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4224'>
<a name='4225'>
<a name='4226'>
<a name='4227'>
<a name='4228'>
<a name='4229'>
<a name='4230'>
<a name='4231'>
<a name='4232'>
#endif<a name='4233'>
BENCH_END(exch81)<a name='4234'>
<a name='4235'>
BENCH_START(comp86)<a name='4236'>
      if (config_flags%specified .or. config_flags%nested) then<a name='4237'>
        call <A href='../../html_code/dyn_em/module_bc_ad.F.html#A_SPEC_BDYUPDATE'>a_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDYUPDATE_6">( a_v_2,a_rv_tend,dts_rk,'v',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),&amp;<a name='4238'>
&amp;grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4239'>
        call <A href='../../html_code/dyn_em/module_bc_ad.F.html#A_SPEC_BDYUPDATE'>a_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDYUPDATE_7">( a_u_2,a_ru_tend,dts_rk,'u',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),&amp;<a name='4240'>
&amp;grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4241'>
<a name='4242'>
      endif<a name='4243'>
BENCH_END(comp86)<a name='4244'>
<a name='4245'>
<a name='4246'>
<a name='4247'>
<a name='4248'>
<a name='4249'>
<a name='4250'>
<a name='4251'>
BENCH_START(exch82)<a name='4252'>
<a name='4253'>
<a name='4254'>
<a name='4255'>
<a name='4256'>
<a name='4257'>
<a name='4258'>
<a name='4259'>
<a name='4260'>
<a name='4261'>
<a name='4262'>
<a name='4263'>
<a name='4264'>
<a name='4265'>
<a name='4266'>
<a name='4267'>
<a name='4268'>
<a name='4269'>
<a name='4270'>
<a name='4271'>
#ifdef DM_PARALLEL<a name='4272'>
lineno = __LINE__<a name='4273'>
#include "<A href='../../html_code/include/HALO_3120.inc.html'>HALO_3120.inc</A>"<A NAME="HALO_3120.inc_141"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4274'>
#endif<a name='4275'>
<a name='4276'>
BENCH_END(exch82)<a name='4277'>
BENCH_START(comp87)<a name='4278'>
      call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_ADVANCE_UV'>a_advance_uv</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_ADVANCE_UV_2">( a_u_2,a_ru_tend,a_v_2,a_rv_tend,p,a_p,pb,ph_2,a_ph_2,php,a_php,alt,a_alt,al,a_al,mu_2,a_mu_2,muu,a_muu,&amp;<a name='4279'>
&amp;cqu,a_cqu,muv,a_muv,cqv,a_cqv,a_mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,emdiv,rdnw,config_flags,spec_zone,non_hydrostatic,ids,&amp;<a name='4280'>
&amp;ide,jds,jde,kde,ims,ime,jms,jme,kms,kme, &amp;<a name='4281'>
        max(grid%i_start(ij)-2,ids),  &amp;   <font color=#447700>! compute out an extra row/col on halo<a name='4282'></font>
        min(grid%i_end(ij)+2,ide),    &amp;<a name='4283'>
        max(grid%j_start(ij)-2,jds),  &amp;<a name='4284'>
        min(grid%j_end(ij)+2,jde),k_start,k_end )<a name='4285'>
BENCH_END(comp87)<a name='4286'>
<a name='4287'>
  end do a_small_steps<a name='4288'>
<a name='4289'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='4290'></font>
#ifndef NO_HALO_FIX<a name='4291'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 87<a name='4292'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_142"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4293'>
#endif<a name='4294'>
<a name='4295'>
<font color=#447700>!------------------------------<a name='4296'></font>
<font color=#447700>!------------------------------<a name='4297'></font>
<a name='4298'>
BENCH_START(comp88)<a name='4299'>
#ifndef FAST_CPY<a name='4300'>
  ww_m(:,:,:) = ww_m_keep3(:,:,:)<a name='4301'>
  rv_m(:,:,:) = rv_m_keep3(:,:,:)<a name='4302'>
  ru_m(:,:,:) = ru_m_keep3(:,:,:)<a name='4303'>
  a(:,:,:) = a_keep3(:,:,:)<a name='4304'>
  alpha(:,:,:) = alpha_keep3(:,:,:)<a name='4305'>
  gamma(:,:,:) = gamma_keep3(:,:,:)<a name='4306'>
<font color=#447700>!------------------------------<a name='4307'></font>
<a name='4308'>
  xkmhd(:,:,:) = xkmhdh(:,:,:)<a name='4309'>
  w_2(:,:,:) = w_2h(:,:,:)<a name='4310'>
  w_1(:,:,:) = w_1h(:,:,:)<a name='4311'>
  v_2(:,:,:) = v_2h(:,:,:)<a name='4312'>
  v_1(:,:,:) = v_1h(:,:,:)<a name='4313'>
  u_2(:,:,:) = u_2h(:,:,:)<a name='4314'>
  u_1(:,:,:) = u_1h(:,:,:)<a name='4315'>
  t_tendf(:,:,:) = t_tendfh(:,:,:)<a name='4316'>
  t_2(:,:,:) = t_2h(:,:,:)<a name='4317'>
  t_1(:,:,:) = t_1h(:,:,:)<a name='4318'>
  rw_tendf(:,:,:) = rw_tendfh(:,:,:)<a name='4319'>
  rv_tendf(:,:,:) = rv_tendfh(:,:,:)<a name='4320'>
  ru_tendf(:,:,:) = ru_tendfh(:,:,:)<a name='4321'>
  pm1(:,:,:) = pm1h(:,:,:)<a name='4322'>
  ph_tendf(:,:,:) = ph_tendfh(:,:,:)<a name='4323'>
  ph_2(:,:,:) = ph_2h(:,:,:)<a name='4324'>
  ph_1(:,:,:) = ph_1h(:,:,:)<a name='4325'>
  p(:,:,:) = ph(:,:,:)<a name='4326'>
  mu_2(:,:) = mu_2h(:,:)<a name='4327'>
  mu_1(:,:) = mu_1h(:,:)<a name='4328'>
  moist_tend(:,:,:,:) = moist_tendh(:,:,:,:)<a name='4329'>
  moist_2(:,:,:,:) = moist_2h(:,:,:,:)<a name='4330'>
  moist_1(:,:,:,:) = moist_1h(:,:,:,:)<a name='4331'>
  dnw(:) = dnwh(:)<a name='4332'>
  al(:,:,:) = alh(:,:,:)<a name='4333'>
<font color=#447700>!----------------------------------------<a name='4334'></font>
  mudf(:,:) = mudf_ma(:,:)<a name='4335'>
<font color=#447700>!----------------------------------------<a name='4336'></font>
#else<a name='4337'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_262">(  ww_m , ww_m_keep3 , n3d_elem )<a name='4338'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_263">(  rv_m , rv_m_keep3 , n3d_elem )<a name='4339'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_264">(  ru_m , ru_m_keep3 , n3d_elem )<a name='4340'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_265">(  a , a_keep3 , n3d_elem )<a name='4341'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_266">(  alpha , alpha_keep3 , n3d_elem )<a name='4342'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_267">(  gamma , gamma_keep3 , n3d_elem )<a name='4343'>
<font color=#447700>!------------------------------<a name='4344'></font>
<a name='4345'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_268">(  xkmhd , xkmhdh , n3d_elem )<a name='4346'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_269">(  w_2 , w_2h , n3d_elem )<a name='4347'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_270">(  w_1 , w_1h , n3d_elem )<a name='4348'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_271">(  v_2 , v_2h , n3d_elem )<a name='4349'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_272">(  v_1 , v_1h , n3d_elem )<a name='4350'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_273">(  u_2 , u_2h , n3d_elem )<a name='4351'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_274">(  u_1 , u_1h , n3d_elem )<a name='4352'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_275">(  t_tendf , t_tendfh , n3d_elem )<a name='4353'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_276">(  t_2 , t_2h , n3d_elem )<a name='4354'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_277">(  t_1 , t_1h , n3d_elem )<a name='4355'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_278">(  rw_tendf , rw_tendfh , n3d_elem )<a name='4356'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_279">(  rv_tendf , rv_tendfh , n3d_elem )<a name='4357'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_280">(  ru_tendf , ru_tendfh , n3d_elem )<a name='4358'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_281">(  pm1 , pm1h , n3d_elem )<a name='4359'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_282">(  ph_tendf , ph_tendfh , n3d_elem )<a name='4360'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_283">(  ph_2 , ph_2h , n3d_elem )<a name='4361'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_284">(  ph_1 , ph_1h , n3d_elem )<a name='4362'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_285">(  p , ph , n3d_elem )<a name='4363'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_286">(  mu_2 , mu_2h , n2d_elem )<a name='4364'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_287">(  mu_1 , mu_1h , n2d_elem )<a name='4365'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_288">(  moist_tend(ims,kms,jms,2) , moist_tendh(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='4366'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_289">(  moist_2(ims,kms,jms,2) , moist_2h(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='4367'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_290">(  moist_1(ims,kms,jms,2) , moist_1h(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='4368'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_291">(  dnw , dnwh , kme-kms+1 )<a name='4369'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_292">(  al , alh , n3d_elem )<a name='4370'>
<font color=#447700>!----------------------------------------<a name='4371'></font>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_293">(  mudf , mudf_ma , n2d_elem )<a name='4372'>
<font color=#447700>!----------------------------------------<a name='4373'></font>
#endif<a name='4374'>
  dtm = dt<a name='4375'>
  if (rk_order .eq. 1) then<a name='4376'>
    if (step_number .ne. 1) then<a name='4377'>
      number_of_small_timesteps = 2*time_step_sound<a name='4378'>
      dt_rk = dt<a name='4379'>
      dtm = 2*dt<a name='4380'>
    else<a name='4381'>
      number_of_small_timesteps = time_step_sound<a name='4382'>
      dt_rk = dt/2.<a name='4383'>
      dtm = dt<a name='4384'>
    endif<a name='4385'>
    dts_rk = dts<a name='4386'>
  else if (rk_order .eq. 2) then<a name='4387'>
    if (rk_step .eq. 1) then<a name='4388'>
      dt_rk = 0.5*dt<a name='4389'>
      dts_rk = dts<a name='4390'>
      number_of_small_timesteps = time_step_sound/2<a name='4391'>
    else<a name='4392'>
      dt_rk = dt<a name='4393'>
      dts_rk = dts<a name='4394'>
      number_of_small_timesteps = time_step_sound<a name='4395'>
    endif<a name='4396'>
  else if (rk_order .eq. 3) then<a name='4397'>
    if (rk_step .eq. 1) then<a name='4398'>
      dt_rk = dt/3.<a name='4399'>
      dts_rk = dt_rk<a name='4400'>
      number_of_small_timesteps = 1<a name='4401'>
    else if (rk_step .eq. 2) then<a name='4402'>
      dt_rk = 0.5*dt<a name='4403'>
      dts_rk = dts<a name='4404'>
      number_of_small_timesteps = time_step_sound/2<a name='4405'>
    else<a name='4406'>
      dt_rk = dt<a name='4407'>
      dts_rk = dts<a name='4408'>
      number_of_small_timesteps = time_step_sound<a name='4409'>
    endif<a name='4410'>
  endif<a name='4411'>
<font color=#447700>! recompute : dt_rk,dts_rk,number_of_small_timesteps<a name='4412'></font>
BENCH_END(comp88)<a name='4413'>
<a name='4414'>
BENCH_START(exch83)<a name='4415'>
#ifdef DM_PARALLEL<a name='4416'>
lineno = __LINE__<a name='4417'>
#  include "<A href='../../html_code/include/HALO_3212.inc.html'>HALO_3212.inc</A>"<A NAME="HALO_3212.inc_143"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4418'>
#endif<a name='4419'>
BENCH_END(exch83)<a name='4420'>
<a name='4421'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='4422'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_step_prep.  <a name='4423'></font>
 restore_rk_step_prepb4acc: if ( config_flags%remove_rk_step_prep ) then<a name='4424'>
BENCH_START(comprestore_rk_step_prep_tim)<a name='4425'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rk_step_prepb4acc:  rk_step, rk_order = ',rk_step,rk_order<a name='4426'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_46"> ( 10 , TRIM(wrf_err_message) )<a name='4427'>
   <font color=#447700>! store fields<a name='4428'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_21">(rk_step, BUF_RK_STEP_PREP)<a name='4429'>
#include "<A href='../../html_code/include/restore_rk_step_prep.h.html'>restore_rk_step_prep.h</A>"<A NAME="restore_rk_step_prep.h_144"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4430'>
BENCH_END(comprestore_rk_step_prep_tim)<a name='4431'>
 else  <font color=#447700>! restore_rk_step_prepb4acc<a name='4432'></font>
<a name='4433'>
BENCH_START(comp89)<a name='4434'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_10">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='4435'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='4436'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4437'>
BENCH_END(comp89)<a name='4438'>
<a name='4439'>
 endif restore_rk_step_prepb4acc<a name='4440'>
<a name='4441'>
BENCH_START(exch84)<a name='4442'>
#ifdef DM_PARALLEL<a name='4443'>
lineno = __LINE__<a name='4444'>
#    include "<A href='../../html_code/include/HALO_3222.inc.html'>HALO_3222.inc</A>"<A NAME="HALO_3222.inc_145"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4445'>
#endif<a name='4446'>
<a name='4447'>
#ifdef DM_PARALLEL<a name='4448'>
lineno = __LINE__<a name='4449'>
#    include "<A href='../../html_code/include/HALO_3227.inc.html'>HALO_3227.inc</A>"<A NAME="HALO_3227.inc_146"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4450'>
#endif<a name='4451'>
BENCH_END(exch84)<a name='4452'>
<a name='4453'>
<font color=#447700>! recompute : alt,cqu,cqv,cqw,mut,muu,muv,php,ru,rv,rw,ww<a name='4454'></font>
<a name='4455'>
  rk_step_is_onzf: if (rk_step .eq. 1) then<a name='4456'>
<a name='4457'>
BENCH_START(comp90)<a name='4458'>
      call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_10">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,rk_step,&amp;<a name='4459'>
&amp;ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4460'>
BENCH_END(comp90)<a name='4461'>
<a name='4462'>
BENCH_START(exch85)<a name='4463'>
#ifdef DM_PARALLEL<a name='4464'>
lineno = __LINE__<a name='4465'>
<a name='4466'>
#endif<a name='4467'>
BENCH_END(exch85)<a name='4468'>
<a name='4469'>
BENCH_START(comp91)<a name='4470'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_10">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,v_phy,&amp;<a name='4471'>
&amp;p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,rqccuten,&amp;<a name='4472'>
&amp;rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='4473'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4474'>
BENCH_END(comp91)<a name='4475'>
<a name='4476'>
BENCH_START(exch86)<a name='4477'>
#ifdef DM_PARALLEL<a name='4478'>
lineno = __LINE__<a name='4479'>
<a name='4480'>
<a name='4481'>
<a name='4482'>
<a name='4483'>
#endif<a name='4484'>
BENCH_END(exch86)<a name='4485'>
<a name='4486'>
BENCH_START(comp92)<a name='4487'>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='4488'>
<a name='4489'>
        call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_10">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='4490'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='4491'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='4492'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4493'>
<a name='4494'>
    endif<a name='4495'>
BENCH_END(comp92)<a name='4496'>
  endif rk_step_is_onzf<a name='4497'>
<a name='4498'>
BENCH_START(exch87)<a name='4499'>
#ifdef DM_PARALLEL<a name='4500'>
lineno = __LINE__<a name='4501'>
#     include "<A href='../../html_code/include/HALO_3273.inc.html'>HALO_3273.inc</A>"<A NAME="HALO_3273.inc_147"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4502'>
<a name='4503'>
<a name='4504'>
<a name='4505'>
#endif<a name='4506'>
BENCH_END(exch87)<a name='4507'>
<a name='4508'>
<font color=#447700>!  recompute : moist_tend,ph_tendf,ru_tendf,rv_tendf,rw_tendf,t_tendf,xk<a name='4509'></font>
<font color=#447700>! mhd<a name='4510'></font>
<a name='4511'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='4512'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_tendency.  <a name='4513'></font>
 restore_rktendb4acc: if ( config_flags%remove_rktend ) then<a name='4514'>
BENCH_START(comprestore_rktend_tim)<a name='4515'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktendb4acc:  rk_step, rk_order = ',rk_step,rk_order<a name='4516'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_47"> ( 10 , TRIM(wrf_err_message) )<a name='4517'>
   <font color=#447700>! store fields<a name='4518'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_22">(rk_step, BUF_RKTEND)<a name='4519'>
#include "<A href='../../html_code/include/restore_rktend.h.html'>restore_rktend.h</A>"<A NAME="restore_rktend.h_148"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4520'>
BENCH_END(comprestore_rktend_tim)<a name='4521'>
 else  <font color=#447700>! restore_rktendb4acc<a name='4522'></font>
<a name='4523'>
WRITE(wrf_err_message,*) 'DEBUG:  calling rk_tendency before_a_calc_coef_w, rk_step = ',rk_step<a name='4524'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_48">( 10, TRIM(wrf_err_message) )<a name='4525'>
BENCH_START(comp7777)<a name='4526'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_10">( config_flags,rk_step,ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,&amp;<a name='4527'>
&amp;mu_tend,u_save,v_save,w_save,ph_save,t_save,mu_save,rthften,ru,rv,rw,ww,u_2,v_2,w_2,t_2,ph_2,u_1,v_1,w_1,t_1,ph_1,h_diabatic,&amp;<a name='4528'>
&amp;phb,t_init,mu_2,mut,muu,muv,mub,al,alt,p,pb,php,cqu,cqv,cqw,u_base,v_base,t_base,qv_base,z_base,msfu,msfv,msft,f,e,sina,cosa,&amp;<a name='4529'>
&amp;fnm,fnp,rdn,rdnw,dt,rdx,rdy,khdif,kvdif,xkmhd,cf1,cf2,cf3,cfn,cfn1,num_3d_m,non_hydrostatic,leapfrog,ids,ide,jds,jde,kds,kde,&amp;<a name='4530'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4531'>
BENCH_END(comp7777)<a name='4532'>
<a name='4533'>
 endif restore_rktendb4acc<a name='4534'>
<a name='4535'>
BENCH_START(comp93)<a name='4536'>
<font color=#447700>!  recompute : cqw,mu_tend,ph_save,ph_tend,ru_tend,ru_tendf,rv_tend,rv_t<a name='4537'></font>
<font color=#447700>! endf,rw_tend,rw_tendf,t_save,t_tend,t_tendf,u_save,v_save,w_save<a name='4538'></font>
<a name='4539'>
    if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='4540'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_DRY'>relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_DRY_10">( config_flags,u_save,v_save,ph_save,t_save,w_save,mu_tend,ru,rv,ph_2,t_2,w_2,mu_2,mut,u_b,v_b,ph_b,t_b,&amp;<a name='4541'>
&amp;w_b,mu_b,u_bt,v_bt,ph_bt,t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,kde,&amp;<a name='4542'>
&amp;ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4543'>
    endif<a name='4544'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_ADDTEND_DRY'>rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_ADDTEND_DRY_10">( ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,u_save,v_save,w_save,&amp;<a name='4545'>
&amp;ph_save,t_save,rk_step,h_diabatic,mut,msft,msfu,msfv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='4546'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4547'>
    if (config_flags%specified .or. config_flags%nested) then<a name='4548'>
      call <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_DRY'>spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_DRY_10">( config_flags,ru_tend,rv_tend,ph_tend,t_tend,rw_tend,mu_tend,u_b,v_b,ph_b,t_b,w_b,mu_b,u_bt,v_bt,ph_bt,&amp;<a name='4549'>
&amp;t_bt,w_bt,mu_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,ips,ipe,jps,jpe,kps,kpe,&amp;<a name='4550'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4551'>
    endif<a name='4552'>
BENCH_END(comp93)<a name='4553'>
<a name='4554'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='4555'></font>
#ifndef NO_HALO_FIX<a name='4556'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 93<a name='4557'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_149"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4558'>
#endif<a name='4559'>
<a name='4560'>
<font color=#447700>!------------------------------<a name='4561'></font>
<font color=#447700>!------------------------------<a name='4562'></font>
<a name='4563'>
<font color=#447700>!----------------------------------------<a name='4564'></font>
BENCH_START(exch88)<a name='4565'>
#ifdef DM_PARALLEL<a name='4566'>
lineno = __LINE__<a name='4567'>
#      include "<A href='../../html_code/include/HALO_3313.inc.html'>HALO_3313.inc</A>"<A NAME="HALO_3313.inc_150"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4568'>
#endif<a name='4569'>
BENCH_END(exch88)<a name='4570'>
BENCH_START(comp94)<a name='4571'>
#ifndef FAST_CPY<a name='4572'>
u_1o(:,:,:) = u_1(:,:,:)<a name='4573'>
u_2o(:,:,:) = u_2(:,:,:)<a name='4574'>
v_1o(:,:,:) = v_1(:,:,:)<a name='4575'>
v_2o(:,:,:) = v_2(:,:,:)<a name='4576'>
w_1o(:,:,:) = w_1(:,:,:)<a name='4577'>
w_2o(:,:,:) = w_2(:,:,:)<a name='4578'>
t_1o(:,:,:) = t_1(:,:,:)<a name='4579'>
t_2o(:,:,:) = t_2(:,:,:)<a name='4580'>
mu_1o(:,:) = mu_1(:,:)<a name='4581'>
mu_2o(:,:) = mu_2(:,:)<a name='4582'>
po(:,:,:) = p(:,:,:)<a name='4583'>
#else<a name='4584'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_294">(u_1o , u_1, n3d_elem )<a name='4585'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_295">(u_2o , u_2, n3d_elem )<a name='4586'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_296">(v_1o , v_1, n3d_elem )<a name='4587'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_297">(v_2o , v_2, n3d_elem )<a name='4588'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_298">(w_1o , w_1, n3d_elem )<a name='4589'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_299">(w_2o , w_2, n3d_elem )<a name='4590'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_300">(t_1o , t_1, n3d_elem )<a name='4591'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_301">(t_2o , t_2, n3d_elem )<a name='4592'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_302">(mu_1o , mu_1, n2d_elem )<a name='4593'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_303">(mu_2o , mu_2, n2d_elem )<a name='4594'>
 call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_304">(po , p, n3d_elem )<a name='4595'>
#endif<a name='4596'>
<a name='4597'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_PREP'>small_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_PREP_10">( u_1,u_2,v_1,v_2,w_1,w_2,t_1,t_2,ph_1,ph_2,mub,mu_1,mu_2,muu,muus,muv,muvs,mut,muts,mudf,u_save,v_save,&amp;<a name='4598'>
&amp;w_save,t_save,ph_save,mu_save,ww,ww1,dnw,c2a,pb,p,alt,msfu,msfv,msft,rk_step,leapfrog,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='4599'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4600'>
BENCH_END(comp94)<a name='4601'>
<a name='4602'>
BENCH_START(exch89)<a name='4603'>
#ifdef DM_PARALLEL<a name='4604'>
lineno = __LINE__<a name='4605'>
#      include "<A href='../../html_code/include/HALO_3335.inc.html'>HALO_3335.inc</A>"<A NAME="HALO_3335.inc_151"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4606'>
#endif<a name='4607'>
<a name='4608'>
<font color=#447700>!----------------------------------------<a name='4609'></font>
#ifdef DM_PARALLEL<a name='4610'>
lineno = __LINE__<a name='4611'>
#      include "<A href='../../html_code/include/HALO_3341.inc.html'>HALO_3341.inc</A>"<A NAME="HALO_3341.inc_152"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4612'>
#endif<a name='4613'>
BENCH_END(exch89)<a name='4614'>
BENCH_START(comp95)<a name='4615'>
<a name='4616'>
#ifndef FAST_CPY<a name='4617'>
alp(:,:,:) = al(:,:,:)<a name='4618'>
pp(:,:,:) = p(:,:,:)<a name='4619'>
ph_2p(:,:,:) = ph_2(:,:,:)<a name='4620'>
t_2p(:,:,:) = t_2(:,:,:)<a name='4621'>
mu_2p(:,:) = mu_2(:,:)<a name='4622'>
#else<a name='4623'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_305">( alp , al, n3d_elem )<a name='4624'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_306">( pp , p, n3d_elem )<a name='4625'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_307">( ph_2p , ph_2, n3d_elem )<a name='4626'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_308">( t_2p , t_2, n3d_elem )<a name='4627'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_309">( mu_2p , mu_2, n2d_elem )<a name='4628'>
#endif<a name='4629'>
<a name='4630'>
    call <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_17">( al,p,ph_2,alt,t_2,t_save,c2a,pm1,mu_2,muts,znu,t0,rdnw,dnw,smdiv,non_hydrostatic,0,ids,ide,jds,jde,kds,kde,&amp;<a name='4631'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4632'>
BENCH_END(comp95)<a name='4633'>
<a name='4634'>
BENCH_START(exch90)<a name='4635'>
#ifdef DM_PARALLEL<a name='4636'>
lineno = __LINE__<a name='4637'>
#    include "<A href='../../html_code/include/HALO_3356.inc.html'>HALO_3356.inc</A>"<A NAME="HALO_3356.inc_153"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4638'>
<a name='4639'>
<a name='4640'>
<a name='4641'>
<a name='4642'>
<a name='4643'>
<a name='4644'>
<a name='4645'>
#endif<a name='4646'>
BENCH_END(exch90)<a name='4647'>
<a name='4648'>
BENCH_START(comp96)<a name='4649'>
    if (non_hydrostatic) then<a name='4650'>
      call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_COEF_W'>a_calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_COEF_W_2">( a,a_a,alpha,a_alpha,gamma,a_gamma,mut,a_mut,cqw,a_cqw,rdn,rdnw,c2a,a_c2a,dts,g,epssm,ide,jde,kde,ims,ime,&amp;<a name='4651'>
&amp;jms,jme,kms,kme,&amp;<a name='4652'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='4653'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4654'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4655'>
        min(grid%j_end(ij)+1,jde) )<a name='4656'>
    endif<a name='4657'>
<a name='4658'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='4659'></font>
#ifndef NO_HALO_FIX<a name='4660'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 96<a name='4661'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_154"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4662'>
#endif<a name='4663'>
<a name='4664'>
<font color=#447700>!----------------------------------------<a name='4665'></font>
#ifndef FAST_CPY<a name='4666'>
al(:,:,:) = alp(:,:,:)<a name='4667'>
p(:,:,:) = pp(:,:,:)<a name='4668'>
ph_2(:,:,:) = ph_2p(:,:,:)<a name='4669'>
t_2(:,:,:) = t_2p(:,:,:)<a name='4670'>
mu_2(:,:) = mu_2p(:,:)<a name='4671'>
#else<a name='4672'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_310">( al , alp , n3d_elem )<a name='4673'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_311">( p , pp , n3d_elem )<a name='4674'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_312">( ph_2 , ph_2p , n3d_elem )<a name='4675'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_313">( t_2 , t_2p , n3d_elem )<a name='4676'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_314">( mu_2 , mu_2p , n2d_elem )<a name='4677'>
#endif<a name='4678'>
BENCH_END(comp96)<a name='4679'>
<a name='4680'>
BENCH_START(exch91)<a name='4681'>
#ifdef DM_PARALLEL<a name='4682'>
lineno = __LINE__<a name='4683'>
#    include "<A href='../../html_code/include/HALO_3386.inc.html'>HALO_3386.inc</A>"<A NAME="HALO_3386.inc_155"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4684'>
<a name='4685'>
<a name='4686'>
<a name='4687'>
<a name='4688'>
<a name='4689'>
#endif<a name='4690'>
BENCH_END(exch91)<a name='4691'>
<a name='4692'>
BENCH_START(comp97)<a name='4693'>
    call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_CALC_P_RHO'>a_calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALC_P_RHO_3">( al,a_al,p,a_p,ph_2,a_ph_2,alt,a_alt,t_2,a_t_2,t_save,a_t_save,c2a,a_c2a,a_pm1,mu_2,a_mu_2,muts,a_muts,znu,&amp;<a name='4694'>
&amp;t0,rdnw,dnw,smdiv,non_hydrostatic,0,ide,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='4695'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='4696'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4697'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4698'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='4699'>
<a name='4700'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='4701'></font>
#ifndef NO_HALO_FIX<a name='4702'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 97<a name='4703'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_156"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4704'>
#endif<a name='4705'>
<a name='4706'>
<font color=#447700>!----------------------------------------<a name='4707'></font>
#ifndef FAST_CPY<a name='4708'>
u_1(:,:,:) = u_1o(:,:,:)<a name='4709'>
u_2(:,:,:) = u_2o(:,:,:)<a name='4710'>
v_1(:,:,:) = v_1o(:,:,:)<a name='4711'>
v_2(:,:,:) = v_2o(:,:,:)<a name='4712'>
w_1(:,:,:) = w_1o(:,:,:)<a name='4713'>
w_2(:,:,:) = w_2o(:,:,:)<a name='4714'>
t_1(:,:,:) = t_1o(:,:,:)<a name='4715'>
t_2(:,:,:) = t_2o(:,:,:)<a name='4716'>
mu_1(:,:) = mu_1o(:,:)<a name='4717'>
mu_2(:,:) = mu_2o(:,:)<a name='4718'>
p(:,:,:) = po(:,:,:)<a name='4719'>
#else<a name='4720'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_315"> ( u_1 , u_1o , n3d_elem )<a name='4721'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_316"> ( u_2 , u_2o , n3d_elem )<a name='4722'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_317"> ( v_1 , v_1o , n3d_elem )<a name='4723'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_318"> ( v_2 , v_2o , n3d_elem )<a name='4724'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_319"> ( w_1 , w_1o , n3d_elem )<a name='4725'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_320"> ( w_2 , w_2o , n3d_elem )<a name='4726'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_321"> ( t_1 , t_1o , n3d_elem )<a name='4727'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_322"> ( t_2 , t_2o , n3d_elem )<a name='4728'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_323"> ( mu_1 , mu_1o , n2d_elem )<a name='4729'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_324"> ( mu_2 , mu_2o , n2d_elem )<a name='4730'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_325"> ( p , po , n3d_elem )<a name='4731'>
#endif<a name='4732'>
BENCH_END(comp97)<a name='4733'>
<a name='4734'>
<a name='4735'>
BENCH_START(exch92)<a name='4736'>
#ifdef DM_PARALLEL<a name='4737'>
lineno = __LINE__<a name='4738'>
#  include "<A href='../../html_code/include/HALO_3419.inc.html'>HALO_3419.inc</A>"<A NAME="HALO_3419.inc_157"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4739'>
#endif<a name='4740'>
#ifdef DM_PARALLEL<a name='4741'>
lineno = __LINE__<a name='4742'>
#    include "<A href='../../html_code/include/HALO_3423.inc.html'>HALO_3423.inc</A>"<A NAME="HALO_3423.inc_158"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4743'>
<a name='4744'>
<a name='4745'>
<a name='4746'>
<a name='4747'>
<a name='4748'>
#endif<a name='4749'>
BENCH_END(exch92)<a name='4750'>
<a name='4751'>
BENCH_START(comp98_a_small_step_prep)<a name='4752'>
    call <A href='../../html_code/dyn_em/module_small_step_em_ad.F.html#A_SMALL_STEP_PREP'>a_small_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SMALL_STEP_PREP_2">( u_1,a_u_1,u_2,a_u_2,v_1,a_v_1,v_2,a_v_2,w_1,a_w_1,w_2,a_w_2,t_1,a_t_1,t_2,a_t_2,a_ph_1,a_ph_2,mub,mu_1,&amp;<a name='4753'>
&amp;a_mu_1,mu_2,a_mu_2,muu,a_muu,muus,a_muus,muv,a_muv,muvs,a_muvs,mut,a_mut,muts,a_muts,a_mudf,a_u_save,a_v_save,a_w_save,&amp;<a name='4754'>
&amp;a_t_save,a_ph_save,a_mu_save,a_ww,a_ww1,a_c2a,pb,p,a_p,alt,a_alt,msfu,msfv,msft,rk_step,leapfrog,ide,jde,kde,ims,ime,jms,jme,&amp;<a name='4755'>
&amp;kms,kme, &amp;<a name='4756'>
        max(grid%i_start(ij)-1,ids),  &amp;   <font color=#447700>! compute out an extra row/col on halo<a name='4757'></font>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='4758'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='4759'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='4760'>
BENCH_END(comp98_a_small_step_prep)<a name='4761'>
<a name='4762'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='4763'></font>
#ifndef NO_HALO_FIX<a name='4764'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 98<a name='4765'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_159"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4766'>
#endif<a name='4767'>
<a name='4768'>
BENCH_START(comp98)<a name='4769'>
<font color=#447700>!------------------------------<a name='4770'></font>
<font color=#447700>!------------------------------<a name='4771'></font>
<a name='4772'>
#ifndef FAST_CPY<a name='4773'>
  xkmhd(:,:,:) = xkmhdh(:,:,:)<a name='4774'>
  w_2(:,:,:) = w_2h(:,:,:)<a name='4775'>
  w_1(:,:,:) = w_1h(:,:,:)<a name='4776'>
  v_2(:,:,:) = v_2h(:,:,:)<a name='4777'>
  v_1(:,:,:) = v_1h(:,:,:)<a name='4778'>
  u_2(:,:,:) = u_2h(:,:,:)<a name='4779'>
  u_1(:,:,:) = u_1h(:,:,:)<a name='4780'>
  t_tendf(:,:,:) = t_tendfh(:,:,:)<a name='4781'>
  t_2(:,:,:) = t_2h(:,:,:)<a name='4782'>
  t_1(:,:,:) = t_1h(:,:,:)<a name='4783'>
  rw_tendf(:,:,:) = rw_tendfh(:,:,:)<a name='4784'>
  rv_tendf(:,:,:) = rv_tendfh(:,:,:)<a name='4785'>
  ru_tendf(:,:,:) = ru_tendfh(:,:,:)<a name='4786'>
  pm1(:,:,:) = pm1h(:,:,:)<a name='4787'>
  ph_tendf(:,:,:) = ph_tendfh(:,:,:)<a name='4788'>
  ph_2(:,:,:) = ph_2h(:,:,:)<a name='4789'>
  ph_1(:,:,:) = ph_1h(:,:,:)<a name='4790'>
  p(:,:,:) = ph(:,:,:)<a name='4791'>
  mu_2(:,:) = mu_2h(:,:)<a name='4792'>
  mu_1(:,:) = mu_1h(:,:)<a name='4793'>
  moist_tend(:,:,:,:) = moist_tendh(:,:,:,:)<a name='4794'>
  moist_2(:,:,:,:) = moist_2h(:,:,:,:)<a name='4795'>
  moist_1(:,:,:,:) = moist_1h(:,:,:,:)<a name='4796'>
  dnw(:) = dnwh(:)<a name='4797'>
  al(:,:,:) = alh(:,:,:)<a name='4798'>
#else<a name='4799'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_326"> ( xkmhd , xkmhdh , n3d_elem ) <a name='4800'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_327"> ( w_2 , w_2h , n3d_elem ) <a name='4801'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_328"> ( w_1 , w_1h , n3d_elem ) <a name='4802'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_329"> ( v_2 , v_2h , n3d_elem ) <a name='4803'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_330"> ( v_1 , v_1h , n3d_elem ) <a name='4804'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_331"> ( u_2 , u_2h , n3d_elem ) <a name='4805'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_332"> ( u_1 , u_1h , n3d_elem ) <a name='4806'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_333"> ( t_tendf , t_tendfh , n3d_elem ) <a name='4807'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_334"> ( t_2 , t_2h , n3d_elem ) <a name='4808'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_335"> ( t_1 , t_1h , n3d_elem ) <a name='4809'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_336"> ( rw_tendf , rw_tendfh , n3d_elem ) <a name='4810'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_337"> ( rv_tendf , rv_tendfh , n3d_elem ) <a name='4811'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_338"> ( ru_tendf , ru_tendfh , n3d_elem ) <a name='4812'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_339"> ( pm1 , pm1h , n3d_elem ) <a name='4813'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_340"> ( ph_tendf , ph_tendfh , n3d_elem ) <a name='4814'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_341"> ( ph_2 , ph_2h , n3d_elem ) <a name='4815'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_342"> ( ph_1 , ph_1h , n3d_elem ) <a name='4816'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_343"> ( p , ph , n3d_elem ) <a name='4817'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_344"> ( mu_2 , mu_2h , n2d_elem ) <a name='4818'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_345"> ( mu_1 , mu_1h , n2d_elem ) <a name='4819'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_346"> ( moist_tend(ims,kms,jms,2) , moist_tendh(ims,kms,jms,2) , n3d_elem*(num_moist-1) ) <a name='4820'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_347"> ( moist_2(ims,kms,jms,2) , moist_2h(ims,kms,jms,2) , n3d_elem*(num_moist-1) ) <a name='4821'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_348"> ( moist_1(ims,kms,jms,2) , moist_1h(ims,kms,jms,2) , n3d_elem*(num_moist-1) ) <a name='4822'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_349"> ( dnw , dnwh , kme-kms+1 ) <a name='4823'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_350"> ( al , alh , n3d_elem ) <a name='4824'>
#endif<a name='4825'>
<font color=#447700>!----------------------------------------<a name='4826'></font>
<font color=#447700>!---------- added by zzma for recomputing basic states -------------<a name='4827'></font>
  dtm = dt<a name='4828'>
  if (rk_order .eq. 1) then<a name='4829'>
    if (step_number .ne. 1) then<a name='4830'>
      number_of_small_timesteps = 2*time_step_sound<a name='4831'>
      dt_rk = dt<a name='4832'>
      dtm = 2*dt<a name='4833'>
    else<a name='4834'>
      number_of_small_timesteps = time_step_sound<a name='4835'>
      dt_rk = dt/2.<a name='4836'>
       dtm = dt<a name='4837'>
    endif<a name='4838'>
    dts_rk = dts<a name='4839'>
  else if (rk_order .eq. 2) then<a name='4840'>
    if (rk_step .eq. 1) then<a name='4841'>
      dt_rk = 0.5*dt<a name='4842'>
      dts_rk = dts<a name='4843'>
      number_of_small_timesteps = time_step_sound/2<a name='4844'>
    else<a name='4845'>
      dt_rk = dt<a name='4846'>
      dts_rk = dts<a name='4847'>
      number_of_small_timesteps = time_step_sound<a name='4848'>
    endif<a name='4849'>
  else if (rk_order .eq. 3) then<a name='4850'>
    if (rk_step .eq. 1) then<a name='4851'>
      dt_rk = dt/3.<a name='4852'>
      dts_rk = dt_rk<a name='4853'>
      number_of_small_timesteps = 1<a name='4854'>
    else if (rk_step .eq. 2) then<a name='4855'>
      dt_rk = 0.5*dt<a name='4856'>
      dts_rk = dts<a name='4857'>
      number_of_small_timesteps = time_step_sound/2<a name='4858'>
    else<a name='4859'>
      dt_rk = dt<a name='4860'>
      dts_rk = dts<a name='4861'>
      number_of_small_timesteps = time_step_sound<a name='4862'>
    endif<a name='4863'>
  endif<a name='4864'>
<font color=#447700>! recompute : dt_rk,dts_rk,number_of_small_timesteps<a name='4865'></font>
BENCH_END(comp98)<a name='4866'>
<a name='4867'>
BENCH_START(exch93)<a name='4868'>
#ifdef DM_PARALLEL<a name='4869'>
lineno = __LINE__<a name='4870'>
#    include "<A href='../../html_code/include/HALO_3510.inc.html'>HALO_3510.inc</A>"<A NAME="HALO_3510.inc_160"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4871'>
#endif<a name='4872'>
BENCH_END(exch93)<a name='4873'>
<a name='4874'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='4875'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_step_prep.  <a name='4876'></font>
 restore_rk_step_prepb4asbd: if ( config_flags%remove_rk_step_prep ) then<a name='4877'>
BENCH_START(comprestore_rk_step_prep_tim)<a name='4878'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rk_step_prepb4asbd:  rk_step, rk_order = ',rk_step,rk_order<a name='4879'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_49"> ( 10 , TRIM(wrf_err_message) )<a name='4880'>
   <font color=#447700>! store fields<a name='4881'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_23">(rk_step, BUF_RK_STEP_PREP)<a name='4882'>
#include "<A href='../../html_code/include/restore_rk_step_prep.h.html'>restore_rk_step_prep.h</A>"<A NAME="restore_rk_step_prep.h_161"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4883'>
BENCH_END(comprestore_rk_step_prep_tim)<a name='4884'>
 else  <font color=#447700>! restore_rk_step_prepb4asbd<a name='4885'></font>
<a name='4886'>
BENCH_START(comp99)<a name='4887'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_11">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='4888'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='4889'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4890'>
BENCH_END(comp99)<a name='4891'>
<a name='4892'>
 endif restore_rk_step_prepb4asbd<a name='4893'>
<a name='4894'>
BENCH_START(exch94)<a name='4895'>
#ifdef DM_PARALLEL<a name='4896'>
lineno = __LINE__<a name='4897'>
#    include "<A href='../../html_code/include/HALO_3520.inc.html'>HALO_3520.inc</A>"<A NAME="HALO_3520.inc_162"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4898'>
#endif<a name='4899'>
<a name='4900'>
#ifdef DM_PARALLEL<a name='4901'>
lineno = __LINE__<a name='4902'>
#    include "<A href='../../html_code/include/HALO_3525.inc.html'>HALO_3525.inc</A>"<A NAME="HALO_3525.inc_163"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4903'>
#endif<a name='4904'>
BENCH_END(exch94)<a name='4905'>
<a name='4906'>
<font color=#447700>! recompute : alt,cqu,cqv,cqw,mut,muu,muv,php,ru,rv,rw,ww<a name='4907'></font>
<a name='4908'>
BENCH_START(comp100)<a name='4909'>
  rk_step_is_onzs: if (rk_step .eq. 1) then<a name='4910'>
<a name='4911'>
      call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_11">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,rk_step,&amp;<a name='4912'>
&amp;ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4913'>
BENCH_END(comp100)<a name='4914'>
<a name='4915'>
BENCH_START(exch95)<a name='4916'>
#ifdef DM_PARALLEL<a name='4917'>
lineno = __LINE__<a name='4918'>
<a name='4919'>
#endif<a name='4920'>
BENCH_END(exch95)<a name='4921'>
<a name='4922'>
BENCH_START(comp101)<a name='4923'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_11">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,v_phy,&amp;<a name='4924'>
&amp;p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,rqccuten,&amp;<a name='4925'>
&amp;rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='4926'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4927'>
BENCH_END(comp101)<a name='4928'>
<a name='4929'>
BENCH_START(exch96)<a name='4930'>
#ifdef DM_PARALLEL<a name='4931'>
lineno = __LINE__<a name='4932'>
<a name='4933'>
<a name='4934'>
<a name='4935'>
<a name='4936'>
#endif<a name='4937'>
BENCH_END(exch96)<a name='4938'>
<a name='4939'>
BENCH_START(comp102)<a name='4940'>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='4941'>
<a name='4942'>
        call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_11">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='4943'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='4944'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='4945'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4946'>
<a name='4947'>
    endif<a name='4948'>
BENCH_END(comp102)<a name='4949'>
  endif rk_step_is_onzs<a name='4950'>
<a name='4951'>
BENCH_START(exch97)<a name='4952'>
#ifdef DM_PARALLEL<a name='4953'>
lineno = __LINE__<a name='4954'>
<a name='4955'>
<a name='4956'>
<a name='4957'>
<a name='4958'>
#endif<a name='4959'>
BENCH_END(exch97)<a name='4960'>
<a name='4961'>
<font color=#447700>!  recompute : moist_tend,ph_tendf,ru_tendf,rv_tendf,rw_tendf,t_tendf,xk<a name='4962'></font>
<font color=#447700>! mhd<a name='4963'></font>
<a name='4964'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='4965'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_tendency.  <a name='4966'></font>
 restore_rktendb4asbd: if ( config_flags%remove_rktend ) then<a name='4967'>
BENCH_START(comprestore_rktend_tim)<a name='4968'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rktendb4asbd:  rk_step, rk_order = ',rk_step,rk_order<a name='4969'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_50"> ( 10 , TRIM(wrf_err_message) )<a name='4970'>
   <font color=#447700>! store fields<a name='4971'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_24">(rk_step, BUF_RKTEND)<a name='4972'>
#include "<A href='../../html_code/include/restore_rktend.h.html'>restore_rktend.h</A>"<A NAME="restore_rktend.h_164"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4973'>
BENCH_END(comprestore_rktend_tim)<a name='4974'>
 else  <font color=#447700>! restore_rktendb4asbd<a name='4975'></font>
<a name='4976'>
WRITE(wrf_err_message,*) 'DEBUG:  calling rk_tendency before_a_spec_bdy_dry, rk_step = ',rk_step<a name='4977'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_51">( 10, TRIM(wrf_err_message) )<a name='4978'>
BENCH_START(comp103)<a name='4979'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_11">( config_flags,rk_step,ru_tend,rv_tend,rw_tend,ph_tend,t_tend,ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,&amp;<a name='4980'>
&amp;mu_tend,u_save,v_save,w_save,ph_save,t_save,mu_save,rthften,ru,rv,rw,ww,u_2,v_2,w_2,t_2,ph_2,u_1,v_1,w_1,t_1,ph_1,h_diabatic,&amp;<a name='4981'>
&amp;phb,t_init,mu_2,mut,muu,muv,mub,al,alt,p,pb,php,cqu,cqv,cqw,u_base,v_base,t_base,qv_base,z_base,msfu,msfv,msft,f,e,sina,cosa,&amp;<a name='4982'>
&amp;fnm,fnp,rdn,rdnw,dt,rdx,rdy,khdif,kvdif,xkmhd,cf1,cf2,cf3,cfn,cfn1,num_3d_m,non_hydrostatic,leapfrog,ids,ide,jds,jde,kds,kde,&amp;<a name='4983'>
&amp;ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='4984'>
BENCH_END(comp103)<a name='4985'>
<a name='4986'>
 endif restore_rktendb4asbd<a name='4987'>
<a name='4988'>
<font color=#447700>!------------------------------<a name='4989'></font>
<font color=#447700>!------------------------------<a name='4990'></font>
<a name='4991'>
BENCH_START(exch98)<a name='4992'>
#ifdef DM_PARALLEL<a name='4993'>
lineno = __LINE__<a name='4994'>
#    include "<A href='../../html_code/include/HALO_3593.inc.html'>HALO_3593.inc</A>"<A NAME="HALO_3593.inc_165"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4995'>
<a name='4996'>
<a name='4997'>
<a name='4998'>
<a name='4999'>
<a name='5000'>
#endif<a name='5001'>
BENCH_END(exch98)<a name='5002'>
<a name='5003'>
    if (config_flags%specified .or. config_flags%nested) then<a name='5004'>
BENCH_START(exch99)<a name='5005'>
#ifdef DM_PARALLEL<a name='5006'>
lineno = __LINE__<a name='5007'>
#  include "<A href='../../html_code/include/HALO_3606.inc.html'>HALO_3606.inc</A>"<A NAME="HALO_3606.inc_166"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5008'>
#endif<a name='5009'>
BENCH_END(exch99)<a name='5010'>
BENCH_START(comp104)<a name='5011'>
      call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_SPEC_BDY_DRY'>a_spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SPEC_BDY_DRY_2">( config_flags,a_ru_tend,a_rv_tend,a_ph_tend,a_t_tend,a_rw_tend,a_mu_tend,a_u_bt,a_v_bt,a_ph_bt,a_t_bt,&amp;<a name='5012'>
&amp;a_w_bt,a_mu_bt,spec_bdy_width,spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='5013'>
        max(grid%i_start(ij)-2,ids),  &amp;<a name='5014'>
        min(grid%i_end(ij)+2,ide),    &amp;<a name='5015'>
        max(grid%j_start(ij)-2,jds),  &amp;<a name='5016'>
        min(grid%j_end(ij)+2,jde),k_start,k_end )<a name='5017'>
BENCH_END(comp104)<a name='5018'>
    endif<a name='5019'>
BENCH_START(exch100)<a name='5020'>
#ifdef DM_PARALLEL<a name='5021'>
lineno = __LINE__<a name='5022'>
#  include "<A href='../../html_code/include/HALO_3619.inc.html'>HALO_3619.inc</A>"<A NAME="HALO_3619.inc_167"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5023'>
#endif<a name='5024'>
BENCH_END(exch100)<a name='5025'>
BENCH_START(comp105)<a name='5026'>
    call <A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_ADDTEND_DRY'>a_rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_RK_ADDTEND_DRY_2">( a_ru_tend,a_rv_tend,a_rw_tend,a_ph_tend,a_t_tend,a_ru_tendf,a_rv_tendf,a_rw_tendf,a_ph_tendf,a_t_tendf,&amp;<a name='5027'>
&amp;a_u_save,a_v_save,a_w_save,a_ph_save,a_t_save,rk_step,h_diabatic,a_mut,msft,msfu,msfv,ide,jde,ims,ime,jms,jme,kms,kme,&amp;<a name='5028'>
        max(grid%i_start(ij)-2,ids),  &amp;<a name='5029'>
        min(grid%i_end(ij)+2,ide),    &amp;<a name='5030'>
        max(grid%j_start(ij)-2,jds),  &amp;<a name='5031'>
        min(grid%j_end(ij)+2,jde),k_start,k_end )<a name='5032'>
BENCH_END(comp105)<a name='5033'>
    if ((config_flags%specified .or. config_flags%nested) .and. rk_step .eq. 1) then<a name='5034'>
BENCH_START(exch101)<a name='5035'>
#ifdef DM_PARALLEL<a name='5036'>
lineno = __LINE__<a name='5037'>
#  include "<A href='../../html_code/include/HALO_3632.inc.html'>HALO_3632.inc</A>"<A NAME="HALO_3632.inc_168"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5038'>
#endif<a name='5039'>
BENCH_END(exch101)<a name='5040'>
BENCH_START(comp106)<a name='5041'>
      call <A href='../../html_code/dyn_em/module_bc_em_ad.F.html#A_RELAX_BDY_DRY'>a_relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_RELAX_BDY_DRY_2">( config_flags,a_u_save,a_v_save,a_ph_save,a_t_save,a_w_save,a_mu_tend,a_ru,a_rv,ph_2,a_ph_2,t_2,a_t_2,&amp;<a name='5042'>
&amp;w_2,a_w_2,a_mu_2,mut,a_mut,a_u_b,a_v_b,a_ph_b,a_t_b,a_w_b,a_mu_b,a_u_bt,a_v_bt,a_ph_bt,a_t_bt,a_w_bt,a_mu_bt,spec_bdy_width,&amp;<a name='5043'>
&amp;spec_zone,relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='5044'>
        max(grid%i_start(ij)-2,ids),  &amp;<a name='5045'>
        min(grid%i_end(ij)+2,ide),    &amp;<a name='5046'>
        max(grid%j_start(ij)-2,jds),  &amp;<a name='5047'>
        min(grid%j_end(ij)+2,jde),k_start,k_end )<a name='5048'>
BENCH_END(comp106)<a name='5049'>
    endif<a name='5050'>
<a name='5051'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5052'></font>
#ifndef NO_HALO_FIX<a name='5053'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 101<a name='5054'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_169"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5055'>
#endif<a name='5056'>
<a name='5057'>
<font color=#447700>!------------------------------<a name='5058'></font>
<font color=#447700>!------------------------------<a name='5059'></font>
<a name='5060'>
BENCH_START(comp107)<a name='5061'>
#ifndef FAST_CPY<a name='5062'>
  xkmhd(:,:,:) = xkmhdh(:,:,:)<a name='5063'>
  w_2(:,:,:) = w_2h(:,:,:)<a name='5064'>
  w_1(:,:,:) = w_1h(:,:,:)<a name='5065'>
  v_2(:,:,:) = v_2h(:,:,:)<a name='5066'>
  v_1(:,:,:) = v_1h(:,:,:)<a name='5067'>
  u_2(:,:,:) = u_2h(:,:,:)<a name='5068'>
  u_1(:,:,:) = u_1h(:,:,:)<a name='5069'>
  t_tendf(:,:,:) = t_tendfh(:,:,:)<a name='5070'>
  t_2(:,:,:) = t_2h(:,:,:)<a name='5071'>
  t_1(:,:,:) = t_1h(:,:,:)<a name='5072'>
  rw_tendf(:,:,:) = rw_tendfh(:,:,:)<a name='5073'>
  rv_tendf(:,:,:) = rv_tendfh(:,:,:)<a name='5074'>
  ru_tendf(:,:,:) = ru_tendfh(:,:,:)<a name='5075'>
  pm1(:,:,:) = pm1h(:,:,:)<a name='5076'>
  ph_tendf(:,:,:) = ph_tendfh(:,:,:)<a name='5077'>
  ph_2(:,:,:) = ph_2h(:,:,:)<a name='5078'>
  ph_1(:,:,:) = ph_1h(:,:,:)<a name='5079'>
  p(:,:,:) = ph(:,:,:)<a name='5080'>
  mu_2(:,:) = mu_2h(:,:)<a name='5081'>
  mu_1(:,:) = mu_1h(:,:)<a name='5082'>
  moist_tend(:,:,:,:) = moist_tendh(:,:,:,:)<a name='5083'>
  moist_2(:,:,:,:) = moist_2h(:,:,:,:)<a name='5084'>
  moist_1(:,:,:,:) = moist_1h(:,:,:,:)<a name='5085'>
  dnw(:) = dnwh(:)<a name='5086'>
  al(:,:,:) = alh(:,:,:)<a name='5087'>
#else<a name='5088'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_351">(  xkmhd , xkmhdh, n3d_elem )<a name='5089'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_352">(  w_2 , w_2h, n3d_elem )<a name='5090'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_353">(  w_1 , w_1h, n3d_elem )<a name='5091'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_354">(  v_2 , v_2h, n3d_elem )<a name='5092'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_355">(  v_1 , v_1h, n3d_elem )<a name='5093'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_356">(  u_2 , u_2h, n3d_elem )<a name='5094'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_357">(  u_1 , u_1h, n3d_elem )<a name='5095'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_358">(  t_tendf , t_tendfh, n3d_elem )<a name='5096'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_359">(  t_2 , t_2h, n3d_elem )<a name='5097'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_360">(  t_1 , t_1h, n3d_elem )<a name='5098'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_361">(  rw_tendf , rw_tendfh, n3d_elem )<a name='5099'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_362">(  rv_tendf , rv_tendfh, n3d_elem )<a name='5100'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_363">(  ru_tendf , ru_tendfh, n3d_elem )<a name='5101'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_364">(  pm1 , pm1h, n3d_elem )<a name='5102'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_365">(  ph_tendf , ph_tendfh, n3d_elem )<a name='5103'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_366">(  ph_2 , ph_2h, n3d_elem )<a name='5104'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_367">(  ph_1 , ph_1h, n3d_elem )<a name='5105'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_368">(  p , ph, n3d_elem )<a name='5106'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_369">(  mu_2 , mu_2h, n2d_elem )<a name='5107'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_370">(  mu_1 , mu_1h, n2d_elem )<a name='5108'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_371">(  moist_tend(ims,kms,jms,2) , moist_tendh(ims,kms,jms,2), n3d_elem*(num_moist-1) )<a name='5109'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_372">(  moist_2(ims,kms,jms,2) , moist_2h(ims,kms,jms,2), n3d_elem*(num_moist-1) )<a name='5110'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_373">(  moist_1(ims,kms,jms,2) , moist_1h(ims,kms,jms,2), n3d_elem*(num_moist-1) )<a name='5111'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_374">(  dnw , dnwh, kme-kms+1 )<a name='5112'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_375">(  al , alh, n3d_elem )<a name='5113'>
#endif<a name='5114'>
<font color=#447700>!----------------------------------------<a name='5115'></font>
<a name='5116'>
  dtm = dt<a name='5117'>
  if (rk_order .eq. 1) then<a name='5118'>
    if (step_number .ne. 1) then<a name='5119'>
      number_of_small_timesteps = 2*time_step_sound<a name='5120'>
      dt_rk = dt<a name='5121'>
      dtm = 2*dt<a name='5122'>
    else<a name='5123'>
      number_of_small_timesteps = time_step_sound<a name='5124'>
      dt_rk = dt/2.<a name='5125'>
      dtm = dt<a name='5126'>
    endif<a name='5127'>
    dts_rk = dts<a name='5128'>
  else if (rk_order .eq. 2) then<a name='5129'>
    if (rk_step .eq. 1) then<a name='5130'>
      dt_rk = 0.5*dt<a name='5131'>
      dts_rk = dts<a name='5132'>
      number_of_small_timesteps = time_step_sound/2<a name='5133'>
    else<a name='5134'>
      dt_rk = dt<a name='5135'>
      dts_rk = dts<a name='5136'>
      number_of_small_timesteps = time_step_sound<a name='5137'>
    endif<a name='5138'>
  else if (rk_order .eq. 3) then<a name='5139'>
    if (rk_step .eq. 1) then<a name='5140'>
      dt_rk = dt/3.<a name='5141'>
      dts_rk = dt_rk<a name='5142'>
      number_of_small_timesteps = 1<a name='5143'>
    else if (rk_step .eq. 2) then<a name='5144'>
      dt_rk = 0.5*dt<a name='5145'>
      dts_rk = dts<a name='5146'>
      number_of_small_timesteps = time_step_sound/2<a name='5147'>
    else<a name='5148'>
      dt_rk = dt<a name='5149'>
      dts_rk = dts<a name='5150'>
      number_of_small_timesteps = time_step_sound<a name='5151'>
    endif<a name='5152'>
  endif<a name='5153'>
<font color=#447700>! recompute : dt_rk,dts_rk,number_of_small_timesteps<a name='5154'></font>
BENCH_END(comp107)<a name='5155'>
<a name='5156'>
BENCH_START(exch102)<a name='5157'>
#ifdef DM_PARALLEL<a name='5158'>
lineno = __LINE__<a name='5159'>
#    include "<A href='../../html_code/include/HALO_ADJ_A1.inc.html'>HALO_ADJ_A1.inc</A>"<A NAME="HALO_ADJ_A1.inc_170"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5160'>
#endif<a name='5161'>
BENCH_END(exch102)<a name='5162'>
<a name='5163'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5164'></font>
#ifndef NO_HALO_FIX<a name='5165'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 102<a name='5166'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_171"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5167'>
#endif<a name='5168'>
<a name='5169'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='5170'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_step_prep.  <a name='5171'></font>
 restore_rk_step_prepb4asd: if ( config_flags%remove_rk_step_prep ) then<a name='5172'>
BENCH_START(comprestore_rk_step_prep_tim)<a name='5173'>
   WRITE(wrf_err_message,*)'DEBUG:  restore_rk_step_prepb4asd:  rk_step, rk_order = ',rk_step,rk_order<a name='5174'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_52"> ( 10 , TRIM(wrf_err_message) )<a name='5175'>
   <font color=#447700>! store fields<a name='5176'></font>
   CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#SELECT_FRAME'>select_frame</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SELECT_FRAME_25">(rk_step, BUF_RK_STEP_PREP)<a name='5177'>
#include "<A href='../../html_code/include/restore_rk_step_prep.h.html'>restore_rk_step_prep.h</A>"<A NAME="restore_rk_step_prep.h_172"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5178'>
BENCH_END(comprestore_rk_step_prep_tim)<a name='5179'>
 else  <font color=#447700>! restore_rk_step_prepb4asd<a name='5180'></font>
<a name='5181'>
BENCH_START(comp108)<a name='5182'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_12">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='5183'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='5184'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='5185'>
BENCH_END(comp108)<a name='5186'>
<a name='5187'>
 endif restore_rk_step_prepb4asd<a name='5188'>
<a name='5189'>
BENCH_START(exch103)<a name='5190'>
#ifdef DM_PARALLEL<a name='5191'>
lineno = __LINE__<a name='5192'>
#    include "<A href='../../html_code/include/HALO_3723.inc.html'>HALO_3723.inc</A>"<A NAME="HALO_3723.inc_173"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5193'>
#endif<a name='5194'>
<a name='5195'>
#ifdef DM_PARALLEL<a name='5196'>
lineno = __LINE__<a name='5197'>
#    include "<A href='../../html_code/include/HALO_3728.inc.html'>HALO_3728.inc</A>"<A NAME="HALO_3728.inc_174"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5198'>
#endif<a name='5199'>
BENCH_END(exch103)<a name='5200'>
<a name='5201'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5202'></font>
#ifndef NO_HALO_FIX<a name='5203'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 103<a name='5204'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_175"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5205'>
#endif<a name='5206'>
<a name='5207'>
<font color=#447700>! recompute : alt,cqu,cqv,cqw,mut,muu,muv,php,ru,rv,rw,ww<a name='5208'></font>
  rk_step_is_onzr: if (rk_step .eq. 1) then<a name='5209'>
<a name='5210'>
BENCH_START(comp109)<a name='5211'>
      call <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_12">( ru_tendf,rv_tendf,rw_tendf,ph_tendf,t_tendf,tke_tend,moist_tend,chem_tend,num_3d_m,num_3d_c,rk_step,&amp;<a name='5212'>
&amp;ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='5213'>
BENCH_END(comp109)<a name='5214'>
<a name='5215'>
BENCH_START(exch104)<a name='5216'>
#ifdef DM_PARALLEL<a name='5217'>
lineno = __LINE__<a name='5218'>
<a name='5219'>
#endif<a name='5220'>
BENCH_END(exch104)<a name='5221'>
<a name='5222'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5223'></font>
#ifndef NO_HALO_FIX<a name='5224'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 104<a name='5225'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_176"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5226'>
#endif<a name='5227'>
<a name='5228'>
BENCH_START(comp110)<a name='5229'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_12">( config_flags,mut,u_2,v_2,p,pb,alt,ph_2,phb,t_2,tsk,moist_2,num_3d_m,mu_3d,rho,th_phy,p_phy,pi_phy,u_phy,v_phy,&amp;<a name='5230'>
&amp;p8w,t_phy,t8w,z,z_at_w,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,rqiblten,rthcuten,rqvcuten,rqccuten,&amp;<a name='5231'>
&amp;rqrcuten,rqicuten,rqscuten,rthften,rqvften,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),&amp;<a name='5232'>
&amp;grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='5233'>
BENCH_END(comp110)<a name='5234'>
<a name='5235'>
BENCH_START(exch105)<a name='5236'>
#ifdef DM_PARALLEL<a name='5237'>
lineno = __LINE__<a name='5238'>
<a name='5239'>
<a name='5240'>
<a name='5241'>
<a name='5242'>
#endif<a name='5243'>
BENCH_END(exch105)<a name='5244'>
<a name='5245'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5246'></font>
#ifndef NO_HALO_FIX<a name='5247'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 105<a name='5248'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_177"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5249'>
#endif<a name='5250'>
<a name='5251'>
BENCH_START(comp111)<a name='5252'>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='5253'>
<a name='5254'>
        call <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_12">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,xkmv,xkhh,xkhv,bn2,khdif,kvdif,div,defor11,&amp;<a name='5255'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,t8w,th_phy,t_phy,p_phy,moist_2,dn,dnw,dx,dy,rdz,rdzw,&amp;<a name='5256'>
&amp;mix_cr_len,num_3d_m,cf1,cf2,cf3,warm_rain,kh_tke_upper_bound,kv_tke_upper_bound,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,&amp;<a name='5257'>
&amp;kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='5258'>
<a name='5259'>
    endif<a name='5260'>
BENCH_END(comp111)<a name='5261'>
  endif rk_step_is_onzr<a name='5262'>
<a name='5263'>
#ifdef DM_PARALLEL<a name='5264'>
lineno = __LINE__<a name='5265'>
<a name='5266'>
<a name='5267'>
<a name='5268'>
<a name='5269'>
#endif<a name='5270'>
<a name='5271'>
<font color=#447700>!  recompute : moist_tend,ph_tendf,ru_tendf,rv_tendf,rw_tendf,t_tendf,xk<a name='5272'></font>
<font color=#447700>! mhd<a name='5273'></font>
<a name='5274'>
BENCH_START(exch106)<a name='5275'>
#ifdef DM_PARALLEL<a name='5276'>
lineno = __LINE__<a name='5277'>
#    include "<A href='../../html_code/include/HALO_3783.inc.html'>HALO_3783.inc</A>"<A NAME="HALO_3783.inc_178"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5278'>
#    include "<A href='../../html_code/include/HALO_3784.inc.html'>HALO_3784.inc</A>"<A NAME="HALO_3784.inc_179"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5279'>
<a name='5280'>
#endif<a name='5281'>
BENCH_END(exch106)<a name='5282'>
<a name='5283'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5284'></font>
#ifndef NO_HALO_FIX<a name='5285'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 106<a name='5286'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_180"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5287'>
#endif<a name='5288'>
<a name='5289'>
BENCH_START(comp_a_surface_drag)<a name='5290'>
<font color=#447700>!---------------------------------------------------------------------------------------------<a name='5291'></font>
<font color=#447700>!Zhang Xiaoyan add the AD of surface_drag on 12/05/2006<a name='5292'></font>
<font color=#447700>!---------------------------------------------------------------------------------------------<a name='5293'></font>
  IF (rk_step == 1 ) then<a name='5294'>
<a name='5295'>
 call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_SURFACE_DRAG'>a_surface_drag</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_SURFACE_DRAG_2">(ru_tendf, a_ru_tendf, rv_tendf, a_rv_tendf, u_2, a_u_2, v_2, a_v_2, xland, muu, a_muu, muv, a_muv, z, &amp;<a name='5296'>
&amp;a_z, z_at_w, a_z_at_w, &amp;<a name='5297'>
        ids, ide, jds, jde, kds, kde, &amp;<a name='5298'>
        ims, ime, jms, jme, kms, kme, &amp;<a name='5299'>
  grid%i_start(ij), grid%i_end(ij),                &amp;<a name='5300'>
  grid%j_start(ij), grid%j_end(ij),                &amp;<a name='5301'>
  k_start, k_end                                  )<a name='5302'>
  ENDIF<a name='5303'>
BENCH_END(comp_a_surface_drag)<a name='5304'>
<a name='5305'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5306'></font>
#ifndef NO_HALO_FIX<a name='5307'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 107<a name='5308'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_181"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5309'>
#endif<a name='5310'>
<a name='5311'>
<font color=#447700>!---------------------------------------------------------------------------------------------<a name='5312'></font>
<font color=#447700>!                 END<a name='5313'></font>
<font color=#447700>!---------------------------------------------------------------------------------------------<a name='5314'></font>
<a name='5315'>
BENCH_START(comp_a_rk_tendency1)<a name='5316'>
    call <A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY1'>a_rk_tendency1</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_RK_TENDENCY1_2">( config_flags,rk_step,a_ru_tend,a_rv_tend,a_rw_tend,a_ph_tend,a_t_tend,a_ru_tendf,a_rv_tendf,a_rw_tendf,&amp;<a name='5317'>
&amp;a_t_tendf,a_mu_tend,a_u_save,a_v_save,a_w_save,a_ph_save,a_t_save,ru,a_ru,rv,a_rv,rw,a_rw,ww,a_ww,u_2,a_u_2,v_2,a_v_2,w_2,&amp;<a name='5318'>
&amp;a_w_2,t_2,a_t_2,ph_2,a_ph_2,u_1,a_u_1,v_1,a_v_1,w_1,a_w_1,t_1,a_t_1,ph_1,a_ph_1,phb,t_init,mu_2,a_mu_2,mut,a_mut,muu,a_muu,&amp;<a name='5319'>
&amp;muv,a_muv,mub,al,a_al,alt,a_alt,p,a_p,pb,php,a_php,cqu,a_cqu,cqv,a_cqv,cqw,a_cqw,u_base,v_base,z_base,msfu,msfv,msft,f,e,sina,&amp;<a name='5320'>
&amp;cosa,fnm,fnp,rdn,rdnw,dt,rdx,rdy,kvdif,xkmhd,a_xkmhd,cf1,cf2,cf3,cfn,cfn1,non_hydrostatic,leapfrog,ids,ide,jds,jde,kde,ims,&amp;<a name='5321'>
&amp;ime,jms,jme,kms,kme,&amp;<a name='5322'>
        max(grid%i_start(ij)-3,ids),  &amp;<a name='5323'>
        min(grid%i_end(ij)+3,ide),    &amp;<a name='5324'>
        max(grid%j_start(ij)-3,jds),  &amp;<a name='5325'>
        min(grid%j_end(ij)+3,jde),k_start,k_end )<a name='5326'>
BENCH_END(comp_a_rk_tendency1)<a name='5327'>
<a name='5328'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5329'></font>
#ifndef NO_HALO_FIX<a name='5330'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 108<a name='5331'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_182"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5332'>
#endif<a name='5333'>
<a name='5334'>
<font color=#447700>! TBH: TODO:  remove unused BENCH timers<a name='5335'></font>
BENCH_START(exch107)<a name='5336'>
BENCH_END(exch107)<a name='5337'>
<a name='5338'>
BENCH_START(comp_a_rk_tendency2)<a name='5339'>
    call <A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_TENDENCY2'>a_rk_tendency2</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_RK_TENDENCY2_2">( config_flags,rk_step,a_ru_tend,a_rv_tend,a_rw_tend,a_ph_tend,a_t_tend,a_ru_tendf,a_rv_tendf,a_rw_tendf,&amp;<a name='5340'>
&amp;a_t_tendf,a_mu_tend,a_u_save,a_v_save,a_w_save,a_ph_save,a_t_save,ru,a_ru,rv,a_rv,rw,a_rw,ww,a_ww,u_2,a_u_2,v_2,a_v_2,w_2,&amp;<a name='5341'>
&amp;a_w_2,t_2,a_t_2,ph_2,a_ph_2,u_1,a_u_1,v_1,a_v_1,w_1,a_w_1,t_1,a_t_1,ph_1,a_ph_1,phb,t_init,mu_2,a_mu_2,mut,a_mut,muu,a_muu,&amp;<a name='5342'>
&amp;muv,a_muv,mub,al,a_al,alt,a_alt,p,a_p,pb,php,a_php,cqu,a_cqu,cqv,a_cqv,cqw,a_cqw,u_base,v_base,z_base,msfu,msfv,msft,f,e,sina,&amp;<a name='5343'>
&amp;cosa,fnm,fnp,rdn,rdnw,dt,rdx,rdy,kvdif,xkmhd,a_xkmhd,cf1,cf2,cf3,cfn,cfn1,non_hydrostatic,leapfrog,ids,ide,jds,jde,kde,ims,&amp;<a name='5344'>
&amp;ime,jms,jme,kms,kme,&amp;<a name='5345'>
        max(grid%i_start(ij)-3,ids),  &amp;<a name='5346'>
        min(grid%i_end(ij)+3,ide),    &amp;<a name='5347'>
        max(grid%j_start(ij)-3,jds),  &amp;<a name='5348'>
        min(grid%j_end(ij)+3,jde),k_start,k_end )<a name='5349'>
BENCH_END(comp_a_rk_tendency2)<a name='5350'>
BENCH_START(comp113)<a name='5351'>
<a name='5352'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5353'></font>
#ifndef NO_HALO_FIX<a name='5354'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 113<a name='5355'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_183"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5356'>
#endif<a name='5357'>
<a name='5358'>
<font color=#447700>!------------------------------<a name='5359'></font>
<font color=#447700>!------------------------------<a name='5360'></font>
<a name='5361'>
#ifndef FAST_CPY<a name='5362'>
  xkmhd(:,:,:) = xkmhdh(:,:,:)<a name='5363'>
  w_2(:,:,:) = w_2h(:,:,:)<a name='5364'>
  w_1(:,:,:) = w_1h(:,:,:)<a name='5365'>
  v_2(:,:,:) = v_2h(:,:,:)<a name='5366'>
  v_1(:,:,:) = v_1h(:,:,:)<a name='5367'>
  u_2(:,:,:) = u_2h(:,:,:)<a name='5368'>
  u_1(:,:,:) = u_1h(:,:,:)<a name='5369'>
  t_tendf(:,:,:) = t_tendfh(:,:,:)<a name='5370'>
  t_2(:,:,:) = t_2h(:,:,:)<a name='5371'>
  t_1(:,:,:) = t_1h(:,:,:)<a name='5372'>
  rw_tendf(:,:,:) = rw_tendfh(:,:,:)<a name='5373'>
  rv_tendf(:,:,:) = rv_tendfh(:,:,:)<a name='5374'>
  ru_tendf(:,:,:) = ru_tendfh(:,:,:)<a name='5375'>
  pm1(:,:,:) = pm1h(:,:,:)<a name='5376'>
  ph_tendf(:,:,:) = ph_tendfh(:,:,:)<a name='5377'>
  ph_2(:,:,:) = ph_2h(:,:,:)<a name='5378'>
  ph_1(:,:,:) = ph_1h(:,:,:)<a name='5379'>
  p(:,:,:) = ph(:,:,:)<a name='5380'>
  mu_2(:,:) = mu_2h(:,:)<a name='5381'>
  mu_1(:,:) = mu_1h(:,:)<a name='5382'>
  moist_tend(:,:,:,:) = moist_tendh(:,:,:,:)<a name='5383'>
  moist_2(:,:,:,:) = moist_2h(:,:,:,:)<a name='5384'>
  moist_1(:,:,:,:) = moist_1h(:,:,:,:)<a name='5385'>
  dnw(:) = dnwh(:)<a name='5386'>
  al(:,:,:) = alh(:,:,:)<a name='5387'>
#else<a name='5388'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_376">(  xkmhd , xkmhdh , n3d_elem )<a name='5389'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_377">(  w_2 , w_2h , n3d_elem )<a name='5390'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_378">(  w_1 , w_1h , n3d_elem )<a name='5391'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_379">(  v_2 , v_2h , n3d_elem )<a name='5392'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_380">(  v_1 , v_1h , n3d_elem )<a name='5393'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_381">(  u_2 , u_2h , n3d_elem )<a name='5394'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_382">(  u_1 , u_1h , n3d_elem )<a name='5395'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_383">(  t_tendf , t_tendfh , n3d_elem )<a name='5396'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_384">(  t_2 , t_2h , n3d_elem )<a name='5397'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_385">(  t_1 , t_1h , n3d_elem )<a name='5398'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_386">(  rw_tendf , rw_tendfh , n3d_elem )<a name='5399'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_387">(  rv_tendf , rv_tendfh , n3d_elem )<a name='5400'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_388">(  ru_tendf , ru_tendfh , n3d_elem )<a name='5401'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_389">(  pm1 , pm1h , n3d_elem )<a name='5402'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_390">(  ph_tendf , ph_tendfh , n3d_elem )<a name='5403'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_391">(  ph_2 , ph_2h , n3d_elem )<a name='5404'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_392">(  ph_1 , ph_1h , n3d_elem )<a name='5405'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_393">(  p , ph , n3d_elem )<a name='5406'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_394">(  mu_2 , mu_2h , n2d_elem )<a name='5407'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_395">(  mu_1 , mu_1h , n2d_elem )<a name='5408'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_396">(  moist_tend(ims,kms,jms,2) , moist_tendh(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='5409'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_397">(  moist_2(ims,kms,jms,2) , moist_2h(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='5410'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_398">(  moist_1(ims,kms,jms,2) , moist_1h(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='5411'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_399">(  dnw , dnwh , kme-kms+1 )<a name='5412'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_400">(  al , alh , n3d_elem )<a name='5413'>
#endif<a name='5414'>
<font color=#447700>!----------------------------------------<a name='5415'></font>
  dtm = dt<a name='5416'>
  if (rk_order .eq. 1) then<a name='5417'>
    if (step_number .ne. 1) then<a name='5418'>
      number_of_small_timesteps = 2*time_step_sound<a name='5419'>
      dt_rk = dt<a name='5420'>
      dtm = 2*dt<a name='5421'>
    else<a name='5422'>
      number_of_small_timesteps = time_step_sound<a name='5423'>
      dt_rk = dt/2.<a name='5424'>
      dtm = dt<a name='5425'>
    endif<a name='5426'>
    dts_rk = dts<a name='5427'>
  else if (rk_order .eq. 2) then<a name='5428'>
    if (rk_step .eq. 1) then<a name='5429'>
      dt_rk = 0.5*dt<a name='5430'>
      dts_rk = dts<a name='5431'>
      number_of_small_timesteps = time_step_sound/2<a name='5432'>
    else<a name='5433'>
      dt_rk = dt<a name='5434'>
      dts_rk = dts<a name='5435'>
      number_of_small_timesteps = time_step_sound<a name='5436'>
    endif<a name='5437'>
  else if (rk_order .eq. 3) then<a name='5438'>
    if (rk_step .eq. 1) then<a name='5439'>
      dt_rk = dt/3.<a name='5440'>
      dts_rk = dt_rk<a name='5441'>
      number_of_small_timesteps = 1<a name='5442'>
    else if (rk_step .eq. 2) then<a name='5443'>
      dt_rk = 0.5*dt<a name='5444'>
      dts_rk = dts<a name='5445'>
      number_of_small_timesteps = time_step_sound/2<a name='5446'>
    else<a name='5447'>
      dt_rk = dt<a name='5448'>
      dts_rk = dts<a name='5449'>
      number_of_small_timesteps = time_step_sound<a name='5450'>
    endif<a name='5451'>
  endif<a name='5452'>
BENCH_END(comp113)<a name='5453'>
<a name='5454'>
<font color=#447700>! TBH: TODO:  remove unused BENCH timers<a name='5455'></font>
BENCH_START(exch108)<a name='5456'>
BENCH_END(exch108)<a name='5457'>
<a name='5458'>
<font color=#447700>! recompute : dt_rk,dts_rk,number_of_small_timesteps<a name='5459'></font>
<a name='5460'>
<font color=#447700>! TBH:  Trade redundant computation for memory.  <a name='5461'></font>
<font color=#447700>! TBH:  Restore fields computed earlier by calls to rk_step_prep.  <a name='5462'></font>
 restore_rk_step_prepb4ackk: if ( config_flags%remove_rk_step_prep ) then<a name='5463'>
BENCH_START(comprestore_rk_step_prep_tim)<a name='5464'>
<font color=#447700>!   WRITE(wrf_err_message,*)'DEBUG:  restore_rk_step_prepb4ackk:  rk_step, rk_order = ',rk_step,rk_order<a name='5465'></font>
<font color=#447700>!   CALL wrf_debug ( 10 , TRIM(wrf_err_message) )<a name='5466'></font>
<font color=#447700>!   ! store fields<a name='5467'></font>
<font color=#447700>!   CALL select_frame(rk_step, BUF_RK_STEP_PREP)<a name='5468'></font>
<font color=#447700>!#include "restore_rk_step_prep.h"<a name='5469'></font>
<font color=#447700>!BENCH_END(comprestore_rk_step_prep_tim)<a name='5470'></font>
 else  <font color=#447700>! restore_rk_step_prepb4ackk<a name='5471'></font>
<a name='5472'>
BENCH_START(comp114)<a name='5473'>
    call <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_13">( config_flags,rk_step,u_2,v_2,w_2,t_2,ph_2,mu_2,moist_2,ru,rv,rw,ww,php,alt,muu,muv,mub,mut,phb,pb,p,al,alb,&amp;<a name='5474'>
&amp;cqu,cqv,cqw,msfu,msfv,msft,fnm,fnp,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='5475'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='5476'>
BENCH_END(comp114)<a name='5477'>
<a name='5478'>
 endif restore_rk_step_prepb4ackk<a name='5479'>
<a name='5480'>
<font color=#447700>! TBH: TODO:  remove unused BENCH timers<a name='5481'></font>
BENCH_START(exch109)<a name='5482'>
BENCH_END(exch109)<a name='5483'>
<a name='5484'>
<font color=#447700>! recompute : alt,cqu,cqv,cqw,mut,muu,muv,php,ru,rv,rw,ww<a name='5485'></font>
<a name='5486'>
  a_rk_step_is_one: if (rk_step .eq. 1) then<a name='5487'>
<font color=#447700>! recompute : p8w,p_phy,t8w,t_phy,th_phy<a name='5488'></font>
    if (diff_opt .eq. 2 .or. diff_opt .eq. 1) then<a name='5489'>
<a name='5490'>
<a name='5491'>
BENCH_START(exch110)<a name='5492'>
#ifdef DM_PARALLEL<a name='5493'>
lineno = __LINE__<a name='5494'>
<a name='5495'>
#endif<a name='5496'>
BENCH_END(exch110)<a name='5497'>
<a name='5498'>
BENCH_START(comp115)<a name='5499'>
        call <A href='../../html_code/dyn_em/module_diffusion_em_ad.F.html#A_CALCULATE_KM_KH'>a_calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_CALCULATE_KM_KH_2">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,a_xkmhd,xkmv,xkhh,xkhv,bn2,a_bn2h,khdif,div,&amp;<a name='5500'>
&amp;defor11,defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,a_p8w,t8w,a_t8w,th_phy,a_th_phy,t_phy,a_t_phy,&amp;<a name='5501'>
&amp;p_phy,a_p_phy,moist_2,a_moist_2,dn,dnw,dx,dy,rdz,rdzw,num_3d_m,cf1,cf2,cf3,kh_tke_upper_bound,ids,ide,jds,jde,kde,ims,ime,&amp;<a name='5502'>
&amp;jms,jme,kms,kme, &amp;<a name='5503'>
        max(grid%i_start(ij)-1,ids),  &amp;   <font color=#447700>! compute out an extra row/col on halo<a name='5504'></font>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='5505'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='5506'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='5507'>
BENCH_END(comp115)<a name='5508'>
<a name='5509'>
BENCH_START(exch111)<a name='5510'>
#ifdef DM_PARALLEL<a name='5511'>
lineno = __LINE__<a name='5512'>
#    include "<A href='../../html_code/include/HALO_3935.inc.html'>HALO_3935.inc</A>"<A NAME="HALO_3935.inc_184"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5513'>
<a name='5514'>
<a name='5515'>
<a name='5516'>
<a name='5517'>
#endif<a name='5518'>
BENCH_END(exch111)<a name='5519'>
<a name='5520'>
    endif<a name='5521'>
<a name='5522'>
<font color=#447700>!XIAO: Cumulus should be here<a name='5523'></font>
<a name='5524'>
<font color=#447700>!---------------------------------<a name='5525'></font>
<font color=#447700>!!!!  Add CUDU Here   !!!!!!!!<a name='5526'></font>
<font color=#447700>!--------------------------------<a name='5527'></font>
<font color=#447700>!BENCH_START(a_cu_driver_tim)<a name='5528'></font>
<a name='5529'>
         CALL wrf_debug ( 200 , ' call a_cumulus_driver' )<a name='5530'>
         IF (cu_physics .eq. 5) then            <font color=#447700>!IF for CUDU<a name='5531'></font>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_53">(100,'in du_cps')<a name='5532'>
<a name='5533'>
            Print *, 'yyyy  CALL TL DU_CU scheme from solve_em_ad yyyy'<a name='5534'>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='5535'>
               do k = k_start, min(k_end, kde-1)<a name='5536'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='5537'>
                  rho(i,k,j) = 1./alt(i,k,j)*(1.+moist_2(i,k,j,P_QV))<a name='5538'>
                  u_phy(i,k,j) = 0.5*(u_2(i,k,j)+u_2(i+1,k,j))<a name='5539'>
                  v_phy(i,k,j) = 0.5*(v_2(i,k,j)+v_2(i,k,j+1))<a name='5540'>
                  rthcuten(i,k,j) = rthcuten(i,k,j)/mut(i,j)<a name='5541'>
                  rqvcuten(i,k,j) = rqvcuten(i,k,j)/mut(i,j)<a name='5542'>
               end do<a name='5543'>
               end do<a name='5544'>
               end do<a name='5545'>
<a name='5546'>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='5547'>
               do k = k_start, kde-1<a name='5548'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='5549'>
                  dz8w(i,k,j)= z_at_w(i,k+1,j)-z_at_w(i,k,j)<a name='5550'>
               end do<a name='5551'>
               end do<a name='5552'>
               end do<a name='5553'>
<a name='5554'>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='5555'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='5556'>
                  dz8w(i,kde,j) = 0.<a name='5557'>
               end do<a name='5558'>
               end do<a name='5559'>
<font color=#447700>!XIAO<a name='5560'></font>
               CALL <A href='../../html_code/phys/module_cu_du.F.html#DUCU'>DUCU</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DUCU_4">( ids,ide,jds,jde,kds,kde &amp;<a name='5561'>
               ,ims,ime,jms,jme,kms,kme &amp;<a name='5562'>
               ,grid%i_start(ij),min(grid%i_end(ij), ide-1)      &amp;<a name='5563'>
               ,grid%j_start(ij), min(grid%j_end(ij), jde-1)    &amp;<a name='5564'>
               ,k_start,min(k_end, kde-1) &amp;<a name='5565'>
               ,dt ,itimestep ,dx                    &amp;<a name='5566'>
               ,rho,raincv                       &amp;<a name='5567'>
               ,nca,u_phy ,v_phy                        &amp;<a name='5568'>
               ,th_phy,t_phy                   &amp;<a name='5569'>
               ,w_2                                           &amp;<a name='5570'>
               ,dz8w,z,p_phy                 &amp;<a name='5571'>
               ,pi_phy,grid%W0AVG,XLV              &amp;<a name='5572'>
               ,CP ,R_d ,R_v ,G ,EP_2             &amp;<a name='5573'>
               ,SVP1 ,SVP2 ,SVP3 ,SVPT0    &amp;<a name='5574'>
               ,stepcu                                   &amp;<a name='5575'>
               ,cu_act_flag ,warm_rain    &amp;<a name='5576'>
               ,HTOP,HBOT                           &amp;<a name='5577'>
               ,moist_2(ims,kms,jms,P_QV) &amp;<a name='5578'>
              <font color=#447700>! optionals<a name='5579'></font>
               ,rthcuten, rqvcuten )<a name='5580'>
<font color=#447700>!XIAO<a name='5581'></font>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='5582'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='5583'>
                  do k = k_start, min(k_end, kde-1)<a name='5584'>
                     a_mut(I,J) = a_mut(I,J) + rqvcuten(I,K,J) * a_moist_tend(I,K,J,P_QV)<a name='5585'>
                     a_rqvcuten(I,K,J) = a_rqvcuten(I,K,J) + a_moist_tend(I,K,J,P_QV) * mut(I,J)<a name='5586'>
                     a_mut(I,J) = a_mut(I,J) + rthcuten(I,K,J) * a_t_tendf(I,K,J)<a name='5587'>
                     a_rthcuten(I,K,J) = a_rthcuten(I,K,J) + a_t_tendf(I,K,J) * mut(I,J)<a name='5588'>
                  end do<a name='5589'>
                  a_raincv(I,J) = a_raincv(I,J) + a_rainc(I,J)<a name='5590'>
               end do<a name='5591'>
               end do<a name='5592'>
<a name='5593'>
               CALL <A href='../../html_code/phys/module_cu_du.F.html#DUCU_B'>DUCU_B</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DUCU_B_2">( ids,ide,jds,jde,kds,kde &amp;<a name='5594'>
               ,ims,ime,jms,jme,kms,kme &amp;<a name='5595'>
               ,grid%i_start(ij),min(grid%i_end(ij), ide-1)      &amp;<a name='5596'>
               ,grid%j_start(ij), min(grid%j_end(ij), jde-1)    &amp;<a name='5597'>
               ,k_start,min(k_end, kde-1) &amp;<a name='5598'>
               ,dt ,itimestep ,dx                    &amp;<a name='5599'>
               ,rho,a_rho,raincv,a_raincv                       &amp;<a name='5600'>
               ,nca,u_phy ,v_phy                        &amp;<a name='5601'>
               ,th_phy,a_th_phy,t_phy,a_t_phy                   &amp;<a name='5602'>
               ,w_2                                           &amp;<a name='5603'>
               ,dz8w,a_dz8w,z,a_z,p_phy,a_p_phy                 &amp;<a name='5604'>
               ,pi_phy,grid%W0AVG,XLV              &amp;<a name='5605'>
               ,CP ,R_d ,R_v ,G ,EP_2             &amp;<a name='5606'>
               ,SVP1 ,SVP2 ,SVP3 ,SVPT0    &amp;<a name='5607'>
               ,stepcu                                   &amp;<a name='5608'>
               ,cu_act_flag ,warm_rain    &amp;<a name='5609'>
               ,HTOP,HBOT                           &amp;<a name='5610'>
               ,moist_2(ims,kms,jms,P_QV),a_moist_2(ims,kms,jms,P_QV)&amp;<a name='5611'>
              <font color=#447700>! optionals<a name='5612'></font>
               ,rthcuten,a_rthcuten, rqvcuten,a_rqvcuten )<a name='5613'>
<a name='5614'>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='5615'>
               do k = k_start, min(k_end, kde-1)<a name='5616'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='5617'>
                   a_rqvcuten(I,K,J) = a_rqvcuten(I,K,J) / mut(I,J)<a name='5618'>
                   a_rthcuten(I,K,J) = a_rthcuten(I,K,J) / mut(I,J) <a name='5619'>
               end do<a name='5620'>
               end do<a name='5621'>
               end do<a name='5622'>
           ENDIF<a name='5623'>
<font color=#447700>!BENCH_END(a_cu_driver_tim)<a name='5624'></font>
<font color=#447700>!---------------------------------<a name='5625'></font>
<font color=#447700>!!!! XIAO CUDU End Here   !!!!!!!!<a name='5626'></font>
<font color=#447700>!---------------------------------<a name='5627'></font>
<a name='5628'>
BENCH_START(comp116)<a name='5629'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_ad.F.html#A_PHY_PREP'>a_phy_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_PHY_PREP_2">( p,a_p,pb,ph_2,a_ph_2,phb,t_2,a_t_2,th_phy,a_th_phy,p_phy,a_p_phy,pi_phy,a_pi_phyh,a_p8w,t_phy,a_t_phy,a_t8w,&amp;<a name='5630'>
&amp;z,a_z,z_at_w,a_z_at_wh,fnm,fnp,ide,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='5631'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='5632'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='5633'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='5634'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='5635'>
<a name='5636'>
      call <A href='../../html_code/dyn_em/module_em_ad.F.html#A_INIT_ZERO_TENDENCY'>a_init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_INIT_ZERO_TENDENCY_2">( a_ru_tendf,a_rv_tendf,a_rw_tendf,a_ph_tendf,a_t_tendf,a_moist_tend,num_3d_m,ims,ime,jms,jme,kms,&amp;<a name='5637'>
&amp;kme,&amp;<a name='5638'>
        max(grid%i_start(ij)-1,ids),  &amp;<a name='5639'>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='5640'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='5641'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='5642'>
BENCH_END(comp116)<a name='5643'>
<a name='5644'>
  endif a_rk_step_is_one<a name='5645'>
<a name='5646'>
<font color=#447700>! TBH: TODO:  remove unused BENCH timers<a name='5647'></font>
BENCH_START(exch112)<a name='5648'>
BENCH_END(exch112)<a name='5649'>
<a name='5650'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5651'></font>
#ifndef NO_HALO_FIX<a name='5652'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 116<a name='5653'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_185"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5654'>
#endif<a name='5655'>
<a name='5656'>
BENCH_START(comp117)<a name='5657'>
#ifndef FAST_CPY<a name='5658'>
  dnw(:) = dnwh(:)<a name='5659'>
  moist_2(:,:,:,:) = moist_2h(:,:,:,:)<a name='5660'>
  mu_2(:,:) = mu_2h(:,:)<a name='5661'>
  u_2(:,:,:) = u_2h(:,:,:)<a name='5662'>
  v_2(:,:,:) = v_2h(:,:,:)<a name='5663'>
  w_2(:,:,:) = w_2h(:,:,:)<a name='5664'>
#else<a name='5665'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_401">( dnw , dnwh , kme-kms+1 )<a name='5666'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_402">( moist_2(ims,kms,jms,2) , moist_2h(ims,kms,jms,2) , n3d_elem*(num_moist-1) )<a name='5667'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_403">( mu_2 , mu_2h , n2d_elem )<a name='5668'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_404">( u_2 , u_2h , n3d_elem )<a name='5669'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_405">( v_2 , v_2h , n3d_elem )<a name='5670'>
  call <A href='../../html_code/frame/fast_copy.F.html#FAST_COPY_LINT'>fast_copy_lint</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FAST_COPY_LINT_406">( w_2 , w_2h , n3d_elem )<a name='5671'>
#endif<a name='5672'>
BENCH_END(comp117)<a name='5673'>
<a name='5674'>
BENCH_START(exch113)<a name='5675'>
#ifdef DM_PARALLEL<a name='5676'>
lineno = __LINE__<a name='5677'>
# include "<A href='../../html_code/include/HALO_3982.inc.html'>HALO_3982.inc</A>"<A NAME="HALO_3982.inc_186"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5678'>
#endif<a name='5679'>
BENCH_END(exch113)<a name='5680'>
<a name='5681'>
BENCH_START(comp118)<a name='5682'>
    call <A href='../../html_code/dyn_em/module_em_ad.F.html#A_RK_STEP_PREP'>a_rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="A_RK_STEP_PREP_2">( config_flags,u_2,a_u_2,v_2,a_v_2,w_2,a_w_2,a_ph_2,mu_2,a_mu_2,moist_2,a_moist_2,a_ru,a_rv,a_rw,a_ww,a_php,&amp;<a name='5683'>
&amp;a_alt,muu,a_muu,muv,a_muv,mub,mut,a_mut,a_al,a_cqu,a_cqv,a_cqw,msfu,msfv,msft,dnw,rdx,rdy,num_3d_m,ids,ide,jds,jde,kde,ims,&amp;<a name='5684'>
&amp;ime,jms,jme,kms,kme, &amp;<a name='5685'>
        max(grid%i_start(ij)-1,ids),  &amp;   <font color=#447700>! compute out an extra row/col on halo<a name='5686'></font>
        min(grid%i_end(ij)+1,ide),    &amp;<a name='5687'>
        max(grid%j_start(ij)-1,jds),  &amp;<a name='5688'>
        min(grid%j_end(ij)+1,jde),k_start,k_end )<a name='5689'>
BENCH_END(comp118)<a name='5690'>
<a name='5691'>
BENCH_START(exch114)<a name='5692'>
#ifdef DM_PARALLEL<a name='5693'>
lineno = __LINE__<a name='5694'>
#  include "<A href='../../html_code/include/HALO_3997.inc.html'>HALO_3997.inc</A>"<A NAME="HALO_3997.inc_187"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5695'>
#endif<a name='5696'>
BENCH_END(exch114)<a name='5697'>
<a name='5698'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5699'></font>
#ifndef NO_HALO_FIX<a name='5700'>
  filecount = 10000 + ((rk_order-rk_step+1)*1000) + 118<a name='5701'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_188"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5702'>
#endif<a name='5703'>
<a name='5704'>
end do a_runge_kutta_loop<a name='5705'>
<a name='5706'>
#include &lt;<A href='../../html_code/include/bench_solve_em_a_end.h.html'>bench_solve_em_a_end.h</A>&gt;<A NAME="bench_solve_em_a_end.h_189"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5707'>
<a name='5708'>
<font color=#447700>!----------------------------------------------<a name='5709'></font>
<font color=#447700>! FREE DYNAMIC MEMORY<a name='5710'></font>
<font color=#447700>!----------------------------------------------<a name='5711'></font>
#endif<a name='5712'>
<a name='5713'>
<font color=#447700>! TBH:  turn this off once halo debugging is finished<a name='5714'></font>
#ifndef NO_HALO_FIX<a name='5715'>
  filecount = 99999<a name='5716'>
#include &lt;<A href='../../html_code/include/all_debug_halo.h.html'>all_debug_halo.h</A>&gt;<A NAME="all_debug_halo.h_190"><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5717'>
  call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_3"> ( 'DEBUG:  EARLY EXIT FOR HALO TESTS' )<a name='5718'>
  call <A href='../../html_code/frame/wrf_shutdown.F.html#WRF_SHUTDOWN'>wrf_shutdown</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SHUTDOWN_1"><a name='5719'>
#endif<a name='5720'>
<a name='5721'>
CALL <A href='../../html_code/dyn_em/module_4dvaropt.F.html#MODULE_4DVAROPT_END'>module_4dvaropt_end</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_4DVAROPT_END_1"><a name='5722'>
CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_54"> ( 10 , 'DEBUG:  end solve_em_ad()' )<a name='5723'>
<a name='5724'>
if(grid%trace_use) call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/solve_em_ad.F.html#SOLVE_EM_AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_104">("solve_em_ad")<a name='5725'>
<a name='5726'>
end subroutine solve_em_ad<a name='5727'>
<a name='5728'>
<a name='5729'>
</pre></body></html>