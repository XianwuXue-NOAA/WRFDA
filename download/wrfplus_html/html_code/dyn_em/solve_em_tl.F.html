<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MEDIATION_LAYER:SOLVER<a name='2'></font>
<a name='3'>
<A NAME='SOLVE_EM_TL'><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>solve_em_tl</font> ( grid , config_flags , &amp; <A href='../../call_to/SOLVE_EM_TL.html' TARGET='index'>3</A>,<A href='../../call_from/SOLVE_EM_TL.html' TARGET='index'>188</A><a name='5'>
<font color=#447700>! Actual arguments generated from Registry<a name='6'></font>
#include "<A href='../../html_code/include/em_dummy_args.inc.html'>em_dummy_args.inc</A>"<A NAME="em_dummy_args.inc_1"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7'>
<font color=#447700>!<a name='8'></font>
                    )<a name='9'>
<a name='10'>
<font color=#447700>! Driver layer modules<a name='11'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_16"><a name='12'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_29"><a name='13'>
   USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_4"><a name='14'>
   USE <A href='../../html_code/frame/module_machine.F.html#MODULE_MACHINE'>module_machine</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MACHINE_4"><a name='15'>
   USE <A href='../../html_code/frame/module_tiles.F.html#MODULE_TILES'>module_tiles</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TILES_4"><a name='16'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_13"><a name='17'>
<font color=#447700>! Mediation layer modules<a name='18'></font>
<font color=#447700>! Model layer modules<a name='19'></font>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_25"><a name='20'>
   USE <A href='../../html_code/dyn_em/module_small_step_em.F.html#MODULE_SMALL_STEP_EM'>module_small_step_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SMALL_STEP_EM_5"><a name='21'>
   USE <A href='../../html_code/dyn_em/module_em.F.html#MODULE_EM'>module_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_EM_5"><a name='22'>
   USE <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#MODULE_BIG_STEP_UTILITIES_EM'>module_big_step_utilities_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BIG_STEP_UTILITIES_EM_13"><a name='23'>
   USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_22"><a name='24'>
   USE <A href='../../html_code/dyn_em/module_bc_em.F.html#MODULE_BC_EM'>module_bc_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_EM_5"><a name='25'>
   USE <A href='../../html_code/dyn_em/module_solvedebug_em.F.html#MODULE_SOLVEDEBUG_EM'>module_solvedebug_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SOLVEDEBUG_EM_3"><a name='26'>
   USE <A href='../../html_code/phys/module_physics_addtendc.F.html#MODULE_PHYSICS_ADDTENDC'>module_physics_addtendc</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_PHYSICS_ADDTENDC_3"><a name='27'>
   USE <A href='../../html_code/dyn_em/module_diffusion_em.F.html#MODULE_DIFFUSION_EM'>module_diffusion_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DIFFUSION_EM_5"><a name='28'>
<font color=#447700>! Registry generated module<a name='29'></font>
   USE module_state_description<a name='30'>
   USE <A href='../../html_code/phys/module_radiation_driver.F.html#MODULE_RADIATION_DRIVER'>module_radiation_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RADIATION_DRIVER_3"><a name='31'>
   USE <A href='../../html_code/phys/module_surface_driver.F.html#MODULE_SURFACE_DRIVER'>module_surface_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SURFACE_DRIVER_3"><a name='32'>
   USE <A href='../../html_code/phys/module_cumulus_driver.F.html#MODULE_CUMULUS_DRIVER'>module_cumulus_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CUMULUS_DRIVER_3"><a name='33'>
   USE <A href='../../html_code/phys/module_cu_du.F.html#MODULE_CU_DU'>module_cu_du</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CU_DU_4"> , only : DUCU_D<a name='34'>
   USE <A href='../../html_code/phys/module_microphysics_driver.F.html#MODULE_MICROPHYSICS_DRIVER'>module_microphysics_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MICROPHYSICS_DRIVER_3"><a name='35'>
   USE <A href='../../html_code/phys/module_pbl_driver.F.html#MODULE_PBL_DRIVER'>module_pbl_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_PBL_DRIVER_3"><a name='36'>
   USE <A href='../../html_code/phys/module_mp_nconvp.F.html#MODULE_MP_NCONVP'>module_mp_nconvp</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_NCONVP_4"> <font color=#447700>!Xiaoyan Zhang 11/2006<a name='37'></font>
#ifdef WRF_CHEM<a name='38'>
   USE module_input_chem_data<a name='39'>
   USE module_chem_utilities<a name='40'>
#endif<a name='41'>
<a name='42'>
   USE <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_MODULE_SMALL_STEP_EM'>g_module_small_step_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MODULE_SMALL_STEP_EM_2"><a name='43'>
   USE <A href='../../html_code/dyn_em/module_em_tl.F.html#G_MODULE_EM'>g_module_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MODULE_EM_2"><a name='44'>
   USE <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MODULE_BIG_STEP_UTILITIES_EM'>g_module_big_step_utilities_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MODULE_BIG_STEP_UTILITIES_EM_4"><a name='45'>
   USE <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_MODULE_BC'>g_module_bc</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MODULE_BC_4"><a name='46'>
   USE <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_MODULE_BC_EM'>g_module_bc_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MODULE_BC_EM_2"><a name='47'>
   USE <A href='../../html_code/dyn_em/module_diffusion_em_tl.F.html#G_MODULE_DIFFUSION_EM'>g_module_diffusion_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MODULE_DIFFUSION_EM_2"><a name='48'>
<a name='49'>
   USE <A href='../../html_code/frame/module_trace.F.html#MODULE_TRACE'>module_trace</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TRACE_14">, only : trace_entry, trace_exit<a name='50'>
<a name='51'>
   IMPLICIT NONE<a name='52'>
<a name='53'>
   <font color=#447700>!  Input data.<a name='54'></font>
<a name='55'>
   TYPE(domain) , TARGET          :: grid<a name='56'>
<a name='57'>
   <font color=#447700>!  Definitions of dummy arguments to this routine (generated from Registry).<a name='58'></font>
#include &lt;<A href='../../html_code/include/em_dummy_decl.inc.html'>em_dummy_decl.inc</A>&gt;<A NAME="em_dummy_decl.inc_2"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='59'>
<a name='60'>
   <font color=#447700>!  Structure that contains run-time configuration (namelist) data for domain<a name='61'></font>
   TYPE (grid_config_rec_type) , INTENT(IN)          :: config_flags<a name='62'>
<a name='63'>
   <font color=#447700>! Local data<a name='64'></font>
<a name='65'>
   INTEGER                         :: k_start , k_end, its, ite, jts, jte<a name='66'>
   INTEGER                         :: ids , ide , jds , jde , kds , kde , &amp;<a name='67'>
                                      ims , ime , jms , jme , kms , kme , &amp;<a name='68'>
                                      ips , ipe , jps , jpe , kps , kpe<a name='69'>
   INTEGER                         :: ij , iteration,iteration1<a name='70'>
   INTEGER                         :: im , num_3d_m , ic , num_3d_c<a name='71'>
   INTEGER                         :: loop<a name='72'>
   INTEGER                         :: ijds, ijde<a name='73'>
   INTEGER                         :: itmpstep<a name='74'>
   INTEGER                         :: sz<a name='75'>
<a name='76'>
<font color=#447700>! storage for tendencies and decoupled state (generated from Registry)<a name='77'></font>
#include &lt;<A href='../../html_code/include/em_i1_decl.inc.html'>em_i1_decl.inc</A>&gt;<A NAME="em_i1_decl.inc_3"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='78'>
<a name='79'>
   INTEGER :: rc <a name='80'>
   INTEGER :: number_of_small_timesteps, rk_step<a name='81'>
   INTEGER :: klevel,ijm,ijp,i,j,k,size1,size2    <font color=#447700>! for prints/plots only<a name='82'></font>
   INTEGER :: idum1, idum2, dynamics_option<a name='83'>
<a name='84'>
   INTEGER :: rk_order, iwmax, jwmax, kwmax<a name='85'>
   REAL :: dt_rk, dts_rk, dtm, wmax<a name='86'>
   LOGICAL :: leapfrog<a name='87'>
   INTEGER :: l,kte,kk<a name='88'>
<a name='89'>
<font color=#447700>!--Local variables<a name='90'></font>
<font color=#447700>!Xiaoyan Zhang add<a name='91'></font>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: g_h_diabatic<a name='92'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: g_rainnc<a name='93'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: g_rainncv<a name='94'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: g_rainc<a name='95'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm33:grid%em33)                               :: g_raincv<a name='96'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: g_rqvcuten<a name='97'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: g_rthcuten<a name='98'>
<a name='99'>
<font color=#447700>!!!!!<a name='100'></font>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: g_z_at_wm<a name='101'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: g_pi_phym<a name='102'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: g_xkmhm<a name='103'>
   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33)           :: g_bn2m<a name='104'>
<a name='105'>
   real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)    :: g_rqc_btm<a name='106'>
   real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)    :: g_rqr_btm<a name='107'>
   real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)    :: g_rqi_btm<a name='108'>
   real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)    :: g_rqs_btm<a name='109'>
   real, DIMENSION(max(grid%ed31,grid%ed33),grid%sd32:grid%ed32,grid%spec_bdy_width,4)    :: g_rqg_btm<a name='110'>
<a name='111'>
<font color=#447700>!JM   real, DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,num_moist) :: g_moist_tend<a name='112'></font>
<a name='113'>
<font color=#447700>! These are used if -DDEREF_KLUDGE is compiled<a name='114'></font>
<font color=#447700>!  see http://www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='115'></font>
   INTEGER     :: sm31  , em31  , sm32  , em32  , sm33  , em33<a name='116'>
   INTEGER     :: sm31x , em31x , sm32x , em32x , sm33x , em33x<a name='117'>
   INTEGER     :: sm31y , em31y , sm32y , em32y , sm33y , em33y<a name='118'>
<a name='119'>
<font color=#447700>! Define benchmarking timers if -DBENCH is compiled<a name='120'></font>
#include &lt;<A href='../../html_code/include/bench_solve_em_def.h.html'>bench_solve_em_def.h</A>&gt;<A NAME="bench_solve_em_def.h_4"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='121'>
<a name='122'>
<font color=#447700>!----------------------<a name='123'></font>
<font color=#447700>! Executable statements<a name='124'></font>
<font color=#447700>!----------------------<a name='125'></font>
<a name='126'>
<font color=#447700>! Trick problematic compilers into not performing copy-in/copy-out by adding<a name='127'></font>
<font color=#447700>! indices to array arguments in the CALL statements in this routine.<a name='128'></font>
<font color=#447700>! It has the effect of passing only the first element of the array, rather <a name='129'></font>
<font color=#447700>! than the entire array.  See:  <a name='130'></font>
<font color=#447700>! http://www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='131'></font>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_5"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='132'>
<a name='133'>
<font color=#447700>! Limit the number of arguments if compiled with -DLIMIT_ARGS by copying <a name='134'></font>
<font color=#447700>! scalar (non-array) arguments out of the grid data structure into locally<a name='135'></font>
<font color=#447700>! defined copies (defined in em_dummy_decl.inc, above, as they are if they<a name='136'></font>
<font color=#447700>! are arguments). An equivalent include of em_scalar_derefs.inc appears<a name='137'></font>
<font color=#447700>! at the end of the routine to copy back any chnaged non-array values.<a name='138'></font>
<font color=#447700>! The definition of COPY_IN or COPY_OUT before the include defines the<a name='139'></font>
<font color=#447700>! direction of the copy.  Em_scalar_derefs.inc is generated from Registry<a name='140'></font>
#define COPY_IN<a name='141'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_6"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='142'>
<a name='143'>
<font color=#447700>! Needed by some comm layers, e.g. RSL. If needed, nmm_data_calls.inc is<a name='144'></font>
<font color=#447700>! generated from the registry.  The definition of REGISTER_I1 allows<a name='145'></font>
<font color=#447700>! I1 data to be communicated in this routine if necessary.<a name='146'></font>
#ifdef DM_PARALLEL<a name='147'>
#    define REGISTER_I1<a name='148'>
#      include &lt;<A href='../../html_code/include/em_data_calls.inc.html'>em_data_calls.inc</A>&gt;<A NAME="em_data_calls.inc_7"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='149'>
#endif<a name='150'>
<a name='151'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='152'></font>
<font color=#447700>!&lt;pre&gt;<a name='153'></font>
<font color=#447700>! solve_em_tl is the main driver for advancing a grid a single timestep.<a name='154'></font>
<font color=#447700>! It is a mediation-layer routine -&gt; DM and SM calls are made where <a name='155'></font>
<font color=#447700>! needed for parallel processing.  <a name='156'></font>
<font color=#447700>!<a name='157'></font>
<font color=#447700>! solve_em_tl can integrate the equations using 3 time-integration methods<a name='158'></font>
<font color=#447700>!      <a name='159'></font>
<font color=#447700>!    - 3rd order Runge-Kutta time integration (recommended)<a name='160'></font>
<font color=#447700>!      <a name='161'></font>
<font color=#447700>!    - 2nd order Runge-Kutta time integration<a name='162'></font>
<font color=#447700>!      <a name='163'></font>
<font color=#447700>!    - Leapfrog time integration<a name='164'></font>
<font color=#447700>!      (note: the leapfrog scheme is not correctly implemented<a name='165'></font>
<font color=#447700>!      for most of the physics)<a name='166'></font>
<font color=#447700>!<a name='167'></font>
<font color=#447700>! The main sections of solve_em_tl are<a name='168'></font>
<font color=#447700>!     <a name='169'></font>
<font color=#447700>! (1) Runge-Kutta (RK) loop<a name='170'></font>
<font color=#447700>!     <a name='171'></font>
<font color=#447700>! (2) Non-timesplit physics (i.e., tendencies computed for updating<a name='172'></font>
<font color=#447700>!     model state variables during the first RK sub-step (loop)<a name='173'></font>
<font color=#447700>!     <a name='174'></font>
<font color=#447700>! (3) Small (acoustic, sound) timestep loop - within the RK sub-steps<a name='175'></font>
<font color=#447700>!     <a name='176'></font>
<font color=#447700>! (4) Scalar advance for moist and chem scalar variables (and TKE)<a name='177'></font>
<font color=#447700>!     within the RK sub-steps.<a name='178'></font>
<font color=#447700>!     <a name='179'></font>
<font color=#447700>! (5) time-split physics (after the RK step), currently this includes<a name='180'></font>
<font color=#447700>!     only microphyics<a name='181'></font>
<font color=#447700>!<a name='182'></font>
<font color=#447700>! A more detailed description of these sections follows.<a name='183'></font>
<font color=#447700>!&lt;/pre&gt;<a name='184'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='185'></font>
<a name='186'>
<font color=#447700>! Initialize timers if compiled with -DBENCH<a name='187'></font>
#include &lt;<A href='../../html_code/include/bench_solve_em_init.h.html'>bench_solve_em_init.h</A>&gt;<A NAME="bench_solve_em_init.h_8"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='188'>
<a name='189'>
<font color=#447700>!  set leapfrog or runge-kutta solver (2nd or 3rd order)<a name='190'></font>
<a name='191'>
<font color=#447700>!xyh return to be identity operation<a name='192'></font>
<font color=#447700>!   return<a name='193'></font>
<a name='194'>
   dynamics_option = config_flags%rk_ord<a name='195'>
<a name='196'>
<font color=#447700>!  Obtain dimension information stored in the grid data structure.<a name='197'></font>
  CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_7"> (  grid ,                   &amp;<a name='198'>
                            ids, ide, jds, jde, kds, kde,    &amp;<a name='199'>
                            ims, ime, jms, jme, kms, kme,    &amp;<a name='200'>
                            ips, ipe, jps, jpe, kps, kpe    )<a name='201'>
<a name='202'>
  k_start         = kps<a name='203'>
  k_end           = kpe<a name='204'>
<a name='205'>
  ijds = min(ids, jds)<a name='206'>
  ijde = max(ide, jde)<a name='207'>
<a name='208'>
  num_3d_m        = num_moist<a name='209'>
  num_3d_c        = num_chem<a name='210'>
<a name='211'>
<font color=#447700>!  Compute these starting and stopping locations for each tile and number of tiles.<a name='212'></font>
<font color=#447700>!  See: http://www2.mmm.ucar.edu/wrf/WG2/topics/settiles<a name='213'></font>
  CALL <A href='../../html_code/frame/module_tiles.F.html#SET_TILES'>set_tiles</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_TILES_3"> ( grid , ids , ide , jds , jde , ips , ipe , jps , jpe )<a name='214'>
<a name='215'>
  itimestep = itimestep + 1<a name='216'>
<a name='217'>
#ifdef DM_PARALLEL<a name='218'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_1.inc.html'>HALO_EM_INIT_1.inc</A>"<A NAME="HALO_EM_INIT_1.inc_9"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='219'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_2.inc.html'>HALO_EM_INIT_2.inc</A>"<A NAME="HALO_EM_INIT_2.inc_10"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='220'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_3.inc.html'>HALO_EM_INIT_3.inc</A>"<A NAME="HALO_EM_INIT_3.inc_11"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='221'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_4.inc.html'>HALO_EM_INIT_4.inc</A>"<A NAME="HALO_EM_INIT_4.inc_12"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='222'>
#   include "<A href='../../html_code/include/HALO_EM_INIT_5.inc.html'>HALO_EM_INIT_5.inc</A>"<A NAME="HALO_EM_INIT_5.inc_13"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='223'>
#   include "<A href='../../html_code/include/HALO_EM_TL_INIT_1.inc.html'>HALO_EM_TL_INIT_1.inc</A>"<A NAME="HALO_EM_TL_INIT_1.inc_14"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='224'>
#   include "<A href='../../html_code/include/HALO_EM_TL_INIT_2.inc.html'>HALO_EM_TL_INIT_2.inc</A>"<A NAME="HALO_EM_TL_INIT_2.inc_15"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='225'>
#   include "<A href='../../html_code/include/HALO_EM_TL_INIT_3.inc.html'>HALO_EM_TL_INIT_3.inc</A>"<A NAME="HALO_EM_TL_INIT_3.inc_16"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='226'>
#   include "<A href='../../html_code/include/HALO_EM_TL_INIT_5.inc.html'>HALO_EM_TL_INIT_5.inc</A>"<A NAME="HALO_EM_TL_INIT_5.inc_17"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='227'>
#endif<a name='228'>
<a name='229'>
<font color=#447700>!**********************************************************************<a name='230'></font>
<font color=#447700>!<a name='231'></font>
<font color=#447700>!  LET US BEGIN.......<a name='232'></font>
<font color=#447700>!<a name='233'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='234'></font>
<font color=#447700>!&lt;pre&gt;<a name='235'></font>
<font color=#447700>! (1) RK integration loop is named the "Runge_Kutta_loop:"<a name='236'></font>
<font color=#447700>!<a name='237'></font>
<font color=#447700>!   Predictor-corrector type time integration.<a name='238'></font>
<font color=#447700>!   Advection terms are evaluated at time t for the predictor step,<a name='239'></font>
<font color=#447700>!   and advection is re-evaluated with the latest predicted value for<a name='240'></font>
<font color=#447700>!   each succeeding time corrector step<a name='241'></font>
<font color=#447700>!<a name='242'></font>
<font color=#447700>!   2nd order Runge Kutta (rk_order = 2):<a name='243'></font>
<font color=#447700>!   Step 1 is taken to the midpoint predictor, step 2 is the full step.<a name='244'></font>
<font color=#447700>!<a name='245'></font>
<font color=#447700>!   3rd order Runge Kutta (rk_order = 3):<a name='246'></font>
<font color=#447700>!   Step 1 is taken to from t to dt/3, step 2 is from t to dt/2,<a name='247'></font>
<font color=#447700>!   and step 3 is from t to dt.<a name='248'></font>
<font color=#447700>!<a name='249'></font>
<font color=#447700>!   non-timesplit physics are evaluated during first RK step and<a name='250'></font>
<font color=#447700>!   these physics tendencies are stored for use in each RK pass.<a name='251'></font>
<font color=#447700>!&lt;/pre&gt;<a name='252'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='253'></font>
<font color=#447700>!**********************************************************************<a name='254'></font>
<a name='255'>
   if(grid%trace_use) call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_105">("solve_em_tl")<a name='256'>
<a name='257'>
#ifdef WRF_CHEM<a name='258'>
<font color=#447700>!<a name='259'></font>
<font color=#447700>!    prepare chem aerosols for advection before communication<a name='260'></font>
<font color=#447700>!    so far only for RADM2/SORGAM choice<a name='261'></font>
<font color=#447700>!<a name='262'></font>
<a name='263'>
   kte=min(k_end,kde-1)<a name='264'>
<font color=#447700>!<a name='265'></font>
<font color=#447700>! change units for advection to mixing ratio<a name='266'></font>
<font color=#447700>!<a name='267'></font>
      if(imicrogram == 1)then<a name='268'>
<a name='269'>
   if ( p_so4aj &gt;= PARAM_FIRST_SCALAR ) then<a name='270'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='271'></font>
   <font color=#447700>!$OMP PRIVATE ( ij ,its,ite,jts,jte,kte)<a name='272'></font>
   aerosol_decouple_loop : DO ij = 1 , grid%num_tiles<a name='273'>
       its = max(grid%i_start(ij),ids)<a name='274'>
       ite = min(grid%i_end(ij),ide-1)<a name='275'>
       jts = max(grid%j_start(ij),jds)<a name='276'>
       jte = min(grid%j_end(ij),jde-1)<a name='277'>
      do l=p_so4aj,num_chem<a name='278'>
      do j=jts,jte<a name='279'>
      do k=k_start,kte+1 <a name='280'>
      kk=min(k,kde-1)<a name='281'>
      do i=its,ite<a name='282'>
        chem_1(i,k,j,l)=chem_1(i,kk,j,l)*alt(i,kk,j)<a name='283'>
        chem_2(i,k,j,l)=chem_2(i,kk,j,l)*alt(i,kk,j)<a name='284'>
      enddo<a name='285'>
      enddo<a name='286'>
      enddo<a name='287'>
      enddo<a name='288'>
    enddo aerosol_decouple_loop<a name='289'>
    endif<a name='290'>
    imicrogram=0<a name='291'>
    endif<a name='292'>
# ifdef DM_PARALLEL<a name='293'>
   if ( num_chem &gt;= PARAM_FIRST_SCALAR ) then<a name='294'>
<font color=#447700>!-----------------------------------------------------------------------<a name='295'></font>
<font color=#447700>! see above<a name='296'></font>
<font color=#447700>!--------------------------------------------------------------<a name='297'></font>
     CALL wrf_debug ( 200 , ' call HALO_RK_CHEM' )<a name='298'>
     IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='299'>
#      include "<A href='../../html_code/include/HALO_EM_CHEM_E_3.inc.html'>HALO_EM_CHEM_E_3.inc</A>"<A NAME="HALO_EM_CHEM_E_3.inc_18"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='300'>
     ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='301'>
#      include "<A href='../../html_code/include/HALO_EM_CHEM_E_5.inc.html'>HALO_EM_CHEM_E_5.inc</A>"<A NAME="HALO_EM_CHEM_E_5.inc_19"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='302'>
     ELSE<a name='303'>
       WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='304'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_49">(TRIM(wrf_err_message))<a name='305'>
     ENDIF<a name='306'>
   endif<a name='307'>
# endif<a name='308'>
<font color=#447700>!--------------------------------------------------------------<a name='309'></font>
#endif<a name='310'>
<a name='311'>
 rk_order = config_flags%rk_ord<a name='312'>
 leapfrog = .false.<a name='313'>
 dts = dt/float(time_step_sound)<a name='314'>
<a name='315'>
 IF(rk_ord == 1) leapfrog = .true.<a name='316'>
<a name='317'>
 Runge_Kutta_loop:  DO rk_step = 1, rk_order<a name='318'>
<a name='319'>
   <font color=#447700>!  Set the step size and number of small timesteps for<a name='320'></font>
   <font color=#447700>!  each part of the timestep<a name='321'></font>
<a name='322'>
   dtm = dt<a name='323'>
   IF ( rk_order == 1 ) THEN   <font color=#447700>! Leapfrog<a name='324'></font>
<a name='325'>
       IF (step_number /= 1) THEN<a name='326'>
         number_of_small_timesteps = 2*time_step_sound<a name='327'>
         dt_rk = dt<a name='328'>
         dtm = 2*dt<a name='329'>
       ELSE<a name='330'>
         number_of_small_timesteps = time_step_sound<a name='331'>
         dt_rk = dt/2.<a name='332'>
         dtm = dt<a name='333'>
       END IF<a name='334'>
<a name='335'>
       dts_rk = dts<a name='336'>
<a name='337'>
   ELSE IF ( rk_order == 2 ) THEN   <font color=#447700>! 2nd order Runge-Kutta timestep<a name='338'></font>
<a name='339'>
       IF ( rk_step == 1) THEN<a name='340'>
             dt_rk  = 0.5*dt<a name='341'>
             dts_rk = dts<a name='342'>
             number_of_small_timesteps = time_step_sound/2<a name='343'>
       ELSE<a name='344'>
             dt_rk = dt<a name='345'>
             dts_rk = dts<a name='346'>
             number_of_small_timesteps = time_step_sound<a name='347'>
       ENDIF<a name='348'>
<a name='349'>
   ELSE IF ( rk_order == 3 ) THEN <font color=#447700>! third order Runge-Kutta<a name='350'></font>
<a name='351'>
       IF ( rk_step == 1) THEN<a name='352'>
            dt_rk = dt/3.<a name='353'>
            dts_rk = dt_rk<a name='354'>
            number_of_small_timesteps = 1<a name='355'>
       ELSE IF (rk_step == 2) THEN<a name='356'>
            dt_rk  = 0.5*dt<a name='357'>
            dts_rk = dts<a name='358'>
            number_of_small_timesteps = time_step_sound/2<a name='359'>
       ELSE<a name='360'>
            dt_rk = dt<a name='361'>
            dts_rk = dts<a name='362'>
            number_of_small_timesteps = time_step_sound<a name='363'>
       ENDIF<a name='364'>
<a name='365'>
   ELSE<a name='366'>
<a name='367'>
      write(wrf_err_message,*)' unknown solver, error exit for dynamics_option = ',dynamics_option<a name='368'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_50">( wrf_err_message )<a name='369'>
<a name='370'>
   END IF<a name='371'>
<a name='372'>
<font color=#447700>!<a name='373'></font>
<font color=#447700>!  Time level t is in the *_2 variable in the first part <a name='374'></font>
<font color=#447700>!  of the step, and in the *_1 variable after the predictor.<a name='375'></font>
<font color=#447700>!  the latest predicted values are stored in the *_2 variables.<a name='376'></font>
<font color=#447700>!<a name='377'></font>
   CALL wrf_debug ( 200 , ' call rk_step_prep ' )<a name='378'>
<a name='379'>
BENCH_START(step_prep_tim)<a name='380'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='381'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='382'></font>
<a name='383'>
   DO ij = 1 , grid%num_tiles<a name='384'>
#if 0<a name='385'>
      CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_STEP_PREP'>rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_STEP_PREP_14">  ( config_flags, rk_step,            &amp;<a name='386'>
                           u_2, v_2, w_2, t_2, ph_2, mu_2,   &amp;<a name='387'>
                           moist_2,                          &amp;<a name='388'>
                           ru, rv, rw, ww, php, alt, muu, muv,   &amp;<a name='389'>
                           mub, mut, phb, pb, p, al, alb,    &amp;<a name='390'>
                           cqu, cqv, cqw,                    &amp;<a name='391'>
                           msfu, msfv, msft,                 &amp;<a name='392'>
                           fnm, fnp, dnw, rdx, rdy,          &amp;<a name='393'>
                           num_3d_m,                         &amp;<a name='394'>
                           ids, ide, jds, jde, kds, kde,     &amp;<a name='395'>
                           ims, ime, jms, jme, kms, kme,     &amp;<a name='396'>
                           grid%i_start(ij), grid%i_end(ij), &amp;<a name='397'>
                           grid%j_start(ij), grid%j_end(ij), &amp;<a name='398'>
                           k_start, k_end                   )<a name='399'>
#endif<a name='400'>
<a name='401'>
      call <A href='../../html_code/dyn_em/module_em_tl.F.html#G_RK_STEP_PREP'>g_rk_step_prep</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_RK_STEP_PREP_3">( config_flags,                     &amp;<a name='402'>
                           u_2,g_u_2,v_2,g_v_2,w_2,g_w_2,    &amp;<a name='403'>
                           ph_2,g_ph_2,mu_2,g_mu_2,          &amp;<a name='404'>
                           moist_2,g_moist_2,                &amp;<a name='405'>
                           ru,g_ru,rv,g_rv,rw,g_rw,ww,g_ww,  &amp;<a name='406'>
                           php,g_php,alt,g_alt,muu,g_muu,    &amp;<a name='407'>
                           muv,g_muv,mub,mut,g_mut,phb,      &amp;<a name='408'>
                           al,g_al,alb,cqu,g_cqu,cqv,g_cqv,  &amp;<a name='409'>
                           cqw,g_cqw,msfu,msfv,msft,         &amp;<a name='410'>
                           dnw,rdx,rdy,num_3d_m,             &amp;<a name='411'>
                           ids,ide,jds,jde,kde,              &amp;<a name='412'>
                           ims,ime,jms,jme,kms,kme,          &amp;<a name='413'>
                           grid%i_start(ij),grid%i_end(ij),  &amp;<a name='414'>
                           grid%j_start(ij),grid%j_end(ij),  &amp;<a name='415'>
                           k_start,k_end )<a name='416'>
<a name='417'>
   END DO<a name='418'>
<a name='419'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='420'></font>
BENCH_END(step_prep_tim)<a name='421'>
<a name='422'>
#ifdef DM_PARALLEL<a name='423'>
<font color=#447700>!-----------------------------------------------------------------------<a name='424'></font>
<font color=#447700>!  Stencils for patch communications  (WCS, 29 June 2001)<a name='425'></font>
<font color=#447700>!  Note:  the small size of this halo exchange reflects the <a name='426'></font>
<font color=#447700>!         fact that we are carrying the uncoupled variables <a name='427'></font>
<font color=#447700>!         as state variables in the mass coordinate model, as<a name='428'></font>
<font color=#447700>!         opposed to the coupled variables as in the height<a name='429'></font>
<font color=#447700>!         coordinate model.<a name='430'></font>
<font color=#447700>!<a name='431'></font>
<font color=#447700>!                           * * * * *<a name='432'></font>
<font color=#447700>!         *        * * *    * * * * *<a name='433'></font>
<font color=#447700>!       * + *      * + *    * * + * * <a name='434'></font>
<font color=#447700>!         *        * * *    * * * * *<a name='435'></font>
<font color=#447700>!                           * * * * *<a name='436'></font>
<font color=#447700>!<a name='437'></font>
<font color=#447700>!  3D variables - note staggering!  ru(X), rv(Y), ww(Z), php(Z)<a name='438'></font>
<font color=#447700>!<a name='439'></font>
<font color=#447700>!j ru     x<a name='440'></font>
<font color=#447700>!j rv     x<a name='441'></font>
<font color=#447700>!j ww     x<a name='442'></font>
<font color=#447700>!j php    x<a name='443'></font>
<font color=#447700>!j alt    x<a name='444'></font>
<font color=#447700>!j ph_2   x<a name='445'></font>
<font color=#447700>!j phb    x<a name='446'></font>
<font color=#447700>!<a name='447'></font>
<font color=#447700>!  the following are 2D (xy) variables<a name='448'></font>
<font color=#447700>!<a name='449'></font>
<font color=#447700>!j muu    x<a name='450'></font>
<font color=#447700>!j muv    x<a name='451'></font>
<font color=#447700>!j mut    x<a name='452'></font>
<font color=#447700>!--------------------------------------------------------------<a name='453'></font>
#    include "<A href='../../html_code/include/HALO_EM_A.inc.html'>HALO_EM_A.inc</A>"<A NAME="HALO_EM_A.inc_20"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='454'>
#    include "<A href='../../html_code/include/HALO_EM_TL_A.inc.html'>HALO_EM_TL_A.inc</A>"<A NAME="HALO_EM_TL_A.inc_21"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='455'>
#endif<a name='456'>
<a name='457'>
<font color=#447700>! set boundary conditions on variables <a name='458'></font>
<font color=#447700>! from big_step_prep for use in big_step_proc<a name='459'></font>
<a name='460'>
#ifdef DM_PARALLEL<a name='461'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_A.inc.html'>PERIOD_BDY_EM_A.inc</A>"<A NAME="PERIOD_BDY_EM_A.inc_22"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='462'>
#endif<a name='463'>
<a name='464'>
<font color=#447700>!   CALL set_tiles ( grid , ids , ide , jds , jde , ips-1 , ipe+1 , jps-1 , jpe+1 )<a name='465'></font>
<a name='466'>
BENCH_START(set_phys_bc_tim)<a name='467'>
   if(dyn_opt == DYN_EM) then<a name='468'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='469'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='470'></font>
<a name='471'>
   DO ij = 1 , grid%num_tiles<a name='472'>
<a name='473'>
       CALL wrf_debug ( 200 , ' call rk_phys_bc_dry_1' )<a name='474'>
<a name='475'>
        CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RK_PHYS_BC_DRY_1'>rk_phys_bc_dry_1</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_PHYS_BC_DRY_1_2">( config_flags, ru, rv, rw, ww,      &amp; <a name='476'>
                               muu, muv, mut, php, alt, p,        &amp;<a name='477'>
                               ids, ide, jds, jde, kds, kde,      &amp;<a name='478'>
                               ims, ime, jms, jme, kms, kme,      &amp;<a name='479'>
                               ips, ipe, jps, jpe, kps, kpe,      &amp;<a name='480'>
                               grid%i_start(ij), grid%i_end(ij),  &amp;<a name='481'>
                               grid%j_start(ij), grid%j_end(ij),  &amp;<a name='482'>
                               k_start, k_end                )<a name='483'>
<a name='484'>
       CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_95">( ph_2, 'w', config_flags,            &amp;<a name='485'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='486'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='487'>
                                 ips, ipe, jps, jpe, kps, kpe, &amp;<a name='488'>
                               grid%i_start(ij), grid%i_end(ij),        &amp;<a name='489'>
                               grid%j_start(ij), grid%j_end(ij),        &amp;<a name='490'>
                               k_start, k_end                )<a name='491'>
<a name='492'>
   END DO<a name='493'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='494'></font>
   endif<a name='495'>
BENCH_END(set_phys_bc_tim)<a name='496'>
<a name='497'>
    rk_step_is_one : IF (rk_step == 1) THEN <font color=#447700>! only need to initialize diffusion tendencies<a name='498'></font>
<a name='499'>
 <font color=#447700>! initialize all tendencies to zero in order to update physics<a name='500'></font>
 <font color=#447700>! tendencies first (separate from dry dynamics).<a name='501'></font>
 <a name='502'>
BENCH_START(init_zero_tend_tim)<a name='503'>
     <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='504'></font>
     <font color=#447700>!$OMP PRIVATE ( ij )<a name='505'></font>
<a name='506'>
     DO ij = 1 , grid%num_tiles<a name='507'>
<a name='508'>
        CALL wrf_debug ( 200 , ' call init_zero_tendency' )<a name='509'>
#if 0<a name='510'>
        CALL <A href='../../html_code/dyn_em/module_em.F.html#INIT_ZERO_TENDENCY'>init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_ZERO_TENDENCY_13"> ( ru_tendf, rv_tendf, rw_tendf,     &amp;<a name='511'>
                                  ph_tendf, t_tendf, tke_tend,      &amp;<a name='512'>
                                  moist_tend,chem_tend,             &amp;<a name='513'>
                                  num_3d_m,num_3d_c,rk_step,        &amp;<a name='514'>
                                  ids, ide, jds, jde, kds, kde,     &amp;<a name='515'>
                                  ims, ime, jms, jme, kms, kme,     &amp;<a name='516'>
                                  grid%i_start(ij), grid%i_end(ij), &amp;<a name='517'>
                                  grid%j_start(ij), grid%j_end(ij), &amp;<a name='518'>
                                  k_start, k_end                   )<a name='519'>
#endif<a name='520'>
      call <A href='../../html_code/dyn_em/module_em_tl.F.html#G_INIT_ZERO_TENDENCY'>g_init_zero_tendency</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_INIT_ZERO_TENDENCY_3"> ( ru_tendf,g_ru_tendf,rv_tendf,g_rv_tendf,rw_tendf,g_rw_tendf,ph_tendf,g_ph_tendf,t_tendf,g_t_tendf,&amp;<a name='521'>
                                  moist_tend,g_moist_tend,num_3d_m,  &amp;<a name='522'>
                                  ims, ime, jms, jme, kms, kme,     &amp;<a name='523'>
                                  grid%i_start(ij), grid%i_end(ij), &amp;<a name='524'>
                                  grid%j_start(ij), grid%j_end(ij), &amp;<a name='525'>
                                  k_start, k_end                   )<a name='526'>
     END DO<a name='527'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='528'></font>
BENCH_END(init_zero_tend_tim)<a name='529'>
<a name='530'>
#ifdef DM_PARALLEL<a name='531'>
#     include "<A href='../../html_code/include/HALO_EM_PHYS_A.inc.html'>HALO_EM_PHYS_A.inc</A>"<A NAME="HALO_EM_PHYS_A.inc_23"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='532'>
#     include "<A href='../../html_code/include/HALO_EM_PHYS_TL_A.inc.html'>HALO_EM_PHYS_TL_A.inc</A>"<A NAME="HALO_EM_PHYS_TL_A.inc_24"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='533'>
#endif<a name='534'>
<a name='535'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='536'></font>
<font color=#447700>!&lt;pre&gt;<a name='537'></font>
<font color=#447700>!(2) The non-timesplit physics begins with a call to "phy_prep"<a name='538'></font>
<font color=#447700>!    (which computes some diagnostic variables such as temperature,<a name='539'></font>
<font color=#447700>!    pressure, u and v at p points, etc).  This is followed by<a name='540'></font>
<font color=#447700>!    calls to the physics drivers:<a name='541'></font>
<font color=#447700>!<a name='542'></font>
<font color=#447700>!              radiation,<a name='543'></font>
<font color=#447700>!              surface,<a name='544'></font>
<font color=#447700>!              pbl,<a name='545'></font>
<font color=#447700>!              cumulus,<a name='546'></font>
<font color=#447700>!              3D TKE and mixing.<a name='547'></font>
<font color=#447700>!&lt;pre&gt;<a name='548'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='549'></font>
<a name='550'>
<a name='551'>
BENCH_START(phy_prep_tim)<a name='552'>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='553'></font>
      <font color=#447700>!$OMP PRIVATE ( ij )<a name='554'></font>
      DO ij = 1 , grid%num_tiles<a name='555'>
<a name='556'>
         CALL wrf_debug ( 200 , ' call phy_prep' )<a name='557'>
#if 0<a name='558'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#PHY_PREP'>phy_prep</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_PREP_13"> ( config_flags,                           &amp;<a name='559'>
                         mut, u_2, v_2, p, pb, alt,              &amp;<a name='560'>
                         ph_2, phb, t_2, tsk, moist_2, num_3d_m, &amp;<a name='561'>
                         mu_3d, rho,                             &amp;<a name='562'>
                         th_phy, p_phy, pi_phy, u_phy, v_phy,    &amp;<a name='563'>
                         p8w, t_phy, t8w, z, z_at_w,             &amp;<a name='564'>
                         dz8w, fnm, fnp,                         &amp;    <a name='565'>
                         RTHRATEN,                               &amp;<a name='566'>
                         RTHBLTEN, RUBLTEN, RVBLTEN,             &amp;<a name='567'>
                         RQVBLTEN, RQCBLTEN, RQIBLTEN,           &amp;<a name='568'>
                         RTHCUTEN, RQVCUTEN, RQCCUTEN,           &amp;<a name='569'>
                         RQRCUTEN, RQICUTEN, RQSCUTEN,           &amp;<a name='570'>
                         RTHFTEN,  RQVFTEN,                      &amp;<a name='571'>
                         ids, ide, jds, jde, kds, kde,           &amp;<a name='572'>
                         ims, ime, jms, jme, kms, kme,           &amp;<a name='573'>
                         grid%i_start(ij), grid%i_end(ij),       &amp;<a name='574'>
                         grid%j_start(ij), grid%j_end(ij),       &amp;<a name='575'>
                         k_start, k_end                         )<a name='576'>
#endif<a name='577'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_PHY_PREP'>g_phy_prep</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_PHY_PREP_3">( p,g_p,pb,ph_2,g_ph_2,phb,t_2,g_t_2,mu_3d,rho,th_phy,g_th_phy,p_phy,g_p_phy,pi_phy,g_pi_phym,u_phy,v_phy,p8w,&amp;<a name='578'>
&amp;g_p8w,t_phy,g_t_phy,t8w,g_t8w,z,g_z,z_at_w,g_z_at_wm,dz8w,fnm,fnp,rthraten,rthblten,rublten,rvblten,rqvblten,rqcblten,&amp;<a name='579'>
&amp;rqiblten,rthcuten,rqvcuten,rqccuten,rqrcuten,rqicuten,rqscuten,rthften,rqvften,ide,jde,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='580'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='581'>
      ENDDO<a name='582'>
      <font color=#447700>!$OMP END PARALLEL DO<a name='583'></font>
<a name='584'>
BENCH_END(phy_prep_tim)<a name='585'>
<a name='586'>
<font color=#447700>!  physics to implement<a name='587'></font>
<a name='588'>
<font color=#447700>!      CALL set_tiles ( grid , ids , ide-1 , jds , jde-1 ips , ipe , jps , jpe )<a name='589'></font>
<a name='590'>
<font color=#447700>! Open MP loops are in physics drivers<a name='591'></font>
<font color=#447700>! radiation<a name='592'></font>
<a name='593'>
         CALL wrf_debug ( 200 , ' call radiation_driver' )<a name='594'>
BENCH_START(rad_driver_tim)<a name='595'>
         if(dyn_opt == DYN_EM) then<a name='596'>
         CALL <A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER'>radiation_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RADIATION_DRIVER_2">(itimestep,dt,AER_DRY,AER_WATER,       &amp;<a name='597'>
                    RTHRATENLW,RTHRATENSW,RTHRATEN,GLW,GSW,          &amp;<a name='598'>
                    SWDOWN,                                          &amp;<a name='599'>
                    XLAT,XLONG,ALBEDO,CLDFRA,EMISS,                  &amp;<a name='600'>
                    rho,moist_2,num_3d_m,                            &amp;<a name='601'>
                    p8w,p_phy,pb,pi_phy,dz8w,t_phy,t8w,              &amp;<a name='602'>
                    GMT,JULDAY,config_flags,RADT,STEPRA,ICLOUD,      &amp;<a name='603'>
                    taucldi,taucldc,warm_rain,                       &amp;<a name='604'>
                    XLAND,TSK,HTOP,HBOT,CUPPT,VEGFRA,SNOW,           &amp;<a name='605'>
                    julyr,                                           &amp;<a name='606'>
                    1   ,                                            &amp;<a name='607'>
                    TOTSWDN,TOTLWDN,RSWTOA,RLWTOA,CZMEAN,            &amp;<a name='608'>
                    CFRACL,CFRACM,CFRACH,                            &amp;<a name='609'>
                    ACFRST,NCFRST,ACFRCV,NCFRCV,                     &amp;<a name='610'>
                    ids,ide, jds,jde, kds,kde,                       &amp;<a name='611'>
                    ims,ime, jms,jme, kms,kme,                       &amp;<a name='612'>
                    grid%i_start, min(grid%i_end, ide-1),            &amp;<a name='613'>
                    grid%j_start, min(grid%j_end, jde-1),            &amp;<a name='614'>
                    k_start    , min(k_end,kde-1) , grid%num_tiles   )<a name='615'>
         endif<a name='616'>
BENCH_END(rad_driver_tim)<a name='617'>
<a name='618'>
<a name='619'>
<a name='620'>
<font color=#447700>!********* Surface driver<a name='621'></font>
<font color=#447700>! surface<a name='622'></font>
<a name='623'>
BENCH_START(surf_driver_tim)<a name='624'>
      if(dyn_opt == DYN_EM) then<a name='625'>
      CALL wrf_debug ( 200 , ' call surface_driver' )<a name='626'>
      CALL <A href='../../html_code/phys/module_surface_driver.F.html#SURFACE_DRIVER'>surface_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SURFACE_DRIVER_2">(                                          &amp;<a name='627'>
     &amp;           ACSNOM,ACSNOW,AKHS,AKMS,ALBEDO,BR,CANWAT,CAPG        &amp;<a name='628'>
     &amp;          ,CHKLOWQ,CONFIG_FLAGS,DT,DX,DZ8W,DZS,EMISS,GLW        &amp;<a name='629'>
     &amp;          ,GRDFLX,GSW,GZ1OZ0,HFX,HOL,HT,IFSNOW,ISFFLX           &amp;<a name='630'>
     &amp;          ,ISLTYP,ITIMESTEP,IVGTYP,LOWLYR,MAVAIL,MOIST_2,MOL,RMOL&amp;<a name='631'>
     &amp;          ,NUM_SOIL_LAYERS,NUM_3D_M,P8W,PBLH,PI_PHY,PSHLTR,PSIH &amp;<a name='632'>
     &amp;          ,PSIM,P_PHY,Q10,Q2,QFX,QSFC,QSHLTR,QZ0,RAINBL         &amp;<a name='633'>
     &amp;          ,RAINCV,RAINNCV,REGIME,RHO,SFCEVP,SFCEXC,SFCRUNOFF    &amp;<a name='634'>
     &amp;          ,SMOIS,SMSTAV,SMSTOT,SNOALB,SNOW,SNOWC,SNOWH,STEPBL   &amp;<a name='635'>
     &amp;          ,T2,TH10,TH2,THC,THZ0,TH_PHY,TMN,TSHLTR,TSK,TSLB      &amp;<a name='636'>
     &amp;          ,T_PHY,U10,UDRUNOFF,UST,UZ0,U_FRAME,U_PHY,V10,VEGFRA  &amp;<a name='637'>
     &amp;          ,VZ0,V_FRAME,V_PHY,WARM_RAIN,WSPD,XICE,XLAND,Z,ZNT,ZS &amp;<a name='638'>
     &amp;          ,CT,TKE_MYJ                                           &amp;<a name='639'>
     &amp;          ,ALBBCK,LH,SH2O,SHDMAX,SHDMIN,Z0                      &amp;<a name='640'>
     &amp;          ,flqc,flhc,qsg,qvg,qcg,soilt1,tsnav                   &amp; <font color=#447700>! for RUC LSM<a name='641'></font>
     &amp;          ,SMFR3D,KEEPFR3DFLAG                                  &amp;<a name='642'>
     &amp;          ,PSFC                                                 &amp;<a name='643'>
     &amp;          ,ids,ide, jds,jde, kds,kde                            &amp;<a name='644'>
     &amp;          ,ims,ime, jms,jme, kms,kme                            &amp;<a name='645'>
     &amp;          ,grid%i_start, min(grid%i_end, ide-1)                 &amp;<a name='646'>
     &amp;          ,grid%j_start, min(grid%j_end, jde-1)                 &amp;<a name='647'>
     &amp;          ,k_start    , min(k_end,kde-1) , grid%num_tiles       )<a name='648'>
      endif<a name='649'>
BENCH_END(surf_driver_tim)<a name='650'>
<a name='651'>
<font color=#447700>!*********<a name='652'></font>
<font color=#447700>! pbl<a name='653'></font>
<a name='654'>
BENCH_START(pbl_driver_tim)<a name='655'>
      if(dyn_opt == DYN_EM) then<a name='656'>
      CALL wrf_debug ( 200 , ' call pbl_driver' )<a name='657'>
      CALL <A href='../../html_code/phys/module_pbl_driver.F.html#PBL_DRIVER'>pbl_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PBL_DRIVER_2">(itimestep,dt,u_frame,v_frame                    &amp;<a name='658'>
     &amp;           ,RUBLTEN,RVBLTEN,RTHBLTEN                            &amp;<a name='659'>
     &amp;           ,RQVBLTEN,RQCBLTEN,RQIBLTEN                          &amp;<a name='660'>
     &amp;           ,TSK,XLAND,ZNT,HT                                    &amp;<a name='661'>
     &amp;           ,UST,HOL,MOL,PBLH                                    &amp;<a name='662'>
     &amp;           ,HFX,QFX,REGIME,GRDFLX                               &amp;<a name='663'>
     &amp;           ,u_phy,v_phy,th_phy,rho,moist_2                      &amp;<a name='664'>
     &amp;           ,p_phy,pi_phy,p8w,t_phy,dz8w,z                       &amp;<a name='665'>
     &amp;           ,TKE_MYJ,EXCH_H,AKHS,AKMS                            &amp;<a name='666'>
     &amp;           ,THZ0,QZ0,UZ0,VZ0,QSFC,LOWLYR                        &amp;<a name='667'>
     &amp;           ,PSIM, PSIH, GZ1OZ0, WSPD, BR, CHKLOWQ               &amp;<a name='668'>
     &amp;           ,config_flags,DX,num_3d_m                            &amp;<a name='669'>
     &amp;           ,STEPBL,warm_rain                                    &amp;<a name='670'>
     &amp;           ,KPBL,CT,LH,SNOW,XICE                                &amp;<a name='671'>
     &amp;           ,ids,ide, jds,jde, kds,kde                           &amp;<a name='672'>
     &amp;           ,ims,ime, jms,jme, kms,kme                           &amp;<a name='673'>
     &amp;           ,grid%i_start, min(grid%i_end,ide-1)                 &amp;<a name='674'>
     &amp;           ,grid%j_start, min(grid%j_end,jde-1)                 &amp;<a name='675'>
     &amp;           ,k_start    , min(k_end,kde-1) , grid%num_tiles  )<a name='676'>
      endif<a name='677'>
BENCH_END(pbl_driver_tim)<a name='678'>
<a name='679'>
<font color=#447700>! cumulus para.<a name='680'></font>
<a name='681'>
BENCH_START(cu_driver_tim)<a name='682'>
         if(dyn_opt == DYN_EM) then<a name='683'>
         CALL wrf_debug ( 200 , ' call cumulus_driver' )<a name='684'>
         CALL <A href='../../html_code/phys/module_cumulus_driver.F.html#CUMULUS_DRIVER'>cumulus_driver</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CUMULUS_DRIVER_2">(                                          &amp;<a name='685'>
                 <font color=#447700>! Order dependent args: domain, mem, tile dims<a name='686'></font>
                     ids,ide, jds,jde, kds,kde                         &amp;<a name='687'>
                   , ims,ime, jms,jme, kms,kme                         &amp;<a name='688'>
                   , grid%i_start, min(grid%i_end, ide-1)              &amp;<a name='689'>
                   , grid%j_start, min(grid%j_end, jde-1)              &amp;<a name='690'>
                   , k_start  , min(k_end,kde-1) , grid%num_tiles      &amp;<a name='691'>
                 <font color=#447700>! Prognostic variables<a name='692'></font>
                   , U=u_phy   ,V=v_phy   ,TH=th_phy  ,T=t_phy         &amp;<a name='693'>
                   , W=w_2     ,P=p_phy   ,PI=pi_phy  ,RHO=rho         &amp;<a name='694'>
                 <font color=#447700>! Other arguments<a name='695'></font>
                   , ITIMESTEP=itimestep ,DT=dt      ,DX=dx            &amp;<a name='696'>
                   , RAINC=rainc   ,RAINCV=raincv   ,NCA=nca           &amp;<a name='697'>
                   , HTOP=htop     ,HBOT=hbot       ,KPBL=kpbl         &amp;<a name='698'>
                   , DZ8W=dz8w     ,P8W=p8w                            &amp;<a name='699'>
                   , W0AVG=w0avg   ,STEPCU=stepcu                      &amp;<a name='700'>
                   , CLDEFI=cldefi ,LOWLYR=lowlyr ,XLAND=xland         &amp;<a name='701'>
                   , APR_GR=apr_gr ,APR_W=apr_w   ,APR_MC=apr_mc       &amp;<a name='702'>
                   , APR_ST=apr_st ,APR_AS=apr_as ,APR_CAPMA=apr_capma &amp;<a name='703'>
                   , APR_CAPME=apr_capme          ,APR_CAPMI=apr_capmi &amp;<a name='704'>
                   , MASS_FLUX=mass_flux          ,XF_ENS=xf_ens       &amp;<a name='705'>
                   , PR_ENS=pr_ens ,HT=ht                              &amp;<a name='706'>
                   , ENSDIM=ensdim ,MAXIENS=maxiens ,MAXENS=maxens     &amp;<a name='707'>
                   , MAXENS2=maxens2                ,MAXENS3=maxens3   &amp;<a name='708'>
                   , CU_ACT_FLAG=cu_act_flag   ,WARM_RAIN=warm_rain    &amp;<a name='709'>
                 <font color=#447700>! Selection flag<a name='710'></font>
                   , CU_PHYSICS=config_flags%cu_physics                &amp;<a name='711'>
                 <font color=#447700>! Moisture tendency arguments<a name='712'></font>
                   , RQVCUTEN=rqvcuten , RQCCUTEN=rqccuten             &amp;<a name='713'>
                   , RQRCUTEN=rqrcuten , RQVBLTEN=rqvblten             &amp;<a name='714'>
                   , RQVFTEN=rqvften                                   &amp;<a name='715'>
                 <font color=#447700>! Other tendency arguments<a name='716'></font>
                   , RTHRATEN=rthraten , RTHBLTEN=rthblten             &amp;<a name='717'>
                   , RTHCUTEN=rthcuten , RTHFTEN=rthften               &amp;<a name='718'>
                 <font color=#447700>! Moisture tracer arguments<a name='719'></font>
                   , QV_CURR=moist_2(ims,kms,jms,P_QV), F_QV=F_QV      &amp;<a name='720'>
                   , QC_CURR=moist_2(ims,kms,jms,P_QC), F_QC=F_QC      &amp;<a name='721'>
                   , QR_CURR=moist_2(ims,kms,jms,P_QR), F_QR=F_QR      &amp;<a name='722'>
                   , QI_CURR=moist_2(ims,kms,jms,P_QI), F_QI=F_QI      &amp;<a name='723'>
                   , QS_CURR=moist_2(ims,kms,jms,P_QS), F_QS=F_QS      &amp;<a name='724'>
                   , QG_CURR=moist_2(ims,kms,jms,P_QG), F_QG=F_QG      &amp;<a name='725'>
                                                                       )<a name='726'>
         endif<a name='727'>
<a name='728'>
         IF (cu_physics .eq. 5) then            <font color=#447700>!IF for CUDU<a name='729'></font>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_55">(100,'in du_cps')<a name='730'>
            DO ij = 1, grid%num_tiles<a name='731'>
<a name='732'>
               Print *, 'xxxx  CALL TL DU_CU scheme from solve_em_tl xxxx'<a name='733'>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='734'>
               do k = k_start, min(k_end, kde-1)<a name='735'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='736'>
                  rho(i,k,j) = 1./alt(i,k,j)*(1.+moist_2(i,k,j,P_QV))<a name='737'>
                  u_phy(i,k,j) = 0.5*(u_2(i,k,j)+u_2(i+1,k,j))<a name='738'>
                  v_phy(i,k,j) = 0.5*(v_2(i,k,j)+v_2(i,k,j+1))<a name='739'>
                  rthcuten(i,k,j) = rthcuten(i,k,j)/mut(i,j)<a name='740'>
                  rqvcuten(i,k,j) = rqvcuten(i,k,j)/mut(i,j)<a name='741'>
                  g_rthcuten(i,k,j) = g_rthcuten(i,k,j)/mut(i,j)<a name='742'>
                  g_rqvcuten(i,k,j) = g_rqvcuten(i,k,j)/mut(i,j)<a name='743'>
               end do<a name='744'>
               end do<a name='745'>
               end do<a name='746'>
<a name='747'>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='748'>
               do k = k_start, kde-1<a name='749'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='750'>
                  dz8w(i,k,j)= z_at_w(i,k+1,j)-z_at_w(i,k,j)<a name='751'>
               end do<a name='752'>
               end do<a name='753'>
               end do<a name='754'>
<a name='755'>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='756'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='757'>
                  dz8w(i,kde,j) = 0.<a name='758'>
               end do<a name='759'>
               end do<a name='760'>
          <a name='761'>
               CALL <A href='../../html_code/phys/module_cu_du.F.html#DUCU_D'>DUCU_D</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DUCU_D_3">( ids,ide,jds,jde,kds,kde &amp;<a name='762'>
               ,ims,ime,jms,jme,kms,kme &amp;<a name='763'>
               ,grid%i_start(ij),min(grid%i_end(ij), ide-1)      &amp;<a name='764'>
               ,grid%j_start(ij), min(grid%j_end(ij), jde-1)    &amp;<a name='765'>
               ,k_start,min(k_end, kde-1) &amp;<a name='766'>
               ,dt ,itimestep ,dx                    &amp;<a name='767'>
               ,rho,g_rho,raincv,g_raincv                       &amp;<a name='768'>
               ,nca,u_phy ,v_phy                        &amp;<a name='769'>
               ,th_phy,g_th_phy,t_phy,g_t_phy                   &amp;<a name='770'>
               ,w_2                                           &amp;<a name='771'>
               ,dz8w,g_dz8w,z,g_z,p_phy,g_p_phy                 &amp;<a name='772'>
               ,pi_phy,grid%W0AVG,XLV              &amp;<a name='773'>
               ,CP ,R_d ,R_v ,G ,EP_2             &amp;<a name='774'>
               ,SVP1 ,SVP2 ,SVP3 ,SVPT0    &amp;<a name='775'>
               ,stepcu                                   &amp;<a name='776'>
               ,cu_act_flag ,warm_rain    &amp;<a name='777'>
               ,HTOP,HBOT                           &amp;<a name='778'>
               ,moist_2(ims,kms,jms,P_QV),g_moist_2(ims,kms,jms,P_QV) &amp;<a name='779'>
              <font color=#447700>! optionals<a name='780'></font>
               ,rthcuten,g_rthcuten, rqvcuten,g_rqvcuten )<a name='781'>
     <a name='782'>
               do j = grid%j_start(ij), min(grid%j_end(ij), jde-1)<a name='783'>
               do i = grid%i_start(ij), min(grid%i_end(ij), ide-1)<a name='784'>
                  do k = k_start, min(k_end, kde-1)<a name='785'>
                     g_t_tendf(I,K,J) = g_t_tendf(I,K,J) + rthcuten(I,K,J) * g_mut(I,J) + g_rthcuten(I,K,J) * mut(I,J)<a name='786'>
                     t_tendf(I,K,J) = t_tendf(I,K,J) + rthcuten(I,K,J) * mut(I,J)<a name='787'>
                     g_moist_tend(I,K,J,P_QV) = g_moist_tend(I,K,J,P_QV) + rqvcuten(I,K,J) * g_mut(I,J) + g_rqvcuten(I,K,J) * mut(I,J)<a name='788'>
                     moist_tend(I,K,J,P_QV) = moist_tend(I,K,J,P_QV) + rqvcuten(I,K,J) * mut(I,J)<a name='789'>
                  end do<a name='790'>
                  g_rainc(I,J) = g_rainc(I,J) + g_raincv(I,J)<a name='791'>
                  rainc(I,J) = rainc(I,J) + raincv(I,J)<a name='792'>
               end do<a name='793'>
               end do<a name='794'>
<a name='795'>
            ENDDO<a name='796'>
         ENDIF<a name='797'>
<a name='798'>
BENCH_END(cu_driver_tim)<a name='799'>
<a name='800'>
<font color=#447700>! calculate_phy_tend<a name='801'></font>
<a name='802'>
BENCH_START(cal_phy_tend)<a name='803'>
      if(dyn_opt == DYN_EM) then<a name='804'>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='805'></font>
      <font color=#447700>!$OMP PRIVATE ( ij )<a name='806'></font>
<a name='807'>
      DO ij = 1 , grid%num_tiles<a name='808'>
<a name='809'>
          CALL wrf_debug ( 200 , ' call calculate_phy_tend' )<a name='810'>
          CALL <A href='../../html_code/dyn_em/module_em.F.html#CALCULATE_PHY_TEND'>calculate_phy_tend</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_PHY_TEND_2"> (config_flags,mut,pi_phy,            &amp;<a name='811'>
                     RTHRATEN,                                         &amp;<a name='812'>
                     RUBLTEN,RVBLTEN,RTHBLTEN,                         &amp;<a name='813'>
                     RQVBLTEN,RQCBLTEN,RQIBLTEN,                       &amp;<a name='814'>
                     RTHCUTEN,RQVCUTEN,RQCCUTEN,RQRCUTEN,              &amp;<a name='815'>
                     RQICUTEN,RQSCUTEN,                                &amp;<a name='816'>
                     ids,ide, jds,jde, kds,kde,                        &amp;<a name='817'>
                     ims,ime, jms,jme, kms,kme,                        &amp;<a name='818'>
                     grid%i_start(ij), min(grid%i_end(ij),ide-1),      &amp;<a name='819'>
                     grid%j_start(ij), min(grid%j_end(ij),jde-1),      &amp;<a name='820'>
                     k_start    , min(k_end,kde-1)                     )<a name='821'>
<a name='822'>
      ENDDO<a name='823'>
      <font color=#447700>!$OMP END PARALLEL DO<a name='824'></font>
      endif<a name='825'>
BENCH_END(cal_phy_tend)<a name='826'>
<a name='827'>
<font color=#447700>! tke diffusion<a name='828'></font>
<a name='829'>
     IF(diff_opt .eq. 2 .OR. diff_opt .eq. 1) THEN<a name='830'>
<a name='831'>
BENCH_START(comp_diff_metrics_tim)<a name='832'>
       if(dyn_opt == DYN_EM) then<a name='833'>
       <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='834'></font>
       <font color=#447700>!$OMP PRIVATE ( ij )<a name='835'></font>
<a name='836'>
       DO ij = 1 , grid%num_tiles<a name='837'>
<a name='838'>
          CALL wrf_debug ( 200 , ' call compute_diff_metrics ' )<a name='839'>
          CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#COMPUTE_DIFF_METRICS'>compute_diff_metrics</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMPUTE_DIFF_METRICS_2"> ( config_flags, ph_2, phb, z, rdz, rdzw, &amp;<a name='840'>
                                      zx, zy, rdx, rdy,                      &amp;<a name='841'>
                                      ids, ide, jds, jde, kds, kde,          &amp;<a name='842'>
                                      ims, ime, jms, jme, kms, kme,          &amp;<a name='843'>
                                      grid%i_start(ij), grid%i_end(ij),      &amp;<a name='844'>
                                      grid%j_start(ij), grid%j_end(ij),      &amp;<a name='845'>
                                      k_start    , k_end                    )<a name='846'>
       ENDDO<a name='847'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='848'></font>
       endif<a name='849'>
BENCH_END(comp_diff_metrics_tim)<a name='850'>
<a name='851'>
#ifdef DM_PARALLEL<a name='852'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_A1.inc.html'>PERIOD_BDY_EM_A1.inc</A>"<A NAME="PERIOD_BDY_EM_A1.inc_25"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='853'>
#endif<a name='854'>
<a name='855'>
BENCH_START(tke_diff_bc_tim)<a name='856'>
       if(dyn_opt == DYN_EM) then<a name='857'>
       DO ij = 1 , grid%num_tiles<a name='858'>
<a name='859'>
          CALL wrf_debug ( 200 , ' call bc for diffusion_metrics ' )<a name='860'>
          CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_96">( rdzw , 'w', config_flags,           &amp;<a name='861'>
                                  ids, ide, jds, jde, kds, kde,       &amp;<a name='862'>
                                  ims, ime, jms, jme, kms, kme,       &amp;<a name='863'>
                                  ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='864'>
                                  grid%i_start(ij), grid%i_end(ij),   &amp;<a name='865'>
                                  grid%j_start(ij), grid%j_end(ij),   &amp;<a name='866'>
                                  k_start    , k_end                 )<a name='867'>
          CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_97">( rdz , 'w', config_flags,           &amp;<a name='868'>
                                  ids, ide, jds, jde, kds, kde,       &amp;<a name='869'>
                                  ims, ime, jms, jme, kms, kme,       &amp;<a name='870'>
                                  ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='871'>
                                  grid%i_start(ij), grid%i_end(ij),   &amp;<a name='872'>
                                  grid%j_start(ij), grid%j_end(ij),   &amp;<a name='873'>
                                  k_start    , k_end                 )<a name='874'>
          CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_98">( z , 'w', config_flags,           &amp;<a name='875'>
                                  ids, ide, jds, jde, kds, kde,       &amp;<a name='876'>
                                  ims, ime, jms, jme, kms, kme,       &amp;<a name='877'>
                                  ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='878'>
                                  grid%i_start(ij), grid%i_end(ij),   &amp;<a name='879'>
                                  grid%j_start(ij), grid%j_end(ij),   &amp;<a name='880'>
                                  k_start    , k_end                 )<a name='881'>
          CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_99">( zx , 'w', config_flags,           &amp;<a name='882'>
                                  ids, ide, jds, jde, kds, kde,       &amp;<a name='883'>
                                  ims, ime, jms, jme, kms, kme,       &amp;<a name='884'>
                                  ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='885'>
                                  grid%i_start(ij), grid%i_end(ij),   &amp;<a name='886'>
                                  grid%j_start(ij), grid%j_end(ij),   &amp;<a name='887'>
                                  k_start    , k_end                 )<a name='888'>
          CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_100">( zy , 'w', config_flags,           &amp;<a name='889'>
                                  ids, ide, jds, jde, kds, kde,       &amp;<a name='890'>
                                  ims, ime, jms, jme, kms, kme,       &amp;<a name='891'>
                                  ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='892'>
                                  grid%i_start(ij), grid%i_end(ij),   &amp;<a name='893'>
                                  grid%j_start(ij), grid%j_end(ij),   &amp;<a name='894'>
                                  k_start    , k_end                 )<a name='895'>
<a name='896'>
       ENDDO<a name='897'>
       endif<a name='898'>
BENCH_END(tke_diff_bc_tim)<a name='899'>
<a name='900'>
#ifdef DM_PARALLEL<a name='901'>
#     include "<A href='../../html_code/include/HALO_EM_TKE_C.inc.html'>HALO_EM_TKE_C.inc</A>"<A NAME="HALO_EM_TKE_C.inc_26"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='902'>
#     include "<A href='../../html_code/include/HALO_EM_TKE_TL_C.inc.html'>HALO_EM_TKE_TL_C.inc</A>"<A NAME="HALO_EM_TKE_TL_C.inc_27"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='903'>
#endif<a name='904'>
<a name='905'>
BENCH_START(deform_div_tim)<a name='906'>
       if(dyn_opt == DYN_EM) then<a name='907'>
       <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='908'></font>
       <font color=#447700>!$OMP PRIVATE ( ij )<a name='909'></font>
<a name='910'>
       DO ij = 1 , grid%num_tiles<a name='911'>
<a name='912'>
          CALL wrf_debug ( 200 , ' call cal_deform_and_div' )<a name='913'>
          CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CAL_DEFORM_AND_DIV'>cal_deform_and_div</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CAL_DEFORM_AND_DIV_2"> ( config_flags,u_2,v_2,w_2,div,        &amp;<a name='914'>
                                    defor11,defor22,defor33,defor12,     &amp;<a name='915'>
                                    defor13,defor23,                     &amp;<a name='916'>
                                    u_base, v_base,msfu,msfv,msft,       &amp;<a name='917'>
                                    rdx, rdy, dn, dnw, rdz, rdzw,        &amp;<a name='918'>
                                    fnm,fnp,cf1,cf2,cf3,zx,zy,           &amp;<a name='919'>
                                    ids, ide, jds, jde, kds, kde,        &amp;<a name='920'>
                                    ims, ime, jms, jme, kms, kme,        &amp;<a name='921'>
                                    grid%i_start(ij), grid%i_end(ij),    &amp;<a name='922'>
                                    grid%j_start(ij), grid%j_end(ij),    &amp;<a name='923'>
                                    k_start    , k_end                  )<a name='924'>
       ENDDO<a name='925'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='926'></font>
       endif<a name='927'>
BENCH_END(deform_div_tim)<a name='928'>
<a name='929'>
<a name='930'>
#ifdef DM_PARALLEL<a name='931'>
#     include "<A href='../../html_code/include/HALO_EM_TKE_D.inc.html'>HALO_EM_TKE_D.inc</A>"<A NAME="HALO_EM_TKE_D.inc_28"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='932'>
#endif<a name='933'>
<a name='934'>
<a name='935'>
<font color=#447700>! calculate tke, kmh, and kmv<a name='936'></font>
<a name='937'>
BENCH_START(calc_tke_tim)<a name='938'>
       <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='939'></font>
       <font color=#447700>!$OMP PRIVATE ( ij )<a name='940'></font>
<a name='941'>
       DO ij = 1 , grid%num_tiles<a name='942'>
#if 0<a name='943'>
          CALL wrf_debug ( 200 , ' call calculate_km_kh' )<a name='944'>
          CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_13">( config_flags,dt,dampcoef,zdamp,damp_opt,     &amp;<a name='945'>
                                xkmh,xkmhd,xkmv,xkhh,xkhv,BN2,               &amp;<a name='946'>
                                khdif,kvdif,div,                             &amp;<a name='947'>
                                defor11,defor22,defor33,defor12,             &amp;<a name='948'>
                                defor13,defor23,                             &amp;<a name='949'>
                                tke_2(ims,kms,jms),p8w,t8w,th_phy,           &amp;<a name='950'>
                                t_phy,p_phy,moist_2,dn,dnw,                  &amp;<a name='951'>
                                dx,dy,rdz,rdzw,mix_cr_len,num_3d_m,          &amp;<a name='952'>
                                cf1, cf2, cf3, warm_rain,                    &amp;<a name='953'>
                                kh_tke_upper_bound, kv_tke_upper_bound,      &amp;<a name='954'>
                                ids,ide, jds,jde, kds,kde,                   &amp;<a name='955'>
                                ims,ime, jms,jme, kms,kme,                   &amp;<a name='956'>
                                grid%i_start(ij), grid%i_end(ij),            &amp;<a name='957'>
                                grid%j_start(ij), grid%j_end(ij),            &amp;<a name='958'>
                                k_start    , k_end                          )<a name='959'>
#endif<a name='960'>
        call <A href='../../html_code/dyn_em/module_diffusion_em_tl.F.html#G_CALCULATE_KM_KH'>g_calculate_km_kh</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_CALCULATE_KM_KH_3">( config_flags,dt,dampcoef,zdamp,damp_opt,xkmh,xkmhd,g_xkmhd,xkmv,xkhh,xkhv,bn2,g_bn2m,khdif,defor11,&amp;<a name='961'>
&amp;defor22,defor33,defor12,defor13,defor23,tke_2(ims,kms,jms),p8w,g_p8w,t8w,g_t8w,th_phy,g_th_phy,t_phy,g_t_phy,p_phy,&amp;<a name='962'>
&amp;g_p_phy,moist_2,g_moist_2,dx,dy,rdz,rdzw,num_3d_m,cf1,cf2,cf3,kh_tke_upper_bound,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,&amp;<a name='963'>
&amp;kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='964'>
       ENDDO<a name='965'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='966'></font>
BENCH_END(calc_tke_tim)<a name='967'>
<a name='968'>
#ifdef DM_PARALLEL<a name='969'>
#     include "<A href='../../html_code/include/HALO_EM_TKE_E.inc.html'>HALO_EM_TKE_E.inc</A>"<A NAME="HALO_EM_TKE_E.inc_29"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='970'>
#     include "<A href='../../html_code/include/HALO_EM_TKE_TL_E.inc.html'>HALO_EM_TKE_TL_E.inc</A>"<A NAME="HALO_EM_TKE_TL_E.inc_30"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='971'>
#endif<a name='972'>
<a name='973'>
     ENDIF<a name='974'>
<a name='975'>
#ifdef DM_PARALLEL<a name='976'>
#      include "<A href='../../html_code/include/PERIOD_BDY_EM_PHY_BC.inc.html'>PERIOD_BDY_EM_PHY_BC.inc</A>"<A NAME="PERIOD_BDY_EM_PHY_BC.inc_31"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='977'>
#      include "<A href='../../html_code/include/PERIOD_BDY_EM_CHEM.inc.html'>PERIOD_BDY_EM_CHEM.inc</A>"<A NAME="PERIOD_BDY_EM_CHEM.inc_32"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='978'>
#endif<a name='979'>
<a name='980'>
BENCH_START(phy_bc_tim)<a name='981'>
     if(dyn_opt == DYN_EM) then<a name='982'>
     <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='983'></font>
     <font color=#447700>!$OMP PRIVATE ( ij )<a name='984'></font>
<a name='985'>
     DO ij = 1 , grid%num_tiles<a name='986'>
<a name='987'>
          CALL wrf_debug ( 200 , ' call phy_bc' )<a name='988'>
       CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#PHY_BC'>phy_bc</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_BC_2"> (config_flags,div,defor11,defor22,defor33,            &amp;<a name='989'>
                            defor12,defor13,defor23,                     &amp;<a name='990'>
                            xkmh,xkmhd,xkmv,xkhh,xkhv,                   &amp;<a name='991'>
                            tke_2(ims,kms,jms),                          &amp;<a name='992'>
                            RUBLTEN, RVBLTEN,                            &amp;<a name='993'>
                            ids, ide, jds, jde, kds, kde,                &amp;<a name='994'>
                            ims, ime, jms, jme, kms, kme,                &amp;<a name='995'>
                            ips, ipe, jps, jpe, kps, kpe,                &amp;<a name='996'>
                            grid%i_start(ij), grid%i_end(ij),                      &amp;<a name='997'>
                            grid%j_start(ij), grid%j_end(ij),                      &amp;<a name='998'>
                            k_start    , k_end                           )<a name='999'>
     ENDDO<a name='1000'>
     <font color=#447700>!$OMP END PARALLEL DO<a name='1001'></font>
     endif<a name='1002'>
BENCH_END(phy_bc_tim)<a name='1003'>
<a name='1004'>
#ifdef DM_PARALLEL<a name='1005'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1006'></font>
<font color=#447700>!<a name='1007'></font>
<font color=#447700>! MPP for some physics tendency, km, kh, deformation, and divergence<a name='1008'></font>
<font color=#447700>!<a name='1009'></font>
<font color=#447700>!               *                     *<a name='1010'></font>
<font color=#447700>!             * + *      * + *        +<a name='1011'></font>
<font color=#447700>!               *                     *<a name='1012'></font>
<font color=#447700>!<a name='1013'></font>
<font color=#447700>! (for PBL)<a name='1014'></font>
<font color=#447700>! RUBLTEN                  x<a name='1015'></font>
<font color=#447700>! RVBLTEN                             x<a name='1016'></font>
<font color=#447700>!<a name='1017'></font>
<font color=#447700>! (for diff_opt &gt;= 1)<a name='1018'></font>
<font color=#447700>! defor11                  x<a name='1019'></font>
<font color=#447700>! defor22                             x<a name='1020'></font>
<font color=#447700>! defor12       x<a name='1021'></font>
<font color=#447700>! defor13                  x<a name='1022'></font>
<font color=#447700>! defor23                             x<a name='1023'></font>
<font color=#447700>! div           x<a name='1024'></font>
<font color=#447700>! xkmv          x<a name='1025'></font>
<font color=#447700>! xkmh          x<a name='1026'></font>
<font color=#447700>! xkmhd         x<a name='1027'></font>
<font color=#447700>! xkhv          x<a name='1028'></font>
<font color=#447700>! xkhh          x<a name='1029'></font>
<font color=#447700>! tke           x<a name='1030'></font>
<font color=#447700>!<a name='1031'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1032'></font>
      IF ( bl_pbl_physics .ge. 1 ) THEN<a name='1033'>
#      include "<A href='../../html_code/include/HALO_EM_PHYS_PBL.inc.html'>HALO_EM_PHYS_PBL.inc</A>"<A NAME="HALO_EM_PHYS_PBL.inc_33"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1034'>
      ENDIF<a name='1035'>
      IF ( diff_opt .ge. 1 ) THEN<a name='1036'>
#      include "<A href='../../html_code/include/HALO_EM_PHYS_DIFFUSION.inc.html'>HALO_EM_PHYS_DIFFUSION.inc</A>"<A NAME="HALO_EM_PHYS_DIFFUSION.inc_34"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1037'>
      ENDIF<a name='1038'>
<a name='1039'>
      IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='1040'>
#       include "<A href='../../html_code/include/HALO_EM_TKE_3.inc.html'>HALO_EM_TKE_3.inc</A>"<A NAME="HALO_EM_TKE_3.inc_35"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1041'>
      ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='1042'>
#       include "<A href='../../html_code/include/HALO_EM_TKE_5.inc.html'>HALO_EM_TKE_5.inc</A>"<A NAME="HALO_EM_TKE_5.inc_36"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1043'>
      ELSE<a name='1044'>
        WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='1045'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_51">(TRIM(wrf_err_message))<a name='1046'>
      ENDIF<a name='1047'>
#endif<a name='1048'>
<a name='1049'>
BENCH_START(update_phy_ten_tim)<a name='1050'>
      if(dyn_opt == DYN_EM) then<a name='1051'>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1052'></font>
      <font color=#447700>!$OMP PRIVATE ( ij )<a name='1053'></font>
<a name='1054'>
      DO ij = 1 , grid%num_tiles<a name='1055'>
<a name='1056'>
          CALL wrf_debug ( 200 , ' call update_phy_ten' )<a name='1057'>
        CALL <A href='../../html_code/phys/module_physics_addtendc.F.html#UPDATE_PHY_TEN'>update_phy_ten</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="UPDATE_PHY_TEN_2">(t_tendf, ru_tendf, rv_tendf,moist_tend,        &amp;<a name='1058'>
                          RTHRATEN,RTHBLTEN,RTHCUTEN,RUBLTEN,RVBLTEN,  &amp;<a name='1059'>
                          RQVBLTEN,RQCBLTEN,RQIBLTEN,                  &amp;<a name='1060'>
                          RQVCUTEN,RQCCUTEN,RQRCUTEN,RQICUTEN,RQSCUTEN,&amp;<a name='1061'>
                          num_3d_m,config_flags,rk_step,              &amp;<a name='1062'>
                          ids, ide, jds, jde, kds, kde,                &amp;<a name='1063'>
                          ims, ime, jms, jme, kms, kme,                &amp;<a name='1064'>
                          grid%i_start(ij), grid%i_end(ij),                      &amp;<a name='1065'>
                          grid%j_start(ij), grid%j_end(ij),                      &amp;<a name='1066'>
                          k_start, k_end                               )<a name='1067'>
<a name='1068'>
      END DO<a name='1069'>
      <font color=#447700>!$OMP END PARALLEL DO<a name='1070'></font>
      endif<a name='1071'>
BENCH_END(update_phy_ten_tim)<a name='1072'>
<a name='1073'>
     IF( diff_opt .eq. 2 .and. km_opt .eq. 2 ) THEN<a name='1074'>
<a name='1075'>
BENCH_START(tke_rhs_tim)<a name='1076'>
       if(dyn_opt == DYN_EM) then<a name='1077'>
       <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1078'></font>
       <font color=#447700>!$OMP PRIVATE ( ij )<a name='1079'></font>
<a name='1080'>
       DO ij = 1 , grid%num_tiles<a name='1081'>
<a name='1082'>
          CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#TKE_RHS'>tke_rhs</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TKE_RHS_2">  ( tke_tend,BN2,                               &amp;<a name='1083'>
                          config_flags,defor11,defor22,defor33,       &amp;<a name='1084'>
                          defor12,defor13,defor23,u_2,v_2,w_2,div,    &amp;<a name='1085'>
                          tke_2(ims,kms,jms),mut,                     &amp;<a name='1086'>
                          th_phy,p_phy,p8w,t8w,z,fnm,fnp,             &amp;<a name='1087'>
                          cf1,cf2,cf3,msft,xkmh,xkmv,xkhv,rdx,rdy,    &amp;<a name='1088'>
                          dx,dy,dt,zx,zy,rdz,rdzw,dn,dnw,mix_cr_len,  &amp;<a name='1089'>
                          ids, ide, jds, jde, kds, kde,               &amp;<a name='1090'>
                          ims, ime, jms, jme, kms, kme,               &amp;<a name='1091'>
                          grid%i_start(ij), grid%i_end(ij),           &amp;<a name='1092'>
                          grid%j_start(ij), grid%j_end(ij),           &amp;<a name='1093'>
                          k_start    , k_end                         )<a name='1094'>
<a name='1095'>
       ENDDO<a name='1096'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='1097'></font>
       endif<a name='1098'>
BENCH_END(tke_rhs_tim)<a name='1099'>
<a name='1100'>
     ENDIF<a name='1101'>
<a name='1102'>
<font color=#447700>! calculate vertical diffusion first and then horizontal<a name='1103'></font>
<font color=#447700>! (keep this order)<a name='1104'></font>
<a name='1105'>
     IF(diff_opt .eq. 2) THEN<a name='1106'>
<a name='1107'>
       IF (bl_pbl_physics .eq. 0) THEN<a name='1108'>
<a name='1109'>
BENCH_START(vert_diff_tim)<a name='1110'>
         if(dyn_opt == DYN_EM) then<a name='1111'>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1112'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='1113'></font>
         DO ij = 1 , grid%num_tiles<a name='1114'>
<a name='1115'>
           CALL wrf_debug ( 200 , ' call vertical_diffusion_2 ' )<a name='1116'>
           CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#VERTICAL_DIFFUSION_2'>vertical_diffusion_2</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VERTICAL_DIFFUSION_2_2">( ru_tendf, rv_tendf, rw_tendf,              &amp;<a name='1117'>
                                      t_tendf, tke_tend,                         &amp;<a name='1118'>
                                      moist_tend, num_3d_m,                      &amp;<a name='1119'>
                                      chem_tend, num_3d_c,                       &amp;<a name='1120'>
                                      u_2, v_2,                                  &amp;<a name='1121'>
                                      t_2,u_base,v_base,t_base,qv_base,          &amp;<a name='1122'>
                                      mut,tke_2,config_flags,                    &amp;<a name='1123'>
                                      defor13,defor23,defor33,                   &amp;<a name='1124'>
                                      div, moist_2, chem_2, xkmv, xkhv, km_opt,  &amp;<a name='1125'>
                                      fnm, fnp, dn, dnw, rdz, rdzw,              &amp;<a name='1126'>
                                      ids, ide, jds, jde, kds, kde,              &amp;<a name='1127'>
                                      ims, ime, jms, jme, kms, kme,              &amp;<a name='1128'>
                                      grid%i_start(ij), grid%i_end(ij),          &amp;<a name='1129'>
                                      grid%j_start(ij), grid%j_end(ij),          &amp;<a name='1130'>
                                      k_start    , k_end                        )<a name='1131'>
<a name='1132'>
         ENDDO<a name='1133'>
         <font color=#447700>!$OMP END PARALLEL DO<a name='1134'></font>
         endif<a name='1135'>
BENCH_END(vert_diff_tim)<a name='1136'>
<a name='1137'>
       ENDIF<a name='1138'>
<font color=#447700>!<a name='1139'></font>
BENCH_START(hor_diff_tim)<a name='1140'>
       if(dyn_opt == DYN_EM) then<a name='1141'>
       <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1142'></font>
       <font color=#447700>!$OMP PRIVATE ( ij )<a name='1143'></font>
       DO ij = 1 , grid%num_tiles<a name='1144'>
<a name='1145'>
          CALL wrf_debug ( 200 , ' call horizontal_diffusion_2' )<a name='1146'>
         CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#HORIZONTAL_DIFFUSION_2'>horizontal_diffusion_2</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HORIZONTAL_DIFFUSION_2_2">( t_tendf, ru_tendf, rv_tendf, rw_tendf, &amp;<a name='1147'>
                                      tke_tend,                              &amp;<a name='1148'>
                                      moist_tend, num_3d_m,                  &amp;<a name='1149'>
                                      chem_tend, num_3d_c,                   &amp;<a name='1150'>
                                      t_2, th_phy,                           &amp;<a name='1151'>
                                      mut, tke_2, config_flags,              &amp;<a name='1152'>
                                      defor11, defor22, defor12,             &amp;<a name='1153'>
                                      defor13, defor23, div,                 &amp;<a name='1154'>
                                      moist_2, chem_2,                       &amp;<a name='1155'>
                                      msfu, msfv, msft, xkmhd, xkhh, km_opt, &amp;<a name='1156'>
                                      rdx, rdy, rdz, rdzw,                   &amp;<a name='1157'>
                                      fnm, fnp, cf1, cf2, cf3,               &amp;<a name='1158'>
                                      zx, zy, dn, dnw,                       &amp;<a name='1159'>
                                      ids, ide, jds, jde, kds, kde,          &amp;<a name='1160'>
                                      ims, ime, jms, jme, kms, kme,          &amp;<a name='1161'>
                                      grid%i_start(ij), grid%i_end(ij),      &amp;<a name='1162'>
                                      grid%j_start(ij), grid%j_end(ij),      &amp;<a name='1163'>
                                      k_start    , k_end                    )<a name='1164'>
       ENDDO<a name='1165'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='1166'></font>
       endif<a name='1167'>
BENCH_END(hor_diff_tim)<a name='1168'>
<a name='1169'>
     ENDIF<a name='1170'>
<a name='1171'>
     END IF rk_step_is_one<a name='1172'>
<a name='1173'>
<a name='1174'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1175'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='1176'></font>
   DO ij = 1 , grid%num_tiles<a name='1177'>
      CALL wrf_debug ( 200 , ' call rk_tendency' )<a name='1178'>
#if 0<a name='1179'>
      CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_TENDENCY'>rk_tendency</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_TENDENCY_12"> ( config_flags, rk_step,                           &amp;<a name='1180'>
                         ru_tend, rv_tend, rw_tend, ph_tend, t_tend,      &amp;<a name='1181'>
                         ru_tendf, rv_tendf, rw_tendf, ph_tendf, t_tendf, &amp;<a name='1182'>
                         mu_tend, u_save, v_save, w_save, ph_save,        &amp;<a name='1183'>
                         t_save, mu_save, RTHFTEN,                        &amp;<a name='1184'>
                         ru, rv, rw, ww,                                  &amp;<a name='1185'>
                         u_2, v_2, w_2, t_2, ph_2,                        &amp;<a name='1186'>
                         u_1, v_1, w_1, t_1, ph_1,                        &amp;<a name='1187'>
                         h_diabatic, phb, t_init,                         &amp;<a name='1188'>
                         mu_2, mut, muu, muv, mub,                        &amp;<a name='1189'>
                         al, alt, p, pb, php, cqu, cqv, cqw,              &amp;<a name='1190'>
                         u_base, v_base, t_base, qv_base, z_base,         &amp;<a name='1191'>
                         msfu, msfv, msft, f, e, sina, cosa,              &amp;<a name='1192'>
                         fnm, fnp, rdn, rdnw,                             &amp;<a name='1193'>
                         dt, rdx, rdy, khdif, kvdif, xkmhd,               &amp;<a name='1194'>
                         cf1, cf2, cf3, cfn, cfn1, num_3d_m,              &amp;<a name='1195'>
                         non_hydrostatic, leapfrog,                       &amp;<a name='1196'>
                         ids, ide, jds, jde, kds, kde,                    &amp;<a name='1197'>
                         ims, ime, jms, jme, kms, kme,                    &amp;<a name='1198'>
                         grid%i_start(ij), grid%i_end(ij),                &amp;<a name='1199'>
                         grid%j_start(ij), grid%j_end(ij),                &amp;<a name='1200'>
                         k_start, k_end                                  )<a name='1201'>
#endif<a name='1202'>
<a name='1203'>
    call <A href='../../html_code/dyn_em/module_em_tl.F.html#G_RK_TENDENCY'>g_rk_tendency</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_RK_TENDENCY_3">( config_flags,rk_step,ru_tend,g_ru_tend,rv_tend,g_rv_tend,rw_tend,g_rw_tend,ph_tend,g_ph_tend,t_tend,&amp;<a name='1204'>
&amp;g_t_tend,ru_tendf,g_ru_tendf,rv_tendf,g_rv_tendf,rw_tendf,g_rw_tendf,t_tendf,g_t_tendf,mu_tend,g_mu_tend,u_save,g_u_save,&amp;<a name='1205'>
&amp;v_save,g_v_save,w_save,g_w_save,ph_save,g_ph_save,t_save,g_t_save,ru,g_ru,rv,g_rv,rw,g_rw,ww,g_ww,u_2,g_u_2,v_2,g_v_2,w_2,&amp;<a name='1206'>
&amp;g_w_2,t_2,g_t_2,ph_2,g_ph_2,u_1,g_u_1,v_1,g_v_1,w_1,g_w_1,t_1,g_t_1,ph_1,g_ph_1,phb,t_init,mu_2,g_mu_2,mut,g_mut,muu,g_muu,&amp;<a name='1207'>
&amp;muv,g_muv,mub,al,g_al,alt,g_alt,p,g_p,pb,php,g_php,cqu,g_cqu,cqv,g_cqv,cqw,g_cqw,u_base,v_base,z_base,msfu,msfv,msft,f,e,sina,&amp;<a name='1208'>
&amp;cosa,fnm,fnp,rdn,rdnw,dt,rdx,rdy,kvdif,xkmhd,g_xkmhd,cf1,cf2,cf3,cfn,cfn1,non_hydrostatic,leapfrog,ids,ide,jds,jde,kde,ims,&amp;<a name='1209'>
&amp;ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1210'>
<a name='1211'>
<font color=#447700>!--------------------------------------------------------------------------<a name='1212'></font>
<font color=#447700>!! Xiaoyan Zhang Add surface drag TL here 11/28/2006  !!<a name='1213'></font>
<font color=#447700>!--------------------------------------------------------------------------<a name='1214'></font>
   IF (rk_step == 1 ) then<a name='1215'>
   <a name='1216'>
#if 0<a name='1217'>
   CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#SURFACE_DRAG'>surface_drag</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SURFACE_DRAG_4"> (ru_tendf, rv_tendf, u_2, v_2, xland,             &amp;<a name='1218'>
                         muu, muv,z,z_at_w,&amp;<a name='1219'>
                         ids, ide, jds, jde, kds, kde,                    &amp;<a name='1220'>
                         ims, ime, jms, jme, kms, kme,                    &amp;<a name='1221'>
                         grid%i_start(ij), grid%i_end(ij),                &amp;<a name='1222'>
                         grid%j_start(ij), grid%j_end(ij),                &amp;<a name='1223'>
                         k_start, k_end                                  )<a name='1224'>
#endif<a name='1225'>
   <a name='1226'>
   <a name='1227'>
#ifdef DM_PARALLEL<a name='1228'>
#     include "<A href='../../html_code/include/HALO_EM_SD_TL.inc.html'>HALO_EM_SD_TL.inc</A>"<A NAME="HALO_EM_SD_TL.inc_37"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1229'>
#endif<a name='1230'>
<a name='1231'>
<font color=#447700>!call TL<a name='1232'></font>
  call   <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_SURFACE_DRAG'>g_surface_drag</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SURFACE_DRAG_3">( ru_tendf, g_ru_tendf, rv_tendf, g_rv_tendf, u_2, g_u_2, v_2, g_v_2, xland, muu, g_muu, muv, &amp;<a name='1233'>
  &amp;g_muv, z, g_z, z_at_w, g_z_at_w, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, grid%i_start(ij), grid%i_end(ij),  grid%j_start(ij), grid%j_end(ij) , k_start, k_end )<a name='1234'>
<a name='1235'>
<a name='1236'>
  ENDIF<a name='1237'>
<a name='1238'>
<font color=#447700>!--------------------------------------------------------------------------<a name='1239'></font>
<font color=#447700>! End of surface drag TL<a name='1240'></font>
<font color=#447700>!--------------------------------------------------------------------------<a name='1241'></font>
<a name='1242'>
<a name='1243'>
<a name='1244'>
   END DO<a name='1245'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='1246'></font>
BENCH_END(rk_tend_tim)<a name='1247'>
<a name='1248'>
BENCH_START(relax_bdy_dry_tim)<a name='1249'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1250'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='1251'></font>
   DO ij = 1 , grid%num_tiles<a name='1252'>
<a name='1253'>
     IF( (config_flags%specified .or. config_flags%nested) .and. rk_step == 1 ) THEN <a name='1254'>
#if 0<a name='1255'>
       CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_DRY'>relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_DRY_11"> ( config_flags,                                &amp;<a name='1256'>
                            u_save, v_save, ph_save, t_save,             &amp;<a name='1257'>
                            w_save, mu_tend,                             &amp; <a name='1258'>
                            ru, rv, ph_2, t_2,                           &amp;<a name='1259'>
                            w_2, mu_2, mut,                              &amp;<a name='1260'>
                            u_b, v_b, ph_b, t_b, w_b,                    &amp;<a name='1261'>
                            mu_b,                                        &amp;<a name='1262'>
                            u_bt, v_bt, ph_bt, t_bt,                     &amp;<a name='1263'>
                            w_bt, mu_bt,                                 &amp;<a name='1264'>
                            spec_bdy_width, spec_zone, relax_zone,       &amp;<a name='1265'>
                            dtbc, fcx, gcx,             &amp;<a name='1266'>
                            ijds, ijde,                 &amp;<a name='1267'>
                            ids,ide, jds,jde, kds,kde,  &amp;<a name='1268'>
                            ims,ime, jms,jme, kms,kme,  &amp;<a name='1269'>
                            ips,ipe, jps,jpe, kps,kpe,  &amp;<a name='1270'>
                            grid%i_start(ij), grid%i_end(ij),            &amp;<a name='1271'>
                            grid%j_start(ij), grid%j_end(ij),            &amp;<a name='1272'>
                            k_start, k_end                              )<a name='1273'>
#endif<a name='1274'>
      call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_RELAX_BDY_DRY'>g_relax_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_RELAX_BDY_DRY_3">( config_flags,u_save,g_u_save,v_save,g_v_save,ph_save,g_ph_save,t_save,g_t_save,w_save,g_w_save,mu_tend,&amp;<a name='1275'>
&amp;g_mu_tend,ru,g_ru,rv,g_rv,ph_2,g_ph_2,t_2,g_t_2,w_2,g_w_2,mu_2,g_mu_2,mut,g_mut,u_b,g_u_b,v_b,g_v_b,ph_b,g_ph_b,t_b,g_t_b,&amp;<a name='1276'>
&amp;w_b,g_w_b,mu_b,g_mu_b,u_bt,g_u_bt,v_bt,g_v_bt,ph_bt,g_ph_bt,t_bt,g_t_bt,w_bt,g_w_bt,mu_bt,g_mu_bt,spec_bdy_width,spec_zone,&amp;<a name='1277'>
&amp;relax_zone,dtbc,fcx,gcx,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%&amp;<a name='1278'>
&amp;j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1279'>
<a name='1280'>
     ENDIF<a name='1281'>
#if 0<a name='1282'>
     CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_ADDTEND_DRY'>rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_ADDTEND_DRY_11">( ru_tend,  rv_tend,  rw_tend,  ph_tend,  t_tend,  &amp;<a name='1283'>
                          ru_tendf, rv_tendf, rw_tendf, ph_tendf, t_tendf, &amp;<a name='1284'>
                          u_save, v_save, w_save, ph_save, t_save, rk_step,&amp;<a name='1285'>
                          h_diabatic, mut, msft, msfu, msfv,               &amp;<a name='1286'>
                          ids,ide, jds,jde, kds,kde,                       &amp;<a name='1287'>
                          ims,ime, jms,jme, kms,kme,                       &amp;<a name='1288'>
                          ips,ipe, jps,jpe, kps,kpe,                       &amp;<a name='1289'>
                          grid%i_start(ij), grid%i_end(ij),                &amp;<a name='1290'>
                          grid%j_start(ij), grid%j_end(ij),                &amp;<a name='1291'>
                          k_start, k_end                                  )<a name='1292'>
#endif<a name='1293'>
    call <A href='../../html_code/dyn_em/module_em_tl.F.html#G_RK_ADDTEND_DRY'>g_rk_addtend_dry</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_RK_ADDTEND_DRY_3">( ru_tend,g_ru_tend,rv_tend,g_rv_tend,rw_tend,g_rw_tend,ph_tend,g_ph_tend,t_tend,g_t_tend,ru_tendf,&amp;<a name='1294'>
&amp;g_ru_tendf,rv_tendf,g_rv_tendf,rw_tendf,g_rw_tendf,ph_tendf,g_ph_tendf,t_tendf,g_t_tendf,u_save,g_u_save,v_save,g_v_save,&amp;<a name='1295'>
&amp;w_save,g_w_save,ph_save,g_ph_save,t_save,g_t_save,rk_step,h_diabatic,mut,g_mut,msft,msfu,msfv,ide,jde,ims,ime,jms,jme,kms,kme,&amp;<a name='1296'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1297'>
<a name='1298'>
     IF( config_flags%specified .or. config_flags%nested ) THEN <a name='1299'>
#if 0<a name='1300'>
       CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_DRY'>spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_DRY_11"> ( config_flags,                                    &amp;<a name='1301'>
                           ru_tend, rv_tend, ph_tend, t_tend,               &amp;<a name='1302'>
                           rw_tend, mu_tend,                                &amp;<a name='1303'>
                           u_b, v_b, ph_b, t_b,                             &amp;<a name='1304'>
                           w_b, mu_b,                                       &amp;<a name='1305'>
                           u_bt, v_bt, ph_bt, t_bt,                         &amp;<a name='1306'>
                           w_bt, mu_bt,                                     &amp;<a name='1307'>
                           spec_bdy_width, spec_zone,                       &amp;<a name='1308'>
                           ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='1309'></font>
                           ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1310'></font>
                           ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1311'></font>
                           ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1312'></font>
                           grid%i_start(ij), grid%i_end(ij),                &amp;<a name='1313'>
                           grid%j_start(ij), grid%j_end(ij),                &amp;<a name='1314'>
                           k_start, k_end                                  )<a name='1315'>
#endif<a name='1316'>
      call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_SPEC_BDY_DRY'>g_spec_bdy_dry</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDY_DRY_3">( config_flags,ru_tend,g_ru_tend,rv_tend,g_rv_tend,ph_tend,g_ph_tend,t_tend,g_t_tend,rw_tend,g_rw_tend,&amp;<a name='1317'>
&amp;mu_tend,g_mu_tend,u_bt,g_u_bt,v_bt,g_v_bt,ph_bt,g_ph_bt,t_bt,g_t_bt,w_bt,g_w_bt,mu_bt,g_mu_bt,spec_bdy_width,spec_zone,ijds,&amp;<a name='1318'>
&amp;ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),&amp;<a name='1319'>
&amp;k_start,k_end )<a name='1320'>
<a name='1321'>
     ENDIF<a name='1322'>
<a name='1323'>
   END DO<a name='1324'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='1325'></font>
BENCH_END(relax_bdy_dry_tim)<a name='1326'>
<a name='1327'>
<a name='1328'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1329'></font>
<font color=#447700>!&lt;pre&gt;<a name='1330'></font>
<font color=#447700>! (3) Small (acoustic,sound) steps.<a name='1331'></font>
<font color=#447700>!<a name='1332'></font>
<font color=#447700>!    Several acoustic steps are taken each RK pass.  A small step <a name='1333'></font>
<font color=#447700>!    sequence begins with calculating perturbation variables <a name='1334'></font>
<font color=#447700>!    and coupling them to the column dry-air-mass mu <a name='1335'></font>
<font color=#447700>!    (call to small_step_prep).  This is followed by computing<a name='1336'></font>
<font color=#447700>!    coefficients for the vertically implicit part of the<a name='1337'></font>
<font color=#447700>!    small timestep (call to calc_coef_w).  <a name='1338'></font>
<font color=#447700>!<a name='1339'></font>
<font color=#447700>!    The small steps are taken<a name='1340'></font>
<font color=#447700>!    in the named loop "small_steps:".  In the small_steps loop, first <a name='1341'></font>
<font color=#447700>!    the horizontal momentum (u and v) are advanced (call to advance_uv),<a name='1342'></font>
<font color=#447700>!    next mu and theta are advanced (call to advance_mu_t) followed by<a name='1343'></font>
<font color=#447700>!    advancing w and the geopotential (call to advance_w).  Diagnostic<a name='1344'></font>
<font color=#447700>!    values for pressure and inverse density are updated at the end of<a name='1345'></font>
<font color=#447700>!    each small_step.<a name='1346'></font>
<font color=#447700>!<a name='1347'></font>
<font color=#447700>!    The small-step section ends with the change of the perturbation variables<a name='1348'></font>
<font color=#447700>!    back to full variables (call to small_step_finish).<a name='1349'></font>
<font color=#447700>!&lt;/pre&gt;<a name='1350'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1351'></font>
<a name='1352'>
BENCH_START(small_step_prep_tim)<a name='1353'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1354'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='1355'></font>
<a name='1356'>
   DO ij = 1 , grid%num_tiles<a name='1357'>
<a name='1358'>
    <font color=#447700>! Calculate coefficients for the vertically implicit acoustic/gravity wave<a name='1359'></font>
    <font color=#447700>! integration.  We only need calculate these for the first pass through -<a name='1360'></font>
    <font color=#447700>! the predictor step.  They are reused as is for the corrector step.<a name='1361'></font>
    <font color=#447700>! For third-order RK, we need to recompute these after the first <a name='1362'></font>
    <font color=#447700>! predictor because we may have changed the small timestep -&gt; dts.<a name='1363'></font>
<a name='1364'>
      CALL wrf_debug ( 200 , ' call calc_coef_w' )<a name='1365'>
#if 0<a name='1366'>
      CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_PREP'>small_step_prep</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_PREP_11">( u_1,u_2,v_1,v_2,w_1,w_2,          &amp;<a name='1367'>
                            t_1,t_2,ph_1,ph_2,                &amp;<a name='1368'>
                            mub, mu_1, mu_2,                  &amp;<a name='1369'>
                            muu, muus, muv, muvs,             &amp;<a name='1370'>
                            mut, muts, mudf,                  &amp; <a name='1371'>
                            u_save, v_save, w_save,           &amp; <a name='1372'>
                            t_save, ph_save, mu_save,         &amp;<a name='1373'>
                            ww, ww1,                          &amp;<a name='1374'>
                            dnw, c2a, pb, p, alt,             &amp;<a name='1375'>
                            msfu, msfv, msft,                 &amp;<a name='1376'>
                            rk_step, leapfrog,                &amp;<a name='1377'>
                            ids, ide, jds, jde, kds, kde,     &amp;<a name='1378'>
                            ims, ime, jms, jme, kms, kme,     &amp;<a name='1379'>
                            grid%i_start(ij), grid%i_end(ij), &amp;<a name='1380'>
                            grid%j_start(ij), grid%j_end(ij), &amp;<a name='1381'>
                            k_start    , k_end               )<a name='1382'>
      CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_18">( al, p, ph_2,                      &amp;<a name='1383'>
                       alt, t_2, t_save, c2a, pm1,       &amp;<a name='1384'>
                       mu_2, muts, znu, t0,              &amp;<a name='1385'>
                       rdnw, dnw, smdiv,                 &amp;<a name='1386'>
                       non_hydrostatic, 0,               &amp;<a name='1387'>
                       ids, ide, jds, jde, kds, kde,     &amp;<a name='1388'>
                       ims, ime, jms, jme, kms, kme,     &amp;<a name='1389'>
                       grid%i_start(ij), grid%i_end(ij), &amp;<a name='1390'>
                       grid%j_start(ij), grid%j_end(ij), &amp;<a name='1391'>
                       k_start    , k_end               )<a name='1392'>
#endif<a name='1393'>
    call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SMALL_STEP_PREP'>g_small_step_prep</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SMALL_STEP_PREP_3">( u_1,g_u_1,u_2,g_u_2,v_1,g_v_1,v_2,g_v_2,w_1,g_w_1,w_2,g_w_2,t_1,g_t_1,t_2,g_t_2,ph_1,g_ph_1,ph_2,&amp;<a name='1394'>
&amp;g_ph_2,mub,mu_1,g_mu_1,mu_2,g_mu_2,muu,g_muu,muus,g_muus,muv,g_muv,muvs,g_muvs,mut,g_mut,muts,g_muts,mudf,g_mudf,u_save,&amp;<a name='1395'>
&amp;g_u_save,v_save,g_v_save,w_save,g_w_save,t_save,g_t_save,ph_save,g_ph_save,mu_save,g_mu_save,ww,g_ww,ww1,g_ww1,c2a,g_c2a,pb,p,&amp;<a name='1396'>
&amp;g_p,alt,g_alt,msfu,msfv,msft,rk_step,leapfrog,ide,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%&amp;<a name='1397'>
&amp;j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1398'>
<a name='1399'>
    call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_P_RHO'>g_calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_CALC_P_RHO_3">( al,g_al,p,g_p,ph_2,g_ph_2,alt,g_alt,t_2,g_t_2,t_save,g_t_save,c2a,g_c2a,pm1,g_pm1,mu_2,g_mu_2,muts,g_muts,&amp;<a name='1400'>
&amp;znu,t0,rdnw,dnw,smdiv,non_hydrostatic,0,ide,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),&amp;<a name='1401'>
&amp;grid%j_end(ij),k_start,k_end )<a name='1402'>
<a name='1403'>
      IF (non_hydrostatic) THEN<a name='1404'>
#if 0<a name='1405'>
      CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_COEF_W'>calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_COEF_W_10">( a,alpha,gamma,                    &amp;<a name='1406'>
                        mut, cqw,                         &amp;<a name='1407'>
                        rdn, rdnw, c2a,                   &amp;<a name='1408'>
                        dts_rk, g, epssm,                 &amp;<a name='1409'>
                        ids, ide, jds, jde, kds, kde,     &amp;<a name='1410'>
                        ims, ime, jms, jme, kms, kme,     &amp;<a name='1411'>
                        grid%i_start(ij), grid%i_end(ij), &amp;<a name='1412'>
                        grid%j_start(ij), grid%j_end(ij), &amp;<a name='1413'>
                        k_start    , k_end               )<a name='1414'>
#endif<a name='1415'>
<a name='1416'>
<a name='1417'>
      call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_COEF_W'>g_calc_coef_w</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_CALC_COEF_W_3">( a,g_a,alpha,g_alpha,gamma,g_gamma,mut,g_mut,cqw,g_cqw,rdn,rdnw,c2a,g_c2a,dts,g,epssm,ide,jde,kde,ims,ime,&amp;<a name='1418'>
&amp;jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij) )<a name='1419'>
      ENDIF<a name='1420'>
   ENDDO<a name='1421'>
<a name='1422'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='1423'></font>
BENCH_END(small_step_prep_tim)<a name='1424'>
<a name='1425'>
<font color=#447700>!----------------<a name='1426'></font>
<font color=#447700>!----------------<a name='1427'></font>
<font color=#447700>!  goto 6788 !zzma<a name='1428'></font>
<font color=#447700>!----------------<a name='1429'></font>
<a name='1430'>
<a name='1431'>
#ifdef DM_PARALLEL<a name='1432'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1433'></font>
<font color=#447700>!  Stencils for patch communications  (WCS, 29 June 2001)<a name='1434'></font>
<font color=#447700>!  Note:  the small size of this halo exchange reflects the <a name='1435'></font>
<font color=#447700>!         fact that we are carrying the uncoupled variables <a name='1436'></font>
<font color=#447700>!         as state variables in the mass coordinate model, as<a name='1437'></font>
<font color=#447700>!         opposed to the coupled variables as in the height<a name='1438'></font>
<font color=#447700>!         coordinate model.<a name='1439'></font>
<font color=#447700>!<a name='1440'></font>
<font color=#447700>!                              * * * * *<a name='1441'></font>
<font color=#447700>!            *        * * *    * * * * *<a name='1442'></font>
<font color=#447700>!          * + *      * + *    * * + * * <a name='1443'></font>
<font color=#447700>!            *        * * *    * * * * *<a name='1444'></font>
<font color=#447700>!                              * * * * *<a name='1445'></font>
<font color=#447700>!<a name='1446'></font>
<font color=#447700>!  3D variables - note staggering!  ph_2(Z), u_save(X), v_save(Y)<a name='1447'></font>
<font color=#447700>!<a name='1448'></font>
<font color=#447700>!j ph_2      x<a name='1449'></font>
<font color=#447700>!j al        x<a name='1450'></font>
<font color=#447700>!j p         x<a name='1451'></font>
<font color=#447700>!j t_1       x<a name='1452'></font>
<font color=#447700>!j t_save    x<a name='1453'></font>
<font color=#447700>!j u_save    x<a name='1454'></font>
<font color=#447700>!j v_save    x<a name='1455'></font>
<font color=#447700>!<a name='1456'></font>
<font color=#447700>!  the following are 2D (xy) variables<a name='1457'></font>
<font color=#447700>!<a name='1458'></font>
<font color=#447700>!j mu_1      x<a name='1459'></font>
<font color=#447700>!j mu_2      x<a name='1460'></font>
<font color=#447700>!j mudf      x<a name='1461'></font>
<font color=#447700>!--------------------------------------------------------------<a name='1462'></font>
#      include "<A href='../../html_code/include/HALO_EM_B.inc.html'>HALO_EM_B.inc</A>"<A NAME="HALO_EM_B.inc_38"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1463'>
#      include "<A href='../../html_code/include/HALO_EM_TL_B.inc.html'>HALO_EM_TL_B.inc</A>"<A NAME="HALO_EM_TL_B.inc_39"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1464'>
#      include "<A href='../../html_code/include/PERIOD_BDY_EM_B.inc.html'>PERIOD_BDY_EM_B.inc</A>"<A NAME="PERIOD_BDY_EM_B.inc_40"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1465'>
#endif<a name='1466'>
<a name='1467'>
BENCH_START(set_phys_bc2_tim)<a name='1468'>
   if(dyn_opt == DYN_EM) then<a name='1469'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1470'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='1471'></font>
<a name='1472'>
   DO ij = 1 , grid%num_tiles<a name='1473'>
<a name='1474'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_101">( ru_tend, 'u', config_flags,          &amp;<a name='1475'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='1476'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='1477'>
                                 ips, ipe, jps, jpe, kps, kpe, &amp;<a name='1478'>
                           grid%i_start(ij), grid%i_end(ij),                 &amp;<a name='1479'>
                           grid%j_start(ij), grid%j_end(ij),                 &amp;<a name='1480'>
                           k_start    , k_end                     )<a name='1481'>
<a name='1482'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_102">( rv_tend, 'v', config_flags,            &amp;<a name='1483'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='1484'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='1485'>
                                 ips, ipe, jps, jpe, kps, kpe, &amp;<a name='1486'>
                           grid%i_start(ij), grid%i_end(ij),                 &amp;<a name='1487'>
                           grid%j_start(ij), grid%j_end(ij),                 &amp;<a name='1488'>
                           k_start    , k_end                     )<a name='1489'>
<a name='1490'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_103">( ph_2, 'w', config_flags,          &amp;<a name='1491'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='1492'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='1493'>
                                 ips, ipe, jps, jpe, kps, kpe, &amp;<a name='1494'>
                           grid%i_start(ij), grid%i_end(ij),                 &amp;<a name='1495'>
                           grid%j_start(ij), grid%j_end(ij),                 &amp;<a name='1496'>
                           k_start    , k_end                     )<a name='1497'>
<a name='1498'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_104">( al, 'p', config_flags,            &amp;<a name='1499'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='1500'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='1501'>
                                 ips, ipe, jps, jpe, kps, kpe, &amp;<a name='1502'>
                           grid%i_start(ij), grid%i_end(ij),                 &amp;<a name='1503'>
                           grid%j_start(ij), grid%j_end(ij),                 &amp;<a name='1504'>
                           k_start    , k_end                     )<a name='1505'>
<a name='1506'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_105">( p, 'p', config_flags,             &amp;<a name='1507'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='1508'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='1509'>
                                 ips, ipe, jps, jpe, kps, kpe, &amp;<a name='1510'>
                           grid%i_start(ij), grid%i_end(ij),                 &amp;<a name='1511'>
                           grid%j_start(ij), grid%j_end(ij),                 &amp;<a name='1512'>
                           k_start    , k_end                     )<a name='1513'>
<a name='1514'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_106">( t_1, 'p', config_flags,             &amp;<a name='1515'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='1516'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='1517'>
                                 ips, ipe, jps, jpe, kps, kpe, &amp;<a name='1518'>
                           grid%i_start(ij), grid%i_end(ij),                 &amp;<a name='1519'>
                           grid%j_start(ij), grid%j_end(ij),                 &amp;<a name='1520'>
                           k_start    , k_end                     )<a name='1521'>
<a name='1522'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_107">( t_save, 't', config_flags,             &amp;<a name='1523'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='1524'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='1525'>
                                 ips, ipe, jps, jpe, kps, kpe, &amp;<a name='1526'>
                           grid%i_start(ij), grid%i_end(ij),                 &amp;<a name='1527'>
                           grid%j_start(ij), grid%j_end(ij),                 &amp;<a name='1528'>
                           k_start    , k_end                     )<a name='1529'>
<a name='1530'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_16">( mu_1, 't', config_flags,          &amp;<a name='1531'>
                                 ids, ide, jds, jde,               &amp;<a name='1532'>
                                 ims, ime, jms, jme,               &amp;<a name='1533'>
                                 ips, ipe, jps, jpe,               &amp;<a name='1534'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1535'>
                                 grid%j_start(ij), grid%j_end(ij) )<a name='1536'>
<a name='1537'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_17">( mu_2, 't', config_flags,          &amp;<a name='1538'>
                                 ids, ide, jds, jde,               &amp;<a name='1539'>
                                 ims, ime, jms, jme,               &amp;<a name='1540'>
                                 ips, ipe, jps, jpe,               &amp;<a name='1541'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1542'>
                                 grid%j_start(ij), grid%j_end(ij) )<a name='1543'>
<a name='1544'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_18">( mudf, 't', config_flags,          &amp;<a name='1545'>
                                 ids, ide, jds, jde,               &amp;<a name='1546'>
                                 ims, ime, jms, jme,               &amp;<a name='1547'>
                                 ips, ipe, jps, jpe,               &amp;<a name='1548'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1549'>
                                 grid%j_start(ij), grid%j_end(ij) )<a name='1550'>
<a name='1551'>
    END DO<a name='1552'>
    <font color=#447700>!$OMP END PARALLEL DO<a name='1553'></font>
    endif<a name='1554'>
BENCH_END(set_phys_bc2_tim)<a name='1555'>
<a name='1556'>
<a name='1557'>
   small_steps : DO iteration = 1 , number_of_small_timesteps<a name='1558'>
<a name='1559'>
   <font color=#447700>! Boundary condition time (or communication time).  <a name='1560'></font>
<a name='1561'>
#ifdef DM_PARALLEL<a name='1562'>
#      include "<A href='../../html_code/include/PERIOD_BDY_EM_B.inc.html'>PERIOD_BDY_EM_B.inc</A>"<A NAME="PERIOD_BDY_EM_B.inc_41"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1563'>
#endif<a name='1564'>
<a name='1565'>
<a name='1566'>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1567'></font>
      <font color=#447700>!$OMP PRIVATE ( ij )<a name='1568'></font>
<a name='1569'>
      DO ij = 1 , grid%num_tiles<a name='1570'>
<a name='1571'>
BENCH_START(advance_uv_tim)<a name='1572'>
#if 0<a name='1573'>
         CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_UV'>advance_uv</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_UV_11"> ( u_2, ru_tend, v_2, rv_tend,       &amp;<a name='1574'>
                           p, pb,                            &amp;<a name='1575'>
                           ph_2, php, alt, al, mu_2,         &amp;<a name='1576'>
                           muu, cqu, muv, cqv, mudf,         &amp;<a name='1577'>
                           rdx, rdy, dts_rk,                 &amp;<a name='1578'>
                           cf1, cf2, cf3, fnm, fnp,          &amp;<a name='1579'>
                           emdiv,                            &amp;<a name='1580'>
                           rdnw, config_flags,spec_zone,     &amp;<a name='1581'>
                           non_hydrostatic,                  &amp;<a name='1582'>
                           ids, ide, jds, jde, kds, kde,     &amp;<a name='1583'>
                           ims, ime, jms, jme, kms, kme,     &amp;<a name='1584'>
                           grid%i_start(ij), grid%i_end(ij), &amp;<a name='1585'>
                           grid%j_start(ij), grid%j_end(ij), &amp;<a name='1586'>
                           k_start    , k_end               )<a name='1587'>
#endif<a name='1588'>
<a name='1589'>
      call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_UV'>g_advance_uv</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_ADVANCE_UV_3">( u_2,g_u_2,ru_tend,g_ru_tend,v_2,g_v_2,rv_tend,g_rv_tend,p,g_p,pb,ph_2,g_ph_2,php,g_php,alt,g_alt,al,g_al,&amp;<a name='1590'>
&amp;mu_2,g_mu_2,muu,g_muu,cqu,g_cqu,muv,g_muv,cqv,g_cqv,mudf,g_mudf,rdx,rdy,dts,cf1,cf2,cf3,fnm,fnp,emdiv,rdnw,config_flags,&amp;<a name='1591'>
&amp;spec_zone,non_hydrostatic,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%&amp;<a name='1592'>
&amp;j_end(ij),k_start,k_end )<a name='1593'>
BENCH_END(advance_uv_tim)<a name='1594'>
<a name='1595'>
BENCH_START(spec_bdy_uv_tim)<a name='1596'>
         IF( config_flags%specified .or. config_flags%nested ) THEN<a name='1597'>
#if 0<a name='1598'>
           CALL <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_51">(u_2, ru_tend, dts_rk,      &amp;<a name='1599'>
                               'u'         , config_flags, &amp;<a name='1600'>
                               spec_zone,                  &amp;<a name='1601'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1602'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1603'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1604'></font>
                               grid%i_start(ij), grid%i_end(ij),         &amp;<a name='1605'>
                               grid%j_start(ij), grid%j_end(ij),         &amp;<a name='1606'>
                               k_start    , k_end             )<a name='1607'>
           CALL <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_52">(v_2, rv_tend, dts_rk,      &amp;<a name='1608'>
                               'v'         , config_flags, &amp;<a name='1609'>
                               spec_zone,                  &amp;<a name='1610'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1611'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1612'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1613'></font>
                               grid%i_start(ij), grid%i_end(ij),         &amp;<a name='1614'>
                               grid%j_start(ij), grid%j_end(ij),         &amp;<a name='1615'>
                               k_start    , k_end             )<a name='1616'>
#endif<a name='1617'>
        call <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_SPEC_BDYUPDATE'>g_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDYUPDATE_3">( u_2,g_u_2,ru_tend,g_ru_tend,dts_rk,'u',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='1618'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1619'>
        call <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_SPEC_BDYUPDATE'>g_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDYUPDATE_4">( v_2,g_v_2,rv_tend,g_rv_tend,dts_rk,'v',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='1620'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1621'>
<a name='1622'>
         ENDIF<a name='1623'>
BENCH_END(spec_bdy_uv_tim)<a name='1624'>
<a name='1625'>
      END DO<a name='1626'>
      <font color=#447700>!$OMP END PARALLEL DO<a name='1627'></font>
<a name='1628'>
#ifdef DM_PARALLEL<a name='1629'>
<font color=#447700>!<a name='1630'></font>
<font color=#447700>!  Stencils for patch communications  (WCS, 29 June 2001)<a name='1631'></font>
<font color=#447700>!<a name='1632'></font>
<font color=#447700>!         *                     *<a name='1633'></font>
<font color=#447700>!       * + *      * + *        +<a name='1634'></font>
<font color=#447700>!         *                     *<a name='1635'></font>
<font color=#447700>!<a name='1636'></font>
<font color=#447700>!  u_2               x<a name='1637'></font>
<font color=#447700>!  v_2                          x<a name='1638'></font>
<font color=#447700>!<a name='1639'></font>
#     include "<A href='../../html_code/include/HALO_EM_C.inc.html'>HALO_EM_C.inc</A>"<A NAME="HALO_EM_C.inc_42"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1640'>
#     include "<A href='../../html_code/include/HALO_EM_TL_C.inc.html'>HALO_EM_TL_C.inc</A>"<A NAME="HALO_EM_TL_C.inc_43"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1641'>
#endif<a name='1642'>
<a name='1643'>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1644'></font>
      <font color=#447700>!$OMP PRIVATE ( ij )<a name='1645'></font>
<a name='1646'>
      DO ij = 1 , grid%num_tiles<a name='1647'>
<a name='1648'>
        <font color=#447700>!  advance the mass in the column, theta, and calculate ww<a name='1649'></font>
<a name='1650'>
BENCH_START(advance_mu_t_tim)<a name='1651'>
#if 0<a name='1652'>
        CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_MU_T'>advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_MU_T_11">( ww, ww1, u_2, u_save, v_2, v_save, &amp;<a name='1653'>
                           mu_2, mut, muave, muts, muu, muv,  &amp;<a name='1654'>
                           mudf, ru_m, rv_m, ww_m,            &amp;<a name='1655'>
                           t_2, t_save, t_2save, t_tend,      &amp;<a name='1656'>
                           mu_tend,                           &amp;<a name='1657'>
                           rdx, rdy, dts_rk, epssm,           &amp;<a name='1658'>
                           dnw, fnm, fnp, rdnw,               &amp;<a name='1659'>
                           msfu, msfv, msft,                  &amp;<a name='1660'>
                           iteration, config_flags,           &amp;<a name='1661'>
                           ids, ide, jds, jde, kds, kde,      &amp;<a name='1662'>
                           ims, ime, jms, jme, kms, kme,      &amp;<a name='1663'>
                           grid%i_start(ij), grid%i_end(ij),  &amp;<a name='1664'>
                           grid%j_start(ij), grid%j_end(ij),  &amp;<a name='1665'>
                           k_start    , k_end                )<a name='1666'>
#endif<a name='1667'>
      call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_MU_T'>g_advance_mu_t</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_ADVANCE_MU_T_3">( ww,g_ww,ww1,g_ww1,u_2,g_u_2,u_save,g_u_save,v_2,g_v_2,v_save,g_v_save,mu_2,g_mu_2,mut,g_mut,muave,&amp;<a name='1668'>
&amp;g_muave,muts,g_muts,muu,g_muu,muv,g_muv,mudf,g_mudf,t_2,g_t_2,t_save,g_t_save,t_2save,g_t_2save,t_tend,g_t_tend,mu_tend,&amp;<a name='1669'>
&amp;g_mu_tend,rdx,rdy,dts,epssm,dnw,fnm,fnp,rdnw,msfu,msfv,msft,config_flags,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='1670'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1671'>
BENCH_END(advance_mu_t_tim)<a name='1672'>
<a name='1673'>
BENCH_START(spec_bdy_t_tim)<a name='1674'>
         IF( config_flags%specified .or. config_flags%nested ) THEN<a name='1675'>
#if 0<a name='1676'>
           CALL <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_53">(t_2, t_tend, dts_rk,      &amp;<a name='1677'>
                               't'         , config_flags, &amp;<a name='1678'>
                               spec_zone,                  &amp;<a name='1679'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1680'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1681'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1682'></font>
                               grid%i_start(ij), grid%i_end(ij),         &amp;<a name='1683'>
                               grid%j_start(ij), grid%j_end(ij),         &amp;<a name='1684'>
                               k_start    , k_end             )<a name='1685'>
<a name='1686'>
           CALL <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_54">(mu_2, mu_tend, dts_rk,      &amp;<a name='1687'>
                               'm'         , config_flags, &amp;<a name='1688'>
                               spec_zone,                  &amp;<a name='1689'>
                               ids,ide, jds,jde, 1  ,1  ,  &amp; <font color=#447700>! domain dims<a name='1690'></font>
                               ims,ime, jms,jme, 1  ,1  ,  &amp; <font color=#447700>! memory dims<a name='1691'></font>
                               ips,ipe, jps,jpe, 1  ,1  ,  &amp; <font color=#447700>! patch  dims<a name='1692'></font>
                               grid%i_start(ij), grid%i_end(ij),         &amp;<a name='1693'>
                               grid%j_start(ij), grid%j_end(ij),         &amp;<a name='1694'>
                               1    , 1             )<a name='1695'>
<a name='1696'>
           CALL <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_55">(muts, mu_tend, dts_rk,      &amp;<a name='1697'>
                               'm'         , config_flags, &amp;<a name='1698'>
                               spec_zone,                  &amp;<a name='1699'>
                               ids,ide, jds,jde, 1  ,1  ,  &amp; <font color=#447700>! domain dims<a name='1700'></font>
                               ims,ime, jms,jme, 1  ,1  ,  &amp; <font color=#447700>! memory dims<a name='1701'></font>
                               ips,ipe, jps,jpe, 1  ,1  ,  &amp; <font color=#447700>! patch  dims<a name='1702'></font>
                               grid%i_start(ij), grid%i_end(ij),         &amp;<a name='1703'>
                               grid%j_start(ij), grid%j_end(ij),         &amp;<a name='1704'>
                               1    , 1             )<a name='1705'>
#endif<a name='1706'>
        call <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_SPEC_BDYUPDATE'>g_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDYUPDATE_5">( t_2,g_t_2,t_tend,g_t_tend,dts_rk,'t',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%&amp;<a name='1707'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1708'>
        call <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_SPEC_BDYUPDATE'>g_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDYUPDATE_6">( mu_2,g_mu_2,mu_tend,g_mu_tend,dts_rk,'m',spec_zone,ids,ide,jds,jde,1,ims,ime,jms,jme,1,1,grid%&amp;<a name='1709'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='1710'>
        call <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_SPEC_BDYUPDATE'>g_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDYUPDATE_7">( muts,g_muts,mu_tend,g_mu_tend,dts_rk,'m',spec_zone,ids,ide,jds,jde,1,ims,ime,jms,jme,1,1,grid%&amp;<a name='1711'>
&amp;i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),1,1 )<a name='1712'>
         ENDIF<a name='1713'>
BENCH_END(spec_bdy_t_tim)<a name='1714'>
<a name='1715'>
         <font color=#447700>! sumflux accumulates the time-averged mass flux<a name='1716'></font>
         <font color=#447700>! (time averaged over the acoustic steps) for use<a name='1717'></font>
         <font color=#447700>! in the scalar advection (flux divergence).  Using<a name='1718'></font>
         <font color=#447700>! time averaged values gives us exact scalar conservation.<a name='1719'></font>
<a name='1720'>
BENCH_START(sumflux_tim)<a name='1721'>
#if 0<a name='1722'>
         CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#SUMFLUX'>sumflux</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUMFLUX_11"> ( u_2, v_2, ww,                         &amp;<a name='1723'>
                        u_save, v_save, ww1,                  &amp;<a name='1724'>
                        muu, muv,                             &amp;<a name='1725'>
                        ru_m, rv_m, ww_m, epssm,              &amp;<a name='1726'>
                        msfu, msfv,                           &amp;<a name='1727'>
                        iteration, number_of_small_timesteps, &amp;<a name='1728'>
                        ids, ide, jds, jde, kds, kde,         &amp;<a name='1729'>
                        ims, ime, jms, jme, kms, kme,         &amp;<a name='1730'>
                        grid%i_start(ij), grid%i_end(ij),     &amp;<a name='1731'>
                        grid%j_start(ij), grid%j_end(ij),     &amp;<a name='1732'>
                        k_start    , k_end                   )<a name='1733'>
#endif<a name='1734'>
      call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SUMFLUX'>g_sumflux</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SUMFLUX_3">( u_2,g_u_2,v_2,g_v_2,ww,g_ww,u_save,g_u_save,v_save,g_v_save,ww1,g_ww1,muu,g_muu,muv,g_muv,ru_m,g_ru_m,rv_m,&amp;<a name='1735'>
&amp;g_rv_m,ww_m,g_ww_m,msfu,msfv,iteration,number_of_small_timesteps,ide,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='1736'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1737'>
BENCH_END(sumflux_tim)<a name='1738'>
<a name='1739'>
         <font color=#447700>! small (acoustic) step for the vertical momentum,<a name='1740'></font>
         <font color=#447700>! density and coupled potential temperature.<a name='1741'></font>
<a name='1742'>
<a name='1743'>
BENCH_START(advance_w_tim)<a name='1744'>
        IF ( non_hydrostatic ) THEN<a name='1745'>
#if 0<a name='1746'>
          CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#ADVANCE_W'>advance_w</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_W_11">( w_2, rw_tend, ww, u_2, v_2,       &amp;<a name='1747'>
                          mu_2, mut, muave, muts,           &amp;<a name='1748'>
                          t_2save, t_2, t_save,             &amp;<a name='1749'>
                          ph_2, ph_save, phb, ph_tend,      &amp;<a name='1750'>
                          ht, c2a, cqw, alt, alb,           &amp;<a name='1751'>
                          a, alpha, gamma,                  &amp;<a name='1752'>
                          rdx, rdy, dts_rk, t0, epssm,      &amp;<a name='1753'>
                          dnw, fnm, fnp, rdnw, rdn,         &amp;<a name='1754'>
                          cf1, cf2, cf3, msft,              &amp;<a name='1755'>
                          config_flags,                     &amp;<a name='1756'>
                          ids,ide, jds,jde, kds,kde,        &amp; <font color=#447700>! domain dims<a name='1757'></font>
                          ims,ime, jms,jme, kms,kme,        &amp; <font color=#447700>! memory dims<a name='1758'></font>
                          grid%i_start(ij), grid%i_end(ij), &amp;<a name='1759'>
                          grid%j_start(ij), grid%j_end(ij), &amp;<a name='1760'>
                          k_start    , k_end               )<a name='1761'>
#endif<a name='1762'>
        call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_ADVANCE_W'>g_advance_w</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_ADVANCE_W_3">( w_2,g_w_2,rw_tend,g_rw_tend,ww,g_ww,u_2,g_u_2,v_2,g_v_2,mu_2,g_mu_2,mut,g_mut,muave,g_muave,muts,g_muts,&amp;<a name='1763'>
&amp;t_2save,g_t_2save,t_2,g_t_2,t_save,g_t_save,ph_2,g_ph_2,ph_save,g_ph_save,phb,ph_tend,g_ph_tend,ht,c2a,g_c2a,cqw,g_cqw,&amp;<a name='1764'>
&amp;alt,g_alt,alb,a,g_a,alpha,g_alpha,gamma,g_gamma,rdx,rdy,dts,t0,epssm,fnm,fnp,rdnw,rdn,cf1,cf2,cf3,msft,config_flags,ids,&amp;<a name='1765'>
&amp;ide,jds,jde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1766'>
        ENDIF<a name='1767'>
BENCH_END(advance_w_tim)<a name='1768'>
<a name='1769'>
        IF( config_flags%specified .or. config_flags%nested ) THEN<a name='1770'>
<a name='1771'>
BENCH_START(spec_bdynhyd_tim)<a name='1772'>
           IF (non_hydrostatic)  THEN<a name='1773'>
#if 0<a name='1774'>
             CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDYUPDATE_PH'>spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_PH_11">( ph_save, ph_2, ph_tend, mu_tend, muts, dts_rk, &amp;<a name='1775'>
                                     'h'         , config_flags, &amp;<a name='1776'>
                                     spec_zone,                  &amp;<a name='1777'>
                                     ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1778'></font>
                                     ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1779'></font>
                                     ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1780'></font>
                                     grid%i_start(ij), grid%i_end(ij),         &amp;<a name='1781'>
                                     grid%j_start(ij), grid%j_end(ij),         &amp;<a name='1782'>
                                     k_start    , k_end             )<a name='1783'>
#endif<a name='1784'>
          call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_SPEC_BDYUPDATE_PH'>g_spec_bdyupdate_ph</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDYUPDATE_PH_3">( ph_save,g_ph_save,ph_2,g_ph_2,ph_tend,g_ph_tend,mu_tend,g_mu_tend,muts,g_muts,dts_rk,'h',&amp;<a name='1785'>
&amp;spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),&amp;<a name='1786'>
&amp;k_start,k_end )<a name='1787'>
             IF( config_flags%specified ) THEN<a name='1788'>
#if 0<a name='1789'>
               CALL <A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY'>zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_GRAD_BDY_9"> ( w_2,                        &amp;<a name='1790'>
                                    'w'         , config_flags, &amp;<a name='1791'>
                                    spec_zone,                  &amp;<a name='1792'>
                                    ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1793'></font>
                                    ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1794'></font>
                                    ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1795'></font>
                                    grid%i_start(ij), grid%i_end(ij),         &amp;<a name='1796'>
                                    grid%j_start(ij), grid%j_end(ij),         &amp;<a name='1797'>
                                    k_start    , k_end             )<a name='1798'>
#endif<a name='1799'>
               call <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_ZERO_GRAD_BDY'>g_zero_grad_bdy</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_ZERO_GRAD_BDY_1">( w_2,g_w_2,'w',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='1800'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start )<a name='1801'>
             ELSE<a name='1802'>
#if 0<a name='1803'>
               CALL <A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE'>spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDYUPDATE_56">   ( w_2, rw_tend, dts_rk,       &amp;<a name='1804'>
                                       'h'         , config_flags, &amp;<a name='1805'>
                                       spec_zone,                  &amp;<a name='1806'>
                                       ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1807'></font>
                                       ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1808'></font>
                                       ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1809'></font>
                                       grid%i_start(ij), grid%i_end(ij),         &amp;<a name='1810'>
                                       grid%j_start(ij), grid%j_end(ij),         &amp;<a name='1811'>
                                       k_start    , k_end             )<a name='1812'>
#endif<a name='1813'>
            call <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_SPEC_BDYUPDATE'>g_spec_bdyupdate</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDYUPDATE_8">( w_2,g_w_2,rw_tend,g_rw_tend,dts_rk,'h',spec_zone,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='1814'>
&amp;grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1815'>
             ENDIF<a name='1816'>
          ENDIF<a name='1817'>
BENCH_END(spec_bdynhyd_tim)<a name='1818'>
        ENDIF<a name='1819'>
<a name='1820'>
BENCH_START(cald_p_rho_tim)<a name='1821'>
#if 0<a name='1822'>
        CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#CALC_P_RHO'>calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_19">( al, p, ph_2,                      &amp;<a name='1823'>
                         alt, t_2, t_save, c2a, pm1,       &amp;<a name='1824'>
                         mu_2, muts, znu, t0,              &amp;<a name='1825'>
                         rdnw, dnw, smdiv,                 &amp;<a name='1826'>
                         non_hydrostatic, iteration,       &amp;<a name='1827'>
                         ids, ide, jds, jde, kds, kde,     &amp;<a name='1828'>
                         ims, ime, jms, jme, kms, kme,     &amp;<a name='1829'>
                         grid%i_start(ij), grid%i_end(ij), &amp;<a name='1830'>
                         grid%j_start(ij), grid%j_end(ij), &amp;<a name='1831'>
                         k_start    , k_end               )<a name='1832'>
#endif<a name='1833'>
      call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_CALC_P_RHO'>g_calc_p_rho</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_CALC_P_RHO_4">( al,g_al,p,g_p,ph_2,g_ph_2,alt,g_alt,t_2,g_t_2,t_save,g_t_save,c2a,g_c2a,pm1,g_pm1,mu_2,g_mu_2,muts,g_muts,&amp;<a name='1834'>
&amp;znu,t0,rdnw,dnw,smdiv,non_hydrostatic,iteration,ide,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%&amp;<a name='1835'>
&amp;j_start(ij),grid%j_end(ij),k_start,k_end )<a name='1836'>
BENCH_END(cald_p_rho_tim)<a name='1837'>
<a name='1838'>
   ENDDO<a name='1839'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='1840'></font>
<a name='1841'>
#ifdef DM_PARALLEL<a name='1842'>
<font color=#447700>!<a name='1843'></font>
<font color=#447700>!  Stencils for patch communications  (WCS, 29 June 2001)<a name='1844'></font>
<font color=#447700>!<a name='1845'></font>
<font color=#447700>!         *                     *<a name='1846'></font>
<font color=#447700>!       * + *      * + *        +<a name='1847'></font>
<font color=#447700>!         *                     *<a name='1848'></font>
<font color=#447700>!<a name='1849'></font>
<font color=#447700>!  ph_2   x<a name='1850'></font>
<font color=#447700>!  al     x<a name='1851'></font>
<font color=#447700>!  p      x<a name='1852'></font>
<font color=#447700>!<a name='1853'></font>
<font color=#447700>!  2D variables (x,y)<a name='1854'></font>
<font color=#447700>!<a name='1855'></font>
<font color=#447700>!  mu_2   x<a name='1856'></font>
<font color=#447700>!  muts   x<a name='1857'></font>
<font color=#447700>!  mudf   x<a name='1858'></font>
<a name='1859'>
#      include "<A href='../../html_code/include/HALO_EM_C2.inc.html'>HALO_EM_C2.inc</A>"<A NAME="HALO_EM_C2.inc_44"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1860'>
#      include "<A href='../../html_code/include/HALO_EM_TL_C2.inc.html'>HALO_EM_TL_C2.inc</A>"<A NAME="HALO_EM_TL_C2.inc_45"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1861'>
#      include "<A href='../../html_code/include/PERIOD_BDY_EM_B3.inc.html'>PERIOD_BDY_EM_B3.inc</A>"<A NAME="PERIOD_BDY_EM_B3.inc_46"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1862'>
#endif<a name='1863'>
<a name='1864'>
BENCH_START(phys_bc_tim)<a name='1865'>
      if(dyn_opt == DYN_EM) then<a name='1866'>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1867'></font>
      <font color=#447700>!$OMP PRIVATE ( ij )<a name='1868'></font>
<a name='1869'>
      DO ij = 1 , grid%num_tiles<a name='1870'>
<a name='1871'>
        <font color=#447700>! boundary condition set for next small timestep<a name='1872'></font>
<a name='1873'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_108">( ph_2, 'w', config_flags,          &amp;<a name='1874'>
                                 ids, ide, jds, jde, kds, kde,     &amp;<a name='1875'>
                                 ims, ime, jms, jme, kms, kme,     &amp;<a name='1876'>
                                 ips, ipe, jps, jpe, kps, kpe,     &amp;<a name='1877'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1878'>
                                 grid%j_start(ij), grid%j_end(ij), &amp;<a name='1879'>
                                 k_start    , k_end               )<a name='1880'>
<a name='1881'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_109">( al, 'p', config_flags,            &amp;<a name='1882'>
                                 ids, ide, jds, jde, kds, kde,     &amp;<a name='1883'>
                                 ims, ime, jms, jme, kms, kme,     &amp;<a name='1884'>
                                 ips, ipe, jps, jpe, kps, kpe,     &amp;<a name='1885'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1886'>
                                 grid%j_start(ij), grid%j_end(ij), &amp;<a name='1887'>
                                 k_start    , k_end               )<a name='1888'>
<a name='1889'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_110">( p, 'p', config_flags,             &amp;<a name='1890'>
                                 ids, ide, jds, jde, kds, kde,     &amp;<a name='1891'>
                                 ims, ime, jms, jme, kms, kme,     &amp;<a name='1892'>
                                 ips, ipe, jps, jpe, kps, kpe,     &amp;<a name='1893'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1894'>
                                 grid%j_start(ij), grid%j_end(ij), &amp;<a name='1895'>
                                 k_start    , k_end               )<a name='1896'>
<a name='1897'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_19">( muts, 't', config_flags,          &amp;<a name='1898'>
                                 ids, ide, jds, jde,               &amp;<a name='1899'>
                                 ims, ime, jms, jme,               &amp;<a name='1900'>
                                 ips, ipe, jps, jpe,               &amp;<a name='1901'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1902'>
                                 grid%j_start(ij), grid%j_end(ij) )<a name='1903'>
<a name='1904'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_20">( mu_2, 't', config_flags,          &amp;<a name='1905'>
                                 ids, ide, jds, jde,               &amp;<a name='1906'>
                                 ims, ime, jms, jme,               &amp;<a name='1907'>
                                 ips, ipe, jps, jpe,               &amp;<a name='1908'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1909'>
                                 grid%j_start(ij), grid%j_end(ij) )<a name='1910'>
<a name='1911'>
         CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_21">( mudf, 't', config_flags,          &amp;<a name='1912'>
                                 ids, ide, jds, jde,               &amp;<a name='1913'>
                                 ims, ime, jms, jme,               &amp;<a name='1914'>
                                 ips, ipe, jps, jpe,               &amp;<a name='1915'>
                                 grid%i_start(ij), grid%i_end(ij), &amp;<a name='1916'>
                                 grid%j_start(ij), grid%j_end(ij) )<a name='1917'>
<a name='1918'>
      END DO<a name='1919'>
      <font color=#447700>!$OMP END PARALLEL DO<a name='1920'></font>
      endif<a name='1921'>
BENCH_END(phys_bc_tim)<a name='1922'>
<a name='1923'>
   END DO small_steps<a name='1924'>
<a name='1925'>
<a name='1926'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='1927'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='1928'></font>
<a name='1929'>
   DO ij = 1 , grid%num_tiles<a name='1930'>
<a name='1931'>
      CALL wrf_debug ( 200 , ' call rk_small_finish' )<a name='1932'>
<a name='1933'>
      <font color=#447700>! change time-perturbation variables back to <a name='1934'></font>
      <font color=#447700>! full perturbation variables.<a name='1935'></font>
      <font color=#447700>! first get updated mu at u and v points<a name='1936'></font>
<a name='1937'>
BENCH_START(calc_mu_uv_tim)<a name='1938'>
#if 0<a name='1939'>
      CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_MU_UV_1'>calc_mu_uv_1</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_MU_UV_1_9"> ( config_flags,                     &amp;<a name='1940'>
                          muts, muus, muvs,                 &amp;<a name='1941'>
                          ids, ide, jds, jde, kds, kde,     &amp;<a name='1942'>
                          ims, ime, jms, jme, kms, kme,     &amp;<a name='1943'>
                          grid%i_start(ij), grid%i_end(ij), &amp;<a name='1944'>
                          grid%j_start(ij), grid%j_end(ij), &amp;<a name='1945'>
                          k_start    , k_end               )<a name='1946'>
#endif<a name='1947'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_MU_UV_1'>g_calc_mu_uv_1</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_CALC_MU_UV_1_3">( config_flags,muts,g_muts,muus,g_muus,muvs,g_muvs,ids,ide,jds,jde,ims,ime,jms,jme,grid%i_start(ij),grid%&amp;<a name='1948'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij) )<a name='1949'>
BENCH_END(calc_mu_uv_tim)<a name='1950'>
BENCH_START(small_step_finish_tim)<a name='1951'>
#if 0<a name='1952'>
      CALL <A href='../../html_code/dyn_em/module_small_step_em.F.html#SMALL_STEP_FINISH'>small_step_finish</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SMALL_STEP_FINISH_8">( u_2, u_1, v_2, v_1, w_2, w_1,     &amp;<a name='1953'>
                              t_2, t_1, ph_2, ph_1, ww, ww1,    &amp;<a name='1954'>
                              mu_2, mu_1,                       &amp;<a name='1955'>
                              mut, muts, muu, muus, muv, muvs,  &amp; <a name='1956'>
                              u_save, v_save, w_save,           &amp;<a name='1957'>
                              t_save, ph_save, mu_save,         &amp;<a name='1958'>
                              msfu, msfv, msft,                 &amp;<a name='1959'>
                              h_diabatic,                       &amp;<a name='1960'>
                              number_of_small_timesteps,dts_rk, &amp;<a name='1961'>
                              ids, ide, jds, jde, kds, kde,     &amp;<a name='1962'>
                              ims, ime, jms, jme, kms, kme,     &amp;<a name='1963'>
                              grid%i_start(ij), grid%i_end(ij), &amp;<a name='1964'>
                              grid%j_start(ij), grid%j_end(ij), &amp;<a name='1965'>
                              k_start    , k_end               )<a name='1966'>
#endif<a name='1967'>
    call <A href='../../html_code/dyn_em/module_small_step_em_tl.F.html#G_SMALL_STEP_FINISH'>g_small_step_finish</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SMALL_STEP_FINISH_3">( u_2,g_u_2,v_2,g_v_2,w_2,g_w_2,t_2,g_t_2,ph_2,g_ph_2,ww,mu_2,g_mu_2,mut,g_mut,muts,g_muts,muu,g_muu,&amp;<a name='1968'>
&amp;muus,g_muus,muv,g_muv,muvs,g_muvs,u_save,g_u_save,v_save,g_v_save,w_save,g_w_save,t_save,g_t_save,ph_save,g_ph_save,mu_save,&amp;<a name='1969'>
&amp;g_mu_save,msfu,msfv,msft,ide,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij) )<a name='1970'>
<a name='1971'>
<a name='1972'>
BENCH_END(small_step_finish_tim)<a name='1973'>
<a name='1974'>
   END DO<a name='1975'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='1976'></font>
<a name='1977'>
<a name='1978'>
<a name='1979'>
#ifdef DM_PARALLEL<a name='1980'>
<font color=#447700>!<a name='1981'></font>
<font color=#447700>!  Stencils for patch communications  (WCS, 29 June 2001)<a name='1982'></font>
<font color=#447700>!<a name='1983'></font>
<font color=#447700>!<a name='1984'></font>
<font color=#447700>! ru_m      x<a name='1985'></font>
<font color=#447700>! rv_m      x<a name='1986'></font>
<font color=#447700>!<a name='1987'></font>
<font color=#447700>!--------------------------------------------------------------<a name='1988'></font>
<a name='1989'>
#  include "<A href='../../html_code/include/HALO_EM_D.inc.html'>HALO_EM_D.inc</A>"<A NAME="HALO_EM_D.inc_47"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1990'>
#  include "<A href='../../html_code/include/HALO_EM_TL_D.inc.html'>HALO_EM_TL_D.inc</A>"<A NAME="HALO_EM_TL_D.inc_48"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1991'>
#endif<a name='1992'>
<a name='1993'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1994'></font>
<font color=#447700>!&lt;pre&gt;<a name='1995'></font>
<font color=#447700>! (4) Still within the RK loop, the scalar variables are advanced.<a name='1996'></font>
<font color=#447700>!<a name='1997'></font>
<font color=#447700>!    For the moist and chem variables, each one is advanced<a name='1998'></font>
<font color=#447700>!    individually, using named loops "moist_variable_loop:"<a name='1999'></font>
<font color=#447700>!    and "chem_variable_loop:".  Each RK substep begins by<a name='2000'></font>
<font color=#447700>!    calculating the advective tendency, and, for the first RK step, <a name='2001'></font>
<font color=#447700>!    3D mixing (calling rk_scalar_tend) followed by an update<a name='2002'></font>
<font color=#447700>!    of the scalar (calling rk_scalar_update).<a name='2003'></font>
<font color=#447700>!&lt;/pre&gt;<a name='2004'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2005'></font>
<a name='2006'>
  moist_scalar_advance: IF (num_3d_m &gt;= PARAM_FIRST_SCALAR )  THEN<a name='2007'>
<a name='2008'>
   moist_variable_loop: do im = PARAM_FIRST_SCALAR, num_3d_m<a name='2009'>
<a name='2010'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2011'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2012'></font>
<a name='2013'>
   moist_tile_loop_1: DO ij = 1 , grid%num_tiles<a name='2014'>
<a name='2015'>
       CALL wrf_debug ( 200 , ' call rk_scalar_tend' )<a name='2016'>
<a name='2017'>
BENCH_START(rk_scalar_tend_tim)<a name='2018'>
#if 0<a name='2019'>
       CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_SCALAR_TEND'>rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_SCALAR_TEND_11"> (  im, im, config_flags,             &amp;<a name='2020'>
                              rk_step, dt_rk,                   &amp;<a name='2021'>
                              ru_m, rv_m, ww_m,                 &amp;<a name='2022'>
                              mut, alt,                         &amp;<a name='2023'>
                              moist_1(ims,kms,jms,im),          &amp;<a name='2024'>
                              moist_2(ims,kms,jms,im),          &amp;<a name='2025'>
                              moist_tend(ims,kms,jms,im),       &amp;<a name='2026'>
                              advect_tend,RQVFTEN,              &amp;<a name='2027'>
                              qv_base, .true., fnm, fnp,        &amp;<a name='2028'>
                              msfu, msfv, msft,                 &amp;<a name='2029'>
                              rdx, rdy, rdn, rdnw, khdif,       &amp;<a name='2030'>
                              kvdif, xkmhd,                     &amp;<a name='2031'>
                              leapfrog,                         &amp;<a name='2032'>
                              ids, ide, jds, jde, kds, kde,     &amp;<a name='2033'>
                              ims, ime, jms, jme, kms, kme,     &amp;<a name='2034'>
                              grid%i_start(ij), grid%i_end(ij), &amp;<a name='2035'>
                              grid%j_start(ij), grid%j_end(ij), &amp;<a name='2036'>
                              k_start    , k_end               )<a name='2037'>
#endif<a name='2038'>
<a name='2039'>
        call <A href='../../html_code/dyn_em/module_em_tl.F.html#G_RK_SCALAR_TEND'>g_rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_RK_SCALAR_TEND_3">( im,im,config_flags,rk_step,ru_m,g_ru_m,rv_m,g_rv_m,ww_m,g_ww_m,mut,g_mut,alt,g_alt,moist_1(ims,kms,&amp;<a name='2040'>
&amp;jms,im),g_moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,im),g_moist_2(ims,kms,jms,im),moist_tend(ims,kms,jms,im),&amp;<a name='2041'>
&amp;g_moist_tend(ims,kms,jms,im),advect_tend,g_advect_tend,qv_base, .true. ,fnm,fnp,msfu,msfv,msft,rdx,rdy,rdn,rdnw,kvdif,&amp;<a name='2042'>
&amp;xkmhd,g_xkmhd,leapfrog,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%&amp;<a name='2043'>
&amp;j_end(ij),k_start,k_end )<a name='2044'>
<a name='2045'>
BENCH_END(rk_scalar_tend_tim)<a name='2046'>
<a name='2047'>
BENCH_START(rlx_bdy_scalar_tim)<a name='2048'>
     IF( (config_flags%specified .or. config_flags%nested) .and. rk_step == 1 ) THEN <a name='2049'>
<a name='2050'>
       IF(im .eq. P_QV)THEN<a name='2051'>
#if 0<a name='2052'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_SCALAR'>relax_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_SCALAR_7"> ( moist_tend(ims,kms,jms,im),            &amp; <a name='2053'>
                                 moist_2(ims,kms,jms,im),  mut,         &amp;<a name='2054'>
                                 rqv_b, rqv_bt,                         &amp;<a name='2055'>
                                 spec_bdy_width, spec_zone, relax_zone, &amp;<a name='2056'>
                                 dtbc, fcx, gcx,             &amp;<a name='2057'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2058'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2059'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2060'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2061'></font>
                                 grid%i_start(ij), grid%i_end(ij),      &amp;<a name='2062'>
                                 grid%j_start(ij), grid%j_end(ij),      &amp;<a name='2063'>
                                 k_start, k_end                        )<a name='2064'>
<a name='2065'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_39">  ( moist_tend(ims,kms,jms,im),                &amp;<a name='2066'>
                                 rqv_b, rqv_bt,                             &amp;<a name='2067'>
                                 spec_bdy_width, spec_zone,                 &amp;<a name='2068'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2069'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2070'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2071'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2072'></font>
                                 grid%i_start(ij), grid%i_end(ij),          &amp;<a name='2073'>
                                 grid%j_start(ij), grid%j_end(ij),          &amp;<a name='2074'>
                                 k_start, k_end                               )<a name='2075'>
#endif<a name='2076'>
            call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_SPEC_BDY_SCALAR'>g_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDY_SCALAR_3">( moist_tend(ims,kms,jms,im),g_moist_tend(ims,kms,jms,im),rqv_bt,g_rqv_bt,spec_bdy_width,&amp;<a name='2077'>
&amp;spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),&amp;<a name='2078'>
&amp;grid%j_end(ij),k_start,k_end )<a name='2079'>
       ENDIF<a name='2080'>
<a name='2081'>
     ENDIF<a name='2082'>
<a name='2083'>
<font color=#447700>!  ugly code for nested b.c for moist scalars other than qv<a name='2084'></font>
<a name='2085'>
     IF( config_flags%nested .and. (rk_step == 1) ) THEN <a name='2086'>
<a name='2087'>
       IF (im .eq. P_QC) THEN<a name='2088'>
#if 0<a name='2089'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_SCALAR'>relax_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_SCALAR_8"> ( moist_tend(ims,kms,jms,im),            &amp; <a name='2090'>
                                 moist_2(ims,kms,jms,im),  mut,         &amp;<a name='2091'>
                                 rqc_b, rqc_bt,                         &amp;<a name='2092'>
                                 spec_bdy_width, spec_zone, relax_zone, &amp;<a name='2093'>
                                 dtbc, fcx, gcx,             &amp;<a name='2094'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2095'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2096'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2097'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2098'></font>
                                 grid%i_start(ij), grid%i_end(ij),      &amp;<a name='2099'>
                                 grid%j_start(ij), grid%j_end(ij),      &amp;<a name='2100'>
                                 k_start, k_end                        )<a name='2101'>
<a name='2102'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_40">  ( moist_tend(ims,kms,jms,im),                &amp;<a name='2103'>
                                 rqc_b, rqc_bt,                             &amp;<a name='2104'>
                                 spec_bdy_width, spec_zone,                 &amp;<a name='2105'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2106'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2107'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2108'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2109'></font>
                                 grid%i_start(ij), grid%i_end(ij),          &amp;<a name='2110'>
                                 grid%j_start(ij), grid%j_end(ij),          &amp;<a name='2111'>
                                 k_start, k_end                               )<a name='2112'>
#endif<a name='2113'>
            g_rqc_btm(:,:,:,:) = 0.<a name='2114'>
            call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_SPEC_BDY_SCALAR'>g_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDY_SCALAR_4">( moist_tend(ims,kms,jms,im),g_moist_tend(ims,kms,jms,im),rqc_bt,g_rqc_btm,spec_bdy_width,&amp;<a name='2115'>
&amp;spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),&amp;<a name='2116'>
&amp;grid%j_end(ij),k_start,k_end )<a name='2117'>
       ELSE IF (im .eq. P_QR) THEN<a name='2118'>
#if 0<a name='2119'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_SCALAR'>relax_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_SCALAR_9"> ( moist_tend(ims,kms,jms,im),            &amp; <a name='2120'>
                                 moist_2(ims,kms,jms,im),  mut,         &amp;<a name='2121'>
                                 rqr_b, rqr_bt,                         &amp;<a name='2122'>
                                 spec_bdy_width, spec_zone, relax_zone, &amp;<a name='2123'>
                                 dtbc, fcx, gcx,             &amp;<a name='2124'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2125'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2126'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2127'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2128'></font>
                                 grid%i_start(ij), grid%i_end(ij),      &amp;<a name='2129'>
                                 grid%j_start(ij), grid%j_end(ij),      &amp;<a name='2130'>
                                 k_start, k_end                        )<a name='2131'>
<a name='2132'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_41">  ( moist_tend(ims,kms,jms,im),                &amp;<a name='2133'>
                                 rqr_b, rqr_bt,                             &amp;<a name='2134'>
                                 spec_bdy_width, spec_zone,                 &amp;<a name='2135'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2136'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2137'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2138'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2139'></font>
                                 grid%i_start(ij), grid%i_end(ij),          &amp;<a name='2140'>
                                 grid%j_start(ij), grid%j_end(ij),          &amp;<a name='2141'>
                                 k_start, k_end                               )<a name='2142'>
#endif<a name='2143'>
            g_rqr_btm(:,:,:,:) = 0.<a name='2144'>
            call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_SPEC_BDY_SCALAR'>g_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDY_SCALAR_5">( moist_tend(ims,kms,jms,im),g_moist_tend(ims,kms,jms,im),rqr_bt,g_rqr_btm,spec_bdy_width,&amp;<a name='2145'>
&amp;spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),&amp;<a name='2146'>
&amp;grid%j_end(ij),k_start,k_end )<a name='2147'>
       ELSE IF (im .eq. P_QI) THEN<a name='2148'>
#if 0<a name='2149'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_SCALAR'>relax_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_SCALAR_10"> ( moist_tend(ims,kms,jms,im),            &amp; <a name='2150'>
                                 moist_2(ims,kms,jms,im),  mut,         &amp;<a name='2151'>
                                 rqi_b, rqi_bt,                         &amp;<a name='2152'>
                                 spec_bdy_width, spec_zone, relax_zone, &amp;<a name='2153'>
                                 dtbc, fcx, gcx,             &amp;<a name='2154'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2155'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2156'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2157'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2158'></font>
                                 grid%i_start(ij), grid%i_end(ij),      &amp;<a name='2159'>
                                 grid%j_start(ij), grid%j_end(ij),      &amp;<a name='2160'>
                                 k_start, k_end                        )<a name='2161'>
<a name='2162'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_42">  ( moist_tend(ims,kms,jms,im),                &amp;<a name='2163'>
                                 rqi_b, rqi_bt,                             &amp;<a name='2164'>
                                 spec_bdy_width, spec_zone,                 &amp;<a name='2165'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2166'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2167'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2168'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2169'></font>
                                 grid%i_start(ij), grid%i_end(ij),          &amp;<a name='2170'>
                                 grid%j_start(ij), grid%j_end(ij),          &amp;<a name='2171'>
                                 k_start, k_end                               )<a name='2172'>
#endif<a name='2173'>
            g_rqi_btm(:,:,:,:) = 0.<a name='2174'>
            call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_SPEC_BDY_SCALAR'>g_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDY_SCALAR_6">( moist_tend(ims,kms,jms,im),g_moist_tend(ims,kms,jms,im),rqi_bt,g_rqi_btm,spec_bdy_width,&amp;<a name='2175'>
&amp;spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),&amp;<a name='2176'>
&amp;grid%j_end(ij),k_start,k_end )<a name='2177'>
       ELSE IF (im .eq. P_QS) THEN<a name='2178'>
#if 0<a name='2179'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_SCALAR'>relax_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_SCALAR_11"> ( moist_tend(ims,kms,jms,im),            &amp; <a name='2180'>
                                 moist_2(ims,kms,jms,im),  mut,         &amp;<a name='2181'>
                                 rqs_b, rqs_bt,                         &amp;<a name='2182'>
                                 spec_bdy_width, spec_zone, relax_zone, &amp;<a name='2183'>
                                 dtbc, fcx, gcx,             &amp;<a name='2184'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2185'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2186'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2187'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2188'></font>
                                 grid%i_start(ij), grid%i_end(ij),      &amp;<a name='2189'>
                                 grid%j_start(ij), grid%j_end(ij),      &amp;<a name='2190'>
                                 k_start, k_end                        )<a name='2191'>
<a name='2192'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_43">  ( moist_tend(ims,kms,jms,im),                &amp;<a name='2193'>
                                 rqs_b, rqs_bt,                             &amp;<a name='2194'>
                                 spec_bdy_width, spec_zone,                 &amp;<a name='2195'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2196'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2197'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2198'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2199'></font>
                                 grid%i_start(ij), grid%i_end(ij),          &amp;<a name='2200'>
                                 grid%j_start(ij), grid%j_end(ij),          &amp;<a name='2201'>
                                 k_start, k_end                               )<a name='2202'>
#endif<a name='2203'>
            g_rqs_btm(:,:,:,:) = 0.<a name='2204'>
            call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_SPEC_BDY_SCALAR'>g_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDY_SCALAR_7">( moist_tend(ims,kms,jms,im),g_moist_tend(ims,kms,jms,im),rqs_bt,g_rqs_btm,spec_bdy_width,&amp;<a name='2205'>
&amp;spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),&amp;<a name='2206'>
&amp;grid%j_end(ij),k_start,k_end )<a name='2207'>
<a name='2208'>
       ELSE IF (im .eq. P_QG) THEN<a name='2209'>
#if 0<a name='2210'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RELAX_BDY_SCALAR'>relax_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDY_SCALAR_12"> ( moist_tend(ims,kms,jms,im),            &amp; <a name='2211'>
                                 moist_2(ims,kms,jms,im),  mut,         &amp;<a name='2212'>
                                 rqg_b, rqg_bt,                         &amp;<a name='2213'>
                                 spec_bdy_width, spec_zone, relax_zone, &amp;<a name='2214'>
                                 dtbc, fcx, gcx,             &amp;<a name='2215'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2216'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2217'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2218'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2219'></font>
                                 grid%i_start(ij), grid%i_end(ij),      &amp;<a name='2220'>
                                 grid%j_start(ij), grid%j_end(ij),      &amp;<a name='2221'>
                                 k_start, k_end                        )<a name='2222'>
<a name='2223'>
         CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SPEC_BDY_SCALAR'>spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPEC_BDY_SCALAR_44">  ( moist_tend(ims,kms,jms,im),                &amp;<a name='2224'>
                                 rqg_b, rqg_bt,                             &amp;<a name='2225'>
                                 spec_bdy_width, spec_zone,                 &amp;<a name='2226'>
                                 ijds, ijde,                 &amp; <font color=#447700>! min/max(id,jd)<a name='2227'></font>
                                 ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2228'></font>
                                 ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2229'></font>
                                 ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2230'></font>
                                 grid%i_start(ij), grid%i_end(ij),          &amp;<a name='2231'>
                                 grid%j_start(ij), grid%j_end(ij),          &amp;<a name='2232'>
                                 k_start, k_end                               )<a name='2233'>
#endif<a name='2234'>
            g_rqg_btm(:,:,:,:) = 0.<a name='2235'>
            call <A href='../../html_code/dyn_em/module_bc_em_tl.F.html#G_SPEC_BDY_SCALAR'>g_spec_bdy_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_SPEC_BDY_SCALAR_8">( moist_tend(ims,kms,jms,im),g_moist_tend(ims,kms,jms,im),rqg_bt,g_rqg_btm,spec_bdy_width,&amp;<a name='2236'>
&amp;spec_zone,ijds,ijde,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),&amp;<a name='2237'>
&amp;grid%j_end(ij),k_start,k_end )<a name='2238'>
       ENDIF<a name='2239'>
<a name='2240'>
     ENDIF <font color=#447700>! b.c test for moist nested boundary condition<a name='2241'></font>
<a name='2242'>
BENCH_END(rlx_bdy_scalar_tim)<a name='2243'>
<a name='2244'>
   ENDDO moist_tile_loop_1<a name='2245'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2246'></font>
<a name='2247'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2248'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2249'></font>
<a name='2250'>
   moist_tile_loop_2: DO ij = 1 , grid%num_tiles<a name='2251'>
<a name='2252'>
       CALL wrf_debug ( 200 , ' call rk_update_scalar' )<a name='2253'>
<a name='2254'>
BENCH_START(update_scal_tim)<a name='2255'>
#if 0<a name='2256'>
       CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_UPDATE_SCALAR'>rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_UPDATE_SCALAR_10">( im, im,                           &amp;<a name='2257'>
                              moist_1(ims,kms,jms,im),          &amp;<a name='2258'>
                              moist_2(ims,kms,jms,im),          &amp;<a name='2259'>
                              moist_tend(ims,kms,jms,im),       &amp;<a name='2260'>
                              advect_tend, msft,                &amp;<a name='2261'>
                              mu_1, mu_2, mub,                  &amp;<a name='2262'>
                              rk_step, dt_rk, spec_zone,        &amp;<a name='2263'>
                              epsts, leapfrog,config_flags,     &amp;<a name='2264'>
                              ids, ide, jds, jde, kds, kde,     &amp;<a name='2265'>
                              ims, ime, jms, jme, kms, kme,     &amp;<a name='2266'>
                              grid%i_start(ij), grid%i_end(ij), &amp;<a name='2267'>
                              grid%j_start(ij), grid%j_end(ij), &amp;<a name='2268'>
                              k_start    , k_end               )<a name='2269'>
#endif<a name='2270'>
        call <A href='../../html_code/dyn_em/module_em_tl.F.html#G_RK_UPDATE_SCALAR'>g_rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_RK_UPDATE_SCALAR_3">( im,im,moist_1(ims,kms,jms,im),g_moist_1(ims,kms,jms,im),moist_2(ims,kms,jms,im),g_moist_2(ims,kms,&amp;<a name='2271'>
&amp;jms,im),moist_tend(ims,kms,jms,im),g_moist_tend(ims,kms,jms,im),advect_tend,g_advect_tend,msft,mu_1,g_mu_1,mu_2,g_mu_2,&amp;<a name='2272'>
&amp;mub,rk_step,dt_rk,spec_zone,epsts,leapfrog,config_flags,ids,ide,jds,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%&amp;<a name='2273'>
&amp;i_end(ij),grid%j_start(ij),grid%j_end(ij),k_start,k_end )<a name='2274'>
BENCH_END(update_scal_tim)<a name='2275'>
<a name='2276'>
BENCH_START(flow_depbdy_tim)<a name='2277'>
       if(dyn_opt == DYN_EM) then<a name='2278'>
       IF( config_flags%specified ) THEN<a name='2279'>
         IF(im .ne. P_QV)THEN<a name='2280'>
           CALL <A href='../../html_code/share/module_bc.F.html#FLOW_DEP_BDY'>flow_dep_bdy</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FLOW_DEP_BDY_4">  (  moist_2(ims,kms,jms,im),                     &amp;<a name='2281'>
                               ru_m, rv_m, config_flags, &amp;<a name='2282'>
                               spec_zone,                  &amp;<a name='2283'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2284'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2285'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2286'></font>
                               grid%i_start(ij), grid%i_end(ij),                      &amp;<a name='2287'>
                               grid%j_start(ij), grid%j_end(ij),                      &amp;<a name='2288'>
                               k_start, k_end                               )<a name='2289'>
         ENDIF<a name='2290'>
       ENDIF<a name='2291'>
       endif<a name='2292'>
BENCH_END(flow_depbdy_tim)<a name='2293'>
<a name='2294'>
   ENDDO moist_tile_loop_2<a name='2295'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2296'></font>
<a name='2297'>
   ENDDO moist_variable_loop<a name='2298'>
<a name='2299'>
 ENDIF moist_scalar_advance<a name='2300'>
<a name='2301'>
BENCH_START(tke_adv_tim)<a name='2302'>
 if(dyn_opt == DYN_EM) then<a name='2303'>
 TKE_advance: IF (km_opt .eq. 2) then<a name='2304'>
<a name='2305'>
#ifdef DM_PARALLEL<a name='2306'>
      IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='2307'>
#       include "<A href='../../html_code/include/HALO_EM_TKE_ADVECT_3.inc.html'>HALO_EM_TKE_ADVECT_3.inc</A>"<A NAME="HALO_EM_TKE_ADVECT_3.inc_49"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2308'>
      ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='2309'>
#       include "<A href='../../html_code/include/HALO_EM_TKE_ADVECT_5.inc.html'>HALO_EM_TKE_ADVECT_5.inc</A>"<A NAME="HALO_EM_TKE_ADVECT_5.inc_50"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2310'>
      ELSE<a name='2311'>
        WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='2312'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_52">(TRIM(wrf_err_message))<a name='2313'>
      ENDIF<a name='2314'>
#endif<a name='2315'>
<a name='2316'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2317'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2318'></font>
<a name='2319'>
   tke_tile_loop_1: DO ij = 1 , grid%num_tiles<a name='2320'>
<a name='2321'>
     CALL wrf_debug ( 200 , ' call rk_scalar_tend for tke' )<a name='2322'>
     CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_SCALAR_TEND'>rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_SCALAR_TEND_12"> ( 1, 1, config_flags,               &amp;<a name='2323'>
                           rk_step, dt_rk,                   &amp;<a name='2324'>
                           ru_m, rv_m, ww_m,                 &amp;<a name='2325'>
                           mut, alt,                         &amp;<a name='2326'>
                           tke_1(ims,kms,jms),               &amp;<a name='2327'>
                           tke_2(ims,kms,jms),               &amp;<a name='2328'>
                           tke_tend(ims,kms,jms),            &amp;<a name='2329'>
                           advect_tend,RQVFTEN,              &amp;<a name='2330'>
                           qv_base, .false., fnm, fnp,       &amp;<a name='2331'>
                           msfu, msfv, msft,                 &amp;<a name='2332'>
                           rdx, rdy, rdn, rdnw, khdif,       &amp;<a name='2333'>
                           kvdif, xkmhd,                     &amp;<a name='2334'>
                           leapfrog,                         &amp;<a name='2335'>
                           ids, ide, jds, jde, kds, kde,     &amp;<a name='2336'>
                           ims, ime, jms, jme, kms, kme,     &amp;<a name='2337'>
                           grid%i_start(ij), grid%i_end(ij), &amp;<a name='2338'>
                           grid%j_start(ij), grid%j_end(ij), &amp;<a name='2339'>
                           k_start    , k_end               )<a name='2340'>
<a name='2341'>
   ENDDO tke_tile_loop_1<a name='2342'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2343'></font>
<a name='2344'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2345'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2346'></font>
<a name='2347'>
   tke_tile_loop_2: DO ij = 1 , grid%num_tiles<a name='2348'>
<a name='2349'>
     CALL wrf_debug ( 200 , ' call rk_update_scalar' )<a name='2350'>
     CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_UPDATE_SCALAR'>rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_UPDATE_SCALAR_11">( 1, 1,                             &amp;<a name='2351'>
                            tke_1(ims,kms,jms),               &amp;<a name='2352'>
                            tke_2(ims,kms,jms),               &amp;<a name='2353'>
                            tke_tend(ims,kms,jms),            &amp;<a name='2354'>
                            advect_tend,msft,                 &amp;<a name='2355'>
                            mu_1, mu_2, mub,                  &amp;<a name='2356'>
                            rk_step, dt_rk, spec_zone,        &amp;<a name='2357'>
                            epsts, leapfrog,config_flags,     &amp;<a name='2358'>
                            ids, ide, jds, jde, kds, kde,     &amp;<a name='2359'>
                            ims, ime, jms, jme, kms, kme,     &amp;<a name='2360'>
                            grid%i_start(ij), grid%i_end(ij), &amp;<a name='2361'>
                            grid%j_start(ij), grid%j_end(ij), &amp;<a name='2362'>
                            k_start    , k_end               ) <a name='2363'>
<a name='2364'>
<font color=#447700>! bound the tke (greater than 0, less than tke_upper_bound)<a name='2365'></font>
<a name='2366'>
     CALL <A href='../../html_code/dyn_em/module_em.F.html#BOUND_TKE'>bound_tke</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BOUND_TKE_2">( tke_2(ims,kms,jms), tke_upper_bound, &amp;<a name='2367'>
                     ids, ide, jds, jde, kds, kde,        &amp;<a name='2368'>
                     ims, ime, jms, jme, kms, kme,        &amp;<a name='2369'>
                     grid%i_start(ij), grid%i_end(ij),    &amp;<a name='2370'>
                     grid%j_start(ij), grid%j_end(ij),    &amp;<a name='2371'>
                     k_start    , k_end                  )<a name='2372'>
<a name='2373'>
     IF( config_flags%specified .or. config_flags%nested ) THEN<a name='2374'>
         CALL <A href='../../html_code/share/module_bc.F.html#FLOW_DEP_BDY'>flow_dep_bdy</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FLOW_DEP_BDY_5"> (  tke_2(ims,kms,jms),                     &amp;<a name='2375'>
                              ru_m, rv_m, config_flags,               &amp;<a name='2376'>
                              spec_zone,                              &amp;<a name='2377'>
                              ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2378'></font>
                              ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2379'></font>
                              ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2380'></font>
                              grid%i_start(ij), grid%i_end(ij),       &amp;<a name='2381'>
                              grid%j_start(ij), grid%j_end(ij),       &amp;<a name='2382'>
                              k_start, k_end                               )<a name='2383'>
     ENDIF<a name='2384'>
   ENDDO tke_tile_loop_2<a name='2385'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2386'></font>
<a name='2387'>
   END IF TKE_advance<a name='2388'>
   endif<a name='2389'>
BENCH_END(tke_adv_tim)<a name='2390'>
<a name='2391'>
<font color=#447700>!  next the chemical species<a name='2392'></font>
<a name='2393'>
  chem_scalar_advance: IF (num_3d_c &gt;= PARAM_FIRST_SCALAR)  THEN<a name='2394'>
<a name='2395'>
   chem_variable_loop: do ic = PARAM_FIRST_SCALAR, num_3d_c<a name='2396'>
<a name='2397'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2398'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2399'></font>
<a name='2400'>
   chem_tile_loop_1: DO ij = 1 , grid%num_tiles<a name='2401'>
<a name='2402'>
       CALL wrf_debug ( 200 , ' call rk_scalar_tend' )<a name='2403'>
       CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_SCALAR_TEND'>rk_scalar_tend</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_SCALAR_TEND_13"> ( ic, ic, config_flags,                  &amp;<a name='2404'>
                             rk_step, dt_rk,                   &amp;<a name='2405'>
                             ru_m, rv_m, ww_m,                 &amp;<a name='2406'>
                             mut, alt,                         &amp;<a name='2407'>
                             chem_1(ims,kms,jms,ic),           &amp;<a name='2408'>
                             chem_2(ims,kms,jms,ic),           &amp;<a name='2409'>
                             chem_tend(ims,kms,jms,ic),        &amp;<a name='2410'>
                             advect_tend,RQVFTEN,              &amp;<a name='2411'>
                             qv_base, .false., fnm, fnp,       &amp;<a name='2412'>
                             msfu, msfv, msft,                 &amp;<a name='2413'>
                             rdx, rdy, rdn, rdnw,              &amp;<a name='2414'>
                             khdif, kvdif, xkmhd,              &amp;<a name='2415'>
                             leapfrog,                         &amp;<a name='2416'>
                             ids, ide, jds, jde, kds, kde,     &amp;<a name='2417'>
                             ims, ime, jms, jme, kms, kme,     &amp;<a name='2418'>
                             grid%i_start(ij), grid%i_end(ij), &amp;<a name='2419'>
                             grid%j_start(ij), grid%j_end(ij), &amp;<a name='2420'>
                             k_start    , k_end               )<a name='2421'>
<a name='2422'>
   ENDDO chem_tile_loop_1<a name='2423'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2424'></font>
<a name='2425'>
<a name='2426'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2427'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2428'></font>
<a name='2429'>
   chem_tile_loop_2: DO ij = 1 , grid%num_tiles<a name='2430'>
<a name='2431'>
       CALL wrf_debug ( 200 , ' call rk_update_scalar' )<a name='2432'>
       CALL <A href='../../html_code/dyn_em/module_em.F.html#RK_UPDATE_SCALAR'>rk_update_scalar</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_UPDATE_SCALAR_12">( ic, ic,                           &amp;<a name='2433'>
                              chem_1(ims,kms,jms,ic),           &amp;<a name='2434'>
                              chem_2(ims,kms,jms,ic),           &amp;<a name='2435'>
                              chem_tend(ims,kms,jms,ic),        &amp;<a name='2436'>
                              advect_tend, msft,                &amp;<a name='2437'>
                              mu_1, mu_2, mub,                  &amp;<a name='2438'>
                              rk_step, dt_rk, spec_zone,        &amp;<a name='2439'>
                              epsts, leapfrog,config_flags,     &amp;<a name='2440'>
                              ids, ide, jds, jde, kds, kde,     &amp;<a name='2441'>
                              ims, ime, jms, jme, kms, kme,     &amp;<a name='2442'>
                              grid%i_start(ij), grid%i_end(ij), &amp;<a name='2443'>
                              grid%j_start(ij), grid%j_end(ij), &amp;<a name='2444'>
                              k_start    , k_end               )<a name='2445'>
<a name='2446'>
<a name='2447'>
       IF( config_flags%specified ) THEN<a name='2448'>
<font color=#447700>! come back to this and figure out why two different routines are needed. JM 20041203<a name='2449'></font>
#ifndef WRF_CHEM<a name='2450'>
           CALL <A href='../../html_code/share/module_bc.F.html#FLOW_DEP_BDY'>flow_dep_bdy</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FLOW_DEP_BDY_6">  ( chem_2(ims,kms,jms,ic),     &amp;<a name='2451'>
                                ru_m, rv_m, config_flags,   &amp;<a name='2452'>
                                spec_zone,                  &amp;<a name='2453'>
                                ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2454'></font>
                                ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2455'></font>
                                ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2456'></font>
                                grid%i_start(ij), grid%i_end(ij),  &amp;<a name='2457'>
                                grid%j_start(ij), grid%j_end(ij),  &amp;<a name='2458'>
                                k_start, k_end                    )<a name='2459'>
#else<a name='2460'>
           CALL flow_dep_bdy_chem( chem_2(ims,kms,jms,ic),z,&amp;<a name='2461'>
                                ru_m, rv_m, config_flags,alt,   &amp;<a name='2462'>
                                t_1,pb,p,t0,p1000mb,rcp,ph_2,phb,g, &amp;<a name='2463'>
                                spec_zone,ic,               &amp;<a name='2464'>
                                ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2465'></font>
                                ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2466'></font>
                                ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2467'></font>
                                grid%i_start(ij), grid%i_end(ij),  &amp;<a name='2468'>
                                grid%j_start(ij), grid%j_end(ij),  &amp;<a name='2469'>
                                k_start, k_end                    )<a name='2470'>
#endif<a name='2471'>
       ENDIF<a name='2472'>
<a name='2473'>
<a name='2474'>
   ENDDO chem_tile_loop_2<a name='2475'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2476'></font>
<a name='2477'>
   ENDDO chem_variable_loop<a name='2478'>
<a name='2479'>
 ENDIF chem_scalar_advance<a name='2480'>
<a name='2481'>
 <font color=#447700>!  update the pressure and density at the new time level<a name='2482'></font>
<a name='2483'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2484'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2485'></font>
   DO ij = 1 , grid%num_tiles<a name='2486'>
<a name='2487'>
BENCH_START(calc_p_rho_tim)<a name='2488'>
#if 0<a name='2489'>
     CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#CALC_P_RHO_PHI'>calc_p_rho_phi</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALC_P_RHO_PHI_8">( moist_2, num_3d_m,                &amp;<a name='2490'>
                          al, alb, mu_2, muts,              &amp;<a name='2491'>
                          ph_2, p, pb, t_2,                 &amp;<a name='2492'>
                          p0, t0, znu, dnw, rdnw,           &amp;<a name='2493'>
                          rdn, non_hydrostatic,             &amp;<a name='2494'>
                          ids, ide, jds, jde, kds, kde,     &amp;<a name='2495'>
                          ims, ime, jms, jme, kms, kme,     &amp;<a name='2496'>
                          grid%i_start(ij), grid%i_end(ij), &amp;<a name='2497'>
                          grid%j_start(ij), grid%j_end(ij), &amp;<a name='2498'>
                          k_start    , k_end               )<a name='2499'>
#endif<a name='2500'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_P_RHO_PHI'>g_calc_p_rho_phi</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_CALC_P_RHO_PHI_3">( moist_2,g_moist_2,num_3d_m,al,g_al,alb,mu_2,g_mu_2,muts,g_muts,ph_2,g_ph_2,p,g_p,pb,t_2,g_t_2,p0,t0,dnw,&amp;<a name='2501'>
&amp;rdnw,rdn,non_hydrostatic,ide,jde,kde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),&amp;<a name='2502'>
&amp;k_start,k_end )<a name='2503'>
BENCH_END(calc_p_rho_tim)<a name='2504'>
<a name='2505'>
BENCH_START(diag_w_tim)<a name='2506'>
     IF (.not. non_hydrostatic) THEN<a name='2507'>
#if 0<a name='2508'>
     CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#DIAGNOSE_W'>diagnose_w</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DIAGNOSE_W_7">( ph_tend, ph_2, ph_1, w_2, muts, dt_rk,  &amp;<a name='2509'>
                      u_2, v_2, ht,                           &amp;<a name='2510'>
                      cf1, cf2, cf3, rdx, rdy, msft,          &amp;<a name='2511'>
                      ids, ide, jds, jde, kds, kde,           &amp;<a name='2512'>
                      ims, ime, jms, jme, kms, kme,           &amp;<a name='2513'>
                      grid%i_start(ij), grid%i_end(ij),       &amp;<a name='2514'>
                      grid%j_start(ij), grid%j_end(ij),       &amp;<a name='2515'>
                      k_start    , k_end                     )<a name='2516'>
#endif<a name='2517'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_DIAGNOSE_W'>g_diagnose_w</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_DIAGNOSE_W_3">( ph_tend,g_ph_tend,ph_2,g_ph_2,ph_1,g_ph_1,w_2,g_w_2,muts,g_muts,dt_rk,u_2,g_u_2,v_2,g_v_2,ht,cf1,cf2,cf3,&amp;<a name='2518'>
&amp;rdx,rdy,msft,ide,jde,ims,ime,jms,jme,kms,kme,grid%i_start(ij),grid%i_end(ij),grid%j_start(ij),grid%j_end(ij),k_end )<a name='2519'>
     ENDIF<a name='2520'>
BENCH_END(diag_w_tim)<a name='2521'>
<a name='2522'>
   ENDDO<a name='2523'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2524'></font>
<a name='2525'>
<font color=#447700>!  Reset the boundary conditions if there is another corrector step.<a name='2526'></font>
<font color=#447700>!  (rk_step &lt; rk_order), else we'll handle it at the end of everything<a name='2527'></font>
<font color=#447700>!  (after the split physics, before exiting the timestep).<a name='2528'></font>
<a name='2529'>
   rk_step_1_check: IF ( rk_step &lt; rk_order ) THEN<a name='2530'>
<a name='2531'>
<font color=#447700>!-----------------------------------------------------------<a name='2532'></font>
<font color=#447700>!  Stencils for patch communications  (WCS, 29 June 2001)<a name='2533'></font>
<font color=#447700>!<a name='2534'></font>
<font color=#447700>!  here's where we need a wide comm stencil - these are the <a name='2535'></font>
<font color=#447700>!  uncoupled variables so are used for high order calc in<a name='2536'></font>
<font color=#447700>!  advection and mixong routines.<a name='2537'></font>
<font color=#447700>!<a name='2538'></font>
<font color=#447700>!                              * * * * *<a name='2539'></font>
<font color=#447700>!            *        * * *    * * * * *<a name='2540'></font>
<font color=#447700>!          * + *      * + *    * * + * * <a name='2541'></font>
<font color=#447700>!            *        * * *    * * * * *<a name='2542'></font>
<font color=#447700>!                              * * * * *<a name='2543'></font>
<font color=#447700>!<a name='2544'></font>
<font color=#447700>!<a name='2545'></font>
<font color=#447700>! u_2                              x<a name='2546'></font>
<font color=#447700>! v_2                              x<a name='2547'></font>
<font color=#447700>! w_2                              x<a name='2548'></font>
<font color=#447700>! t_2                              x<a name='2549'></font>
<font color=#447700>! ph_2                             x<a name='2550'></font>
<font color=#447700>! al         x<a name='2551'></font>
<font color=#447700>!<a name='2552'></font>
<font color=#447700>!  2D variable<a name='2553'></font>
<font color=#447700>! mu_2       x<a name='2554'></font>
<font color=#447700>!<a name='2555'></font>
<font color=#447700>!  4D variable<a name='2556'></font>
<font color=#447700>! moist_2               x<a name='2557'></font>
<font color=#447700>! chem_2                x<a name='2558'></font>
<a name='2559'>
#ifdef DM_PARALLEL<a name='2560'>
   IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='2561'>
#    include "<A href='../../html_code/include/HALO_EM_D2_3.inc.html'>HALO_EM_D2_3.inc</A>"<A NAME="HALO_EM_D2_3.inc_51"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2562'>
#    include "<A href='../../html_code/include/HALO_EM_TL_D2_3.inc.html'>HALO_EM_TL_D2_3.inc</A>"<A NAME="HALO_EM_TL_D2_3.inc_52"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2563'>
   ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='2564'>
#    include "<A href='../../html_code/include/HALO_EM_D2_5.inc.html'>HALO_EM_D2_5.inc</A>"<A NAME="HALO_EM_D2_5.inc_53"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2565'>
#    include "<A href='../../html_code/include/HALO_EM_TL_D2_5.inc.html'>HALO_EM_TL_D2_5.inc</A>"<A NAME="HALO_EM_TL_D2_5.inc_54"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2566'>
   ELSE <a name='2567'>
     WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='2568'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_53">(TRIM(wrf_err_message))<a name='2569'>
   ENDIF<a name='2570'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_D.inc.html'>PERIOD_BDY_EM_D.inc</A>"<A NAME="PERIOD_BDY_EM_D.inc_55"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2571'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_MOIST2.inc.html'>PERIOD_BDY_EM_MOIST2.inc</A>"<A NAME="PERIOD_BDY_EM_MOIST2.inc_56"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2572'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_CHEM2.inc.html'>PERIOD_BDY_EM_CHEM2.inc</A>"<A NAME="PERIOD_BDY_EM_CHEM2.inc_57"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2573'>
#endif<a name='2574'>
<a name='2575'>
BENCH_START(bc_end_tim)<a name='2576'>
   if(dyn_opt == DYN_EM) then<a name='2577'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2578'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2579'></font>
<a name='2580'>
    tile_bc_loop_1: DO ij = 1 , grid%num_tiles<a name='2581'>
<a name='2582'>
      CALL wrf_debug ( 200 , ' call rk_phys_bc_dry_2' )<a name='2583'>
<a name='2584'>
      CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#RK_PHYS_BC_DRY_2'>rk_phys_bc_dry_2</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RK_PHYS_BC_DRY_2_2">( config_flags,                         &amp;<a name='2585'>
                             u_2, v_2, w_2,                    &amp;<a name='2586'>
                             t_2, ph_2, mu_2,                  &amp;<a name='2587'>
                             ids, ide, jds, jde, kds, kde,     &amp;<a name='2588'>
                             ims, ime, jms, jme, kms, kme,     &amp;<a name='2589'>
                             ips, ipe, jps, jpe, kps, kpe,     &amp;<a name='2590'>
                             grid%i_start(ij), grid%i_end(ij), &amp;<a name='2591'>
                             grid%j_start(ij), grid%j_end(ij), &amp;<a name='2592'>
                             k_start    , k_end               )<a name='2593'>
<a name='2594'>
      IF (num_3d_m &gt;= PARAM_FIRST_SCALAR) THEN<a name='2595'>
<a name='2596'>
        moisture_loop_bdy_1 : DO im = PARAM_FIRST_SCALAR , num_3d_m<a name='2597'>
  <a name='2598'>
          CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_111">( moist_2(ims,kms,jms,im), 'p', config_flags,   &amp;<a name='2599'>
                                   ids, ide, jds, jde, kds, kde,             &amp;<a name='2600'>
                                   ims, ime, jms, jme, kms, kme,             &amp;<a name='2601'>
                                   ips, ipe, jps, jpe, kps, kpe,             &amp;<a name='2602'>
                                   grid%i_start(ij), grid%i_end(ij),                   &amp;<a name='2603'>
                                   grid%j_start(ij), grid%j_end(ij),                   &amp;<a name='2604'>
                                   k_start    , k_end                       )<a name='2605'>
         END DO moisture_loop_bdy_1<a name='2606'>
<a name='2607'>
      ENDIF<a name='2608'>
<a name='2609'>
      IF (num_3d_c &gt;= PARAM_FIRST_SCALAR) THEN<a name='2610'>
<a name='2611'>
        chem_species_bdy_loop_1 : DO ic = PARAM_FIRST_SCALAR , num_3d_c<a name='2612'>
<a name='2613'>
          CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_112">( chem_2(ims,kms,jms,ic), 'p', config_flags,   &amp;<a name='2614'>
                                  ids, ide, jds, jde, kds, kde,            &amp;<a name='2615'>
                                  ims, ime, jms, jme, kms, kme,            &amp;<a name='2616'>
                                  ips, ipe, jps, jpe, kps, kpe,            &amp;<a name='2617'>
                                  grid%i_start(ij), grid%i_end(ij),                  &amp;<a name='2618'>
                                  grid%j_start(ij), grid%j_end(ij),                  &amp;<a name='2619'>
                                  k_start    , k_end-1                    )<a name='2620'>
<a name='2621'>
        END DO chem_species_bdy_loop_1<a name='2622'>
<a name='2623'>
      END IF<a name='2624'>
<a name='2625'>
      IF (km_opt .eq. 2) THEN<a name='2626'>
<a name='2627'>
        CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_113">( tke_2(ims,kms,jms) , 'p', config_flags,  &amp;<a name='2628'>
                                ids, ide, jds, jde, kds, kde,            &amp;<a name='2629'>
                                ims, ime, jms, jme, kms, kme,            &amp;<a name='2630'>
                                ips, ipe, jps, jpe, kps, kpe,            &amp;<a name='2631'>
                                grid%i_start(ij), grid%i_end(ij),        &amp;<a name='2632'>
                                grid%j_start(ij), grid%j_end(ij),        &amp;<a name='2633'>
                                k_start    , k_end                      )<a name='2634'>
      END IF<a name='2635'>
<a name='2636'>
    END DO tile_bc_loop_1<a name='2637'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2638'></font>
   endif<a name='2639'>
BENCH_END(bc_end_tim)<a name='2640'>
<a name='2641'>
<a name='2642'>
#ifdef DM_PARALLEL<a name='2643'>
<a name='2644'>
      IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='2645'>
#       include "<A href='../../html_code/include/HALO_EM_TKE_3.inc.html'>HALO_EM_TKE_3.inc</A>"<A NAME="HALO_EM_TKE_3.inc_58"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2646'>
      ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='2647'>
#       include "<A href='../../html_code/include/HALO_EM_TKE_5.inc.html'>HALO_EM_TKE_5.inc</A>"<A NAME="HALO_EM_TKE_5.inc_59"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2648'>
      ELSE<a name='2649'>
        WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='2650'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_54">(TRIM(wrf_err_message))<a name='2651'>
      ENDIF<a name='2652'>
<a name='2653'>
#if 0<a name='2654'>
   IF (km_opt .eq. 2) THEN<a name='2655'>
#      include  "<A href='../../html_code/include/HALO_EM_TKE_F.inc.html'>HALO_EM_TKE_F.inc</A>"<A NAME="HALO_EM_TKE_F.inc_60"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2656'>
   ENDIF<a name='2657'>
#endif<a name='2658'>
<a name='2659'>
   if ( num_moist .ge. PARAM_FIRST_SCALAR ) then<a name='2660'>
<a name='2661'>
<font color=#447700>!                           * * * * *<a name='2662'></font>
<font color=#447700>!         *        * * *    * * * * *<a name='2663'></font>
<font color=#447700>!       * + *      * + *    * * + * *<a name='2664'></font>
<font color=#447700>!         *        * * *    * * * * *<a name='2665'></font>
<font color=#447700>!                           * * * * *<a name='2666'></font>
<a name='2667'>
<font color=#447700>! moist_2                       x<a name='2668'></font>
<a name='2669'>
     IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='2670'>
#      include "<A href='../../html_code/include/HALO_EM_MOIST_E_3.inc.html'>HALO_EM_MOIST_E_3.inc</A>"<A NAME="HALO_EM_MOIST_E_3.inc_61"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2671'>
     ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='2672'>
#      include "<A href='../../html_code/include/HALO_EM_MOIST_E_5.inc.html'>HALO_EM_MOIST_E_5.inc</A>"<A NAME="HALO_EM_MOIST_E_5.inc_62"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2673'>
     ELSE<a name='2674'>
       WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='2675'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_55">(TRIM(wrf_err_message))<a name='2676'>
     ENDIF<a name='2677'>
   endif<a name='2678'>
   if ( num_chem &gt;= PARAM_FIRST_SCALAR ) then<a name='2679'>
<a name='2680'>
<font color=#447700>!                           * * * * *<a name='2681'></font>
<font color=#447700>!         *        * * *    * * * * *<a name='2682'></font>
<font color=#447700>!       * + *      * + *    * * + * *<a name='2683'></font>
<font color=#447700>!         *        * * *    * * * * *<a name='2684'></font>
<font color=#447700>!                           * * * * *<a name='2685'></font>
<a name='2686'>
<font color=#447700>! chem_2                        x<a name='2687'></font>
<a name='2688'>
     IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='2689'>
#      include "<A href='../../html_code/include/HALO_EM_CHEM_E_3.inc.html'>HALO_EM_CHEM_E_3.inc</A>"<A NAME="HALO_EM_CHEM_E_3.inc_63"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2690'>
     ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='2691'>
#      include "<A href='../../html_code/include/HALO_EM_CHEM_E_5.inc.html'>HALO_EM_CHEM_E_5.inc</A>"<A NAME="HALO_EM_CHEM_E_5.inc_64"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2692'>
     ELSE<a name='2693'>
       WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='2694'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_56">(TRIM(wrf_err_message))<a name='2695'>
     ENDIF<a name='2696'>
   endif<a name='2697'>
#endif<a name='2698'>
<a name='2699'>
   ENDIF rk_step_1_check<a name='2700'>
<a name='2701'>
<font color=#447700>!----------------<a name='2702'></font>
<font color=#447700>!----------------<a name='2703'></font>
<font color=#447700>!6788 continue !zzma<a name='2704'></font>
<font color=#447700>!----------------<a name='2705'></font>
<a name='2706'>
<a name='2707'>
<font color=#447700>!**********************************************************<a name='2708'></font>
<font color=#447700>!<a name='2709'></font>
<font color=#447700>!  end of RK predictor-corrector loop<a name='2710'></font>
<font color=#447700>!<a name='2711'></font>
<font color=#447700>!**********************************************************<a name='2712'></font>
<a name='2713'>
 END DO Runge_Kutta_loop<a name='2714'>
<a name='2715'>
<font color=#447700>!----------------<a name='2716'></font>
<a name='2717'>
#if 0<a name='2718'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2719'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2720'></font>
<a name='2721'>
   DO ij = 1 , grid%num_tiles<a name='2722'>
<a name='2723'>
BENCH_START(advance_ppt_tim)<a name='2724'>
      CALL wrf_debug ( 200 , ' call advance_ppt' )<a name='2725'>
      CALL <A href='../../html_code/phys/module_physics_addtendc.F.html#ADVANCE_PPT'>advance_ppt</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_PPT_2">(RTHCUTEN,RQVCUTEN,RQCCUTEN,RQRCUTEN, &amp;<a name='2726'>
                     RQICUTEN,RQSCUTEN,RAINC,RAINCV,NCA,    &amp;<a name='2727'>
                     CUPPT, config_flags,                   &amp;<a name='2728'>
                     ids,ide, jds,jde, kds,kde,             &amp;<a name='2729'>
                     ims,ime, jms,jme, kms,kme,             &amp;<a name='2730'>
                     grid%i_start(ij), grid%i_end(ij),      &amp;<a name='2731'>
                     grid%j_start(ij), grid%j_end(ij),      &amp;<a name='2732'>
                     k_start    , k_end                    )<a name='2733'>
BENCH_END(advance_ppt_tim)<a name='2734'>
<a name='2735'>
   ENDDO<a name='2736'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2737'></font>
#endif<a name='2738'>
<a name='2739'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2740'></font>
<font color=#447700>!&lt;pre&gt;<a name='2741'></font>
<font color=#447700>! (5) time-split physics.<a name='2742'></font>
<font color=#447700>!<a name='2743'></font>
<font color=#447700>!     Microphysics are the only time  split physics in the WRF model <a name='2744'></font>
<font color=#447700>!     at this time.  Split-physics begins with the calculation of<a name='2745'></font>
<font color=#447700>!     needed diagnostic quantities (pressure, temperature, etc.)<a name='2746'></font>
<font color=#447700>!     followed by a call to the microphysics driver, <a name='2747'></font>
<font color=#447700>!     and finishes with a clean-up, storing off of a diabatic tendency<a name='2748'></font>
<font color=#447700>!     from the moist physics, and a re-calulation of the  diagnostic<a name='2749'></font>
<font color=#447700>!     quantities pressure and density.<a name='2750'></font>
<font color=#447700>!&lt;/pre&gt;<a name='2751'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2752'></font>
<a name='2753'>
ij = 1<a name='2754'>
<a name='2755'>
  IF (config_flags%mp_physics == 0)  then<a name='2756'>
<a name='2757'>
   IF( config_flags%specified .or. config_flags%nested ) THEN<a name='2758'>
     sz = spec_zone<a name='2759'>
   ELSE<a name='2760'>
     sz = 0<a name='2761'>
   ENDIF<a name='2762'>
<a name='2763'>
<a name='2764'>
       CALL wrf_debug ( 200 , ' call moist_physics_prep' )<a name='2765'>
<a name='2766'>
BENCH_START(moist_physics_prep_tim)<a name='2767'>
       CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MOIST_PHYSICS_PREP_EM'>g_moist_physics_prep_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MOIST_PHYSICS_PREP_EM_3">( t_2, g_t_2, t_1, g_t_1, t0, rho,    &amp;<a name='2768'>
                                   g_rho, al, g_al, alb, p, g_p, p8w, g_p8w, p0, &amp;<a name='2769'>
                                   pb, ph_2, g_ph_2, phb, pi_phy, g_pi_phy,  &amp;<a name='2770'>
                                   p_phy, g_p_phy, z, g_z, z_at_w, g_z_at_w, &amp;<a name='2771'>
                                   dz8w, g_dz8w, dtm, h_diabatic, g_h_diabatic, &amp;<a name='2772'>
                                   config_flags, fnm, fnp, ids, ide, jds, jde,  &amp;<a name='2773'>
                                   kds, kde, ims, ime, jms, jme, kms, kme, &amp;<a name='2774'>
                                   max(grid%i_start(ij),ids+sz),          &amp;<a name='2775'>
                                   min(grid%i_end(ij),ide-1-sz),          &amp;<a name='2776'>
                                   max(grid%j_start(ij),jds+sz),          &amp;<a name='2777'>
                                   min(grid%j_end(ij),jde-1-sz),k_start    , k_end               )<a name='2778'>
BENCH_END(moist_physics_prep_tim)<a name='2779'>
<a name='2780'>
<a name='2781'>
    CALL <A href='../../html_code/phys/module_mp_nconvp.F.html#G_LSCOND'>g_lscond</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_LSCOND_3"> ( t_2,g_t_2,p_phy,g_p_phy,moist_2(ims,kms,jms,P_QV),    &amp;<a name='2782'>
                    g_moist_2(ims,kms,jms,P_QV),rho,g_rho,                &amp;<a name='2783'>
                    pi_phy,g_pi_phy,r_v,xlv,cp,ep_2,svp1,svp2,svp3,svpt0, &amp;<a name='2784'>
                    dz8w,g_dz8w,rainnc,g_rainnc, &amp;<a name='2785'>
                    rainncv,g_rainncv,ids,ide,jds,jde,kds,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='2786'>
                    max(grid%i_start(ij),ids+sz),          &amp;<a name='2787'>
                    min(grid%i_end(ij),ide-1-sz),          &amp;<a name='2788'>
                    max(grid%j_start(ij),jds+sz),          &amp;<a name='2789'>
                    min(grid%j_end(ij),jde-1-sz),k_start    , min(k_end,kde-1)    )<a name='2790'>
<a name='2791'>
       CALL wrf_debug ( 200 , ' call moist_physics_finish' )<a name='2792'>
BENCH_START(moist_phys_end_tim)<a name='2793'>
<a name='2794'>
       CALL  <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_MOIST_PHYSICS_FINISH_EM'>g_moist_physics_finish_em</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MOIST_PHYSICS_FINISH_EM_1">( t_2, g_t_2, t_1, g_t_1, t0, muts, &amp;<a name='2795'>
                                        g_muts, h_diabatic, g_h_diabatic, dtm, config_flags, &amp;<a name='2796'>
                                        ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, &amp;<a name='2797'>
                                        max(grid%i_start(ij),ids+sz),          &amp;<a name='2798'>
                                        min(grid%i_end(ij),ide-1-sz),          &amp;<a name='2799'>
                                        max(grid%j_start(ij),jds+sz),          &amp;<a name='2800'>
                                        min(grid%j_end(ij),jde-1-sz),k_start    , k_end               )<a name='2801'>
<a name='2802'>
    call <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_CALC_P_RHO_PHI'>g_calc_p_rho_phi</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_CALC_P_RHO_PHI_4">( moist_2,g_moist_2,num_3d_m,al,g_al,alb,mu_2,   &amp;<a name='2803'>
                           g_mu_2,muts,g_muts,ph_2,g_ph_2,p,g_p,pb,t_2,g_t_2,p0,t0,dnw,&amp;<a name='2804'>
                           rdnw,rdn,non_hydrostatic,ide,jde,kde,ims,ime,jms,jme,kms,kme,&amp;<a name='2805'>
                           max(grid%i_start(ij),ids+sz),          &amp;<a name='2806'>
                           min(grid%i_end(ij),ide-1-sz),          &amp;<a name='2807'>
                           max(grid%j_start(ij),jds+sz),          &amp;<a name='2808'>
                           min(grid%j_end(ij),jde-1-sz),k_start    , k_end               )<a name='2809'>
<a name='2810'>
      IF (.not. non_hydrostatic) THEN<a name='2811'>
      call <A href='../../html_code/dyn_em/module_big_step_utilities_em_tl.F.html#G_DIAGNOSE_W'>g_diagnose_w</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_DIAGNOSE_W_4">( ph_tend,g_ph_tend,ph_2,g_ph_2,ph_1,g_ph_1,w_2,   &amp;<a name='2812'>
                         g_w_2,muts,g_muts,dt_rk,u_2,g_u_2,v_2,g_v_2,ht,cf1,cf2,cf3,&amp;<a name='2813'>
                         rdx,rdy,msft,ide,jde,ims,ime,jms,jme,kms,kme,&amp;<a name='2814'>
                         max(grid%i_start(ij),ids+sz),          &amp;<a name='2815'>
                         min(grid%i_end(ij),ide-1-sz),          &amp;<a name='2816'>
                         max(grid%j_start(ij),jds+sz),          &amp;<a name='2817'>
                         min(grid%j_end(ij),jde-1-sz), k_end               )<a name='2818'>
      ENDIF<a name='2819'>
<a name='2820'>
BENCH_END(moist_phys_end_tim)<a name='2821'>
<a name='2822'>
  ENDIF<a name='2823'>
<a name='2824'>
   scalar_tile_loop_2: DO ij = 1 , grid%num_tiles<a name='2825'>
<a name='2826'>
          CALL wrf_debug ( 200 , ' call scalar_tile_loop_2' )<a name='2827'>
<a name='2828'>
     IF ( num_3d_c &gt;= PARAM_FIRST_SCALAR ) then<a name='2829'>
<a name='2830'>
<font color=#447700>!<a name='2831'></font>
<font color=#447700>!  tiled chemistry not here, it is called from solve_interface, and found in chem_driver<a name='2832'></font>
<font color=#447700>!<a name='2833'></font>
<a name='2834'>
     END IF<a name='2835'>
<a name='2836'>
   END DO scalar_tile_loop_2<a name='2837'>
<a name='2838'>
<a name='2839'>
   if(dyn_opt == DYN_EM) then<a name='2840'>
   IF (leapfrog ) THEN<a name='2841'>
<a name='2842'>
    <font color=#447700>! do time filter and switch for the dry variables<a name='2843'></font>
<a name='2844'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2845'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2846'></font>
<a name='2847'>
    DO ij = 1 , grid%num_tiles<a name='2848'>
<a name='2849'>
BENCH_START(time_filt_tim)<a name='2850'>
      call <A href='../../html_code/dyn_em/module_em.F.html#TIME_FILTER'>time_filter</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TIME_FILTER_2">( u_1, u_2, u_save,                 &amp;<a name='2851'>
                        v_1, v_2, v_save,                 &amp;<a name='2852'>
                        w_1, w_2, w_save,                 &amp;<a name='2853'>
                        t_1, t_2, t_save,                 &amp;<a name='2854'>
                        ph_1, ph_2, ph_save,              &amp;<a name='2855'>
                        mu_1, mu_2, mu_save,              &amp;<a name='2856'>
                        epsts,                            &amp;<a name='2857'>
                        ids, ide, jds, jde, kds, kde,     &amp;<a name='2858'>
                        ims, ime, jms, jme, kms, kme,     &amp;<a name='2859'>
                        grid%i_start(ij), grid%i_end(ij), &amp;<a name='2860'>
                        grid%j_start(ij), grid%j_end(ij), &amp;<a name='2861'>
                        k_start    , k_end               )<a name='2862'>
BENCH_END(time_filt_tim)<a name='2863'>
<a name='2864'>
    ENDDO<a name='2865'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='2866'></font>
<a name='2867'>
    END IF<a name='2868'>
    endif<a name='2869'>
<a name='2870'>
   <font color=#447700>!  We're finished except for boundary condition (and patch) update<a name='2871'></font>
<a name='2872'>
   <font color=#447700>! Boundary condition time (or communication time).  At this time, we have<a name='2873'></font>
   <font color=#447700>! implemented periodic and symmetric physical boundary conditions.<a name='2874'></font>
<a name='2875'>
   <font color=#447700>! b.c. routine for data within patch.<a name='2876'></font>
<a name='2877'>
   <font color=#447700>! we need to do both time levels of <a name='2878'></font>
   <font color=#447700>! data because the time filter only works in the physical solution space.<a name='2879'></font>
<a name='2880'>
   <font color=#447700>! First, do patch communications for boundary conditions (periodicity)<a name='2881'></font>
<a name='2882'>
<font color=#447700>!-----------------------------------------------------------<a name='2883'></font>
<font color=#447700>!  Stencils for patch communications  (WCS, 29 June 2001)<a name='2884'></font>
<font color=#447700>!<a name='2885'></font>
<font color=#447700>!  here's where we need a wide comm stencil - these are the <a name='2886'></font>
<font color=#447700>!  uncoupled variables so are used for high order calc in<a name='2887'></font>
<font color=#447700>!  advection and mixong routines.<a name='2888'></font>
<font color=#447700>!<a name='2889'></font>
<font color=#447700>!                              * * * * *<a name='2890'></font>
<font color=#447700>!            *        * * *    * * * * *<a name='2891'></font>
<font color=#447700>!          * + *      * + *    * * + * * <a name='2892'></font>
<font color=#447700>!            *        * * *    * * * * *<a name='2893'></font>
<font color=#447700>!                              * * * * *<a name='2894'></font>
<font color=#447700>!<a name='2895'></font>
<font color=#447700>!   u_1                            x<a name='2896'></font>
<font color=#447700>!   u_2                            x<a name='2897'></font>
<font color=#447700>!   v_1                            x<a name='2898'></font>
<font color=#447700>!   v_2                            x<a name='2899'></font>
<font color=#447700>!   w_1                            x<a name='2900'></font>
<font color=#447700>!   w_2                            x<a name='2901'></font>
<font color=#447700>!   t_1                            x<a name='2902'></font>
<font color=#447700>!   t_2                            x<a name='2903'></font>
<font color=#447700>!  ph_1                            x<a name='2904'></font>
<font color=#447700>!  ph_2                            x<a name='2905'></font>
<font color=#447700>!  tke_1                           x<a name='2906'></font>
<font color=#447700>!  tke_2                           x<a name='2907'></font>
<font color=#447700>!<a name='2908'></font>
<font color=#447700>!    2D variables<a name='2909'></font>
<font color=#447700>!  mu_1     x<a name='2910'></font>
<font color=#447700>!  mu_2     x<a name='2911'></font>
<font color=#447700>!<a name='2912'></font>
<font color=#447700>!    4D variables<a name='2913'></font>
<font color=#447700>!  moist_1                         x<a name='2914'></font>
<font color=#447700>!  moist_2                         x<a name='2915'></font>
<font color=#447700>!   chem_1                         x<a name='2916'></font>
<font color=#447700>!   chem_2                         x<a name='2917'></font>
<font color=#447700>!----------------------------------------------------------<a name='2918'></font>
<a name='2919'>
<a name='2920'>
#ifdef DM_PARALLEL<a name='2921'>
   IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='2922'>
#    include "<A href='../../html_code/include/HALO_EM_D3_3.inc.html'>HALO_EM_D3_3.inc</A>"<A NAME="HALO_EM_D3_3.inc_65"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2923'>
#    include "<A href='../../html_code/include/HALO_EM_TL_D3_3.inc.html'>HALO_EM_TL_D3_3.inc</A>"<A NAME="HALO_EM_TL_D3_3.inc_66"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2924'>
   ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='2925'>
#    include "<A href='../../html_code/include/HALO_EM_D3_5.inc.html'>HALO_EM_D3_5.inc</A>"<A NAME="HALO_EM_D3_5.inc_67"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2926'>
#    include "<A href='../../html_code/include/HALO_EM_TL_D3_5.inc.html'>HALO_EM_TL_D3_5.inc</A>"<A NAME="HALO_EM_TL_D3_5.inc_68"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2927'>
   ELSE <a name='2928'>
     WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='2929'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_57">(TRIM(wrf_err_message))<a name='2930'>
   ENDIF<a name='2931'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_D3.inc.html'>PERIOD_BDY_EM_D3.inc</A>"<A NAME="PERIOD_BDY_EM_D3.inc_69"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2932'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_MOIST.inc.html'>PERIOD_BDY_EM_MOIST.inc</A>"<A NAME="PERIOD_BDY_EM_MOIST.inc_70"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2933'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_CHEM.inc.html'>PERIOD_BDY_EM_CHEM.inc</A>"<A NAME="PERIOD_BDY_EM_CHEM.inc_71"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2934'>
#endif<a name='2935'>
<a name='2936'>
<font color=#447700>!  now set physical b.c on a patch<a name='2937'></font>
<a name='2938'>
BENCH_START(bc_2d_tim)<a name='2939'>
   if(dyn_opt == DYN_EM) then<a name='2940'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='2941'></font>
   <font color=#447700>!$OMP PRIVATE ( ij )<a name='2942'></font>
<a name='2943'>
   tile_bc_loop_2: DO ij = 1 , grid%num_tiles<a name='2944'>
<a name='2945'>
     CALL wrf_debug ( 200 , ' call set_phys_bc_dry_2' )<a name='2946'>
<a name='2947'>
     CALL <A href='../../html_code/dyn_em/module_bc_em.F.html#SET_PHYS_BC_DRY_2'>set_phys_bc_dry_2</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYS_BC_DRY_2_2">( config_flags,                           &amp;<a name='2948'>
                             u_1, u_2, v_1, v_2, w_1, w_2,           &amp;<a name='2949'>
                             t_1, t_2, ph_1, ph_2, mu_1, mu_2,       &amp;<a name='2950'>
                             ids, ide, jds, jde, kds, kde,           &amp;<a name='2951'>
                             ims, ime, jms, jme, kms, kme,           &amp;<a name='2952'>
                             ips, ipe, jps, jpe, kps, kpe,           &amp;<a name='2953'>
                             grid%i_start(ij), grid%i_end(ij),       &amp;<a name='2954'>
                             grid%j_start(ij), grid%j_end(ij),       &amp;<a name='2955'>
                             k_start    , k_end                     )<a name='2956'>
<a name='2957'>
     CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_114">( tke_1(ims,kms,jms), 'p', config_flags,   &amp;<a name='2958'>
                             ids, ide, jds, jde, kds, kde,            &amp;<a name='2959'>
                             ims, ime, jms, jme, kms, kme,            &amp;<a name='2960'>
                             ips, ipe, jps, jpe, kps, kpe,            &amp;<a name='2961'>
                             grid%i_start(ij), grid%i_end(ij),        &amp;<a name='2962'>
                             grid%j_start(ij), grid%j_end(ij),        &amp;<a name='2963'>
                             k_start    , k_end-1                    )<a name='2964'>
     CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_115">( tke_2(ims,kms,jms) , 'p', config_flags,  &amp;<a name='2965'>
                             ids, ide, jds, jde, kds, kde,            &amp;<a name='2966'>
                             ims, ime, jms, jme, kms, kme,            &amp;<a name='2967'>
                             ips, ipe, jps, jpe, kps, kpe,            &amp;<a name='2968'>
                             grid%i_start(ij), grid%i_end(ij),        &amp;<a name='2969'>
                             grid%j_start(ij), grid%j_end(ij),        &amp;<a name='2970'>
                             k_start    , k_end                      )<a name='2971'>
<a name='2972'>
     moisture_loop_bdy_2 : DO im = PARAM_FIRST_SCALAR , num_3d_m<a name='2973'>
<a name='2974'>
       CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_116">( moist_1(ims,kms,jms,im), 'p',           &amp;<a name='2975'>
                               config_flags,                           &amp;<a name='2976'>
                               ids, ide, jds, jde, kds, kde,           &amp;<a name='2977'>
                               ims, ime, jms, jme, kms, kme,           &amp;<a name='2978'>
                               ips, ipe, jps, jpe, kps, kpe,           &amp;<a name='2979'>
                               grid%i_start(ij), grid%i_end(ij),       &amp;<a name='2980'>
                               grid%j_start(ij), grid%j_end(ij),       &amp;<a name='2981'>
                               k_start    , k_end                     )<a name='2982'>
       CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_117">( moist_2(ims,kms,jms,im), 'p',           &amp;<a name='2983'>
                               config_flags,                           &amp;<a name='2984'>
                               ids, ide, jds, jde, kds, kde,           &amp;<a name='2985'>
                               ims, ime, jms, jme, kms, kme,           &amp;<a name='2986'>
                               ips, ipe, jps, jpe, kps, kpe,           &amp;<a name='2987'>
                               grid%i_start(ij), grid%i_end(ij),       &amp;<a name='2988'>
                               grid%j_start(ij), grid%j_end(ij),       &amp;<a name='2989'>
                               k_start    , k_end                     )<a name='2990'>
<a name='2991'>
     END DO moisture_loop_bdy_2<a name='2992'>
<a name='2993'>
     chem_species_bdy_loop_2 : DO ic = PARAM_FIRST_SCALAR , num_3d_c<a name='2994'>
<a name='2995'>
       CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_118">( chem_1(ims,kms,jms,ic), 'p', config_flags,   &amp;<a name='2996'>
                               ids, ide, jds, jde, kds, kde,            &amp;<a name='2997'>
                               ims, ime, jms, jme, kms, kme,            &amp;<a name='2998'>
                               ips, ipe, jps, jpe, kps, kpe,            &amp;<a name='2999'>
                               grid%i_start(ij), grid%i_end(ij),                  &amp;<a name='3000'>
                               grid%j_start(ij), grid%j_end(ij),                  &amp;<a name='3001'>
                               k_start    , k_end                    )<a name='3002'>
       CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_119">( chem_2(ims,kms,jms,ic) , 'p', config_flags,  &amp;<a name='3003'>
                               ids, ide, jds, jde, kds, kde,            &amp;<a name='3004'>
                               ims, ime, jms, jme, kms, kme,            &amp;<a name='3005'>
                               ips, ipe, jps, jpe, kps, kpe,            &amp;<a name='3006'>
                               grid%i_start(ij), grid%i_end(ij),                  &amp;<a name='3007'>
                               grid%j_start(ij), grid%j_end(ij),                  &amp;<a name='3008'>
                               k_start    , k_end                      )<a name='3009'>
<a name='3010'>
     END DO chem_species_bdy_loop_2<a name='3011'>
<a name='3012'>
   END DO tile_bc_loop_2<a name='3013'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='3014'></font>
   endif<a name='3015'>
BENCH_END(bc_2d_tim)<a name='3016'>
<a name='3017'>
   IF( config_flags%specified .or. config_flags%nested ) THEN <a name='3018'>
     dtbc = dtbc + dt<a name='3019'>
   ENDIF<a name='3020'>
<a name='3021'>
#ifdef DM_PARALLEL<a name='3022'>
<font color=#447700>!-----------------------------------------------------------------------<a name='3023'></font>
<font color=#447700>! see above<a name='3024'></font>
<font color=#447700>!--------------------------------------------------------------<a name='3025'></font>
   CALL wrf_debug ( 200 , ' call HALO_RK_E' )<a name='3026'>
   IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='3027'>
#    include "<A href='../../html_code/include/HALO_EM_E_3.inc.html'>HALO_EM_E_3.inc</A>"<A NAME="HALO_EM_E_3.inc_72"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3028'>
#    include "<A href='../../html_code/include/HALO_EM_TL_E_3.inc.html'>HALO_EM_TL_E_3.inc</A>"<A NAME="HALO_EM_TL_E_3.inc_73"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3029'>
   ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='3030'>
#    include "<A href='../../html_code/include/HALO_EM_E_5.inc.html'>HALO_EM_E_5.inc</A>"<A NAME="HALO_EM_E_5.inc_74"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3031'>
#    include "<A href='../../html_code/include/HALO_EM_TL_E_5.inc.html'>HALO_EM_TL_E_5.inc</A>"<A NAME="HALO_EM_TL_E_5.inc_75"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3032'>
   ELSE<a name='3033'>
     WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='3034'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_58">(TRIM(wrf_err_message))<a name='3035'>
   ENDIF<a name='3036'>
#endif<a name='3037'>
<a name='3038'>
#ifdef DM_PARALLEL<a name='3039'>
   if ( num_moist &gt;= PARAM_FIRST_SCALAR  ) then<a name='3040'>
<font color=#447700>!-----------------------------------------------------------------------<a name='3041'></font>
<font color=#447700>! see above<a name='3042'></font>
<font color=#447700>!--------------------------------------------------------------<a name='3043'></font>
     CALL wrf_debug ( 200 , ' call HALO_RK_MOIST' )<a name='3044'>
     IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='3045'>
#      include "<A href='../../html_code/include/HALO_EM_MOIST_E_3.inc.html'>HALO_EM_MOIST_E_3.inc</A>"<A NAME="HALO_EM_MOIST_E_3.inc_76"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3046'>
#      include "<A href='../../html_code/include/HALO_EM_MOIST_TL_E_3.inc.html'>HALO_EM_MOIST_TL_E_3.inc</A>"<A NAME="HALO_EM_MOIST_TL_E_3.inc_77"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3047'>
     ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='3048'>
#      include "<A href='../../html_code/include/HALO_EM_MOIST_E_5.inc.html'>HALO_EM_MOIST_E_5.inc</A>"<A NAME="HALO_EM_MOIST_E_5.inc_78"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3049'>
#      include "<A href='../../html_code/include/HALO_EM_MOIST_TL_E_5.inc.html'>HALO_EM_MOIST_TL_E_5.inc</A>"<A NAME="HALO_EM_MOIST_TL_E_5.inc_79"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3050'>
     ELSE<a name='3051'>
       WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='3052'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_59">(TRIM(wrf_err_message))<a name='3053'>
     ENDIF<a name='3054'>
   endif<a name='3055'>
   if ( num_chem &gt;= PARAM_FIRST_SCALAR ) then<a name='3056'>
<font color=#447700>!-----------------------------------------------------------------------<a name='3057'></font>
<font color=#447700>! see above<a name='3058'></font>
<font color=#447700>!--------------------------------------------------------------<a name='3059'></font>
     CALL wrf_debug ( 200 , ' call HALO_RK_CHEM' )<a name='3060'>
     IF      ( h_mom_adv_order &lt;= 4 ) THEN<a name='3061'>
#      include "<A href='../../html_code/include/HALO_EM_CHEM_E_3.inc.html'>HALO_EM_CHEM_E_3.inc</A>"<A NAME="HALO_EM_CHEM_E_3.inc_80"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3062'>
     ELSE IF ( h_mom_adv_order &lt;= 6 ) THEN<a name='3063'>
#      include "<A href='../../html_code/include/HALO_EM_CHEM_E_5.inc.html'>HALO_EM_CHEM_E_5.inc</A>"<A NAME="HALO_EM_CHEM_E_5.inc_81"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3064'>
     ELSE<a name='3065'>
       WRITE(wrf_err_message,*)'solve_em_tl: invalid h_mom_adv_order = ',h_mom_adv_order<a name='3066'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_60">(TRIM(wrf_err_message))<a name='3067'>
     ENDIF<a name='3068'>
   endif<a name='3069'>
#endif<a name='3070'>
<a name='3071'>
   CALL wrf_debug ( 200 , ' call end of solve_em_tl' )<a name='3072'>
<a name='3073'>
<font color=#447700>! Finish timers if compiled with -DBENCH.<a name='3074'></font>
#include &lt;<A href='../../html_code/include/bench_solve_em_end.h.html'>bench_solve_em_end.h</A>&gt;<A NAME="bench_solve_em_end.h_82"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3075'>
<a name='3076'>
<font color=#447700>! See comment before earlier #include of this file.<a name='3077'></font>
#define COPY_OUT<a name='3078'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_83"><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3079'>
<a name='3080'>
<font color=#447700>!----------------<a name='3081'></font>
<a name='3082'>
   if(grid%trace_use) call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/solve_em_tl.F.html#SOLVE_EM_TL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_105">("solve_em_tl")<a name='3083'>
<a name='3084'>
   RETURN<a name='3085'>
<a name='3086'>
END SUBROUTINE solve_em_tl<a name='3087'>
<a name='3088'>
</pre></body></html>