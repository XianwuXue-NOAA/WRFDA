<HTML> <BODY BGCOLOR=#cceeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!                           DISCLAIMER<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<font color=#447700>!   This file was generated by TAF version 1.7.18<a name='4'></font>
<font color=#447700>!<a name='5'></font>
<font color=#447700>!   FASTOPT DISCLAIMS  ALL  WARRANTIES,  EXPRESS  OR  IMPLIED,<a name='6'></font>
<font color=#447700>!   INCLUDING (WITHOUT LIMITATION) ALL IMPLIED  WARRANTIES  OF<a name='7'></font>
<font color=#447700>!   MERCHANTABILITY  OR FITNESS FOR A PARTICULAR PURPOSE, WITH<a name='8'></font>
<font color=#447700>!   RESPECT TO THE SOFTWARE AND USER PROGRAMS.   IN  NO  EVENT<a name='9'></font>
<font color=#447700>!   SHALL  FASTOPT BE LIABLE FOR ANY LOST OR ANTICIPATED PROF-<a name='10'></font>
<font color=#447700>!   ITS, OR ANY INDIRECT, INCIDENTAL, EXEMPLARY,  SPECIAL,  OR<a name='11'></font>
<font color=#447700>!   CONSEQUENTIAL  DAMAGES, WHETHER OR NOT FASTOPT WAS ADVISED<a name='12'></font>
<font color=#447700>!   OF THE POSSIBILITY OF SUCH DAMAGES.<a name='13'></font>
<font color=#447700>!<a name='14'></font>
<font color=#447700>!                           Haftungsbeschraenkung<a name='15'></font>
<font color=#447700>!   FastOpt gibt ausdruecklich keine Gewaehr, explizit oder indirekt,<a name='16'></font>
<font color=#447700>!   bezueglich der Brauchbarkeit  der Software  fuer einen bestimmten<a name='17'></font>
<font color=#447700>!   Zweck.   Unter  keinen  Umstaenden   ist  FastOpt   haftbar  fuer<a name='18'></font>
<font color=#447700>!   irgendeinen Verlust oder nicht eintretenden erwarteten Gewinn und<a name='19'></font>
<font color=#447700>!   allen indirekten,  zufaelligen,  exemplarischen  oder  speziellen<a name='20'></font>
<font color=#447700>!   Schaeden  oder  Folgeschaeden  unabhaengig  von einer eventuellen<a name='21'></font>
<font color=#447700>!   Mitteilung darueber an FastOpt.<a name='22'></font>
<font color=#447700>!<a name='23'></font>
<A NAME='G_MODULE_ADVECT_EM'><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_MODULE_ADVECT_EM' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='24'>
<font color=#993300>module     </font><font color=#cc0000>g_module_advect_em</font> <A href='../../call_to/G_MODULE_ADVECT_EM.html' TARGET='index'>2</A><a name='25'>
<font color=#447700>!******************************************************************<a name='26'></font>
<font color=#447700>!******************************************************************<a name='27'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='28'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='29'></font>
<font color=#447700>!******************************************************************<a name='30'></font>
<font color=#447700>!******************************************************************<a name='31'></font>
<font color=#447700>!==============================================<a name='32'></font>
<font color=#447700>! referencing used modules<a name='33'></font>
<font color=#447700>!==============================================<a name='34'></font>
use <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#module_advect_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_4"><a name='35'>
use <A href='../../html_code/dyn_em/module_bc_tl.F.html#G_MODULE_BC'>g_module_bc</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#module_advect_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="G_MODULE_BC_1"><a name='36'>
use <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#module_advect_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_3"><a name='37'>
use <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#module_advect_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_3"><a name='38'>
use <A href='../../html_code/dyn_em/module_advect_em.F.html#MODULE_ADVECT_EM'>module_advect_em</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#module_advect_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ADVECT_EM_2"><a name='39'>
<a name='40'>
USE <A href='../../html_code/frame/module_trace.F.html#MODULE_TRACE'>module_trace</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#module_advect_em_tl.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TRACE_3">, only : trace_entry, trace_exit<a name='41'>
<a name='42'>
<font color=#447700>!==============================================<a name='43'></font>
<font color=#447700>! all entries are defined explicitly<a name='44'></font>
<font color=#447700>!==============================================<a name='45'></font>
implicit none<a name='46'>
<a name='47'>
contains<a name='48'>
<a name='49'>
<A NAME='G_ADVECT_SCALAR'><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_SCALAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='50'>
<font color=#993300>subroutine </font><font color=#cc0000>g_advect_scalar</font>( field, g_field, field_old, g_field_old, tendency, g_tendency, ru, g_ru, rv, g_rv, rom, g_rom, &amp; <A href='../../call_to/G_ADVECT_SCALAR.html' TARGET='index'>6</A>,<A href='../../call_from/G_ADVECT_SCALAR.html' TARGET='index'>2</A><a name='51'>
&amp;config_flags, msft, fzm, fzp, rdx, rdy, rdzw, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='52'>
<font color=#447700>!******************************************************************<a name='53'></font>
<font color=#447700>!******************************************************************<a name='54'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='55'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='56'></font>
<font color=#447700>!******************************************************************<a name='57'></font>
<font color=#447700>!******************************************************************<a name='58'></font>
<font color=#447700>!==============================================<a name='59'></font>
<font color=#447700>! all entries are defined explicitly<a name='60'></font>
<font color=#447700>!==============================================<a name='61'></font>
implicit none<a name='62'>
<a name='63'>
<font color=#447700>!==============================================<a name='64'></font>
<font color=#447700>! declare arguments<a name='65'></font>
<font color=#447700>!==============================================<a name='66'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='67'>
integer, intent(in) :: ime<a name='68'>
integer, intent(in) :: ims<a name='69'>
integer, intent(in) :: jme<a name='70'>
integer, intent(in) :: jms<a name='71'>
integer, intent(in) :: kme<a name='72'>
integer, intent(in) :: kms<a name='73'>
real, intent(in) :: field(ims:ime,kms:kme,jms:jme)<a name='74'>
real, intent(in) :: field_old(ims:ime,kms:kme,jms:jme)<a name='75'>
real, intent(in) :: fzm(kms:kme)<a name='76'>
real, intent(in) :: fzp(kms:kme)<a name='77'>
real, intent(in) :: g_field(ims:ime,kms:kme,jms:jme)<a name='78'>
real, intent(in) :: g_field_old(ims:ime,kms:kme,jms:jme)<a name='79'>
real, intent(in) :: g_rom(ims:ime,kms:kme,jms:jme)<a name='80'>
real, intent(in) :: g_ru(ims:ime,kms:kme,jms:jme)<a name='81'>
real, intent(in) :: g_rv(ims:ime,kms:kme,jms:jme)<a name='82'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='83'>
integer, intent(in) :: ide<a name='84'>
integer, intent(in) :: ids<a name='85'>
integer, intent(in) :: ite<a name='86'>
integer, intent(in) :: its<a name='87'>
integer, intent(in) :: jde<a name='88'>
integer, intent(in) :: jds<a name='89'>
integer, intent(in) :: jte<a name='90'>
integer, intent(in) :: jts<a name='91'>
integer, intent(in) :: kde<a name='92'>
integer, intent(in) :: kte<a name='93'>
integer, intent(in) :: kts<a name='94'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='95'>
real, intent(in) :: rdx<a name='96'>
real, intent(in) :: rdy<a name='97'>
real, intent(in) :: rdzw(kms:kme)<a name='98'>
real, intent(in) :: rom(ims:ime,kms:kme,jms:jme)<a name='99'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='100'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='101'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='102'>
<a name='103'>
<font color=#447700>!==============================================<a name='104'></font>
<font color=#447700>! declare local variables<a name='105'></font>
<font color=#447700>!==============================================<a name='106'></font>
logical degrade_xe<a name='107'>
logical degrade_xs<a name='108'>
logical degrade_ye<a name='109'>
logical degrade_ys<a name='110'>
real fqx(its:ite+1,kts:kte)<a name='111'>
real fqy(its:ite,kts:kte,2)<a name='112'>
real g_fqx(its:ite+1,kts:kte)<a name='113'>
real g_fqy(its:ite,kts:kte,2)<a name='114'>
real g_ub<a name='115'>
real g_vb<a name='116'>
real g_vel<a name='117'>
real g_vflux(its:ite,kts:kte)<a name='118'>
integer horz_order<a name='119'>
integer i<a name='120'>
integer i_end<a name='121'>
integer i_end_f<a name='122'>
integer i_start<a name='123'>
integer i_start_f<a name='124'>
integer j<a name='125'>
integer j_end<a name='126'>
integer j_end_f<a name='127'>
integer j_start<a name='128'>
integer j_start_f<a name='129'>
integer jp0<a name='130'>
integer jp1<a name='131'>
integer jtmp<a name='132'>
integer k<a name='133'>
integer ktf<a name='134'>
real mrdx<a name='135'>
real mrdy<a name='136'>
logical specified<a name='137'>
real ub<a name='138'>
real vb<a name='139'>
real vel<a name='140'>
integer vert_order<a name='141'>
real vflux(its:ite,kts:kte)<a name='142'>
<a name='143'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_SCALAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_6">("g_advect_scalar")<a name='144'>
<a name='145'>
<font color=#447700>!----------------------------------------------<a name='146'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='147'></font>
<font color=#447700>!----------------------------------------------<a name='148'></font>
specified =  .false. <a name='149'>
if (config_flags%specified .or. config_flags%nested) then<a name='150'>
  specified =  .true. <a name='151'>
endif<a name='152'>
ktf = min(kte,kde-1)<a name='153'>
horz_order = config_flags%h_sca_adv_order<a name='154'>
vert_order = config_flags%v_sca_adv_order<a name='155'>
horizontal_order_tesu: if (horz_order .eq. 6) then<a name='156'>
  degrade_xs =  .true. <a name='157'>
  degrade_xe =  .true. <a name='158'>
  degrade_ys =  .true. <a name='159'>
  degrade_ye =  .true. <a name='160'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+2) then<a name='161'>
    degrade_xs =  .false. <a name='162'>
  endif<a name='163'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-3) then<a name='164'>
    degrade_xe =  .false. <a name='165'>
  endif<a name='166'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+2) then<a name='167'>
    degrade_ys =  .false. <a name='168'>
  endif<a name='169'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-3) then<a name='170'>
    degrade_ye =  .false. <a name='171'>
  endif<a name='172'>
  ktf = min(kte,kde-1)<a name='173'>
  i_start = its<a name='174'>
  i_end = min(ite,ide-1)<a name='175'>
  j_start = jts<a name='176'>
  j_end = min(jte,jde-1)<a name='177'>
  j_start_f = j_start<a name='178'>
  j_end_f = j_end+1<a name='179'>
  if (degrade_ys) then<a name='180'>
    j_start = max(jts,jds+1)<a name='181'>
    j_start_f = jds+3<a name='182'>
  endif<a name='183'>
  if (degrade_ye) then<a name='184'>
    j_end = min(jte,jde-2)<a name='185'>
    j_end_f = jde-3<a name='186'>
  endif<a name='187'>
  jp1 = 2<a name='188'>
  jp0 = 1<a name='189'>
  j_loop_y_flux_6: do j = j_start, j_end+1<a name='190'>
    if (j .ge. j_start_f .and. j .le. j_end_f) then<a name='191'>
      do k = kts, ktf<a name='192'>
        do i = i_start, i_end<a name='193'>
          g_vel = g_rv(i,k,j)<a name='194'>
          vel = rv(i,k,j)<a name='195'>
          g_fqy(i,k,jp1) = 0.016666667*g_field(i,k,j-3)*vel-0.13333333*g_field(i,k,j-2)*vel+0.61666667*g_field(i,k,j-1)*vel+&amp;<a name='196'>
&amp;0.016666667*g_field(i,k,j+2)*vel-0.13333333*g_field(i,k,j+1)*vel+0.61666667*g_field(i,k,j)*vel+g_vel*(0.61666667*&amp;<a name='197'>
&amp;(field(i,k,j)+field(i,k,j-1))-0.13333333*(field(i,k,j+1)+field(i,k,j-2))+0.016666667*(field(i,k,j+2)+field(i,k,j-3)))<a name='198'>
          fqy(i,k,jp1) = vel*(37./60.*(field(i,k,j)+field(i,k,j-1))-2./15.*(field(i,k,j+1)+field(i,k,j-2))+1./60.*(field(i,k,j+2)+&amp;<a name='199'>
&amp;field(i,k,j-3)))<a name='200'>
        end do<a name='201'>
      end do<a name='202'>
    else if (j .eq. jds+1) then<a name='203'>
      do k = kts, ktf<a name='204'>
        do i = i_start, i_end<a name='205'>
          g_fqy(i,k,jp1) = 0.5*g_field(i,k,j-1)*rv(i,k,j)+0.5*g_field(i,k,j)*rv(i,k,j)+0.5*g_rv(i,k,j)*(field(i,k,j)+field(i,k,j-1))<a name='206'>
          fqy(i,k,jp1) = 0.5*rv(i,k,j)*(field(i,k,j)+field(i,k,j-1))<a name='207'>
        end do<a name='208'>
      end do<a name='209'>
    else if (j .eq. jds+2) then<a name='210'>
      do k = kts, ktf<a name='211'>
        do i = i_start, i_end<a name='212'>
          g_vel = g_rv(i,k,j)<a name='213'>
          vel = rv(i,k,j)<a name='214'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_field(i,k,j-2)*vel+0.58333333*g_field(i,k,j-1)*vel-0.083333333*g_field(i,k,j+1)*vel+&amp;<a name='215'>
&amp;0.58333333*g_field(i,k,j)*vel+g_vel*(0.58333333*(field(i,k,j)+field(i,k,j-1))-0.083333333*(field(i,k,j+1)+field(i,k,j-2)))<a name='216'>
          fqy(i,k,jp1) = vel*(7./12.*(field(i,k,j)+field(i,k,j-1))-1./12.*(field(i,k,j+1)+field(i,k,j-2)))<a name='217'>
        end do<a name='218'>
      end do<a name='219'>
    else if (j .eq. jde-1) then<a name='220'>
      do k = kts, ktf<a name='221'>
        do i = i_start, i_end<a name='222'>
          g_fqy(i,k,jp1) = 0.5*g_field(i,k,j-1)*rv(i,k,j)+0.5*g_field(i,k,j)*rv(i,k,j)+0.5*g_rv(i,k,j)*(field(i,k,j)+field(i,k,j-1))<a name='223'>
          fqy(i,k,jp1) = 0.5*rv(i,k,j)*(field(i,k,j)+field(i,k,j-1))<a name='224'>
        end do<a name='225'>
      end do<a name='226'>
    else if (j .eq. jde-2) then<a name='227'>
      do k = kts, ktf<a name='228'>
        do i = i_start, i_end<a name='229'>
          g_vel = g_rv(i,k,j)<a name='230'>
          vel = rv(i,k,j)<a name='231'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_field(i,k,j-2)*vel+0.58333333*g_field(i,k,j-1)*vel-0.083333333*g_field(i,k,j+1)*vel+&amp;<a name='232'>
&amp;0.58333333*g_field(i,k,j)*vel+g_vel*(0.58333333*(field(i,k,j)+field(i,k,j-1))-0.083333333*(field(i,k,j+1)+field(i,k,j-2)))<a name='233'>
          fqy(i,k,jp1) = vel*(7./12.*(field(i,k,j)+field(i,k,j-1))-1./12.*(field(i,k,j+1)+field(i,k,j-2)))<a name='234'>
        end do<a name='235'>
      end do<a name='236'>
    endif<a name='237'>
    if (j .gt. j_start) then<a name='238'>
      do k = kts, ktf<a name='239'>
        do i = i_start, i_end<a name='240'>
          mrdy = msft(i,j-1)*rdy<a name='241'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='242'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='243'>
        end do<a name='244'>
      end do<a name='245'>
    endif<a name='246'>
    jtmp = jp1<a name='247'>
    jp1 = jp0<a name='248'>
    jp0 = jtmp<a name='249'>
  end do j_loop_y_flux_6<a name='250'>
  i_start = its<a name='251'>
  i_end = min(ite,ide-1)<a name='252'>
  j_start = jts<a name='253'>
  j_end = min(jte,jde-1)<a name='254'>
  i_start_f = i_start<a name='255'>
  i_end_f = i_end+1<a name='256'>
  if (degrade_xs) then<a name='257'>
    i_start = max(ids+1,its)<a name='258'>
    i_start_f = i_start+2<a name='259'>
  endif<a name='260'>
  if (degrade_xe) then<a name='261'>
    i_end = min(ide-2,ite)<a name='262'>
    i_end_f = ide-3<a name='263'>
  endif<a name='264'>
  do j = j_start, j_end<a name='265'>
    do k = kts, ktf<a name='266'>
      do i = i_start_f, i_end_f<a name='267'>
        g_vel = g_ru(i,k,j)<a name='268'>
        vel = ru(i,k,j)<a name='269'>
        g_fqx(i,k) = 0.016666667*g_field(i-3,k,j)*vel-0.13333333*g_field(i-2,k,j)*vel+0.61666667*g_field(i-1,k,j)*vel+0.016666667*&amp;<a name='270'>
&amp;g_field(i+2,k,j)*vel-0.13333333*g_field(i+1,k,j)*vel+0.61666667*g_field(i,k,j)*vel+g_vel*(0.61666667*(field(i,k,j)+&amp;<a name='271'>
&amp;field(i-1,k,j))-0.13333333*(field(i+1,k,j)+field(i-2,k,j))+0.016666667*(field(i+2,k,j)+field(i-3,k,j)))<a name='272'>
        fqx(i,k) = vel*(37./60.*(field(i,k,j)+field(i-1,k,j))-2./15.*(field(i+1,k,j)+field(i-2,k,j))+1./60.*(field(i+2,k,j)+&amp;<a name='273'>
&amp;field(i-3,k,j)))<a name='274'>
      end do<a name='275'>
    end do<a name='276'>
    if (degrade_xs) then<a name='277'>
      if (i_start .eq. ids+1) then<a name='278'>
        i = ids+1<a name='279'>
        do k = kts, ktf<a name='280'>
          g_fqx(i,k) = 0.5*g_field(i-1,k,j)*ru(i,k,j)+0.5*g_field(i,k,j)*ru(i,k,j)+0.5*g_ru(i,k,j)*(field(i,k,j)+field(i-1,k,j))<a name='281'>
          fqx(i,k) = 0.5*ru(i,k,j)*(field(i,k,j)+field(i-1,k,j))<a name='282'>
        end do<a name='283'>
      endif<a name='284'>
      i = ids+2<a name='285'>
      do k = kts, ktf<a name='286'>
        g_vel = g_ru(i,k,j)<a name='287'>
        vel = ru(i,k,j)<a name='288'>
        g_fqx(i,k) = (-0.083333333)*g_field(i-2,k,j)*vel+0.58333333*g_field(i-1,k,j)*vel-0.083333333*g_field(i+1,k,j)*vel+&amp;<a name='289'>
&amp;0.58333333*g_field(i,k,j)*vel+g_vel*(0.58333333*(field(i,k,j)+field(i-1,k,j))-0.083333333*(field(i+1,k,j)+field(i-2,k,j)))<a name='290'>
        fqx(i,k) = vel*(7./12.*(field(i,k,j)+field(i-1,k,j))-1./12.*(field(i+1,k,j)+field(i-2,k,j)))<a name='291'>
      end do<a name='292'>
    endif<a name='293'>
    if (degrade_xe) then<a name='294'>
      if (i_end .eq. ide-2) then<a name='295'>
        i = ide-1<a name='296'>
        do k = kts, ktf<a name='297'>
          g_fqx(i,k) = 0.5*g_field(i-1,k,j)*ru(i,k,j)+0.5*g_field(i,k,j)*ru(i,k,j)+0.5*g_ru(i,k,j)*(field(i,k,j)+field(i-1,k,j))<a name='298'>
          fqx(i,k) = 0.5*ru(i,k,j)*(field(i,k,j)+field(i-1,k,j))<a name='299'>
        end do<a name='300'>
      endif<a name='301'>
      i = ide-2<a name='302'>
      do k = kts, ktf<a name='303'>
        g_vel = g_ru(i,k,j)<a name='304'>
        vel = ru(i,k,j)<a name='305'>
        g_fqx(i,k) = (-0.083333333)*g_field(i-2,k,j)*vel+0.58333333*g_field(i-1,k,j)*vel-0.083333333*g_field(i+1,k,j)*vel+&amp;<a name='306'>
&amp;0.58333333*g_field(i,k,j)*vel+g_vel*(0.58333333*(field(i,k,j)+field(i-1,k,j))-0.083333333*(field(i+1,k,j)+field(i-2,k,j)))<a name='307'>
        fqx(i,k) = vel*(7./12.*(field(i,k,j)+field(i-1,k,j))-1./12.*(field(i+1,k,j)+field(i-2,k,j)))<a name='308'>
      end do<a name='309'>
    endif<a name='310'>
    do k = kts, ktf<a name='311'>
      do i = i_start, i_end<a name='312'>
        mrdx = msft(i,j)*rdx<a name='313'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='314'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='315'>
      end do<a name='316'>
    end do<a name='317'>
  end do<a name='318'>
else if (horz_order .eq. 5) then horizontal_order_tesu<a name='319'>
  degrade_xs =  .true. <a name='320'>
  degrade_xe =  .true. <a name='321'>
  degrade_ys =  .true. <a name='322'>
  degrade_ye =  .true. <a name='323'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+2) then<a name='324'>
    degrade_xs =  .false. <a name='325'>
  endif<a name='326'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-3) then<a name='327'>
    degrade_xe =  .false. <a name='328'>
  endif<a name='329'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+2) then<a name='330'>
    degrade_ys =  .false. <a name='331'>
  endif<a name='332'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-3) then<a name='333'>
    degrade_ye =  .false. <a name='334'>
  endif<a name='335'>
  ktf = min(kte,kde-1)<a name='336'>
  i_start = its<a name='337'>
  i_end = min(ite,ide-1)<a name='338'>
  j_start = jts<a name='339'>
  j_end = min(jte,jde-1)<a name='340'>
  j_start_f = j_start<a name='341'>
  j_end_f = j_end+1<a name='342'>
  if (degrade_ys) then<a name='343'>
    j_start = max(jts,jds+1)<a name='344'>
    j_start_f = jds+3<a name='345'>
  endif<a name='346'>
  if (degrade_ye) then<a name='347'>
    j_end = min(jte,jde-2)<a name='348'>
    j_end_f = jde-3<a name='349'>
  endif<a name='350'>
  jp1 = 2<a name='351'>
  jp0 = 1<a name='352'>
  j_loop_y_flux_5: do j = j_start, j_end+1<a name='353'>
    if (j .ge. j_start_f .and. j .le. j_end_f) then<a name='354'>
      do k = kts, ktf<a name='355'>
        do i = i_start, i_end<a name='356'>
          g_vel = g_rv(i,k,j)<a name='357'>
          vel = rv(i,k,j)<a name='358'>
          g_fqy(i,k,jp1) = g_field(i,k,j-3)*vel*(0.016666667-(-0.016666667)*sign(1.,vel))+g_field(i,k,j-2)*vel*((-0.13333333)-&amp;<a name='359'>
&amp;0.083333333*sign(1.,vel))+g_field(i,k,j-1)*vel*(0.61666667-(-0.16666667)*sign(1.,vel))+g_field(i,k,j+2)*vel*&amp;<a name='360'>
&amp;(0.016666667-0.016666667*sign(1.,vel))+g_field(i,k,j+1)*vel*((-0.13333333)-(-0.083333333)*sign(1.,vel))+g_field(i,k,j)*&amp;<a name='361'>
&amp;vel*(0.61666667-0.16666667*sign(1.,vel))+g_vel*(0.61666667*(field(i,k,j)+field(i,k,j-1))-0.13333333*(field(i,k,j+1)+&amp;<a name='362'>
&amp;field(i,k,j-2))+0.016666667*(field(i,k,j+2)+field(i,k,j-3))-0.016666667*(field(i,k,j+2)-field(i,k,j-3)-5.*(field(i,k,j+&amp;<a name='363'>
&amp;1)-field(i,k,j-2))+10.*(field(i,k,j)-field(i,k,j-1)))*sign(1.,vel))<a name='364'>
          fqy(i,k,jp1) = vel*(37./60.*(field(i,k,j)+field(i,k,j-1))-2./15.*(field(i,k,j+1)+field(i,k,j-2))+1./60.*(field(i,k,j+2)+&amp;<a name='365'>
&amp;field(i,k,j-3))-sign(1.,vel)*(1./60.)*(field(i,k,j+2)-field(i,k,j-3)-5.*(field(i,k,j+1)-field(i,k,j-2))+10.*(field(i,k,&amp;<a name='366'>
&amp;j)-field(i,k,j-1))))<a name='367'>
        end do<a name='368'>
      end do<a name='369'>
    else if (j .eq. jds+1) then<a name='370'>
      do k = kts, ktf<a name='371'>
        do i = i_start, i_end<a name='372'>
          g_fqy(i,k,jp1) = 0.5*g_field(i,k,j-1)*rv(i,k,j)+0.5*g_field(i,k,j)*rv(i,k,j)+0.5*g_rv(i,k,j)*(field(i,k,j)+field(i,k,j-1))<a name='373'>
          fqy(i,k,jp1) = 0.5*rv(i,k,j)*(field(i,k,j)+field(i,k,j-1))<a name='374'>
        end do<a name='375'>
      end do<a name='376'>
    else if (j .eq. jds+2) then<a name='377'>
      do k = kts, ktf<a name='378'>
        do i = i_start, i_end<a name='379'>
          g_vel = g_rv(i,k,j)<a name='380'>
          vel = rv(i,k,j)<a name='381'>
          g_fqy(i,k,jp1) = g_field(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_field(i,k,j-1)*vel*(0.58333333+0.25*&amp;<a name='382'>
&amp;sign(1.,vel))+g_field(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_field(i,k,j)*vel*(0.58333333+(-0.25)*&amp;<a name='383'>
&amp;sign(1.,vel))+g_vel*(0.58333333*(field(i,k,j)+field(i,k,j-1))-0.083333333*(field(i,k,j+1)+field(i,k,j-2))+0.083333333*&amp;<a name='384'>
&amp;(field(i,k,j+1)-field(i,k,j-2)-3.*(field(i,k,j)-field(i,k,j-1)))*sign(1.,vel))<a name='385'>
          fqy(i,k,jp1) = vel*(7./12.*(field(i,k,j)+field(i,k,j-1))-1./12.*(field(i,k,j+1)+field(i,k,j-2))+sign(1.,vel)*(1./12.)*&amp;<a name='386'>
&amp;(field(i,k,j+1)-field(i,k,j-2)-3.*(field(i,k,j)-field(i,k,j-1))))<a name='387'>
        end do<a name='388'>
      end do<a name='389'>
    else if (j .eq. jde-1) then<a name='390'>
      do k = kts, ktf<a name='391'>
        do i = i_start, i_end<a name='392'>
          g_fqy(i,k,jp1) = 0.5*g_field(i,k,j-1)*rv(i,k,j)+0.5*g_field(i,k,j)*rv(i,k,j)+0.5*g_rv(i,k,j)*(field(i,k,j)+field(i,k,j-1))<a name='393'>
          fqy(i,k,jp1) = 0.5*rv(i,k,j)*(field(i,k,j)+field(i,k,j-1))<a name='394'>
        end do<a name='395'>
      end do<a name='396'>
    else if (j .eq. jde-2) then<a name='397'>
      do k = kts, ktf<a name='398'>
        do i = i_start, i_end<a name='399'>
          g_vel = g_rv(i,k,j)<a name='400'>
          vel = rv(i,k,j)<a name='401'>
          g_fqy(i,k,jp1) = g_field(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_field(i,k,j-1)*vel*(0.58333333+0.25*&amp;<a name='402'>
&amp;sign(1.,vel))+g_field(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_field(i,k,j)*vel*(0.58333333+(-0.25)*&amp;<a name='403'>
&amp;sign(1.,vel))+g_vel*(0.58333333*(field(i,k,j)+field(i,k,j-1))-0.083333333*(field(i,k,j+1)+field(i,k,j-2))+0.083333333*&amp;<a name='404'>
&amp;(field(i,k,j+1)-field(i,k,j-2)-3.*(field(i,k,j)-field(i,k,j-1)))*sign(1.,vel))<a name='405'>
          fqy(i,k,jp1) = vel*(7./12.*(field(i,k,j)+field(i,k,j-1))-1./12.*(field(i,k,j+1)+field(i,k,j-2))+sign(1.,vel)*(1./12.)*&amp;<a name='406'>
&amp;(field(i,k,j+1)-field(i,k,j-2)-3.*(field(i,k,j)-field(i,k,j-1))))<a name='407'>
        end do<a name='408'>
      end do<a name='409'>
    endif<a name='410'>
    if (j .gt. j_start) then<a name='411'>
      do k = kts, ktf<a name='412'>
        do i = i_start, i_end<a name='413'>
          mrdy = msft(i,j-1)*rdy<a name='414'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='415'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='416'>
        end do<a name='417'>
      end do<a name='418'>
    endif<a name='419'>
    jtmp = jp1<a name='420'>
    jp1 = jp0<a name='421'>
    jp0 = jtmp<a name='422'>
  end do j_loop_y_flux_5<a name='423'>
  i_start = its<a name='424'>
  i_end = min(ite,ide-1)<a name='425'>
  j_start = jts<a name='426'>
  j_end = min(jte,jde-1)<a name='427'>
  i_start_f = i_start<a name='428'>
  i_end_f = i_end+1<a name='429'>
  if (degrade_xs) then<a name='430'>
    i_start = max(ids+1,its)<a name='431'>
    i_start_f = i_start+2<a name='432'>
  endif<a name='433'>
  if (degrade_xe) then<a name='434'>
    i_end = min(ide-2,ite)<a name='435'>
    i_end_f = ide-3<a name='436'>
  endif<a name='437'>
  do j = j_start, j_end<a name='438'>
    do k = kts, ktf<a name='439'>
      do i = i_start_f, i_end_f<a name='440'>
        g_vel = g_ru(i,k,j)<a name='441'>
        vel = ru(i,k,j)<a name='442'>
        g_fqx(i,k) = g_field(i-3,k,j)*vel*(0.016666667-(-0.016666667)*sign(1.,vel))+g_field(i-2,k,j)*vel*((-0.13333333)-&amp;<a name='443'>
&amp;0.083333333*sign(1.,vel))+g_field(i-1,k,j)*vel*(0.61666667-(-0.16666667)*sign(1.,vel))+g_field(i+2,k,j)*vel*(0.016666667-&amp;<a name='444'>
&amp;0.016666667*sign(1.,vel))+g_field(i+1,k,j)*vel*((-0.13333333)-(-0.083333333)*sign(1.,vel))+g_field(i,k,j)*vel*(0.61666667-&amp;<a name='445'>
&amp;0.16666667*sign(1.,vel))+g_vel*(0.61666667*(field(i,k,j)+field(i-1,k,j))-0.13333333*(field(i+1,k,j)+field(i-2,k,j))+&amp;<a name='446'>
&amp;0.016666667*(field(i+2,k,j)+field(i-3,k,j))-0.016666667*(field(i+2,k,j)-field(i-3,k,j)-5.*(field(i+1,k,j)-field(i-2,k,j))+&amp;<a name='447'>
&amp;10.*(field(i,k,j)-field(i-1,k,j)))*sign(1.,vel))<a name='448'>
        fqx(i,k) = vel*(37./60.*(field(i,k,j)+field(i-1,k,j))-2./15.*(field(i+1,k,j)+field(i-2,k,j))+1./60.*(field(i+2,k,j)+&amp;<a name='449'>
&amp;field(i-3,k,j))-sign(1.,vel)*(1./60.)*(field(i+2,k,j)-field(i-3,k,j)-5.*(field(i+1,k,j)-field(i-2,k,j))+10.*(field(i,k,j)-&amp;<a name='450'>
&amp;field(i-1,k,j))))<a name='451'>
      end do<a name='452'>
    end do<a name='453'>
    if (degrade_xs) then<a name='454'>
      if (i_start .eq. ids+1) then<a name='455'>
        i = ids+1<a name='456'>
        do k = kts, ktf<a name='457'>
          g_fqx(i,k) = 0.5*g_field(i-1,k,j)*ru(i,k,j)+0.5*g_field(i,k,j)*ru(i,k,j)+0.5*g_ru(i,k,j)*(field(i,k,j)+field(i-1,k,j))<a name='458'>
          fqx(i,k) = 0.5*ru(i,k,j)*(field(i,k,j)+field(i-1,k,j))<a name='459'>
        end do<a name='460'>
      endif<a name='461'>
      i = ids+2<a name='462'>
      do k = kts, ktf<a name='463'>
        g_vel = g_ru(i,k,j)<a name='464'>
        vel = ru(i,k,j)<a name='465'>
        g_fqx(i,k) = g_field(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_field(i-1,k,j)*vel*(0.58333333+0.25*&amp;<a name='466'>
&amp;sign(1.,vel))+g_field(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_field(i,k,j)*vel*(0.58333333+(-0.25)*&amp;<a name='467'>
&amp;sign(1.,vel))+g_vel*(0.58333333*(field(i,k,j)+field(i-1,k,j))-0.083333333*(field(i+1,k,j)+field(i-2,k,j))+0.083333333*&amp;<a name='468'>
&amp;(field(i+1,k,j)-field(i-2,k,j)-3.*(field(i,k,j)-field(i-1,k,j)))*sign(1.,vel))<a name='469'>
        fqx(i,k) = vel*(7./12.*(field(i,k,j)+field(i-1,k,j))-1./12.*(field(i+1,k,j)+field(i-2,k,j))+sign(1.,vel)*(1./12.)*(field(i+&amp;<a name='470'>
&amp;1,k,j)-field(i-2,k,j)-3.*(field(i,k,j)-field(i-1,k,j))))<a name='471'>
      end do<a name='472'>
    endif<a name='473'>
    if (degrade_xe) then<a name='474'>
      if (i_end .eq. ide-2) then<a name='475'>
        i = ide-1<a name='476'>
        do k = kts, ktf<a name='477'>
          g_fqx(i,k) = 0.5*g_field(i-1,k,j)*ru(i,k,j)+0.5*g_field(i,k,j)*ru(i,k,j)+0.5*g_ru(i,k,j)*(field(i,k,j)+field(i-1,k,j))<a name='478'>
          fqx(i,k) = 0.5*ru(i,k,j)*(field(i,k,j)+field(i-1,k,j))<a name='479'>
        end do<a name='480'>
      endif<a name='481'>
      i = ide-2<a name='482'>
      do k = kts, ktf<a name='483'>
        g_vel = g_ru(i,k,j)<a name='484'>
        vel = ru(i,k,j)<a name='485'>
        g_fqx(i,k) = g_field(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_field(i-1,k,j)*vel*(0.58333333+0.25*&amp;<a name='486'>
&amp;sign(1.,vel))+g_field(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_field(i,k,j)*vel*(0.58333333+(-0.25)*&amp;<a name='487'>
&amp;sign(1.,vel))+g_vel*(0.58333333*(field(i,k,j)+field(i-1,k,j))-0.083333333*(field(i+1,k,j)+field(i-2,k,j))+0.083333333*&amp;<a name='488'>
&amp;(field(i+1,k,j)-field(i-2,k,j)-3.*(field(i,k,j)-field(i-1,k,j)))*sign(1.,vel))<a name='489'>
        fqx(i,k) = vel*(7./12.*(field(i,k,j)+field(i-1,k,j))-1./12.*(field(i+1,k,j)+field(i-2,k,j))+sign(1.,vel)*(1./12.)*(field(i+&amp;<a name='490'>
&amp;1,k,j)-field(i-2,k,j)-3.*(field(i,k,j)-field(i-1,k,j))))<a name='491'>
      end do<a name='492'>
    endif<a name='493'>
    do k = kts, ktf<a name='494'>
      do i = i_start, i_end<a name='495'>
        mrdx = msft(i,j)*rdx<a name='496'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='497'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='498'>
      end do<a name='499'>
    end do<a name='500'>
  end do<a name='501'>
else if (horz_order .eq. 4) then horizontal_order_tesu<a name='502'>
  degrade_xs =  .true. <a name='503'>
  degrade_xe =  .true. <a name='504'>
  degrade_ys =  .true. <a name='505'>
  degrade_ye =  .true. <a name='506'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+1) then<a name='507'>
    degrade_xs =  .false. <a name='508'>
  endif<a name='509'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-2) then<a name='510'>
    degrade_xe =  .false. <a name='511'>
  endif<a name='512'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+1) then<a name='513'>
    degrade_ys =  .false. <a name='514'>
  endif<a name='515'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-2) then<a name='516'>
    degrade_ye =  .false. <a name='517'>
  endif<a name='518'>
  ktf = min(kte,kde-1)<a name='519'>
  i_start = its<a name='520'>
  i_end = min(ite,ide-1)<a name='521'>
  j_start = jts<a name='522'>
  j_end = min(jte,jde-1)<a name='523'>
  i_start_f = i_start<a name='524'>
  i_end_f = i_end+1<a name='525'>
  if (degrade_xs) then<a name='526'>
    i_start = ids+1<a name='527'>
    i_start_f = i_start+1<a name='528'>
  endif<a name='529'>
  if (degrade_xe) then<a name='530'>
    i_end = ide-2<a name='531'>
    i_end_f = ide-2<a name='532'>
  endif<a name='533'>
  do j = j_start, j_end<a name='534'>
    do k = kts, ktf<a name='535'>
      do i = i_start_f, i_end_f<a name='536'>
        g_fqx(i,k) = (-0.083333333)*g_field(i-2,k,j)*ru(i,k,j)+0.58333333*g_field(i-1,k,j)*ru(i,k,j)-0.083333333*g_field(i+1,k,j)*&amp;<a name='537'>
&amp;ru(i,k,j)+0.58333333*g_field(i,k,j)*ru(i,k,j)+g_ru(i,k,j)*(0.58333333*(field(i,k,j)+field(i-1,k,j))-0.083333333*(field(i+&amp;<a name='538'>
&amp;1,k,j)+field(i-2,k,j)))<a name='539'>
        fqx(i,k) = ru(i,k,j)*(7./12.*(field(i,k,j)+field(i-1,k,j))-1./12.*(field(i+1,k,j)+field(i-2,k,j)))<a name='540'>
      end do<a name='541'>
    end do<a name='542'>
    if (degrade_xs) then<a name='543'>
      do k = kts, ktf<a name='544'>
        g_fqx(i_start,k) = 0.5*g_field(i_start-1,k,j)*ru(i_start,k,j)+0.5*g_field(i_start,k,j)*ru(i_start,k,j)+0.5*g_ru(i_start,k,&amp;<a name='545'>
&amp;j)*(field(i_start,k,j)+field(i_start-1,k,j))<a name='546'>
        fqx(i_start,k) = 0.5*ru(i_start,k,j)*(field(i_start,k,j)+field(i_start-1,k,j))<a name='547'>
      end do<a name='548'>
    endif<a name='549'>
    if (degrade_xe) then<a name='550'>
      do k = kts, ktf<a name='551'>
        g_fqx(i_end+1,k) = 0.5*g_field(i_end+1,k,j)*ru(i_end+1,k,j)+0.5*g_field(i_end,k,j)*ru(i_end+1,k,j)+0.5*g_ru(i_end+1,k,j)*&amp;<a name='552'>
&amp;(field(i_end+1,k,j)+field(i_end,k,j))<a name='553'>
        fqx(i_end+1,k) = 0.5*ru(i_end+1,k,j)*(field(i_end+1,k,j)+field(i_end,k,j))<a name='554'>
      end do<a name='555'>
    endif<a name='556'>
    do k = kts, ktf<a name='557'>
      do i = i_start, i_end<a name='558'>
        mrdx = msft(i,j)*rdx<a name='559'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='560'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='561'>
      end do<a name='562'>
    end do<a name='563'>
  end do<a name='564'>
  i_start = its<a name='565'>
  i_end = min(ite,ide-1)<a name='566'>
  j_start = jts<a name='567'>
  j_end = min(jte,jde-1)<a name='568'>
  j_start_f = j_start<a name='569'>
  j_end_f = j_end+1<a name='570'>
  if (degrade_ys) then<a name='571'>
    j_start = jds+1<a name='572'>
    j_start_f = j_start+1<a name='573'>
  endif<a name='574'>
  if (degrade_ye) then<a name='575'>
    j_end = jde-2<a name='576'>
    j_end_f = jde-2<a name='577'>
  endif<a name='578'>
  jp1 = 2<a name='579'>
  jp0 = 1<a name='580'>
  do j = j_start, j_end+1<a name='581'>
    if (j .lt. j_start_f .and. degrade_ys) then<a name='582'>
      do k = kts, ktf<a name='583'>
        do i = i_start, i_end<a name='584'>
          g_fqy(i,k,jp1) = 0.5*g_field(i,k,j_start-1)*rv(i,k,j_start)+0.5*g_field(i,k,j_start)*rv(i,k,j_start)+0.5*g_rv(i,k,&amp;<a name='585'>
&amp;j_start)*(field(i,k,j_start)+field(i,k,j_start-1))<a name='586'>
          fqy(i,k,jp1) = 0.5*rv(i,k,j_start)*(field(i,k,j_start)+field(i,k,j_start-1))<a name='587'>
        end do<a name='588'>
      end do<a name='589'>
    else if (j .gt. j_end_f .and. degrade_ye) then<a name='590'>
      do k = kts, ktf<a name='591'>
        do i = i_start, i_end<a name='592'>
          g_fqy(i,k,jp1) = 0.5*g_field(i,k,j_end+1)*rv(i,k,j_end+1)+0.5*g_field(i,k,j_end)*rv(i,k,j_end+1)+0.5*g_rv(i,k,j_end+1)*&amp;<a name='593'>
&amp;(field(i,k,j_end+1)+field(i,k,j_end))<a name='594'>
          fqy(i,k,jp1) = 0.5*rv(i,k,j_end+1)*(field(i,k,j_end+1)+field(i,k,j_end))<a name='595'>
        end do<a name='596'>
      end do<a name='597'>
    else<a name='598'>
      do k = kts, ktf<a name='599'>
        do i = i_start, i_end<a name='600'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_field(i,k,j-2)*rv(i,k,j)+0.58333333*g_field(i,k,j-1)*rv(i,k,j)-0.083333333*g_field(i,k,&amp;<a name='601'>
&amp;j+1)*rv(i,k,j)+0.58333333*g_field(i,k,j)*rv(i,k,j)+g_rv(i,k,j)*(0.58333333*(field(i,k,j)+field(i,k,j-1))-0.083333333*&amp;<a name='602'>
&amp;(field(i,k,j+1)+field(i,k,j-2)))<a name='603'>
          fqy(i,k,jp1) = rv(i,k,j)*(7./12.*(field(i,k,j)+field(i,k,j-1))-1./12.*(field(i,k,j+1)+field(i,k,j-2)))<a name='604'>
        end do<a name='605'>
      end do<a name='606'>
    endif<a name='607'>
    if (j .gt. j_start) then<a name='608'>
      do k = kts, ktf<a name='609'>
        do i = i_start, i_end<a name='610'>
          mrdy = msft(i,j-1)*rdy<a name='611'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='612'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='613'>
        end do<a name='614'>
      end do<a name='615'>
    endif<a name='616'>
    jtmp = jp1<a name='617'>
    jp1 = jp0<a name='618'>
    jp0 = jtmp<a name='619'>
  end do<a name='620'>
else if (horz_order .eq. 3) then horizontal_order_tesu<a name='621'>
  degrade_xs =  .true. <a name='622'>
  degrade_xe =  .true. <a name='623'>
  degrade_ys =  .true. <a name='624'>
  degrade_ye =  .true. <a name='625'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+1) then<a name='626'>
    degrade_xs =  .false. <a name='627'>
  endif<a name='628'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-2) then<a name='629'>
    degrade_xe =  .false. <a name='630'>
  endif<a name='631'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+1) then<a name='632'>
    degrade_ys =  .false. <a name='633'>
  endif<a name='634'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-2) then<a name='635'>
    degrade_ye =  .false. <a name='636'>
  endif<a name='637'>
  ktf = min(kte,kde-1)<a name='638'>
  i_start = its<a name='639'>
  i_end = min(ite,ide-1)<a name='640'>
  j_start = jts<a name='641'>
  j_end = min(jte,jde-1)<a name='642'>
  i_start_f = i_start<a name='643'>
  i_end_f = i_end+1<a name='644'>
  if (degrade_xs) then<a name='645'>
    i_start = ids+1<a name='646'>
    i_start_f = i_start+1<a name='647'>
  endif<a name='648'>
  if (degrade_xe) then<a name='649'>
    i_end = ide-2<a name='650'>
    i_end_f = ide-2<a name='651'>
  endif<a name='652'>
  do j = j_start, j_end<a name='653'>
    do k = kts, ktf<a name='654'>
      do i = i_start_f, i_end_f<a name='655'>
        g_fqx(i,k) = g_field(i-2,k,j)*ru(i,k,j)*((-0.083333333)+(-0.083333333)*sign(1.,ru(i,k,j)))+g_field(i-1,k,j)*ru(i,k,j)*&amp;<a name='656'>
&amp;(0.58333333+0.25*sign(1.,ru(i,k,j)))+g_field(i+1,k,j)*ru(i,k,j)*((-0.083333333)+0.083333333*sign(1.,ru(i,k,j)))+g_field(i,&amp;<a name='657'>
&amp;k,j)*ru(i,k,j)*(0.58333333+(-0.25)*sign(1.,ru(i,k,j)))+g_ru(i,k,j)*(0.58333333*(field(i,k,j)+field(i-1,k,j))-0.083333333*&amp;<a name='658'>
&amp;(field(i+1,k,j)+field(i-2,k,j))+0.083333333*(field(i+1,k,j)-field(i-2,k,j)-3.*(field(i,k,j)-field(i-1,k,j)))*sign(1.,ru(i,k,j)))<a name='659'>
        fqx(i,k) = ru(i,k,j)*(7./12.*(field(i,k,j)+field(i-1,k,j))-1./12.*(field(i+1,k,j)+field(i-2,k,j))+sign(1.,ru(i,k,j))*(1./&amp;<a name='660'>
&amp;12.)*(field(i+1,k,j)-field(i-2,k,j)-3.*(field(i,k,j)-field(i-1,k,j))))<a name='661'>
      end do<a name='662'>
    end do<a name='663'>
    if (degrade_xs) then<a name='664'>
      do k = kts, ktf<a name='665'>
        g_fqx(i_start,k) = 0.5*g_field(i_start-1,k,j)*ru(i_start,k,j)+0.5*g_field(i_start,k,j)*ru(i_start,k,j)+0.5*g_ru(i_start,k,&amp;<a name='666'>
&amp;j)*(field(i_start,k,j)+field(i_start-1,k,j))<a name='667'>
        fqx(i_start,k) = 0.5*ru(i_start,k,j)*(field(i_start,k,j)+field(i_start-1,k,j))<a name='668'>
      end do<a name='669'>
    endif<a name='670'>
    if (degrade_xe) then<a name='671'>
      do k = kts, ktf<a name='672'>
        g_fqx(i_end+1,k) = 0.5*g_field(i_end+1,k,j)*ru(i_end+1,k,j)+0.5*g_field(i_end,k,j)*ru(i_end+1,k,j)+0.5*g_ru(i_end+1,k,j)*&amp;<a name='673'>
&amp;(field(i_end+1,k,j)+field(i_end,k,j))<a name='674'>
        fqx(i_end+1,k) = 0.5*ru(i_end+1,k,j)*(field(i_end+1,k,j)+field(i_end,k,j))<a name='675'>
      end do<a name='676'>
    endif<a name='677'>
    do k = kts, ktf<a name='678'>
      do i = i_start, i_end<a name='679'>
        mrdx = msft(i,j)*rdx<a name='680'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='681'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='682'>
      end do<a name='683'>
    end do<a name='684'>
  end do<a name='685'>
  i_start = its<a name='686'>
  i_end = min(ite,ide-1)<a name='687'>
  j_start = jts<a name='688'>
  j_end = min(jte,jde-1)<a name='689'>
  j_start_f = j_start<a name='690'>
  j_end_f = j_end+1<a name='691'>
  if (degrade_ys) then<a name='692'>
    j_start = jds+1<a name='693'>
    j_start_f = j_start+1<a name='694'>
  endif<a name='695'>
  if (degrade_ye) then<a name='696'>
    j_end = jde-2<a name='697'>
    j_end_f = jde-2<a name='698'>
  endif<a name='699'>
  jp1 = 2<a name='700'>
  jp0 = 1<a name='701'>
  do j = j_start, j_end+1<a name='702'>
    if (j .lt. j_start_f .and. degrade_ys) then<a name='703'>
      do k = kts, ktf<a name='704'>
        do i = i_start, i_end<a name='705'>
          g_fqy(i,k,jp1) = 0.5*g_field(i,k,j_start-1)*rv(i,k,j_start)+0.5*g_field(i,k,j_start)*rv(i,k,j_start)+0.5*g_rv(i,k,&amp;<a name='706'>
&amp;j_start)*(field(i,k,j_start)+field(i,k,j_start-1))<a name='707'>
          fqy(i,k,jp1) = 0.5*rv(i,k,j_start)*(field(i,k,j_start)+field(i,k,j_start-1))<a name='708'>
        end do<a name='709'>
      end do<a name='710'>
    else if (j .gt. j_end_f .and. degrade_ye) then<a name='711'>
      do k = kts, ktf<a name='712'>
        do i = i_start, i_end<a name='713'>
          g_fqy(i,k,jp1) = 0.5*g_field(i,k,j_end+1)*rv(i,k,j_end+1)+0.5*g_field(i,k,j_end)*rv(i,k,j_end+1)+0.5*g_rv(i,k,j_end+1)*&amp;<a name='714'>
&amp;(field(i,k,j_end+1)+field(i,k,j_end))<a name='715'>
          fqy(i,k,jp1) = 0.5*rv(i,k,j_end+1)*(field(i,k,j_end+1)+field(i,k,j_end))<a name='716'>
        end do<a name='717'>
      end do<a name='718'>
    else<a name='719'>
      do k = kts, ktf<a name='720'>
        do i = i_start, i_end<a name='721'>
          g_fqy(i,k,jp1) = g_field(i,k,j-2)*rv(i,k,j)*((-0.083333333)+(-0.083333333)*sign(1.,rv(i,k,j)))+g_field(i,k,j-1)*rv(i,k,j)&amp;<a name='722'>
&amp;*(0.58333333+0.25*sign(1.,rv(i,k,j)))+g_field(i,k,j+1)*rv(i,k,j)*((-0.083333333)+0.083333333*sign(1.,rv(i,k,j)))+&amp;<a name='723'>
&amp;g_field(i,k,j)*rv(i,k,j)*(0.58333333+(-0.25)*sign(1.,rv(i,k,j)))+g_rv(i,k,j)*(0.58333333*(field(i,k,j)+field(i,k,j-1))-&amp;<a name='724'>
&amp;0.083333333*(field(i,k,j+1)+field(i,k,j-2))+0.083333333*(field(i,k,j+1)-field(i,k,j-2)-3.*(field(i,k,j)-field(i,k,j-1)))&amp;<a name='725'>
&amp;*sign(1.,rv(i,k,j)))<a name='726'>
          fqy(i,k,jp1) = rv(i,k,j)*(7./12.*(field(i,k,j)+field(i,k,j-1))-1./12.*(field(i,k,j+1)+field(i,k,j-2))+sign(1.,rv(i,k,j))*&amp;<a name='727'>
&amp;(1./12.)*(field(i,k,j+1)-field(i,k,j-2)-3.*(field(i,k,j)-field(i,k,j-1))))<a name='728'>
        end do<a name='729'>
      end do<a name='730'>
    endif<a name='731'>
    if (j .gt. j_start) then<a name='732'>
      do k = kts, ktf<a name='733'>
        do i = i_start, i_end<a name='734'>
          mrdy = msft(i,j-1)*rdy<a name='735'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='736'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='737'>
        end do<a name='738'>
      end do<a name='739'>
    endif<a name='740'>
    jtmp = jp1<a name='741'>
    jp1 = jp0<a name='742'>
    jp0 = jtmp<a name='743'>
  end do<a name='744'>
else if (horz_order .eq. 2) then horizontal_order_tesu<a name='745'>
  i_start = its<a name='746'>
  i_end = min(ite,ide-1)<a name='747'>
  j_start = jts<a name='748'>
  j_end = min(jte,jde-1)<a name='749'>
  if (config_flags%open_xs .or. specified) then<a name='750'>
    i_start = max(ids+1,its)<a name='751'>
  endif<a name='752'>
  if (config_flags%open_xe .or. specified) then<a name='753'>
    i_end = min(ide-2,ite)<a name='754'>
  endif<a name='755'>
  do j = j_start, j_end<a name='756'>
    do k = kts, ktf<a name='757'>
      do i = i_start, i_end<a name='758'>
        mrdx = msft(i,j)*rdx<a name='759'>
        g_tendency(i,k,j) = 0.5*g_field(i-1,k,j)*mrdx*ru(i,k,j)-0.5*g_field(i+1,k,j)*mrdx*ru(i+1,k,j)-0.5*g_field(i,k,j)*mrdx*&amp;<a name='760'>
&amp;(ru(i+1,k,j)-ru(i,k,j))-0.5*g_ru(i+1,k,j)*mrdx*(field(i+1,k,j)+field(i,k,j))+0.5*g_ru(i,k,j)*mrdx*(field(i,k,j)+field(i-1,&amp;<a name='761'>
&amp;k,j))+g_tendency(i,k,j)<a name='762'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*0.5*(ru(i+1,k,j)*(field(i+1,k,j)+field(i,k,j))-ru(i,k,j)*(field(i,k,j)+field(i-1,k,&amp;<a name='763'>
&amp;j)))<a name='764'>
      end do<a name='765'>
    end do<a name='766'>
  end do<a name='767'>
  i_start = its<a name='768'>
  i_end = min(ite,ide-1)<a name='769'>
  if (config_flags%open_ys .or. specified) then<a name='770'>
    j_start = max(jds+1,jts)<a name='771'>
  endif<a name='772'>
  if (config_flags%open_ye .or. specified) then<a name='773'>
    j_end = min(jde-2,jte)<a name='774'>
  endif<a name='775'>
  do j = j_start, j_end<a name='776'>
    do k = kts, ktf<a name='777'>
      do i = i_start, i_end<a name='778'>
        mrdy = msft(i,j)*rdy<a name='779'>
        g_tendency(i,k,j) = 0.5*g_field(i,k,j-1)*mrdy*rv(i,k,j)-0.5*g_field(i,k,j+1)*mrdy*rv(i,k,j+1)-0.5*g_field(i,k,j)*mrdy*&amp;<a name='780'>
&amp;(rv(i,k,j+1)-rv(i,k,j))-0.5*g_rv(i,k,j+1)*mrdy*(field(i,k,j+1)+field(i,k,j))+0.5*g_rv(i,k,j)*mrdy*(field(i,k,j)+field(i,k,&amp;<a name='781'>
&amp;j-1))+g_tendency(i,k,j)<a name='782'>
        tendency(i,k,j) = tendency(i,k,j)-mrdy*0.5*(rv(i,k,j+1)*(field(i,k,j+1)+field(i,k,j))-rv(i,k,j)*(field(i,k,j)+field(i,k,j-&amp;<a name='783'>
&amp;1)))<a name='784'>
      end do<a name='785'>
    end do<a name='786'>
  end do<a name='787'>
else horizontal_order_tesu<a name='788'>
  write(unit=wrf_err_message,fmt=*) 'module_advect: advect_scalar_6a, h_order not known ',horz_order<a name='789'>
endif horizontal_order_tesu<a name='790'>
i_start = its<a name='791'>
i_end = min(ite,ide-1)<a name='792'>
j_start = jts<a name='793'>
j_end = min(jte,jde-1)<a name='794'>
if (config_flags%open_xs .and. its .eq. ids) then<a name='795'>
  do j = j_start, j_end<a name='796'>
    do k = kts, ktf<a name='797'>
      g_ub = 0.5*g_ru(its+1,k,j)*(0.5+sign(0.5,0.-0.5*(ru(its,k,j)+ru(its+1,k,j))))+0.5*g_ru(its,k,j)*(0.5+sign(0.5,0.-0.5*(ru(its,&amp;<a name='798'>
&amp;k,j)+ru(its+1,k,j))))<a name='799'>
      ub = min(0.5*(ru(its,k,j)+ru(its+1,k,j)),0.)<a name='800'>
      g_tendency(its,k,j) = (-(g_field(its,k,j)*rdx*(ru(its+1,k,j)-ru(its,k,j))))-g_field_old(its+1,k,j)*rdx*ub+g_field_old(its,k,&amp;<a name='801'>
&amp;j)*rdx*ub-g_ru(its+1,k,j)*rdx*field(its,k,j)+g_ru(its,k,j)*rdx*field(its,k,j)+g_tendency(its,k,j)-g_ub*rdx*(field_old(its+1,&amp;<a name='802'>
&amp;k,j)-field_old(its,k,j))<a name='803'>
      tendency(its,k,j) = tendency(its,k,j)-rdx*(ub*(field_old(its+1,k,j)-field_old(its,k,j))+field(its,k,j)*(ru(its+1,k,j)-ru(its,&amp;<a name='804'>
&amp;k,j)))<a name='805'>
    end do<a name='806'>
  end do<a name='807'>
endif<a name='808'>
if (config_flags%open_xe .and. ite .eq. ide) then<a name='809'>
  do j = j_start, j_end<a name='810'>
    do k = kts, ktf<a name='811'>
      g_ub = 0.5*g_ru(ite-1,k,j)*(0.5+sign(0.5,0.5*(ru(ite-1,k,j)+ru(ite,k,j))-0.))+0.5*g_ru(ite,k,j)*(0.5+sign(0.5,0.5*(ru(ite-1,&amp;<a name='812'>
&amp;k,j)+ru(ite,k,j))-0.))<a name='813'>
      ub = max(0.5*(ru(ite-1,k,j)+ru(ite,k,j)),0.)<a name='814'>
      g_tendency(i_end,k,j) = (-(g_field(i_end,k,j)*rdx*(ru(ite,k,j)-ru(ite-1,k,j))))+g_field_old(i_end-1,k,j)*rdx*ub-&amp;<a name='815'>
&amp;g_field_old(i_end,k,j)*rdx*ub+g_ru(ite-1,k,j)*rdx*field(i_end,k,j)-g_ru(ite,k,j)*rdx*field(i_end,k,j)+g_tendency(i_end,k,j)-&amp;<a name='816'>
&amp;g_ub*rdx*(field_old(i_end,k,j)-field_old(i_end-1,k,j))<a name='817'>
      tendency(i_end,k,j) = tendency(i_end,k,j)-rdx*(ub*(field_old(i_end,k,j)-field_old(i_end-1,k,j))+field(i_end,k,j)*(ru(ite,k,j)&amp;<a name='818'>
&amp;-ru(ite-1,k,j)))<a name='819'>
    end do<a name='820'>
  end do<a name='821'>
endif<a name='822'>
if (config_flags%open_ys .and. jts .eq. jds) then<a name='823'>
  do i = i_start, i_end<a name='824'>
    do k = kts, ktf<a name='825'>
      g_vb = 0.5*g_rv(i,k,jts+1)*(0.5+sign(0.5,0.-0.5*(rv(i,k,jts)+rv(i,k,jts+1))))+0.5*g_rv(i,k,jts)*(0.5+sign(0.5,0.-0.5*(rv(i,k,&amp;<a name='826'>
&amp;jts)+rv(i,k,jts+1))))<a name='827'>
      vb = min(0.5*(rv(i,k,jts)+rv(i,k,jts+1)),0.)<a name='828'>
      g_tendency(i,k,jts) = (-(g_field(i,k,jts)*rdy*(rv(i,k,jts+1)-rv(i,k,jts))))-g_field_old(i,k,jts+1)*rdy*vb+g_field_old(i,k,&amp;<a name='829'>
&amp;jts)*rdy*vb-g_rv(i,k,jts+1)*rdy*field(i,k,jts)+g_rv(i,k,jts)*rdy*field(i,k,jts)+g_tendency(i,k,jts)-g_vb*rdy*(field_old(i,k,&amp;<a name='830'>
&amp;jts+1)-field_old(i,k,jts))<a name='831'>
      tendency(i,k,jts) = tendency(i,k,jts)-rdy*(vb*(field_old(i,k,jts+1)-field_old(i,k,jts))+field(i,k,jts)*(rv(i,k,jts+1)-rv(i,k,&amp;<a name='832'>
&amp;jts)))<a name='833'>
    end do<a name='834'>
  end do<a name='835'>
endif<a name='836'>
if (config_flags%open_ye .and. jte .eq. jde) then<a name='837'>
  do i = i_start, i_end<a name='838'>
    do k = kts, ktf<a name='839'>
      g_vb = 0.5*g_rv(i,k,jte-1)*(0.5+sign(0.5,0.5*(rv(i,k,jte-1)+rv(i,k,jte))-0.))+0.5*g_rv(i,k,jte)*(0.5+sign(0.5,0.5*(rv(i,k,&amp;<a name='840'>
&amp;jte-1)+rv(i,k,jte))-0.))<a name='841'>
      vb = max(0.5*(rv(i,k,jte-1)+rv(i,k,jte)),0.)<a name='842'>
      g_tendency(i,k,j_end) = (-(g_field(i,k,j_end)*rdy*(rv(i,k,jte)-rv(i,k,jte-1))))+g_field_old(i,k,j_end-1)*rdy*vb-&amp;<a name='843'>
&amp;g_field_old(i,k,j_end)*rdy*vb+g_rv(i,k,jte-1)*rdy*field(i,k,j_end)-g_rv(i,k,jte)*rdy*field(i,k,j_end)+g_tendency(i,k,j_end)-&amp;<a name='844'>
&amp;g_vb*rdy*(field_old(i,k,j_end)-field_old(i,k,j_end-1))<a name='845'>
      tendency(i,k,j_end) = tendency(i,k,j_end)-rdy*(vb*(field_old(i,k,j_end)-field_old(i,k,j_end-1))+field(i,k,j_end)*(rv(i,k,jte)&amp;<a name='846'>
&amp;-rv(i,k,jte-1)))<a name='847'>
    end do<a name='848'>
  end do<a name='849'>
endif<a name='850'>
i_start = its<a name='851'>
i_end = min(ite,ide-1)<a name='852'>
j_start = jts<a name='853'>
j_end = min(jte,jde-1)<a name='854'>
do i = i_start, i_end<a name='855'>
  g_vflux(i,kts) = 0.<a name='856'>
  vflux(i,kts) = 0.<a name='857'>
  g_vflux(i,kte) = 0.<a name='858'>
  vflux(i,kte) = 0.<a name='859'>
end do<a name='860'>
vert_order_tesu: if (vert_order .eq. 6) then<a name='861'>
  do j = j_start, j_end<a name='862'>
    do k = kts+3, ktf-2<a name='863'>
      do i = i_start, i_end<a name='864'>
        g_vel = g_rom(i,k,j)<a name='865'>
        vel = rom(i,k,j)<a name='866'>
        g_vflux(i,k) = 0.016666667*g_field(i,k-3,j)*vel-0.13333333*g_field(i,k-2,j)*vel+0.61666667*g_field(i,k-1,j)*vel+&amp;<a name='867'>
&amp;0.016666667*g_field(i,k+2,j)*vel-0.13333333*g_field(i,k+1,j)*vel+0.61666667*g_field(i,k,j)*vel+g_vel*(0.61666667*(field(i,&amp;<a name='868'>
&amp;k,j)+field(i,k-1,j))-0.13333333*(field(i,k+1,j)+field(i,k-2,j))+0.016666667*(field(i,k+2,j)+field(i,k-3,j)))<a name='869'>
        vflux(i,k) = vel*(37./60.*(field(i,k,j)+field(i,k-1,j))-2./15.*(field(i,k+1,j)+field(i,k-2,j))+1./60.*(field(i,k+2,j)+&amp;<a name='870'>
&amp;field(i,k-3,j)))<a name='871'>
      end do<a name='872'>
    end do<a name='873'>
    do i = i_start, i_end<a name='874'>
      k = kts+1<a name='875'>
      g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*&amp;<a name='876'>
&amp;field(i,k-1,j))<a name='877'>
      vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='878'>
      k = kts+2<a name='879'>
      g_vel = g_rom(i,k,j)<a name='880'>
      vel = rom(i,k,j)<a name='881'>
      g_vflux(i,k) = (-0.083333333)*g_field(i,k-2,j)*vel+0.58333333*g_field(i,k-1,j)*vel-0.083333333*g_field(i,k+1,j)*vel+&amp;<a name='882'>
&amp;0.58333333*g_field(i,k,j)*vel+g_vel*(0.58333333*(field(i,k,j)+field(i,k-1,j))-0.083333333*(field(i,k+1,j)+field(i,k-2,j)))<a name='883'>
      vflux(i,k) = vel*(7./12.*(field(i,k,j)+field(i,k-1,j))-1./12.*(field(i,k+1,j)+field(i,k-2,j)))<a name='884'>
      k = ktf-1<a name='885'>
      g_vel = g_rom(i,k,j)<a name='886'>
      vel = rom(i,k,j)<a name='887'>
      g_vflux(i,k) = (-0.083333333)*g_field(i,k-2,j)*vel+0.58333333*g_field(i,k-1,j)*vel-0.083333333*g_field(i,k+1,j)*vel+&amp;<a name='888'>
&amp;0.58333333*g_field(i,k,j)*vel+g_vel*(0.58333333*(field(i,k,j)+field(i,k-1,j))-0.083333333*(field(i,k+1,j)+field(i,k-2,j)))<a name='889'>
      vflux(i,k) = vel*(7./12.*(field(i,k,j)+field(i,k-1,j))-1./12.*(field(i,k+1,j)+field(i,k-2,j)))<a name='890'>
      k = ktf<a name='891'>
      g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*&amp;<a name='892'>
&amp;field(i,k-1,j))<a name='893'>
      vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='894'>
    end do<a name='895'>
    do k = kts, ktf<a name='896'>
      do i = i_start, i_end<a name='897'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='898'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='899'>
      end do<a name='900'>
    end do<a name='901'>
  end do<a name='902'>
else if (vert_order .eq. 5) then vert_order_tesu<a name='903'>
  do j = j_start, j_end<a name='904'>
    do k = kts+3, ktf-2<a name='905'>
      do i = i_start, i_end<a name='906'>
        g_vel = g_rom(i,k,j)<a name='907'>
        vel = rom(i,k,j)<a name='908'>
        g_vflux(i,k) = g_field(i,k-3,j)*vel*(0.016666667-(-0.016666667)*sign(1.,-vel))+g_field(i,k-2,j)*vel*((-0.13333333)-&amp;<a name='909'>
&amp;0.083333333*sign(1.,-vel))+g_field(i,k-1,j)*vel*(0.61666667-(-0.16666667)*sign(1.,-vel))+g_field(i,k+2,j)*vel*&amp;<a name='910'>
&amp;(0.016666667-0.016666667*sign(1.,-vel))+g_field(i,k+1,j)*vel*((-0.13333333)-(-0.083333333)*sign(1.,-vel))+g_field(i,k,j)*&amp;<a name='911'>
&amp;vel*(0.61666667-0.16666667*sign(1.,-vel))+g_vel*(0.61666667*(field(i,k,j)+field(i,k-1,j))-0.13333333*(field(i,k+1,j)+&amp;<a name='912'>
&amp;field(i,k-2,j))+0.016666667*(field(i,k+2,j)+field(i,k-3,j))-0.016666667*(field(i,k+2,j)-field(i,k-3,j)-5.*(field(i,k+1,j)-&amp;<a name='913'>
&amp;field(i,k-2,j))+10.*(field(i,k,j)-field(i,k-1,j)))*sign(1.,-vel))<a name='914'>
        vflux(i,k) = vel*(37./60.*(field(i,k,j)+field(i,k-1,j))-2./15.*(field(i,k+1,j)+field(i,k-2,j))+1./60.*(field(i,k+2,j)+&amp;<a name='915'>
&amp;field(i,k-3,j))-sign(1.,-vel)*(1./60.)*(field(i,k+2,j)-field(i,k-3,j)-5.*(field(i,k+1,j)-field(i,k-2,j))+10.*(field(i,k,j)&amp;<a name='916'>
&amp;-field(i,k-1,j))))<a name='917'>
      end do<a name='918'>
    end do<a name='919'>
    do i = i_start, i_end<a name='920'>
      k = kts+1<a name='921'>
      g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*&amp;<a name='922'>
&amp;field(i,k-1,j))<a name='923'>
      vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='924'>
      k = kts+2<a name='925'>
      g_vel = g_rom(i,k,j)<a name='926'>
      vel = rom(i,k,j)<a name='927'>
      g_vflux(i,k) = g_field(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_field(i,k-1,j)*vel*(0.58333333+0.25*&amp;<a name='928'>
&amp;sign(1.,-vel))+g_field(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_field(i,k,j)*vel*(0.58333333+(-0.25)*&amp;<a name='929'>
&amp;sign(1.,-vel))+g_vel*(0.58333333*(field(i,k,j)+field(i,k-1,j))-0.083333333*(field(i,k+1,j)+field(i,k-2,j))+0.083333333*&amp;<a name='930'>
&amp;(field(i,k+1,j)-field(i,k-2,j)-3.*(field(i,k,j)-field(i,k-1,j)))*sign(1.,-vel))<a name='931'>
      vflux(i,k) = vel*(7./12.*(field(i,k,j)+field(i,k-1,j))-1./12.*(field(i,k+1,j)+field(i,k-2,j))+sign(1.,-vel)*(1./12.)*&amp;<a name='932'>
&amp;(field(i,k+1,j)-field(i,k-2,j)-3.*(field(i,k,j)-field(i,k-1,j))))<a name='933'>
      k = ktf-1<a name='934'>
      g_vel = g_rom(i,k,j)<a name='935'>
      vel = rom(i,k,j)<a name='936'>
      g_vflux(i,k) = g_field(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_field(i,k-1,j)*vel*(0.58333333+0.25*&amp;<a name='937'>
&amp;sign(1.,-vel))+g_field(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_field(i,k,j)*vel*(0.58333333+(-0.25)*&amp;<a name='938'>
&amp;sign(1.,-vel))+g_vel*(0.58333333*(field(i,k,j)+field(i,k-1,j))-0.083333333*(field(i,k+1,j)+field(i,k-2,j))+0.083333333*&amp;<a name='939'>
&amp;(field(i,k+1,j)-field(i,k-2,j)-3.*(field(i,k,j)-field(i,k-1,j)))*sign(1.,-vel))<a name='940'>
      vflux(i,k) = vel*(7./12.*(field(i,k,j)+field(i,k-1,j))-1./12.*(field(i,k+1,j)+field(i,k-2,j))+sign(1.,-vel)*(1./12.)*&amp;<a name='941'>
&amp;(field(i,k+1,j)-field(i,k-2,j)-3.*(field(i,k,j)-field(i,k-1,j))))<a name='942'>
      k = ktf<a name='943'>
      g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*&amp;<a name='944'>
&amp;field(i,k-1,j))<a name='945'>
      vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='946'>
    end do<a name='947'>
    do k = kts, ktf<a name='948'>
      do i = i_start, i_end<a name='949'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='950'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='951'>
      end do<a name='952'>
    end do<a name='953'>
  end do<a name='954'>
else if (vert_order .eq. 4) then vert_order_tesu<a name='955'>
  do j = j_start, j_end<a name='956'>
    do k = kts+2, ktf-1<a name='957'>
      do i = i_start, i_end<a name='958'>
        g_vel = g_rom(i,k,j)<a name='959'>
        vel = rom(i,k,j)<a name='960'>
        g_vflux(i,k) = (-0.083333333)*g_field(i,k-2,j)*vel+0.58333333*g_field(i,k-1,j)*vel-0.083333333*g_field(i,k+1,j)*vel+&amp;<a name='961'>
&amp;0.58333333*g_field(i,k,j)*vel+g_vel*(0.58333333*(field(i,k,j)+field(i,k-1,j))-0.083333333*(field(i,k+1,j)+field(i,k-2,j)))<a name='962'>
        vflux(i,k) = vel*(7./12.*(field(i,k,j)+field(i,k-1,j))-1./12.*(field(i,k+1,j)+field(i,k-2,j)))<a name='963'>
      end do<a name='964'>
    end do<a name='965'>
    do i = i_start, i_end<a name='966'>
      k = kts+1<a name='967'>
      g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*&amp;<a name='968'>
&amp;field(i,k-1,j))<a name='969'>
      vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='970'>
      k = ktf<a name='971'>
      g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*&amp;<a name='972'>
&amp;field(i,k-1,j))<a name='973'>
      vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='974'>
    end do<a name='975'>
    do k = kts, ktf<a name='976'>
      do i = i_start, i_end<a name='977'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='978'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='979'>
      end do<a name='980'>
    end do<a name='981'>
  end do<a name='982'>
else if (vert_order .eq. 3) then vert_order_tesu<a name='983'>
  do j = j_start, j_end<a name='984'>
    do k = kts+2, ktf-1<a name='985'>
      do i = i_start, i_end<a name='986'>
        g_vel = g_rom(i,k,j)<a name='987'>
        vel = rom(i,k,j)<a name='988'>
        g_vflux(i,k) = g_field(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_field(i,k-1,j)*vel*(0.58333333+0.25*&amp;<a name='989'>
&amp;sign(1.,-vel))+g_field(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_field(i,k,j)*vel*(0.58333333+(-0.25)*&amp;<a name='990'>
&amp;sign(1.,-vel))+g_vel*(0.58333333*(field(i,k,j)+field(i,k-1,j))-0.083333333*(field(i,k+1,j)+field(i,k-2,j))+0.083333333*&amp;<a name='991'>
&amp;(field(i,k+1,j)-field(i,k-2,j)-3.*(field(i,k,j)-field(i,k-1,j)))*sign(1.,-vel))<a name='992'>
        vflux(i,k) = vel*(7./12.*(field(i,k,j)+field(i,k-1,j))-1./12.*(field(i,k+1,j)+field(i,k-2,j))+sign(1.,-vel)*(1./12.)*&amp;<a name='993'>
&amp;(field(i,k+1,j)-field(i,k-2,j)-3.*(field(i,k,j)-field(i,k-1,j))))<a name='994'>
      end do<a name='995'>
    end do<a name='996'>
    do i = i_start, i_end<a name='997'>
      k = kts+1<a name='998'>
      g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*&amp;<a name='999'>
&amp;field(i,k-1,j))<a name='1000'>
      vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='1001'>
      k = ktf<a name='1002'>
      g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*&amp;<a name='1003'>
&amp;field(i,k-1,j))<a name='1004'>
      vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='1005'>
    end do<a name='1006'>
    do k = kts, ktf<a name='1007'>
      do i = i_start, i_end<a name='1008'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='1009'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='1010'>
      end do<a name='1011'>
    end do<a name='1012'>
  end do<a name='1013'>
else if (vert_order .eq. 2) then vert_order_tesu<a name='1014'>
  do j = j_start, j_end<a name='1015'>
    do k = kts+1, ktf<a name='1016'>
      do i = i_start, i_end<a name='1017'>
        g_vflux(i,k) = g_field(i,k-1,j)*rom(i,k,j)*fzp(k)+g_field(i,k,j)*rom(i,k,j)*fzm(k)+g_rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)&amp;<a name='1018'>
&amp;*field(i,k-1,j))<a name='1019'>
        vflux(i,k) = rom(i,k,j)*(fzm(k)*field(i,k,j)+fzp(k)*field(i,k-1,j))<a name='1020'>
      end do<a name='1021'>
    end do<a name='1022'>
    do k = kts, ktf<a name='1023'>
      do i = i_start, i_end<a name='1024'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='1025'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='1026'>
      end do<a name='1027'>
    end do<a name='1028'>
  end do<a name='1029'>
else vert_order_tesu<a name='1030'>
  write(unit=wrf_err_message,fmt=*) ' advect_scalar_6a, v_order not known ',vert_order<a name='1031'>
endif vert_order_tesu<a name='1032'>
<a name='1033'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_SCALAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_6">("g_advect_scalar")<a name='1034'>
<a name='1035'>
end subroutine g_advect_scalar<a name='1036'>
<a name='1037'>
<a name='1038'>
<A NAME='G_ADVECT_U'><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_U' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1039'>
<font color=#993300>subroutine </font><font color=#cc0000>g_advect_u</font>( u, g_u, u_old, g_u_old, tendency, g_tendency, ru, g_ru, rv, g_rv, rom, g_rom, mut, g_mut, config_flags, &amp; <A href='../../call_to/G_ADVECT_U.html' TARGET='index'>2</A>,<A href='../../call_from/G_ADVECT_U.html' TARGET='index'>2</A><a name='1040'>
&amp;msfu, fzm, fzp, rdx, rdy, rdzw, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='1041'>
<font color=#447700>!******************************************************************<a name='1042'></font>
<font color=#447700>!******************************************************************<a name='1043'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='1044'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='1045'></font>
<font color=#447700>!******************************************************************<a name='1046'></font>
<font color=#447700>!******************************************************************<a name='1047'></font>
<font color=#447700>!==============================================<a name='1048'></font>
<font color=#447700>! all entries are defined explicitly<a name='1049'></font>
<font color=#447700>!==============================================<a name='1050'></font>
implicit none<a name='1051'>
<a name='1052'>
<font color=#447700>!==============================================<a name='1053'></font>
<font color=#447700>! declare arguments<a name='1054'></font>
<font color=#447700>!==============================================<a name='1055'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='1056'>
integer, intent(in) :: kme<a name='1057'>
integer, intent(in) :: kms<a name='1058'>
real, intent(in) :: fzm(kms:kme)<a name='1059'>
real, intent(in) :: fzp(kms:kme)<a name='1060'>
integer, intent(in) :: ime<a name='1061'>
integer, intent(in) :: ims<a name='1062'>
integer, intent(in) :: jme<a name='1063'>
integer, intent(in) :: jms<a name='1064'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='1065'>
real, intent(in) :: g_rom(ims:ime,kms:kme,jms:jme)<a name='1066'>
real, intent(in) :: g_ru(ims:ime,kms:kme,jms:jme)<a name='1067'>
real, intent(in) :: g_rv(ims:ime,kms:kme,jms:jme)<a name='1068'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='1069'>
real, intent(in) :: g_u(ims:ime,kms:kme,jms:jme)<a name='1070'>
real, intent(in) :: g_u_old(ims:ime,kms:kme,jms:jme)<a name='1071'>
integer, intent(in) :: ide<a name='1072'>
integer, intent(in) :: ids<a name='1073'>
integer, intent(in) :: ite<a name='1074'>
integer, intent(in) :: its<a name='1075'>
integer, intent(in) :: jde<a name='1076'>
integer, intent(in) :: jds<a name='1077'>
integer, intent(in) :: jte<a name='1078'>
integer, intent(in) :: jts<a name='1079'>
integer, intent(in) :: kde<a name='1080'>
integer, intent(in) :: kte<a name='1081'>
integer, intent(in) :: kts<a name='1082'>
real, intent(in) :: msfu(ims:ime,jms:jme)<a name='1083'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='1084'>
real, intent(in) :: rdx<a name='1085'>
real, intent(in) :: rdy<a name='1086'>
real, intent(in) :: rdzw(kms:kme)<a name='1087'>
real, intent(in) :: rom(ims:ime,kms:kme,jms:jme)<a name='1088'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='1089'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='1090'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='1091'>
real, intent(in) :: u(ims:ime,kms:kme,jms:jme)<a name='1092'>
real, intent(in) :: u_old(ims:ime,kms:kme,jms:jme)<a name='1093'>
<a name='1094'>
<font color=#447700>!==============================================<a name='1095'></font>
<font color=#447700>! declare local variables<a name='1096'></font>
<font color=#447700>!==============================================<a name='1097'></font>
logical degrade_xe<a name='1098'>
logical degrade_xs<a name='1099'>
logical degrade_ye<a name='1100'>
logical degrade_ys<a name='1101'>
real dvm<a name='1102'>
real dvp<a name='1103'>
real fqx(its-1:ite+1,kts:kte)<a name='1104'>
real fqy(its:ite,kts:kte,2)<a name='1105'>
real g_dvm<a name='1106'>
real g_dvp<a name='1107'>
real g_fqx(its-1:ite+1,kts:kte)<a name='1108'>
real g_fqy(its:ite,kts:kte,2)<a name='1109'>
real g_ub<a name='1110'>
real g_vb<a name='1111'>
real g_vel<a name='1112'>
real g_vflux(its:ite,kts:kte)<a name='1113'>
real g_vw<a name='1114'>
integer horz_order<a name='1115'>
integer i<a name='1116'>
integer i_end<a name='1117'>
integer i_end_f<a name='1118'>
integer i_start<a name='1119'>
integer i_start_f<a name='1120'>
integer im<a name='1121'>
integer imax<a name='1122'>
integer imin<a name='1123'>
integer ip<a name='1124'>
integer j<a name='1125'>
integer j_end<a name='1126'>
integer j_end_f<a name='1127'>
integer j_start<a name='1128'>
integer j_start_f<a name='1129'>
integer jp0<a name='1130'>
integer jp1<a name='1131'>
integer jtmp<a name='1132'>
integer k<a name='1133'>
integer ktf<a name='1134'>
real mrdx<a name='1135'>
real mrdy<a name='1136'>
logical specified<a name='1137'>
real ub<a name='1138'>
real vb<a name='1139'>
real vel<a name='1140'>
integer vert_order<a name='1141'>
real vflux(its:ite,kts:kte)<a name='1142'>
real vw<a name='1143'>
<a name='1144'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_U' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_7">("g_advect_u")<a name='1145'>
<a name='1146'>
<font color=#447700>!----------------------------------------------<a name='1147'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='1148'></font>
<font color=#447700>!----------------------------------------------<a name='1149'></font>
specified =  .false. <a name='1150'>
if (config_flags%specified .or. config_flags%nested) then<a name='1151'>
  specified =  .true. <a name='1152'>
endif<a name='1153'>
horz_order = config_flags%h_mom_adv_order<a name='1154'>
vert_order = config_flags%v_mom_adv_order<a name='1155'>
ktf = min(kte,kde-1)<a name='1156'>
horizontal_order_tesu: if (horz_order .eq. 6) then<a name='1157'>
  degrade_xs =  .true. <a name='1158'>
  degrade_xe =  .true. <a name='1159'>
  degrade_ys =  .true. <a name='1160'>
  degrade_ye =  .true. <a name='1161'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+2) then<a name='1162'>
    degrade_xs =  .false. <a name='1163'>
  endif<a name='1164'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-2) then<a name='1165'>
    degrade_xe =  .false. <a name='1166'>
  endif<a name='1167'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+2) then<a name='1168'>
    degrade_ys =  .false. <a name='1169'>
  endif<a name='1170'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-3) then<a name='1171'>
    degrade_ye =  .false. <a name='1172'>
  endif<a name='1173'>
  i_start = its<a name='1174'>
  i_end = ite<a name='1175'>
  if (config_flags%open_xs .or. specified) then<a name='1176'>
    i_start = max(ids+1,its)<a name='1177'>
  endif<a name='1178'>
  if (config_flags%open_xe .or. specified) then<a name='1179'>
    i_end = min(ide-1,ite)<a name='1180'>
  endif<a name='1181'>
  j_start = jts<a name='1182'>
  j_end = min(jte,jde-1)<a name='1183'>
  j_start_f = j_start<a name='1184'>
  j_end_f = j_end+1<a name='1185'>
  if (degrade_ys) then<a name='1186'>
    j_start = max(jts,jds+1)<a name='1187'>
    j_start_f = jds+3<a name='1188'>
  endif<a name='1189'>
  if (degrade_ye) then<a name='1190'>
    j_end = min(jte,jde-2)<a name='1191'>
    j_end_f = jde-3<a name='1192'>
  endif<a name='1193'>
  jp1 = 2<a name='1194'>
  jp0 = 1<a name='1195'>
  j_loop_y_flux_6: do j = j_start, j_end+1<a name='1196'>
    if (j .ge. j_start_f .and. j .le. j_end_f) then<a name='1197'>
      do k = kts, ktf<a name='1198'>
        do i = i_start, i_end<a name='1199'>
          g_vel = 0.5*g_rv(i-1,k,j)+0.5*g_rv(i,k,j)<a name='1200'>
          vel = 0.5*(rv(i,k,j)+rv(i-1,k,j))<a name='1201'>
          g_fqy(i,k,jp1) = 0.016666667*g_u(i,k,j-3)*vel-0.13333333*g_u(i,k,j-2)*vel+0.61666667*g_u(i,k,j-1)*vel+0.016666667*g_u(i,&amp;<a name='1202'>
&amp;k,j+2)*vel-0.13333333*g_u(i,k,j+1)*vel+0.61666667*g_u(i,k,j)*vel+g_vel*(0.61666667*(u(i,k,j)+u(i,k,j-1))-0.13333333*&amp;<a name='1203'>
&amp;(u(i,k,j+1)+u(i,k,j-2))+0.016666667*(u(i,k,j+2)+u(i,k,j-3)))<a name='1204'>
          fqy(i,k,jp1) = vel*(37./60.*(u(i,k,j)+u(i,k,j-1))-2./15.*(u(i,k,j+1)+u(i,k,j-2))+1./60.*(u(i,k,j+2)+u(i,k,j-3)))<a name='1205'>
        end do<a name='1206'>
      end do<a name='1207'>
    else if (j .eq. jds+1) then<a name='1208'>
      do k = kts, ktf<a name='1209'>
        do i = i_start, i_end<a name='1210'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i-1,k,j)*(u(i,k,j)+u(i,k,j-1))+0.25*g_rv(i,k,j)*(u(i,k,j)+u(i,k,j-1))+0.25*g_u(i,k,j-1)*(rv(i,&amp;<a name='1211'>
&amp;k,j)+rv(i-1,k,j))+0.25*g_u(i,k,j)*(rv(i,k,j)+rv(i-1,k,j))<a name='1212'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i-1,k,j))*(u(i,k,j)+u(i,k,j-1))<a name='1213'>
        end do<a name='1214'>
      end do<a name='1215'>
    else if (j .eq. jds+2) then<a name='1216'>
      do k = kts, ktf<a name='1217'>
        do i = i_start, i_end<a name='1218'>
          g_vel = 0.5*g_rv(i-1,k,j)+0.5*g_rv(i,k,j)<a name='1219'>
          vel = 0.5*(rv(i,k,j)+rv(i-1,k,j))<a name='1220'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_u(i,k,j-2)*vel+0.58333333*g_u(i,k,j-1)*vel-0.083333333*g_u(i,k,j+1)*vel+0.58333333*&amp;<a name='1221'>
&amp;g_u(i,k,j)*vel+g_vel*(0.58333333*(u(i,k,j)+u(i,k,j-1))-0.083333333*(u(i,k,j+1)+u(i,k,j-2)))<a name='1222'>
          fqy(i,k,jp1) = vel*(7./12.*(u(i,k,j)+u(i,k,j-1))-1./12.*(u(i,k,j+1)+u(i,k,j-2)))<a name='1223'>
        end do<a name='1224'>
      end do<a name='1225'>
    else if (j .eq. jde-1) then<a name='1226'>
      do k = kts, ktf<a name='1227'>
        do i = i_start, i_end<a name='1228'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i-1,k,j)*(u(i,k,j)+u(i,k,j-1))+0.25*g_rv(i,k,j)*(u(i,k,j)+u(i,k,j-1))+0.25*g_u(i,k,j-1)*(rv(i,&amp;<a name='1229'>
&amp;k,j)+rv(i-1,k,j))+0.25*g_u(i,k,j)*(rv(i,k,j)+rv(i-1,k,j))<a name='1230'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i-1,k,j))*(u(i,k,j)+u(i,k,j-1))<a name='1231'>
        end do<a name='1232'>
      end do<a name='1233'>
    else if (j .eq. jde-2) then<a name='1234'>
      do k = kts, ktf<a name='1235'>
        do i = i_start, i_end<a name='1236'>
          g_vel = 0.5*g_rv(i-1,k,j)+0.5*g_rv(i,k,j)<a name='1237'>
          vel = 0.5*(rv(i,k,j)+rv(i-1,k,j))<a name='1238'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_u(i,k,j-2)*vel+0.58333333*g_u(i,k,j-1)*vel-0.083333333*g_u(i,k,j+1)*vel+0.58333333*&amp;<a name='1239'>
&amp;g_u(i,k,j)*vel+g_vel*(0.58333333*(u(i,k,j)+u(i,k,j-1))-0.083333333*(u(i,k,j+1)+u(i,k,j-2)))<a name='1240'>
          fqy(i,k,jp1) = vel*(7./12.*(u(i,k,j)+u(i,k,j-1))-1./12.*(u(i,k,j+1)+u(i,k,j-2)))<a name='1241'>
        end do<a name='1242'>
      end do<a name='1243'>
    endif<a name='1244'>
    if (j .gt. j_start) then<a name='1245'>
      do k = kts, ktf<a name='1246'>
        do i = i_start, i_end<a name='1247'>
          mrdy = msfu(i,j-1)*rdy<a name='1248'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='1249'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='1250'>
        end do<a name='1251'>
      end do<a name='1252'>
    endif<a name='1253'>
    jtmp = jp1<a name='1254'>
    jp1 = jp0<a name='1255'>
    jp0 = jtmp<a name='1256'>
  end do j_loop_y_flux_6<a name='1257'>
  i_start = its<a name='1258'>
  i_end = ite<a name='1259'>
  j_start = jts<a name='1260'>
  j_end = min(jte,jde-1)<a name='1261'>
  i_start_f = i_start<a name='1262'>
  i_end_f = i_end+1<a name='1263'>
  if (degrade_xs) then<a name='1264'>
    i_start = max(ids+1,its)<a name='1265'>
    i_start_f = ids+3<a name='1266'>
  endif<a name='1267'>
  if (degrade_xe) then<a name='1268'>
    i_end = min(ide-1,ite)<a name='1269'>
    i_end_f = ide-2<a name='1270'>
  endif<a name='1271'>
  do j = j_start, j_end<a name='1272'>
    do k = kts, ktf<a name='1273'>
      do i = i_start_f, i_end_f<a name='1274'>
        g_vel = 0.5*g_ru(i-1,k,j)+0.5*g_ru(i,k,j)<a name='1275'>
        vel = 0.5*(ru(i,k,j)+ru(i-1,k,j))<a name='1276'>
        g_fqx(i,k) = 0.016666667*g_u(i-3,k,j)*vel-0.13333333*g_u(i-2,k,j)*vel+0.61666667*g_u(i-1,k,j)*vel+0.016666667*g_u(i+2,k,j)*&amp;<a name='1277'>
&amp;vel-0.13333333*g_u(i+1,k,j)*vel+0.61666667*g_u(i,k,j)*vel+g_vel*(0.61666667*(u(i,k,j)+u(i-1,k,j))-0.13333333*(u(i+1,k,j)+&amp;<a name='1278'>
&amp;u(i-2,k,j))+0.016666667*(u(i+2,k,j)+u(i-3,k,j)))<a name='1279'>
        fqx(i,k) = vel*(37./60.*(u(i,k,j)+u(i-1,k,j))-2./15.*(u(i+1,k,j)+u(i-2,k,j))+1./60.*(u(i+2,k,j)+u(i-3,k,j)))<a name='1280'>
      end do<a name='1281'>
    end do<a name='1282'>
    if (degrade_xs) then<a name='1283'>
      if (i_start .eq. ids+1) then<a name='1284'>
        i = ids+1<a name='1285'>
        do k = kts, ktf<a name='1286'>
          g_ub = g_u(i-1,k,j)<a name='1287'>
          ub = u(i-1,k,j)<a name='1288'>
          if (specified .and. u(i,k,j) .lt. 0.) then<a name='1289'>
            g_ub = g_u(i,k,j)<a name='1290'>
            ub = u(i,k,j)<a name='1291'>
          endif<a name='1292'>
          g_fqx(i,k) = 0.25*g_ru(i-1,k,j)*(u(i,k,j)+ub)+0.25*g_ru(i,k,j)*(u(i,k,j)+ub)+0.25*g_u(i,k,j)*(ru(i,k,j)+ru(i-1,k,j))+&amp;<a name='1293'>
&amp;0.25*g_ub*(ru(i,k,j)+ru(i-1,k,j))<a name='1294'>
          fqx(i,k) = 0.25*(ru(i,k,j)+ru(i-1,k,j))*(u(i,k,j)+ub)<a name='1295'>
        end do<a name='1296'>
      endif<a name='1297'>
      i = ids+2<a name='1298'>
      do k = kts, ktf<a name='1299'>
        g_vel = 0.5*g_ru(i-1,k,j)+0.5*g_ru(i,k,j)<a name='1300'>
        vel = 0.5*(ru(i,k,j)+ru(i-1,k,j))<a name='1301'>
        g_fqx(i,k) = (-0.083333333)*g_u(i-2,k,j)*vel+0.58333333*g_u(i-1,k,j)*vel-0.083333333*g_u(i+1,k,j)*vel+0.58333333*g_u(i,k,j)&amp;<a name='1302'>
&amp;*vel+g_vel*(0.58333333*(u(i,k,j)+u(i-1,k,j))-0.083333333*(u(i+1,k,j)+u(i-2,k,j)))<a name='1303'>
        fqx(i,k) = vel*(7./12.*(u(i,k,j)+u(i-1,k,j))-1./12.*(u(i+1,k,j)+u(i-2,k,j)))<a name='1304'>
      end do<a name='1305'>
    endif<a name='1306'>
    if (degrade_xe) then<a name='1307'>
      if (i_end .eq. ide-1) then<a name='1308'>
        i = ide<a name='1309'>
        do k = kts, ktf<a name='1310'>
          g_ub = g_u(i,k,j)<a name='1311'>
          ub = u(i,k,j)<a name='1312'>
          if (specified .and. u(i-1,k,j) .gt. 0.) then<a name='1313'>
            g_ub = g_u(i-1,k,j)<a name='1314'>
            ub = u(i-1,k,j)<a name='1315'>
          endif<a name='1316'>
          g_fqx(i,k) = 0.25*g_ru(i-1,k,j)*(u(i-1,k,j)+ub)+0.25*g_ru(i,k,j)*(u(i-1,k,j)+ub)+0.25*g_u(i-1,k,j)*(ru(i,k,j)+ru(i-1,k,j)&amp;<a name='1317'>
&amp;)+0.25*g_ub*(ru(i,k,j)+ru(i-1,k,j))<a name='1318'>
          fqx(i,k) = 0.25*(ru(i,k,j)+ru(i-1,k,j))*(u(i-1,k,j)+ub)<a name='1319'>
        end do<a name='1320'>
      endif<a name='1321'>
      do k = kts, ktf<a name='1322'>
        i = ide-1<a name='1323'>
        g_vel = 0.5*g_ru(i-1,k,j)+0.5*g_ru(i,k,j)<a name='1324'>
        vel = 0.5*(ru(i,k,j)+ru(i-1,k,j))<a name='1325'>
        g_fqx(i,k) = (-0.083333333)*g_u(i-2,k,j)*vel+0.58333333*g_u(i-1,k,j)*vel-0.083333333*g_u(i+1,k,j)*vel+0.58333333*g_u(i,k,j)&amp;<a name='1326'>
&amp;*vel+g_vel*(0.58333333*(u(i,k,j)+u(i-1,k,j))-0.083333333*(u(i+1,k,j)+u(i-2,k,j)))<a name='1327'>
        fqx(i,k) = vel*(7./12.*(u(i,k,j)+u(i-1,k,j))-1./12.*(u(i+1,k,j)+u(i-2,k,j)))<a name='1328'>
      end do<a name='1329'>
    endif<a name='1330'>
    do k = kts, ktf<a name='1331'>
      do i = i_start, i_end<a name='1332'>
        mrdx = msfu(i,j)*rdx<a name='1333'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='1334'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='1335'>
      end do<a name='1336'>
    end do<a name='1337'>
  end do<a name='1338'>
else if (horz_order .eq. 5) then horizontal_order_tesu<a name='1339'>
  degrade_xs =  .true. <a name='1340'>
  degrade_xe =  .true. <a name='1341'>
  degrade_ys =  .true. <a name='1342'>
  degrade_ye =  .true. <a name='1343'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+2) then<a name='1344'>
    degrade_xs =  .false. <a name='1345'>
  endif<a name='1346'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-2) then<a name='1347'>
    degrade_xe =  .false. <a name='1348'>
  endif<a name='1349'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+2) then<a name='1350'>
    degrade_ys =  .false. <a name='1351'>
  endif<a name='1352'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-3) then<a name='1353'>
    degrade_ye =  .false. <a name='1354'>
  endif<a name='1355'>
  i_start = its<a name='1356'>
  i_end = ite<a name='1357'>
  if (config_flags%open_xs .or. specified) then<a name='1358'>
    i_start = max(ids+1,its)<a name='1359'>
  endif<a name='1360'>
  if (config_flags%open_xe .or. specified) then<a name='1361'>
    i_end = min(ide-1,ite)<a name='1362'>
  endif<a name='1363'>
  j_start = jts<a name='1364'>
  j_end = min(jte,jde-1)<a name='1365'>
  j_start_f = j_start<a name='1366'>
  j_end_f = j_end+1<a name='1367'>
  if (degrade_ys) then<a name='1368'>
    j_start = max(jts,jds+1)<a name='1369'>
    j_start_f = jds+3<a name='1370'>
  endif<a name='1371'>
  if (degrade_ye) then<a name='1372'>
    j_end = min(jte,jde-2)<a name='1373'>
    j_end_f = jde-3<a name='1374'>
  endif<a name='1375'>
  jp1 = 2<a name='1376'>
  jp0 = 1<a name='1377'>
  j_loop_y_flux_5: do j = j_start, j_end+1<a name='1378'>
    if (j .ge. j_start_f .and. j .le. j_end_f) then<a name='1379'>
      do k = kts, ktf<a name='1380'>
        do i = i_start, i_end<a name='1381'>
          g_vel = 0.5*g_rv(i-1,k,j)+0.5*g_rv(i,k,j)<a name='1382'>
          vel = 0.5*(rv(i,k,j)+rv(i-1,k,j))<a name='1383'>
          g_fqy(i,k,jp1) = g_u(i,k,j-3)*vel*(0.016666667-(-0.016666667)*sign(1.,vel))+g_u(i,k,j-2)*vel*((-0.13333333)-0.083333333*&amp;<a name='1384'>
&amp;sign(1.,vel))+g_u(i,k,j-1)*vel*(0.61666667-(-0.16666667)*sign(1.,vel))+g_u(i,k,j+2)*vel*(0.016666667-0.016666667*&amp;<a name='1385'>
&amp;sign(1.,vel))+g_u(i,k,j+1)*vel*((-0.13333333)-(-0.083333333)*sign(1.,vel))+g_u(i,k,j)*vel*(0.61666667-0.16666667*&amp;<a name='1386'>
&amp;sign(1.,vel))+g_vel*(0.61666667*(u(i,k,j)+u(i,k,j-1))-0.13333333*(u(i,k,j+1)+u(i,k,j-2))+0.016666667*(u(i,k,j+2)+u(i,k,&amp;<a name='1387'>
&amp;j-3))-0.016666667*(u(i,k,j+2)-u(i,k,j-3)-5.*(u(i,k,j+1)-u(i,k,j-2))+10.*(u(i,k,j)-u(i,k,j-1)))*sign(1.,vel))<a name='1388'>
          fqy(i,k,jp1) = vel*(37./60.*(u(i,k,j)+u(i,k,j-1))-2./15.*(u(i,k,j+1)+u(i,k,j-2))+1./60.*(u(i,k,j+2)+u(i,k,j-3))-sign(1.,&amp;<a name='1389'>
&amp;vel)*(1./60.)*(u(i,k,j+2)-u(i,k,j-3)-5.*(u(i,k,j+1)-u(i,k,j-2))+10.*(u(i,k,j)-u(i,k,j-1))))<a name='1390'>
        end do<a name='1391'>
      end do<a name='1392'>
    else if (j .eq. jds+1) then<a name='1393'>
      do k = kts, ktf<a name='1394'>
        do i = i_start, i_end<a name='1395'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i-1,k,j)*(u(i,k,j)+u(i,k,j-1))+0.25*g_rv(i,k,j)*(u(i,k,j)+u(i,k,j-1))+0.25*g_u(i,k,j-1)*(rv(i,&amp;<a name='1396'>
&amp;k,j)+rv(i-1,k,j))+0.25*g_u(i,k,j)*(rv(i,k,j)+rv(i-1,k,j))<a name='1397'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i-1,k,j))*(u(i,k,j)+u(i,k,j-1))<a name='1398'>
        end do<a name='1399'>
      end do<a name='1400'>
    else if (j .eq. jds+2) then<a name='1401'>
      do k = kts, ktf<a name='1402'>
        do i = i_start, i_end<a name='1403'>
          g_vel = 0.5*g_rv(i-1,k,j)+0.5*g_rv(i,k,j)<a name='1404'>
          vel = 0.5*(rv(i,k,j)+rv(i-1,k,j))<a name='1405'>
          g_fqy(i,k,jp1) = g_u(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_u(i,k,j-1)*vel*(0.58333333+0.25*sign(1.,&amp;<a name='1406'>
&amp;vel))+g_u(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='1407'>
&amp;(0.58333333*(u(i,k,j)+u(i,k,j-1))-0.083333333*(u(i,k,j+1)+u(i,k,j-2))+0.083333333*(u(i,k,j+1)-u(i,k,j-2)-3.*(u(i,k,j)-&amp;<a name='1408'>
&amp;u(i,k,j-1)))*sign(1.,vel))<a name='1409'>
          fqy(i,k,jp1) = vel*(7./12.*(u(i,k,j)+u(i,k,j-1))-1./12.*(u(i,k,j+1)+u(i,k,j-2))+sign(1.,vel)*(1./12.)*(u(i,k,j+1)-u(i,k,&amp;<a name='1410'>
&amp;j-2)-3.*(u(i,k,j)-u(i,k,j-1))))<a name='1411'>
        end do<a name='1412'>
      end do<a name='1413'>
    else if (j .eq. jde-1) then<a name='1414'>
      do k = kts, ktf<a name='1415'>
        do i = i_start, i_end<a name='1416'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i-1,k,j)*(u(i,k,j)+u(i,k,j-1))+0.25*g_rv(i,k,j)*(u(i,k,j)+u(i,k,j-1))+0.25*g_u(i,k,j-1)*(rv(i,&amp;<a name='1417'>
&amp;k,j)+rv(i-1,k,j))+0.25*g_u(i,k,j)*(rv(i,k,j)+rv(i-1,k,j))<a name='1418'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i-1,k,j))*(u(i,k,j)+u(i,k,j-1))<a name='1419'>
        end do<a name='1420'>
      end do<a name='1421'>
    else if (j .eq. jde-2) then<a name='1422'>
      do k = kts, ktf<a name='1423'>
        do i = i_start, i_end<a name='1424'>
          g_vel = 0.5*g_rv(i-1,k,j)+0.5*g_rv(i,k,j)<a name='1425'>
          vel = 0.5*(rv(i,k,j)+rv(i-1,k,j))<a name='1426'>
          g_fqy(i,k,jp1) = g_u(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_u(i,k,j-1)*vel*(0.58333333+0.25*sign(1.,&amp;<a name='1427'>
&amp;vel))+g_u(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='1428'>
&amp;(0.58333333*(u(i,k,j)+u(i,k,j-1))-0.083333333*(u(i,k,j+1)+u(i,k,j-2))+0.083333333*(u(i,k,j+1)-u(i,k,j-2)-3.*(u(i,k,j)-&amp;<a name='1429'>
&amp;u(i,k,j-1)))*sign(1.,vel))<a name='1430'>
          fqy(i,k,jp1) = vel*(7./12.*(u(i,k,j)+u(i,k,j-1))-1./12.*(u(i,k,j+1)+u(i,k,j-2))+sign(1.,vel)*(1./12.)*(u(i,k,j+1)-u(i,k,&amp;<a name='1431'>
&amp;j-2)-3.*(u(i,k,j)-u(i,k,j-1))))<a name='1432'>
        end do<a name='1433'>
      end do<a name='1434'>
    endif<a name='1435'>
    if (j .gt. j_start) then<a name='1436'>
      do k = kts, ktf<a name='1437'>
        do i = i_start, i_end<a name='1438'>
          mrdy = msfu(i,j-1)*rdy<a name='1439'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='1440'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='1441'>
        end do<a name='1442'>
      end do<a name='1443'>
    endif<a name='1444'>
    jtmp = jp1<a name='1445'>
    jp1 = jp0<a name='1446'>
    jp0 = jtmp<a name='1447'>
  end do j_loop_y_flux_5<a name='1448'>
  i_start = its<a name='1449'>
  i_end = ite<a name='1450'>
  j_start = jts<a name='1451'>
  j_end = min(jte,jde-1)<a name='1452'>
  i_start_f = i_start<a name='1453'>
  i_end_f = i_end+1<a name='1454'>
  if (degrade_xs) then<a name='1455'>
    i_start = max(ids+1,its)<a name='1456'>
    i_start_f = ids+3<a name='1457'>
  endif<a name='1458'>
  if (degrade_xe) then<a name='1459'>
    i_end = min(ide-1,ite)<a name='1460'>
    i_end_f = ide-2<a name='1461'>
  endif<a name='1462'>
  do j = j_start, j_end<a name='1463'>
    do k = kts, ktf<a name='1464'>
      do i = i_start_f, i_end_f<a name='1465'>
        g_vel = 0.5*g_ru(i-1,k,j)+0.5*g_ru(i,k,j)<a name='1466'>
        vel = 0.5*(ru(i,k,j)+ru(i-1,k,j))<a name='1467'>
        g_fqx(i,k) = g_u(i-3,k,j)*vel*(0.016666667-(-0.016666667)*sign(1.,vel))+g_u(i-2,k,j)*vel*((-0.13333333)-0.083333333*&amp;<a name='1468'>
&amp;sign(1.,vel))+g_u(i-1,k,j)*vel*(0.61666667-(-0.16666667)*sign(1.,vel))+g_u(i+2,k,j)*vel*(0.016666667-0.016666667*sign(1.,&amp;<a name='1469'>
&amp;vel))+g_u(i+1,k,j)*vel*((-0.13333333)-(-0.083333333)*sign(1.,vel))+g_u(i,k,j)*vel*(0.61666667-0.16666667*sign(1.,vel))+&amp;<a name='1470'>
&amp;g_vel*(0.61666667*(u(i,k,j)+u(i-1,k,j))-0.13333333*(u(i+1,k,j)+u(i-2,k,j))+0.016666667*(u(i+2,k,j)+u(i-3,k,j))-&amp;<a name='1471'>
&amp;0.016666667*(u(i+2,k,j)-u(i-3,k,j)-5.*(u(i+1,k,j)-u(i-2,k,j))+10.*(u(i,k,j)-u(i-1,k,j)))*sign(1.,vel))<a name='1472'>
        fqx(i,k) = vel*(37./60.*(u(i,k,j)+u(i-1,k,j))-2./15.*(u(i+1,k,j)+u(i-2,k,j))+1./60.*(u(i+2,k,j)+u(i-3,k,j))-sign(1.,vel)*&amp;<a name='1473'>
&amp;(1./60.)*(u(i+2,k,j)-u(i-3,k,j)-5.*(u(i+1,k,j)-u(i-2,k,j))+10.*(u(i,k,j)-u(i-1,k,j))))<a name='1474'>
      end do<a name='1475'>
    end do<a name='1476'>
    if (degrade_xs) then<a name='1477'>
      if (i_start .eq. ids+1) then<a name='1478'>
        i = ids+1<a name='1479'>
        do k = kts, ktf<a name='1480'>
          g_ub = g_u(i-1,k,j)<a name='1481'>
          ub = u(i-1,k,j)<a name='1482'>
          if (specified .and. u(i,k,j) .lt. 0.) then<a name='1483'>
            g_ub = g_u(i,k,j)<a name='1484'>
            ub = u(i,k,j)<a name='1485'>
          endif<a name='1486'>
          g_fqx(i,k) = 0.25*g_ru(i-1,k,j)*(u(i,k,j)+ub)+0.25*g_ru(i,k,j)*(u(i,k,j)+ub)+0.25*g_u(i,k,j)*(ru(i,k,j)+ru(i-1,k,j))+&amp;<a name='1487'>
&amp;0.25*g_ub*(ru(i,k,j)+ru(i-1,k,j))<a name='1488'>
          fqx(i,k) = 0.25*(ru(i,k,j)+ru(i-1,k,j))*(u(i,k,j)+ub)<a name='1489'>
        end do<a name='1490'>
      endif<a name='1491'>
      i = ids+2<a name='1492'>
      do k = kts, ktf<a name='1493'>
        g_vel = 0.5*g_ru(i-1,k,j)+0.5*g_ru(i,k,j)<a name='1494'>
        vel = 0.5*(ru(i,k,j)+ru(i-1,k,j))<a name='1495'>
        g_fqx(i,k) = g_u(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_u(i-1,k,j)*vel*(0.58333333+0.25*sign(1.,vel))+&amp;<a name='1496'>
&amp;g_u(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='1497'>
&amp;(0.58333333*(u(i,k,j)+u(i-1,k,j))-0.083333333*(u(i+1,k,j)+u(i-2,k,j))+0.083333333*(u(i+1,k,j)-u(i-2,k,j)-3.*(u(i,k,j)-u(i-&amp;<a name='1498'>
&amp;1,k,j)))*sign(1.,vel))<a name='1499'>
        fqx(i,k) = vel*(7./12.*(u(i,k,j)+u(i-1,k,j))-1./12.*(u(i+1,k,j)+u(i-2,k,j))+sign(1.,vel)*(1./12.)*(u(i+1,k,j)-u(i-2,k,j)-&amp;<a name='1500'>
&amp;3.*(u(i,k,j)-u(i-1,k,j))))<a name='1501'>
      end do<a name='1502'>
    endif<a name='1503'>
    if (degrade_xe) then<a name='1504'>
      if (i_end .eq. ide-1) then<a name='1505'>
        i = ide<a name='1506'>
        do k = kts, ktf<a name='1507'>
          g_ub = g_u(i,k,j)<a name='1508'>
          ub = u(i,k,j)<a name='1509'>
          if (specified .and. u(i-1,k,j) .gt. 0.) then<a name='1510'>
            g_ub = g_u(i-1,k,j)<a name='1511'>
            ub = u(i-1,k,j)<a name='1512'>
          endif<a name='1513'>
          g_fqx(i,k) = 0.25*g_ru(i-1,k,j)*(u(i-1,k,j)+ub)+0.25*g_ru(i,k,j)*(u(i-1,k,j)+ub)+0.25*g_u(i-1,k,j)*(ru(i,k,j)+ru(i-1,k,j)&amp;<a name='1514'>
&amp;)+0.25*g_ub*(ru(i,k,j)+ru(i-1,k,j))<a name='1515'>
          fqx(i,k) = 0.25*(ru(i,k,j)+ru(i-1,k,j))*(u(i-1,k,j)+ub)<a name='1516'>
        end do<a name='1517'>
      endif<a name='1518'>
      do k = kts, ktf<a name='1519'>
        i = ide-1<a name='1520'>
        g_vel = 0.5*g_ru(i-1,k,j)+0.5*g_ru(i,k,j)<a name='1521'>
        vel = 0.5*(ru(i,k,j)+ru(i-1,k,j))<a name='1522'>
        g_fqx(i,k) = g_u(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_u(i-1,k,j)*vel*(0.58333333+0.25*sign(1.,vel))+&amp;<a name='1523'>
&amp;g_u(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='1524'>
&amp;(0.58333333*(u(i,k,j)+u(i-1,k,j))-0.083333333*(u(i+1,k,j)+u(i-2,k,j))+0.083333333*(u(i+1,k,j)-u(i-2,k,j)-3.*(u(i,k,j)-u(i-&amp;<a name='1525'>
&amp;1,k,j)))*sign(1.,vel))<a name='1526'>
        fqx(i,k) = vel*(7./12.*(u(i,k,j)+u(i-1,k,j))-1./12.*(u(i+1,k,j)+u(i-2,k,j))+sign(1.,vel)*(1./12.)*(u(i+1,k,j)-u(i-2,k,j)-&amp;<a name='1527'>
&amp;3.*(u(i,k,j)-u(i-1,k,j))))<a name='1528'>
      end do<a name='1529'>
    endif<a name='1530'>
    do k = kts, ktf<a name='1531'>
      do i = i_start, i_end<a name='1532'>
        mrdx = msfu(i,j)*rdx<a name='1533'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='1534'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='1535'>
      end do<a name='1536'>
    end do<a name='1537'>
  end do<a name='1538'>
else if (horz_order .eq. 4) then horizontal_order_tesu<a name='1539'>
  degrade_xs =  .true. <a name='1540'>
  degrade_xe =  .true. <a name='1541'>
  degrade_ys =  .true. <a name='1542'>
  degrade_ye =  .true. <a name='1543'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+1) then<a name='1544'>
    degrade_xs =  .false. <a name='1545'>
  endif<a name='1546'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-1) then<a name='1547'>
    degrade_xe =  .false. <a name='1548'>
  endif<a name='1549'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+1) then<a name='1550'>
    degrade_ys =  .false. <a name='1551'>
  endif<a name='1552'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-2) then<a name='1553'>
    degrade_ye =  .false. <a name='1554'>
  endif<a name='1555'>
  i_start = its<a name='1556'>
  i_end = ite<a name='1557'>
  j_start = jts<a name='1558'>
  j_end = min(jte,jde-1)<a name='1559'>
  i_start_f = i_start<a name='1560'>
  i_end_f = i_end+1<a name='1561'>
  if (degrade_xs) then<a name='1562'>
    i_start = ids+1<a name='1563'>
    i_start_f = i_start+1<a name='1564'>
  endif<a name='1565'>
  if (degrade_xe) then<a name='1566'>
    i_end = ide-1<a name='1567'>
    i_end_f = ide-1<a name='1568'>
  endif<a name='1569'>
  do j = j_start, j_end<a name='1570'>
    do k = kts, ktf<a name='1571'>
      do i = i_start_f, i_end_f<a name='1572'>
        g_vel = 0.5*g_ru(i-1,k,j)+0.5*g_ru(i,k,j)<a name='1573'>
        vel = 0.5*(ru(i,k,j)+ru(i-1,k,j))<a name='1574'>
        g_fqx(i,k) = (-0.083333333)*g_u(i-2,k,j)*vel+0.58333333*g_u(i-1,k,j)*vel-0.083333333*g_u(i+1,k,j)*vel+0.58333333*g_u(i,k,j)&amp;<a name='1575'>
&amp;*vel+g_vel*(0.58333333*(u(i,k,j)+u(i-1,k,j))-0.083333333*(u(i+1,k,j)+u(i-2,k,j)))<a name='1576'>
        fqx(i,k) = vel*(7./12.*(u(i,k,j)+u(i-1,k,j))-1./12.*(u(i+1,k,j)+u(i-2,k,j)))<a name='1577'>
      end do<a name='1578'>
    end do<a name='1579'>
    if (degrade_xs) then<a name='1580'>
      i = i_start<a name='1581'>
      do k = kts, ktf<a name='1582'>
        g_ub = g_u(i-1,k,j)<a name='1583'>
        ub = u(i-1,k,j)<a name='1584'>
        if (specified .and. u(i,k,j) .lt. 0.) then<a name='1585'>
          g_ub = g_u(i,k,j)<a name='1586'>
          ub = u(i,k,j)<a name='1587'>
        endif<a name='1588'>
        g_fqx(i,k) = 0.25*g_ru(i-1,k,j)*(u(i,k,j)+ub)+0.25*g_ru(i,k,j)*(u(i,k,j)+ub)+0.25*g_u(i,k,j)*(ru(i,k,j)+ru(i-1,k,j))+0.25*&amp;<a name='1589'>
&amp;g_ub*(ru(i,k,j)+ru(i-1,k,j))<a name='1590'>
        fqx(i,k) = 0.25*(ru(i,k,j)+ru(i-1,k,j))*(u(i,k,j)+ub)<a name='1591'>
      end do<a name='1592'>
    endif<a name='1593'>
    if (degrade_xe) then<a name='1594'>
      i = i_end+1<a name='1595'>
      do k = kts, ktf<a name='1596'>
        g_ub = g_u(i,k,j)<a name='1597'>
        ub = u(i,k,j)<a name='1598'>
        if (specified .and. u(i-1,k,j) .gt. 0.) then<a name='1599'>
          g_ub = g_u(i-1,k,j)<a name='1600'>
          ub = u(i-1,k,j)<a name='1601'>
        endif<a name='1602'>
        g_fqx(i,k) = 0.25*g_ru(i-1,k,j)*(u(i-1,k,j)+ub)+0.25*g_ru(i,k,j)*(u(i-1,k,j)+ub)+0.25*g_u(i-1,k,j)*(ru(i,k,j)+ru(i-1,k,j))+&amp;<a name='1603'>
&amp;0.25*g_ub*(ru(i,k,j)+ru(i-1,k,j))<a name='1604'>
        fqx(i,k) = 0.25*(ru(i,k,j)+ru(i-1,k,j))*(u(i-1,k,j)+ub)<a name='1605'>
      end do<a name='1606'>
    endif<a name='1607'>
    do k = kts, ktf<a name='1608'>
      do i = i_start, i_end<a name='1609'>
        mrdx = msfu(i,j)*rdx<a name='1610'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='1611'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='1612'>
      end do<a name='1613'>
    end do<a name='1614'>
  end do<a name='1615'>
  i_start = its<a name='1616'>
  i_end = ite<a name='1617'>
  if (config_flags%open_xs .or. specified) then<a name='1618'>
    i_start = max(ids+1,its)<a name='1619'>
  endif<a name='1620'>
  if (config_flags%open_xe .or. specified) then<a name='1621'>
    i_end = min(ide-1,ite)<a name='1622'>
  endif<a name='1623'>
  j_start = jts<a name='1624'>
  j_end = min(jte,jde-1)<a name='1625'>
  j_start_f = j_start<a name='1626'>
  j_end_f = j_end+1<a name='1627'>
  if (degrade_ys) then<a name='1628'>
    j_start = jds+1<a name='1629'>
    j_start_f = j_start+1<a name='1630'>
  endif<a name='1631'>
  if (degrade_ye) then<a name='1632'>
    j_end = jde-2<a name='1633'>
    j_end_f = jde-2<a name='1634'>
  endif<a name='1635'>
  jp1 = 2<a name='1636'>
  jp0 = 1<a name='1637'>
  do j = j_start, j_end+1<a name='1638'>
    if (j .lt. j_start_f .and. degrade_ys) then<a name='1639'>
      do k = kts, ktf<a name='1640'>
        do i = i_start, i_end<a name='1641'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i-1,k,j_start)*(u(i,k,j_start)+u(i,k,j_start-1))+0.25*g_rv(i,k,j_start)*(u(i,k,j_start)+u(i,k,&amp;<a name='1642'>
&amp;j_start-1))+0.25*g_u(i,k,j_start-1)*(rv(i,k,j_start)+rv(i-1,k,j_start))+0.25*g_u(i,k,j_start)*(rv(i,k,j_start)+rv(i-1,k,j_start))<a name='1643'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j_start)+rv(i-1,k,j_start))*(u(i,k,j_start)+u(i,k,j_start-1))<a name='1644'>
        end do<a name='1645'>
      end do<a name='1646'>
    else if (j .gt. j_end_f .and. degrade_ye) then<a name='1647'>
      do k = kts, ktf<a name='1648'>
        do i = i_start, i_end<a name='1649'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i-1,k,j_end+1)*(u(i,k,j_end+1)+u(i,k,j_end))+0.25*g_rv(i,k,j_end+1)*(u(i,k,j_end+1)+u(i,k,&amp;<a name='1650'>
&amp;j_end))+0.25*g_u(i,k,j_end+1)*(rv(i,k,j_end+1)+rv(i-1,k,j_end+1))+0.25*g_u(i,k,j_end)*(rv(i,k,j_end+1)+rv(i-1,k,j_end+1))<a name='1651'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j_end+1)+rv(i-1,k,j_end+1))*(u(i,k,j_end+1)+u(i,k,j_end))<a name='1652'>
        end do<a name='1653'>
      end do<a name='1654'>
    else<a name='1655'>
      do k = kts, ktf<a name='1656'>
        do i = i_start, i_end<a name='1657'>
          g_vel = 0.5*g_rv(i-1,k,j)+0.5*g_rv(i,k,j)<a name='1658'>
          vel = 0.5*(rv(i,k,j)+rv(i-1,k,j))<a name='1659'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_u(i,k,j-2)*vel+0.58333333*g_u(i,k,j-1)*vel-0.083333333*g_u(i,k,j+1)*vel+0.58333333*&amp;<a name='1660'>
&amp;g_u(i,k,j)*vel+g_vel*(0.58333333*(u(i,k,j)+u(i,k,j-1))-0.083333333*(u(i,k,j+1)+u(i,k,j-2)))<a name='1661'>
          fqy(i,k,jp1) = vel*(7./12.*(u(i,k,j)+u(i,k,j-1))-1./12.*(u(i,k,j+1)+u(i,k,j-2)))<a name='1662'>
        end do<a name='1663'>
      end do<a name='1664'>
    endif<a name='1665'>
    if (j .gt. j_start) then<a name='1666'>
      do k = kts, ktf<a name='1667'>
        do i = i_start, i_end<a name='1668'>
          mrdy = msfu(i,j-1)*rdy<a name='1669'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='1670'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='1671'>
        end do<a name='1672'>
      end do<a name='1673'>
    endif<a name='1674'>
    jtmp = jp1<a name='1675'>
    jp1 = jp0<a name='1676'>
    jp0 = jtmp<a name='1677'>
  end do<a name='1678'>
else if (horz_order .eq. 3) then horizontal_order_tesu<a name='1679'>
  degrade_xs =  .true. <a name='1680'>
  degrade_xe =  .true. <a name='1681'>
  degrade_ys =  .true. <a name='1682'>
  degrade_ye =  .true. <a name='1683'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+1) then<a name='1684'>
    degrade_xs =  .false. <a name='1685'>
  endif<a name='1686'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-1) then<a name='1687'>
    degrade_xe =  .false. <a name='1688'>
  endif<a name='1689'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+1) then<a name='1690'>
    degrade_ys =  .false. <a name='1691'>
  endif<a name='1692'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-2) then<a name='1693'>
    degrade_ye =  .false. <a name='1694'>
  endif<a name='1695'>
  i_start = its<a name='1696'>
  i_end = ite<a name='1697'>
  j_start = jts<a name='1698'>
  j_end = min(jte,jde-1)<a name='1699'>
  i_start_f = i_start<a name='1700'>
  i_end_f = i_end+1<a name='1701'>
  if (degrade_xs) then<a name='1702'>
    i_start = ids+1<a name='1703'>
    i_start_f = i_start+1<a name='1704'>
  endif<a name='1705'>
  if (degrade_xe) then<a name='1706'>
    i_end = ide-1<a name='1707'>
    i_end_f = ide-1<a name='1708'>
  endif<a name='1709'>
  do j = j_start, j_end<a name='1710'>
    do k = kts, ktf<a name='1711'>
      do i = i_start_f, i_end_f<a name='1712'>
        g_vel = 0.5*g_ru(i-1,k,j)+0.5*g_ru(i,k,j)<a name='1713'>
        vel = 0.5*(ru(i,k,j)+ru(i-1,k,j))<a name='1714'>
        g_fqx(i,k) = g_u(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_u(i-1,k,j)*vel*(0.58333333+0.25*sign(1.,vel))+&amp;<a name='1715'>
&amp;g_u(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='1716'>
&amp;(0.58333333*(u(i,k,j)+u(i-1,k,j))-0.083333333*(u(i+1,k,j)+u(i-2,k,j))+0.083333333*(u(i+1,k,j)-u(i-2,k,j)-3.*(u(i,k,j)-u(i-&amp;<a name='1717'>
&amp;1,k,j)))*sign(1.,vel))<a name='1718'>
        fqx(i,k) = vel*(7./12.*(u(i,k,j)+u(i-1,k,j))-1./12.*(u(i+1,k,j)+u(i-2,k,j))+sign(1.,vel)*(1./12.)*(u(i+1,k,j)-u(i-2,k,j)-&amp;<a name='1719'>
&amp;3.*(u(i,k,j)-u(i-1,k,j))))<a name='1720'>
      end do<a name='1721'>
    end do<a name='1722'>
    if (degrade_xs) then<a name='1723'>
      i = i_start<a name='1724'>
      do k = kts, ktf<a name='1725'>
        g_ub = g_u(i-1,k,j)<a name='1726'>
        ub = u(i-1,k,j)<a name='1727'>
        if (specified .and. u(i,k,j) .lt. 0.) then<a name='1728'>
          g_ub = g_u(i,k,j)<a name='1729'>
          ub = u(i,k,j)<a name='1730'>
        endif<a name='1731'>
        g_fqx(i,k) = 0.25*g_ru(i-1,k,j)*(u(i,k,j)+ub)+0.25*g_ru(i,k,j)*(u(i,k,j)+ub)+0.25*g_u(i,k,j)*(ru(i,k,j)+ru(i-1,k,j))+0.25*&amp;<a name='1732'>
&amp;g_ub*(ru(i,k,j)+ru(i-1,k,j))<a name='1733'>
        fqx(i,k) = 0.25*(ru(i,k,j)+ru(i-1,k,j))*(u(i,k,j)+ub)<a name='1734'>
      end do<a name='1735'>
    endif<a name='1736'>
    if (degrade_xe) then<a name='1737'>
      i = i_end+1<a name='1738'>
      do k = kts, ktf<a name='1739'>
        g_ub = g_u(i,k,j)<a name='1740'>
        ub = u(i,k,j)<a name='1741'>
        if (specified .and. u(i-1,k,j) .gt. 0.) then<a name='1742'>
          g_ub = g_u(i-1,k,j)<a name='1743'>
          ub = u(i-1,k,j)<a name='1744'>
        endif<a name='1745'>
        g_fqx(i,k) = 0.25*g_ru(i-1,k,j)*(u(i-1,k,j)+ub)+0.25*g_ru(i,k,j)*(u(i-1,k,j)+ub)+0.25*g_u(i-1,k,j)*(ru(i,k,j)+ru(i-1,k,j))+&amp;<a name='1746'>
&amp;0.25*g_ub*(ru(i,k,j)+ru(i-1,k,j))<a name='1747'>
        fqx(i,k) = 0.25*(ru(i,k,j)+ru(i-1,k,j))*(u(i-1,k,j)+ub)<a name='1748'>
      end do<a name='1749'>
    endif<a name='1750'>
    do k = kts, ktf<a name='1751'>
      do i = i_start, i_end<a name='1752'>
        mrdx = msfu(i,j)*rdx<a name='1753'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='1754'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='1755'>
      end do<a name='1756'>
    end do<a name='1757'>
  end do<a name='1758'>
  i_start = its<a name='1759'>
  i_end = ite<a name='1760'>
  if (config_flags%open_xs .or. specified) then<a name='1761'>
    i_start = max(ids+1,its)<a name='1762'>
  endif<a name='1763'>
  if (config_flags%open_xe .or. specified) then<a name='1764'>
    i_end = min(ide-1,ite)<a name='1765'>
  endif<a name='1766'>
  j_start = jts<a name='1767'>
  j_end = min(jte,jde-1)<a name='1768'>
  j_start_f = j_start<a name='1769'>
  j_end_f = j_end+1<a name='1770'>
  if (degrade_ys) then<a name='1771'>
    j_start = jds+1<a name='1772'>
    j_start_f = j_start+1<a name='1773'>
  endif<a name='1774'>
  if (degrade_ye) then<a name='1775'>
    j_end = jde-2<a name='1776'>
    j_end_f = jde-2<a name='1777'>
  endif<a name='1778'>
  jp1 = 2<a name='1779'>
  jp0 = 1<a name='1780'>
  do j = j_start, j_end+1<a name='1781'>
    if (j .lt. j_start_f .and. degrade_ys) then<a name='1782'>
      do k = kts, ktf<a name='1783'>
        do i = i_start, i_end<a name='1784'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i-1,k,j_start)*(u(i,k,j_start)+u(i,k,j_start-1))+0.25*g_rv(i,k,j_start)*(u(i,k,j_start)+u(i,k,&amp;<a name='1785'>
&amp;j_start-1))+0.25*g_u(i,k,j_start-1)*(rv(i,k,j_start)+rv(i-1,k,j_start))+0.25*g_u(i,k,j_start)*(rv(i,k,j_start)+rv(i-1,k,j_start))<a name='1786'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j_start)+rv(i-1,k,j_start))*(u(i,k,j_start)+u(i,k,j_start-1))<a name='1787'>
        end do<a name='1788'>
      end do<a name='1789'>
    else if (j .gt. j_end_f .and. degrade_ye) then<a name='1790'>
      do k = kts, ktf<a name='1791'>
        do i = i_start, i_end<a name='1792'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i-1,k,j_end+1)*(u(i,k,j_end+1)+u(i,k,j_end))+0.25*g_rv(i,k,j_end+1)*(u(i,k,j_end+1)+u(i,k,&amp;<a name='1793'>
&amp;j_end))+0.25*g_u(i,k,j_end+1)*(rv(i,k,j_end+1)+rv(i-1,k,j_end+1))+0.25*g_u(i,k,j_end)*(rv(i,k,j_end+1)+rv(i-1,k,j_end+1))<a name='1794'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j_end+1)+rv(i-1,k,j_end+1))*(u(i,k,j_end+1)+u(i,k,j_end))<a name='1795'>
        end do<a name='1796'>
      end do<a name='1797'>
    else<a name='1798'>
      do k = kts, ktf<a name='1799'>
        do i = i_start, i_end<a name='1800'>
          g_vel = 0.5*g_rv(i-1,k,j)+0.5*g_rv(i,k,j)<a name='1801'>
          vel = 0.5*(rv(i,k,j)+rv(i-1,k,j))<a name='1802'>
          g_fqy(i,k,jp1) = g_u(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_u(i,k,j-1)*vel*(0.58333333+0.25*sign(1.,&amp;<a name='1803'>
&amp;vel))+g_u(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='1804'>
&amp;(0.58333333*(u(i,k,j)+u(i,k,j-1))-0.083333333*(u(i,k,j+1)+u(i,k,j-2))+0.083333333*(u(i,k,j+1)-u(i,k,j-2)-3.*(u(i,k,j)-&amp;<a name='1805'>
&amp;u(i,k,j-1)))*sign(1.,vel))<a name='1806'>
          fqy(i,k,jp1) = vel*(7./12.*(u(i,k,j)+u(i,k,j-1))-1./12.*(u(i,k,j+1)+u(i,k,j-2))+sign(1.,vel)*(1./12.)*(u(i,k,j+1)-u(i,k,&amp;<a name='1807'>
&amp;j-2)-3.*(u(i,k,j)-u(i,k,j-1))))<a name='1808'>
        end do<a name='1809'>
      end do<a name='1810'>
    endif<a name='1811'>
    if (j .gt. j_start) then<a name='1812'>
      do k = kts, ktf<a name='1813'>
        do i = i_start, i_end<a name='1814'>
          mrdy = msfu(i,j-1)*rdy<a name='1815'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='1816'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='1817'>
        end do<a name='1818'>
      end do<a name='1819'>
    endif<a name='1820'>
    jtmp = jp1<a name='1821'>
    jp1 = jp0<a name='1822'>
    jp0 = jtmp<a name='1823'>
  end do<a name='1824'>
else if (horz_order .eq. 2) then horizontal_order_tesu<a name='1825'>
  i_start = its<a name='1826'>
  i_end = ite<a name='1827'>
  j_start = jts<a name='1828'>
  j_end = min(jte,jde-1)<a name='1829'>
  if (config_flags%open_xs) then<a name='1830'>
    i_start = max(ids+1,its)<a name='1831'>
  endif<a name='1832'>
  if (config_flags%open_xe) then<a name='1833'>
    i_end = min(ide-1,ite)<a name='1834'>
  endif<a name='1835'>
  if (specified) then<a name='1836'>
    i_start = max(ids+2,its)<a name='1837'>
  endif<a name='1838'>
  if (specified) then<a name='1839'>
    i_end = min(ide-2,ite)<a name='1840'>
  endif<a name='1841'>
  do j = j_start, j_end<a name='1842'>
    do k = kts, ktf<a name='1843'>
      do i = i_start, i_end<a name='1844'>
        mrdx = msfu(i,j)*rdx<a name='1845'>
        g_tendency(i,k,j) = 0.25*g_ru(i-1,k,j)*mrdx*(u(i,k,j)+u(i-1,k,j))-0.25*g_ru(i+1,k,j)*mrdx*(u(i+1,k,j)+u(i,k,j))-0.25*&amp;<a name='1846'>
&amp;g_ru(i,k,j)*mrdx*(u(i+1,k,j)+u(i,k,j)-(u(i,k,j)+u(i-1,k,j)))+g_tendency(i,k,j)+0.25*g_u(i-1,k,j)*mrdx*(ru(i,k,j)+ru(i-1,k,&amp;<a name='1847'>
&amp;j))-0.25*g_u(i+1,k,j)*mrdx*(ru(i+1,k,j)+ru(i,k,j))-0.25*g_u(i,k,j)*mrdx*(ru(i+1,k,j)+ru(i,k,j)-(ru(i,k,j)+ru(i-1,k,j)))<a name='1848'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*0.25*((ru(i+1,k,j)+ru(i,k,j))*(u(i+1,k,j)+u(i,k,j))-(ru(i,k,j)+ru(i-1,k,j))*(u(i,k,&amp;<a name='1849'>
&amp;j)+u(i-1,k,j)))<a name='1850'>
      end do<a name='1851'>
    end do<a name='1852'>
  end do<a name='1853'>
  if (specified .and. its .le. ids+1) then<a name='1854'>
    do j = j_start, j_end<a name='1855'>
      do k = kts, ktf<a name='1856'>
        i = ids+1<a name='1857'>
        mrdx = msfu(i,j)*rdx<a name='1858'>
        g_ub = g_u(i-1,k,j)<a name='1859'>
        ub = u(i-1,k,j)<a name='1860'>
        if (u(i,k,j) .lt. 0.) then<a name='1861'>
          g_ub = g_u(i,k,j)<a name='1862'>
          ub = u(i,k,j)<a name='1863'>
        endif<a name='1864'>
        g_tendency(i,k,j) = 0.25*g_ru(i-1,k,j)*mrdx*(u(i,k,j)+ub)-0.25*g_ru(i+1,k,j)*mrdx*(u(i+1,k,j)+u(i,k,j))-0.25*g_ru(i,k,j)*&amp;<a name='1865'>
&amp;mrdx*(u(i+1,k,j)+u(i,k,j)-(u(i,k,j)+ub))+g_tendency(i,k,j)-0.25*g_u(i+1,k,j)*mrdx*(ru(i+1,k,j)+ru(i,k,j))-0.25*g_u(i,k,j)*&amp;<a name='1866'>
&amp;mrdx*(ru(i+1,k,j)+ru(i,k,j)-(ru(i,k,j)+ru(i-1,k,j)))+0.25*g_ub*mrdx*(ru(i,k,j)+ru(i-1,k,j))<a name='1867'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*0.25*((ru(i+1,k,j)+ru(i,k,j))*(u(i+1,k,j)+u(i,k,j))-(ru(i,k,j)+ru(i-1,k,j))*(u(i,k,&amp;<a name='1868'>
&amp;j)+ub))<a name='1869'>
      end do<a name='1870'>
    end do<a name='1871'>
  endif<a name='1872'>
  if (specified .and. ite .ge. ide-1) then<a name='1873'>
    do j = j_start, j_end<a name='1874'>
      do k = kts, ktf<a name='1875'>
        i = ide-1<a name='1876'>
        mrdx = msfu(i,j)*rdx<a name='1877'>
        g_ub = g_u(i+1,k,j)<a name='1878'>
        ub = u(i+1,k,j)<a name='1879'>
        if (u(i,k,j) .gt. 0.) then<a name='1880'>
          g_ub = g_u(i,k,j)<a name='1881'>
          ub = u(i,k,j)<a name='1882'>
        endif<a name='1883'>
        g_tendency(i,k,j) = 0.25*g_ru(i-1,k,j)*mrdx*(u(i,k,j)+u(i-1,k,j))-0.25*g_ru(i+1,k,j)*mrdx*(ub+u(i,k,j))-0.25*g_ru(i,k,j)*&amp;<a name='1884'>
&amp;mrdx*(ub+u(i,k,j)-(u(i,k,j)+u(i-1,k,j)))+g_tendency(i,k,j)+0.25*g_u(i-1,k,j)*mrdx*(ru(i,k,j)+ru(i-1,k,j))-0.25*g_u(i,k,j)*&amp;<a name='1885'>
&amp;mrdx*(ru(i+1,k,j)+ru(i,k,j)-(ru(i,k,j)+ru(i-1,k,j)))-0.25*g_ub*mrdx*(ru(i+1,k,j)+ru(i,k,j))<a name='1886'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*0.25*((ru(i+1,k,j)+ru(i,k,j))*(ub+u(i,k,j))-(ru(i,k,j)+ru(i-1,k,j))*(u(i,k,j)+u(i-1,&amp;<a name='1887'>
&amp;k,j)))<a name='1888'>
      end do<a name='1889'>
    end do<a name='1890'>
  endif<a name='1891'>
  if (config_flags%open_ys .or. specified) then<a name='1892'>
    j_start = max(jds+1,jts)<a name='1893'>
  endif<a name='1894'>
  if (config_flags%open_ye .or. specified) then<a name='1895'>
    j_end = min(jde-2,jte)<a name='1896'>
  endif<a name='1897'>
  do j = j_start, j_end<a name='1898'>
    do k = kts, ktf<a name='1899'>
      do i = i_start, i_end<a name='1900'>
        mrdy = msfu(i,j)*rdy<a name='1901'>
        g_tendency(i,k,j) = (-(0.25*g_rv(i-1,k,j+1)*mrdy*(u(i,k,j+1)+u(i,k,j))))-0.25*g_rv(i,k,j+1)*mrdy*(u(i,k,j+1)+u(i,k,j))+&amp;<a name='1902'>
&amp;0.25*g_rv(i-1,k,j)*mrdy*(u(i,k,j)+u(i,k,j-1))+0.25*g_rv(i,k,j)*mrdy*(u(i,k,j)+u(i,k,j-1))+g_tendency(i,k,j)+0.25*g_u(i,k,&amp;<a name='1903'>
&amp;j-1)*mrdy*(rv(i,k,j)+rv(i-1,k,j))-0.25*g_u(i,k,j+1)*mrdy*(rv(i,k,j+1)+rv(i-1,k,j+1))-0.25*g_u(i,k,j)*mrdy*(rv(i,k,j+1)+&amp;<a name='1904'>
&amp;rv(i-1,k,j+1)-(rv(i,k,j)+rv(i-1,k,j)))<a name='1905'>
        tendency(i,k,j) = tendency(i,k,j)-mrdy*0.25*((rv(i,k,j+1)+rv(i-1,k,j+1))*(u(i,k,j+1)+u(i,k,j))-(rv(i,k,j)+rv(i-1,k,j))*&amp;<a name='1906'>
&amp;(u(i,k,j)+u(i,k,j-1)))<a name='1907'>
      end do<a name='1908'>
    end do<a name='1909'>
  end do<a name='1910'>
else horizontal_order_tesu<a name='1911'>
  write(unit=wrf_err_message,fmt=*) 'module_advect: advect_u_6a:  h_order not known ',horz_order<a name='1912'>
endif horizontal_order_tesu<a name='1913'>
if (config_flags%open_xs .and. its .eq. ids) then<a name='1914'>
  j_start = jts<a name='1915'>
  j_end = min(jte,jde-1)<a name='1916'>
  do j = j_start, j_end<a name='1917'>
    do k = kts, ktf<a name='1918'>
      g_ub = (-(g_mut(its,j)*(0.5+sign(0.5,0.-(ru(its,k,j)-cb*mut(its,j))))*cb))+g_ru(its,k,j)*(0.5+sign(0.5,0.-(ru(its,k,j)-cb*&amp;<a name='1919'>
&amp;mut(its,j))))<a name='1920'>
      ub = min(ru(its,k,j)-cb*mut(its,j),0.)<a name='1921'>
      g_tendency(its,k,j) = g_tendency(its,k,j)-g_u_old(its+1,k,j)*rdx*ub+g_u_old(its,k,j)*rdx*ub-g_ub*rdx*(u_old(its+1,k,j)-&amp;<a name='1922'>
&amp;u_old(its,k,j))<a name='1923'>
      tendency(its,k,j) = tendency(its,k,j)-rdx*ub*(u_old(its+1,k,j)-u_old(its,k,j))<a name='1924'>
    end do<a name='1925'>
  end do<a name='1926'>
endif<a name='1927'>
if (config_flags%open_xe .and. ite .eq. ide) then<a name='1928'>
  j_start = jts<a name='1929'>
  j_end = min(jte,jde-1)<a name='1930'>
  do j = j_start, j_end<a name='1931'>
    do k = kts, ktf<a name='1932'>
      g_ub = g_mut(ite-1,j)*(0.5+sign(0.5,ru(ite,k,j)+cb*mut(ite-1,j)-0.))*cb+g_ru(ite,k,j)*(0.5+sign(0.5,ru(ite,k,j)+cb*mut(ite-1,&amp;<a name='1933'>
&amp;j)-0.))<a name='1934'>
      ub = max(ru(ite,k,j)+cb*mut(ite-1,j),0.)<a name='1935'>
      g_tendency(ite,k,j) = g_tendency(ite,k,j)+g_u_old(ite-1,k,j)*rdx*ub-g_u_old(ite,k,j)*rdx*ub-g_ub*rdx*(u_old(ite,k,j)-&amp;<a name='1936'>
&amp;u_old(ite-1,k,j))<a name='1937'>
      tendency(ite,k,j) = tendency(ite,k,j)-rdx*ub*(u_old(ite,k,j)-u_old(ite-1,k,j))<a name='1938'>
    end do<a name='1939'>
  end do<a name='1940'>
endif<a name='1941'>
i_start = its<a name='1942'>
i_end = min(ite,ide)<a name='1943'>
imin = ids<a name='1944'>
imax = ide-1<a name='1945'>
if (config_flags%open_xs) then<a name='1946'>
  i_start = max(ids+1,its)<a name='1947'>
  imin = ids<a name='1948'>
endif<a name='1949'>
if (config_flags%open_xe) then<a name='1950'>
  i_end = min(ite,ide-1)<a name='1951'>
  imax = ide-1<a name='1952'>
endif<a name='1953'>
if (config_flags%open_ys .and. jts .eq. jds) then<a name='1954'>
  do i = i_start, i_end<a name='1955'>
    mrdy = msfu(i,jts)*rdy<a name='1956'>
    ip = min(imax,i)<a name='1957'>
    im = max(imin,i-1)<a name='1958'>
    do k = kts, ktf<a name='1959'>
      g_vw = 0.5*g_rv(im,k,jts)+0.5*g_rv(ip,k,jts)<a name='1960'>
      vw = 0.5*(rv(ip,k,jts)+rv(im,k,jts))<a name='1961'>
      g_vb = g_vw*(0.5+sign(0.5,0.-vw))<a name='1962'>
      vb = min(vw,0.)<a name='1963'>
      g_dvm = g_rv(ip,k,jts+1)-g_rv(ip,k,jts)<a name='1964'>
      dvm = rv(ip,k,jts+1)-rv(ip,k,jts)<a name='1965'>
      g_dvp = g_rv(im,k,jts+1)-g_rv(im,k,jts)<a name='1966'>
      dvp = rv(im,k,jts+1)-rv(im,k,jts)<a name='1967'>
      g_tendency(i,k,jts) = (-(0.5*g_dvm*mrdy*u(i,k,jts)))-0.5*g_dvp*mrdy*u(i,k,jts)+g_tendency(i,k,jts)-0.5*g_u(i,k,jts)*mrdy*&amp;<a name='1968'>
&amp;(dvm+dvp)-g_u_old(i,k,jts+1)*mrdy*vb+g_u_old(i,k,jts)*mrdy*vb-g_vb*mrdy*(u_old(i,k,jts+1)-u_old(i,k,jts))<a name='1969'>
      tendency(i,k,jts) = tendency(i,k,jts)-mrdy*(vb*(u_old(i,k,jts+1)-u_old(i,k,jts))+0.5*u(i,k,jts)*(dvm+dvp))<a name='1970'>
    end do<a name='1971'>
  end do<a name='1972'>
endif<a name='1973'>
if (config_flags%open_ye .and. jte .eq. jde) then<a name='1974'>
  do i = i_start, i_end<a name='1975'>
    mrdy = msfu(i,jte-1)*rdy<a name='1976'>
    ip = min(imax,i)<a name='1977'>
    im = max(imin,i-1)<a name='1978'>
    do k = kts, ktf<a name='1979'>
      g_vw = 0.5*g_rv(im,k,jte)+0.5*g_rv(ip,k,jte)<a name='1980'>
      vw = 0.5*(rv(ip,k,jte)+rv(im,k,jte))<a name='1981'>
      g_vb = g_vw*(0.5+sign(0.5,vw-0.))<a name='1982'>
      vb = max(vw,0.)<a name='1983'>
      g_dvm = (-g_rv(ip,k,jte-1))+g_rv(ip,k,jte)<a name='1984'>
      dvm = rv(ip,k,jte)-rv(ip,k,jte-1)<a name='1985'>
      g_dvp = (-g_rv(im,k,jte-1))+g_rv(im,k,jte)<a name='1986'>
      dvp = rv(im,k,jte)-rv(im,k,jte-1)<a name='1987'>
      g_tendency(i,k,jte-1) = (-(0.5*g_dvm*mrdy*u(i,k,jte-1)))-0.5*g_dvp*mrdy*u(i,k,jte-1)+g_tendency(i,k,jte-1)-0.5*g_u(i,k,jte-1)&amp;<a name='1988'>
&amp;*mrdy*(dvm+dvp)+g_u_old(i,k,jte-2)*mrdy*vb-g_u_old(i,k,jte-1)*mrdy*vb-g_vb*mrdy*(u_old(i,k,jte-1)-u_old(i,k,jte-2))<a name='1989'>
      tendency(i,k,jte-1) = tendency(i,k,jte-1)-mrdy*(vb*(u_old(i,k,jte-1)-u_old(i,k,jte-2))+0.5*u(i,k,jte-1)*(dvm+dvp))<a name='1990'>
    end do<a name='1991'>
  end do<a name='1992'>
endif<a name='1993'>
i_start = its<a name='1994'>
i_end = ite<a name='1995'>
j_start = jts<a name='1996'>
j_end = min(jte,jde-1)<a name='1997'>
if (config_flags%open_ys .or. specified) then<a name='1998'>
  i_start = max(ids+1,its)<a name='1999'>
endif<a name='2000'>
if (config_flags%open_ye .or. specified) then<a name='2001'>
  i_end = min(ide-1,ite)<a name='2002'>
endif<a name='2003'>
do i = i_start, i_end<a name='2004'>
  g_vflux(i,kts) = 0.<a name='2005'>
  vflux(i,kts) = 0.<a name='2006'>
  g_vflux(i,kte) = 0.<a name='2007'>
  vflux(i,kte) = 0.<a name='2008'>
end do<a name='2009'>
vert_order_tesu: if (vert_order .eq. 6) then<a name='2010'>
  do j = j_start, j_end<a name='2011'>
    do k = kts+3, ktf-2<a name='2012'>
      do i = i_start, i_end<a name='2013'>
        g_vel = 0.5*g_rom(i-1,k,j)+0.5*g_rom(i,k,j)<a name='2014'>
        vel = 0.5*(rom(i-1,k,j)+rom(i,k,j))<a name='2015'>
        g_vflux(i,k) = 0.016666667*g_u(i,k-3,j)*vel-0.13333333*g_u(i,k-2,j)*vel+0.61666667*g_u(i,k-1,j)*vel+0.016666667*g_u(i,k+2,&amp;<a name='2016'>
&amp;j)*vel-0.13333333*g_u(i,k+1,j)*vel+0.61666667*g_u(i,k,j)*vel+g_vel*(0.61666667*(u(i,k,j)+u(i,k-1,j))-0.13333333*(u(i,k+1,&amp;<a name='2017'>
&amp;j)+u(i,k-2,j))+0.016666667*(u(i,k+2,j)+u(i,k-3,j)))<a name='2018'>
        vflux(i,k) = vel*(37./60.*(u(i,k,j)+u(i,k-1,j))-2./15.*(u(i,k+1,j)+u(i,k-2,j))+1./60.*(u(i,k+2,j)+u(i,k-3,j)))<a name='2019'>
      end do<a name='2020'>
    end do<a name='2021'>
    do i = i_start, i_end<a name='2022'>
      k = kts+1<a name='2023'>
      g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2024'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2025'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2026'>
      k = kts+2<a name='2027'>
      g_vel = 0.5*g_rom(i-1,k,j)+0.5*g_rom(i,k,j)<a name='2028'>
      vel = 0.5*(rom(i,k,j)+rom(i-1,k,j))<a name='2029'>
      g_vflux(i,k) = (-0.083333333)*g_u(i,k-2,j)*vel+0.58333333*g_u(i,k-1,j)*vel-0.083333333*g_u(i,k+1,j)*vel+0.58333333*g_u(i,k,j)&amp;<a name='2030'>
&amp;*vel+g_vel*(0.58333333*(u(i,k,j)+u(i,k-1,j))-0.083333333*(u(i,k+1,j)+u(i,k-2,j)))<a name='2031'>
      vflux(i,k) = vel*(7./12.*(u(i,k,j)+u(i,k-1,j))-1./12.*(u(i,k+1,j)+u(i,k-2,j)))<a name='2032'>
      k = ktf-1<a name='2033'>
      g_vel = 0.5*g_rom(i-1,k,j)+0.5*g_rom(i,k,j)<a name='2034'>
      vel = 0.5*(rom(i,k,j)+rom(i-1,k,j))<a name='2035'>
      g_vflux(i,k) = (-0.083333333)*g_u(i,k-2,j)*vel+0.58333333*g_u(i,k-1,j)*vel-0.083333333*g_u(i,k+1,j)*vel+0.58333333*g_u(i,k,j)&amp;<a name='2036'>
&amp;*vel+g_vel*(0.58333333*(u(i,k,j)+u(i,k-1,j))-0.083333333*(u(i,k+1,j)+u(i,k-2,j)))<a name='2037'>
      vflux(i,k) = vel*(7./12.*(u(i,k,j)+u(i,k-1,j))-1./12.*(u(i,k+1,j)+u(i,k-2,j)))<a name='2038'>
      k = ktf<a name='2039'>
      g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2040'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2041'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2042'>
    end do<a name='2043'>
    do k = kts, ktf<a name='2044'>
      do i = i_start, i_end<a name='2045'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='2046'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='2047'>
      end do<a name='2048'>
    end do<a name='2049'>
  end do<a name='2050'>
else if (vert_order .eq. 5) then vert_order_tesu<a name='2051'>
  do j = j_start, j_end<a name='2052'>
    do k = kts+3, ktf-2<a name='2053'>
      do i = i_start, i_end<a name='2054'>
        g_vel = 0.5*g_rom(i-1,k,j)+0.5*g_rom(i,k,j)<a name='2055'>
        vel = 0.5*(rom(i-1,k,j)+rom(i,k,j))<a name='2056'>
        g_vflux(i,k) = g_u(i,k-3,j)*vel*(0.016666667-(-0.016666667)*sign(1.,-vel))+g_u(i,k-2,j)*vel*((-0.13333333)-0.083333333*&amp;<a name='2057'>
&amp;sign(1.,-vel))+g_u(i,k-1,j)*vel*(0.61666667-(-0.16666667)*sign(1.,-vel))+g_u(i,k+2,j)*vel*(0.016666667-0.016666667*&amp;<a name='2058'>
&amp;sign(1.,-vel))+g_u(i,k+1,j)*vel*((-0.13333333)-(-0.083333333)*sign(1.,-vel))+g_u(i,k,j)*vel*(0.61666667-0.16666667*&amp;<a name='2059'>
&amp;sign(1.,-vel))+g_vel*(0.61666667*(u(i,k,j)+u(i,k-1,j))-0.13333333*(u(i,k+1,j)+u(i,k-2,j))+0.016666667*(u(i,k+2,j)+u(i,k-3,&amp;<a name='2060'>
&amp;j))-0.016666667*(u(i,k+2,j)-u(i,k-3,j)-5.*(u(i,k+1,j)-u(i,k-2,j))+10.*(u(i,k,j)-u(i,k-1,j)))*sign(1.,-vel))<a name='2061'>
        vflux(i,k) = vel*(37./60.*(u(i,k,j)+u(i,k-1,j))-2./15.*(u(i,k+1,j)+u(i,k-2,j))+1./60.*(u(i,k+2,j)+u(i,k-3,j))-sign(1.,-vel)&amp;<a name='2062'>
&amp;*(1./60.)*(u(i,k+2,j)-u(i,k-3,j)-5.*(u(i,k+1,j)-u(i,k-2,j))+10.*(u(i,k,j)-u(i,k-1,j))))<a name='2063'>
      end do<a name='2064'>
    end do<a name='2065'>
    do i = i_start, i_end<a name='2066'>
      k = kts+1<a name='2067'>
      g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2068'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2069'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2070'>
      k = kts+2<a name='2071'>
      g_vel = 0.5*g_rom(i-1,k,j)+0.5*g_rom(i,k,j)<a name='2072'>
      vel = 0.5*(rom(i,k,j)+rom(i-1,k,j))<a name='2073'>
      g_vflux(i,k) = g_u(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_u(i,k-1,j)*vel*(0.58333333+0.25*sign(1.,-vel)&amp;<a name='2074'>
&amp;)+g_u(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,-vel))+g_vel*&amp;<a name='2075'>
&amp;(0.58333333*(u(i,k,j)+u(i,k-1,j))-0.083333333*(u(i,k+1,j)+u(i,k-2,j))+0.083333333*(u(i,k+1,j)-u(i,k-2,j)-3.*(u(i,k,j)-u(i,k-&amp;<a name='2076'>
&amp;1,j)))*sign(1.,-vel))<a name='2077'>
      vflux(i,k) = vel*(7./12.*(u(i,k,j)+u(i,k-1,j))-1./12.*(u(i,k+1,j)+u(i,k-2,j))+sign(1.,-vel)*(1./12.)*(u(i,k+1,j)-u(i,k-2,j)-&amp;<a name='2078'>
&amp;3.*(u(i,k,j)-u(i,k-1,j))))<a name='2079'>
      k = ktf-1<a name='2080'>
      g_vel = 0.5*g_rom(i-1,k,j)+0.5*g_rom(i,k,j)<a name='2081'>
      vel = 0.5*(rom(i,k,j)+rom(i-1,k,j))<a name='2082'>
      g_vflux(i,k) = g_u(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_u(i,k-1,j)*vel*(0.58333333+0.25*sign(1.,-vel)&amp;<a name='2083'>
&amp;)+g_u(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,-vel))+g_vel*&amp;<a name='2084'>
&amp;(0.58333333*(u(i,k,j)+u(i,k-1,j))-0.083333333*(u(i,k+1,j)+u(i,k-2,j))+0.083333333*(u(i,k+1,j)-u(i,k-2,j)-3.*(u(i,k,j)-u(i,k-&amp;<a name='2085'>
&amp;1,j)))*sign(1.,-vel))<a name='2086'>
      vflux(i,k) = vel*(7./12.*(u(i,k,j)+u(i,k-1,j))-1./12.*(u(i,k+1,j)+u(i,k-2,j))+sign(1.,-vel)*(1./12.)*(u(i,k+1,j)-u(i,k-2,j)-&amp;<a name='2087'>
&amp;3.*(u(i,k,j)-u(i,k-1,j))))<a name='2088'>
      k = ktf<a name='2089'>
      g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2090'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2091'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2092'>
    end do<a name='2093'>
    do k = kts, ktf<a name='2094'>
      do i = i_start, i_end<a name='2095'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='2096'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='2097'>
      end do<a name='2098'>
    end do<a name='2099'>
  end do<a name='2100'>
else if (vert_order .eq. 4) then vert_order_tesu<a name='2101'>
  do j = j_start, j_end<a name='2102'>
    do k = kts+2, ktf-1<a name='2103'>
      do i = i_start, i_end<a name='2104'>
        g_vel = 0.5*g_rom(i-1,k,j)+0.5*g_rom(i,k,j)<a name='2105'>
        vel = 0.5*(rom(i-1,k,j)+rom(i,k,j))<a name='2106'>
        g_vflux(i,k) = (-0.083333333)*g_u(i,k-2,j)*vel+0.58333333*g_u(i,k-1,j)*vel-0.083333333*g_u(i,k+1,j)*vel+0.58333333*g_u(i,k,&amp;<a name='2107'>
&amp;j)*vel+g_vel*(0.58333333*(u(i,k,j)+u(i,k-1,j))-0.083333333*(u(i,k+1,j)+u(i,k-2,j)))<a name='2108'>
        vflux(i,k) = vel*(7./12.*(u(i,k,j)+u(i,k-1,j))-1./12.*(u(i,k+1,j)+u(i,k-2,j)))<a name='2109'>
      end do<a name='2110'>
    end do<a name='2111'>
    do i = i_start, i_end<a name='2112'>
      k = kts+1<a name='2113'>
      g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2114'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2115'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2116'>
      k = ktf<a name='2117'>
      g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2118'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2119'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2120'>
    end do<a name='2121'>
    do k = kts, ktf<a name='2122'>
      do i = i_start, i_end<a name='2123'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='2124'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='2125'>
      end do<a name='2126'>
    end do<a name='2127'>
  end do<a name='2128'>
else if (vert_order .eq. 3) then vert_order_tesu<a name='2129'>
  do j = j_start, j_end<a name='2130'>
    do k = kts+2, ktf-1<a name='2131'>
      do i = i_start, i_end<a name='2132'>
        g_vel = 0.5*g_rom(i-1,k,j)+0.5*g_rom(i,k,j)<a name='2133'>
        vel = 0.5*(rom(i-1,k,j)+rom(i,k,j))<a name='2134'>
        g_vflux(i,k) = g_u(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_u(i,k-1,j)*vel*(0.58333333+0.25*sign(1.,-&amp;<a name='2135'>
&amp;vel))+g_u(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_u(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,-vel))+g_vel*&amp;<a name='2136'>
&amp;(0.58333333*(u(i,k,j)+u(i,k-1,j))-0.083333333*(u(i,k+1,j)+u(i,k-2,j))+0.083333333*(u(i,k+1,j)-u(i,k-2,j)-3.*(u(i,k,j)-u(i,&amp;<a name='2137'>
&amp;k-1,j)))*sign(1.,-vel))<a name='2138'>
        vflux(i,k) = vel*(7./12.*(u(i,k,j)+u(i,k-1,j))-1./12.*(u(i,k+1,j)+u(i,k-2,j))+sign(1.,-vel)*(1./12.)*(u(i,k+1,j)-u(i,k-2,j)&amp;<a name='2139'>
&amp;-3.*(u(i,k,j)-u(i,k-1,j))))<a name='2140'>
      end do<a name='2141'>
    end do<a name='2142'>
    do i = i_start, i_end<a name='2143'>
      k = kts+1<a name='2144'>
      g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2145'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2146'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2147'>
      k = ktf<a name='2148'>
      g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2149'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2150'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2151'>
    end do<a name='2152'>
    do k = kts, ktf<a name='2153'>
      do i = i_start, i_end<a name='2154'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='2155'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='2156'>
      end do<a name='2157'>
    end do<a name='2158'>
  end do<a name='2159'>
else if (vert_order .eq. 2) then vert_order_tesu<a name='2160'>
  do j = j_start, j_end<a name='2161'>
    do k = kts+1, ktf<a name='2162'>
      do i = i_start, i_end<a name='2163'>
        g_vflux(i,k) = 0.5*g_rom(i-1,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))+&amp;<a name='2164'>
&amp;0.5*g_u(i,k-1,j)*(rom(i,k,j)+rom(i-1,k,j))*fzp(k)+0.5*g_u(i,k,j)*(rom(i,k,j)+rom(i-1,k,j))*fzm(k)<a name='2165'>
        vflux(i,k) = 0.5*(rom(i,k,j)+rom(i-1,k,j))*(fzm(k)*u(i,k,j)+fzp(k)*u(i,k-1,j))<a name='2166'>
      end do<a name='2167'>
    end do<a name='2168'>
    do k = kts, ktf<a name='2169'>
      do i = i_start, i_end<a name='2170'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='2171'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='2172'>
      end do<a name='2173'>
    end do<a name='2174'>
  end do<a name='2175'>
endif vert_order_tesu<a name='2176'>
<a name='2177'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_U' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_7">("g_advect_u")<a name='2178'>
<a name='2179'>
end subroutine g_advect_u<a name='2180'>
<a name='2181'>
<a name='2182'>
<A NAME='G_ADVECT_V'><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_V' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2183'>
<font color=#993300>subroutine </font><font color=#cc0000>g_advect_v</font>( v, g_v, v_old, g_v_old, tendency, g_tendency, ru, g_ru, rv, g_rv, rom, g_rom, mut, g_mut, config_flags, &amp; <A href='../../call_to/G_ADVECT_V.html' TARGET='index'>2</A>,<A href='../../call_from/G_ADVECT_V.html' TARGET='index'>2</A><a name='2184'>
&amp;msfv, fzm, fzp, rdx, rdy, rdzw, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='2185'>
<font color=#447700>!******************************************************************<a name='2186'></font>
<font color=#447700>!******************************************************************<a name='2187'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='2188'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='2189'></font>
<font color=#447700>!******************************************************************<a name='2190'></font>
<font color=#447700>!******************************************************************<a name='2191'></font>
<font color=#447700>!==============================================<a name='2192'></font>
<font color=#447700>! all entries are defined explicitly<a name='2193'></font>
<font color=#447700>!==============================================<a name='2194'></font>
implicit none<a name='2195'>
<a name='2196'>
<font color=#447700>!==============================================<a name='2197'></font>
<font color=#447700>! declare arguments<a name='2198'></font>
<font color=#447700>!==============================================<a name='2199'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='2200'>
integer, intent(in) :: kme<a name='2201'>
integer, intent(in) :: kms<a name='2202'>
real, intent(in) :: fzm(kms:kme)<a name='2203'>
real, intent(in) :: fzp(kms:kme)<a name='2204'>
integer, intent(in) :: ime<a name='2205'>
integer, intent(in) :: ims<a name='2206'>
integer, intent(in) :: jme<a name='2207'>
integer, intent(in) :: jms<a name='2208'>
real, intent(in) :: g_mut(ims:ime,jms:jme)<a name='2209'>
real, intent(in) :: g_rom(ims:ime,kms:kme,jms:jme)<a name='2210'>
real, intent(in) :: g_ru(ims:ime,kms:kme,jms:jme)<a name='2211'>
real, intent(in) :: g_rv(ims:ime,kms:kme,jms:jme)<a name='2212'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='2213'>
real, intent(in) :: g_v(ims:ime,kms:kme,jms:jme)<a name='2214'>
real, intent(in) :: g_v_old(ims:ime,kms:kme,jms:jme)<a name='2215'>
integer, intent(in) :: ide<a name='2216'>
integer, intent(in) :: ids<a name='2217'>
integer, intent(in) :: ite<a name='2218'>
integer, intent(in) :: its<a name='2219'>
integer, intent(in) :: jde<a name='2220'>
integer, intent(in) :: jds<a name='2221'>
integer, intent(in) :: jte<a name='2222'>
integer, intent(in) :: jts<a name='2223'>
integer, intent(in) :: kde<a name='2224'>
integer, intent(in) :: kte<a name='2225'>
integer, intent(in) :: kts<a name='2226'>
real, intent(in) :: msfv(ims:ime,jms:jme)<a name='2227'>
real, intent(in) :: mut(ims:ime,jms:jme)<a name='2228'>
real, intent(in) :: rdx<a name='2229'>
real, intent(in) :: rdy<a name='2230'>
real, intent(in) :: rdzw(kms:kme)<a name='2231'>
real, intent(in) :: rom(ims:ime,kms:kme,jms:jme)<a name='2232'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='2233'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='2234'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='2235'>
real, intent(in) :: v(ims:ime,kms:kme,jms:jme)<a name='2236'>
real, intent(in) :: v_old(ims:ime,kms:kme,jms:jme)<a name='2237'>
<a name='2238'>
<font color=#447700>!==============================================<a name='2239'></font>
<font color=#447700>! declare local variables<a name='2240'></font>
<font color=#447700>!==============================================<a name='2241'></font>
logical degrade_xe<a name='2242'>
logical degrade_xs<a name='2243'>
logical degrade_ye<a name='2244'>
logical degrade_ys<a name='2245'>
real dum<a name='2246'>
real dup<a name='2247'>
real fqx(its:ite+1,kts:kte)<a name='2248'>
real fqy(its:ite,kts:kte,2)<a name='2249'>
real g_dum<a name='2250'>
real g_dup<a name='2251'>
real g_fqx(its:ite+1,kts:kte)<a name='2252'>
real g_fqy(its:ite,kts:kte,2)<a name='2253'>
real g_ub<a name='2254'>
real g_uw<a name='2255'>
real g_vb<a name='2256'>
real g_vel<a name='2257'>
real g_vflux(its:ite,kts:kte)<a name='2258'>
integer horz_order<a name='2259'>
integer i<a name='2260'>
integer i_end<a name='2261'>
integer i_end_f<a name='2262'>
integer i_start<a name='2263'>
integer i_start_f<a name='2264'>
integer j<a name='2265'>
integer j_end<a name='2266'>
integer j_end_f<a name='2267'>
integer j_start<a name='2268'>
integer j_start_f<a name='2269'>
integer jm<a name='2270'>
integer jmax<a name='2271'>
integer jmin<a name='2272'>
integer jp<a name='2273'>
integer jp0<a name='2274'>
integer jp1<a name='2275'>
integer jtmp<a name='2276'>
integer k<a name='2277'>
integer ktf<a name='2278'>
real mrdx<a name='2279'>
real mrdy<a name='2280'>
logical specified<a name='2281'>
real ub<a name='2282'>
real uw<a name='2283'>
real vb<a name='2284'>
real vel<a name='2285'>
integer vert_order<a name='2286'>
real vflux(its:ite,kts:kte)<a name='2287'>
<a name='2288'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_V' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_8">("g_advect_v")<a name='2289'>
<a name='2290'>
<font color=#447700>!----------------------------------------------<a name='2291'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='2292'></font>
<font color=#447700>!----------------------------------------------<a name='2293'></font>
specified =  .false. <a name='2294'>
if (config_flags%specified .or. config_flags%nested) then<a name='2295'>
  specified =  .true. <a name='2296'>
endif<a name='2297'>
ktf = min(kte,kde-1)<a name='2298'>
horz_order = config_flags%h_mom_adv_order<a name='2299'>
vert_order = config_flags%v_mom_adv_order<a name='2300'>
horizontal_order_tesu: if (horz_order .eq. 6) then<a name='2301'>
  degrade_xs =  .true. <a name='2302'>
  degrade_xe =  .true. <a name='2303'>
  degrade_ys =  .true. <a name='2304'>
  degrade_ye =  .true. <a name='2305'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+2) then<a name='2306'>
    degrade_xs =  .false. <a name='2307'>
  endif<a name='2308'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-3) then<a name='2309'>
    degrade_xe =  .false. <a name='2310'>
  endif<a name='2311'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+2) then<a name='2312'>
    degrade_ys =  .false. <a name='2313'>
  endif<a name='2314'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-2) then<a name='2315'>
    degrade_ye =  .false. <a name='2316'>
  endif<a name='2317'>
  ktf = min(kte,kde-1)<a name='2318'>
  i_start = its<a name='2319'>
  i_end = min(ite,ide-1)<a name='2320'>
  j_start = jts<a name='2321'>
  j_end = jte<a name='2322'>
  j_start_f = j_start<a name='2323'>
  j_end_f = j_end+1<a name='2324'>
  if (degrade_ys) then<a name='2325'>
    j_start = max(jts,jds+1)<a name='2326'>
    j_start_f = jds+3<a name='2327'>
  endif<a name='2328'>
  if (degrade_ye) then<a name='2329'>
    j_end = min(jte,jde-1)<a name='2330'>
    j_end_f = jde-2<a name='2331'>
  endif<a name='2332'>
  jp1 = 2<a name='2333'>
  jp0 = 1<a name='2334'>
  j_loop_y_flux_6: do j = j_start, j_end+1<a name='2335'>
    if (j .ge. j_start_f .and. j .le. j_end_f) then<a name='2336'>
      do k = kts, ktf<a name='2337'>
        do i = i_start, i_end<a name='2338'>
          g_vel = 0.5*g_rv(i,k,j-1)+0.5*g_rv(i,k,j)<a name='2339'>
          vel = 0.5*(rv(i,k,j)+rv(i,k,j-1))<a name='2340'>
          g_fqy(i,k,jp1) = 0.016666667*g_v(i,k,j-3)*vel-0.13333333*g_v(i,k,j-2)*vel+0.61666667*g_v(i,k,j-1)*vel+0.016666667*g_v(i,&amp;<a name='2341'>
&amp;k,j+2)*vel-0.13333333*g_v(i,k,j+1)*vel+0.61666667*g_v(i,k,j)*vel+g_vel*(0.61666667*(v(i,k,j)+v(i,k,j-1))-0.13333333*&amp;<a name='2342'>
&amp;(v(i,k,j+1)+v(i,k,j-2))+0.016666667*(v(i,k,j+2)+v(i,k,j-3)))<a name='2343'>
          fqy(i,k,jp1) = vel*(37./60.*(v(i,k,j)+v(i,k,j-1))-2./15.*(v(i,k,j+1)+v(i,k,j-2))+1./60.*(v(i,k,j+2)+v(i,k,j-3)))<a name='2344'>
        end do<a name='2345'>
      end do<a name='2346'>
    else if (j .eq. jds+1) then<a name='2347'>
      do k = kts, ktf<a name='2348'>
        do i = i_start, i_end<a name='2349'>
          g_vb = g_v(i,k,j-1)<a name='2350'>
          vb = v(i,k,j-1)<a name='2351'>
          if (specified .and. v(i,k,j) .lt. 0.) then<a name='2352'>
            g_vb = g_v(i,k,j)<a name='2353'>
            vb = v(i,k,j)<a name='2354'>
          endif<a name='2355'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i,k,j-1)*(v(i,k,j)+vb)+0.25*g_rv(i,k,j)*(v(i,k,j)+vb)+0.25*g_v(i,k,j)*(rv(i,k,j)+rv(i,k,j-1))+&amp;<a name='2356'>
&amp;0.25*g_vb*(rv(i,k,j)+rv(i,k,j-1))<a name='2357'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i,k,j-1))*(v(i,k,j)+vb)<a name='2358'>
        end do<a name='2359'>
      end do<a name='2360'>
    else if (j .eq. jds+2) then<a name='2361'>
      do k = kts, ktf<a name='2362'>
        do i = i_start, i_end<a name='2363'>
          g_vel = 0.5*g_rv(i,k,j-1)+0.5*g_rv(i,k,j)<a name='2364'>
          vel = 0.5*(rv(i,k,j)+rv(i,k,j-1))<a name='2365'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_v(i,k,j-2)*vel+0.58333333*g_v(i,k,j-1)*vel-0.083333333*g_v(i,k,j+1)*vel+0.58333333*&amp;<a name='2366'>
&amp;g_v(i,k,j)*vel+g_vel*(0.58333333*(v(i,k,j)+v(i,k,j-1))-0.083333333*(v(i,k,j+1)+v(i,k,j-2)))<a name='2367'>
          fqy(i,k,jp1) = vel*(7./12.*(v(i,k,j)+v(i,k,j-1))-1./12.*(v(i,k,j+1)+v(i,k,j-2)))<a name='2368'>
        end do<a name='2369'>
      end do<a name='2370'>
    else if (j .eq. jde) then<a name='2371'>
      do k = kts, ktf<a name='2372'>
        do i = i_start, i_end<a name='2373'>
          g_vb = g_v(i,k,j)<a name='2374'>
          vb = v(i,k,j)<a name='2375'>
          if (specified .and. v(i,k,j-1) .gt. 0.) then<a name='2376'>
            g_vb = g_v(i,k,j-1)<a name='2377'>
            vb = v(i,k,j-1)<a name='2378'>
          endif<a name='2379'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i,k,j-1)*(vb+v(i,k,j-1))+0.25*g_rv(i,k,j)*(vb+v(i,k,j-1))+0.25*g_v(i,k,j-1)*(rv(i,k,j)+rv(i,k,&amp;<a name='2380'>
&amp;j-1))+0.25*g_vb*(rv(i,k,j)+rv(i,k,j-1))<a name='2381'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i,k,j-1))*(vb+v(i,k,j-1))<a name='2382'>
        end do<a name='2383'>
      end do<a name='2384'>
    else if (j .eq. jde-1) then<a name='2385'>
      do k = kts, ktf<a name='2386'>
        do i = i_start, i_end<a name='2387'>
          g_vel = 0.5*g_rv(i,k,j-1)+0.5*g_rv(i,k,j)<a name='2388'>
          vel = 0.5*(rv(i,k,j)+rv(i,k,j-1))<a name='2389'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_v(i,k,j-2)*vel+0.58333333*g_v(i,k,j-1)*vel-0.083333333*g_v(i,k,j+1)*vel+0.58333333*&amp;<a name='2390'>
&amp;g_v(i,k,j)*vel+g_vel*(0.58333333*(v(i,k,j)+v(i,k,j-1))-0.083333333*(v(i,k,j+1)+v(i,k,j-2)))<a name='2391'>
          fqy(i,k,jp1) = vel*(7./12.*(v(i,k,j)+v(i,k,j-1))-1./12.*(v(i,k,j+1)+v(i,k,j-2)))<a name='2392'>
        end do<a name='2393'>
      end do<a name='2394'>
    endif<a name='2395'>
    if (j .gt. j_start) then<a name='2396'>
      do k = kts, ktf<a name='2397'>
        do i = i_start, i_end<a name='2398'>
          mrdy = msfv(i,j-1)*rdy<a name='2399'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='2400'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='2401'>
        end do<a name='2402'>
      end do<a name='2403'>
    endif<a name='2404'>
    jtmp = jp1<a name='2405'>
    jp1 = jp0<a name='2406'>
    jp0 = jtmp<a name='2407'>
  end do j_loop_y_flux_6<a name='2408'>
  i_start = its<a name='2409'>
  i_end = min(ite,ide-1)<a name='2410'>
  j_start = jts<a name='2411'>
  j_end = jte<a name='2412'>
  if (config_flags%open_ys .or. specified) then<a name='2413'>
    j_start = max(jds+1,jts)<a name='2414'>
  endif<a name='2415'>
  if (config_flags%open_ye .or. specified) then<a name='2416'>
    j_end = min(jde-1,jte)<a name='2417'>
  endif<a name='2418'>
  i_start_f = i_start<a name='2419'>
  i_end_f = i_end+1<a name='2420'>
  if (degrade_xs) then<a name='2421'>
    i_start = max(ids+1,its)<a name='2422'>
    i_start_f = i_start+2<a name='2423'>
  endif<a name='2424'>
  if (degrade_xe) then<a name='2425'>
    i_end = min(ide-2,ite)<a name='2426'>
    i_end_f = ide-3<a name='2427'>
  endif<a name='2428'>
  do j = j_start, j_end<a name='2429'>
    do k = kts, ktf<a name='2430'>
      do i = i_start_f, i_end_f<a name='2431'>
        g_vel = 0.5*g_ru(i,k,j-1)+0.5*g_ru(i,k,j)<a name='2432'>
        vel = 0.5*(ru(i,k,j)+ru(i,k,j-1))<a name='2433'>
        g_fqx(i,k) = 0.016666667*g_v(i-3,k,j)*vel-0.13333333*g_v(i-2,k,j)*vel+0.61666667*g_v(i-1,k,j)*vel+0.016666667*g_v(i+2,k,j)*&amp;<a name='2434'>
&amp;vel-0.13333333*g_v(i+1,k,j)*vel+0.61666667*g_v(i,k,j)*vel+g_vel*(0.61666667*(v(i,k,j)+v(i-1,k,j))-0.13333333*(v(i+1,k,j)+&amp;<a name='2435'>
&amp;v(i-2,k,j))+0.016666667*(v(i+2,k,j)+v(i-3,k,j)))<a name='2436'>
        fqx(i,k) = vel*(37./60.*(v(i,k,j)+v(i-1,k,j))-2./15.*(v(i+1,k,j)+v(i-2,k,j))+1./60.*(v(i+2,k,j)+v(i-3,k,j)))<a name='2437'>
      end do<a name='2438'>
    end do<a name='2439'>
    if (degrade_xs) then<a name='2440'>
      if (i_start .eq. ids+1) then<a name='2441'>
        i = ids+1<a name='2442'>
        do k = kts, ktf<a name='2443'>
          g_fqx(i,k) = 0.25*g_ru(i,k,j-1)*(v(i,k,j)+v(i-1,k,j))+0.25*g_ru(i,k,j)*(v(i,k,j)+v(i-1,k,j))+0.25*g_v(i-1,k,j)*(ru(i,k,j)&amp;<a name='2444'>
&amp;+ru(i,k,j-1))+0.25*g_v(i,k,j)*(ru(i,k,j)+ru(i,k,j-1))<a name='2445'>
          fqx(i,k) = 0.25*(ru(i,k,j)+ru(i,k,j-1))*(v(i,k,j)+v(i-1,k,j))<a name='2446'>
        end do<a name='2447'>
      endif<a name='2448'>
      i = ids+2<a name='2449'>
      do k = kts, ktf<a name='2450'>
        g_vel = 0.5*g_ru(i,k,j-1)+0.5*g_ru(i,k,j)<a name='2451'>
        vel = 0.5*(ru(i,k,j)+ru(i,k,j-1))<a name='2452'>
        g_fqx(i,k) = (-0.083333333)*g_v(i-2,k,j)*vel+0.58333333*g_v(i-1,k,j)*vel-0.083333333*g_v(i+1,k,j)*vel+0.58333333*g_v(i,k,j)&amp;<a name='2453'>
&amp;*vel+g_vel*(0.58333333*(v(i,k,j)+v(i-1,k,j))-0.083333333*(v(i+1,k,j)+v(i-2,k,j)))<a name='2454'>
        fqx(i,k) = vel*(7./12.*(v(i,k,j)+v(i-1,k,j))-1./12.*(v(i+1,k,j)+v(i-2,k,j)))<a name='2455'>
      end do<a name='2456'>
    endif<a name='2457'>
    if (degrade_xe) then<a name='2458'>
      if (i_end .eq. ide-2) then<a name='2459'>
        i = ide-1<a name='2460'>
        do k = kts, ktf<a name='2461'>
          g_fqx(i,k) = 0.25*g_ru(i_end+1,k,j-1)*(v(i_end+1,k,j)+v(i_end,k,j))+0.25*g_ru(i_end+1,k,j)*(v(i_end+1,k,j)+v(i_end,k,j))+&amp;<a name='2462'>
&amp;0.25*g_v(i_end+1,k,j)*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))+0.25*g_v(i_end,k,j)*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))<a name='2463'>
          fqx(i,k) = 0.25*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))*(v(i_end+1,k,j)+v(i_end,k,j))<a name='2464'>
        end do<a name='2465'>
      endif<a name='2466'>
      i = ide-2<a name='2467'>
      do k = kts, ktf<a name='2468'>
        g_vel = 0.5*g_ru(i,k,j-1)+0.5*g_ru(i,k,j)<a name='2469'>
        vel = 0.5*(ru(i,k,j)+ru(i,k,j-1))<a name='2470'>
        g_fqx(i,k) = (-0.083333333)*g_v(i-2,k,j)*vel+0.58333333*g_v(i-1,k,j)*vel-0.083333333*g_v(i+1,k,j)*vel+0.58333333*g_v(i,k,j)&amp;<a name='2471'>
&amp;*vel+g_vel*(0.58333333*(v(i,k,j)+v(i-1,k,j))-0.083333333*(v(i+1,k,j)+v(i-2,k,j)))<a name='2472'>
        fqx(i,k) = vel*(7./12.*(v(i,k,j)+v(i-1,k,j))-1./12.*(v(i+1,k,j)+v(i-2,k,j)))<a name='2473'>
      end do<a name='2474'>
    endif<a name='2475'>
    do k = kts, ktf<a name='2476'>
      do i = i_start, i_end<a name='2477'>
        mrdx = msfv(i,j)*rdx<a name='2478'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='2479'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='2480'>
      end do<a name='2481'>
    end do<a name='2482'>
  end do<a name='2483'>
else if (horz_order .eq. 5) then horizontal_order_tesu<a name='2484'>
  degrade_xs =  .true. <a name='2485'>
  degrade_xe =  .true. <a name='2486'>
  degrade_ys =  .true. <a name='2487'>
  degrade_ye =  .true. <a name='2488'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+2) then<a name='2489'>
    degrade_xs =  .false. <a name='2490'>
  endif<a name='2491'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-3) then<a name='2492'>
    degrade_xe =  .false. <a name='2493'>
  endif<a name='2494'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+2) then<a name='2495'>
    degrade_ys =  .false. <a name='2496'>
  endif<a name='2497'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-2) then<a name='2498'>
    degrade_ye =  .false. <a name='2499'>
  endif<a name='2500'>
  i_start = its<a name='2501'>
  i_end = min(ite,ide-1)<a name='2502'>
  j_start = jts<a name='2503'>
  j_end = jte<a name='2504'>
  j_start_f = j_start<a name='2505'>
  j_end_f = j_end+1<a name='2506'>
  if (degrade_ys) then<a name='2507'>
    j_start = max(jts,jds+1)<a name='2508'>
    j_start_f = jds+3<a name='2509'>
  endif<a name='2510'>
  if (degrade_ye) then<a name='2511'>
    j_end = min(jte,jde-1)<a name='2512'>
    j_end_f = jde-2<a name='2513'>
  endif<a name='2514'>
  jp1 = 2<a name='2515'>
  jp0 = 1<a name='2516'>
  j_loop_y_flux_5: do j = j_start, j_end+1<a name='2517'>
    if (j .ge. j_start_f .and. j .le. j_end_f) then<a name='2518'>
      do k = kts, ktf<a name='2519'>
        do i = i_start, i_end<a name='2520'>
          g_vel = 0.5*g_rv(i,k,j-1)+0.5*g_rv(i,k,j)<a name='2521'>
          vel = 0.5*(rv(i,k,j)+rv(i,k,j-1))<a name='2522'>
          g_fqy(i,k,jp1) = g_v(i,k,j-3)*vel*(0.016666667-(-0.016666667)*sign(1.,vel))+g_v(i,k,j-2)*vel*((-0.13333333)-0.083333333*&amp;<a name='2523'>
&amp;sign(1.,vel))+g_v(i,k,j-1)*vel*(0.61666667-(-0.16666667)*sign(1.,vel))+g_v(i,k,j+2)*vel*(0.016666667-0.016666667*&amp;<a name='2524'>
&amp;sign(1.,vel))+g_v(i,k,j+1)*vel*((-0.13333333)-(-0.083333333)*sign(1.,vel))+g_v(i,k,j)*vel*(0.61666667-0.16666667*&amp;<a name='2525'>
&amp;sign(1.,vel))+g_vel*(0.61666667*(v(i,k,j)+v(i,k,j-1))-0.13333333*(v(i,k,j+1)+v(i,k,j-2))+0.016666667*(v(i,k,j+2)+v(i,k,&amp;<a name='2526'>
&amp;j-3))-0.016666667*(v(i,k,j+2)-v(i,k,j-3)-5.*(v(i,k,j+1)-v(i,k,j-2))+10.*(v(i,k,j)-v(i,k,j-1)))*sign(1.,vel))<a name='2527'>
          fqy(i,k,jp1) = vel*(37./60.*(v(i,k,j)+v(i,k,j-1))-2./15.*(v(i,k,j+1)+v(i,k,j-2))+1./60.*(v(i,k,j+2)+v(i,k,j-3))-sign(1.,&amp;<a name='2528'>
&amp;vel)*(1./60.)*(v(i,k,j+2)-v(i,k,j-3)-5.*(v(i,k,j+1)-v(i,k,j-2))+10.*(v(i,k,j)-v(i,k,j-1))))<a name='2529'>
        end do<a name='2530'>
      end do<a name='2531'>
    else if (j .eq. jds+1) then<a name='2532'>
      do k = kts, ktf<a name='2533'>
        do i = i_start, i_end<a name='2534'>
          g_vb = g_v(i,k,j-1)<a name='2535'>
          vb = v(i,k,j-1)<a name='2536'>
          if (specified .and. v(i,k,j) .lt. 0.) then<a name='2537'>
            g_vb = g_v(i,k,j)<a name='2538'>
            vb = v(i,k,j)<a name='2539'>
          endif<a name='2540'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i,k,j-1)*(v(i,k,j)+vb)+0.25*g_rv(i,k,j)*(v(i,k,j)+vb)+0.25*g_v(i,k,j)*(rv(i,k,j)+rv(i,k,j-1))+&amp;<a name='2541'>
&amp;0.25*g_vb*(rv(i,k,j)+rv(i,k,j-1))<a name='2542'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i,k,j-1))*(v(i,k,j)+vb)<a name='2543'>
        end do<a name='2544'>
      end do<a name='2545'>
    else if (j .eq. jds+2) then<a name='2546'>
      do k = kts, ktf<a name='2547'>
        do i = i_start, i_end<a name='2548'>
          g_vel = 0.5*g_rv(i,k,j-1)+0.5*g_rv(i,k,j)<a name='2549'>
          vel = 0.5*(rv(i,k,j)+rv(i,k,j-1))<a name='2550'>
          g_fqy(i,k,jp1) = g_v(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_v(i,k,j-1)*vel*(0.58333333+0.25*sign(1.,&amp;<a name='2551'>
&amp;vel))+g_v(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='2552'>
&amp;(0.58333333*(v(i,k,j)+v(i,k,j-1))-0.083333333*(v(i,k,j+1)+v(i,k,j-2))+0.083333333*(v(i,k,j+1)-v(i,k,j-2)-3.*(v(i,k,j)-&amp;<a name='2553'>
&amp;v(i,k,j-1)))*sign(1.,vel))<a name='2554'>
          fqy(i,k,jp1) = vel*(7./12.*(v(i,k,j)+v(i,k,j-1))-1./12.*(v(i,k,j+1)+v(i,k,j-2))+sign(1.,vel)*(1./12.)*(v(i,k,j+1)-v(i,k,&amp;<a name='2555'>
&amp;j-2)-3.*(v(i,k,j)-v(i,k,j-1))))<a name='2556'>
        end do<a name='2557'>
      end do<a name='2558'>
    else if (j .eq. jde) then<a name='2559'>
      do k = kts, ktf<a name='2560'>
        do i = i_start, i_end<a name='2561'>
          g_vb = g_v(i,k,j)<a name='2562'>
          vb = v(i,k,j)<a name='2563'>
          if (specified .and. v(i,k,j-1) .gt. 0.) then<a name='2564'>
            g_vb = g_v(i,k,j-1)<a name='2565'>
            vb = v(i,k,j-1)<a name='2566'>
          endif<a name='2567'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i,k,j-1)*(vb+v(i,k,j-1))+0.25*g_rv(i,k,j)*(vb+v(i,k,j-1))+0.25*g_v(i,k,j-1)*(rv(i,k,j)+rv(i,k,&amp;<a name='2568'>
&amp;j-1))+0.25*g_vb*(rv(i,k,j)+rv(i,k,j-1))<a name='2569'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i,k,j-1))*(vb+v(i,k,j-1))<a name='2570'>
        end do<a name='2571'>
      end do<a name='2572'>
    else if (j .eq. jde-1) then<a name='2573'>
      do k = kts, ktf<a name='2574'>
        do i = i_start, i_end<a name='2575'>
          g_vel = 0.5*g_rv(i,k,j-1)+0.5*g_rv(i,k,j)<a name='2576'>
          vel = 0.5*(rv(i,k,j)+rv(i,k,j-1))<a name='2577'>
          g_fqy(i,k,jp1) = g_v(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_v(i,k,j-1)*vel*(0.58333333+0.25*sign(1.,&amp;<a name='2578'>
&amp;vel))+g_v(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='2579'>
&amp;(0.58333333*(v(i,k,j)+v(i,k,j-1))-0.083333333*(v(i,k,j+1)+v(i,k,j-2))+0.083333333*(v(i,k,j+1)-v(i,k,j-2)-3.*(v(i,k,j)-&amp;<a name='2580'>
&amp;v(i,k,j-1)))*sign(1.,vel))<a name='2581'>
          fqy(i,k,jp1) = vel*(7./12.*(v(i,k,j)+v(i,k,j-1))-1./12.*(v(i,k,j+1)+v(i,k,j-2))+sign(1.,vel)*(1./12.)*(v(i,k,j+1)-v(i,k,&amp;<a name='2582'>
&amp;j-2)-3.*(v(i,k,j)-v(i,k,j-1))))<a name='2583'>
        end do<a name='2584'>
      end do<a name='2585'>
    endif<a name='2586'>
    if (j .gt. j_start) then<a name='2587'>
      do k = kts, ktf<a name='2588'>
        do i = i_start, i_end<a name='2589'>
          mrdy = msfv(i,j-1)*rdy<a name='2590'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='2591'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='2592'>
        end do<a name='2593'>
      end do<a name='2594'>
    endif<a name='2595'>
    jtmp = jp1<a name='2596'>
    jp1 = jp0<a name='2597'>
    jp0 = jtmp<a name='2598'>
  end do j_loop_y_flux_5<a name='2599'>
  i_start = its<a name='2600'>
  i_end = min(ite,ide-1)<a name='2601'>
  j_start = jts<a name='2602'>
  j_end = jte<a name='2603'>
  if (config_flags%open_ys .or. specified) then<a name='2604'>
    j_start = max(jds+1,jts)<a name='2605'>
  endif<a name='2606'>
  if (config_flags%open_ye .or. specified) then<a name='2607'>
    j_end = min(jde-1,jte)<a name='2608'>
  endif<a name='2609'>
  i_start_f = i_start<a name='2610'>
  i_end_f = i_end+1<a name='2611'>
  if (degrade_xs) then<a name='2612'>
    i_start = max(ids+1,its)<a name='2613'>
    i_start_f = i_start+2<a name='2614'>
  endif<a name='2615'>
  if (degrade_xe) then<a name='2616'>
    i_end = min(ide-2,ite)<a name='2617'>
    i_end_f = ide-3<a name='2618'>
  endif<a name='2619'>
  do j = j_start, j_end<a name='2620'>
    do k = kts, ktf<a name='2621'>
      do i = i_start_f, i_end_f<a name='2622'>
        g_vel = 0.5*g_ru(i,k,j-1)+0.5*g_ru(i,k,j)<a name='2623'>
        vel = 0.5*(ru(i,k,j)+ru(i,k,j-1))<a name='2624'>
        g_fqx(i,k) = g_v(i-3,k,j)*vel*(0.016666667-(-0.016666667)*sign(1.,vel))+g_v(i-2,k,j)*vel*((-0.13333333)-0.083333333*&amp;<a name='2625'>
&amp;sign(1.,vel))+g_v(i-1,k,j)*vel*(0.61666667-(-0.16666667)*sign(1.,vel))+g_v(i+2,k,j)*vel*(0.016666667-0.016666667*sign(1.,&amp;<a name='2626'>
&amp;vel))+g_v(i+1,k,j)*vel*((-0.13333333)-(-0.083333333)*sign(1.,vel))+g_v(i,k,j)*vel*(0.61666667-0.16666667*sign(1.,vel))+&amp;<a name='2627'>
&amp;g_vel*(0.61666667*(v(i,k,j)+v(i-1,k,j))-0.13333333*(v(i+1,k,j)+v(i-2,k,j))+0.016666667*(v(i+2,k,j)+v(i-3,k,j))-&amp;<a name='2628'>
&amp;0.016666667*(v(i+2,k,j)-v(i-3,k,j)-5.*(v(i+1,k,j)-v(i-2,k,j))+10.*(v(i,k,j)-v(i-1,k,j)))*sign(1.,vel))<a name='2629'>
        fqx(i,k) = vel*(37./60.*(v(i,k,j)+v(i-1,k,j))-2./15.*(v(i+1,k,j)+v(i-2,k,j))+1./60.*(v(i+2,k,j)+v(i-3,k,j))-sign(1.,vel)*&amp;<a name='2630'>
&amp;(1./60.)*(v(i+2,k,j)-v(i-3,k,j)-5.*(v(i+1,k,j)-v(i-2,k,j))+10.*(v(i,k,j)-v(i-1,k,j))))<a name='2631'>
      end do<a name='2632'>
    end do<a name='2633'>
    if (degrade_xs) then<a name='2634'>
      if (i_start .eq. ids+1) then<a name='2635'>
        i = ids+1<a name='2636'>
        do k = kts, ktf<a name='2637'>
          g_fqx(i,k) = 0.25*g_ru(i,k,j-1)*(v(i,k,j)+v(i-1,k,j))+0.25*g_ru(i,k,j)*(v(i,k,j)+v(i-1,k,j))+0.25*g_v(i-1,k,j)*(ru(i,k,j)&amp;<a name='2638'>
&amp;+ru(i,k,j-1))+0.25*g_v(i,k,j)*(ru(i,k,j)+ru(i,k,j-1))<a name='2639'>
          fqx(i,k) = 0.25*(ru(i,k,j)+ru(i,k,j-1))*(v(i,k,j)+v(i-1,k,j))<a name='2640'>
        end do<a name='2641'>
      endif<a name='2642'>
      i = ids+2<a name='2643'>
      do k = kts, ktf<a name='2644'>
        g_vel = 0.5*g_ru(i,k,j-1)+0.5*g_ru(i,k,j)<a name='2645'>
        vel = 0.5*(ru(i,k,j)+ru(i,k,j-1))<a name='2646'>
        g_fqx(i,k) = g_v(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_v(i-1,k,j)*vel*(0.58333333+0.25*sign(1.,vel))+&amp;<a name='2647'>
&amp;g_v(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='2648'>
&amp;(0.58333333*(v(i,k,j)+v(i-1,k,j))-0.083333333*(v(i+1,k,j)+v(i-2,k,j))+0.083333333*(v(i+1,k,j)-v(i-2,k,j)-3.*(v(i,k,j)-v(i-&amp;<a name='2649'>
&amp;1,k,j)))*sign(1.,vel))<a name='2650'>
        fqx(i,k) = vel*(7./12.*(v(i,k,j)+v(i-1,k,j))-1./12.*(v(i+1,k,j)+v(i-2,k,j))+sign(1.,vel)*(1./12.)*(v(i+1,k,j)-v(i-2,k,j)-&amp;<a name='2651'>
&amp;3.*(v(i,k,j)-v(i-1,k,j))))<a name='2652'>
      end do<a name='2653'>
    endif<a name='2654'>
    if (degrade_xe) then<a name='2655'>
      if (i_end .eq. ide-2) then<a name='2656'>
        i = ide-1<a name='2657'>
        do k = kts, ktf<a name='2658'>
          g_fqx(i,k) = 0.25*g_ru(i_end+1,k,j-1)*(v(i_end+1,k,j)+v(i_end,k,j))+0.25*g_ru(i_end+1,k,j)*(v(i_end+1,k,j)+v(i_end,k,j))+&amp;<a name='2659'>
&amp;0.25*g_v(i_end+1,k,j)*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))+0.25*g_v(i_end,k,j)*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))<a name='2660'>
          fqx(i,k) = 0.25*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))*(v(i_end+1,k,j)+v(i_end,k,j))<a name='2661'>
        end do<a name='2662'>
      endif<a name='2663'>
      i = ide-2<a name='2664'>
      do k = kts, ktf<a name='2665'>
        g_vel = 0.5*g_ru(i,k,j-1)+0.5*g_ru(i,k,j)<a name='2666'>
        vel = 0.5*(ru(i,k,j)+ru(i,k,j-1))<a name='2667'>
        g_fqx(i,k) = g_v(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_v(i-1,k,j)*vel*(0.58333333+0.25*sign(1.,vel))+&amp;<a name='2668'>
&amp;g_v(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='2669'>
&amp;(0.58333333*(v(i,k,j)+v(i-1,k,j))-0.083333333*(v(i+1,k,j)+v(i-2,k,j))+0.083333333*(v(i+1,k,j)-v(i-2,k,j)-3.*(v(i,k,j)-v(i-&amp;<a name='2670'>
&amp;1,k,j)))*sign(1.,vel))<a name='2671'>
        fqx(i,k) = vel*(7./12.*(v(i,k,j)+v(i-1,k,j))-1./12.*(v(i+1,k,j)+v(i-2,k,j))+sign(1.,vel)*(1./12.)*(v(i+1,k,j)-v(i-2,k,j)-&amp;<a name='2672'>
&amp;3.*(v(i,k,j)-v(i-1,k,j))))<a name='2673'>
      end do<a name='2674'>
    endif<a name='2675'>
    do k = kts, ktf<a name='2676'>
      do i = i_start, i_end<a name='2677'>
        mrdx = msfv(i,j)*rdx<a name='2678'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='2679'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='2680'>
      end do<a name='2681'>
    end do<a name='2682'>
  end do<a name='2683'>
else if (horz_order .eq. 4) then horizontal_order_tesu<a name='2684'>
  degrade_xs =  .true. <a name='2685'>
  degrade_xe =  .true. <a name='2686'>
  degrade_ys =  .true. <a name='2687'>
  degrade_ye =  .true. <a name='2688'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+1) then<a name='2689'>
    degrade_xs =  .false. <a name='2690'>
  endif<a name='2691'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-2) then<a name='2692'>
    degrade_xe =  .false. <a name='2693'>
  endif<a name='2694'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+1) then<a name='2695'>
    degrade_ys =  .false. <a name='2696'>
  endif<a name='2697'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-1) then<a name='2698'>
    degrade_ye =  .false. <a name='2699'>
  endif<a name='2700'>
  ktf = min(kte,kde-1)<a name='2701'>
  i_start = its<a name='2702'>
  i_end = min(ite,ide-1)<a name='2703'>
  j_start = jts<a name='2704'>
  j_end = jte<a name='2705'>
  if (degrade_ys) then<a name='2706'>
    j_start = jds+1<a name='2707'>
  endif<a name='2708'>
  if (degrade_ye) then<a name='2709'>
    j_end = jde-1<a name='2710'>
  endif<a name='2711'>
  jp0 = 1<a name='2712'>
  jp1 = 2<a name='2713'>
  do j = j_start, j_end+1<a name='2714'>
    if (j .eq. j_start .and. degrade_ys) then<a name='2715'>
      do k = kts, ktf<a name='2716'>
        do i = i_start, i_end<a name='2717'>
          g_vb = g_v(i,k,j-1)<a name='2718'>
          vb = v(i,k,j-1)<a name='2719'>
          if (specified .and. v(i,k,j) .lt. 0.) then<a name='2720'>
            g_vb = g_v(i,k,j)<a name='2721'>
            vb = v(i,k,j)<a name='2722'>
          endif<a name='2723'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i,k,j-1)*(v(i,k,j)+vb)+0.25*g_rv(i,k,j)*(v(i,k,j)+vb)+0.25*g_v(i,k,j)*(rv(i,k,j)+rv(i,k,j-1))+&amp;<a name='2724'>
&amp;0.25*g_vb*(rv(i,k,j)+rv(i,k,j-1))<a name='2725'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i,k,j-1))*(v(i,k,j)+vb)<a name='2726'>
        end do<a name='2727'>
      end do<a name='2728'>
    else if (j .eq. j_end+1 .and. degrade_ye) then<a name='2729'>
      do k = kts, ktf<a name='2730'>
        do i = i_start, i_end<a name='2731'>
          g_vb = g_v(i,k,j)<a name='2732'>
          vb = v(i,k,j)<a name='2733'>
          if (specified .and. v(i,k,j-1) .gt. 0.) then<a name='2734'>
            g_vb = g_v(i,k,j-1)<a name='2735'>
            vb = v(i,k,j-1)<a name='2736'>
          endif<a name='2737'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i,k,j-1)*(vb+v(i,k,j-1))+0.25*g_rv(i,k,j)*(vb+v(i,k,j-1))+0.25*g_v(i,k,j-1)*(rv(i,k,j)+rv(i,k,&amp;<a name='2738'>
&amp;j-1))+0.25*g_vb*(rv(i,k,j)+rv(i,k,j-1))<a name='2739'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i,k,j-1))*(vb+v(i,k,j-1))<a name='2740'>
        end do<a name='2741'>
      end do<a name='2742'>
    else<a name='2743'>
      do k = kts, ktf<a name='2744'>
        do i = i_start, i_end<a name='2745'>
          g_vel = 0.5*g_rv(i,k,j-1)+0.5*g_rv(i,k,j)<a name='2746'>
          vel = 0.5*(rv(i,k,j)+rv(i,k,j-1))<a name='2747'>
          g_fqy(i,k,jp1) = (-0.083333333)*g_v(i,k,j-2)*vel+0.58333333*g_v(i,k,j-1)*vel-0.083333333*g_v(i,k,j+1)*vel+0.58333333*&amp;<a name='2748'>
&amp;g_v(i,k,j)*vel+g_vel*(0.58333333*(v(i,k,j)+v(i,k,j-1))-0.083333333*(v(i,k,j+1)+v(i,k,j-2)))<a name='2749'>
          fqy(i,k,jp1) = vel*(7./12.*(v(i,k,j)+v(i,k,j-1))-1./12.*(v(i,k,j+1)+v(i,k,j-2)))<a name='2750'>
        end do<a name='2751'>
      end do<a name='2752'>
    endif<a name='2753'>
    if (j .gt. j_start) then<a name='2754'>
      do k = kts, ktf<a name='2755'>
        do i = i_start, i_end<a name='2756'>
          mrdy = msfv(i,j-1)*rdy<a name='2757'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='2758'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='2759'>
        end do<a name='2760'>
      end do<a name='2761'>
    endif<a name='2762'>
    jtmp = jp1<a name='2763'>
    jp1 = jp0<a name='2764'>
    jp0 = jtmp<a name='2765'>
  end do<a name='2766'>
  i_start = its<a name='2767'>
  i_end = min(ite,ide-1)<a name='2768'>
  j_start = jts<a name='2769'>
  j_end = jte<a name='2770'>
  if (config_flags%open_ys .or. specified) then<a name='2771'>
    j_start = max(jds+1,jts)<a name='2772'>
  endif<a name='2773'>
  if (config_flags%open_ye .or. specified) then<a name='2774'>
    j_end = min(jde-1,jte)<a name='2775'>
  endif<a name='2776'>
  i_start_f = i_start<a name='2777'>
  i_end_f = i_end+1<a name='2778'>
  if (degrade_xs) then<a name='2779'>
    i_start = ids+1<a name='2780'>
    i_start_f = i_start+1<a name='2781'>
  endif<a name='2782'>
  if (degrade_xe) then<a name='2783'>
    i_end = ide-2<a name='2784'>
    i_end_f = ide-2<a name='2785'>
  endif<a name='2786'>
  do j = j_start, j_end<a name='2787'>
    do k = kts, ktf<a name='2788'>
      do i = i_start_f, i_end_f<a name='2789'>
        g_vel = 0.5*g_ru(i,k,j-1)+0.5*g_ru(i,k,j)<a name='2790'>
        vel = 0.5*(ru(i,k,j)+ru(i,k,j-1))<a name='2791'>
        g_fqx(i,k) = (-0.083333333)*g_v(i-2,k,j)*vel+0.58333333*g_v(i-1,k,j)*vel-0.083333333*g_v(i+1,k,j)*vel+0.58333333*g_v(i,k,j)&amp;<a name='2792'>
&amp;*vel+g_vel*(0.58333333*(v(i,k,j)+v(i-1,k,j))-0.083333333*(v(i+1,k,j)+v(i-2,k,j)))<a name='2793'>
        fqx(i,k) = vel*(7./12.*(v(i,k,j)+v(i-1,k,j))-1./12.*(v(i+1,k,j)+v(i-2,k,j)))<a name='2794'>
      end do<a name='2795'>
    end do<a name='2796'>
    if (degrade_xs) then<a name='2797'>
      do k = kts, ktf<a name='2798'>
        g_fqx(i_start,k) = 0.25*g_ru(i_start,k,j-1)*(v(i_start,k,j)+v(i_start-1,k,j))+0.25*g_ru(i_start,k,j)*(v(i_start,k,j)+&amp;<a name='2799'>
&amp;v(i_start-1,k,j))+0.25*g_v(i_start-1,k,j)*(ru(i_start,k,j)+ru(i_start,k,j-1))+0.25*g_v(i_start,k,j)*(ru(i_start,k,j)+&amp;<a name='2800'>
&amp;ru(i_start,k,j-1))<a name='2801'>
        fqx(i_start,k) = 0.25*(ru(i_start,k,j)+ru(i_start,k,j-1))*(v(i_start,k,j)+v(i_start-1,k,j))<a name='2802'>
      end do<a name='2803'>
    endif<a name='2804'>
    if (degrade_xe) then<a name='2805'>
      do k = kts, ktf<a name='2806'>
        g_fqx(i_end+1,k) = 0.25*g_ru(i_end+1,k,j-1)*(v(i_end+1,k,j)+v(i_end,k,j))+0.25*g_ru(i_end+1,k,j)*(v(i_end+1,k,j)+v(i_end,k,&amp;<a name='2807'>
&amp;j))+0.25*g_v(i_end+1,k,j)*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))+0.25*g_v(i_end,k,j)*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))<a name='2808'>
        fqx(i_end+1,k) = 0.25*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))*(v(i_end+1,k,j)+v(i_end,k,j))<a name='2809'>
      end do<a name='2810'>
    endif<a name='2811'>
    do k = kts, ktf<a name='2812'>
      do i = i_start, i_end<a name='2813'>
        mrdx = msfv(i,j)*rdx<a name='2814'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='2815'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='2816'>
      end do<a name='2817'>
    end do<a name='2818'>
  end do<a name='2819'>
else if (horz_order .eq. 3) then horizontal_order_tesu<a name='2820'>
  degrade_xs =  .true. <a name='2821'>
  degrade_xe =  .true. <a name='2822'>
  degrade_ys =  .true. <a name='2823'>
  degrade_ye =  .true. <a name='2824'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+1) then<a name='2825'>
    degrade_xs =  .false. <a name='2826'>
  endif<a name='2827'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-2) then<a name='2828'>
    degrade_xe =  .false. <a name='2829'>
  endif<a name='2830'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+1) then<a name='2831'>
    degrade_ys =  .false. <a name='2832'>
  endif<a name='2833'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-1) then<a name='2834'>
    degrade_ye =  .false. <a name='2835'>
  endif<a name='2836'>
  ktf = min(kte,kde-1)<a name='2837'>
  i_start = its<a name='2838'>
  i_end = min(ite,ide-1)<a name='2839'>
  j_start = jts<a name='2840'>
  j_end = jte<a name='2841'>
  if (degrade_ys) then<a name='2842'>
    j_start = jds+1<a name='2843'>
  endif<a name='2844'>
  if (degrade_ye) then<a name='2845'>
    j_end = jde-1<a name='2846'>
  endif<a name='2847'>
  jp0 = 1<a name='2848'>
  jp1 = 2<a name='2849'>
  do j = j_start, j_end+1<a name='2850'>
    if (j .eq. j_start .and. degrade_ys) then<a name='2851'>
      do k = kts, ktf<a name='2852'>
        do i = i_start, i_end<a name='2853'>
          g_vb = g_v(i,k,j-1)<a name='2854'>
          vb = v(i,k,j-1)<a name='2855'>
          if (specified .and. v(i,k,j) .lt. 0.) then<a name='2856'>
            g_vb = g_v(i,k,j)<a name='2857'>
            vb = v(i,k,j)<a name='2858'>
          endif<a name='2859'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i,k,j-1)*(v(i,k,j)+vb)+0.25*g_rv(i,k,j)*(v(i,k,j)+vb)+0.25*g_v(i,k,j)*(rv(i,k,j)+rv(i,k,j-1))+&amp;<a name='2860'>
&amp;0.25*g_vb*(rv(i,k,j)+rv(i,k,j-1))<a name='2861'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i,k,j-1))*(v(i,k,j)+vb)<a name='2862'>
        end do<a name='2863'>
      end do<a name='2864'>
    else if (j .eq. j_end+1 .and. degrade_ye) then<a name='2865'>
      do k = kts, ktf<a name='2866'>
        do i = i_start, i_end<a name='2867'>
          g_vb = g_v(i,k,j)<a name='2868'>
          vb = v(i,k,j)<a name='2869'>
          if (specified .and. v(i,k,j-1) .gt. 0.) then<a name='2870'>
            g_vb = g_v(i,k,j-1)<a name='2871'>
            vb = v(i,k,j-1)<a name='2872'>
          endif<a name='2873'>
          g_fqy(i,k,jp1) = 0.25*g_rv(i,k,j-1)*(vb+v(i,k,j-1))+0.25*g_rv(i,k,j)*(vb+v(i,k,j-1))+0.25*g_v(i,k,j-1)*(rv(i,k,j)+rv(i,k,&amp;<a name='2874'>
&amp;j-1))+0.25*g_vb*(rv(i,k,j)+rv(i,k,j-1))<a name='2875'>
          fqy(i,k,jp1) = 0.25*(rv(i,k,j)+rv(i,k,j-1))*(vb+v(i,k,j-1))<a name='2876'>
        end do<a name='2877'>
      end do<a name='2878'>
    else<a name='2879'>
      do k = kts, ktf<a name='2880'>
        do i = i_start, i_end<a name='2881'>
          g_vel = 0.5*g_rv(i,k,j-1)+0.5*g_rv(i,k,j)<a name='2882'>
          vel = 0.5*(rv(i,k,j)+rv(i,k,j-1))<a name='2883'>
          g_fqy(i,k,jp1) = g_v(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_v(i,k,j-1)*vel*(0.58333333+0.25*sign(1.,&amp;<a name='2884'>
&amp;vel))+g_v(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='2885'>
&amp;(0.58333333*(v(i,k,j)+v(i,k,j-1))-0.083333333*(v(i,k,j+1)+v(i,k,j-2))+0.083333333*(v(i,k,j+1)-v(i,k,j-2)-3.*(v(i,k,j)-&amp;<a name='2886'>
&amp;v(i,k,j-1)))*sign(1.,vel))<a name='2887'>
          fqy(i,k,jp1) = vel*(7./12.*(v(i,k,j)+v(i,k,j-1))-1./12.*(v(i,k,j+1)+v(i,k,j-2))+sign(1.,vel)*(1./12.)*(v(i,k,j+1)-v(i,k,&amp;<a name='2888'>
&amp;j-2)-3.*(v(i,k,j)-v(i,k,j-1))))<a name='2889'>
        end do<a name='2890'>
      end do<a name='2891'>
    endif<a name='2892'>
    if (j .gt. j_start) then<a name='2893'>
      do k = kts, ktf<a name='2894'>
        do i = i_start, i_end<a name='2895'>
          mrdy = msfv(i,j-1)*rdy<a name='2896'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='2897'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='2898'>
        end do<a name='2899'>
      end do<a name='2900'>
    endif<a name='2901'>
    jtmp = jp1<a name='2902'>
    jp1 = jp0<a name='2903'>
    jp0 = jtmp<a name='2904'>
  end do<a name='2905'>
  i_start = its<a name='2906'>
  i_end = min(ite,ide-1)<a name='2907'>
  j_start = jts<a name='2908'>
  j_end = jte<a name='2909'>
  if (config_flags%open_ys .or. specified) then<a name='2910'>
    j_start = max(jds+1,jts)<a name='2911'>
  endif<a name='2912'>
  if (config_flags%open_ye .or. specified) then<a name='2913'>
    j_end = min(jde-1,jte)<a name='2914'>
  endif<a name='2915'>
  i_start_f = i_start<a name='2916'>
  i_end_f = i_end+1<a name='2917'>
  if (degrade_xs) then<a name='2918'>
    i_start = ids+1<a name='2919'>
    i_start_f = i_start+1<a name='2920'>
  endif<a name='2921'>
  if (degrade_xe) then<a name='2922'>
    i_end = ide-2<a name='2923'>
    i_end_f = ide-2<a name='2924'>
  endif<a name='2925'>
  do j = j_start, j_end<a name='2926'>
    do k = kts, ktf<a name='2927'>
      do i = i_start_f, i_end_f<a name='2928'>
        g_vel = 0.5*g_ru(i,k,j-1)+0.5*g_ru(i,k,j)<a name='2929'>
        vel = 0.5*(ru(i,k,j)+ru(i,k,j-1))<a name='2930'>
        g_fqx(i,k) = g_v(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_v(i-1,k,j)*vel*(0.58333333+0.25*sign(1.,vel))+&amp;<a name='2931'>
&amp;g_v(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,vel))+g_vel*&amp;<a name='2932'>
&amp;(0.58333333*(v(i,k,j)+v(i-1,k,j))-0.083333333*(v(i+1,k,j)+v(i-2,k,j))+0.083333333*(v(i+1,k,j)-v(i-2,k,j)-3.*(v(i,k,j)-v(i-&amp;<a name='2933'>
&amp;1,k,j)))*sign(1.,vel))<a name='2934'>
        fqx(i,k) = vel*(7./12.*(v(i,k,j)+v(i-1,k,j))-1./12.*(v(i+1,k,j)+v(i-2,k,j))+sign(1.,vel)*(1./12.)*(v(i+1,k,j)-v(i-2,k,j)-&amp;<a name='2935'>
&amp;3.*(v(i,k,j)-v(i-1,k,j))))<a name='2936'>
      end do<a name='2937'>
    end do<a name='2938'>
    if (degrade_xs) then<a name='2939'>
      do k = kts, ktf<a name='2940'>
        g_fqx(i_start,k) = 0.25*g_ru(i_start,k,j-1)*(v(i_start,k,j)+v(i_start-1,k,j))+0.25*g_ru(i_start,k,j)*(v(i_start,k,j)+&amp;<a name='2941'>
&amp;v(i_start-1,k,j))+0.25*g_v(i_start-1,k,j)*(ru(i_start,k,j)+ru(i_start,k,j-1))+0.25*g_v(i_start,k,j)*(ru(i_start,k,j)+&amp;<a name='2942'>
&amp;ru(i_start,k,j-1))<a name='2943'>
        fqx(i_start,k) = 0.25*(ru(i_start,k,j)+ru(i_start,k,j-1))*(v(i_start,k,j)+v(i_start-1,k,j))<a name='2944'>
      end do<a name='2945'>
    endif<a name='2946'>
    if (degrade_xe) then<a name='2947'>
      do k = kts, ktf<a name='2948'>
        g_fqx(i_end+1,k) = 0.25*g_ru(i_end+1,k,j-1)*(v(i_end+1,k,j)+v(i_end,k,j))+0.25*g_ru(i_end+1,k,j)*(v(i_end+1,k,j)+v(i_end,k,&amp;<a name='2949'>
&amp;j))+0.25*g_v(i_end+1,k,j)*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))+0.25*g_v(i_end,k,j)*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))<a name='2950'>
        fqx(i_end+1,k) = 0.25*(ru(i_end+1,k,j)+ru(i_end+1,k,j-1))*(v(i_end+1,k,j)+v(i_end,k,j))<a name='2951'>
      end do<a name='2952'>
    endif<a name='2953'>
    do k = kts, ktf<a name='2954'>
      do i = i_start, i_end<a name='2955'>
        mrdx = msfv(i,j)*rdx<a name='2956'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='2957'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='2958'>
      end do<a name='2959'>
    end do<a name='2960'>
  end do<a name='2961'>
else if (horz_order .eq. 2) then horizontal_order_tesu<a name='2962'>
  i_start = its<a name='2963'>
  i_end = min(ite,ide-1)<a name='2964'>
  j_start = jts<a name='2965'>
  j_end = jte<a name='2966'>
  if (config_flags%open_ys) then<a name='2967'>
    j_start = max(jds+1,jts)<a name='2968'>
  endif<a name='2969'>
  if (config_flags%open_ye) then<a name='2970'>
    j_end = min(jde-1,jte)<a name='2971'>
  endif<a name='2972'>
  if (specified) then<a name='2973'>
    j_start = max(jds+2,jts)<a name='2974'>
  endif<a name='2975'>
  if (specified) then<a name='2976'>
    j_end = min(jde-2,jte)<a name='2977'>
  endif<a name='2978'>
  do j = j_start, j_end<a name='2979'>
    do k = kts, ktf<a name='2980'>
      do i = i_start, i_end<a name='2981'>
        mrdy = msfv(i,j)*rdy<a name='2982'>
        g_tendency(i,k,j) = 0.25*g_rv(i,k,j-1)*mrdy*(v(i,k,j)+v(i,k,j-1))-0.25*g_rv(i,k,j+1)*mrdy*(v(i,k,j+1)+v(i,k,j))-0.25*&amp;<a name='2983'>
&amp;g_rv(i,k,j)*mrdy*(v(i,k,j+1)+v(i,k,j)-(v(i,k,j)+v(i,k,j-1)))+g_tendency(i,k,j)+0.25*g_v(i,k,j-1)*mrdy*(rv(i,k,j)+rv(i,k,j-&amp;<a name='2984'>
&amp;1))-0.25*g_v(i,k,j+1)*mrdy*(rv(i,k,j+1)+rv(i,k,j))-0.25*g_v(i,k,j)*mrdy*(rv(i,k,j+1)+rv(i,k,j)-(rv(i,k,j)+rv(i,k,j-1)))<a name='2985'>
        tendency(i,k,j) = tendency(i,k,j)-mrdy*0.25*((rv(i,k,j+1)+rv(i,k,j))*(v(i,k,j+1)+v(i,k,j))-(rv(i,k,j)+rv(i,k,j-1))*(v(i,k,&amp;<a name='2986'>
&amp;j)+v(i,k,j-1)))<a name='2987'>
      end do<a name='2988'>
    end do<a name='2989'>
  end do<a name='2990'>
  if (specified .and. jts .le. jds+1) then<a name='2991'>
    j = jds+1<a name='2992'>
    do k = kts, ktf<a name='2993'>
      do i = i_start, i_end<a name='2994'>
        mrdy = msfv(i,j)*rdy<a name='2995'>
        g_vb = g_v(i,k,j-1)<a name='2996'>
        vb = v(i,k,j-1)<a name='2997'>
        if (v(i,k,j) .lt. 0.) then<a name='2998'>
          g_vb = g_v(i,k,j)<a name='2999'>
          vb = v(i,k,j)<a name='3000'>
        endif<a name='3001'>
        g_tendency(i,k,j) = 0.25*g_rv(i,k,j-1)*mrdy*(v(i,k,j)+vb)-0.25*g_rv(i,k,j+1)*mrdy*(v(i,k,j+1)+v(i,k,j))-0.25*g_rv(i,k,j)*&amp;<a name='3002'>
&amp;mrdy*(v(i,k,j+1)+v(i,k,j)-(v(i,k,j)+vb))+g_tendency(i,k,j)-0.25*g_v(i,k,j+1)*mrdy*(rv(i,k,j+1)+rv(i,k,j))-0.25*g_v(i,k,j)*&amp;<a name='3003'>
&amp;mrdy*(rv(i,k,j+1)+rv(i,k,j)-(rv(i,k,j)+rv(i,k,j-1)))+0.25*g_vb*mrdy*(rv(i,k,j)+rv(i,k,j-1))<a name='3004'>
        tendency(i,k,j) = tendency(i,k,j)-mrdy*0.25*((rv(i,k,j+1)+rv(i,k,j))*(v(i,k,j+1)+v(i,k,j))-(rv(i,k,j)+rv(i,k,j-1))*(v(i,k,&amp;<a name='3005'>
&amp;j)+vb))<a name='3006'>
      end do<a name='3007'>
    end do<a name='3008'>
  endif<a name='3009'>
  if (specified .and. jte .ge. jde-1) then<a name='3010'>
    j = jde-1<a name='3011'>
    do k = kts, ktf<a name='3012'>
      do i = i_start, i_end<a name='3013'>
        mrdy = msfv(i,j)*rdy<a name='3014'>
        g_vb = g_v(i,k,j+1)<a name='3015'>
        vb = v(i,k,j+1)<a name='3016'>
        if (v(i,k,j) .gt. 0.) then<a name='3017'>
          g_vb = g_v(i,k,j)<a name='3018'>
          vb = v(i,k,j)<a name='3019'>
        endif<a name='3020'>
        g_tendency(i,k,j) = 0.25*g_rv(i,k,j-1)*mrdy*(v(i,k,j)+v(i,k,j-1))-0.25*g_rv(i,k,j+1)*mrdy*(vb+v(i,k,j))-0.25*g_rv(i,k,j)*&amp;<a name='3021'>
&amp;mrdy*(vb+v(i,k,j)-(v(i,k,j)+v(i,k,j-1)))+g_tendency(i,k,j)+0.25*g_v(i,k,j-1)*mrdy*(rv(i,k,j)+rv(i,k,j-1))-0.25*g_v(i,k,j)*&amp;<a name='3022'>
&amp;mrdy*(rv(i,k,j+1)+rv(i,k,j)-(rv(i,k,j)+rv(i,k,j-1)))-0.25*g_vb*mrdy*(rv(i,k,j+1)+rv(i,k,j))<a name='3023'>
        tendency(i,k,j) = tendency(i,k,j)-mrdy*0.25*((rv(i,k,j+1)+rv(i,k,j))*(vb+v(i,k,j))-(rv(i,k,j)+rv(i,k,j-1))*(v(i,k,j)+v(i,k,&amp;<a name='3024'>
&amp;j-1)))<a name='3025'>
      end do<a name='3026'>
    end do<a name='3027'>
  endif<a name='3028'>
  if (config_flags%open_xs .or. specified) then<a name='3029'>
    i_start = max(ids+1,its)<a name='3030'>
  endif<a name='3031'>
  if (config_flags%open_xe .or. specified) then<a name='3032'>
    i_end = min(ide-2,ite)<a name='3033'>
  endif<a name='3034'>
  do j = j_start, j_end<a name='3035'>
    do k = kts, ktf<a name='3036'>
      do i = i_start, i_end<a name='3037'>
        mrdx = msfv(i,j)*rdx<a name='3038'>
        g_tendency(i,k,j) = (-(0.25*g_ru(i+1,k,j-1)*mrdx*(v(i+1,k,j)+v(i,k,j))))+0.25*g_ru(i,k,j-1)*mrdx*(v(i,k,j)+v(i-1,k,j))-&amp;<a name='3039'>
&amp;0.25*g_ru(i+1,k,j)*mrdx*(v(i+1,k,j)+v(i,k,j))+0.25*g_ru(i,k,j)*mrdx*(v(i,k,j)+v(i-1,k,j))+g_tendency(i,k,j)+0.25*g_v(i-1,&amp;<a name='3040'>
&amp;k,j)*mrdx*(ru(i,k,j)+ru(i,k,j-1))-0.25*g_v(i+1,k,j)*mrdx*(ru(i+1,k,j)+ru(i+1,k,j-1))-0.25*g_v(i,k,j)*mrdx*(ru(i+1,k,j)+&amp;<a name='3041'>
&amp;ru(i+1,k,j-1)-(ru(i,k,j)+ru(i,k,j-1)))<a name='3042'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*0.25*((ru(i+1,k,j)+ru(i+1,k,j-1))*(v(i+1,k,j)+v(i,k,j))-(ru(i,k,j)+ru(i,k,j-1))*&amp;<a name='3043'>
&amp;(v(i,k,j)+v(i-1,k,j)))<a name='3044'>
      end do<a name='3045'>
    end do<a name='3046'>
  end do<a name='3047'>
else horizontal_order_tesu<a name='3048'>
  write(unit=wrf_err_message,fmt=*) 'module_advect: advect_v_6a: h_order not known ',horz_order<a name='3049'>
endif horizontal_order_tesu<a name='3050'>
if (config_flags%open_ys .and. jts .eq. jds) then<a name='3051'>
  i_start = its<a name='3052'>
  i_end = min(ite,ide-1)<a name='3053'>
  do i = i_start, i_end<a name='3054'>
    do k = kts, ktf<a name='3055'>
      g_vb = (-(g_mut(i,jts)*(0.5+sign(0.5,0.-(rv(i,k,jts)-cb*mut(i,jts))))*cb))+g_rv(i,k,jts)*(0.5+sign(0.5,0.-(rv(i,k,jts)-cb*&amp;<a name='3056'>
&amp;mut(i,jts))))<a name='3057'>
      vb = min(rv(i,k,jts)-cb*mut(i,jts),0.)<a name='3058'>
      g_tendency(i,k,jts) = g_tendency(i,k,jts)-g_v_old(i,k,jts+1)*rdy*vb+g_v_old(i,k,jts)*rdy*vb-g_vb*rdy*(v_old(i,k,jts+1)-&amp;<a name='3059'>
&amp;v_old(i,k,jts))<a name='3060'>
      tendency(i,k,jts) = tendency(i,k,jts)-rdy*vb*(v_old(i,k,jts+1)-v_old(i,k,jts))<a name='3061'>
    end do<a name='3062'>
  end do<a name='3063'>
endif<a name='3064'>
if (config_flags%open_ye .and. jte .eq. jde) then<a name='3065'>
  i_start = its<a name='3066'>
  i_end = min(ite,ide-1)<a name='3067'>
  do i = i_start, i_end<a name='3068'>
    do k = kts, ktf<a name='3069'>
      g_vb = g_mut(i,jte-1)*(0.5+sign(0.5,rv(i,k,jte)+cb*mut(i,jte-1)-0.))*cb+g_rv(i,k,jte)*(0.5+sign(0.5,rv(i,k,jte)+cb*mut(i,jte-&amp;<a name='3070'>
&amp;1)-0.))<a name='3071'>
      vb = max(rv(i,k,jte)+cb*mut(i,jte-1),0.)<a name='3072'>
      g_tendency(i,k,jte) = g_tendency(i,k,jte)+g_v_old(i,k,jte-1)*rdy*vb-g_v_old(i,k,jte)*rdy*vb-g_vb*rdy*(v_old(i,k,jte)-v_old(i,&amp;<a name='3073'>
&amp;k,jte-1))<a name='3074'>
      tendency(i,k,jte) = tendency(i,k,jte)-rdy*vb*(v_old(i,k,jte)-v_old(i,k,jte-1))<a name='3075'>
    end do<a name='3076'>
  end do<a name='3077'>
endif<a name='3078'>
j_start = jts<a name='3079'>
j_end = min(jte,jde)<a name='3080'>
jmin = jds<a name='3081'>
jmax = jde-1<a name='3082'>
if (config_flags%open_ys) then<a name='3083'>
  j_start = max(jds+1,jts)<a name='3084'>
  jmin = jds<a name='3085'>
endif<a name='3086'>
if (config_flags%open_ye) then<a name='3087'>
  j_end = min(jte,jde-1)<a name='3088'>
  jmax = jde-1<a name='3089'>
endif<a name='3090'>
if (config_flags%open_xs .and. its .eq. ids) then<a name='3091'>
  do j = j_start, j_end<a name='3092'>
    mrdx = msfv(its,j)*rdx<a name='3093'>
    jp = min(jmax,j)<a name='3094'>
    jm = max(jmin,j-1)<a name='3095'>
    do k = kts, ktf<a name='3096'>
      g_uw = 0.5*g_ru(its,k,jm)+0.5*g_ru(its,k,jp)<a name='3097'>
      uw = 0.5*(ru(its,k,jp)+ru(its,k,jm))<a name='3098'>
      g_ub = g_uw*(0.5+sign(0.5,0.-uw))<a name='3099'>
      ub = min(uw,0.)<a name='3100'>
      g_dup = g_ru(its+1,k,jp)-g_ru(its,k,jp)<a name='3101'>
      dup = ru(its+1,k,jp)-ru(its,k,jp)<a name='3102'>
      g_dum = g_ru(its+1,k,jm)-g_ru(its,k,jm)<a name='3103'>
      dum = ru(its+1,k,jm)-ru(its,k,jm)<a name='3104'>
      g_tendency(its,k,j) = (-(0.5*g_dum*mrdx*v(its,k,j)))-0.5*g_dup*mrdx*v(its,k,j)+g_tendency(its,k,j)-g_ub*mrdx*(v_old(its+1,k,&amp;<a name='3105'>
&amp;j)-v_old(its,k,j))-0.5*g_v(its,k,j)*mrdx*(dup+dum)-g_v_old(its+1,k,j)*mrdx*ub+g_v_old(its,k,j)*mrdx*ub<a name='3106'>
      tendency(its,k,j) = tendency(its,k,j)-mrdx*(ub*(v_old(its+1,k,j)-v_old(its,k,j))+0.5*v(its,k,j)*(dup+dum))<a name='3107'>
    end do<a name='3108'>
  end do<a name='3109'>
endif<a name='3110'>
if (config_flags%open_xe .and. ite .eq. ide) then<a name='3111'>
  do j = j_start, j_end<a name='3112'>
    mrdx = msfv(ite-1,j)*rdx<a name='3113'>
    jp = min(jmax,j)<a name='3114'>
    jm = max(jmin,j-1)<a name='3115'>
    do k = kts, ktf<a name='3116'>
      g_uw = 0.5*g_ru(ite,k,jm)+0.5*g_ru(ite,k,jp)<a name='3117'>
      uw = 0.5*(ru(ite,k,jp)+ru(ite,k,jm))<a name='3118'>
      g_ub = g_uw*(0.5+sign(0.5,uw-0.))<a name='3119'>
      ub = max(uw,0.)<a name='3120'>
      g_dup = (-g_ru(ite-1,k,jp))+g_ru(ite,k,jp)<a name='3121'>
      dup = ru(ite,k,jp)-ru(ite-1,k,jp)<a name='3122'>
      g_dum = (-g_ru(ite-1,k,jm))+g_ru(ite,k,jm)<a name='3123'>
      dum = ru(ite,k,jm)-ru(ite-1,k,jm)<a name='3124'>
      g_tendency(ite-1,k,j) = (-(0.5*g_dum*mrdx*v(ite-1,k,j)))-0.5*g_dup*mrdx*v(ite-1,k,j)+g_tendency(ite-1,k,j)-g_ub*mrdx*&amp;<a name='3125'>
&amp;(v_old(ite-1,k,j)-v_old(ite-2,k,j))-0.5*g_v(ite-1,k,j)*mrdx*(dup+dum)+g_v_old(ite-2,k,j)*mrdx*ub-g_v_old(ite-1,k,j)*mrdx*ub<a name='3126'>
      tendency(ite-1,k,j) = tendency(ite-1,k,j)-mrdx*(ub*(v_old(ite-1,k,j)-v_old(ite-2,k,j))+0.5*v(ite-1,k,j)*(dup+dum))<a name='3127'>
    end do<a name='3128'>
  end do<a name='3129'>
endif<a name='3130'>
i_start = its<a name='3131'>
i_end = min(ite,ide-1)<a name='3132'>
j_start = jts<a name='3133'>
j_end = jte<a name='3134'>
do i = i_start, i_end<a name='3135'>
  g_vflux(i,kts) = 0.<a name='3136'>
  vflux(i,kts) = 0.<a name='3137'>
  g_vflux(i,kte) = 0.<a name='3138'>
  vflux(i,kte) = 0.<a name='3139'>
end do<a name='3140'>
if (config_flags%open_ys .or. specified) then<a name='3141'>
  j_start = max(jds+1,jts)<a name='3142'>
endif<a name='3143'>
if (config_flags%open_ye .or. specified) then<a name='3144'>
  j_end = min(jde-1,jte)<a name='3145'>
endif<a name='3146'>
vert_order_tesu: if (vert_order .eq. 6) then<a name='3147'>
  do j = j_start, j_end<a name='3148'>
    do k = kts+3, ktf-2<a name='3149'>
      do i = i_start, i_end<a name='3150'>
        g_vel = 0.5*g_rom(i,k,j-1)+0.5*g_rom(i,k,j)<a name='3151'>
        vel = 0.5*(rom(i,k,j)+rom(i,k,j-1))<a name='3152'>
        g_vflux(i,k) = 0.016666667*g_v(i,k-3,j)*vel-0.13333333*g_v(i,k-2,j)*vel+0.61666667*g_v(i,k-1,j)*vel+0.016666667*g_v(i,k+2,&amp;<a name='3153'>
&amp;j)*vel-0.13333333*g_v(i,k+1,j)*vel+0.61666667*g_v(i,k,j)*vel+g_vel*(0.61666667*(v(i,k,j)+v(i,k-1,j))-0.13333333*(v(i,k+1,&amp;<a name='3154'>
&amp;j)+v(i,k-2,j))+0.016666667*(v(i,k+2,j)+v(i,k-3,j)))<a name='3155'>
        vflux(i,k) = vel*(37./60.*(v(i,k,j)+v(i,k-1,j))-2./15.*(v(i,k+1,j)+v(i,k-2,j))+1./60.*(v(i,k+2,j)+v(i,k-3,j)))<a name='3156'>
      end do<a name='3157'>
    end do<a name='3158'>
    do i = i_start, i_end<a name='3159'>
      k = kts+1<a name='3160'>
      g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3161'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3162'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3163'>
      k = kts+2<a name='3164'>
      g_vel = 0.5*g_rom(i,k,j-1)+0.5*g_rom(i,k,j)<a name='3165'>
      vel = 0.5*(rom(i,k,j)+rom(i,k,j-1))<a name='3166'>
      g_vflux(i,k) = (-0.083333333)*g_v(i,k-2,j)*vel+0.58333333*g_v(i,k-1,j)*vel-0.083333333*g_v(i,k+1,j)*vel+0.58333333*g_v(i,k,j)&amp;<a name='3167'>
&amp;*vel+g_vel*(0.58333333*(v(i,k,j)+v(i,k-1,j))-0.083333333*(v(i,k+1,j)+v(i,k-2,j)))<a name='3168'>
      vflux(i,k) = vel*(7./12.*(v(i,k,j)+v(i,k-1,j))-1./12.*(v(i,k+1,j)+v(i,k-2,j)))<a name='3169'>
      k = ktf-1<a name='3170'>
      g_vel = 0.5*g_rom(i,k,j-1)+0.5*g_rom(i,k,j)<a name='3171'>
      vel = 0.5*(rom(i,k,j)+rom(i,k,j-1))<a name='3172'>
      g_vflux(i,k) = (-0.083333333)*g_v(i,k-2,j)*vel+0.58333333*g_v(i,k-1,j)*vel-0.083333333*g_v(i,k+1,j)*vel+0.58333333*g_v(i,k,j)&amp;<a name='3173'>
&amp;*vel+g_vel*(0.58333333*(v(i,k,j)+v(i,k-1,j))-0.083333333*(v(i,k+1,j)+v(i,k-2,j)))<a name='3174'>
      vflux(i,k) = vel*(7./12.*(v(i,k,j)+v(i,k-1,j))-1./12.*(v(i,k+1,j)+v(i,k-2,j)))<a name='3175'>
      k = ktf<a name='3176'>
      g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3177'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3178'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3179'>
    end do<a name='3180'>
    do k = kts, ktf<a name='3181'>
      do i = i_start, i_end<a name='3182'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='3183'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='3184'>
      end do<a name='3185'>
    end do<a name='3186'>
  end do<a name='3187'>
else if (vert_order .eq. 5) then vert_order_tesu<a name='3188'>
  do j = j_start, j_end<a name='3189'>
    do k = kts+3, ktf-2<a name='3190'>
      do i = i_start, i_end<a name='3191'>
        g_vel = 0.5*g_rom(i,k,j-1)+0.5*g_rom(i,k,j)<a name='3192'>
        vel = 0.5*(rom(i,k,j)+rom(i,k,j-1))<a name='3193'>
        g_vflux(i,k) = g_v(i,k-3,j)*vel*(0.016666667-(-0.016666667)*sign(1.,-vel))+g_v(i,k-2,j)*vel*((-0.13333333)-0.083333333*&amp;<a name='3194'>
&amp;sign(1.,-vel))+g_v(i,k-1,j)*vel*(0.61666667-(-0.16666667)*sign(1.,-vel))+g_v(i,k+2,j)*vel*(0.016666667-0.016666667*&amp;<a name='3195'>
&amp;sign(1.,-vel))+g_v(i,k+1,j)*vel*((-0.13333333)-(-0.083333333)*sign(1.,-vel))+g_v(i,k,j)*vel*(0.61666667-0.16666667*&amp;<a name='3196'>
&amp;sign(1.,-vel))+g_vel*(0.61666667*(v(i,k,j)+v(i,k-1,j))-0.13333333*(v(i,k+1,j)+v(i,k-2,j))+0.016666667*(v(i,k+2,j)+v(i,k-3,&amp;<a name='3197'>
&amp;j))-0.016666667*(v(i,k+2,j)-v(i,k-3,j)-5.*(v(i,k+1,j)-v(i,k-2,j))+10.*(v(i,k,j)-v(i,k-1,j)))*sign(1.,-vel))<a name='3198'>
        vflux(i,k) = vel*(37./60.*(v(i,k,j)+v(i,k-1,j))-2./15.*(v(i,k+1,j)+v(i,k-2,j))+1./60.*(v(i,k+2,j)+v(i,k-3,j))-sign(1.,-vel)&amp;<a name='3199'>
&amp;*(1./60.)*(v(i,k+2,j)-v(i,k-3,j)-5.*(v(i,k+1,j)-v(i,k-2,j))+10.*(v(i,k,j)-v(i,k-1,j))))<a name='3200'>
      end do<a name='3201'>
    end do<a name='3202'>
    do i = i_start, i_end<a name='3203'>
      k = kts+1<a name='3204'>
      g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3205'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3206'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3207'>
      k = kts+2<a name='3208'>
      g_vel = 0.5*g_rom(i,k,j-1)+0.5*g_rom(i,k,j)<a name='3209'>
      vel = 0.5*(rom(i,k,j)+rom(i,k,j-1))<a name='3210'>
      g_vflux(i,k) = g_v(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_v(i,k-1,j)*vel*(0.58333333+0.25*sign(1.,-vel)&amp;<a name='3211'>
&amp;)+g_v(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,-vel))+g_vel*&amp;<a name='3212'>
&amp;(0.58333333*(v(i,k,j)+v(i,k-1,j))-0.083333333*(v(i,k+1,j)+v(i,k-2,j))+0.083333333*(v(i,k+1,j)-v(i,k-2,j)-3.*(v(i,k,j)-v(i,k-&amp;<a name='3213'>
&amp;1,j)))*sign(1.,-vel))<a name='3214'>
      vflux(i,k) = vel*(7./12.*(v(i,k,j)+v(i,k-1,j))-1./12.*(v(i,k+1,j)+v(i,k-2,j))+sign(1.,-vel)*(1./12.)*(v(i,k+1,j)-v(i,k-2,j)-&amp;<a name='3215'>
&amp;3.*(v(i,k,j)-v(i,k-1,j))))<a name='3216'>
      k = ktf-1<a name='3217'>
      g_vel = 0.5*g_rom(i,k,j-1)+0.5*g_rom(i,k,j)<a name='3218'>
      vel = 0.5*(rom(i,k,j)+rom(i,k,j-1))<a name='3219'>
      g_vflux(i,k) = g_v(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_v(i,k-1,j)*vel*(0.58333333+0.25*sign(1.,-vel)&amp;<a name='3220'>
&amp;)+g_v(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,-vel))+g_vel*&amp;<a name='3221'>
&amp;(0.58333333*(v(i,k,j)+v(i,k-1,j))-0.083333333*(v(i,k+1,j)+v(i,k-2,j))+0.083333333*(v(i,k+1,j)-v(i,k-2,j)-3.*(v(i,k,j)-v(i,k-&amp;<a name='3222'>
&amp;1,j)))*sign(1.,-vel))<a name='3223'>
      vflux(i,k) = vel*(7./12.*(v(i,k,j)+v(i,k-1,j))-1./12.*(v(i,k+1,j)+v(i,k-2,j))+sign(1.,-vel)*(1./12.)*(v(i,k+1,j)-v(i,k-2,j)-&amp;<a name='3224'>
&amp;3.*(v(i,k,j)-v(i,k-1,j))))<a name='3225'>
      k = ktf<a name='3226'>
      g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3227'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3228'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3229'>
    end do<a name='3230'>
    do k = kts, ktf<a name='3231'>
      do i = i_start, i_end<a name='3232'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='3233'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='3234'>
      end do<a name='3235'>
    end do<a name='3236'>
  end do<a name='3237'>
else if (vert_order .eq. 4) then vert_order_tesu<a name='3238'>
  do j = j_start, j_end<a name='3239'>
    do k = kts+2, ktf-1<a name='3240'>
      do i = i_start, i_end<a name='3241'>
        g_vel = 0.5*g_rom(i,k,j-1)+0.5*g_rom(i,k,j)<a name='3242'>
        vel = 0.5*(rom(i,k,j)+rom(i,k,j-1))<a name='3243'>
        g_vflux(i,k) = (-0.083333333)*g_v(i,k-2,j)*vel+0.58333333*g_v(i,k-1,j)*vel-0.083333333*g_v(i,k+1,j)*vel+0.58333333*g_v(i,k,&amp;<a name='3244'>
&amp;j)*vel+g_vel*(0.58333333*(v(i,k,j)+v(i,k-1,j))-0.083333333*(v(i,k+1,j)+v(i,k-2,j)))<a name='3245'>
        vflux(i,k) = vel*(7./12.*(v(i,k,j)+v(i,k-1,j))-1./12.*(v(i,k+1,j)+v(i,k-2,j)))<a name='3246'>
      end do<a name='3247'>
    end do<a name='3248'>
    do i = i_start, i_end<a name='3249'>
      k = kts+1<a name='3250'>
      g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3251'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3252'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3253'>
      k = ktf<a name='3254'>
      g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3255'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3256'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3257'>
    end do<a name='3258'>
    do k = kts, ktf<a name='3259'>
      do i = i_start, i_end<a name='3260'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='3261'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='3262'>
      end do<a name='3263'>
    end do<a name='3264'>
  end do<a name='3265'>
else if (vert_order .eq. 3) then vert_order_tesu<a name='3266'>
  do j = j_start, j_end<a name='3267'>
    do k = kts+2, ktf-1<a name='3268'>
      do i = i_start, i_end<a name='3269'>
        g_vel = 0.5*g_rom(i,k,j-1)+0.5*g_rom(i,k,j)<a name='3270'>
        vel = 0.5*(rom(i,k,j)+rom(i,k,j-1))<a name='3271'>
        g_vflux(i,k) = g_v(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_v(i,k-1,j)*vel*(0.58333333+0.25*sign(1.,-&amp;<a name='3272'>
&amp;vel))+g_v(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_v(i,k,j)*vel*(0.58333333+(-0.25)*sign(1.,-vel))+g_vel*&amp;<a name='3273'>
&amp;(0.58333333*(v(i,k,j)+v(i,k-1,j))-0.083333333*(v(i,k+1,j)+v(i,k-2,j))+0.083333333*(v(i,k+1,j)-v(i,k-2,j)-3.*(v(i,k,j)-v(i,&amp;<a name='3274'>
&amp;k-1,j)))*sign(1.,-vel))<a name='3275'>
        vflux(i,k) = vel*(7./12.*(v(i,k,j)+v(i,k-1,j))-1./12.*(v(i,k+1,j)+v(i,k-2,j))+sign(1.,-vel)*(1./12.)*(v(i,k+1,j)-v(i,k-2,j)&amp;<a name='3276'>
&amp;-3.*(v(i,k,j)-v(i,k-1,j))))<a name='3277'>
      end do<a name='3278'>
    end do<a name='3279'>
    do i = i_start, i_end<a name='3280'>
      k = kts+1<a name='3281'>
      g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3282'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3283'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3284'>
      k = ktf<a name='3285'>
      g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3286'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3287'>
      vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3288'>
    end do<a name='3289'>
    do k = kts, ktf<a name='3290'>
      do i = i_start, i_end<a name='3291'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='3292'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='3293'>
      end do<a name='3294'>
    end do<a name='3295'>
  end do<a name='3296'>
else if (vert_order .eq. 2) then vert_order_tesu<a name='3297'>
  do j = j_start, j_end<a name='3298'>
    do k = kts+1, ktf<a name='3299'>
      do i = i_start, i_end<a name='3300'>
        g_vflux(i,k) = 0.5*g_rom(i,k,j-1)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+0.5*g_rom(i,k,j)*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))+&amp;<a name='3301'>
&amp;0.5*g_v(i,k-1,j)*(rom(i,k,j)+rom(i,k,j-1))*fzp(k)+0.5*g_v(i,k,j)*(rom(i,k,j)+rom(i,k,j-1))*fzm(k)<a name='3302'>
        vflux(i,k) = 0.5*(rom(i,k,j)+rom(i,k,j-1))*(fzm(k)*v(i,k,j)+fzp(k)*v(i,k-1,j))<a name='3303'>
      end do<a name='3304'>
    end do<a name='3305'>
    do k = kts, ktf<a name='3306'>
      do i = i_start, i_end<a name='3307'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzw(k)+g_vflux(i,k)*rdzw(k)<a name='3308'>
        tendency(i,k,j) = tendency(i,k,j)-rdzw(k)*(vflux(i,k+1)-vflux(i,k))<a name='3309'>
      end do<a name='3310'>
    end do<a name='3311'>
  end do<a name='3312'>
endif vert_order_tesu<a name='3313'>
<a name='3314'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_V' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_8">("g_advect_v")<a name='3315'>
<a name='3316'>
end subroutine g_advect_v<a name='3317'>
<a name='3318'>
<a name='3319'>
<A NAME='G_ADVECT_W'><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3320'>
<font color=#993300>subroutine </font><font color=#cc0000>g_advect_w</font>( w, g_w, w_old, g_w_old, tendency, g_tendency, ru, g_ru, rv, g_rv, rom, g_rom, config_flags, msft, fzm, fzp, &amp; <A href='../../call_to/G_ADVECT_W.html' TARGET='index'>2</A>,<A href='../../call_from/G_ADVECT_W.html' TARGET='index'>2</A><a name='3321'>
&amp;rdx, rdy, rdzu, ids, ide, jds, jde, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte )<a name='3322'>
<font color=#447700>!******************************************************************<a name='3323'></font>
<font color=#447700>!******************************************************************<a name='3324'></font>
<font color=#447700>!** This routine was generated by Automatic differentiation.     **<a name='3325'></font>
<font color=#447700>!** FastOpt: Transformation of Algorithm in Fortran, TAF 1.7.18  **<a name='3326'></font>
<font color=#447700>!******************************************************************<a name='3327'></font>
<font color=#447700>!******************************************************************<a name='3328'></font>
<font color=#447700>!==============================================<a name='3329'></font>
<font color=#447700>! all entries are defined explicitly<a name='3330'></font>
<font color=#447700>!==============================================<a name='3331'></font>
implicit none<a name='3332'>
<a name='3333'>
<font color=#447700>!==============================================<a name='3334'></font>
<font color=#447700>! declare arguments<a name='3335'></font>
<font color=#447700>!==============================================<a name='3336'></font>
type (grid_config_rec_type), intent(in) :: config_flags<a name='3337'>
integer, intent(in) :: kme<a name='3338'>
integer, intent(in) :: kms<a name='3339'>
real, intent(in) :: fzm(kms:kme)<a name='3340'>
real, intent(in) :: fzp(kms:kme)<a name='3341'>
integer, intent(in) :: ime<a name='3342'>
integer, intent(in) :: ims<a name='3343'>
integer, intent(in) :: jme<a name='3344'>
integer, intent(in) :: jms<a name='3345'>
real, intent(in) :: g_rom(ims:ime,kms:kme,jms:jme)<a name='3346'>
real, intent(in) :: g_ru(ims:ime,kms:kme,jms:jme)<a name='3347'>
real, intent(in) :: g_rv(ims:ime,kms:kme,jms:jme)<a name='3348'>
real, intent(inout) :: g_tendency(ims:ime,kms:kme,jms:jme)<a name='3349'>
real, intent(in) :: g_w(ims:ime,kms:kme,jms:jme)<a name='3350'>
real, intent(in) :: g_w_old(ims:ime,kms:kme,jms:jme)<a name='3351'>
integer, intent(in) :: ide<a name='3352'>
integer, intent(in) :: ids<a name='3353'>
integer, intent(in) :: ite<a name='3354'>
integer, intent(in) :: its<a name='3355'>
integer, intent(in) :: jde<a name='3356'>
integer, intent(in) :: jds<a name='3357'>
integer, intent(in) :: jte<a name='3358'>
integer, intent(in) :: jts<a name='3359'>
integer, intent(in) :: kde<a name='3360'>
integer, intent(in) :: kte<a name='3361'>
integer, intent(in) :: kts<a name='3362'>
real, intent(in) :: msft(ims:ime,jms:jme)<a name='3363'>
real, intent(in) :: rdx<a name='3364'>
real, intent(in) :: rdy<a name='3365'>
real, intent(in) :: rdzu(kms:kme)<a name='3366'>
real, intent(in) :: rom(ims:ime,kms:kme,jms:jme)<a name='3367'>
real, intent(in) :: ru(ims:ime,kms:kme,jms:jme)<a name='3368'>
real, intent(in) :: rv(ims:ime,kms:kme,jms:jme)<a name='3369'>
real, intent(inout) :: tendency(ims:ime,kms:kme,jms:jme)<a name='3370'>
real, intent(in) :: w(ims:ime,kms:kme,jms:jme)<a name='3371'>
real, intent(in) :: w_old(ims:ime,kms:kme,jms:jme)<a name='3372'>
<a name='3373'>
<font color=#447700>!==============================================<a name='3374'></font>
<font color=#447700>! declare local variables<a name='3375'></font>
<font color=#447700>!==============================================<a name='3376'></font>
logical degrade_xe<a name='3377'>
logical degrade_xs<a name='3378'>
logical degrade_ye<a name='3379'>
logical degrade_ys<a name='3380'>
real fqx(its:ite+1,kts:kte)<a name='3381'>
real fqy(its:ite,kts:kte,2)<a name='3382'>
real g_fqx(its:ite+1,kts:kte)<a name='3383'>
real g_fqy(its:ite,kts:kte,2)<a name='3384'>
real g_ub<a name='3385'>
real g_uw<a name='3386'>
real g_vb<a name='3387'>
real g_vel<a name='3388'>
real g_vflux(its:ite,kts:kte)<a name='3389'>
real g_vw<a name='3390'>
integer horz_order<a name='3391'>
integer i<a name='3392'>
integer i_end<a name='3393'>
integer i_end_f<a name='3394'>
integer i_start<a name='3395'>
integer i_start_f<a name='3396'>
integer j<a name='3397'>
integer j_end<a name='3398'>
integer j_end_f<a name='3399'>
integer j_start<a name='3400'>
integer j_start_f<a name='3401'>
integer jp0<a name='3402'>
integer jp1<a name='3403'>
integer jtmp<a name='3404'>
integer k<a name='3405'>
integer ktf<a name='3406'>
real mrdx<a name='3407'>
real mrdy<a name='3408'>
logical specified<a name='3409'>
real ub<a name='3410'>
real uw<a name='3411'>
real vb<a name='3412'>
real vel<a name='3413'>
integer vert_order<a name='3414'>
real vflux(its:ite,kts:kte)<a name='3415'>
real vw<a name='3416'>
<a name='3417'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_ENTRY'>trace_entry</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_ENTRY_9">("g_advect_w")<a name='3418'>
<a name='3419'>
<font color=#447700>!----------------------------------------------<a name='3420'></font>
<font color=#447700>! TANGENT LINEAR AND FUNCTION STATEMENTS<a name='3421'></font>
<font color=#447700>!----------------------------------------------<a name='3422'></font>
specified =  .false. <a name='3423'>
if (config_flags%specified .or. config_flags%nested) then<a name='3424'>
  specified =  .true. <a name='3425'>
endif<a name='3426'>
ktf = min(kte,kde-1)<a name='3427'>
horz_order = config_flags%h_sca_adv_order<a name='3428'>
vert_order = config_flags%v_sca_adv_order<a name='3429'>
horizontal_order_tesu: if (horz_order .eq. 6) then<a name='3430'>
  degrade_xs =  .true. <a name='3431'>
  degrade_xe =  .true. <a name='3432'>
  degrade_ys =  .true. <a name='3433'>
  degrade_ye =  .true. <a name='3434'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+2) then<a name='3435'>
    degrade_xs =  .false. <a name='3436'>
  endif<a name='3437'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-3) then<a name='3438'>
    degrade_xe =  .false. <a name='3439'>
  endif<a name='3440'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+2) then<a name='3441'>
    degrade_ys =  .false. <a name='3442'>
  endif<a name='3443'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-3) then<a name='3444'>
    degrade_ye =  .false. <a name='3445'>
  endif<a name='3446'>
  i_start = its<a name='3447'>
  i_end = min(ite,ide-1)<a name='3448'>
  j_start = jts<a name='3449'>
  j_end = min(jte,jde-1)<a name='3450'>
  j_start_f = j_start<a name='3451'>
  j_end_f = j_end+1<a name='3452'>
  if (degrade_ys) then<a name='3453'>
    j_start = max(jts,jds+1)<a name='3454'>
    j_start_f = jds+3<a name='3455'>
  endif<a name='3456'>
  if (degrade_ye) then<a name='3457'>
    j_end = min(jte,jde-2)<a name='3458'>
    j_end_f = jde-3<a name='3459'>
  endif<a name='3460'>
  jp1 = 2<a name='3461'>
  jp0 = 1<a name='3462'>
  j_loop_y_flux_6: do j = j_start, j_end+1<a name='3463'>
    if (j .ge. j_start_f .and. j .le. j_end_f) then<a name='3464'>
      do k = kts+1, ktf<a name='3465'>
        do i = i_start, i_end<a name='3466'>
          g_vel = g_rv(i,k-1,j)*fzp(k)+g_rv(i,k,j)*fzm(k)<a name='3467'>
          vel = fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)<a name='3468'>
          g_fqy(i,k,jp1) = g_vel*(0.61666667*(w(i,k,j)+w(i,k,j-1))-0.13333333*(w(i,k,j+1)+w(i,k,j-2))+0.016666667*(w(i,k,j+2)+w(i,&amp;<a name='3469'>
&amp;k,j-3)))+0.016666667*g_w(i,k,j-3)*vel-0.13333333*g_w(i,k,j-2)*vel+0.61666667*g_w(i,k,j-1)*vel+0.016666667*g_w(i,k,j+2)*&amp;<a name='3470'>
&amp;vel-0.13333333*g_w(i,k,j+1)*vel+0.61666667*g_w(i,k,j)*vel<a name='3471'>
          fqy(i,k,jp1) = vel*(37./60.*(w(i,k,j)+w(i,k,j-1))-2./15.*(w(i,k,j+1)+w(i,k,j-2))+1./60.*(w(i,k,j+2)+w(i,k,j-3)))<a name='3472'>
        end do<a name='3473'>
      end do<a name='3474'>
      k = ktf+1<a name='3475'>
      do i = i_start, i_end<a name='3476'>
        g_vel = (-(g_rv(i,k-2,j)*fzp(k-1)))+g_rv(i,k-1,j)*(2-fzm(k-1))<a name='3477'>
        vel = (2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)<a name='3478'>
        g_fqy(i,k,jp1) = g_vel*(0.61666667*(w(i,k,j)+w(i,k,j-1))-0.13333333*(w(i,k,j+1)+w(i,k,j-2))+0.016666667*(w(i,k,j+2)+w(i,k,&amp;<a name='3479'>
&amp;j-3)))+0.016666667*g_w(i,k,j-3)*vel-0.13333333*g_w(i,k,j-2)*vel+0.61666667*g_w(i,k,j-1)*vel+0.016666667*g_w(i,k,j+2)*vel-&amp;<a name='3480'>
&amp;0.13333333*g_w(i,k,j+1)*vel+0.61666667*g_w(i,k,j)*vel<a name='3481'>
        fqy(i,k,jp1) = vel*(37./60.*(w(i,k,j)+w(i,k,j-1))-2./15.*(w(i,k,j+1)+w(i,k,j-2))+1./60.*(w(i,k,j+2)+w(i,k,j-3)))<a name='3482'>
      end do<a name='3483'>
    else if (j .eq. jds+1) then<a name='3484'>
      do k = kts+1, ktf<a name='3485'>
        do i = i_start, i_end<a name='3486'>
          g_fqy(i,k,jp1) = 0.5*g_rv(i,k-1,j)*fzp(k)*(w(i,k,j)+w(i,k,j-1))+0.5*g_rv(i,k,j)*fzm(k)*(w(i,k,j)+w(i,k,j-1))+0.5*g_w(i,k,&amp;<a name='3487'>
&amp;j-1)*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))+0.5*g_w(i,k,j)*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))<a name='3488'>
          fqy(i,k,jp1) = 0.5*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))*(w(i,k,j)+w(i,k,j-1))<a name='3489'>
        end do<a name='3490'>
      end do<a name='3491'>
      k = ktf+1<a name='3492'>
      do i = i_start, i_end<a name='3493'>
        g_fqy(i,k,jp1) = (-(0.5*g_rv(i,k-2,j)*fzp(k-1)*(w(i,k,j)+w(i,k,j-1))))+0.5*g_rv(i,k-1,j)*(2-fzm(k-1))*(w(i,k,j)+w(i,k,j-1))&amp;<a name='3494'>
&amp;+0.5*g_w(i,k,j-1)*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))+0.5*g_w(i,k,j)*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))<a name='3495'>
        fqy(i,k,jp1) = 0.5*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))*(w(i,k,j)+w(i,k,j-1))<a name='3496'>
      end do<a name='3497'>
    else if (j .eq. jds+2) then<a name='3498'>
      do k = kts+1, ktf<a name='3499'>
        do i = i_start, i_end<a name='3500'>
          g_vel = g_rv(i,k-1,j)*fzp(k)+g_rv(i,k,j)*fzm(k)<a name='3501'>
          vel = fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)<a name='3502'>
          g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2)))-0.083333333*g_w(i,k,j-2)*&amp;<a name='3503'>
&amp;vel+0.58333333*g_w(i,k,j-1)*vel-0.083333333*g_w(i,k,j+1)*vel+0.58333333*g_w(i,k,j)*vel<a name='3504'>
          fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2)))<a name='3505'>
        end do<a name='3506'>
      end do<a name='3507'>
      k = ktf+1<a name='3508'>
      do i = i_start, i_end<a name='3509'>
        g_vel = (-(g_rv(i,k-2,j)*fzp(k-1)))+g_rv(i,k-1,j)*(2-fzm(k-1))<a name='3510'>
        vel = (2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)<a name='3511'>
        g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2)))-0.083333333*g_w(i,k,j-2)*vel+&amp;<a name='3512'>
&amp;0.58333333*g_w(i,k,j-1)*vel-0.083333333*g_w(i,k,j+1)*vel+0.58333333*g_w(i,k,j)*vel<a name='3513'>
        fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2)))<a name='3514'>
      end do<a name='3515'>
    else if (j .eq. jde-1) then<a name='3516'>
      do k = kts+1, ktf<a name='3517'>
        do i = i_start, i_end<a name='3518'>
          g_fqy(i,k,jp1) = 0.5*g_rv(i,k-1,j)*fzp(k)*(w(i,k,j)+w(i,k,j-1))+0.5*g_rv(i,k,j)*fzm(k)*(w(i,k,j)+w(i,k,j-1))+0.5*g_w(i,k,&amp;<a name='3519'>
&amp;j-1)*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))+0.5*g_w(i,k,j)*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))<a name='3520'>
          fqy(i,k,jp1) = 0.5*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))*(w(i,k,j)+w(i,k,j-1))<a name='3521'>
        end do<a name='3522'>
      end do<a name='3523'>
      k = ktf+1<a name='3524'>
      do i = i_start, i_end<a name='3525'>
        g_fqy(i,k,jp1) = (-(0.5*g_rv(i,k-2,j)*fzp(k-1)*(w(i,k,j)+w(i,k,j-1))))+0.5*g_rv(i,k-1,j)*(2-fzm(k-1))*(w(i,k,j)+w(i,k,j-1))&amp;<a name='3526'>
&amp;+0.5*g_w(i,k,j-1)*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))+0.5*g_w(i,k,j)*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))<a name='3527'>
        fqy(i,k,jp1) = 0.5*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))*(w(i,k,j)+w(i,k,j-1))<a name='3528'>
      end do<a name='3529'>
    else if (j .eq. jde-2) then<a name='3530'>
      do k = kts+1, ktf<a name='3531'>
        do i = i_start, i_end<a name='3532'>
          g_vel = g_rv(i,k-1,j)*fzp(k)+g_rv(i,k,j)*fzm(k)<a name='3533'>
          vel = fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)<a name='3534'>
          g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2)))-0.083333333*g_w(i,k,j-2)*&amp;<a name='3535'>
&amp;vel+0.58333333*g_w(i,k,j-1)*vel-0.083333333*g_w(i,k,j+1)*vel+0.58333333*g_w(i,k,j)*vel<a name='3536'>
          fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2)))<a name='3537'>
        end do<a name='3538'>
      end do<a name='3539'>
      k = ktf+1<a name='3540'>
      do i = i_start, i_end<a name='3541'>
        g_vel = (-(g_rv(i,k-2,j)*fzp(k-1)))+g_rv(i,k-1,j)*(2-fzm(k-1))<a name='3542'>
        vel = (2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)<a name='3543'>
        g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2)))-0.083333333*g_w(i,k,j-2)*vel+&amp;<a name='3544'>
&amp;0.58333333*g_w(i,k,j-1)*vel-0.083333333*g_w(i,k,j+1)*vel+0.58333333*g_w(i,k,j)*vel<a name='3545'>
        fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2)))<a name='3546'>
      end do<a name='3547'>
    endif<a name='3548'>
    if (j .gt. j_start) then<a name='3549'>
      do k = kts+1, ktf+1<a name='3550'>
        do i = i_start, i_end<a name='3551'>
          mrdy = msft(i,j-1)*rdy<a name='3552'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='3553'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='3554'>
        end do<a name='3555'>
      end do<a name='3556'>
    endif<a name='3557'>
    jtmp = jp1<a name='3558'>
    jp1 = jp0<a name='3559'>
    jp0 = jtmp<a name='3560'>
  end do j_loop_y_flux_6<a name='3561'>
  i_start = its<a name='3562'>
  i_end = min(ite,ide-1)<a name='3563'>
  j_start = jts<a name='3564'>
  j_end = min(jte,jde-1)<a name='3565'>
  i_start_f = i_start<a name='3566'>
  i_end_f = i_end+1<a name='3567'>
  if (degrade_xs) then<a name='3568'>
    i_start = max(ids+1,its)<a name='3569'>
    i_start_f = i_start+2<a name='3570'>
  endif<a name='3571'>
  if (degrade_xe) then<a name='3572'>
    i_end = min(ide-2,ite)<a name='3573'>
    i_end_f = ide-3<a name='3574'>
  endif<a name='3575'>
  do j = j_start, j_end<a name='3576'>
    do k = kts+1, ktf<a name='3577'>
      do i = i_start_f, i_end_f<a name='3578'>
        g_vel = g_ru(i,k-1,j)*fzp(k)+g_ru(i,k,j)*fzm(k)<a name='3579'>
        vel = fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)<a name='3580'>
        g_fqx(i,k) = g_vel*(0.61666667*(w(i,k,j)+w(i-1,k,j))-0.13333333*(w(i+1,k,j)+w(i-2,k,j))+0.016666667*(w(i+2,k,j)+w(i-3,k,j))&amp;<a name='3581'>
&amp;)+0.016666667*g_w(i-3,k,j)*vel-0.13333333*g_w(i-2,k,j)*vel+0.61666667*g_w(i-1,k,j)*vel+0.016666667*g_w(i+2,k,j)*vel-&amp;<a name='3582'>
&amp;0.13333333*g_w(i+1,k,j)*vel+0.61666667*g_w(i,k,j)*vel<a name='3583'>
        fqx(i,k) = vel*(37./60.*(w(i,k,j)+w(i-1,k,j))-2./15.*(w(i+1,k,j)+w(i-2,k,j))+1./60.*(w(i+2,k,j)+w(i-3,k,j)))<a name='3584'>
      end do<a name='3585'>
    end do<a name='3586'>
    k = ktf+1<a name='3587'>
    do i = i_start_f, i_end_f<a name='3588'>
      g_vel = (-(g_ru(i,k-2,j)*fzp(k-1)))+g_ru(i,k-1,j)*(2-fzm(k-1))<a name='3589'>
      vel = (2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)<a name='3590'>
      g_fqx(i,k) = g_vel*(0.61666667*(w(i,k,j)+w(i-1,k,j))-0.13333333*(w(i+1,k,j)+w(i-2,k,j))+0.016666667*(w(i+2,k,j)+w(i-3,k,j)))+&amp;<a name='3591'>
&amp;0.016666667*g_w(i-3,k,j)*vel-0.13333333*g_w(i-2,k,j)*vel+0.61666667*g_w(i-1,k,j)*vel+0.016666667*g_w(i+2,k,j)*vel-&amp;<a name='3592'>
&amp;0.13333333*g_w(i+1,k,j)*vel+0.61666667*g_w(i,k,j)*vel<a name='3593'>
      fqx(i,k) = vel*(37./60.*(w(i,k,j)+w(i-1,k,j))-2./15.*(w(i+1,k,j)+w(i-2,k,j))+1./60.*(w(i+2,k,j)+w(i-3,k,j)))<a name='3594'>
    end do<a name='3595'>
    if (degrade_xs) then<a name='3596'>
      if (i_start .eq. ids+1) then<a name='3597'>
        i = ids+1<a name='3598'>
        do k = kts+1, ktf<a name='3599'>
          g_fqx(i,k) = 0.5*g_ru(i,k-1,j)*fzp(k)*(w(i,k,j)+w(i-1,k,j))+0.5*g_ru(i,k,j)*fzm(k)*(w(i,k,j)+w(i-1,k,j))+0.5*g_w(i-1,k,j)&amp;<a name='3600'>
&amp;*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))+0.5*g_w(i,k,j)*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))<a name='3601'>
          fqx(i,k) = 0.5*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))*(w(i,k,j)+w(i-1,k,j))<a name='3602'>
        end do<a name='3603'>
        k = ktf+1<a name='3604'>
        g_fqx(i,k) = (-(0.5*g_ru(i,k-2,j)*fzp(k-1)*(w(i,k,j)+w(i-1,k,j))))+0.5*g_ru(i,k-1,j)*(2-fzm(k-1))*(w(i,k,j)+w(i-1,k,j))+&amp;<a name='3605'>
&amp;0.5*g_w(i-1,k,j)*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))+0.5*g_w(i,k,j)*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))<a name='3606'>
        fqx(i,k) = 0.5*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))*(w(i,k,j)+w(i-1,k,j))<a name='3607'>
      endif<a name='3608'>
      do k = kts+1, ktf<a name='3609'>
        i = i_start+1<a name='3610'>
        g_vel = g_ru(i,k-1,j)*fzp(k)+g_ru(i,k,j)*fzm(k)<a name='3611'>
        vel = fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)<a name='3612'>
        g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j)))-0.083333333*g_w(i-2,k,j)*vel+&amp;<a name='3613'>
&amp;0.58333333*g_w(i-1,k,j)*vel-0.083333333*g_w(i+1,k,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='3614'>
        fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j)))<a name='3615'>
      end do<a name='3616'>
      k = ktf+1<a name='3617'>
      g_vel = (-(g_ru(i,k-2,j)*fzp(k-1)))+g_ru(i,k-1,j)*(2-fzm(k-1))<a name='3618'>
      vel = (2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)<a name='3619'>
      g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j)))-0.083333333*g_w(i-2,k,j)*vel+&amp;<a name='3620'>
&amp;0.58333333*g_w(i-1,k,j)*vel-0.083333333*g_w(i+1,k,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='3621'>
      fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j)))<a name='3622'>
    endif<a name='3623'>
    if (degrade_xe) then<a name='3624'>
      if (i_end .eq. ide-2) then<a name='3625'>
        i = ide-1<a name='3626'>
        do k = kts+1, ktf<a name='3627'>
          g_fqx(i,k) = 0.5*g_ru(i,k-1,j)*fzp(k)*(w(i,k,j)+w(i-1,k,j))+0.5*g_ru(i,k,j)*fzm(k)*(w(i,k,j)+w(i-1,k,j))+0.5*g_w(i-1,k,j)&amp;<a name='3628'>
&amp;*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))+0.5*g_w(i,k,j)*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))<a name='3629'>
          fqx(i,k) = 0.5*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))*(w(i,k,j)+w(i-1,k,j))<a name='3630'>
        end do<a name='3631'>
        k = ktf+1<a name='3632'>
        g_fqx(i,k) = (-(0.5*g_ru(i,k-2,j)*fzp(k-1)*(w(i,k,j)+w(i-1,k,j))))+0.5*g_ru(i,k-1,j)*(2-fzm(k-1))*(w(i,k,j)+w(i-1,k,j))+&amp;<a name='3633'>
&amp;0.5*g_w(i-1,k,j)*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))+0.5*g_w(i,k,j)*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))<a name='3634'>
        fqx(i,k) = 0.5*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))*(w(i,k,j)+w(i-1,k,j))<a name='3635'>
      endif<a name='3636'>
      i = ide-2<a name='3637'>
      do k = kts+1, ktf<a name='3638'>
        g_vel = g_ru(i,k-1,j)*fzp(k)+g_ru(i,k,j)*fzm(k)<a name='3639'>
        vel = fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)<a name='3640'>
        g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j)))-0.083333333*g_w(i-2,k,j)*vel+&amp;<a name='3641'>
&amp;0.58333333*g_w(i-1,k,j)*vel-0.083333333*g_w(i+1,k,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='3642'>
        fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j)))<a name='3643'>
      end do<a name='3644'>
      k = ktf+1<a name='3645'>
      g_vel = (-(g_ru(i,k-2,j)*fzp(k-1)))+g_ru(i,k-1,j)*(2-fzm(k-1))<a name='3646'>
      vel = (2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)<a name='3647'>
      g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j)))-0.083333333*g_w(i-2,k,j)*vel+&amp;<a name='3648'>
&amp;0.58333333*g_w(i-1,k,j)*vel-0.083333333*g_w(i+1,k,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='3649'>
      fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j)))<a name='3650'>
    endif<a name='3651'>
    do k = kts+1, ktf+1<a name='3652'>
      do i = i_start, i_end<a name='3653'>
        mrdx = msft(i,j)*rdx<a name='3654'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='3655'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='3656'>
      end do<a name='3657'>
    end do<a name='3658'>
  end do<a name='3659'>
else if (horz_order .eq. 5) then horizontal_order_tesu<a name='3660'>
  degrade_xs =  .true. <a name='3661'>
  degrade_xe =  .true. <a name='3662'>
  degrade_ys =  .true. <a name='3663'>
  degrade_ye =  .true. <a name='3664'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+2) then<a name='3665'>
    degrade_xs =  .false. <a name='3666'>
  endif<a name='3667'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-3) then<a name='3668'>
    degrade_xe =  .false. <a name='3669'>
  endif<a name='3670'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+2) then<a name='3671'>
    degrade_ys =  .false. <a name='3672'>
  endif<a name='3673'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-3) then<a name='3674'>
    degrade_ye =  .false. <a name='3675'>
  endif<a name='3676'>
  i_start = its<a name='3677'>
  i_end = min(ite,ide-1)<a name='3678'>
  j_start = jts<a name='3679'>
  j_end = min(jte,jde-1)<a name='3680'>
  j_start_f = j_start<a name='3681'>
  j_end_f = j_end+1<a name='3682'>
  if (degrade_ys) then<a name='3683'>
    j_start = max(jts,jds+1)<a name='3684'>
    j_start_f = jds+3<a name='3685'>
  endif<a name='3686'>
  if (degrade_ye) then<a name='3687'>
    j_end = min(jte,jde-2)<a name='3688'>
    j_end_f = jde-3<a name='3689'>
  endif<a name='3690'>
  jp1 = 2<a name='3691'>
  jp0 = 1<a name='3692'>
  j_loop_y_flux_5: do j = j_start, j_end+1<a name='3693'>
    if (j .ge. j_start_f .and. j .le. j_end_f) then<a name='3694'>
      do k = kts+1, ktf<a name='3695'>
        do i = i_start, i_end<a name='3696'>
          g_vel = g_rv(i,k-1,j)*fzp(k)+g_rv(i,k,j)*fzm(k)<a name='3697'>
          vel = fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)<a name='3698'>
          g_fqy(i,k,jp1) = g_vel*(0.61666667*(w(i,k,j)+w(i,k,j-1))-0.13333333*(w(i,k,j+1)+w(i,k,j-2))+0.016666667*(w(i,k,j+2)+w(i,&amp;<a name='3699'>
&amp;k,j-3))-0.016666667*(w(i,k,j+2)-w(i,k,j-3)-5.*(w(i,k,j+1)-w(i,k,j-2))+10.*(w(i,k,j)-w(i,k,j-1)))*sign(1.,vel))+g_w(i,k,&amp;<a name='3700'>
&amp;j-3)*vel*(0.016666667-(-0.016666667)*sign(1.,vel))+g_w(i,k,j-2)*vel*((-0.13333333)-0.083333333*sign(1.,vel))+g_w(i,k,j-&amp;<a name='3701'>
&amp;1)*vel*(0.61666667-(-0.16666667)*sign(1.,vel))+g_w(i,k,j+2)*vel*(0.016666667-0.016666667*sign(1.,vel))+g_w(i,k,j+1)*vel*&amp;<a name='3702'>
&amp;((-0.13333333)-(-0.083333333)*sign(1.,vel))+g_w(i,k,j)*vel*(0.61666667-0.16666667*sign(1.,vel))<a name='3703'>
          fqy(i,k,jp1) = vel*(37./60.*(w(i,k,j)+w(i,k,j-1))-2./15.*(w(i,k,j+1)+w(i,k,j-2))+1./60.*(w(i,k,j+2)+w(i,k,j-3))-sign(1.,&amp;<a name='3704'>
&amp;vel)*(1./60.)*(w(i,k,j+2)-w(i,k,j-3)-5.*(w(i,k,j+1)-w(i,k,j-2))+10.*(w(i,k,j)-w(i,k,j-1))))<a name='3705'>
        end do<a name='3706'>
      end do<a name='3707'>
      k = ktf+1<a name='3708'>
      do i = i_start, i_end<a name='3709'>
        g_vel = (-(g_rv(i,k-2,j)*fzp(k-1)))+g_rv(i,k-1,j)*(2-fzm(k-1))<a name='3710'>
        vel = (2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)<a name='3711'>
        g_fqy(i,k,jp1) = g_vel*(0.61666667*(w(i,k,j)+w(i,k,j-1))-0.13333333*(w(i,k,j+1)+w(i,k,j-2))+0.016666667*(w(i,k,j+2)+w(i,k,&amp;<a name='3712'>
&amp;j-3))-0.016666667*(w(i,k,j+2)-w(i,k,j-3)-5.*(w(i,k,j+1)-w(i,k,j-2))+10.*(w(i,k,j)-w(i,k,j-1)))*sign(1.,vel))+g_w(i,k,j-3)*&amp;<a name='3713'>
&amp;vel*(0.016666667-(-0.016666667)*sign(1.,vel))+g_w(i,k,j-2)*vel*((-0.13333333)-0.083333333*sign(1.,vel))+g_w(i,k,j-1)*vel*&amp;<a name='3714'>
&amp;(0.61666667-(-0.16666667)*sign(1.,vel))+g_w(i,k,j+2)*vel*(0.016666667-0.016666667*sign(1.,vel))+g_w(i,k,j+1)*vel*((-&amp;<a name='3715'>
&amp;0.13333333)-(-0.083333333)*sign(1.,vel))+g_w(i,k,j)*vel*(0.61666667-0.16666667*sign(1.,vel))<a name='3716'>
        fqy(i,k,jp1) = vel*(37./60.*(w(i,k,j)+w(i,k,j-1))-2./15.*(w(i,k,j+1)+w(i,k,j-2))+1./60.*(w(i,k,j+2)+w(i,k,j-3))-sign(1.,&amp;<a name='3717'>
&amp;vel)*(1./60.)*(w(i,k,j+2)-w(i,k,j-3)-5.*(w(i,k,j+1)-w(i,k,j-2))+10.*(w(i,k,j)-w(i,k,j-1))))<a name='3718'>
      end do<a name='3719'>
    else if (j .eq. jds+1) then<a name='3720'>
      do k = kts+1, ktf<a name='3721'>
        do i = i_start, i_end<a name='3722'>
          g_fqy(i,k,jp1) = 0.5*g_rv(i,k-1,j)*fzp(k)*(w(i,k,j)+w(i,k,j-1))+0.5*g_rv(i,k,j)*fzm(k)*(w(i,k,j)+w(i,k,j-1))+0.5*g_w(i,k,&amp;<a name='3723'>
&amp;j-1)*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))+0.5*g_w(i,k,j)*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))<a name='3724'>
          fqy(i,k,jp1) = 0.5*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))*(w(i,k,j)+w(i,k,j-1))<a name='3725'>
        end do<a name='3726'>
      end do<a name='3727'>
      k = ktf+1<a name='3728'>
      do i = i_start, i_end<a name='3729'>
        g_fqy(i,k,jp1) = (-(0.5*g_rv(i,k-2,j)*fzp(k-1)*(w(i,k,j)+w(i,k,j-1))))+0.5*g_rv(i,k-1,j)*(2-fzm(k-1))*(w(i,k,j)+w(i,k,j-1))&amp;<a name='3730'>
&amp;+0.5*g_w(i,k,j-1)*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))+0.5*g_w(i,k,j)*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))<a name='3731'>
        fqy(i,k,jp1) = 0.5*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))*(w(i,k,j)+w(i,k,j-1))<a name='3732'>
      end do<a name='3733'>
    else if (j .eq. jds+2) then<a name='3734'>
      do k = kts+1, ktf<a name='3735'>
        do i = i_start, i_end<a name='3736'>
          g_vel = g_rv(i,k-1,j)*fzp(k)+g_rv(i,k,j)*fzm(k)<a name='3737'>
          vel = fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)<a name='3738'>
          g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2))+0.083333333*(w(i,k,j+1)-w(i,&amp;<a name='3739'>
&amp;k,j-2)-3.*(w(i,k,j)-w(i,k,j-1)))*sign(1.,vel))+g_w(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i,k,j-&amp;<a name='3740'>
&amp;1)*vel*(0.58333333+0.25*sign(1.,vel))+g_w(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*&amp;<a name='3741'>
&amp;(0.58333333+(-0.25)*sign(1.,vel))<a name='3742'>
          fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2))+sign(1.,vel)*(1./12.)*(w(i,k,j+1)-w(i,k,&amp;<a name='3743'>
&amp;j-2)-3.*(w(i,k,j)-w(i,k,j-1))))<a name='3744'>
        end do<a name='3745'>
      end do<a name='3746'>
      k = ktf+1<a name='3747'>
      do i = i_start, i_end<a name='3748'>
        g_vel = (-(g_rv(i,k-2,j)*fzp(k-1)))+g_rv(i,k-1,j)*(2-fzm(k-1))<a name='3749'>
        vel = (2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)<a name='3750'>
        g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2))+0.083333333*(w(i,k,j+1)-w(i,k,&amp;<a name='3751'>
&amp;j-2)-3.*(w(i,k,j)-w(i,k,j-1)))*sign(1.,vel))+g_w(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i,k,j-1)*&amp;<a name='3752'>
&amp;vel*(0.58333333+0.25*sign(1.,vel))+g_w(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+&amp;<a name='3753'>
&amp;(-0.25)*sign(1.,vel))<a name='3754'>
        fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2))+sign(1.,vel)*(1./12.)*(w(i,k,j+1)-w(i,k,j-&amp;<a name='3755'>
&amp;2)-3.*(w(i,k,j)-w(i,k,j-1))))<a name='3756'>
      end do<a name='3757'>
    else if (j .eq. jde-1) then<a name='3758'>
      do k = kts+1, ktf<a name='3759'>
        do i = i_start, i_end<a name='3760'>
          g_fqy(i,k,jp1) = 0.5*g_rv(i,k-1,j)*fzp(k)*(w(i,k,j)+w(i,k,j-1))+0.5*g_rv(i,k,j)*fzm(k)*(w(i,k,j)+w(i,k,j-1))+0.5*g_w(i,k,&amp;<a name='3761'>
&amp;j-1)*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))+0.5*g_w(i,k,j)*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))<a name='3762'>
          fqy(i,k,jp1) = 0.5*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))*(w(i,k,j)+w(i,k,j-1))<a name='3763'>
        end do<a name='3764'>
      end do<a name='3765'>
      k = ktf+1<a name='3766'>
      do i = i_start, i_end<a name='3767'>
        g_fqy(i,k,jp1) = (-(0.5*g_rv(i,k-2,j)*fzp(k-1)*(w(i,k,j)+w(i,k,j-1))))+0.5*g_rv(i,k-1,j)*(2-fzm(k-1))*(w(i,k,j)+w(i,k,j-1))&amp;<a name='3768'>
&amp;+0.5*g_w(i,k,j-1)*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))+0.5*g_w(i,k,j)*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))<a name='3769'>
        fqy(i,k,jp1) = 0.5*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))*(w(i,k,j)+w(i,k,j-1))<a name='3770'>
      end do<a name='3771'>
    else if (j .eq. jde-2) then<a name='3772'>
      do k = kts+1, ktf<a name='3773'>
        do i = i_start, i_end<a name='3774'>
          g_vel = g_rv(i,k-1,j)*fzp(k)+g_rv(i,k,j)*fzm(k)<a name='3775'>
          vel = fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)<a name='3776'>
          g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2))+0.083333333*(w(i,k,j+1)-w(i,&amp;<a name='3777'>
&amp;k,j-2)-3.*(w(i,k,j)-w(i,k,j-1)))*sign(1.,vel))+g_w(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i,k,j-&amp;<a name='3778'>
&amp;1)*vel*(0.58333333+0.25*sign(1.,vel))+g_w(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*&amp;<a name='3779'>
&amp;(0.58333333+(-0.25)*sign(1.,vel))<a name='3780'>
          fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2))+sign(1.,vel)*(1./12.)*(w(i,k,j+1)-w(i,k,&amp;<a name='3781'>
&amp;j-2)-3.*(w(i,k,j)-w(i,k,j-1))))<a name='3782'>
        end do<a name='3783'>
      end do<a name='3784'>
      k = ktf+1<a name='3785'>
      do i = i_start, i_end<a name='3786'>
        g_vel = (-(g_rv(i,k-2,j)*fzp(k-1)))+g_rv(i,k-1,j)*(2-fzm(k-1))<a name='3787'>
        vel = (2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)<a name='3788'>
        g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2))+0.083333333*(w(i,k,j+1)-w(i,k,&amp;<a name='3789'>
&amp;j-2)-3.*(w(i,k,j)-w(i,k,j-1)))*sign(1.,vel))+g_w(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i,k,j-1)*&amp;<a name='3790'>
&amp;vel*(0.58333333+0.25*sign(1.,vel))+g_w(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+&amp;<a name='3791'>
&amp;(-0.25)*sign(1.,vel))<a name='3792'>
        fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2))+sign(1.,vel)*(1./12.)*(w(i,k,j+1)-w(i,k,j-&amp;<a name='3793'>
&amp;2)-3.*(w(i,k,j)-w(i,k,j-1))))<a name='3794'>
      end do<a name='3795'>
    endif<a name='3796'>
    if (j .gt. j_start) then<a name='3797'>
      do k = kts+1, ktf+1<a name='3798'>
        do i = i_start, i_end<a name='3799'>
          mrdy = msft(i,j-1)*rdy<a name='3800'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='3801'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='3802'>
        end do<a name='3803'>
      end do<a name='3804'>
    endif<a name='3805'>
    jtmp = jp1<a name='3806'>
    jp1 = jp0<a name='3807'>
    jp0 = jtmp<a name='3808'>
  end do j_loop_y_flux_5<a name='3809'>
  i_start = its<a name='3810'>
  i_end = min(ite,ide-1)<a name='3811'>
  j_start = jts<a name='3812'>
  j_end = min(jte,jde-1)<a name='3813'>
  i_start_f = i_start<a name='3814'>
  i_end_f = i_end+1<a name='3815'>
  if (degrade_xs) then<a name='3816'>
    i_start = max(ids+1,its)<a name='3817'>
    i_start_f = i_start+2<a name='3818'>
  endif<a name='3819'>
  if (degrade_xe) then<a name='3820'>
    i_end = min(ide-2,ite)<a name='3821'>
    i_end_f = ide-3<a name='3822'>
  endif<a name='3823'>
  do j = j_start, j_end<a name='3824'>
    do k = kts+1, ktf<a name='3825'>
      do i = i_start_f, i_end_f<a name='3826'>
        g_vel = g_ru(i,k-1,j)*fzp(k)+g_ru(i,k,j)*fzm(k)<a name='3827'>
        vel = fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)<a name='3828'>
        g_fqx(i,k) = g_vel*(0.61666667*(w(i,k,j)+w(i-1,k,j))-0.13333333*(w(i+1,k,j)+w(i-2,k,j))+0.016666667*(w(i+2,k,j)+w(i-3,k,j))&amp;<a name='3829'>
&amp;-0.016666667*(w(i+2,k,j)-w(i-3,k,j)-5.*(w(i+1,k,j)-w(i-2,k,j))+10.*(w(i,k,j)-w(i-1,k,j)))*sign(1.,vel))+g_w(i-3,k,j)*vel*&amp;<a name='3830'>
&amp;(0.016666667-(-0.016666667)*sign(1.,vel))+g_w(i-2,k,j)*vel*((-0.13333333)-0.083333333*sign(1.,vel))+g_w(i-1,k,j)*vel*&amp;<a name='3831'>
&amp;(0.61666667-(-0.16666667)*sign(1.,vel))+g_w(i+2,k,j)*vel*(0.016666667-0.016666667*sign(1.,vel))+g_w(i+1,k,j)*vel*((-&amp;<a name='3832'>
&amp;0.13333333)-(-0.083333333)*sign(1.,vel))+g_w(i,k,j)*vel*(0.61666667-0.16666667*sign(1.,vel))<a name='3833'>
        fqx(i,k) = vel*(37./60.*(w(i,k,j)+w(i-1,k,j))-2./15.*(w(i+1,k,j)+w(i-2,k,j))+1./60.*(w(i+2,k,j)+w(i-3,k,j))-sign(1.,vel)*&amp;<a name='3834'>
&amp;(1./60.)*(w(i+2,k,j)-w(i-3,k,j)-5.*(w(i+1,k,j)-w(i-2,k,j))+10.*(w(i,k,j)-w(i-1,k,j))))<a name='3835'>
      end do<a name='3836'>
    end do<a name='3837'>
    k = ktf+1<a name='3838'>
    do i = i_start_f, i_end_f<a name='3839'>
      g_vel = (-(g_ru(i,k-2,j)*fzp(k-1)))+g_ru(i,k-1,j)*(2-fzm(k-1))<a name='3840'>
      vel = (2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)<a name='3841'>
      g_fqx(i,k) = g_vel*(0.61666667*(w(i,k,j)+w(i-1,k,j))-0.13333333*(w(i+1,k,j)+w(i-2,k,j))+0.016666667*(w(i+2,k,j)+w(i-3,k,j))-&amp;<a name='3842'>
&amp;0.016666667*(w(i+2,k,j)-w(i-3,k,j)-5.*(w(i+1,k,j)-w(i-2,k,j))+10.*(w(i,k,j)-w(i-1,k,j)))*sign(1.,vel))+g_w(i-3,k,j)*vel*&amp;<a name='3843'>
&amp;(0.016666667-(-0.016666667)*sign(1.,vel))+g_w(i-2,k,j)*vel*((-0.13333333)-0.083333333*sign(1.,vel))+g_w(i-1,k,j)*vel*&amp;<a name='3844'>
&amp;(0.61666667-(-0.16666667)*sign(1.,vel))+g_w(i+2,k,j)*vel*(0.016666667-0.016666667*sign(1.,vel))+g_w(i+1,k,j)*vel*((-&amp;<a name='3845'>
&amp;0.13333333)-(-0.083333333)*sign(1.,vel))+g_w(i,k,j)*vel*(0.61666667-0.16666667*sign(1.,vel))<a name='3846'>
      fqx(i,k) = vel*(37./60.*(w(i,k,j)+w(i-1,k,j))-2./15.*(w(i+1,k,j)+w(i-2,k,j))+1./60.*(w(i+2,k,j)+w(i-3,k,j))-sign(1.,vel)*(1./&amp;<a name='3847'>
&amp;60.)*(w(i+2,k,j)-w(i-3,k,j)-5.*(w(i+1,k,j)-w(i-2,k,j))+10.*(w(i,k,j)-w(i-1,k,j))))<a name='3848'>
    end do<a name='3849'>
    if (degrade_xs) then<a name='3850'>
      if (i_start .eq. ids+1) then<a name='3851'>
        i = ids+1<a name='3852'>
        do k = kts+1, ktf<a name='3853'>
          g_fqx(i,k) = 0.5*g_ru(i,k-1,j)*fzp(k)*(w(i,k,j)+w(i-1,k,j))+0.5*g_ru(i,k,j)*fzm(k)*(w(i,k,j)+w(i-1,k,j))+0.5*g_w(i-1,k,j)&amp;<a name='3854'>
&amp;*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))+0.5*g_w(i,k,j)*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))<a name='3855'>
          fqx(i,k) = 0.5*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))*(w(i,k,j)+w(i-1,k,j))<a name='3856'>
        end do<a name='3857'>
        k = ktf+1<a name='3858'>
        g_fqx(i,k) = (-(0.5*g_ru(i,k-2,j)*fzp(k-1)*(w(i,k,j)+w(i-1,k,j))))+0.5*g_ru(i,k-1,j)*(2-fzm(k-1))*(w(i,k,j)+w(i-1,k,j))+&amp;<a name='3859'>
&amp;0.5*g_w(i-1,k,j)*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))+0.5*g_w(i,k,j)*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))<a name='3860'>
        fqx(i,k) = 0.5*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))*(w(i,k,j)+w(i-1,k,j))<a name='3861'>
      endif<a name='3862'>
      i = i_start+1<a name='3863'>
      do k = kts+1, ktf<a name='3864'>
        g_vel = g_ru(i,k-1,j)*fzp(k)+g_ru(i,k,j)*fzm(k)<a name='3865'>
        vel = fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)<a name='3866'>
        g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j))+0.083333333*(w(i+1,k,j)-w(i-2,k,j)&amp;<a name='3867'>
&amp;-3.*(w(i,k,j)-w(i-1,k,j)))*sign(1.,vel))+g_w(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i-1,k,j)*vel*&amp;<a name='3868'>
&amp;(0.58333333+0.25*sign(1.,vel))+g_w(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+(-&amp;<a name='3869'>
&amp;0.25)*sign(1.,vel))<a name='3870'>
        fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j))+sign(1.,vel)*(1./12.)*(w(i+1,k,j)-w(i-2,k,j)-&amp;<a name='3871'>
&amp;3.*(w(i,k,j)-w(i-1,k,j))))<a name='3872'>
      end do<a name='3873'>
      k = ktf+1<a name='3874'>
      g_vel = (-(g_ru(i,k-2,j)*fzp(k-1)))+g_ru(i,k-1,j)*(2-fzm(k-1))<a name='3875'>
      vel = (2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)<a name='3876'>
      g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j))+0.083333333*(w(i+1,k,j)-w(i-2,k,j)-&amp;<a name='3877'>
&amp;3.*(w(i,k,j)-w(i-1,k,j)))*sign(1.,vel))+g_w(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i-1,k,j)*vel*&amp;<a name='3878'>
&amp;(0.58333333+0.25*sign(1.,vel))+g_w(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+(-0.25)&amp;<a name='3879'>
&amp;*sign(1.,vel))<a name='3880'>
      fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j))+sign(1.,vel)*(1./12.)*(w(i+1,k,j)-w(i-2,k,j)-3.*&amp;<a name='3881'>
&amp;(w(i,k,j)-w(i-1,k,j))))<a name='3882'>
    endif<a name='3883'>
    if (degrade_xe) then<a name='3884'>
      if (i_end .eq. ide-2) then<a name='3885'>
        i = ide-1<a name='3886'>
        do k = kts+1, ktf<a name='3887'>
          g_fqx(i,k) = 0.5*g_ru(i,k-1,j)*fzp(k)*(w(i,k,j)+w(i-1,k,j))+0.5*g_ru(i,k,j)*fzm(k)*(w(i,k,j)+w(i-1,k,j))+0.5*g_w(i-1,k,j)&amp;<a name='3888'>
&amp;*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))+0.5*g_w(i,k,j)*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))<a name='3889'>
          fqx(i,k) = 0.5*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))*(w(i,k,j)+w(i-1,k,j))<a name='3890'>
        end do<a name='3891'>
        k = ktf+1<a name='3892'>
        g_fqx(i,k) = (-(0.5*g_ru(i,k-2,j)*fzp(k-1)*(w(i,k,j)+w(i-1,k,j))))+0.5*g_ru(i,k-1,j)*(2-fzm(k-1))*(w(i,k,j)+w(i-1,k,j))+&amp;<a name='3893'>
&amp;0.5*g_w(i-1,k,j)*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))+0.5*g_w(i,k,j)*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))<a name='3894'>
        fqx(i,k) = 0.5*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))*(w(i,k,j)+w(i-1,k,j))<a name='3895'>
      endif<a name='3896'>
      i = ide-2<a name='3897'>
      do k = kts+1, ktf<a name='3898'>
        g_vel = g_ru(i,k-1,j)*fzp(k)+g_ru(i,k,j)*fzm(k)<a name='3899'>
        vel = fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)<a name='3900'>
        g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j))+0.083333333*(w(i+1,k,j)-w(i-2,k,j)&amp;<a name='3901'>
&amp;-3.*(w(i,k,j)-w(i-1,k,j)))*sign(1.,vel))+g_w(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i-1,k,j)*vel*&amp;<a name='3902'>
&amp;(0.58333333+0.25*sign(1.,vel))+g_w(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+(-&amp;<a name='3903'>
&amp;0.25)*sign(1.,vel))<a name='3904'>
        fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j))+sign(1.,vel)*(1./12.)*(w(i+1,k,j)-w(i-2,k,j)-&amp;<a name='3905'>
&amp;3.*(w(i,k,j)-w(i-1,k,j))))<a name='3906'>
      end do<a name='3907'>
      k = ktf+1<a name='3908'>
      g_vel = (-(g_ru(i,k-2,j)*fzp(k-1)))+g_ru(i,k-1,j)*(2-fzm(k-1))<a name='3909'>
      vel = (2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)<a name='3910'>
      g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j))+0.083333333*(w(i+1,k,j)-w(i-2,k,j)-&amp;<a name='3911'>
&amp;3.*(w(i,k,j)-w(i-1,k,j)))*sign(1.,vel))+g_w(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i-1,k,j)*vel*&amp;<a name='3912'>
&amp;(0.58333333+0.25*sign(1.,vel))+g_w(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+(-0.25)&amp;<a name='3913'>
&amp;*sign(1.,vel))<a name='3914'>
      fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j))+sign(1.,vel)*(1./12.)*(w(i+1,k,j)-w(i-2,k,j)-3.*&amp;<a name='3915'>
&amp;(w(i,k,j)-w(i-1,k,j))))<a name='3916'>
    endif<a name='3917'>
    do k = kts+1, ktf+1<a name='3918'>
      do i = i_start, i_end<a name='3919'>
        mrdx = msft(i,j)*rdx<a name='3920'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='3921'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='3922'>
      end do<a name='3923'>
    end do<a name='3924'>
  end do<a name='3925'>
else if (horz_order .eq. 4) then horizontal_order_tesu<a name='3926'>
  degrade_xs =  .true. <a name='3927'>
  degrade_xe =  .true. <a name='3928'>
  degrade_ys =  .true. <a name='3929'>
  degrade_ye =  .true. <a name='3930'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+1) then<a name='3931'>
    degrade_xs =  .false. <a name='3932'>
  endif<a name='3933'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-2) then<a name='3934'>
    degrade_xe =  .false. <a name='3935'>
  endif<a name='3936'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+1) then<a name='3937'>
    degrade_ys =  .false. <a name='3938'>
  endif<a name='3939'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-2) then<a name='3940'>
    degrade_ye =  .false. <a name='3941'>
  endif<a name='3942'>
  ktf = min(kte,kde-1)<a name='3943'>
  i_start = its<a name='3944'>
  i_end = min(ite,ide-1)<a name='3945'>
  j_start = jts<a name='3946'>
  j_end = min(jte,jde-1)<a name='3947'>
  i_start_f = i_start<a name='3948'>
  i_end_f = i_end+1<a name='3949'>
  if (degrade_xs) then<a name='3950'>
    i_start = ids+1<a name='3951'>
    i_start_f = i_start+1<a name='3952'>
  endif<a name='3953'>
  if (degrade_xe) then<a name='3954'>
    i_end = ide-2<a name='3955'>
    i_end_f = ide-2<a name='3956'>
  endif<a name='3957'>
  do j = j_start, j_end<a name='3958'>
    do k = kts+1, ktf<a name='3959'>
      do i = i_start_f, i_end_f<a name='3960'>
        g_vel = g_ru(i,k-1,j)*fzp(k)+g_ru(i,k,j)*fzm(k)<a name='3961'>
        vel = fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)<a name='3962'>
        g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j)))-0.083333333*g_w(i-2,k,j)*vel+&amp;<a name='3963'>
&amp;0.58333333*g_w(i-1,k,j)*vel-0.083333333*g_w(i+1,k,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='3964'>
        fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j)))<a name='3965'>
      end do<a name='3966'>
    end do<a name='3967'>
    k = ktf+1<a name='3968'>
    do i = i_start_f, i_end_f<a name='3969'>
      g_vel = (-(g_ru(i,k-2,j)*fzp(k-1)))+g_ru(i,k-1,j)*(2-fzm(k-1))<a name='3970'>
      vel = (2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)<a name='3971'>
      g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j)))-0.083333333*g_w(i-2,k,j)*vel+&amp;<a name='3972'>
&amp;0.58333333*g_w(i-1,k,j)*vel-0.083333333*g_w(i+1,k,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='3973'>
      fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j)))<a name='3974'>
    end do<a name='3975'>
    if (degrade_xs) then<a name='3976'>
      do k = kts+1, ktf<a name='3977'>
        g_fqx(i_start,k) = 0.5*g_ru(i_start,k-1,j)*fzp(k)*(w(i_start,k,j)+w(i_start-1,k,j))+0.5*g_ru(i_start,k,j)*fzm(k)*&amp;<a name='3978'>
&amp;(w(i_start,k,j)+w(i_start-1,k,j))+0.5*g_w(i_start-1,k,j)*(fzm(k)*ru(i_start,k,j)+fzp(k)*ru(i_start,k-1,j))+0.5*&amp;<a name='3979'>
&amp;g_w(i_start,k,j)*(fzm(k)*ru(i_start,k,j)+fzp(k)*ru(i_start,k-1,j))<a name='3980'>
        fqx(i_start,k) = 0.5*(fzm(k)*ru(i_start,k,j)+fzp(k)*ru(i_start,k-1,j))*(w(i_start,k,j)+w(i_start-1,k,j))<a name='3981'>
      end do<a name='3982'>
      k = ktf+1<a name='3983'>
      g_fqx(i_start,k) = (-(0.5*g_ru(i_start,k-2,j)*fzp(k-1)*(w(i_start,k,j)+w(i_start-1,k,j))))+0.5*g_ru(i_start,k-1,j)*(2-fzm(k-&amp;<a name='3984'>
&amp;1))*(w(i_start,k,j)+w(i_start-1,k,j))+0.5*g_w(i_start-1,k,j)*((2.-fzm(k-1))*ru(i_start,k-1,j)-fzp(k-1)*ru(i_start,k-2,j))+&amp;<a name='3985'>
&amp;0.5*g_w(i_start,k,j)*((2.-fzm(k-1))*ru(i_start,k-1,j)-fzp(k-1)*ru(i_start,k-2,j))<a name='3986'>
      fqx(i_start,k) = 0.5*((2.-fzm(k-1))*ru(i_start,k-1,j)-fzp(k-1)*ru(i_start,k-2,j))*(w(i_start,k,j)+w(i_start-1,k,j))<a name='3987'>
    endif<a name='3988'>
    if (degrade_xe) then<a name='3989'>
      do k = kts+1, ktf<a name='3990'>
        g_fqx(i_end+1,k) = 0.5*g_ru(i_end+1,k-1,j)*fzp(k)*(w(i_end+1,k,j)+w(i_end,k,j))+0.5*g_ru(i_end+1,k,j)*fzm(k)*(w(i_end+1,k,&amp;<a name='3991'>
&amp;j)+w(i_end,k,j))+0.5*g_w(i_end+1,k,j)*(fzm(k)*ru(i_end+1,k,j)+fzp(k)*ru(i_end+1,k-1,j))+0.5*g_w(i_end,k,j)*(fzm(k)*&amp;<a name='3992'>
&amp;ru(i_end+1,k,j)+fzp(k)*ru(i_end+1,k-1,j))<a name='3993'>
        fqx(i_end+1,k) = 0.5*(fzm(k)*ru(i_end+1,k,j)+fzp(k)*ru(i_end+1,k-1,j))*(w(i_end+1,k,j)+w(i_end,k,j))<a name='3994'>
      end do<a name='3995'>
      k = ktf+1<a name='3996'>
      g_fqx(i_end+1,k) = (-(0.5*g_ru(i_end+1,k-2,j)*fzp(k-1)*(w(i_end+1,k,j)+w(i_end,k,j))))+0.5*g_ru(i_end+1,k-1,j)*(2-fzm(k-1))*&amp;<a name='3997'>
&amp;(w(i_end+1,k,j)+w(i_end,k,j))+0.5*g_w(i_end+1,k,j)*((2.-fzm(k-1))*ru(i_end+1,k-1,j)-fzp(k-1)*ru(i_end+1,k-2,j))+0.5*&amp;<a name='3998'>
&amp;g_w(i_end,k,j)*((2.-fzm(k-1))*ru(i_end+1,k-1,j)-fzp(k-1)*ru(i_end+1,k-2,j))<a name='3999'>
      fqx(i_end+1,k) = 0.5*((2.-fzm(k-1))*ru(i_end+1,k-1,j)-fzp(k-1)*ru(i_end+1,k-2,j))*(w(i_end+1,k,j)+w(i_end,k,j))<a name='4000'>
    endif<a name='4001'>
    do k = kts+1, ktf+1<a name='4002'>
      do i = i_start, i_end<a name='4003'>
        mrdx = msft(i,j)*rdx<a name='4004'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='4005'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='4006'>
      end do<a name='4007'>
    end do<a name='4008'>
  end do<a name='4009'>
  i_start = its<a name='4010'>
  i_end = min(ite,ide-1)<a name='4011'>
  j_start = jts<a name='4012'>
  j_end = min(jte,jde-1)<a name='4013'>
  j_start_f = j_start<a name='4014'>
  j_end_f = j_end+1<a name='4015'>
  if (degrade_ys) then<a name='4016'>
    j_start = jds+1<a name='4017'>
    j_start_f = j_start+1<a name='4018'>
  endif<a name='4019'>
  if (degrade_ye) then<a name='4020'>
    j_end = jde-2<a name='4021'>
    j_end_f = jde-2<a name='4022'>
  endif<a name='4023'>
  jp1 = 2<a name='4024'>
  jp0 = 1<a name='4025'>
  do j = j_start, j_end+1<a name='4026'>
    if (j .lt. j_start_f .and. degrade_ys) then<a name='4027'>
      do k = kts+1, ktf<a name='4028'>
        do i = i_start, i_end<a name='4029'>
          g_fqy(i,k,jp1) = 0.5*g_rv(i,k-1,j_start)*fzp(k)*(w(i,k,j_start)+w(i,k,j_start-1))+0.5*g_rv(i,k,j_start)*fzm(k)*(w(i,k,&amp;<a name='4030'>
&amp;j_start)+w(i,k,j_start-1))+0.5*g_w(i,k,j_start-1)*(fzm(k)*rv(i,k,j_start)+fzp(k)*rv(i,k-1,j_start))+0.5*g_w(i,k,j_start)&amp;<a name='4031'>
&amp;*(fzm(k)*rv(i,k,j_start)+fzp(k)*rv(i,k-1,j_start))<a name='4032'>
          fqy(i,k,jp1) = 0.5*(fzm(k)*rv(i,k,j_start)+fzp(k)*rv(i,k-1,j_start))*(w(i,k,j_start)+w(i,k,j_start-1))<a name='4033'>
        end do<a name='4034'>
      end do<a name='4035'>
      k = ktf+1<a name='4036'>
      do i = i_start, i_end<a name='4037'>
        g_fqy(i,k,jp1) = (-(0.5*g_rv(i,k-2,j_start)*fzp(k-1)*(w(i,k,j_start)+w(i,k,j_start-1))))+0.5*g_rv(i,k-1,j_start)*(2-fzm(k-&amp;<a name='4038'>
&amp;1))*(w(i,k,j_start)+w(i,k,j_start-1))+0.5*g_w(i,k,j_start-1)*((2.-fzm(k-1))*rv(i,k-1,j_start)-fzp(k-1)*rv(i,k-2,j_start))+&amp;<a name='4039'>
&amp;0.5*g_w(i,k,j_start)*((2.-fzm(k-1))*rv(i,k-1,j_start)-fzp(k-1)*rv(i,k-2,j_start))<a name='4040'>
        fqy(i,k,jp1) = 0.5*((2.-fzm(k-1))*rv(i,k-1,j_start)-fzp(k-1)*rv(i,k-2,j_start))*(w(i,k,j_start)+w(i,k,j_start-1))<a name='4041'>
      end do<a name='4042'>
    else if (j .gt. j_end_f .and. degrade_ye) then<a name='4043'>
      do k = kts+1, ktf<a name='4044'>
        do i = i_start, i_end<a name='4045'>
          g_fqy(i,k,jp1) = 0.5*g_rv(i,k-1,j_end+1)*fzp(k)*(w(i,k,j_end+1)+w(i,k,j_end))+0.5*g_rv(i,k,j_end+1)*fzm(k)*(w(i,k,j_end+&amp;<a name='4046'>
&amp;1)+w(i,k,j_end))+0.5*g_w(i,k,j_end+1)*(fzm(k)*rv(i,k,j_end+1)+fzp(k)*rv(i,k-1,j_end+1))+0.5*g_w(i,k,j_end)*(fzm(k)*rv(i,&amp;<a name='4047'>
&amp;k,j_end+1)+fzp(k)*rv(i,k-1,j_end+1))<a name='4048'>
          fqy(i,k,jp1) = 0.5*(fzm(k)*rv(i,k,j_end+1)+fzp(k)*rv(i,k-1,j_end+1))*(w(i,k,j_end+1)+w(i,k,j_end))<a name='4049'>
        end do<a name='4050'>
      end do<a name='4051'>
      k = ktf+1<a name='4052'>
      do i = i_start, i_end<a name='4053'>
        g_fqy(i,k,jp1) = (-(0.5*g_rv(i,k-2,j_end+1)*fzp(k-1)*(w(i,k,j_end+1)+w(i,k,j_end))))+0.5*g_rv(i,k-1,j_end+1)*(2-fzm(k-1))*&amp;<a name='4054'>
&amp;(w(i,k,j_end+1)+w(i,k,j_end))+0.5*g_w(i,k,j_end+1)*((2.-fzm(k-1))*rv(i,k-1,j_end+1)-fzp(k-1)*rv(i,k-2,j_end+1))+0.5*g_w(i,&amp;<a name='4055'>
&amp;k,j_end)*((2.-fzm(k-1))*rv(i,k-1,j_end+1)-fzp(k-1)*rv(i,k-2,j_end+1))<a name='4056'>
        fqy(i,k,jp1) = 0.5*((2.-fzm(k-1))*rv(i,k-1,j_end+1)-fzp(k-1)*rv(i,k-2,j_end+1))*(w(i,k,j_end+1)+w(i,k,j_end))<a name='4057'>
      end do<a name='4058'>
    else<a name='4059'>
      do k = kts+1, ktf<a name='4060'>
        do i = i_start, i_end<a name='4061'>
          g_vel = g_rv(i,k-1,j)*fzp(k)+g_rv(i,k,j)*fzm(k)<a name='4062'>
          vel = fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)<a name='4063'>
          g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2)))-0.083333333*g_w(i,k,j-2)*&amp;<a name='4064'>
&amp;vel+0.58333333*g_w(i,k,j-1)*vel-0.083333333*g_w(i,k,j+1)*vel+0.58333333*g_w(i,k,j)*vel<a name='4065'>
          fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2)))<a name='4066'>
        end do<a name='4067'>
      end do<a name='4068'>
      k = ktf+1<a name='4069'>
      do i = i_start, i_end<a name='4070'>
        g_vel = (-(g_rv(i,k-2,j)*fzp(k-1)))+g_rv(i,k-1,j)*(2-fzm(k-1))<a name='4071'>
        vel = (2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)<a name='4072'>
        g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2)))-0.083333333*g_w(i,k,j-2)*vel+&amp;<a name='4073'>
&amp;0.58333333*g_w(i,k,j-1)*vel-0.083333333*g_w(i,k,j+1)*vel+0.58333333*g_w(i,k,j)*vel<a name='4074'>
        fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2)))<a name='4075'>
      end do<a name='4076'>
    endif<a name='4077'>
    if (j .gt. j_start) then<a name='4078'>
      do k = kts+1, ktf+1<a name='4079'>
        do i = i_start, i_end<a name='4080'>
          mrdy = msft(i,j-1)*rdy<a name='4081'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='4082'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='4083'>
        end do<a name='4084'>
      end do<a name='4085'>
    endif<a name='4086'>
    jtmp = jp1<a name='4087'>
    jp1 = jp0<a name='4088'>
    jp0 = jtmp<a name='4089'>
  end do<a name='4090'>
else if (horz_order .eq. 3) then horizontal_order_tesu<a name='4091'>
  degrade_xs =  .true. <a name='4092'>
  degrade_xe =  .true. <a name='4093'>
  degrade_ys =  .true. <a name='4094'>
  degrade_ye =  .true. <a name='4095'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xs .or. its .gt. ids+1) then<a name='4096'>
    degrade_xs =  .false. <a name='4097'>
  endif<a name='4098'>
  if (config_flags%periodic_x .or. config_flags%symmetric_xe .or. ite .lt. ide-2) then<a name='4099'>
    degrade_xe =  .false. <a name='4100'>
  endif<a name='4101'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ys .or. jts .gt. jds+1) then<a name='4102'>
    degrade_ys =  .false. <a name='4103'>
  endif<a name='4104'>
  if (config_flags%periodic_y .or. config_flags%symmetric_ye .or. jte .lt. jde-2) then<a name='4105'>
    degrade_ye =  .false. <a name='4106'>
  endif<a name='4107'>
  ktf = min(kte,kde-1)<a name='4108'>
  i_start = its<a name='4109'>
  i_end = min(ite,ide-1)<a name='4110'>
  j_start = jts<a name='4111'>
  j_end = min(jte,jde-1)<a name='4112'>
  i_start_f = i_start<a name='4113'>
  i_end_f = i_end+1<a name='4114'>
  if (degrade_xs) then<a name='4115'>
    i_start = ids+1<a name='4116'>
    i_start_f = i_start+1<a name='4117'>
  endif<a name='4118'>
  if (degrade_xe) then<a name='4119'>
    i_end = ide-2<a name='4120'>
    i_end_f = ide-2<a name='4121'>
  endif<a name='4122'>
  do j = j_start, j_end<a name='4123'>
    do k = kts+1, ktf<a name='4124'>
      do i = i_start_f, i_end_f<a name='4125'>
        g_vel = g_ru(i,k-1,j)*fzp(k)+g_ru(i,k,j)*fzm(k)<a name='4126'>
        vel = fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)<a name='4127'>
        g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j))+0.083333333*(w(i+1,k,j)-w(i-2,k,j)&amp;<a name='4128'>
&amp;-3.*(w(i,k,j)-w(i-1,k,j)))*sign(1.,vel))+g_w(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i-1,k,j)*vel*&amp;<a name='4129'>
&amp;(0.58333333+0.25*sign(1.,vel))+g_w(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+(-&amp;<a name='4130'>
&amp;0.25)*sign(1.,vel))<a name='4131'>
        fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j))+sign(1.,vel)*(1./12.)*(w(i+1,k,j)-w(i-2,k,j)-&amp;<a name='4132'>
&amp;3.*(w(i,k,j)-w(i-1,k,j))))<a name='4133'>
      end do<a name='4134'>
    end do<a name='4135'>
    k = ktf+1<a name='4136'>
    do i = i_start_f, i_end_f<a name='4137'>
      g_vel = (-(g_ru(i,k-2,j)*fzp(k-1)))+g_ru(i,k-1,j)*(2-fzm(k-1))<a name='4138'>
      vel = (2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)<a name='4139'>
      g_fqx(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i-1,k,j))-0.083333333*(w(i+1,k,j)+w(i-2,k,j))+0.083333333*(w(i+1,k,j)-w(i-2,k,j)-&amp;<a name='4140'>
&amp;3.*(w(i,k,j)-w(i-1,k,j)))*sign(1.,vel))+g_w(i-2,k,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i-1,k,j)*vel*&amp;<a name='4141'>
&amp;(0.58333333+0.25*sign(1.,vel))+g_w(i+1,k,j)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+(-0.25)&amp;<a name='4142'>
&amp;*sign(1.,vel))<a name='4143'>
      fqx(i,k) = vel*(7./12.*(w(i,k,j)+w(i-1,k,j))-1./12.*(w(i+1,k,j)+w(i-2,k,j))+sign(1.,vel)*(1./12.)*(w(i+1,k,j)-w(i-2,k,j)-3.*&amp;<a name='4144'>
&amp;(w(i,k,j)-w(i-1,k,j))))<a name='4145'>
    end do<a name='4146'>
    if (degrade_xs) then<a name='4147'>
      do k = kts+1, ktf<a name='4148'>
        g_fqx(i_start,k) = 0.5*g_ru(i_start,k-1,j)*fzp(k)*(w(i_start,k,j)+w(i_start-1,k,j))+0.5*g_ru(i_start,k,j)*fzm(k)*&amp;<a name='4149'>
&amp;(w(i_start,k,j)+w(i_start-1,k,j))+0.5*g_w(i_start-1,k,j)*(fzm(k)*ru(i_start,k,j)+fzp(k)*ru(i_start,k-1,j))+0.5*&amp;<a name='4150'>
&amp;g_w(i_start,k,j)*(fzm(k)*ru(i_start,k,j)+fzp(k)*ru(i_start,k-1,j))<a name='4151'>
        fqx(i_start,k) = 0.5*(fzm(k)*ru(i_start,k,j)+fzp(k)*ru(i_start,k-1,j))*(w(i_start,k,j)+w(i_start-1,k,j))<a name='4152'>
      end do<a name='4153'>
      k = ktf+1<a name='4154'>
      g_fqx(i_start,k) = (-(0.5*g_ru(i_start,k-2,j)*fzp(k-1)*(w(i_start,k,j)+w(i_start-1,k,j))))+0.5*g_ru(i_start,k-1,j)*(2-fzm(k-&amp;<a name='4155'>
&amp;1))*(w(i_start,k,j)+w(i_start-1,k,j))+0.5*g_w(i_start-1,k,j)*((2.-fzm(k-1))*ru(i_start,k-1,j)-fzp(k-1)*ru(i_start,k-2,j))+&amp;<a name='4156'>
&amp;0.5*g_w(i_start,k,j)*((2.-fzm(k-1))*ru(i_start,k-1,j)-fzp(k-1)*ru(i_start,k-2,j))<a name='4157'>
      fqx(i_start,k) = 0.5*((2.-fzm(k-1))*ru(i_start,k-1,j)-fzp(k-1)*ru(i_start,k-2,j))*(w(i_start,k,j)+w(i_start-1,k,j))<a name='4158'>
    endif<a name='4159'>
    if (degrade_xe) then<a name='4160'>
      do k = kts+1, ktf<a name='4161'>
        g_fqx(i_end+1,k) = 0.5*g_ru(i_end+1,k-1,j)*fzp(k)*(w(i_end+1,k,j)+w(i_end,k,j))+0.5*g_ru(i_end+1,k,j)*fzm(k)*(w(i_end+1,k,&amp;<a name='4162'>
&amp;j)+w(i_end,k,j))+0.5*g_w(i_end+1,k,j)*(fzm(k)*ru(i_end+1,k,j)+fzp(k)*ru(i_end+1,k-1,j))+0.5*g_w(i_end,k,j)*(fzm(k)*&amp;<a name='4163'>
&amp;ru(i_end+1,k,j)+fzp(k)*ru(i_end+1,k-1,j))<a name='4164'>
        fqx(i_end+1,k) = 0.5*(fzm(k)*ru(i_end+1,k,j)+fzp(k)*ru(i_end+1,k-1,j))*(w(i_end+1,k,j)+w(i_end,k,j))<a name='4165'>
      end do<a name='4166'>
      k = ktf+1<a name='4167'>
      g_fqx(i_end+1,k) = (-(0.5*g_ru(i_end+1,k-2,j)*fzp(k-1)*(w(i_end+1,k,j)+w(i_end,k,j))))+0.5*g_ru(i_end+1,k-1,j)*(2-fzm(k-1))*&amp;<a name='4168'>
&amp;(w(i_end+1,k,j)+w(i_end,k,j))+0.5*g_w(i_end+1,k,j)*((2.-fzm(k-1))*ru(i_end+1,k-1,j)-fzp(k-1)*ru(i_end+1,k-2,j))+0.5*&amp;<a name='4169'>
&amp;g_w(i_end,k,j)*((2.-fzm(k-1))*ru(i_end+1,k-1,j)-fzp(k-1)*ru(i_end+1,k-2,j))<a name='4170'>
      fqx(i_end+1,k) = 0.5*((2.-fzm(k-1))*ru(i_end+1,k-1,j)-fzp(k-1)*ru(i_end+1,k-2,j))*(w(i_end+1,k,j)+w(i_end,k,j))<a name='4171'>
    endif<a name='4172'>
    do k = kts+1, ktf+1<a name='4173'>
      do i = i_start, i_end<a name='4174'>
        mrdx = msft(i,j)*rdx<a name='4175'>
        g_tendency(i,k,j) = (-(g_fqx(i+1,k)*mrdx))+g_fqx(i,k)*mrdx+g_tendency(i,k,j)<a name='4176'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*(fqx(i+1,k)-fqx(i,k))<a name='4177'>
      end do<a name='4178'>
    end do<a name='4179'>
  end do<a name='4180'>
  i_start = its<a name='4181'>
  i_end = min(ite,ide-1)<a name='4182'>
  j_start = jts<a name='4183'>
  j_end = min(jte,jde-1)<a name='4184'>
  j_start_f = j_start<a name='4185'>
  j_end_f = j_end+1<a name='4186'>
  if (degrade_ys) then<a name='4187'>
    j_start = jds+1<a name='4188'>
    j_start_f = j_start+1<a name='4189'>
  endif<a name='4190'>
  if (degrade_ye) then<a name='4191'>
    j_end = jde-2<a name='4192'>
    j_end_f = jde-2<a name='4193'>
  endif<a name='4194'>
  jp1 = 2<a name='4195'>
  jp0 = 1<a name='4196'>
  do j = j_start, j_end+1<a name='4197'>
    if (j .lt. j_start_f .and. degrade_ys) then<a name='4198'>
      do k = kts+1, ktf<a name='4199'>
        do i = i_start, i_end<a name='4200'>
          g_fqy(i,k,jp1) = 0.5*g_rv(i,k-1,j_start)*fzp(k)*(w(i,k,j_start)+w(i,k,j_start-1))+0.5*g_rv(i,k,j_start)*fzm(k)*(w(i,k,&amp;<a name='4201'>
&amp;j_start)+w(i,k,j_start-1))+0.5*g_w(i,k,j_start-1)*(fzm(k)*rv(i,k,j_start)+fzp(k)*rv(i,k-1,j_start))+0.5*g_w(i,k,j_start)&amp;<a name='4202'>
&amp;*(fzm(k)*rv(i,k,j_start)+fzp(k)*rv(i,k-1,j_start))<a name='4203'>
          fqy(i,k,jp1) = 0.5*(fzm(k)*rv(i,k,j_start)+fzp(k)*rv(i,k-1,j_start))*(w(i,k,j_start)+w(i,k,j_start-1))<a name='4204'>
        end do<a name='4205'>
      end do<a name='4206'>
      k = ktf+1<a name='4207'>
      do i = i_start, i_end<a name='4208'>
        g_fqy(i,k,jp1) = (-(0.5*g_rv(i,k-2,j_start)*fzp(k-1)*(w(i,k,j_start)+w(i,k,j_start-1))))+0.5*g_rv(i,k-1,j_start)*(2-fzm(k-&amp;<a name='4209'>
&amp;1))*(w(i,k,j_start)+w(i,k,j_start-1))+0.5*g_w(i,k,j_start-1)*((2.-fzm(k-1))*rv(i,k-1,j_start)-fzp(k-1)*rv(i,k-2,j_start))+&amp;<a name='4210'>
&amp;0.5*g_w(i,k,j_start)*((2.-fzm(k-1))*rv(i,k-1,j_start)-fzp(k-1)*rv(i,k-2,j_start))<a name='4211'>
        fqy(i,k,jp1) = 0.5*((2.-fzm(k-1))*rv(i,k-1,j_start)-fzp(k-1)*rv(i,k-2,j_start))*(w(i,k,j_start)+w(i,k,j_start-1))<a name='4212'>
      end do<a name='4213'>
    else if (j .gt. j_end_f .and. degrade_ye) then<a name='4214'>
      do k = kts+1, ktf<a name='4215'>
        do i = i_start, i_end<a name='4216'>
          g_fqy(i,k,jp1) = 0.5*g_rv(i,k-1,j_end+1)*fzp(k)*(w(i,k,j_end+1)+w(i,k,j_end))+0.5*g_rv(i,k,j_end+1)*fzm(k)*(w(i,k,j_end+&amp;<a name='4217'>
&amp;1)+w(i,k,j_end))+0.5*g_w(i,k,j_end+1)*(fzm(k)*rv(i,k,j_end+1)+fzp(k)*rv(i,k-1,j_end+1))+0.5*g_w(i,k,j_end)*(fzm(k)*rv(i,&amp;<a name='4218'>
&amp;k,j_end+1)+fzp(k)*rv(i,k-1,j_end+1))<a name='4219'>
          fqy(i,k,jp1) = 0.5*(fzm(k)*rv(i,k,j_end+1)+fzp(k)*rv(i,k-1,j_end+1))*(w(i,k,j_end+1)+w(i,k,j_end))<a name='4220'>
        end do<a name='4221'>
      end do<a name='4222'>
      k = ktf+1<a name='4223'>
      do i = i_start, i_end<a name='4224'>
        g_fqy(i,k,jp1) = (-(0.5*g_rv(i,k-2,j_end+1)*fzp(k-1)*(w(i,k,j_end+1)+w(i,k,j_end))))+0.5*g_rv(i,k-1,j_end+1)*(2-fzm(k-1))*&amp;<a name='4225'>
&amp;(w(i,k,j_end+1)+w(i,k,j_end))+0.5*g_w(i,k,j_end+1)*((2.-fzm(k-1))*rv(i,k-1,j_end+1)-fzp(k-1)*rv(i,k-2,j_end+1))+0.5*g_w(i,&amp;<a name='4226'>
&amp;k,j_end)*((2.-fzm(k-1))*rv(i,k-1,j_end+1)-fzp(k-1)*rv(i,k-2,j_end+1))<a name='4227'>
        fqy(i,k,jp1) = 0.5*((2.-fzm(k-1))*rv(i,k-1,j_end+1)-fzp(k-1)*rv(i,k-2,j_end+1))*(w(i,k,j_end+1)+w(i,k,j_end))<a name='4228'>
      end do<a name='4229'>
    else<a name='4230'>
      do k = kts+1, ktf<a name='4231'>
        do i = i_start, i_end<a name='4232'>
          g_vel = g_rv(i,k-1,j)*fzp(k)+g_rv(i,k,j)*fzm(k)<a name='4233'>
          vel = fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)<a name='4234'>
          g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2))+0.083333333*(w(i,k,j+1)-w(i,&amp;<a name='4235'>
&amp;k,j-2)-3.*(w(i,k,j)-w(i,k,j-1)))*sign(1.,vel))+g_w(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i,k,j-&amp;<a name='4236'>
&amp;1)*vel*(0.58333333+0.25*sign(1.,vel))+g_w(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*&amp;<a name='4237'>
&amp;(0.58333333+(-0.25)*sign(1.,vel))<a name='4238'>
          fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2))+sign(1.,vel)*(1./12.)*(w(i,k,j+1)-w(i,k,&amp;<a name='4239'>
&amp;j-2)-3.*(w(i,k,j)-w(i,k,j-1))))<a name='4240'>
        end do<a name='4241'>
      end do<a name='4242'>
      k = ktf+1<a name='4243'>
      do i = i_start, i_end<a name='4244'>
        g_vel = (-(g_rv(i,k-2,j)*fzp(k-1)))+g_rv(i,k-1,j)*(2-fzm(k-1))<a name='4245'>
        vel = (2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)<a name='4246'>
        g_fqy(i,k,jp1) = g_vel*(0.58333333*(w(i,k,j)+w(i,k,j-1))-0.083333333*(w(i,k,j+1)+w(i,k,j-2))+0.083333333*(w(i,k,j+1)-w(i,k,&amp;<a name='4247'>
&amp;j-2)-3.*(w(i,k,j)-w(i,k,j-1)))*sign(1.,vel))+g_w(i,k,j-2)*vel*((-0.083333333)+(-0.083333333)*sign(1.,vel))+g_w(i,k,j-1)*&amp;<a name='4248'>
&amp;vel*(0.58333333+0.25*sign(1.,vel))+g_w(i,k,j+1)*vel*((-0.083333333)+0.083333333*sign(1.,vel))+g_w(i,k,j)*vel*(0.58333333+&amp;<a name='4249'>
&amp;(-0.25)*sign(1.,vel))<a name='4250'>
        fqy(i,k,jp1) = vel*(7./12.*(w(i,k,j)+w(i,k,j-1))-1./12.*(w(i,k,j+1)+w(i,k,j-2))+sign(1.,vel)*(1./12.)*(w(i,k,j+1)-w(i,k,j-&amp;<a name='4251'>
&amp;2)-3.*(w(i,k,j)-w(i,k,j-1))))<a name='4252'>
      end do<a name='4253'>
    endif<a name='4254'>
    if (j .gt. j_start) then<a name='4255'>
      do k = kts+1, ktf+1<a name='4256'>
        do i = i_start, i_end<a name='4257'>
          mrdy = msft(i,j-1)*rdy<a name='4258'>
          g_tendency(i,k,j-1) = g_fqy(i,k,jp0)*mrdy-g_fqy(i,k,jp1)*mrdy+g_tendency(i,k,j-1)<a name='4259'>
          tendency(i,k,j-1) = tendency(i,k,j-1)-mrdy*(fqy(i,k,jp1)-fqy(i,k,jp0))<a name='4260'>
        end do<a name='4261'>
      end do<a name='4262'>
    endif<a name='4263'>
    jtmp = jp1<a name='4264'>
    jp1 = jp0<a name='4265'>
    jp0 = jtmp<a name='4266'>
  end do<a name='4267'>
else if (horz_order .eq. 2) then horizontal_order_tesu<a name='4268'>
  i_start = its<a name='4269'>
  i_end = min(ite,ide-1)<a name='4270'>
  j_start = jts<a name='4271'>
  j_end = min(jte,jde-1)<a name='4272'>
  if (config_flags%open_xs .or. specified) then<a name='4273'>
    i_start = max(ids+1,its)<a name='4274'>
  endif<a name='4275'>
  if (config_flags%open_xe .or. specified) then<a name='4276'>
    i_end = min(ide-2,ite)<a name='4277'>
  endif<a name='4278'>
  do j = j_start, j_end<a name='4279'>
    do k = kts+1, ktf<a name='4280'>
      do i = i_start, i_end<a name='4281'>
        mrdx = msft(i,j)*rdx<a name='4282'>
        g_tendency(i,k,j) = (-(0.5*g_ru(i+1,k-1,j)*mrdx*fzp(k)*(w(i+1,k,j)+w(i,k,j))))+0.5*g_ru(i,k-1,j)*mrdx*fzp(k)*(w(i,k,j)+w(i-&amp;<a name='4283'>
&amp;1,k,j))-0.5*g_ru(i+1,k,j)*mrdx*fzm(k)*(w(i+1,k,j)+w(i,k,j))+0.5*g_ru(i,k,j)*mrdx*fzm(k)*(w(i,k,j)+w(i-1,k,j))+&amp;<a name='4284'>
&amp;g_tendency(i,k,j)+0.5*g_w(i-1,k,j)*mrdx*(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j))-0.5*g_w(i+1,k,j)*mrdx*(fzm(k)*ru(i+1,k,j)+&amp;<a name='4285'>
&amp;fzp(k)*ru(i+1,k-1,j))-0.5*g_w(i,k,j)*mrdx*(fzm(k)*ru(i+1,k,j)+fzp(k)*ru(i+1,k-1,j)-(fzm(k)*ru(i,k,j)+fzp(k)*ru(i,k-1,j)))<a name='4286'>
        tendency(i,k,j) = tendency(i,k,j)-mrdx*0.5*((fzm(k)*ru(i+1,k,j)+fzp(k)*ru(i+1,k-1,j))*(w(i+1,k,j)+w(i,k,j))-(fzm(k)*ru(i,k,&amp;<a name='4287'>
&amp;j)+fzp(k)*ru(i,k-1,j))*(w(i,k,j)+w(i-1,k,j)))<a name='4288'>
      end do<a name='4289'>
    end do<a name='4290'>
    k = ktf+1<a name='4291'>
    do i = i_start, i_end<a name='4292'>
      mrdx = msft(i,j)*rdx<a name='4293'>
      g_tendency(i,k,j) = 0.5*g_ru(i+1,k-2,j)*mrdx*fzp(k-1)*(w(i+1,k,j)+w(i,k,j))-0.5*g_ru(i,k-2,j)*mrdx*fzp(k-1)*(w(i,k,j)+w(i-1,&amp;<a name='4294'>
&amp;k,j))-0.5*g_ru(i+1,k-1,j)*mrdx*(2-fzm(k-1))*(w(i+1,k,j)+w(i,k,j))+0.5*g_ru(i,k-1,j)*mrdx*(2-fzm(k-1))*(w(i,k,j)+w(i-1,k,j))+&amp;<a name='4295'>
&amp;g_tendency(i,k,j)+0.5*g_w(i-1,k,j)*mrdx*((2.-fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))-0.5*g_w(i+1,k,j)*mrdx*((2.-fzm(k-1)&amp;<a name='4296'>
&amp;)*ru(i+1,k-1,j)-fzp(k-1)*ru(i+1,k-2,j))-0.5*g_w(i,k,j)*mrdx*((2.-fzm(k-1))*ru(i+1,k-1,j)-fzp(k-1)*ru(i+1,k-2,j)-((2.-fzm(k-&amp;<a name='4297'>
&amp;1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j)))<a name='4298'>
      tendency(i,k,j) = tendency(i,k,j)-mrdx*0.5*(((2.-fzm(k-1))*ru(i+1,k-1,j)-fzp(k-1)*ru(i+1,k-2,j))*(w(i+1,k,j)+w(i,k,j))-((2.-&amp;<a name='4299'>
&amp;fzm(k-1))*ru(i,k-1,j)-fzp(k-1)*ru(i,k-2,j))*(w(i,k,j)+w(i-1,k,j)))<a name='4300'>
    end do<a name='4301'>
  end do<a name='4302'>
  i_start = its<a name='4303'>
  i_end = min(ite,ide-1)<a name='4304'>
  if (config_flags%open_ys .or. specified) then<a name='4305'>
    j_start = max(jds+1,jts)<a name='4306'>
  endif<a name='4307'>
  if (config_flags%open_ye .or. specified) then<a name='4308'>
    j_end = min(jde-2,jte)<a name='4309'>
  endif<a name='4310'>
  do j = j_start, j_end<a name='4311'>
    do k = kts+1, ktf<a name='4312'>
      do i = i_start, i_end<a name='4313'>
        mrdy = msft(i,j)*rdy<a name='4314'>
        g_tendency(i,k,j) = (-(0.5*g_rv(i,k-1,j+1)*mrdy*fzp(k)*(w(i,k,j+1)+w(i,k,j))))+0.5*g_rv(i,k-1,j)*mrdy*fzp(k)*(w(i,k,j)+w(i,&amp;<a name='4315'>
&amp;k,j-1))-0.5*g_rv(i,k,j+1)*mrdy*fzm(k)*(w(i,k,j+1)+w(i,k,j))+0.5*g_rv(i,k,j)*mrdy*fzm(k)*(w(i,k,j)+w(i,k,j-1))+&amp;<a name='4316'>
&amp;g_tendency(i,k,j)+0.5*g_w(i,k,j-1)*mrdy*(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j))-0.5*g_w(i,k,j+1)*mrdy*(fzm(k)*rv(i,k,j+1)+&amp;<a name='4317'>
&amp;fzp(k)*rv(i,k-1,j+1))-0.5*g_w(i,k,j)*mrdy*(fzm(k)*rv(i,k,j+1)+fzp(k)*rv(i,k-1,j+1)-(fzm(k)*rv(i,k,j)+fzp(k)*rv(i,k-1,j)))<a name='4318'>
        tendency(i,k,j) = tendency(i,k,j)-mrdy*0.5*((fzm(k)*rv(i,k,j+1)+fzp(k)*rv(i,k-1,j+1))*(w(i,k,j+1)+w(i,k,j))-(fzm(k)*rv(i,k,&amp;<a name='4319'>
&amp;j)+fzp(k)*rv(i,k-1,j))*(w(i,k,j)+w(i,k,j-1)))<a name='4320'>
      end do<a name='4321'>
    end do<a name='4322'>
    k = ktf+1<a name='4323'>
    do i = i_start, i_end<a name='4324'>
      mrdy = msft(i,j)*rdy<a name='4325'>
      g_tendency(i,k,j) = 0.5*g_rv(i,k-2,j+1)*mrdy*fzp(k-1)*(w(i,k,j+1)+w(i,k,j))-0.5*g_rv(i,k-2,j)*mrdy*fzp(k-1)*(w(i,k,j)+w(i,k,&amp;<a name='4326'>
&amp;j-1))-0.5*g_rv(i,k-1,j+1)*mrdy*(2-fzm(k-1))*(w(i,k,j+1)+w(i,k,j))+0.5*g_rv(i,k-1,j)*mrdy*(2-fzm(k-1))*(w(i,k,j)+w(i,k,j-1))+&amp;<a name='4327'>
&amp;g_tendency(i,k,j)+0.5*g_w(i,k,j-1)*mrdy*((2.-fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))-0.5*g_w(i,k,j+1)*mrdy*((2.-fzm(k-1)&amp;<a name='4328'>
&amp;)*rv(i,k-1,j+1)-fzp(k-1)*rv(i,k-2,j+1))-0.5*g_w(i,k,j)*mrdy*((2.-fzm(k-1))*rv(i,k-1,j+1)-fzp(k-1)*rv(i,k-2,j+1)-((2.-fzm(k-&amp;<a name='4329'>
&amp;1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j)))<a name='4330'>
      tendency(i,k,j) = tendency(i,k,j)-mrdy*0.5*(((2.-fzm(k-1))*rv(i,k-1,j+1)-fzp(k-1)*rv(i,k-2,j+1))*(w(i,k,j+1)+w(i,k,j))-((2.-&amp;<a name='4331'>
&amp;fzm(k-1))*rv(i,k-1,j)-fzp(k-1)*rv(i,k-2,j))*(w(i,k,j)+w(i,k,j-1)))<a name='4332'>
    end do<a name='4333'>
  end do<a name='4334'>
else horizontal_order_tesu<a name='4335'>
  write(unit=wrf_err_message,fmt=*) ' advect_w_6a, h_order not known ',horz_order<a name='4336'>
endif horizontal_order_tesu<a name='4337'>
i_start = its<a name='4338'>
i_end = min(ite,ide-1)<a name='4339'>
j_start = jts<a name='4340'>
j_end = min(jte,jde-1)<a name='4341'>
if (config_flags%open_xs .and. its .eq. ids) then<a name='4342'>
  do j = j_start, j_end<a name='4343'>
    do k = kts+1, ktf<a name='4344'>
      g_uw = 0.5*g_ru(its+1,k-1,j)*fzp(k)+0.5*g_ru(its,k-1,j)*fzp(k)+0.5*g_ru(its+1,k,j)*fzm(k)+0.5*g_ru(its,k,j)*fzm(k)<a name='4345'>
      uw = 0.5*(fzm(k)*(ru(its,k,j)+ru(its+1,k,j))+fzp(k)*(ru(its,k-1,j)+ru(its+1,k-1,j)))<a name='4346'>
      g_ub = g_uw*(0.5+sign(0.5,0.-uw))<a name='4347'>
      ub = min(uw,0.)<a name='4348'>
      g_tendency(its,k,j) = (-(g_ru(its+1,k-1,j)*rdx*w(its,k,j)*fzp(k)))+g_ru(its,k-1,j)*rdx*w(its,k,j)*fzp(k)-g_ru(its+1,k,j)*rdx*&amp;<a name='4349'>
&amp;w(its,k,j)*fzm(k)+g_ru(its,k,j)*rdx*w(its,k,j)*fzm(k)+g_tendency(its,k,j)-g_ub*rdx*(w_old(its+1,k,j)-w_old(its,k,j))-&amp;<a name='4350'>
&amp;g_w(its,k,j)*rdx*(fzm(k)*(ru(its+1,k,j)-ru(its,k,j))+fzp(k)*(ru(its+1,k-1,j)-ru(its,k-1,j)))-g_w_old(its+1,k,j)*rdx*ub+&amp;<a name='4351'>
&amp;g_w_old(its,k,j)*rdx*ub<a name='4352'>
      tendency(its,k,j) = tendency(its,k,j)-rdx*(ub*(w_old(its+1,k,j)-w_old(its,k,j))+w(its,k,j)*(fzm(k)*(ru(its+1,k,j)-ru(its,k,j)&amp;<a name='4353'>
&amp;)+fzp(k)*(ru(its+1,k-1,j)-ru(its,k-1,j))))<a name='4354'>
    end do<a name='4355'>
  end do<a name='4356'>
  k = ktf+1<a name='4357'>
  do j = j_start, j_end<a name='4358'>
    g_uw = (-(0.5*g_ru(its+1,k-2,j)*fzp(k-1)))-0.5*g_ru(its,k-2,j)*fzp(k-1)+0.5*g_ru(its+1,k-1,j)*(2-fzm(k-1))+0.5*g_ru(its,k-1,j)*&amp;<a name='4359'>
&amp;(2-fzm(k-1))<a name='4360'>
    uw = 0.5*((2.-fzm(k-1))*(ru(its,k-1,j)+ru(its+1,k-1,j))-fzp(k-1)*(ru(its,k-2,j)+ru(its+1,k-2,j)))<a name='4361'>
    g_ub = g_uw*(0.5+sign(0.5,0.-uw))<a name='4362'>
    ub = min(uw,0.)<a name='4363'>
    g_tendency(its,k,j) = g_ru(its+1,k-2,j)*rdx*w(its,k,j)*fzp(k-1)-g_ru(its,k-2,j)*rdx*w(its,k,j)*fzp(k-1)-g_ru(its+1,k-1,j)*rdx*&amp;<a name='4364'>
&amp;w(its,k,j)*(2-fzm(k-1))+g_ru(its,k-1,j)*rdx*w(its,k,j)*(2.-fzm(k-1))+g_tendency(its,k,j)-g_ub*rdx*(w_old(its+1,k,j)-w_old(its,&amp;<a name='4365'>
&amp;k,j))-g_w(its,k,j)*rdx*((2.-fzm(k-1))*(ru(its+1,k-1,j)-ru(its,k-1,j))-fzp(k-1)*(ru(its+1,k-2,j)-ru(its,k-2,j)))-g_w_old(its+1,&amp;<a name='4366'>
&amp;k,j)*rdx*ub+g_w_old(its,k,j)*rdx*ub<a name='4367'>
    tendency(its,k,j) = tendency(its,k,j)-rdx*(ub*(w_old(its+1,k,j)-w_old(its,k,j))+w(its,k,j)*((2.-fzm(k-1))*(ru(its+1,k-1,j)-&amp;<a name='4368'>
&amp;ru(its,k-1,j))-fzp(k-1)*(ru(its+1,k-2,j)-ru(its,k-2,j))))<a name='4369'>
  end do<a name='4370'>
endif<a name='4371'>
if (config_flags%open_xe .and. ite .eq. ide) then<a name='4372'>
  do j = j_start, j_end<a name='4373'>
    do k = kts+1, ktf<a name='4374'>
      g_uw = 0.5*g_ru(ite-1,k-1,j)*fzp(k)+0.5*g_ru(ite,k-1,j)*fzp(k)+0.5*g_ru(ite-1,k,j)*fzm(k)+0.5*g_ru(ite,k,j)*fzm(k)<a name='4375'>
      uw = 0.5*(fzm(k)*(ru(ite-1,k,j)+ru(ite,k,j))+fzp(k)*(ru(ite-1,k-1,j)+ru(ite,k-1,j)))<a name='4376'>
      g_ub = g_uw*(0.5+sign(0.5,uw-0.))<a name='4377'>
      ub = max(uw,0.)<a name='4378'>
      g_tendency(i_end,k,j) = g_ru(ite-1,k-1,j)*rdx*w(i_end,k,j)*fzp(k)-g_ru(ite,k-1,j)*rdx*w(i_end,k,j)*fzp(k)+g_ru(ite-1,k,j)*&amp;<a name='4379'>
&amp;rdx*w(i_end,k,j)*fzm(k)-g_ru(ite,k,j)*rdx*w(i_end,k,j)*fzm(k)+g_tendency(i_end,k,j)-g_ub*rdx*(w_old(i_end,k,j)-w_old(i_end-&amp;<a name='4380'>
&amp;1,k,j))-g_w(i_end,k,j)*rdx*(fzm(k)*(ru(ite,k,j)-ru(ite-1,k,j))+fzp(k)*(ru(ite,k-1,j)-ru(ite-1,k-1,j)))+g_w_old(i_end-1,k,j)*&amp;<a name='4381'>
&amp;rdx*ub-g_w_old(i_end,k,j)*rdx*ub<a name='4382'>
      tendency(i_end,k,j) = tendency(i_end,k,j)-rdx*(ub*(w_old(i_end,k,j)-w_old(i_end-1,k,j))+w(i_end,k,j)*(fzm(k)*(ru(ite,k,j)-&amp;<a name='4383'>
&amp;ru(ite-1,k,j))+fzp(k)*(ru(ite,k-1,j)-ru(ite-1,k-1,j))))<a name='4384'>
    end do<a name='4385'>
  end do<a name='4386'>
  k = ktf+1<a name='4387'>
  do j = j_start, j_end<a name='4388'>
    g_uw = (-(0.5*g_ru(ite-1,k-2,j)*fzp(k-1)))-0.5*g_ru(ite,k-2,j)*fzp(k-1)+0.5*g_ru(ite-1,k-1,j)*(2-fzm(k-1))+0.5*g_ru(ite,k-1,j)*&amp;<a name='4389'>
&amp;(2-fzm(k-1))<a name='4390'>
    uw = 0.5*((2.-fzm(k-1))*(ru(ite-1,k-1,j)+ru(ite,k-1,j))-fzp(k-1)*(ru(ite-1,k-2,j)+ru(ite,k-2,j)))<a name='4391'>
    g_ub = g_uw*(0.5+sign(0.5,uw-0.))<a name='4392'>
    ub = max(uw,0.)<a name='4393'>
    g_tendency(i_end,k,j) = (-(g_ru(ite-1,k-2,j)*rdx*w(i_end,k,j)*fzp(k-1)))+g_ru(ite,k-2,j)*rdx*w(i_end,k,j)*fzp(k-1)+g_ru(ite-1,&amp;<a name='4394'>
&amp;k-1,j)*rdx*w(i_end,k,j)*(2.-fzm(k-1))-g_ru(ite,k-1,j)*rdx*w(i_end,k,j)*(2-fzm(k-1))+g_tendency(i_end,k,j)-g_ub*rdx*&amp;<a name='4395'>
&amp;(w_old(i_end,k,j)-w_old(i_end-1,k,j))-g_w(i_end,k,j)*rdx*((2.-fzm(k-1))*(ru(ite,k-1,j)-ru(ite-1,k-1,j))-fzp(k-1)*(ru(ite,k-2,&amp;<a name='4396'>
&amp;j)-ru(ite-1,k-2,j)))+g_w_old(i_end-1,k,j)*rdx*ub-g_w_old(i_end,k,j)*rdx*ub<a name='4397'>
    tendency(i_end,k,j) = tendency(i_end,k,j)-rdx*(ub*(w_old(i_end,k,j)-w_old(i_end-1,k,j))+w(i_end,k,j)*((2.-fzm(k-1))*(ru(ite,k-&amp;<a name='4398'>
&amp;1,j)-ru(ite-1,k-1,j))-fzp(k-1)*(ru(ite,k-2,j)-ru(ite-1,k-2,j))))<a name='4399'>
  end do<a name='4400'>
endif<a name='4401'>
if (config_flags%open_ys .and. jts .eq. jds) then<a name='4402'>
  do i = i_start, i_end<a name='4403'>
    do k = kts+1, ktf<a name='4404'>
      g_vw = 0.5*g_rv(i,k-1,jts+1)*fzp(k)+0.5*g_rv(i,k-1,jts)*fzp(k)+0.5*g_rv(i,k,jts+1)*fzm(k)+0.5*g_rv(i,k,jts)*fzm(k)<a name='4405'>
      vw = 0.5*(fzm(k)*(rv(i,k,jts)+rv(i,k,jts+1))+fzp(k)*(rv(i,k-1,jts)+rv(i,k-1,jts+1)))<a name='4406'>
      g_vb = g_vw*(0.5+sign(0.5,0.-vw))<a name='4407'>
      vb = min(vw,0.)<a name='4408'>
      g_tendency(i,k,jts) = (-(g_rv(i,k-1,jts+1)*rdy*w(i,k,jts)*fzp(k)))+g_rv(i,k-1,jts)*rdy*w(i,k,jts)*fzp(k)-g_rv(i,k,jts+1)*rdy*&amp;<a name='4409'>
&amp;w(i,k,jts)*fzm(k)+g_rv(i,k,jts)*rdy*w(i,k,jts)*fzm(k)+g_tendency(i,k,jts)-g_vb*rdy*(w_old(i,k,jts+1)-w_old(i,k,jts))-g_w(i,&amp;<a name='4410'>
&amp;k,jts)*rdy*(fzm(k)*(rv(i,k,jts+1)-rv(i,k,jts))+fzp(k)*(rv(i,k-1,jts+1)-rv(i,k-1,jts)))-g_w_old(i,k,jts+1)*rdy*vb+g_w_old(i,&amp;<a name='4411'>
&amp;k,jts)*rdy*vb<a name='4412'>
      tendency(i,k,jts) = tendency(i,k,jts)-rdy*(vb*(w_old(i,k,jts+1)-w_old(i,k,jts))+w(i,k,jts)*(fzm(k)*(rv(i,k,jts+1)-rv(i,k,jts)&amp;<a name='4413'>
&amp;)+fzp(k)*(rv(i,k-1,jts+1)-rv(i,k-1,jts))))<a name='4414'>
    end do<a name='4415'>
  end do<a name='4416'>
  k = ktf+1<a name='4417'>
  do i = i_start, i_end<a name='4418'>
    g_vw = (-(0.5*g_rv(i,k-2,jts+1)*fzp(k-1)))-0.5*g_rv(i,k-2,jts)*fzp(k-1)+0.5*g_rv(i,k-1,jts+1)*(2-fzm(k-1))+0.5*g_rv(i,k-1,jts)*&amp;<a name='4419'>
&amp;(2-fzm(k-1))<a name='4420'>
    vw = 0.5*((2.-fzm(k-1))*(rv(i,k-1,jts)+rv(i,k-1,jts+1))-fzp(k-1)*(rv(i,k-2,jts)+rv(i,k-2,jts+1)))<a name='4421'>
    g_vb = g_vw*(0.5+sign(0.5,0.-vw))<a name='4422'>
    vb = min(vw,0.)<a name='4423'>
    g_tendency(i,k,jts) = g_rv(i,k-2,jts+1)*rdy*w(i,k,jts)*fzp(k-1)-g_rv(i,k-2,jts)*rdy*w(i,k,jts)*fzp(k-1)-g_rv(i,k-1,jts+1)*rdy*&amp;<a name='4424'>
&amp;w(i,k,jts)*(2-fzm(k-1))+g_rv(i,k-1,jts)*rdy*w(i,k,jts)*(2.-fzm(k-1))+g_tendency(i,k,jts)-g_vb*rdy*(w_old(i,k,jts+1)-w_old(i,k,&amp;<a name='4425'>
&amp;jts))-g_w(i,k,jts)*rdy*((2.-fzm(k-1))*(rv(i,k-1,jts+1)-rv(i,k-1,jts))-fzp(k-1)*(rv(i,k-2,jts+1)-rv(i,k-2,jts)))-g_w_old(i,k,&amp;<a name='4426'>
&amp;jts+1)*rdy*vb+g_w_old(i,k,jts)*rdy*vb<a name='4427'>
    tendency(i,k,jts) = tendency(i,k,jts)-rdy*(vb*(w_old(i,k,jts+1)-w_old(i,k,jts))+w(i,k,jts)*((2.-fzm(k-1))*(rv(i,k-1,jts+1)-&amp;<a name='4428'>
&amp;rv(i,k-1,jts))-fzp(k-1)*(rv(i,k-2,jts+1)-rv(i,k-2,jts))))<a name='4429'>
  end do<a name='4430'>
endif<a name='4431'>
if (config_flags%open_ye .and. jte .eq. jde) then<a name='4432'>
  do i = i_start, i_end<a name='4433'>
    do k = kts+1, ktf<a name='4434'>
      g_vw = 0.5*g_rv(i,k-1,jte-1)*fzp(k)+0.5*g_rv(i,k-1,jte)*fzp(k)+0.5*g_rv(i,k,jte-1)*fzm(k)+0.5*g_rv(i,k,jte)*fzm(k)<a name='4435'>
      vw = 0.5*(fzm(k)*(rv(i,k,jte-1)+rv(i,k,jte))+fzp(k)*(rv(i,k-1,jte-1)+rv(i,k-1,jte)))<a name='4436'>
      g_vb = g_vw*(0.5+sign(0.5,vw-0.))<a name='4437'>
      vb = max(vw,0.)<a name='4438'>
      g_tendency(i,k,j_end) = g_rv(i,k-1,jte-1)*rdy*w(i,k,j_end)*fzp(k)-g_rv(i,k-1,jte)*rdy*w(i,k,j_end)*fzp(k)+g_rv(i,k,jte-1)*&amp;<a name='4439'>
&amp;rdy*w(i,k,j_end)*fzm(k)-g_rv(i,k,jte)*rdy*w(i,k,j_end)*fzm(k)+g_tendency(i,k,j_end)-g_vb*rdy*(w_old(i,k,j_end)-w_old(i,k,&amp;<a name='4440'>
&amp;j_end-1))-g_w(i,k,j_end)*rdy*(fzm(k)*(rv(i,k,jte)-rv(i,k,jte-1))+fzp(k)*(rv(i,k-1,jte)-rv(i,k-1,jte-1)))+g_w_old(i,k,j_end-&amp;<a name='4441'>
&amp;1)*rdy*vb-g_w_old(i,k,j_end)*rdy*vb<a name='4442'>
      tendency(i,k,j_end) = tendency(i,k,j_end)-rdy*(vb*(w_old(i,k,j_end)-w_old(i,k,j_end-1))+w(i,k,j_end)*(fzm(k)*(rv(i,k,jte)-&amp;<a name='4443'>
&amp;rv(i,k,jte-1))+fzp(k)*(rv(i,k-1,jte)-rv(i,k-1,jte-1))))<a name='4444'>
    end do<a name='4445'>
  end do<a name='4446'>
  k = ktf+1<a name='4447'>
  do i = i_start, i_end<a name='4448'>
    g_vw = (-(0.5*g_rv(i,k-2,jte-1)*fzp(k-1)))-0.5*g_rv(i,k-2,jte)*fzp(k-1)+0.5*g_rv(i,k-1,jte-1)*(2-fzm(k-1))+0.5*g_rv(i,k-1,jte)*&amp;<a name='4449'>
&amp;(2-fzm(k-1))<a name='4450'>
    vw = 0.5*((2.-fzm(k-1))*(rv(i,k-1,jte-1)+rv(i,k-1,jte))-fzp(k-1)*(rv(i,k-2,jte-1)+rv(i,k-2,jte)))<a name='4451'>
    g_vb = g_vw*(0.5+sign(0.5,vw-0.))<a name='4452'>
    vb = max(vw,0.)<a name='4453'>
    g_tendency(i,k,j_end) = (-(g_rv(i,k-2,jte-1)*rdy*w(i,k,j_end)*fzp(k-1)))+g_rv(i,k-2,jte)*rdy*w(i,k,j_end)*fzp(k-1)+g_rv(i,k-1,&amp;<a name='4454'>
&amp;jte-1)*rdy*w(i,k,j_end)*(2.-fzm(k-1))-g_rv(i,k-1,jte)*rdy*w(i,k,j_end)*(2-fzm(k-1))+g_tendency(i,k,j_end)-g_vb*rdy*(w_old(i,k,&amp;<a name='4455'>
&amp;j_end)-w_old(i,k,j_end-1))-g_w(i,k,j_end)*rdy*((2.-fzm(k-1))*(rv(i,k-1,jte)-rv(i,k-1,jte-1))-fzp(k-1)*(rv(i,k-2,jte)-rv(i,k-2,&amp;<a name='4456'>
&amp;jte-1)))+g_w_old(i,k,j_end-1)*rdy*vb-g_w_old(i,k,j_end)*rdy*vb<a name='4457'>
    tendency(i,k,j_end) = tendency(i,k,j_end)-rdy*(vb*(w_old(i,k,j_end)-w_old(i,k,j_end-1))+w(i,k,j_end)*((2.-fzm(k-1))*(rv(i,k-1,&amp;<a name='4458'>
&amp;jte)-rv(i,k-1,jte-1))-fzp(k-1)*(rv(i,k-2,jte)-rv(i,k-2,jte-1))))<a name='4459'>
  end do<a name='4460'>
endif<a name='4461'>
i_start = its<a name='4462'>
i_end = min(ite,ide-1)<a name='4463'>
j_start = jts<a name='4464'>
j_end = min(jte,jde-1)<a name='4465'>
do i = i_start, i_end<a name='4466'>
  g_vflux(i,kts) = 0.<a name='4467'>
  vflux(i,kts) = 0.<a name='4468'>
  g_vflux(i,kte) = 0.<a name='4469'>
  vflux(i,kte) = 0.<a name='4470'>
end do<a name='4471'>
vert_order_tesu: if (vert_order .eq. 6) then<a name='4472'>
  do j = j_start, j_end<a name='4473'>
    do k = kts+3, ktf-1<a name='4474'>
      do i = i_start, i_end<a name='4475'>
        g_vel = 0.5*g_rom(i,k-1,j)+0.5*g_rom(i,k,j)<a name='4476'>
        vel = 0.5*(rom(i,k,j)+rom(i,k-1,j))<a name='4477'>
        g_vflux(i,k) = g_vel*(0.61666667*(w(i,k,j)+w(i,k-1,j))-0.13333333*(w(i,k+1,j)+w(i,k-2,j))+0.016666667*(w(i,k+2,j)+w(i,k-3,&amp;<a name='4478'>
&amp;j)))+0.016666667*g_w(i,k-3,j)*vel-0.13333333*g_w(i,k-2,j)*vel+0.61666667*g_w(i,k-1,j)*vel+0.016666667*g_w(i,k+2,j)*vel-&amp;<a name='4479'>
&amp;0.13333333*g_w(i,k+1,j)*vel+0.61666667*g_w(i,k,j)*vel<a name='4480'>
        vflux(i,k) = vel*(37./60.*(w(i,k,j)+w(i,k-1,j))-2./15.*(w(i,k+1,j)+w(i,k-2,j))+1./60.*(w(i,k+2,j)+w(i,k-3,j)))<a name='4481'>
      end do<a name='4482'>
    end do<a name='4483'>
    do i = i_start, i_end<a name='4484'>
      k = kts+1<a name='4485'>
      g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,k,&amp;<a name='4486'>
&amp;j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4487'>
      vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4488'>
      k = kts+2<a name='4489'>
      g_vel = 0.5*g_rom(i,k-1,j)+0.5*g_rom(i,k,j)<a name='4490'>
      vel = 0.5*(rom(i,k,j)+rom(i,k-1,j))<a name='4491'>
      g_vflux(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i,k-1,j))-0.083333333*(w(i,k+1,j)+w(i,k-2,j)))-0.083333333*g_w(i,k-2,j)*vel+&amp;<a name='4492'>
&amp;0.58333333*g_w(i,k-1,j)*vel-0.083333333*g_w(i,k+1,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='4493'>
      vflux(i,k) = vel*(7./12.*(w(i,k,j)+w(i,k-1,j))-1./12.*(w(i,k+1,j)+w(i,k-2,j)))<a name='4494'>
      k = ktf<a name='4495'>
      g_vel = 0.5*g_rom(i,k-1,j)+0.5*g_rom(i,k,j)<a name='4496'>
      vel = 0.5*(rom(i,k,j)+rom(i,k-1,j))<a name='4497'>
      g_vflux(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i,k-1,j))-0.083333333*(w(i,k+1,j)+w(i,k-2,j)))-0.083333333*g_w(i,k-2,j)*vel+&amp;<a name='4498'>
&amp;0.58333333*g_w(i,k-1,j)*vel-0.083333333*g_w(i,k+1,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='4499'>
      vflux(i,k) = vel*(7./12.*(w(i,k,j)+w(i,k-1,j))-1./12.*(w(i,k+1,j)+w(i,k-2,j)))<a name='4500'>
      k = ktf+1<a name='4501'>
      g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,k,&amp;<a name='4502'>
&amp;j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4503'>
      vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4504'>
    end do<a name='4505'>
    do k = kts+1, ktf<a name='4506'>
      do i = i_start, i_end<a name='4507'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzu(k)+g_vflux(i,k)*rdzu(k)<a name='4508'>
        tendency(i,k,j) = tendency(i,k,j)-rdzu(k)*(vflux(i,k+1)-vflux(i,k))<a name='4509'>
      end do<a name='4510'>
    end do<a name='4511'>
    k = ktf+1<a name='4512'>
    do i = i_start, i_end<a name='4513'>
      g_tendency(i,k,j) = g_tendency(i,k,j)+2*g_vflux(i,k)*rdzu(k-1)<a name='4514'>
      tendency(i,k,j) = tendency(i,k,j)+2.*rdzu(k-1)*vflux(i,k)<a name='4515'>
    end do<a name='4516'>
  end do<a name='4517'>
else if (vert_order .eq. 5) then vert_order_tesu<a name='4518'>
  do j = j_start, j_end<a name='4519'>
    do k = kts+3, ktf-1<a name='4520'>
      do i = i_start, i_end<a name='4521'>
        g_vel = 0.5*g_rom(i,k-1,j)+0.5*g_rom(i,k,j)<a name='4522'>
        vel = 0.5*(rom(i,k,j)+rom(i,k-1,j))<a name='4523'>
        g_vflux(i,k) = g_vel*(0.61666667*(w(i,k,j)+w(i,k-1,j))-0.13333333*(w(i,k+1,j)+w(i,k-2,j))+0.016666667*(w(i,k+2,j)+w(i,k-3,&amp;<a name='4524'>
&amp;j))-0.016666667*(w(i,k+2,j)-w(i,k-3,j)-5.*(w(i,k+1,j)-w(i,k-2,j))+10.*(w(i,k,j)-w(i,k-1,j)))*sign(1.,-vel))+g_w(i,k-3,j)*&amp;<a name='4525'>
&amp;vel*(0.016666667-(-0.016666667)*sign(1.,-vel))+g_w(i,k-2,j)*vel*((-0.13333333)-0.083333333*sign(1.,-vel))+g_w(i,k-1,j)*&amp;<a name='4526'>
&amp;vel*(0.61666667-(-0.16666667)*sign(1.,-vel))+g_w(i,k+2,j)*vel*(0.016666667-0.016666667*sign(1.,-vel))+g_w(i,k+1,j)*vel*((-&amp;<a name='4527'>
&amp;0.13333333)-(-0.083333333)*sign(1.,-vel))+g_w(i,k,j)*vel*(0.61666667-0.16666667*sign(1.,-vel))<a name='4528'>
        vflux(i,k) = vel*(37./60.*(w(i,k,j)+w(i,k-1,j))-2./15.*(w(i,k+1,j)+w(i,k-2,j))+1./60.*(w(i,k+2,j)+w(i,k-3,j))-sign(1.,-vel)&amp;<a name='4529'>
&amp;*(1./60.)*(w(i,k+2,j)-w(i,k-3,j)-5.*(w(i,k+1,j)-w(i,k-2,j))+10.*(w(i,k,j)-w(i,k-1,j))))<a name='4530'>
      end do<a name='4531'>
    end do<a name='4532'>
    do i = i_start, i_end<a name='4533'>
      k = kts+1<a name='4534'>
      g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,k,&amp;<a name='4535'>
&amp;j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4536'>
      vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4537'>
      k = kts+2<a name='4538'>
      g_vel = 0.5*g_rom(i,k-1,j)+0.5*g_rom(i,k,j)<a name='4539'>
      vel = 0.5*(rom(i,k,j)+rom(i,k-1,j))<a name='4540'>
      g_vflux(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i,k-1,j))-0.083333333*(w(i,k+1,j)+w(i,k-2,j))+0.083333333*(w(i,k+1,j)-w(i,k-2,j)&amp;<a name='4541'>
&amp;-3.*(w(i,k,j)-w(i,k-1,j)))*sign(1.,-vel))+g_w(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_w(i,k-1,j)*vel*&amp;<a name='4542'>
&amp;(0.58333333+0.25*sign(1.,-vel))+g_w(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_w(i,k,j)*vel*(0.58333333+(-&amp;<a name='4543'>
&amp;0.25)*sign(1.,-vel))<a name='4544'>
      vflux(i,k) = vel*(7./12.*(w(i,k,j)+w(i,k-1,j))-1./12.*(w(i,k+1,j)+w(i,k-2,j))+sign(1.,-vel)*(1./12.)*(w(i,k+1,j)-w(i,k-2,j)-&amp;<a name='4545'>
&amp;3.*(w(i,k,j)-w(i,k-1,j))))<a name='4546'>
      k = ktf<a name='4547'>
      g_vel = 0.5*g_rom(i,k-1,j)+0.5*g_rom(i,k,j)<a name='4548'>
      vel = 0.5*(rom(i,k,j)+rom(i,k-1,j))<a name='4549'>
      g_vflux(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i,k-1,j))-0.083333333*(w(i,k+1,j)+w(i,k-2,j))+0.083333333*(w(i,k+1,j)-w(i,k-2,j)&amp;<a name='4550'>
&amp;-3.*(w(i,k,j)-w(i,k-1,j)))*sign(1.,-vel))+g_w(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_w(i,k-1,j)*vel*&amp;<a name='4551'>
&amp;(0.58333333+0.25*sign(1.,-vel))+g_w(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_w(i,k,j)*vel*(0.58333333+(-&amp;<a name='4552'>
&amp;0.25)*sign(1.,-vel))<a name='4553'>
      vflux(i,k) = vel*(7./12.*(w(i,k,j)+w(i,k-1,j))-1./12.*(w(i,k+1,j)+w(i,k-2,j))+sign(1.,-vel)*(1./12.)*(w(i,k+1,j)-w(i,k-2,j)-&amp;<a name='4554'>
&amp;3.*(w(i,k,j)-w(i,k-1,j))))<a name='4555'>
      k = ktf+1<a name='4556'>
      g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,k,&amp;<a name='4557'>
&amp;j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4558'>
      vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4559'>
    end do<a name='4560'>
    do k = kts+1, ktf<a name='4561'>
      do i = i_start, i_end<a name='4562'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzu(k)+g_vflux(i,k)*rdzu(k)<a name='4563'>
        tendency(i,k,j) = tendency(i,k,j)-rdzu(k)*(vflux(i,k+1)-vflux(i,k))<a name='4564'>
      end do<a name='4565'>
    end do<a name='4566'>
    k = ktf+1<a name='4567'>
    do i = i_start, i_end<a name='4568'>
      g_tendency(i,k,j) = g_tendency(i,k,j)+2*g_vflux(i,k)*rdzu(k-1)<a name='4569'>
      tendency(i,k,j) = tendency(i,k,j)+2.*rdzu(k-1)*vflux(i,k)<a name='4570'>
    end do<a name='4571'>
  end do<a name='4572'>
else if (vert_order .eq. 4) then vert_order_tesu<a name='4573'>
  do j = j_start, j_end<a name='4574'>
    do k = kts+2, ktf<a name='4575'>
      do i = i_start, i_end<a name='4576'>
        g_vel = 0.5*g_rom(i,k-1,j)+0.5*g_rom(i,k,j)<a name='4577'>
        vel = 0.5*(rom(i,k,j)+rom(i,k-1,j))<a name='4578'>
        g_vflux(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i,k-1,j))-0.083333333*(w(i,k+1,j)+w(i,k-2,j)))-0.083333333*g_w(i,k-2,j)*vel+&amp;<a name='4579'>
&amp;0.58333333*g_w(i,k-1,j)*vel-0.083333333*g_w(i,k+1,j)*vel+0.58333333*g_w(i,k,j)*vel<a name='4580'>
        vflux(i,k) = vel*(7./12.*(w(i,k,j)+w(i,k-1,j))-1./12.*(w(i,k+1,j)+w(i,k-2,j)))<a name='4581'>
      end do<a name='4582'>
    end do<a name='4583'>
    do i = i_start, i_end<a name='4584'>
      k = kts+1<a name='4585'>
      g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,k,&amp;<a name='4586'>
&amp;j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4587'>
      vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4588'>
      k = ktf+1<a name='4589'>
      g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,k,&amp;<a name='4590'>
&amp;j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4591'>
      vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4592'>
    end do<a name='4593'>
    do k = kts+1, ktf<a name='4594'>
      do i = i_start, i_end<a name='4595'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzu(k)+g_vflux(i,k)*rdzu(k)<a name='4596'>
        tendency(i,k,j) = tendency(i,k,j)-rdzu(k)*(vflux(i,k+1)-vflux(i,k))<a name='4597'>
      end do<a name='4598'>
    end do<a name='4599'>
    k = ktf+1<a name='4600'>
    do i = i_start, i_end<a name='4601'>
      g_tendency(i,k,j) = g_tendency(i,k,j)+2*g_vflux(i,k)*rdzu(k-1)<a name='4602'>
      tendency(i,k,j) = tendency(i,k,j)+2.*rdzu(k-1)*vflux(i,k)<a name='4603'>
    end do<a name='4604'>
  end do<a name='4605'>
else if (vert_order .eq. 3) then vert_order_tesu<a name='4606'>
  do j = j_start, j_end<a name='4607'>
    do k = kts+2, ktf<a name='4608'>
      do i = i_start, i_end<a name='4609'>
        g_vel = 0.5*g_rom(i,k-1,j)+0.5*g_rom(i,k,j)<a name='4610'>
        vel = 0.5*(rom(i,k,j)+rom(i,k-1,j))<a name='4611'>
        g_vflux(i,k) = g_vel*(0.58333333*(w(i,k,j)+w(i,k-1,j))-0.083333333*(w(i,k+1,j)+w(i,k-2,j))+0.083333333*(w(i,k+1,j)-w(i,k-2,&amp;<a name='4612'>
&amp;j)-3.*(w(i,k,j)-w(i,k-1,j)))*sign(1.,-vel))+g_w(i,k-2,j)*vel*((-0.083333333)+(-0.083333333)*sign(1.,-vel))+g_w(i,k-1,j)*&amp;<a name='4613'>
&amp;vel*(0.58333333+0.25*sign(1.,-vel))+g_w(i,k+1,j)*vel*((-0.083333333)+0.083333333*sign(1.,-vel))+g_w(i,k,j)*vel*&amp;<a name='4614'>
&amp;(0.58333333+(-0.25)*sign(1.,-vel))<a name='4615'>
        vflux(i,k) = vel*(7./12.*(w(i,k,j)+w(i,k-1,j))-1./12.*(w(i,k+1,j)+w(i,k-2,j))+sign(1.,-vel)*(1./12.)*(w(i,k+1,j)-w(i,k-2,j)&amp;<a name='4616'>
&amp;-3.*(w(i,k,j)-w(i,k-1,j))))<a name='4617'>
      end do<a name='4618'>
    end do<a name='4619'>
    do i = i_start, i_end<a name='4620'>
      k = kts+1<a name='4621'>
      g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,k,&amp;<a name='4622'>
&amp;j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4623'>
      vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4624'>
      k = ktf+1<a name='4625'>
      g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,k,&amp;<a name='4626'>
&amp;j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4627'>
      vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4628'>
    end do<a name='4629'>
    do k = kts+1, ktf<a name='4630'>
      do i = i_start, i_end<a name='4631'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzu(k)+g_vflux(i,k)*rdzu(k)<a name='4632'>
        tendency(i,k,j) = tendency(i,k,j)-rdzu(k)*(vflux(i,k+1)-vflux(i,k))<a name='4633'>
      end do<a name='4634'>
    end do<a name='4635'>
    k = ktf+1<a name='4636'>
    do i = i_start, i_end<a name='4637'>
      g_tendency(i,k,j) = g_tendency(i,k,j)+2*g_vflux(i,k)*rdzu(k-1)<a name='4638'>
      tendency(i,k,j) = tendency(i,k,j)+2.*rdzu(k-1)*vflux(i,k)<a name='4639'>
    end do<a name='4640'>
  end do<a name='4641'>
else if (vert_order .eq. 2) then vert_order_tesu<a name='4642'>
  do j = j_start, j_end<a name='4643'>
    do k = kts+1, ktf+1<a name='4644'>
      do i = i_start, i_end<a name='4645'>
        g_vflux(i,k) = 0.25*g_rom(i,k-1,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_rom(i,k,j)*(w(i,k,j)+w(i,k-1,j))+0.25*g_w(i,k-1,j)*(rom(i,&amp;<a name='4646'>
&amp;k,j)+rom(i,k-1,j))+0.25*g_w(i,k,j)*(rom(i,k,j)+rom(i,k-1,j))<a name='4647'>
        vflux(i,k) = 0.25*(rom(i,k,j)+rom(i,k-1,j))*(w(i,k,j)+w(i,k-1,j))<a name='4648'>
      end do<a name='4649'>
    end do<a name='4650'>
    do k = kts+1, ktf<a name='4651'>
      do i = i_start, i_end<a name='4652'>
        g_tendency(i,k,j) = g_tendency(i,k,j)-g_vflux(i,k+1)*rdzu(k)+g_vflux(i,k)*rdzu(k)<a name='4653'>
        tendency(i,k,j) = tendency(i,k,j)-rdzu(k)*(vflux(i,k+1)-vflux(i,k))<a name='4654'>
      end do<a name='4655'>
    end do<a name='4656'>
    k = ktf+1<a name='4657'>
    do i = i_start, i_end<a name='4658'>
      g_tendency(i,k,j) = g_tendency(i,k,j)+2*g_vflux(i,k)*rdzu(k-1)<a name='4659'>
      tendency(i,k,j) = tendency(i,k,j)+2.*rdzu(k-1)*vflux(i,k)<a name='4660'>
    end do<a name='4661'>
  end do<a name='4662'>
endif vert_order_tesu<a name='4663'>
<a name='4664'>
   call <A href='../../html_code/frame/module_trace.F.html#TRACE_EXIT'>trace_exit</A><A href='../../html_code/dyn_em/module_advect_em_tl.F.html#G_ADVECT_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRACE_EXIT_9">("g_advect_w")<a name='4665'>
<a name='4666'>
end subroutine g_advect_w<a name='4667'>
<a name='4668'>
<a name='4669'>
end module     g_module_advect_em<a name='4670'>
<a name='4671'>
<a name='4672'>
</pre></body></html>