<HTML> <BODY BGCOLOR=#eeddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:DRIVER_LAYER:IO<a name='2'></font>
<font color=#447700>!<a name='3'></font>
#define DEBUG_LVL 50<a name='4'>
<font color=#447700>!#define mpi_x_comm_size(i,j,k)  Mpi_Comm_Size ( i,j,k ) ; write(0,*) __LINE__<a name='5'></font>
#define mpi_x_comm_size(i,j,k)  Mpi_Comm_Size ( i,j,k )<a name='6'>
<a name='7'>
<A NAME='MODULE_WRF_QUILT'><A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='8'>
<font color=#993300>MODULE </font><font color=#cc0000>module_wrf_quilt</font> <A href='../../call_to/MODULE_WRF_QUILT.html' TARGET='index'>19</A><a name='9'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='10'></font>
<font color=#447700>!&lt;PRE&gt;<a name='11'></font>
<font color=#447700>! This module contains WRF-specific I/O quilt routines called by both <a name='12'></font>
<font color=#447700>! client (compute) and server (I/O quilt) tasks.  I/O quilt servers are <a name='13'></font>
<font color=#447700>! a run-time optimization that allow I/O operations, executed on the I/O <a name='14'></font>
<font color=#447700>! quilt server tasks, to be overlapped with useful computation, executed on <a name='15'></font>
<font color=#447700>! the compute tasks.  Since I/O operations are often quite slow compared to <a name='16'></font>
<font color=#447700>! computation, this performance optimization can increase parallel <a name='17'></font>
<font color=#447700>! efficiency.  <a name='18'></font>
<font color=#447700>!<a name='19'></font>
<font color=#447700>! Currently, one group of I/O servers can be specified at run-time.  Namelist <a name='20'></font>
<font color=#447700>! variable "nio_tasks_per_group" is used to specify the number of I/O server <a name='21'></font>
<font color=#447700>! tasks in this group.  In most cases, parallel efficiency is optimized when <a name='22'></font>
<font color=#447700>! the minimum number of I/O server tasks are used.  If memory needed to cache <a name='23'></font>
<font color=#447700>! I/O operations fits on a single processor, then set nio_tasks_per_group=1.  <a name='24'></font>
<font color=#447700>! If not, increase the number of I/O server tasks until I/O operations fit in <a name='25'></font>
<font color=#447700>! memory.  In the future, multiple groups of I/O server tasks will be <a name='26'></font>
<font color=#447700>! supported.  The number of groups will be specified by namelist variable <a name='27'></font>
<font color=#447700>! "nio_groups".  For now, nio_groups must be set to 1.  Currently, I/O servers <a name='28'></font>
<font color=#447700>! only support overlap of output operations with computation.  Also, only I/O <a name='29'></font>
<font color=#447700>! packages that do no support native parallel I/O may be used with I/O server <a name='30'></font>
<font color=#447700>! tasks.  This excludes PHDF5 and MCEL.  <a name='31'></font>
<font color=#447700>!<a name='32'></font>
<font color=#447700>! In this module, the I/O quilt server tasks call package-dependent <a name='33'></font>
<font color=#447700>! WRF-specific I/O interfaces to perform I/O operations requested by the <a name='34'></font>
<font color=#447700>! client (compute) tasks.  All of these calls occur inside subroutine <a name='35'></font>
<font color=#447700>! quilt().  <a name='36'></font>
<font color=#447700>! <a name='37'></font>
<font color=#447700>! The client (compute) tasks call package-independent WRF-specific "quilt I/O" <a name='38'></font>
<font color=#447700>! interfaces that send requests to the I/O quilt servers.  All of these calls <a name='39'></font>
<font color=#447700>! are made from module_io.F.  <a name='40'></font>
<font color=#447700>!<a name='41'></font>
<font color=#447700>! These routines have the same names and (roughly) the same arguments as those <a name='42'></font>
<font color=#447700>! specified in the WRF I/O API except that:<a name='43'></font>
<font color=#447700>! - "Quilt I/O" routines defined in this file and called by routines in <a name='44'></font>
<font color=#447700>!   module_io.F have the "wrf_quilt_" prefix.<a name='45'></font>
<font color=#447700>! - Package-dependent routines called from routines in this file are defined <a name='46'></font>
<font color=#447700>!   in the external I/O packages and have the "ext_" prefix.<a name='47'></font>
<font color=#447700>!<a name='48'></font>
<font color=#447700>! Both client (compute) and server tasks call routine init_module_wrf_quilt() <a name='49'></font>
<font color=#447700>! which then calls setup_quilt_servers() determine which tasks are compute <a name='50'></font>
<font color=#447700>! tasks and which are server tasks.  Before the end of init_module_wrf_quilt() <a name='51'></font>
<font color=#447700>! server tasks call routine quilt() and remain there for the rest of the model <a name='52'></font>
<font color=#447700>! run.  Compute tasks return from init_module_wrf_quilt() to perform model <a name='53'></font>
<font color=#447700>! computations.  <a name='54'></font>
<font color=#447700>!<a name='55'></font>
<font color=#447700>! See http://www.mmm.ucar.edu/wrf/WG2/software_2.0/IOAPI.doc for the latest<a name='56'></font>
<font color=#447700>! version of the WRF I/O API.  This document includes detailed descriptions<a name='57'></font>
<font color=#447700>! of subroutines and their arguments that are not duplicated here.<a name='58'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='59'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='60'></font>
  USE <A href='../../html_code/frame/module_internal_header_util.F.html#MODULE_INTERNAL_HEADER_UTIL'>module_internal_header_util</A><A href='../../html_code/frame/module_io_quilt.F.html#module_io_quilt.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_INTERNAL_HEADER_UTIL_1"><a name='61'>
<a name='62'>
  INTEGER, PARAMETER :: int_num_handles = 99<a name='63'>
  LOGICAL, DIMENSION(int_num_handles) :: okay_to_write, int_handle_in_use, okay_to_commit<a name='64'>
  INTEGER, DIMENSION(int_num_handles) :: int_num_bytes_to_write, io_form<a name='65'>
  REAL, POINTER    :: int_local_output_buffer(:)<a name='66'>
  INTEGER          :: int_local_output_cursor<a name='67'>
  LOGICAL          :: quilting_enabled<a name='68'>
  LOGICAL          :: disable_quilt = .FALSE.<a name='69'>
<a name='70'>
#ifdef DM_PARALLEL<a name='71'>
  INTEGER mpi_comm_local<a name='72'>
  INTEGER mpi_comm_io_groups(100)<a name='73'>
  INTEGER nio_tasks_in_group<a name='74'>
  INTEGER nio_groups<a name='75'>
  INTEGER nio_tasks_per_group<a name='76'>
  INTEGER ncompute_tasks<a name='77'>
  INTEGER ntasks<a name='78'>
  INTEGER mytask<a name='79'>
<a name='80'>
  INTEGER, PARAMETER           :: onebyte = 1<a name='81'>
  INTEGER comm_io_servers, iserver, hdrbufsize, obufsize<a name='82'>
  INTEGER, DIMENSION(4096)     :: hdrbuf<a name='83'>
  INTEGER, DIMENSION(int_num_handles)     :: handle<a name='84'>
#endif<a name='85'>
<a name='86'>
  CONTAINS<a name='87'>
<a name='88'>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='89'></font>
<A NAME='INT_GET_FRESH_HANDLE'><A href='../../html_code/frame/module_io_quilt.F.html#INT_GET_FRESH_HANDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='90'>
    <font color=#993300>SUBROUTINE </font><font color=#cc0000>int_get_fresh_handle</font>( retval ) <A href='../../call_to/INT_GET_FRESH_HANDLE.html' TARGET='index'>1</A>,<A href='../../call_from/INT_GET_FRESH_HANDLE.html' TARGET='index'>1</A><a name='91'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='92'></font>
<font color=#447700>!&lt;PRE&gt;<a name='93'></font>
<font color=#447700>! Find an unused "client file handle" and return it in retval.<a name='94'></font>
<font color=#447700>! The "client file handle" is used to remember how a file was opened<a name='95'></font>
<font color=#447700>! so clients do not need to ask the I/O quilt servers for this information.<a name='96'></font>
<font color=#447700>! It is also used as a file identifier in communications with the I/O<a name='97'></font>
<font color=#447700>! server task.<a name='98'></font>
<font color=#447700>!<a name='99'></font>
<font color=#447700>! Note that client tasks know nothing about package-specific handles.<a name='100'></font>
<font color=#447700>! Only the I/O quilt servers know about them.<a name='101'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='102'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='103'></font>
      INTEGER i, retval<a name='104'>
      retval = -1<a name='105'>
      DO i = 1, int_num_handles<a name='106'>
        IF ( .NOT. int_handle_in_use(i) )  THEN<a name='107'>
          retval = i<a name='108'>
          GOTO 33<a name='109'>
        ENDIF<a name='110'>
      ENDDO<a name='111'>
33    CONTINUE<a name='112'>
      IF ( retval &lt; 0 )  THEN<a name='113'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#INT_GET_FRESH_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_102">("frame/module_io_quilt.F: int_get_fresh_handle() can not")<a name='114'>
      ENDIF<a name='115'>
      int_handle_in_use(i) = .TRUE.<a name='116'>
      NULLIFY ( int_local_output_buffer )<a name='117'>
    END SUBROUTINE int_get_fresh_handle<a name='118'>
<a name='119'>
<A NAME='SETUP_QUILT_SERVERS'><A href='../../html_code/frame/module_io_quilt.F.html#SETUP_QUILT_SERVERS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='120'>
    <font color=#993300>SUBROUTINE </font><font color=#cc0000>setup_quilt_servers</font> ( nio_tasks_per_group,     &amp; <A href='../../call_to/SETUP_QUILT_SERVERS.html' TARGET='index'>1</A>,<A href='../../call_from/SETUP_QUILT_SERVERS.html' TARGET='index'>1</A><a name='121'>
                                     mytask,                  &amp;<a name='122'>
                                     ntasks,                  &amp;<a name='123'>
                                     n_groups_arg,            &amp;<a name='124'>
                                     nio,                     &amp;<a name='125'>
                                     mpi_comm_wrld,           &amp;<a name='126'>
                                     mpi_comm_local,          &amp;<a name='127'>
                                     mpi_comm_io_groups)<a name='128'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='129'></font>
<font color=#447700>!&lt;PRE&gt;<a name='130'></font>
<font color=#447700>! Both client (compute) and server tasks call this routine to <a name='131'></font>
<font color=#447700>! determine which tasks are compute tasks and which are I/O server tasks.  <a name='132'></font>
<font color=#447700>!<a name='133'></font>
<font color=#447700>! Module variables MPI_COMM_LOCAL and MPI_COMM_IO_GROUPS(:) are set up to <a name='134'></font>
<font color=#447700>! contain MPI communicators as follows:  <a name='135'></font>
<font color=#447700>!<a name='136'></font>
<font color=#447700>! MPI_COMM_LOCAL is the communicator for the local groups of tasks. For the <a name='137'></font>
<font color=#447700>! compute tasks it is the group of compute tasks; for a server group it the <a name='138'></font>
<font color=#447700>! communicator of tasks in the server group.<a name='139'></font>
<font color=#447700>!<a name='140'></font>
<font color=#447700>! Elements of MPI_COMM_IO_GROUPS are communicators that each contain one or <a name='141'></font>
<font color=#447700>! more compute tasks and a single I/O server assigned to those compute tasks.  <a name='142'></font>
<font color=#447700>! The I/O server tasks is always the last task in these communicators.  <a name='143'></font>
<font color=#447700>! On a compute task, which has a single associate in each of the server <a name='144'></font>
<font color=#447700>! groups, MPI_COMM_IO_GROUPS is treated as an array; each element corresponds <a name='145'></font>
<font color=#447700>! to a different server group. <a name='146'></font>
<font color=#447700>! On a server task only the first element of MPI_COMM_IO_GROUPS is used <a name='147'></font>
<font color=#447700>! because each server task is part of only one io_group.  <a name='148'></font>
<font color=#447700>!<a name='149'></font>
<font color=#447700>! I/O server tasks in each I/O server group are divided among compute tasks as <a name='150'></font>
<font color=#447700>! evenly as possible.  <a name='151'></font>
<font color=#447700>!<a name='152'></font>
<font color=#447700>! When multiple I/O server groups are used, each must have the same number of <a name='153'></font>
<font color=#447700>! tasks.  When the total number of extra I/O tasks does not divide evenly by <a name='154'></font>
<font color=#447700>! the number of io server groups requested, the remainder tasks are not used <a name='155'></font>
<font color=#447700>! (wasted).  <a name='156'></font>
<font color=#447700>!<a name='157'></font>
<font color=#447700>! For example, communicator membership for 18 tasks with nio_groups=2 and <a name='158'></font>
<font color=#447700>! nio_tasks_per_group=3 is shown below:  <a name='159'></font>
<font color=#447700>!<a name='160'></font>
<font color=#447700>! Membership for MPI_COMM_LOCAL communicators:<a name='161'></font>
<font color=#447700>!   COMPUTE TASKS:          0   1   2   3   4   5   6   7   8   9  10  11<a name='162'></font>
<font color=#447700>!   1ST I/O SERVER GROUP:  12  13  14<a name='163'></font>
<font color=#447700>!   2ND I/O SERVER GROUP:  15  16  17<a name='164'></font>
<font color=#447700>!<a name='165'></font>
<font color=#447700>! Membership for MPI_COMM_IO_GROUPS(1):  <a name='166'></font>
<font color=#447700>!   COMPUTE TASKS 0, 3, 6, 9:   0   3   6   9  12<a name='167'></font>
<font color=#447700>!   COMPUTE TASKS 1, 4, 7,10:   1   4   7  10  13<a name='168'></font>
<font color=#447700>!   COMPUTE TASKS 2, 5, 8,11:   2   5   8  11  14<a name='169'></font>
<font color=#447700>!   I/O SERVER TASK       12:   0   3   6   9  12<a name='170'></font>
<font color=#447700>!   I/O SERVER TASK       13:   1   4   7  10  13<a name='171'></font>
<font color=#447700>!   I/O SERVER TASK       14:   2   5   8  11  14<a name='172'></font>
<font color=#447700>!   I/O SERVER TASK       15:   0   3   6   9  15<a name='173'></font>
<font color=#447700>!   I/O SERVER TASK       16:   1   4   7  10  16<a name='174'></font>
<font color=#447700>!   I/O SERVER TASK       17:   2   5   8  11  17<a name='175'></font>
<font color=#447700>!<a name='176'></font>
<font color=#447700>! Membership for MPI_COMM_IO_GROUPS(2):  <a name='177'></font>
<font color=#447700>!   COMPUTE TASKS 0, 3, 6, 9:   0   3   6   9  15<a name='178'></font>
<font color=#447700>!   COMPUTE TASKS 1, 4, 7,10:   1   4   7  10  16<a name='179'></font>
<font color=#447700>!   COMPUTE TASKS 2, 5, 8,11:   2   5   8  11  17<a name='180'></font>
<font color=#447700>!   I/O SERVER TASK       12:  ** not used **<a name='181'></font>
<font color=#447700>!   I/O SERVER TASK       13:  ** not used **<a name='182'></font>
<font color=#447700>!   I/O SERVER TASK       14:  ** not used **<a name='183'></font>
<font color=#447700>!   I/O SERVER TASK       15:  ** not used **<a name='184'></font>
<font color=#447700>!   I/O SERVER TASK       16:  ** not used **<a name='185'></font>
<font color=#447700>!   I/O SERVER TASK       17:  ** not used **<a name='186'></font>
<font color=#447700>!<a name='187'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='188'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='189'></font>
      IMPLICIT NONE<a name='190'>
      INCLUDE 'mpif.h'<a name='191'>
      INTEGER,                      INTENT(IN)  :: nio_tasks_per_group, mytask, ntasks, &amp;<a name='192'>
                                                   n_groups_arg, mpi_comm_wrld<a name='193'>
      INTEGER,  INTENT(OUT)                     :: mpi_comm_local, nio<a name='194'>
      INTEGER, DIMENSION(100),      INTENT(OUT) :: mpi_comm_io_groups<a name='195'>
<font color=#447700>! Local<a name='196'></font>
      INTEGER                     :: i, j, ii, comdup, ierr, niotasks, n_groups<a name='197'>
      INTEGER, DIMENSION(ntasks)  :: icolor<a name='198'>
      CHARACTER*128 mess<a name='199'>
<a name='200'>
      n_groups = n_groups_arg<a name='201'>
      IF ( n_groups .LT. 1 ) n_groups = 1<a name='202'>
<a name='203'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='204'></font>
<font color=#447700>!&lt;PRE&gt;<a name='205'></font>
<font color=#447700>! nio is number of io tasks per group.  If there arent enough tasks to satisfy<a name='206'></font>
<font color=#447700>! the requirement that there be at least as many compute tasks as io tasks in<a name='207'></font>
<font color=#447700>! each group, then just print a warning and dump out of quilting<a name='208'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='209'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='210'></font>
<a name='211'>
      nio = nio_tasks_per_group<a name='212'>
      ncompute_tasks = ntasks - (nio * n_groups)<a name='213'>
      IF ( ncompute_tasks .LT. nio ) THEN <a name='214'>
        WRITE(mess,'("Not enough tasks to have ",I3," groups of ",I3," I/O tasks. No quilting.")')n_groups,nio<a name='215'>
        nio            = 0<a name='216'>
        ncompute_tasks = ntasks<a name='217'>
      ELSE                                   <a name='218'>
        WRITE(mess,'("Quilting with ",I3," groups of ",I3," I/O tasks.")')n_groups,nio<a name='219'>
      ENDIF                                   <a name='220'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#SETUP_QUILT_SERVERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_10">(mess)<a name='221'>
    <a name='222'>
      IF ( nio .LT. 0 ) THEN<a name='223'>
        nio = 0<a name='224'>
      ENDIF<a name='225'>
      IF ( nio .EQ. 0 ) THEN<a name='226'>
        quilting_enabled = .FALSE.<a name='227'>
        mpi_comm_local = MPI_COMM_WORLD<a name='228'>
        mpi_comm_io_groups = MPI_COMM_WORLD<a name='229'>
        RETURN<a name='230'>
      ENDIF<a name='231'>
      quilting_enabled = .TRUE.<a name='232'>
<a name='233'>
<font color=#447700>! First construct the local communicators<a name='234'></font>
<font color=#447700>! prepare to split the communicator by designating compute-only tasks<a name='235'></font>
      DO i = 1, ncompute_tasks<a name='236'>
        icolor(i) = 0<a name='237'>
      ENDDO<a name='238'>
      ii = 1<a name='239'>
<font color=#447700>! and designating the groups of i/o tasks<a name='240'></font>
      DO i = ncompute_tasks+1, ntasks, nio<a name='241'>
        DO j = i, i+nio-1<a name='242'>
          icolor(j) = ii<a name='243'>
        ENDDO<a name='244'>
        ii = ii+1<a name='245'>
      ENDDO<a name='246'>
      CALL MPI_Comm_dup(mpi_comm_wrld,comdup,ierr)<a name='247'>
      CALL MPI_Comm_split(comdup,icolor(mytask+1),mytask,mpi_comm_local,ierr)<a name='248'>
<a name='249'>
<font color=#447700>! Now construct the communicators for the io_groups; round-robining the compute tasks<a name='250'></font>
      DO i = 1, ncompute_tasks<a name='251'>
        icolor(i) = mod(i-1,nio)<a name='252'>
      ENDDO<a name='253'>
<font color=#447700>! ... and add the io servers as the last task in each group<a name='254'></font>
      DO j = 1, n_groups<a name='255'>
        <font color=#447700>! TBH:  each I/O group will contain only one I/O server<a name='256'></font>
        DO i = ncompute_tasks+1,ntasks<a name='257'>
          icolor(i) = MPI_UNDEFINED<a name='258'>
        ENDDO<a name='259'>
        ii = 0<a name='260'>
        DO i = ncompute_tasks+(j-1)*nio+1,ncompute_tasks+j*nio<a name='261'>
          icolor(i) = ii<a name='262'>
          ii = ii+1<a name='263'>
        ENDDO<a name='264'>
        CALL MPI_Comm_dup(mpi_comm_wrld,comdup,ierr)<a name='265'>
        CALL MPI_Comm_split(comdup,icolor(mytask+1),mytask,mpi_comm_io_groups(j),ierr)<a name='266'>
      ENDDO<a name='267'>
<font color=#447700>! If I am an I/O server, figure out which group I'm in and make that group's<a name='268'></font>
<font color=#447700>! communicator the first element in the mpi_comm_io_groups array (I will ignore<a name='269'></font>
<font color=#447700>! all of the other elements).<a name='270'></font>
      IF ( mytask+1 .GT. ncompute_tasks ) THEN<a name='271'>
        niotasks = ntasks - ncompute_tasks<a name='272'>
        i = mytask - ncompute_tasks<a name='273'>
        j = i / nio + 1<a name='274'>
        mpi_comm_io_groups(1) = mpi_comm_io_groups(j)<a name='275'>
      ENDIF<a name='276'>
<a name='277'>
    END SUBROUTINE setup_quilt_servers<a name='278'>
<a name='279'>
<A NAME='QUILT'><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='280'>
    <font color=#993300>SUBROUTINE </font><font color=#cc0000>quilt</font> <A href='../../call_to/QUILT.html' TARGET='index'>1</A>,<A href='../../call_from/QUILT.html' TARGET='index'>34</A><a name='281'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='282'></font>
<font color=#447700>!&lt;PRE&gt;<a name='283'></font>
<font color=#447700>! I/O server tasks call this routine and remain in it for the rest of the <a name='284'></font>
<font color=#447700>! model run.  I/O servers receive I/O requests from compute tasks and <a name='285'></font>
<font color=#447700>! perform requested I/O operations by calling package-dependent WRF-specific <a name='286'></font>
<font color=#447700>! I/O interfaces.  Requests are sent in the form of "data headers".  Each <a name='287'></font>
<font color=#447700>! request has a unique "header" message associated with it.  For requests that <a name='288'></font>
<font color=#447700>! contain large amounts of data, the data is appended to the header.  See <a name='289'></font>
<font color=#447700>! file module_internal_header_util.F for detailed descriptions of all <a name='290'></font>
<font color=#447700>! headers.  <a name='291'></font>
<font color=#447700>!<a name='292'></font>
<font color=#447700>! We wish to be able to link to different packages depending on whether<a name='293'></font>
<font color=#447700>! the I/O is restart, initial, history, or boundary.<a name='294'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='295'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='296'></font>
      USE module_state_description<a name='297'>
      USE <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#MODULE_QUILT_OUTBUF_OPS'>module_quilt_outbuf_ops</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_QUILT_OUTBUF_OPS_1"><a name='298'>
      IMPLICIT NONE<a name='299'>
      INCLUDE 'mpif.h'<a name='300'>
      INCLUDE 'intio_tags.h'<a name='301'>
      INCLUDE 'wrf_io_flags.h'<a name='302'>
      INTEGER itag, ninbuf, ntasks_io_group, ntasks_local_group, mytask_local, ierr<a name='303'>
      INTEGER istat<a name='304'>
      INTEGER mytask_io_group<a name='305'>
      INTEGER   :: nout_set = 0<a name='306'>
      INTEGER   :: obufsize, bigbufsize, inttypesize, chunksize, sz<a name='307'>
      REAL, DIMENSION(1)      :: dummy<a name='308'>
      INTEGER, ALLOCATABLE, DIMENSION(:) :: obuf, bigbuf<a name='309'>
      REAL,    ALLOCATABLE, DIMENSION(:) :: RDATA<a name='310'>
      INTEGER, ALLOCATABLE, DIMENSION(:) :: IDATA<a name='311'>
      CHARACTER (LEN=512) :: CDATA<a name='312'>
      CHARACTER (LEN=80) :: fname<a name='313'>
      INTEGER icurs, hdrbufsize, itypesize, ftypesize, Status, fstat, io_form_arg<a name='314'>
      INTEGER :: DataHandle, FieldType, Comm, IOComm, DomainDesc, code, Count<a name='315'>
      INTEGER, DIMENSION(3) :: DomainStart , DomainEnd , MemoryStart , MemoryEnd , PatchStart , PatchEnd<a name='316'>
      INTEGER :: dummybuf(1)<a name='317'>
      CHARACTER (len=80) :: DateStr , Element, VarName, MemoryOrder , Stagger , DimNames(3), FileName, SysDepInfo, mess<a name='318'>
      INTEGER, EXTERNAL :: use_package<a name='319'>
      LOGICAL           :: stored_write_record, retval<a name='320'>
      INTEGER iii, jjj, vid<a name='321'>
<a name='322'>
<font color=#447700>!<a name='323'></font>
<a name='324'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='325'></font>
<font color=#447700>!&lt;PRE&gt;<a name='326'></font>
<font color=#447700>! Call ext_pkg_ioinit() routines to initialize I/O packages.  <a name='327'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='328'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='329'></font>
      SysDepInfo = " "<a name='330'>
#ifdef NETCDF<a name='331'>
      CALL ext_ncd_ioinit( SysDepInfo, ierr)<a name='332'>
#endif<a name='333'>
#ifdef INTIO<a name='334'>
      CALL ext_int_ioinit( SysDepInfo, ierr )<a name='335'>
#endif<a name='336'>
#ifdef XXX<a name='337'>
      CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOINIT'>ext_xxx_ioinit</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOINIT_2">( SysDepInfo, ierr)<a name='338'>
#endif<a name='339'>
#ifdef YYY<a name='340'>
      CALL ext_yyy_ioinit( SysDepInfo, ierr)<a name='341'>
#endif<a name='342'>
#ifdef ZZZ<a name='343'>
      CALL ext_zzz_ioinit( SysDepInfo, ierr)<a name='344'>
#endif<a name='345'>
<a name='346'>
      okay_to_commit = .false.<a name='347'>
      stored_write_record = .false.<a name='348'>
      ninbuf = 0<a name='349'>
      <font color=#447700>! get info. about the I/O server group that this I/O server task<a name='350'></font>
      <font color=#447700>! belongs to<a name='351'></font>
      <font color=#447700>! Last task in this I/O server group is the I/O server "root"<a name='352'></font>
      <font color=#447700>! The I/O server "root" actually writes data to disk<a name='353'></font>
      <font color=#447700>! TBH:  WARNING:  This is also implicit in the call to collect_on_comm().<a name='354'></font>
      CALL mpi_x_comm_size( mpi_comm_io_groups(1), ntasks_io_group,    ierr )<a name='355'>
      CALL MPI_COMM_RANK( mpi_comm_io_groups(1), mytask_io_group,    ierr )<a name='356'>
      CALL mpi_x_comm_size( mpi_comm_local,        ntasks_local_group, ierr )<a name='357'>
      CALL MPI_COMM_RANK( mpi_comm_local,        mytask_local,       ierr )<a name='358'>
<a name='359'>
      CALL MPI_TYPE_SIZE( MPI_INTEGER, inttypesize, ierr )<a name='360'>
      IF ( inttypesize &lt;= 0 ) THEN<a name='361'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_103">("external/RSL/module_dm.F: quilt: type size &lt;= 0 invalid")<a name='362'>
      ENDIF<a name='363'>
<font color=#447700>! infinite loop until shutdown message received<a name='364'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='365'></font>
<font color=#447700>!&lt;PRE&gt;<a name='366'></font>
<font color=#447700>! This is the main request-handling loop.  I/O quilt servers stay in this loop <a name='367'></font>
<font color=#447700>! until the model run ends.  <a name='368'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='369'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='370'></font>
      DO WHILE (.TRUE.)<a name='371'>
<a name='372'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='373'></font>
<font color=#447700>!&lt;PRE&gt;<a name='374'></font>
<font color=#447700>! Each I/O server receives requests from its compute tasks.  Each request<a name='375'></font>
<font color=#447700>! is contained in a data header (see module_internal_header_util.F for<a name='376'></font>
<font color=#447700>! detailed descriptions of data headers).<a name='377'></font>
<font color=#447700>! Each request is sent in two phases.  First, sizes of all messages that <a name='378'></font>
<font color=#447700>! will be sent from the compute tasks to this I/O server are summed on the <a name='379'></font>
<font color=#447700>! I/O server via MPI_reduce().  The I/O server then allocates buffer "obuf" <a name='380'></font>
<font color=#447700>! and receives concatenated messages from the compute tasks in it via the <a name='381'></font>
<font color=#447700>! call to collect_on_comm().  Note that "sizes" are generally expressed in <a name='382'></font>
<font color=#447700>! *bytes* in this code so conversion to "count" (number of Fortran words) is <a name='383'></font>
<font color=#447700>! required for Fortran indexing and MPI calls.  <a name='384'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='385'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='386'></font>
        <font color=#447700>! wait for info from compute tasks in the I/O group that we're ready to rock<a name='387'></font>
        <font color=#447700>! obufsize will contain number of *bytes*<a name='388'></font>
        CALL MPI_Reduce( ninbuf, obufsize, 1, MPI_INTEGER,  &amp;<a name='389'>
                         MPI_SUM, mytask_io_group,          &amp;<a name='390'>
                         mpi_comm_io_groups(1), ierr )<a name='391'>
<font color=#447700>!write(0,*)'ninbuf ',ninbuf,' obufsize ', obufsize<a name='392'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='393'></font>
<font color=#447700>!&lt;PRE&gt;<a name='394'></font>
<font color=#447700>! Negative obufsize will trigger I/O server exit.  <a name='395'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='396'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='397'></font>
        IF ( obufsize .LT. 0 ) THEN<a name='398'>
#ifdef NETCDF<a name='399'>
          CALL ext_ncd_ioexit( Status )<a name='400'>
#endif<a name='401'>
#ifdef INTIO<a name='402'>
          CALL ext_int_ioexit( Status )<a name='403'>
#endif<a name='404'>
#ifdef XXX<a name='405'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOEXIT'>ext_xxx_ioexit</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOEXIT_2">( Status )<a name='406'>
#endif<a name='407'>
#ifdef YYY<a name='408'>
          CALL ext_yyy_ioexit( Status )<a name='409'>
#endif<a name='410'>
#ifdef ZZZ<a name='411'>
          CALL ext_zzz_ioexit( Status )<a name='412'>
#endif<a name='413'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_11"> ( 'I/O QUILT SERVERS DONE' )<a name='414'>
          CALL mpi_finalize(ierr)<a name='415'>
          STOP<a name='416'>
        ENDIF<a name='417'>
<a name='418'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='419'></font>
<font color=#447700>!&lt;PRE&gt;<a name='420'></font>
<font color=#447700>! Allocate buffer obuf to be big enough for the data the compute tasks<a name='421'></font>
<font color=#447700>! will send.  Note: obuf is size in *bytes* so we need to pare this <a name='422'></font>
<font color=#447700>! down, since the buffer is INTEGER.  <a name='423'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='424'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='425'></font>
<font color=#447700>!write(0,*)'allocating obuf: ',(obufsize+1)/inttypesize<a name='426'></font>
        ALLOCATE( obuf( (obufsize+1)/inttypesize ) )<a name='427'>
<a name='428'>
<font color=#447700>!call mpi_comm_size( mpi_comm_io_groups(1), iii, ierr )<a name='429'></font>
<font color=#447700>!write(0,*)'mpi_comm_size mpi_comm_io_groups() ',iii<a name='430'></font>
<font color=#447700>!call mpi_comm_rank( mpi_comm_io_groups(1), iii, ierr )<a name='431'></font>
<font color=#447700>!write(0,*)'mpi_comm_rank mpi_comm_io_groups() ',iii<a name='432'></font>
<a name='433'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='434'></font>
<font color=#447700>!&lt;PRE&gt;<a name='435'></font>
<font color=#447700>! let's roll; get the data from the compute procs and put in obuf<a name='436'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='437'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='438'></font>
        CALL collect_on_comm( mpi_comm_io_groups(1),        &amp;<a name='439'>
                              onebyte,                      &amp;<a name='440'>
                              dummy, 0,                     &amp;<a name='441'>
                              obuf, obufsize )<a name='442'>
<a name='443'>
<font color=#447700>!write(0,*)'calling init_store_piece_of_field'<a name='444'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='445'></font>
<font color=#447700>!&lt;PRE&gt;<a name='446'></font>
<font color=#447700>! Now all messages received from the compute clients are stored in <a name='447'></font>
<font color=#447700>! obuf.  Scan through obuf and extract headers and field data and store in <a name='448'></font>
<font color=#447700>! internal buffers.  The scan is done twice, first to determine sizes of <a name='449'></font>
<font color=#447700>! internal buffers required for storage of headers and fields and second to <a name='450'></font>
<font color=#447700>! actually store the headers and fields.  This bit of code does not do the <a name='451'></font>
<font color=#447700>! "quilting" (assembly of patches into full domains).  For each field, it <a name='452'></font>
<font color=#447700>! simply concatenates all received patches for the field into a separate <a name='453'></font>
<font color=#447700>! internal buffer (i.e. one buffer per field).  Quilting is done later by <a name='454'></font>
<font color=#447700>! routine store_patch_in_outbuf().  <a name='455'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='456'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='457'></font>
        CALL init_store_piece_of_field<a name='458'>
        CALL mpi_type_size ( MPI_INTEGER , itypesize , ierr )<a name='459'>
<font color=#447700>!write(0,*)'mpi_type_size returns ', itypesize<a name='460'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='461'></font>
<font color=#447700>!&lt;PRE&gt;<a name='462'></font>
<font color=#447700>! Scan obuf the first time to calculate the size of the buffer required for <a name='463'></font>
<font color=#447700>! each field.  Calls to add_to_bufsize_for_field() accumulate sizes.  <a name='464'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='465'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='466'></font>
        vid = 0<a name='467'>
        icurs = inttypesize<a name='468'>
        DO WHILE ( icurs .lt. obufsize )<a name='469'>
          SELECT CASE ( get_hdr_tag( obuf ( icurs / inttypesize ) ) )<a name='470'>
            CASE ( int_field )<a name='471'>
              CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_WRITE_FIELD_HEADER'>int_get_write_field_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_WRITE_FIELD_HEADER_1"> ( obuf(icurs/inttypesize), hdrbufsize, itypesize, ftypesize,  &amp;<a name='472'>
                                                DataHandle , DateStr , VarName , Dummy , FieldType , Comm , IOComm, &amp;<a name='473'>
                                                DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='474'>
                                                DomainStart , DomainEnd ,                                    &amp;<a name='475'>
                                                MemoryStart , MemoryEnd ,                                    &amp;<a name='476'>
                                                PatchStart , PatchEnd )<a name='477'>
              chunksize = (PatchEnd(1)-PatchStart(1)+1)*(PatchEnd(2)-PatchStart(2)+1)* &amp;<a name='478'>
                          (PatchEnd(3)-PatchStart(3)+1)*ftypesize<a name='479'>
<a name='480'>
<font color=#447700>!write(0,*) 'X-1', hdrbufsize, get_hdr_tag( obuf ( icurs / inttypesize ) ) , get_hdr_rec_size( obuf ( icurs / inttypesize ) ), TRIM(VarName)<a name='481'></font>
              call <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#ADD_TO_BUFSIZE_FOR_FIELD'>add_to_bufsize_for_field</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_TO_BUFSIZE_FOR_FIELD_1">( VarName, hdrbufsize )<a name='482'>
              icurs = icurs + hdrbufsize<a name='483'>
              <font color=#447700>! If this is a real write (i.e. not a training write), accumulate<a name='484'></font>
              <font color=#447700>! buffersize for this field.<a name='485'></font>
              IF ( DomainDesc .NE. 333933 ) THEN   <font color=#447700>! magic number<a name='486'></font>
<font color=#447700>!write(0,*) 'X-1a', chunksize, TRIM(VarName)<a name='487'></font>
                call <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#ADD_TO_BUFSIZE_FOR_FIELD'>add_to_bufsize_for_field</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_TO_BUFSIZE_FOR_FIELD_2">( VarName, chunksize )<a name='488'>
                icurs = icurs + chunksize<a name='489'>
              ENDIF<a name='490'>
            CASE DEFAULT<a name='491'>
              hdrbufsize = obuf(icurs/inttypesize)<a name='492'>
              write(VarName,'(I5.5)')vid <a name='493'>
<font color=#447700>!write(0,*) 'X-2', hdrbufsize, get_hdr_tag( obuf ( icurs / inttypesize ) ) , get_hdr_rec_size( obuf ( icurs / inttypesize ) ), TRIM(VarName)<a name='494'></font>
              call <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#ADD_TO_BUFSIZE_FOR_FIELD'>add_to_bufsize_for_field</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_TO_BUFSIZE_FOR_FIELD_3">( VarName, hdrbufsize )<a name='495'>
              icurs = icurs + hdrbufsize<a name='496'>
              vid = vid+1<a name='497'>
          END SELECT<a name='498'>
        ENDDO<a name='499'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='500'></font>
<font color=#447700>!&lt;PRE&gt;<a name='501'></font>
<font color=#447700>! Store the headers and field data in internal buffers.  The first call to <a name='502'></font>
<font color=#447700>! store_piece_of_field() allocates internal buffers using sizes computed by <a name='503'></font>
<font color=#447700>! calls to add_to_bufsize_for_field().  <a name='504'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='505'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='506'></font>
        vid = 0<a name='507'>
        icurs = inttypesize<a name='508'>
        DO WHILE ( icurs .lt. obufsize )<a name='509'>
<font color=#447700>!write(0,*) 'A icurs ', icurs, ' obufsize ', obufsize<a name='510'></font>
          SELECT CASE ( get_hdr_tag( obuf ( icurs / inttypesize ) ) )<a name='511'>
            CASE ( int_field )<a name='512'>
              CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_WRITE_FIELD_HEADER'>int_get_write_field_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_WRITE_FIELD_HEADER_2"> ( obuf(icurs/inttypesize), hdrbufsize, itypesize, ftypesize,  &amp;<a name='513'>
                                                DataHandle , DateStr , VarName , Dummy , FieldType , Comm , IOComm, &amp;<a name='514'>
                                                DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='515'>
                                                DomainStart , DomainEnd ,                                    &amp;<a name='516'>
                                                MemoryStart , MemoryEnd ,                                    &amp;<a name='517'>
                                                PatchStart , PatchEnd )<a name='518'>
              chunksize = (PatchEnd(1)-PatchStart(1)+1)*(PatchEnd(2)-PatchStart(2)+1)* &amp;<a name='519'>
                          (PatchEnd(3)-PatchStart(3)+1)*ftypesize<a name='520'>
<a name='521'>
<a name='522'>
              call <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#STORE_PIECE_OF_FIELD'>store_piece_of_field</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STORE_PIECE_OF_FIELD_1">( obuf(icurs/inttypesize), VarName, hdrbufsize )<a name='523'>
<font color=#447700>!write(0,*) 'A-1', hdrbufsize, get_hdr_tag( obuf ( icurs / inttypesize ) ) , get_hdr_rec_size( obuf ( icurs / inttypesize ) ), TRIM(VarName)<a name='524'></font>
              icurs = icurs + hdrbufsize<a name='525'>
              <font color=#447700>! If this is a real write (i.e. not a training write), store<a name='526'></font>
              <font color=#447700>! this piece of this field.<a name='527'></font>
              IF ( DomainDesc .NE. 333933 ) THEN   <font color=#447700>! magic number<a name='528'></font>
<font color=#447700>!write(0,*) 'A-1a', chunksize, TRIM(VarName)<a name='529'></font>
                call <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#STORE_PIECE_OF_FIELD'>store_piece_of_field</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STORE_PIECE_OF_FIELD_2">( obuf(icurs/inttypesize), VarName, chunksize )<a name='530'>
                icurs = icurs + chunksize<a name='531'>
              ENDIF<a name='532'>
            CASE DEFAULT<a name='533'>
              hdrbufsize = obuf(icurs/inttypesize)<a name='534'>
              write(VarName,'(I5.5)')vid <a name='535'>
              call <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#STORE_PIECE_OF_FIELD'>store_piece_of_field</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STORE_PIECE_OF_FIELD_3">( obuf(icurs/inttypesize), VarName, hdrbufsize )<a name='536'>
<font color=#447700>!write(0,*) 'A-2', hdrbufsize, get_hdr_tag( obuf ( icurs / inttypesize ) ) , get_hdr_rec_size( obuf ( icurs / inttypesize ) ), TRIM(VarName)<a name='537'></font>
              icurs = icurs + hdrbufsize<a name='538'>
              vid = vid+1<a name='539'>
          END SELECT<a name='540'>
        ENDDO<a name='541'>
<a name='542'>
<font color=#447700>!call mpi_comm_size( mpi_comm_local, iii, ierr )<a name='543'></font>
<font color=#447700>!write(0,*)'mpi_comm_size mpi_comm_local ',iii<a name='544'></font>
<font color=#447700>!call mpi_comm_rank( mpi_comm_local, iii, ierr )<a name='545'></font>
<font color=#447700>!write(0,*)'mpi_comm_rank mpi_comm_local ',iii<a name='546'></font>
<a name='547'>
<font color=#447700>!write(0,*)'calling init_retrieve_pieces_of_field '<a name='548'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='549'></font>
<font color=#447700>!&lt;PRE&gt;<a name='550'></font>
<font color=#447700>! Now, for each field, retrieve headers and patches (data) from the internal <a name='551'></font>
<font color=#447700>! buffers and collect them all on the I/O quilt server "root" task.<a name='552'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='553'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='554'></font>
        CALL init_retrieve_pieces_of_field<a name='555'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='556'></font>
<font color=#447700>!&lt;PRE&gt;<a name='557'></font>
<font color=#447700>! Retrieve header and all patches for the first field from the internal <a name='558'></font>
<font color=#447700>! buffers.  <a name='559'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='560'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='561'></font>
        CALL <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#RETRIEVE_PIECES_OF_FIELD'>retrieve_pieces_of_field</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_PIECES_OF_FIELD_1"> ( obuf , VarName, obufsize, sz, retval )<a name='562'>
<font color=#447700>!write(0,*)'calling first retrieve_pieces_of_field ',TRIM(VarName),obufsize,sz,retval<a name='563'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='564'></font>
<font color=#447700>!&lt;PRE&gt;<a name='565'></font>
<font color=#447700>! Sum sizes of all headers and patches (data) for this field from all I/O <a name='566'></font>
<font color=#447700>! servers in this I/O server group onto the I/O server "root".<a name='567'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='568'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='569'></font>
        CALL MPI_Reduce( sz, bigbufsize, 1, MPI_INTEGER,  &amp;<a name='570'>
                         MPI_SUM, ntasks_local_group-1,         &amp;<a name='571'>
                         mpi_comm_local, ierr )<a name='572'>
<font color=#447700>!write(0,*)'after MPI_Reduce ',sz, bigbufsize<a name='573'></font>
<a name='574'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='575'></font>
<font color=#447700>!&lt;PRE&gt;<a name='576'></font>
<font color=#447700>! Loop until there are no more fields to retrieve from the internal buffers.<a name='577'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='578'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='579'></font>
        DO WHILE ( retval )<a name='580'>
<a name='581'>
<font color=#447700>!write(0,*)' VarName ',TRIM(VarName),' sz ',sz,' bigbufsize ',bigbufsize<a name='582'></font>
<a name='583'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='584'></font>
<font color=#447700>!&lt;PRE&gt;<a name='585'></font>
<font color=#447700>! I/O server "root" allocates space to collect headers and fields from all<a name='586'></font>
<font color=#447700>! other servers in this I/O server group.<a name='587'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='588'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='589'></font>
          IF ( mytask_local .EQ. ntasks_local_group-1 ) THEN<a name='590'>
<font color=#447700>!write(0,*)'allocating bufbuf ', (bigbufsize+1)/inttypesize<a name='591'></font>
            ALLOCATE( bigbuf( (bigbufsize+1)/inttypesize ) )<a name='592'>
          ENDIF<a name='593'>
<a name='594'>
<font color=#447700>!write(0,*)'before collect_on_comm tag,size ',Trim(VarName),get_hdr_tag(obuf),get_hdr_rec_size(obuf)<a name='595'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='596'></font>
<font color=#447700>!&lt;PRE&gt;<a name='597'></font>
<font color=#447700>! Collect buffers and fields from all I/O servers in this I/O server group<a name='598'></font>
<font color=#447700>! onto the I/O server "root"<a name='599'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='600'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='601'></font>
          CALL collect_on_comm( mpi_comm_local,                    &amp;<a name='602'>
                                onebyte,                           &amp;<a name='603'>
                                obuf, sz,  &amp;<a name='604'>
                                bigbuf, bigbufsize )<a name='605'>
<font color=#447700>!write(0,*)'after collect_on_comm ', sz, bigbufsize<a name='606'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='607'></font>
<font color=#447700>!&lt;PRE&gt;<a name='608'></font>
<font color=#447700>! The I/O server "root" now handles collected requests from all compute <a name='609'></font>
<font color=#447700>! tasks served by this I/O server group (i.e. all compute tasks).  <a name='610'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='611'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='612'></font>
          IF ( mytask_local .EQ. ntasks_local_group-1 ) THEN<a name='613'>
<font color=#447700>!jjj = 4<a name='614'></font>
<font color=#447700>!do iii = 1, ntasks_local_group<a name='615'></font>
<font color=#447700>!  write(0,*)'i,j,tag,size ', iii, jjj, get_hdr_tag(bigbuf(jjj/4)),get_hdr_rec_size(bigbuf(jjj/4))<a name='616'></font>
<font color=#447700>!  jjj = jjj + get_hdr_rec_size(bigbuf(jjj/4))<a name='617'></font>
<font color=#447700>!enddo<a name='618'></font>
<a name='619'>
            icurs = inttypesize  <font color=#447700>! icurs is a byte counter, but buffer is integer<a name='620'></font>
<a name='621'>
            stored_write_record = .false.<a name='622'>
<a name='623'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='624'></font>
<font color=#447700>!&lt;PRE&gt;<a name='625'></font>
<font color=#447700>! The I/O server "root" loops over the collected requests.  <a name='626'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='627'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='628'></font>
            DO WHILE ( icurs .lt. bigbufsize )<a name='629'>
              CALL mpi_type_size ( MPI_INTEGER , itypesize , ierr )<a name='630'>
<a name='631'>
<font color=#447700>!write(0,*)'B tag,size ',icurs,get_hdr_tag( bigbuf(icurs/inttypesize) ),get_hdr_rec_size( bigbuf(icurs/inttypesize) )<a name='632'></font>
<font color=#447700>!write(0,*)'   inttypesize ',inttypesize,' itypesize ',itypesize,' icurs/inttypesize ',icurs/inttypesize<a name='633'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='634'></font>
<font color=#447700>!&lt;PRE&gt;<a name='635'></font>
<font color=#447700>! The I/O server "root" gets the request out of the next header and<a name='636'></font>
<font color=#447700>! handles it by, in most cases, calling the appropriate external I/O package<a name='637'></font>
<font color=#447700>! interface.<a name='638'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='639'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='640'></font>
              SELECT CASE ( get_hdr_tag( bigbuf(icurs/inttypesize) ) )<a name='641'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='642'></font>
<font color=#447700>!&lt;PRE&gt;<a name='643'></font>
<font color=#447700>! The I/O server "root" handles the "noop" (do nothing) request.  This is <a name='644'></font>
<font color=#447700>! actually quite easy.  "Noop" requests exist to help avoid race conditions.  <a name='645'></font>
<font color=#447700>! In some cases, only one compute task will everything about a request so <a name='646'></font>
<font color=#447700>! other compute tasks send "noop" requests.  <a name='647'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='648'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='649'></font>
                CASE ( int_noop )<a name='650'>
<font color=#447700>!write(0,*)' int_noop '<a name='651'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_NOOP_HEADER'>int_get_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_NOOP_HEADER_1">( bigbuf(icurs/inttypesize), hdrbufsize, itypesize )<a name='652'>
                  icurs = icurs + hdrbufsize<a name='653'>
<a name='654'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='655'></font>
<font color=#447700>!&lt;PRE&gt;<a name='656'></font>
<font color=#447700>! The I/O server "root" handles the "put_dom_td_real" request.<a name='657'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='658'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='659'></font>
                CASE ( int_dom_td_real )<a name='660'>
<font color=#447700>!write(0,*)' int_dom_td_real '<a name='661'></font>
                  CALL mpi_type_size( MPI_REAL, ftypesize, ierr )<a name='662'>
                  ALLOCATE( RData( bigbuf(icurs/inttypesize + 4 ) ) )      <font color=#447700>! 5 is the count of data items for this record ; defined in collect_on_comm.c<a name='663'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TD_HEADER'>int_get_td_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TD_HEADER_1">( bigbuf(icurs/inttypesize:), hdrbufsize, inttypesize, ftypesize, &amp;<a name='664'>
                                          DataHandle, DateStr, Element, RData, Count, code )<a name='665'>
                  icurs = icurs + hdrbufsize<a name='666'>
<a name='667'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='668'>
#ifdef NETCDF<a name='669'>
                    CASE ( IO_NETCDF   )<a name='670'>
                      CALL ext_ncd_put_dom_td_real( handle(DataHandle),TRIM(Element),TRIM(DateStr),RData, Count, Status )<a name='671'>
#endif<a name='672'>
#ifdef INTIO<a name='673'>
                    CASE ( IO_INTIO   )<a name='674'>
                      CALL ext_int_put_dom_td_real( handle(DataHandle),TRIM(Element),TRIM(DateStr),RData, Count, Status )<a name='675'>
#endif<a name='676'>
#ifdef YYY<a name='677'>
                 CASE ( IO_YYY )<a name='678'>
                    CALL ext_yyy_put_dom_td_real( handle(DataHandle),TRIM(Element),TRIM(DateStr),RData, Count, Status )<a name='679'>
#endif<a name='680'>
                    CASE DEFAULT<a name='681'>
                      Status = 0<a name='682'>
                  END SELECT<a name='683'>
<a name='684'>
                  DEALLOCATE( RData )<a name='685'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='686'></font>
<font color=#447700>!&lt;PRE&gt;<a name='687'></font>
<font color=#447700>! The I/O server "root" handles the "put_dom_ti_real" request.<a name='688'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='689'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='690'></font>
                CASE ( int_dom_ti_real )<a name='691'>
<font color=#447700>!write(0,*)' int_dom_ti_real '<a name='692'></font>
                  CALL mpi_type_size( MPI_REAL, ftypesize, ierr )<a name='693'>
                  ALLOCATE( RData( bigbuf(icurs/inttypesize + 4 ) ) )      <font color=#447700>! 5 is the count of data items for this record ; defined in collect_on_comm.c<a name='694'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TI_HEADER'>int_get_ti_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TI_HEADER_1">( bigbuf(icurs/inttypesize:), hdrbufsize, inttypesize, ftypesize, &amp;<a name='695'>
                                          DataHandle, Element, RData, Count, code )<a name='696'>
                  icurs = icurs + hdrbufsize<a name='697'>
<a name='698'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='699'>
#ifdef NETCDF<a name='700'>
                    CASE ( IO_NETCDF   )<a name='701'>
                      CALL ext_ncd_put_dom_ti_real( handle(DataHandle),TRIM(Element), RData, Count, Status )<a name='702'>
<font color=#447700>!write(0,*)'ext_ncd_put_dom_ti_real ',handle(DataHandle),TRIM(Element),RData,Status<a name='703'></font>
#endif<a name='704'>
#ifdef INTIO<a name='705'>
                    CASE ( IO_INTIO   )<a name='706'>
                      CALL ext_int_put_dom_ti_real( handle(DataHandle),TRIM(Element), RData, Count, Status )<a name='707'>
#endif<a name='708'>
#ifdef YYY<a name='709'>
                 CASE ( IO_YYY )<a name='710'>
                    CALL ext_yyy_put_dom_ti_real( handle(DataHandle),TRIM(Element), RData, Count, Status )<a name='711'>
#endif<a name='712'>
                    CASE DEFAULT<a name='713'>
                      Status = 0<a name='714'>
                  END SELECT<a name='715'>
<a name='716'>
                  DEALLOCATE( RData )<a name='717'>
<a name='718'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='719'></font>
<font color=#447700>!&lt;PRE&gt;<a name='720'></font>
<font color=#447700>! The I/O server "root" handles the "put_dom_td_integer" request.<a name='721'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='722'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='723'></font>
                CASE ( int_dom_td_integer )<a name='724'>
<font color=#447700>!write(0,*)' int_dom_td_integer '<a name='725'></font>
                  CALL mpi_type_size( MPI_INTEGER, ftypesize, ierr )<a name='726'>
                  ALLOCATE( IData( bigbuf(icurs/inttypesize + 4 ) ) )      <font color=#447700>! 5 is the count of data items for this record ; defined in collect_on_comm.c<a name='727'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TD_HEADER'>int_get_td_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TD_HEADER_2">( bigbuf(icurs/inttypesize:), hdrbufsize, inttypesize, ftypesize, &amp;<a name='728'>
                                          DataHandle, DateStr, Element, IData, Count, code )<a name='729'>
                  icurs = icurs + hdrbufsize<a name='730'>
<a name='731'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='732'>
#ifdef NETCDF<a name='733'>
                    CASE ( IO_NETCDF   )<a name='734'>
                      CALL ext_ncd_put_dom_td_integer( handle(DataHandle),TRIM(Element), Trim(DateStr), IData, Count, Status )<a name='735'>
#endif<a name='736'>
#ifdef INTIO<a name='737'>
                    CASE ( IO_INTIO   )<a name='738'>
                      CALL ext_int_put_dom_td_integer( handle(DataHandle),TRIM(Element), Trim(DateStr), IData, Count, Status )<a name='739'>
#endif<a name='740'>
#ifdef YYY<a name='741'>
                 CASE ( IO_YYY )<a name='742'>
                    CALL ext_yyy_put_dom_td_integer( handle(DataHandle),TRIM(Element), Trim(DateStr), IData, Count, Status )<a name='743'>
#endif<a name='744'>
                    CASE DEFAULT<a name='745'>
                      Status = 0<a name='746'>
                  END SELECT<a name='747'>
<a name='748'>
                  DEALLOCATE( IData )<a name='749'>
<a name='750'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='751'></font>
<font color=#447700>!&lt;PRE&gt;<a name='752'></font>
<font color=#447700>! The I/O server "root" handles the "put_dom_ti_integer" request.<a name='753'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='754'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='755'></font>
                CASE ( int_dom_ti_integer )<a name='756'>
<font color=#447700>!write(0,*)' int_dom_ti_integer '<a name='757'></font>
<a name='758'>
                  CALL mpi_type_size( MPI_INTEGER, ftypesize, ierr )<a name='759'>
                  ALLOCATE( IData( bigbuf(icurs/inttypesize + 4 ) ) )      <font color=#447700>! 5 is the count of data items for this record ; defined in collect_on_comm.c<a name='760'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TI_HEADER'>int_get_ti_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TI_HEADER_2">( bigbuf(icurs/inttypesize:), hdrbufsize, inttypesize, ftypesize, &amp;<a name='761'>
                                          DataHandle, Element, IData, Count, code )<a name='762'>
                  icurs = icurs + hdrbufsize<a name='763'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='764'>
#ifdef NETCDF<a name='765'>
                    CASE ( IO_NETCDF   )<a name='766'>
                      CALL ext_ncd_put_dom_ti_integer( handle(DataHandle),TRIM(Element), IData, Count, Status )<a name='767'>
<font color=#447700>!write(0,*)'ext_ncd_put_dom_ti_integer ',handle(DataHandle),TRIM(Element),IData,Status<a name='768'></font>
#endif<a name='769'>
#ifdef INTIO<a name='770'>
                    CASE ( IO_INTIO   )<a name='771'>
                      CALL ext_int_put_dom_ti_integer( handle(DataHandle),TRIM(Element), IData, Count, Status )<a name='772'>
#endif<a name='773'>
#ifdef YYY<a name='774'>
                 CASE ( IO_YYY )<a name='775'>
                    CALL ext_yyy_put_dom_ti_integer( handle(DataHandle),TRIM(Element), IData, Count, Status )<a name='776'>
#endif<a name='777'>
<a name='778'>
                    CASE DEFAULT<a name='779'>
                      Status = 0<a name='780'>
                  END SELECT<a name='781'>
<a name='782'>
                  DEALLOCATE( IData)<a name='783'>
 <a name='784'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='785'></font>
<font color=#447700>!&lt;PRE&gt;<a name='786'></font>
<font color=#447700>! The I/O server "root" handles the "set_time" request.<a name='787'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='788'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='789'></font>
                CASE ( int_set_time )<a name='790'>
<font color=#447700>!write(0,*)' int_set_time '<a name='791'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TI_HEADER_CHAR'>int_get_ti_header_char</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TI_HEADER_CHAR_1">( bigbuf(icurs/inttypesize), hdrbufsize, inttypesize, &amp;<a name='792'>
                                               DataHandle, Element, VarName, CData, code )<a name='793'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='794'>
#ifdef INTIO<a name='795'>
                    CASE ( IO_INTIO   )<a name='796'>
                      CALL ext_int_set_time ( handle(DataHandle), TRIM(CData), Status)<a name='797'>
#endif<a name='798'>
                    CASE DEFAULT<a name='799'>
                      Status = 0<a name='800'>
                  END SELECT<a name='801'>
<a name='802'>
                  icurs = icurs + hdrbufsize<a name='803'>
<a name='804'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='805'></font>
<font color=#447700>!&lt;PRE&gt;<a name='806'></font>
<font color=#447700>! The I/O server "root" handles the "put_dom_ti_char" request.<a name='807'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='808'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='809'></font>
                CASE ( int_dom_ti_char )<a name='810'>
<font color=#447700>!write(0,*)' int_dom_ti_char '<a name='811'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TI_HEADER_CHAR'>int_get_ti_header_char</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TI_HEADER_CHAR_2">( bigbuf(icurs/inttypesize), hdrbufsize, inttypesize, &amp;<a name='812'>
                                               DataHandle, Element, VarName, CData, code )<a name='813'>
<a name='814'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='815'>
#ifdef NETCDF<a name='816'>
                    CASE ( IO_NETCDF   )<a name='817'>
                      CALL ext_ncd_put_dom_ti_char ( handle(DataHandle), TRIM(Element), TRIM(CData), Status)<a name='818'>
#endif<a name='819'>
#ifdef INTIO<a name='820'>
                    CASE ( IO_INTIO   )<a name='821'>
                      CALL ext_int_put_dom_ti_char ( handle(DataHandle), TRIM(Element), TRIM(CData), Status)<a name='822'>
#endif<a name='823'>
#ifdef YYY<a name='824'>
                 CASE ( IO_YYY )<a name='825'>
                    CALL ext_yyy_put_dom_ti_char ( handle(DataHandle), TRIM(Element), TRIM(CData), Status)<a name='826'>
#endif<a name='827'>
                    CASE DEFAULT<a name='828'>
                      Status = 0<a name='829'>
                  END SELECT<a name='830'>
<a name='831'>
                  icurs = icurs + hdrbufsize<a name='832'>
<a name='833'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='834'></font>
<font color=#447700>!&lt;PRE&gt;<a name='835'></font>
<font color=#447700>! The I/O server "root" handles the "put_var_ti_char" request.<a name='836'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='837'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='838'></font>
                CASE ( int_var_ti_char )<a name='839'>
<font color=#447700>!write(0,*)' int_var_ti_char '<a name='840'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TI_HEADER_CHAR'>int_get_ti_header_char</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TI_HEADER_CHAR_3">( bigbuf(icurs/inttypesize), hdrbufsize, inttypesize, &amp;<a name='841'>
                                               DataHandle, Element, VarName, CData, code )<a name='842'>
<a name='843'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='844'>
#ifdef NETCDF<a name='845'>
                    CASE ( IO_NETCDF   )<a name='846'>
                      CALL ext_ncd_put_var_ti_char ( handle(DataHandle), TRIM(Element), TRIM(VarName), TRIM(CData), Status)<a name='847'>
#endif<a name='848'>
#ifdef INTIO<a name='849'>
                    CASE ( IO_INTIO   )<a name='850'>
                      CALL ext_int_put_var_ti_char ( handle(DataHandle), TRIM(Element), TRIM(VarName), TRIM(CData), Status)<a name='851'>
#endif<a name='852'>
#ifdef YYY<a name='853'>
                 CASE ( IO_YYY )<a name='854'>
                    CALL ext_yyy_put_var_ti_char ( handle(DataHandle), TRIM(Element), TRIM(VarName), TRIM(CData), Status)<a name='855'>
#endif<a name='856'>
                    CASE DEFAULT<a name='857'>
                      Status = 0<a name='858'>
                  END SELECT<a name='859'>
<a name='860'>
                  icurs = icurs + hdrbufsize<a name='861'>
<a name='862'>
                CASE ( int_ioexit )<a name='863'>
<font color=#447700>! ioexit is now handled by sending negative message length to server<a name='864'></font>
                  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_104">( &amp;<a name='865'>
                         "quilt: should have handled int_ioexit already")<a name='866'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='867'></font>
<font color=#447700>!&lt;PRE&gt;<a name='868'></font>
<font color=#447700>! The I/O server "root" handles the "ioclose" request.<a name='869'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='870'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='871'></font>
                CASE ( int_ioclose )<a name='872'>
<font color=#447700>!write(0,*)' int_ioclose '<a name='873'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_HANDLE_HEADER'>int_get_handle_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_HANDLE_HEADER_1">( bigbuf(icurs/inttypesize), hdrbufsize, itypesize, &amp;<a name='874'>
                                              DataHandle , code )<a name='875'>
                  icurs = icurs + hdrbufsize<a name='876'>
<a name='877'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='878'>
#ifdef NETCDF<a name='879'>
                    CASE ( IO_NETCDF   )<a name='880'>
                      CALL ext_ncd_inquire_filename( handle(DataHandle), fname, fstat, Status )<a name='881'>
                      IF ( fstat .EQ. WRF_FILE_OPENED_FOR_WRITE .OR. fstat .EQ. WRF_FILE_OPENED_NOT_COMMITTED ) THEN<a name='882'>
                        CALL ext_ncd_ioclose(handle(DataHandle),Status)<a name='883'>
                      ENDIF<a name='884'>
#endif<a name='885'>
#ifdef INTIO<a name='886'>
                    CASE ( IO_INTIO   )<a name='887'>
                      CALL ext_int_inquire_filename( handle(DataHandle), fname, fstat, Status )<a name='888'>
                      IF ( fstat .EQ. WRF_FILE_OPENED_FOR_WRITE .OR. fstat .EQ. WRF_FILE_OPENED_NOT_COMMITTED ) THEN<a name='889'>
                        CALL ext_int_ioclose(handle(DataHandle),Status)<a name='890'>
                      ENDIF<a name='891'>
#endif<a name='892'>
#ifdef YYY<a name='893'>
                 CASE ( IO_YYY )<a name='894'>
                    CALL ext_yyy_inquire_filename( handle(DataHandle), fname, fstat, Status )<a name='895'>
                    IF ( fstat .EQ. WRF_FILE_OPENED_FOR_WRITE .OR. fstat .EQ. WRF_FILE_OPENED_NOT_COMMITTED ) THEN<a name='896'>
                      CALL ext_yyy_ioclose(handle(DataHandle),Status)<a name='897'>
                    ENDIF<a name='898'>
#endif<a name='899'>
                    CASE DEFAULT<a name='900'>
                      Status = 0<a name='901'>
                  END SELECT<a name='902'>
<a name='903'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='904'></font>
<font color=#447700>!&lt;PRE&gt;<a name='905'></font>
<font color=#447700>! The I/O server "root" handles the "open_for_write_begin" request.<a name='906'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='907'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='908'></font>
                CASE ( int_open_for_write_begin )<a name='909'>
<a name='910'>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_OFWB_HEADER'>int_get_ofwb_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_OFWB_HEADER_1">( bigbuf(icurs/inttypesize), hdrbufsize, itypesize, &amp;<a name='911'>
                                            FileName,SysDepInfo,io_form_arg,DataHandle )<a name='912'>
<a name='913'>
<font color=#447700>!write(0,*)' int_open_for_write_begin inttypesize ',inttypesize,' itypesize ',itypesize<a name='914'></font>
<font color=#447700>!write(0,*)' int_open_for_write_begin icurs ', icurs, hdrbufsize<a name='915'></font>
<font color=#447700>!write(0,*)' int_open_for_write_begin FileName ',TRIM(FileName) <a name='916'></font>
<font color=#447700>!write(0,*)' int_open_for_write_begin SysDepInfo ',TRIM(SysDepInfo) <a name='917'></font>
                  icurs = icurs + hdrbufsize<a name='918'>
<font color=#447700>!write(0,*)' int_open_for_write_begin new icurs,tag,size ', icurs, get_hdr_tag( bigbuf(icurs/inttypesize) ),get_hdr_rec_size( bigbuf(icurs/inttypesize) )<a name='919'></font>
                <a name='920'>
                  io_form(DataHandle) = io_form_arg<a name='921'>
<a name='922'>
                  SELECT CASE (use_package(io_form(DataHandle)))<a name='923'>
#ifdef NETCDF<a name='924'>
                    CASE ( IO_NETCDF   )<a name='925'>
                      CALL ext_ncd_open_for_write_begin(FileName,Comm,IOComm,SysDepInfo,handle(DataHandle),Status)<a name='926'>
<font color=#447700>!write(0,*)'ext_ncd_open_for_write_begin ',Trim(FileName),DataHandle,handle(DataHandle),Status<a name='927'></font>
#endif<a name='928'>
#ifdef INTIO<a name='929'>
                    CASE ( IO_INTIO   )<a name='930'>
                      CALL ext_int_open_for_write_begin(FileName,Comm,IOComm,SysDepInfo,handle(DataHandle),Status)<a name='931'>
#endif<a name='932'>
#ifdef YYY<a name='933'>
                    CASE ( IO_YYY )<a name='934'>
                       CALL ext_yyy_open_for_write_begin(FileName,Comm,IOComm,SysDepInfo,handle(DataHandle),Status)<a name='935'>
#endif<a name='936'>
                    CASE DEFAULT<a name='937'>
                      Status = 0<a name='938'>
                  END SELECT<a name='939'>
                <a name='940'>
                  okay_to_write(DataHandle) = .false.<a name='941'>
<a name='942'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='943'></font>
<font color=#447700>!&lt;PRE&gt;<a name='944'></font>
<font color=#447700>! The I/O server "root" handles the "open_for_write_commit" request.<a name='945'></font>
<font color=#447700>! In this case, the "okay_to_commit" is simply set to .true. so "write_field"<a name='946'></font>
<font color=#447700>! requests will initiate writes to disk.  Actual commit will be done after<a name='947'></font>
<font color=#447700>! all requests in this batch have been handled.<a name='948'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='949'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='950'></font>
                CASE ( int_open_for_write_commit )<a name='951'>
<a name='952'>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_HANDLE_HEADER'>int_get_handle_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_HANDLE_HEADER_2">( bigbuf(icurs/inttypesize), hdrbufsize, itypesize, &amp;<a name='953'>
                                              DataHandle , code )<a name='954'>
<font color=#447700>!write(0,*)' int_open_for_write_commit icurs ', icurs, hdrbufsize<a name='955'></font>
                  icurs = icurs + hdrbufsize<a name='956'>
                  okay_to_commit(DataHandle) = .true.<a name='957'>
<a name='958'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='959'></font>
<font color=#447700>!&lt;PRE&gt;<a name='960'></font>
<font color=#447700>! The I/O server "root" handles the "write_field" (int_field) request.<a name='961'></font>
<font color=#447700>! If okay_to_write(DataHandle) is .true. then the patch in the<a name='962'></font>
<font color=#447700>! header (bigbuf) is written to a globally-sized internal output buffer via<a name='963'></font>
<font color=#447700>! the call to store_patch_in_outbuf().  Note that this is where the actual<a name='964'></font>
<font color=#447700>! "quilting" (reassembly of patches onto a full-size domain) is done.  If<a name='965'></font>
<font color=#447700>! okay_to_write(DataHandle) is .false. then external I/O package interfaces<a name='966'></font>
<font color=#447700>! are called to write metadata for I/O formats that support native metadata.<a name='967'></font>
<font color=#447700>!<a name='968'></font>
<font color=#447700>! NOTE that the I/O server "root" will only see write_field (int_field)<a name='969'></font>
<font color=#447700>! requests AFTER an "iosync" request.<a name='970'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='971'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='972'></font>
                CASE ( int_field )<a name='973'>
<font color=#447700>!write(0,*)' int_field '<a name='974'></font>
                  CALL mpi_type_size( MPI_INTEGER, ftypesize, ierr )<a name='975'>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_WRITE_FIELD_HEADER'>int_get_write_field_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_WRITE_FIELD_HEADER_3"> ( bigbuf(icurs/inttypesize), hdrbufsize, itypesize, ftypesize,  &amp;<a name='976'>
                                                    DataHandle , DateStr , VarName , Dummy , FieldType , Comm , IOComm, &amp;<a name='977'>
                                                    DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='978'>
                                                    DomainStart , DomainEnd ,                                    &amp;<a name='979'>
                                                    MemoryStart , MemoryEnd ,                                    &amp;<a name='980'>
                                                    PatchStart , PatchEnd )<a name='981'>
                  icurs = icurs + hdrbufsize<a name='982'>
<a name='983'>
                  IF ( okay_to_write(DataHandle) ) THEN<a name='984'>
<a name='985'>
                    WRITE(*,*)'&gt;&gt;&gt; ',TRIM(DateStr), ' ', TRIM(VarName), ' ', TRIM(MemoryOrder), ' ', &amp;<a name='986'>
                         (PatchEnd(1)-PatchStart(1)+1)*(PatchEnd(2)-PatchStart(2)+1)*(PatchEnd(3)-PatchStart(3)+1)<a name='987'>
<a name='988'>
                    IF ( FieldType .EQ. WRF_REAL .OR. FieldType .EQ. WRF_DOUBLE)  THEN<a name='989'>
                      CALL mpi_type_size( MPI_REAL, ftypesize, ierr )<a name='990'>
                      stored_write_record = .true.<a name='991'>
                      CALL <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#STORE_PATCH_IN_OUTBUF'>store_patch_in_outbuf</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STORE_PATCH_IN_OUTBUF_1"> ( bigbuf(icurs/inttypesize), dummybuf, TRIM(DateStr), TRIM(VarName) , &amp;<a name='992'>
                                                   FieldType, TRIM(MemoryOrder), TRIM(Stagger), DimNames, &amp;<a name='993'>
                                                   DomainStart , DomainEnd , &amp;<a name='994'>
                                                   MemoryStart , MemoryEnd , &amp;<a name='995'>
                                                   PatchStart , PatchEnd )<a name='996'>
<a name='997'>
                    ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='998'>
                      CALL mpi_type_size( MPI_INTEGER, ftypesize, ierr )<a name='999'>
                      stored_write_record = .true.<a name='1000'>
                      CALL <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#STORE_PATCH_IN_OUTBUF'>store_patch_in_outbuf</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STORE_PATCH_IN_OUTBUF_2"> ( dummybuf, bigbuf(icurs/inttypesize), TRIM(DateStr), TRIM(VarName) , &amp;<a name='1001'>
                                                   FieldType, TRIM(MemoryOrder), TRIM(Stagger), DimNames, &amp;<a name='1002'>
                                                   DomainStart , DomainEnd , &amp;<a name='1003'>
                                                   MemoryStart , MemoryEnd , &amp;<a name='1004'>
                                                   PatchStart , PatchEnd )<a name='1005'>
                    ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='1006'>
                      ftypesize = LWORDSIZE<a name='1007'>
                    ENDIF<a name='1008'>
                    icurs = icurs + (PatchEnd(1)-PatchStart(1)+1)*(PatchEnd(2)-PatchStart(2)+1)* &amp;<a name='1009'>
                                    (PatchEnd(3)-PatchStart(3)+1)*ftypesize<a name='1010'>
                  ELSE<a name='1011'>
                    SELECT CASE (use_package(io_form(DataHandle)))<a name='1012'>
#ifdef NETCDF<a name='1013'>
                      CASE ( IO_NETCDF   )<a name='1014'>
                        CALL ext_ncd_write_field ( handle(DataHandle) , TRIM(DateStr) ,         &amp;<a name='1015'>
                                   TRIM(VarName) , dummy , FieldType , Comm , IOComm,           &amp;<a name='1016'>
                                   DomainDesc , TRIM(MemoryOrder) , TRIM(Stagger) , DimNames ,  &amp;<a name='1017'>
                                   DomainStart , DomainEnd ,                                    &amp;<a name='1018'>
                                   DomainStart , DomainEnd ,                                    &amp;<a name='1019'>
                                   DomainStart , DomainEnd ,                                    &amp;<a name='1020'>
                                   Status )<a name='1021'>
#endif<a name='1022'>
#if 0<a name='1023'>
<font color=#447700>! since this is training and the grib output doesn't need training, disable this branch.<a name='1024'></font>
#ifdef YYY<a name='1025'>
                 CASE ( IO_YYY )<a name='1026'>
                      CALL ext_YYY_write_field ( handle(DataHandle) , TRIM(DateStr) ,         &amp;<a name='1027'>
                                 TRIM(VarName) , dummy , FieldType , Comm , IOComm,           &amp;<a name='1028'>
                                 DomainDesc , TRIM(MemoryOrder) , TRIM(Stagger) , DimNames ,  &amp;<a name='1029'>
                                 DomainStart , DomainEnd ,                                    &amp;<a name='1030'>
                                 DomainStart , DomainEnd ,                                    &amp;<a name='1031'>
                                 DomainStart , DomainEnd ,                                    &amp;<a name='1032'>
                                 Status )<a name='1033'>
#endif<a name='1034'>
#endif<a name='1035'>
                      CASE DEFAULT<a name='1036'>
                        Status = 0<a name='1037'>
                    END SELECT<a name='1038'>
                  ENDIF<a name='1039'>
                CASE ( int_iosync )<a name='1040'>
<font color=#447700>!write(0,*)' int_iosync '<a name='1041'></font>
                  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_HANDLE_HEADER'>int_get_handle_header</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_HANDLE_HEADER_3">( bigbuf(icurs/inttypesize), hdrbufsize, itypesize, &amp;<a name='1042'>
                                            DataHandle , code )<a name='1043'>
                  icurs = icurs + hdrbufsize<a name='1044'>
                CASE DEFAULT<a name='1045'>
                  WRITE(mess,*)'quilt: bad tag: ',get_hdr_tag( bigbuf(icurs/inttypesize) ),' icurs ',icurs/inttypesize<a name='1046'>
                  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_105">( mess )<a name='1047'>
              END SELECT<a name='1048'>
<a name='1049'>
            ENDDO<a name='1050'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1051'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1052'></font>
<font color=#447700>! Now, the I/O server "root" has finshed handling all commands from the latest<a name='1053'></font>
<font color=#447700>! call to retrieve_pieces_of_field().<a name='1054'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1055'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1056'></font>
<a name='1057'>
            IF (stored_write_record) THEN<a name='1058'>
<font color=#447700>!write(0,*)'calling write_outbuf ',DataHandle<a name='1059'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1060'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1061'></font>
<font color=#447700>! If any fields have been stored in a globally-sized internal output buffer<a name='1062'></font>
<font color=#447700>! (via a call to store_patch_in_outbuf()) then call write_outbuf() to write<a name='1063'></font>
<font color=#447700>! them to disk now.<a name='1064'></font>
<font color=#447700>! NOTE that the I/O server "root" will only have called<a name='1065'></font>
<font color=#447700>! store_patch_in_outbuf() when handling write_field (int_field)<a name='1066'></font>
<font color=#447700>! commands which only arrive AFTER an "iosync" command.<a name='1067'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1068'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1069'></font>
              CALL <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#WRITE_OUTBUF'>write_outbuf</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRITE_OUTBUF_1"> ( handle(DataHandle), use_package(io_form(DataHandle))) <a name='1070'>
<font color=#447700>!write(0,*)'back from write_outbuf ',DataHandle<a name='1071'></font>
            ENDIF<a name='1072'>
<a name='1073'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1074'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1075'></font>
<font color=#447700>! If one or more "open_for_write_commit" commands were encountered from the<a name='1076'></font>
<font color=#447700>! latest call to retrieve_pieces_of_field() then call the package-specific<a name='1077'></font>
<font color=#447700>! routine to do the commit.<a name='1078'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1079'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1080'></font>
            IF (okay_to_commit(DataHandle)) THEN<a name='1081'>
<a name='1082'>
              SELECT CASE (use_package(io_form(DataHandle)))<a name='1083'>
#ifdef NETCDF<a name='1084'>
                CASE ( IO_NETCDF   )<a name='1085'>
                  CALL ext_ncd_inquire_filename( handle(DataHandle), fname, fstat, Status )<a name='1086'>
<font color=#447700>!write(0,*)'preparing to commit ', DataHandle, fstat, fstat .EQ. WRF_FILE_OPENED_NOT_COMMITTED<a name='1087'></font>
                  IF ( fstat .EQ. WRF_FILE_OPENED_NOT_COMMITTED ) THEN<a name='1088'>
<font color=#447700>!write(0,*)'calling ext_ncd_open_for_write_commit ', handle(DataHandle), DataHandle<a name='1089'></font>
                    CALL ext_ncd_open_for_write_commit(handle(DataHandle),Status)<a name='1090'>
<font color=#447700>!write(0,*)'back from ext_ncd_open_for_write_commit ', Status<a name='1091'></font>
                    okay_to_write(DataHandle) = .true.<a name='1092'>
                  ENDIF<a name='1093'>
#endif<a name='1094'>
#ifdef INTIO<a name='1095'>
                CASE ( IO_INTIO   )<a name='1096'>
                  CALL ext_int_inquire_filename( handle(DataHandle), fname, fstat, Status )<a name='1097'>
                  IF ( fstat .EQ. WRF_FILE_OPENED_NOT_COMMITTED ) THEN<a name='1098'>
                    CALL ext_int_open_for_write_commit(handle(DataHandle),Status)<a name='1099'>
                    okay_to_write(DataHandle) = .true.<a name='1100'>
                  ENDIF<a name='1101'>
#endif<a name='1102'>
#ifdef YYY<a name='1103'>
                 CASE ( IO_YYY )<a name='1104'>
                    CALL ext_yyy_inquire_filename( handle(DataHandle), fname, fstat, Status )<a name='1105'>
                    IF ( fstat .EQ. WRF_FILE_OPENED_NOT_COMMITTED ) THEN<a name='1106'>
                       CALL ext_yyy_open_for_write_commit(handle(DataHandle),Status)<a name='1107'>
                       okay_to_write(DataHandle) = .true.<a name='1108'>
                    ENDIF<a name='1109'>
#endif<a name='1110'>
<a name='1111'>
                CASE DEFAULT<a name='1112'>
                  Status = 0<a name='1113'>
              END SELECT<a name='1114'>
<a name='1115'>
            okay_to_commit(DataHandle) = .false.<a name='1116'>
          ENDIF<a name='1117'>
          DEALLOCATE( bigbuf )<a name='1118'>
        ENDIF<a name='1119'>
<a name='1120'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1121'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1122'></font>
<font color=#447700>! Retrieve header and all patches for the next field from the internal <a name='1123'></font>
<font color=#447700>! buffers.  <a name='1124'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1125'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1126'></font>
        CALL <A href='../../html_code/frame/module_quilt_outbuf_ops.F.html#RETRIEVE_PIECES_OF_FIELD'>retrieve_pieces_of_field</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_PIECES_OF_FIELD_2"> ( obuf , VarName, obufsize, sz, retval )<a name='1127'>
<font color=#447700>!write(0,*)'calling next retrieve_pieces_of_field ',trim(VarName),obufsize,sz,retval<a name='1128'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1129'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1130'></font>
<font color=#447700>! Sum sizes of all headers and patches (data) for this field from all I/O <a name='1131'></font>
<font color=#447700>! servers in this I/O server group onto the I/O server "root".<a name='1132'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1133'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1134'></font>
        CALL MPI_Reduce( sz, bigbufsize, 1, MPI_INTEGER,  &amp;<a name='1135'>
                         MPI_SUM, ntasks_local_group-1,         &amp;<a name='1136'>
                         mpi_comm_local, ierr )<a name='1137'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1138'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1139'></font>
<font color=#447700>! Then, return to the top of the loop to collect headers and data from all <a name='1140'></font>
<font color=#447700>! I/O servers in this I/O server group onto the I/O server "root" and handle <a name='1141'></font>
<font color=#447700>! the next batch of commands.  <a name='1142'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1143'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1144'></font>
<font color=#447700>!write(0,*)'after MPI_Reduce ',sz, bigbufsize<a name='1145'></font>
      END DO<a name='1146'>
<a name='1147'>
      DEALLOCATE( obuf )<a name='1148'>
<a name='1149'>
      <font color=#447700>! flush output files if needed<a name='1150'></font>
      IF (stored_write_record) THEN<a name='1151'>
        SELECT CASE ( use_package(io_form) )<a name='1152'>
#ifdef NETCDF<a name='1153'>
          CASE ( IO_NETCDF   )<a name='1154'>
            CALL ext_ncd_iosync( handle(DataHandle), Status )<a name='1155'>
#endif<a name='1156'>
#ifdef XXX<a name='1157'>
          CASE ( IO_XXX   )<a name='1158'>
            CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOSYNC'>ext_xxx_iosync</A><A href='../../html_code/frame/module_io_quilt.F.html#QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOSYNC_2">( handle(DataHandle), Status )<a name='1159'>
#endif<a name='1160'>
#ifdef YYY<a name='1161'>
          CASE ( IO_YYY   )<a name='1162'>
            CALL ext_yyy_iosync( handle(DataHandle), Status )<a name='1163'>
#endif<a name='1164'>
#ifdef ZZZ<a name='1165'>
          CASE ( IO_ZZZ   )<a name='1166'>
            CALL ext_zzz_iosync( handle(DataHandle), Status )<a name='1167'>
#endif<a name='1168'>
#ifdef INTIO<a name='1169'>
          CASE ( IO_INTIO   )<a name='1170'>
            CALL ext_int_iosync( handle(DataHandle), Status )<a name='1171'>
#endif<a name='1172'>
          CASE DEFAULT<a name='1173'>
            Status = 0<a name='1174'>
        END SELECT<a name='1175'>
      ENDIF<a name='1176'>
<a name='1177'>
      END DO<a name='1178'>
<a name='1179'>
    END SUBROUTINE quilt<a name='1180'>
<a name='1181'>
<font color=#447700>! end of #endif of DM_PARALLEL<a name='1182'></font>
#endif<a name='1183'>
<a name='1184'>
<A NAME='INIT_MODULE_WRF_QUILT'><A href='../../html_code/frame/module_io_quilt.F.html#INIT_MODULE_WRF_QUILT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1185'>
    <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_wrf_quilt</font> <A href='../../call_to/INIT_MODULE_WRF_QUILT.html' TARGET='index'>1</A>,<A href='../../call_from/INIT_MODULE_WRF_QUILT.html' TARGET='index'>3</A><a name='1186'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1187'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1188'></font>
<font color=#447700>! Both client (compute) and server tasks call this routine to initialize the <a name='1189'></font>
<font color=#447700>! module.  Routine setup_quilt_servers() is called from this routine to <a name='1190'></font>
<font color=#447700>! determine which tasks are compute tasks and which are server tasks.  Server <a name='1191'></font>
<font color=#447700>! tasks then call routine quilt() and remain there for the rest of the model <a name='1192'></font>
<font color=#447700>! run.  Compute tasks return from init_module_wrf_quilt() to perform model <a name='1193'></font>
<font color=#447700>! computations.  <a name='1194'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1195'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1196'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1197'></font>
      IMPLICIT NONE<a name='1198'>
      INCLUDE 'mpif.h'<a name='1199'>
      INTEGER i<a name='1200'>
      NAMELIST /namelist_quilt/ nio_tasks_per_group, nio_groups<a name='1201'>
      INTEGER ntasks, mytask, ierr<a name='1202'>
      LOGICAL mpi_inited<a name='1203'>
<a name='1204'>
      quilting_enabled = .FALSE.<a name='1205'>
      IF ( disable_quilt ) RETURN<a name='1206'>
<a name='1207'>
      DO i = 1,int_num_handles<a name='1208'>
        okay_to_write(i) = .FALSE.<a name='1209'>
        int_handle_in_use(i) = .FALSE.<a name='1210'>
        int_num_bytes_to_write(i) = 0<a name='1211'>
      ENDDO<a name='1212'>
<a name='1213'>
      CALL MPI_INITIALIZED( mpi_inited, ierr )<a name='1214'>
      IF ( mpi_inited ) THEN<a name='1215'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#INIT_MODULE_WRF_QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_106">("frame/module_io_quilt.F: quilt initialization must be called before MPI_Init") ;<a name='1216'>
      ENDIF<a name='1217'>
<a name='1218'>
      CALL mpi_init ( ierr )<a name='1219'>
      CALL wrf_set_dm_communicator( MPI_COMM_WORLD )<a name='1220'>
      CALL wrf_termio_dup ( MPI_COMM_WORLD )<a name='1221'>
      CALL MPI_Comm_rank ( MPI_COMM_WORLD, mytask, ierr ) ;<a name='1222'>
      CALL mpi_x_comm_size ( MPI_COMM_WORLD, ntasks, ierr ) ;<a name='1223'>
<a name='1224'>
      IF ( mytask .EQ. 0 ) THEN<a name='1225'>
        OPEN ( unit=27, file="namelist.input", form="formatted", status="old" )<a name='1226'>
        nio_groups = 1<a name='1227'>
        nio_tasks_per_group  = 0<a name='1228'>
        READ ( 27 , namelist_quilt )<a name='1229'>
        CLOSE ( 27 )<a name='1230'>
      ENDIF<a name='1231'>
      CALL mpi_bcast( nio_tasks_per_group  , 1 , MPI_INTEGER , 0 , MPI_COMM_WORLD, ierr )<a name='1232'>
      CALL mpi_bcast( nio_groups , 1 , MPI_INTEGER , 0 , MPI_COMM_WORLD, ierr )<a name='1233'>
<a name='1234'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#SETUP_QUILT_SERVERS'>setup_quilt_servers</A><A href='../../html_code/frame/module_io_quilt.F.html#INIT_MODULE_WRF_QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SETUP_QUILT_SERVERS_1">( nio_tasks_per_group,            &amp;<a name='1235'>
                                mytask,               &amp;<a name='1236'>
                                ntasks,               &amp;<a name='1237'>
                                nio_groups,           &amp;<a name='1238'>
                                nio_tasks_in_group,   &amp;<a name='1239'>
                                MPI_COMM_WORLD,       &amp;<a name='1240'>
                                mpi_comm_local,       &amp;<a name='1241'>
                                mpi_comm_io_groups)<a name='1242'>
<a name='1243'>
       <font color=#447700>! provide the communicator for the integration tasks to RSL<a name='1244'></font>
       IF ( mytask .lt. ncompute_tasks ) THEN<a name='1245'>
          CALL wrf_set_dm_communicator( mpi_comm_local )<a name='1246'>
       ELSE<a name='1247'>
          CALL <A href='../../html_code/frame/module_io_quilt.F.html#QUILT'>quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#INIT_MODULE_WRF_QUILT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="QUILT_1">    <font color=#447700>! will not return on io server tasks<a name='1248'></font>
       ENDIF<a name='1249'>
#endif<a name='1250'>
      RETURN<a name='1251'>
    END SUBROUTINE init_module_wrf_quilt<a name='1252'>
END MODULE module_wrf_quilt<a name='1253'>
<a name='1254'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1255'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1256'></font>
<font color=#447700>! Remaining routines in this file are defined outside of the module<a name='1257'></font>
<font color=#447700>! either to defeat arg/param type checking or to avoid an explicit use<a name='1258'></font>
<font color=#447700>! dependence.<a name='1259'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1260'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1261'></font>
<a name='1262'>
<A NAME='DISABLE_QUILTING'><A href='../../html_code/frame/module_io_quilt.F.html#DISABLE_QUILTING' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1263'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>disable_quilting</font> <A href='../../call_to/DISABLE_QUILTING.html' TARGET='index'>6</A>,<A href='../../call_from/DISABLE_QUILTING.html' TARGET='index'>3</A><a name='1264'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1265'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1266'></font>
<font color=#447700>! Call this in programs that you never want to be quilting (e.g. real)<a name='1267'></font>
<font color=#447700>! Must call before call to init_module_wrf_quilt().  <a name='1268'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1269'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1270'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#DISABLE_QUILTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_1"><a name='1271'>
  disable_quilt = .TRUE.<a name='1272'>
  RETURN<a name='1273'>
END SUBROUTINE disable_quilting<a name='1274'>
<a name='1275'>
<A NAME='USE_OUTPUT_SERVERS'><A href='../../html_code/frame/module_io_quilt.F.html#USE_OUTPUT_SERVERS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1276'>
LOGICAL <font color=#993300>FUNCTION  </font><font color=#cc0000>use_output_servers</font>()<a name='1277'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1278'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1279'></font>
<font color=#447700>! Returns .TRUE. if I/O quilt servers are in-use for write operations.<a name='1280'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1281'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1282'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1283'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#DISABLE_QUILTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_2"><a name='1284'>
  use_output_servers = quilting_enabled<a name='1285'>
  RETURN<a name='1286'>
END FUNCTION use_output_servers<a name='1287'>
<a name='1288'>
<A NAME='USE_INPUT_SERVERS'><A href='../../html_code/frame/module_io_quilt.F.html#USE_INPUT_SERVERS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1289'>
LOGICAL <font color=#993300>FUNCTION  </font><font color=#cc0000>use_input_servers</font>()<a name='1290'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1291'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1292'></font>
<font color=#447700>! Returns .TRUE. if I/O quilt servers are in-use for read operations.<a name='1293'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1294'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1295'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1296'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#DISABLE_QUILTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_3"><a name='1297'>
  use_input_servers = .FALSE.<a name='1298'>
  RETURN<a name='1299'>
END FUNCTION use_input_servers<a name='1300'>
<a name='1301'>
<A NAME='WRF_QUILT_OPEN_FOR_WRITE_BEGIN'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1302'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_open_for_write_begin</font>( FileName , Comm_compute, Comm_io, SysDepInfo, &amp; <A href='../../call_to/WRF_QUILT_OPEN_FOR_WRITE_BEGIN.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_OPEN_FOR_WRITE_BEGIN.html' TARGET='index'>6</A><a name='1303'>
                                     DataHandle , io_form_arg, Status )<a name='1304'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1305'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1306'></font>
<font color=#447700>! Instruct the I/O quilt servers to begin data definition ("training") phase<a name='1307'></font>
<font color=#447700>! for writing to WRF dataset FileName.  io_form_arg indicates file format.<a name='1308'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1309'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1310'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1311'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1312'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_4"><a name='1313'>
  IMPLICIT NONE<a name='1314'>
  INCLUDE 'mpif.h'<a name='1315'>
  INCLUDE 'intio_tags.h'<a name='1316'>
  CHARACTER *(*), INTENT(IN)  :: FileName<a name='1317'>
  INTEGER ,       INTENT(IN)  :: Comm_compute , Comm_io<a name='1318'>
  CHARACTER *(*), INTENT(IN)  :: SysDepInfo<a name='1319'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='1320'>
  INTEGER ,       INTENT(IN)  :: io_form_arg<a name='1321'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1322'>
<font color=#447700>! Local<a name='1323'></font>
  CHARACTER*132   :: locFileName, locSysDepInfo<a name='1324'>
  INTEGER i, typesize, itypesize, tasks_in_group, ierr, comm_io_group<a name='1325'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1326'>
  REAL dummy<a name='1327'>
<a name='1328'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_109"> ( DEBUG_LVL, 'in wrf_quilt_open_for_write_begin' ) <a name='1329'>
  CALL <A href='../../html_code/frame/module_io_quilt.F.html#INT_GET_FRESH_HANDLE'>int_get_fresh_handle</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_FRESH_HANDLE_1">(i)<a name='1330'>
  okay_to_write(i) = .false.<a name='1331'>
  DataHandle = i<a name='1332'>
<a name='1333'>
  locFileName = FileName<a name='1334'>
  locSysDepInfo = SysDepInfo<a name='1335'>
<a name='1336'>
  CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='1337'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='1338'>
    CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_OFWB_HEADER'>int_gen_ofwb_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_OFWB_HEADER_1">( hdrbuf, hdrbufsize, itypesize, &amp;<a name='1339'>
                            locFileName,locSysDepInfo,io_form_arg,DataHandle )<a name='1340'>
  ELSE<a name='1341'>
    CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_NOOP_HEADER'>int_gen_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_NOOP_HEADER_1">( hdrbuf, hdrbufsize, itypesize )<a name='1342'>
  ENDIF<a name='1343'>
<a name='1344'>
  iserver = 1 <font color=#447700>! only one server group for now<a name='1345'></font>
  CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_1">( comm_io_group , iserver )<a name='1346'>
  CALL MPI_TYPE_SIZE( MPI_REAL, typesize, ierr )<a name='1347'>
<a name='1348'>
  CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='1349'>
<a name='1350'>
  <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='1351'></font>
  CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='1352'>
                   MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='1353'></font>
                   comm_io_group, ierr )<a name='1354'>
<a name='1355'>
  <font color=#447700>! send data to the i/o processor<a name='1356'></font>
  CALL collect_on_comm( comm_io_group,            &amp;<a name='1357'>
                        onebyte,                       &amp;<a name='1358'>
                        hdrbuf, hdrbufsize , &amp;<a name='1359'>
                        dummy, 0 )<a name='1360'>
<a name='1361'>
  Status = 0<a name='1362'>
<a name='1363'>
<a name='1364'>
#endif<a name='1365'>
  RETURN  <a name='1366'>
END SUBROUTINE wrf_quilt_open_for_write_begin<a name='1367'>
<a name='1368'>
<A NAME='WRF_QUILT_OPEN_FOR_WRITE_COMMIT'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_COMMIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1369'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_open_for_write_commit</font>( DataHandle , Status ) <A href='../../call_to/WRF_QUILT_OPEN_FOR_WRITE_COMMIT.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_OPEN_FOR_WRITE_COMMIT.html' TARGET='index'>4</A><a name='1370'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1371'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1372'></font>
<font color=#447700>! Instruct the I/O quilt servers to switch an internal flag to enable output<a name='1373'></font>
<font color=#447700>! for the dataset referenced by DataHandle.  The call to<a name='1374'></font>
<font color=#447700>! wrf_quilt_open_for_write_commit() must be paired with a call to<a name='1375'></font>
<font color=#447700>! wrf_quilt_open_for_write_begin().<a name='1376'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1377'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1378'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1379'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1380'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_5"><a name='1381'>
  IMPLICIT NONE<a name='1382'>
  INCLUDE 'mpif.h'<a name='1383'>
  INCLUDE 'intio_tags.h'<a name='1384'>
  INTEGER ,       INTENT(IN ) :: DataHandle<a name='1385'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1386'>
  INTEGER i, typesize, itypesize, tasks_in_group, ierr, comm_io_group<a name='1387'>
  REAL dummy<a name='1388'>
<a name='1389'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_110"> ( DEBUG_LVL, 'in wrf_quilt_open_for_write_commit' ) <a name='1390'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles ) THEN<a name='1391'>
    IF ( int_handle_in_use( DataHandle ) ) THEN<a name='1392'>
      okay_to_write( DataHandle ) = .true.<a name='1393'>
    ENDIF<a name='1394'>
  ENDIF<a name='1395'>
<a name='1396'>
  CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='1397'>
  CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_HANDLE_HEADER'>int_gen_handle_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_HANDLE_HEADER_1">( hdrbuf, hdrbufsize, itypesize, &amp;<a name='1398'>
                              DataHandle, int_open_for_write_commit )<a name='1399'>
<a name='1400'>
  iserver = 1 <font color=#447700>! only one server group for now<a name='1401'></font>
  CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_2">( comm_io_group , iserver )<a name='1402'>
  CALL MPI_TYPE_SIZE( MPI_REAL, typesize, ierr )<a name='1403'>
<a name='1404'>
  CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='1405'>
<a name='1406'>
  <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='1407'></font>
  CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='1408'>
                   MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='1409'></font>
                   comm_io_group, ierr )<a name='1410'>
<a name='1411'>
  <font color=#447700>! send data to the i/o processor<a name='1412'></font>
  CALL collect_on_comm( comm_io_group,            &amp;<a name='1413'>
                        onebyte,                       &amp;<a name='1414'>
                        hdrbuf, hdrbufsize , &amp;<a name='1415'>
                        dummy, 0 )<a name='1416'>
<a name='1417'>
  Status = 0<a name='1418'>
<a name='1419'>
#endif<a name='1420'>
  RETURN  <a name='1421'>
END SUBROUTINE wrf_quilt_open_for_write_commit<a name='1422'>
<a name='1423'>
<A NAME='WRF_QUILT_OPEN_FOR_READ'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_READ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1424'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_open_for_read</font> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;,<A href='../../call_from/WRF_QUILT_OPEN_FOR_READ.html' TARGET='index'>2</A><a name='1425'>
                               DataHandle , Status )<a name='1426'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1427'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1428'></font>
<font color=#447700>! Instruct the I/O quilt servers to open WRF dataset FileName for reading.<a name='1429'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1430'></font>
<font color=#447700>! This is not yet supported.<a name='1431'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1432'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1433'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1434'></font>
  IMPLICIT NONE<a name='1435'>
  CHARACTER *(*), INTENT(IN)  :: FileName<a name='1436'>
  INTEGER ,       INTENT(IN)  :: Comm_compute , Comm_io<a name='1437'>
  CHARACTER *(*), INTENT(IN)  :: SysDepInfo<a name='1438'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='1439'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1440'>
<a name='1441'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_111"> ( DEBUG_LVL, 'in wrf_quilt_open_for_read' ) <a name='1442'>
  DataHandle = -1<a name='1443'>
  Status = -1<a name='1444'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_107"> ( "frame/module_io_quilt.F: wrf_quilt_open_for_read not yet supported" )<a name='1445'>
#endif<a name='1446'>
  RETURN  <a name='1447'>
END SUBROUTINE wrf_quilt_open_for_read<a name='1448'>
<a name='1449'>
<A NAME='WRF_QUILT_INQUIRE_OPENED'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_INQUIRE_OPENED' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1450'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_inquire_opened</font> ( DataHandle, FileName , FileStatus, Status ) <A href='../../call_to/WRF_QUILT_INQUIRE_OPENED.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_INQUIRE_OPENED.html' TARGET='index'>2</A><a name='1451'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1452'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1453'></font>
<font color=#447700>! Inquire if the dataset referenced by DataHandle is open.<a name='1454'></font>
<font color=#447700>! Does not require communication with I/O servers.<a name='1455'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1456'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1457'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1458'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1459'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_6"><a name='1460'>
  IMPLICIT NONE<a name='1461'>
  include 'wrf_io_flags.h'<a name='1462'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1463'>
  CHARACTER *(*), INTENT(IN)  :: FileName<a name='1464'>
  INTEGER ,       INTENT(OUT) :: FileStatus<a name='1465'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1466'>
<a name='1467'>
  Status = 0<a name='1468'>
<a name='1469'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_112"> ( DEBUG_LVL, 'in wrf_quilt_inquire_opened' ) <a name='1470'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles ) THEN<a name='1471'>
    IF ( int_handle_in_use( DataHandle ) ) THEN<a name='1472'>
      IF ( okay_to_write( DataHandle ) ) THEN<a name='1473'>
        FileStatus = WRF_FILE_OPENED_FOR_WRITE<a name='1474'>
      ENDIF<a name='1475'>
    ENDIF<a name='1476'>
  ENDIF<a name='1477'>
  Status = 0<a name='1478'>
  <a name='1479'>
#endif<a name='1480'>
  RETURN<a name='1481'>
END SUBROUTINE wrf_quilt_inquire_opened<a name='1482'>
<a name='1483'>
<A NAME='WRF_QUILT_INQUIRE_FILENAME'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_INQUIRE_FILENAME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1484'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_inquire_filename</font> ( DataHandle, FileName , FileStatus, Status ) <A href='../../call_to/WRF_QUILT_INQUIRE_FILENAME.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_INQUIRE_FILENAME.html' TARGET='index'>2</A><a name='1485'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1486'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1487'></font>
<font color=#447700>! Return the Filename and FileStatus associated with DataHandle.<a name='1488'></font>
<font color=#447700>! Does not require communication with I/O servers.<a name='1489'></font>
<font color=#447700>!<a name='1490'></font>
<font color=#447700>! Note that the current implementation does not actually return FileName.<a name='1491'></font>
<font color=#447700>! Currenlty, WRF does not use this returned value.  Fixing this would simply<a name='1492'></font>
<font color=#447700>! require saving the file names on the client tasks in an array similar to<a name='1493'></font>
<font color=#447700>! okay_to_write().<a name='1494'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1495'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1496'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1497'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1498'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_7"><a name='1499'>
  IMPLICIT NONE<a name='1500'>
  include 'wrf_io_flags.h'<a name='1501'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1502'>
  CHARACTER *(*), INTENT(OUT) :: FileName<a name='1503'>
  INTEGER ,       INTENT(OUT) :: FileStatus<a name='1504'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1505'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_113"> ( DEBUG_LVL, 'in wrf_quilt_inquire_filename' ) <a name='1506'>
  Status = 0<a name='1507'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles ) THEN<a name='1508'>
    IF ( int_handle_in_use( DataHandle ) ) THEN<a name='1509'>
      IF ( okay_to_write( DataHandle ) ) THEN<a name='1510'>
        FileStatus = WRF_FILE_OPENED_FOR_WRITE<a name='1511'>
      ELSE<a name='1512'>
        FileStatus = WRF_FILE_OPENED_NOT_COMMITTED<a name='1513'>
      ENDIF<a name='1514'>
    ELSE<a name='1515'>
        FileStatus = WRF_FILE_NOT_OPENED<a name='1516'>
    ENDIF<a name='1517'>
    Status = 0<a name='1518'>
    FileName = "bogusfornow"<a name='1519'>
  ELSE<a name='1520'>
    Status = -1<a name='1521'>
  ENDIF<a name='1522'>
#endif<a name='1523'>
  RETURN<a name='1524'>
END SUBROUTINE wrf_quilt_inquire_filename<a name='1525'>
<a name='1526'>
<A NAME='WRF_QUILT_IOSYNC'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOSYNC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1527'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_iosync</font> ( DataHandle, Status ) <A href='../../call_to/WRF_QUILT_IOSYNC.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_IOSYNC.html' TARGET='index'>5</A><a name='1528'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1529'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1530'></font>
<font color=#447700>! Instruct the I/O quilt servers to synchronize the disk copy of a dataset<a name='1531'></font>
<font color=#447700>! with memory buffers.<a name='1532'></font>
<font color=#447700>!<a name='1533'></font>
<font color=#447700>! After the "iosync" header (request) is sent to the I/O quilt server,<a name='1534'></font>
<font color=#447700>! the compute tasks will then send the entire contents (headers and data) of<a name='1535'></font>
<font color=#447700>! int_local_output_buffer to their I/O quilt server.  This communication is<a name='1536'></font>
<font color=#447700>! done in subroutine send_to_io_quilt_servers().  After the I/O quilt servers<a name='1537'></font>
<font color=#447700>! receive this data, they will write all accumulated fields to disk.<a name='1538'></font>
<font color=#447700>!<a name='1539'></font>
<font color=#447700>! Significant time may be required for the I/O quilt servers to organize<a name='1540'></font>
<font color=#447700>! fields and write them to disk.  Therefore, the "iosync" request should be<a name='1541'></font>
<font color=#447700>! sent only when the compute tasks are ready to run for a while without<a name='1542'></font>
<font color=#447700>! needing to communicate with the servers.  Otherwise, the compute tasks<a name='1543'></font>
<font color=#447700>! will end up waiting for the servers to finish writing to disk, thus wasting<a name='1544'></font>
<font color=#447700>! any performance benefits of having servers at all.<a name='1545'></font>
<font color=#447700>!<a name='1546'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1547'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1548'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1549'></font>
#if  defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>! defined (STUBMPI) <a name='1550'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_8"><a name='1551'>
  IMPLICIT NONE<a name='1552'>
  include "<A href='../../html_code/include/mpif.h.html'>mpif.h</A>"<A NAME="mpif.h_1"><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1553'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1554'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1555'>
<a name='1556'>
  INTEGER locsize , typesize, inttypesize<a name='1557'>
  INTEGER ierr, tasks_in_group, comm_io_group, dummy, i<a name='1558'>
<a name='1559'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_114"> ( DEBUG_LVL, 'in wrf_quilt_iosync' ) <a name='1560'>
<a name='1561'>
  IF ( associated ( int_local_output_buffer ) ) THEN<a name='1562'>
<a name='1563'>
    iserver = 1 <font color=#447700>! only one server group for now<a name='1564'></font>
    CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_3">( comm_io_group , iserver )<a name='1565'>
    CALL MPI_TYPE_SIZE( MPI_REAL, typesize, ierr )<a name='1566'>
    IF ( typesize &lt;= 0 ) THEN<a name='1567'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_108">("frame/module_io_quilt.F: wrf_quilt_iosync : type size &lt;= 0 invalid")<a name='1568'>
    ENDIF<a name='1569'>
<a name='1570'>
    CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='1571'>
<a name='1572'>
    locsize = int_num_bytes_to_write(DataHandle)<a name='1573'>
<a name='1574'>
    <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='1575'></font>
    CALL MPI_Reduce( locsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='1576'>
                     MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='1577'></font>
                     comm_io_group, ierr )<a name='1578'>
<a name='1579'>
<a name='1580'>
    <font color=#447700>! send data to the i/o processor<a name='1581'></font>
#ifdef DEREF_KLUDGE<a name='1582'>
    CALL collect_on_comm( comm_io_group,            &amp;<a name='1583'>
                          onebyte,                       &amp;<a name='1584'>
                          int_local_output_buffer(1), locsize , &amp;<a name='1585'>
                          dummy, 0 )<a name='1586'>
#else<a name='1587'>
    CALL collect_on_comm( comm_io_group,            &amp;<a name='1588'>
                          onebyte,                       &amp;<a name='1589'>
                          int_local_output_buffer, locsize , &amp;<a name='1590'>
                          dummy, 0 )<a name='1591'>
#endif<a name='1592'>
<a name='1593'>
<a name='1594'>
    int_local_output_cursor = 1<a name='1595'>
<font color=#447700>!    int_num_bytes_to_write(DataHandle) = 0<a name='1596'></font>
    DEALLOCATE ( int_local_output_buffer )<a name='1597'>
    NULLIFY ( int_local_output_buffer )<a name='1598'>
  ELSE<a name='1599'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_12"> ("frame/module_io_quilt.F: wrf_quilt_iosync: no buffer allocated")<a name='1600'>
  ENDIF<a name='1601'>
  Status = 0<a name='1602'>
#endif<a name='1603'>
  RETURN<a name='1604'>
END SUBROUTINE wrf_quilt_iosync<a name='1605'>
<a name='1606'>
<A NAME='WRF_QUILT_IOCLOSE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOCLOSE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1607'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_ioclose</font> ( DataHandle, Status ) <A href='../../call_to/WRF_QUILT_IOCLOSE.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_IOCLOSE.html' TARGET='index'>5</A><a name='1608'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1609'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1610'></font>
<font color=#447700>! Instruct the I/O quilt servers to close the dataset referenced by<a name='1611'></font>
<font color=#447700>! DataHandle.<a name='1612'></font>
<font color=#447700>! This routine also clears the client file handle and, if needed, deallocates<a name='1613'></font>
<font color=#447700>! int_local_output_buffer.<a name='1614'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1615'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1616'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1617'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>! defined( STUBMPI) <a name='1618'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_9"><a name='1619'>
  IMPLICIT NONE<a name='1620'>
  INCLUDE 'mpif.h'<a name='1621'>
  INCLUDE 'intio_tags.h'<a name='1622'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1623'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1624'>
  INTEGER i, typesize, itypesize, tasks_in_group, comm_io_group, ierr<a name='1625'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1626'>
  REAL dummy<a name='1627'>
<a name='1628'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_115"> ( DEBUG_LVL, 'in wrf_quilt_ioclose' ) <a name='1629'>
  CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='1630'>
<a name='1631'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='1632'>
    CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_HANDLE_HEADER'>int_gen_handle_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_HANDLE_HEADER_2">( hdrbuf, hdrbufsize, itypesize, &amp;<a name='1633'>
                                DataHandle , int_ioclose )<a name='1634'>
  ELSE<a name='1635'>
    CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_NOOP_HEADER'>int_gen_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_NOOP_HEADER_2">( hdrbuf, hdrbufsize, itypesize )<a name='1636'>
  ENDIF<a name='1637'>
<a name='1638'>
  iserver = 1 <font color=#447700>! only one server group for now<a name='1639'></font>
  CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_4">( comm_io_group , iserver )<a name='1640'>
  CALL MPI_TYPE_SIZE( MPI_REAL, typesize, ierr )<a name='1641'>
<a name='1642'>
  CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='1643'>
<a name='1644'>
  <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='1645'></font>
  CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='1646'>
                   MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='1647'></font>
                   comm_io_group, ierr )<a name='1648'>
<a name='1649'>
  <font color=#447700>! send data to the i/o processor<a name='1650'></font>
  CALL collect_on_comm( comm_io_group,            &amp;<a name='1651'>
                        onebyte,                       &amp;<a name='1652'>
                        hdrbuf, hdrbufsize , &amp;<a name='1653'>
                        dummy, 0 )<a name='1654'>
<a name='1655'>
  int_handle_in_use(DataHandle) = .false.<a name='1656'>
  okay_to_write(DataHandle) = .false.<a name='1657'>
  okay_to_commit(DataHandle) = .false.<a name='1658'>
  int_local_output_cursor = 1<a name='1659'>
  int_num_bytes_to_write(DataHandle) = 0<a name='1660'>
  IF ( associated ( int_local_output_buffer ) ) THEN<a name='1661'>
    DEALLOCATE ( int_local_output_buffer )<a name='1662'>
    NULLIFY ( int_local_output_buffer )<a name='1663'>
  ENDIF<a name='1664'>
<a name='1665'>
  Status = 0<a name='1666'>
<a name='1667'>
#endif<a name='1668'>
  RETURN<a name='1669'>
END SUBROUTINE wrf_quilt_ioclose<a name='1670'>
<a name='1671'>
<A NAME='WRF_QUILT_IOEXIT'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOEXIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1672'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_ioexit</font>( Status ) <A href='../../call_to/WRF_QUILT_IOEXIT.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_IOEXIT.html' TARGET='index'>5</A><a name='1673'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1674'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1675'></font>
<font color=#447700>! Instruct the I/O quilt servers to shut down the WRF I/O system.<a name='1676'></font>
<font color=#447700>! Do not call any wrf_quilt_*() routines after this routine has been called.<a name='1677'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1678'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1679'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1680'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>! defined (STUBMPI ) <a name='1681'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_10"><a name='1682'>
  IMPLICIT NONE<a name='1683'>
  INCLUDE 'mpif.h'<a name='1684'>
  INCLUDE 'intio_tags.h'<a name='1685'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1686'>
  INTEGER                     :: DataHandle<a name='1687'>
  INTEGER i, typesize, itypesize, tasks_in_group, comm_io_group, ierr<a name='1688'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1689'>
  REAL dummy<a name='1690'>
<a name='1691'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_116"> ( DEBUG_LVL, 'in wrf_quilt_ioexit' ) <a name='1692'>
  CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='1693'>
<a name='1694'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='1695'>
    CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_HANDLE_HEADER'>int_gen_handle_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_HANDLE_HEADER_3">( hdrbuf, hdrbufsize, itypesize, &amp;<a name='1696'>
                                DataHandle , int_ioexit )  <font color=#447700>! Handle is dummy<a name='1697'></font>
  ELSE<a name='1698'>
    CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_NOOP_HEADER'>int_gen_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_NOOP_HEADER_3">( hdrbuf, hdrbufsize, itypesize )<a name='1699'>
  ENDIF<a name='1700'>
<a name='1701'>
  iserver = 1 <font color=#447700>! only one server group for now<a name='1702'></font>
  CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_5">( comm_io_group , iserver )<a name='1703'>
  CALL MPI_TYPE_SIZE( MPI_REAL, typesize, ierr )<a name='1704'>
<a name='1705'>
  CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='1706'>
<a name='1707'>
<font color=#447700>! BY SENDING A NEGATIVE SIZE WE GET THE SERVERS TO SHUT DOWN<a name='1708'></font>
<a name='1709'>
  hdrbufsize = -100 <a name='1710'>
  CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='1711'>
                   MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='1712'></font>
                   comm_io_group, ierr )<a name='1713'>
  Status = 0<a name='1714'>
<a name='1715'>
#endif<a name='1716'>
  RETURN  <a name='1717'>
END SUBROUTINE<a name='1718'>
<a name='1719'>
<A NAME='WRF_QUILT_GET_NEXT_TIME'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_NEXT_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1720'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_next_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/WRF_QUILT_GET_NEXT_TIME.html' TARGET='index'>1</A><a name='1721'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1722'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1723'></font>
<font color=#447700>! Instruct the I/O quilt servers to return the next time stamp.<a name='1724'></font>
<font color=#447700>! This is not yet supported.<a name='1725'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1726'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1727'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1728'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>! defined (STUBMPI) <a name='1729'></font>
  IMPLICIT NONE<a name='1730'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1731'>
  CHARACTER*(*)               :: DateStr<a name='1732'>
  INTEGER                     :: Status<a name='1733'>
#endif<a name='1734'>
  RETURN<a name='1735'>
END SUBROUTINE wrf_quilt_get_next_time<a name='1736'>
<a name='1737'>
<A NAME='WRF_QUILT_GET_PREVIOUS_TIME'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_PREVIOUS_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1738'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_previous_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/WRF_QUILT_GET_PREVIOUS_TIME.html' TARGET='index'>1</A><a name='1739'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1740'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1741'></font>
<font color=#447700>! Instruct the I/O quilt servers to return the previous time stamp.<a name='1742'></font>
<font color=#447700>! This is not yet supported.<a name='1743'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1744'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1745'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1746'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>! defined (STUBMPI)<a name='1747'></font>
  IMPLICIT NONE<a name='1748'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1749'>
  CHARACTER*(*)               :: DateStr<a name='1750'>
  INTEGER                     :: Status<a name='1751'>
#endif<a name='1752'>
  RETURN<a name='1753'>
END SUBROUTINE wrf_quilt_get_previous_time<a name='1754'>
<a name='1755'>
<A NAME='WRF_QUILT_SET_TIME'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_SET_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1756'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_set_time</font> ( DataHandle, Data,  Status ) <A href='../../call_to/WRF_QUILT_SET_TIME.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_SET_TIME.html' TARGET='index'>4</A><a name='1757'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1758'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1759'></font>
<font color=#447700>! Instruct the I/O quilt servers to set the time stamp in the dataset<a name='1760'></font>
<font color=#447700>! referenced by DataHandle.<a name='1761'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1762'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1763'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1764'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1765'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_11"><a name='1766'>
  IMPLICIT NONE<a name='1767'>
  INCLUDE 'mpif.h'<a name='1768'>
  INCLUDE 'intio_tags.h'<a name='1769'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1770'>
  CHARACTER*(*) , INTENT(IN)  :: Data<a name='1771'>
  INTEGER                     :: Status<a name='1772'>
  INTEGER i, typesize, itypesize, tasks_in_group, ierr, comm_io_group<a name='1773'>
  REAL dummy<a name='1774'>
  INTEGER                 :: Count<a name='1775'>
<font color=#447700>!<a name='1776'></font>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_117"> ( DEBUG_LVL, 'in wrf_quilt_set_time' )<a name='1777'>
<a name='1778'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles ) THEN<a name='1779'>
    IF ( int_handle_in_use( DataHandle ) ) THEN<a name='1780'>
      CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='1781'>
      Count = 0   <font color=#447700>! there is no count for character strings<a name='1782'></font>
      CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_TI_HEADER_CHAR'>int_gen_ti_header_char</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_TI_HEADER_CHAR_1">( hdrbuf, hdrbufsize, itypesize, &amp;<a name='1783'>
                              DataHandle, "TIMESTAMP", "", Data, int_set_time )<a name='1784'>
      iserver = 1 <font color=#447700>! only one server group for now<a name='1785'></font>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_6">( comm_io_group , iserver )<a name='1786'>
      CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='1787'>
      <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='1788'></font>
      CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='1789'>
                       MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='1790'></font>
                       comm_io_group, ierr )<a name='1791'>
      <font color=#447700>! send data to the i/o processor<a name='1792'></font>
      CALL collect_on_comm( comm_io_group,            &amp;<a name='1793'>
                            onebyte,                       &amp;<a name='1794'>
                            hdrbuf, hdrbufsize , &amp;<a name='1795'>
                            dummy, 0 )<a name='1796'>
    ENDIF<a name='1797'>
  ENDIF<a name='1798'>
<a name='1799'>
#endif<a name='1800'>
RETURN<a name='1801'>
END SUBROUTINE wrf_quilt_set_time<a name='1802'>
<a name='1803'>
<A NAME='WRF_QUILT_GET_NEXT_VAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_NEXT_VAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1804'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_next_var</font> ( DataHandle, VarName, Status ) <A href='../../call_to/WRF_QUILT_GET_NEXT_VAR.html' TARGET='index'>1</A><a name='1805'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1806'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1807'></font>
<font color=#447700>! When reading, instruct the I/O quilt servers to return the name of the next<a name='1808'></font>
<font color=#447700>! variable in the current time frame.<a name='1809'></font>
<font color=#447700>! This is not yet supported.<a name='1810'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1811'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1812'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1813'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1814'></font>
  IMPLICIT NONE<a name='1815'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1816'>
  CHARACTER*(*)               :: VarName<a name='1817'>
  INTEGER                     :: Status<a name='1818'>
#endif<a name='1819'>
  RETURN<a name='1820'>
END SUBROUTINE wrf_quilt_get_next_var<a name='1821'>
<a name='1822'>
<A NAME='WRF_QUILT_GET_DOM_TI_REAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1823'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_ti_real</font> ( DataHandle,Element,   Data, Count, Outcount, Status ),<A href='../../call_from/WRF_QUILT_GET_DOM_TI_REAL.html' TARGET='index'>1</A><a name='1824'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1825'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1826'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='1827'></font>
<font color=#447700>! independent domain metadata named "Element"<a name='1828'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='1829'></font>
<font color=#447700>! Metadata of type real are<a name='1830'></font>
<font color=#447700>! stored in array Data.<a name='1831'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='1832'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1833'></font>
<a name='1834'>
<font color=#447700>! This is not yet supported.<a name='1835'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1836'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1837'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1838'></font>
  IMPLICIT NONE<a name='1839'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1840'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='1841'>
  REAL,            INTENT(IN) :: Data(*)<a name='1842'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1843'>
  INTEGER                     :: Outcount<a name='1844'>
  INTEGER                     :: Status<a name='1845'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_13">('wrf_quilt_get_dom_ti_real not supported yet')<a name='1846'>
#endif<a name='1847'>
RETURN<a name='1848'>
END SUBROUTINE wrf_quilt_get_dom_ti_real <a name='1849'>
<a name='1850'>
<A NAME='WRF_QUILT_PUT_DOM_TI_REAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1851'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_ti_real</font> ( DataHandle,Element,   Data, Count,  Status ),<A href='../../call_from/WRF_QUILT_PUT_DOM_TI_REAL.html' TARGET='index'>5</A><a name='1852'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1853'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1854'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time independent<a name='1855'></font>
<font color=#447700>! domain metadata named "Element"<a name='1856'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='1857'></font>
<font color=#447700>! Metadata of type real are<a name='1858'></font>
<font color=#447700>! copied from array Data.<a name='1859'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1860'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1861'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1862'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1863'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_12"><a name='1864'>
  IMPLICIT NONE<a name='1865'>
  INCLUDE 'mpif.h'<a name='1866'>
  INCLUDE 'intio_tags.h'<a name='1867'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1868'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='1869'>
  real ,            INTENT(IN) :: Data(*)<a name='1870'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1871'>
  INTEGER                     :: Status<a name='1872'>
<font color=#447700>!Local<a name='1873'></font>
  CHARACTER*132   :: locElement<a name='1874'>
  INTEGER i, typesize, itypesize, tasks_in_group, ierr, comm_io_group<a name='1875'>
  REAL dummy<a name='1876'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1877'>
<font color=#447700>!<a name='1878'></font>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_118"> ( DEBUG_LVL, 'in wrf_quilt_put_dom_ti_real' ) <a name='1879'>
  CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='1880'>
  locElement = Element<a name='1881'>
<a name='1882'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles ) THEN<a name='1883'>
    IF ( int_handle_in_use( DataHandle ) ) THEN<a name='1884'>
      CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='1885'>
      CALL MPI_TYPE_SIZE( MPI_REAL, typesize, ierr )<a name='1886'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='1887'>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_TI_HEADER'>int_gen_ti_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_TI_HEADER_1">( hdrbuf, hdrbufsize, itypesize, typesize, &amp;<a name='1888'>
                                DataHandle, locElement, Data, Count, int_dom_ti_real )<a name='1889'>
      ELSE<a name='1890'>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_NOOP_HEADER'>int_gen_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_NOOP_HEADER_4">( hdrbuf, hdrbufsize, itypesize )<a name='1891'>
      ENDIF<a name='1892'>
      iserver = 1 <font color=#447700>! only one server group for now<a name='1893'></font>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_7">( comm_io_group , iserver )<a name='1894'>
      CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='1895'>
      <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='1896'></font>
      CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='1897'>
                       MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='1898'></font>
                       comm_io_group, ierr )<a name='1899'>
      <font color=#447700>! send data to the i/o processor<a name='1900'></font>
      CALL collect_on_comm( comm_io_group,            &amp;<a name='1901'>
                            onebyte,                       &amp;<a name='1902'>
                            hdrbuf, hdrbufsize , &amp;<a name='1903'>
                            dummy, 0 )<a name='1904'>
    ENDIF<a name='1905'>
  ENDIF<a name='1906'>
<a name='1907'>
  Status = 0<a name='1908'>
#endif<a name='1909'>
RETURN<a name='1910'>
END SUBROUTINE wrf_quilt_put_dom_ti_real <a name='1911'>
<a name='1912'>
<A NAME='WRF_QUILT_GET_DOM_TI_DOUBLE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1913'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_ti_double</font> ( DataHandle,Element,   Data, Count, Outcount, Status ),<A href='../../call_from/WRF_QUILT_GET_DOM_TI_DOUBLE.html' TARGET='index'>1</A><a name='1914'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1915'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1916'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='1917'></font>
<font color=#447700>! independent domain metadata named "Element"<a name='1918'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='1919'></font>
<font color=#447700>! Metadata of type double are<a name='1920'></font>
<font color=#447700>! stored in array Data.<a name='1921'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='1922'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1923'></font>
<font color=#447700>!<a name='1924'></font>
<font color=#447700>! This is not yet supported.<a name='1925'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1926'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1927'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1928'></font>
  IMPLICIT NONE<a name='1929'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1930'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='1931'>
  real*8                      :: Data(*)<a name='1932'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1933'>
  INTEGER                     :: OutCount<a name='1934'>
  INTEGER                     :: Status<a name='1935'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_14">('wrf_quilt_get_dom_ti_double not supported yet')<a name='1936'>
#endif<a name='1937'>
RETURN<a name='1938'>
END SUBROUTINE wrf_quilt_get_dom_ti_double <a name='1939'>
<a name='1940'>
<A NAME='WRF_QUILT_PUT_DOM_TI_DOUBLE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1941'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_ti_double</font> ( DataHandle,Element,   Data, Count,  Status ),<A href='../../call_from/WRF_QUILT_PUT_DOM_TI_DOUBLE.html' TARGET='index'>1</A><a name='1942'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1943'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1944'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time independent<a name='1945'></font>
<font color=#447700>! domain metadata named "Element"<a name='1946'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='1947'></font>
<font color=#447700>! Metadata of type double are<a name='1948'></font>
<font color=#447700>! copied from array Data.<a name='1949'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1950'></font>
<font color=#447700>!<a name='1951'></font>
<font color=#447700>! This is not yet supported.<a name='1952'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1953'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1954'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1955'></font>
  IMPLICIT NONE<a name='1956'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1957'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='1958'>
  real*8 ,            INTENT(IN) :: Data(*)<a name='1959'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1960'>
  INTEGER                     :: Status<a name='1961'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_15">('wrf_quilt_put_dom_ti_double not supported yet')<a name='1962'>
#endif<a name='1963'>
RETURN<a name='1964'>
END SUBROUTINE wrf_quilt_put_dom_ti_double <a name='1965'>
<a name='1966'>
<A NAME='WRF_QUILT_GET_DOM_TI_INTEGER'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1967'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_ti_integer</font> ( DataHandle,Element,   Data, Count, Outcount, Status ),<A href='../../call_from/WRF_QUILT_GET_DOM_TI_INTEGER.html' TARGET='index'>1</A><a name='1968'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1969'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1970'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='1971'></font>
<font color=#447700>! independent domain metadata named "Element"<a name='1972'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='1973'></font>
<font color=#447700>! Metadata of type integer are<a name='1974'></font>
<font color=#447700>! stored in array Data.<a name='1975'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='1976'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='1977'></font>
<font color=#447700>!<a name='1978'></font>
<font color=#447700>! This is not yet supported.<a name='1979'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1980'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1981'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='1982'></font>
  IMPLICIT NONE<a name='1983'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1984'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='1985'>
  integer                     :: Data(*)<a name='1986'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1987'>
  INTEGER                      :: OutCount<a name='1988'>
  INTEGER                     :: Status<a name='1989'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_16">('wrf_quilt_get_dom_ti_integer not supported yet')<a name='1990'>
#endif<a name='1991'>
RETURN<a name='1992'>
END SUBROUTINE wrf_quilt_get_dom_ti_integer <a name='1993'>
<a name='1994'>
<A NAME='WRF_QUILT_PUT_DOM_TI_INTEGER'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1995'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_ti_integer</font> ( DataHandle,Element,   Data, Count,  Status ),<A href='../../call_from/WRF_QUILT_PUT_DOM_TI_INTEGER.html' TARGET='index'>6</A><a name='1996'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1997'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1998'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time independent<a name='1999'></font>
<font color=#447700>! domain metadata named "Element"<a name='2000'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2001'></font>
<font color=#447700>! Metadata of type integer are<a name='2002'></font>
<font color=#447700>! copied from array Data.<a name='2003'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2004'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2005'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2006'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2007'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_13"><a name='2008'>
  IMPLICIT NONE<a name='2009'>
  INCLUDE 'mpif.h'<a name='2010'>
  INCLUDE 'intio_tags.h'<a name='2011'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2012'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2013'>
  INTEGER ,       INTENT(IN) :: Data(*)<a name='2014'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2015'>
  INTEGER                     :: Status<a name='2016'>
<font color=#447700>! Local<a name='2017'></font>
  CHARACTER*132   :: locElement<a name='2018'>
  INTEGER i, typesize, itypesize, tasks_in_group, ierr, comm_io_group<a name='2019'>
  REAL dummy<a name='2020'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='2021'>
<font color=#447700>!<a name='2022'></font>
<a name='2023'>
  locElement = Element<a name='2024'>
<a name='2025'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_119"> ( DEBUG_LVL, 'in wrf_quilt_put_dom_ti_integer' ) <a name='2026'>
<a name='2027'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles ) THEN<a name='2028'>
    IF ( int_handle_in_use( DataHandle ) ) THEN<a name='2029'>
      CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='2030'>
      CALL MPI_TYPE_SIZE( MPI_INTEGER, typesize, ierr )<a name='2031'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='2032'>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_TI_HEADER'>int_gen_ti_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_TI_HEADER_2">( hdrbuf, hdrbufsize, itypesize, typesize, &amp;<a name='2033'>
                                DataHandle, locElement, Data, Count, int_dom_ti_integer )<a name='2034'>
      ELSE<a name='2035'>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_NOOP_HEADER'>int_gen_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_NOOP_HEADER_5">( hdrbuf, hdrbufsize, itypesize )<a name='2036'>
      ENDIF<a name='2037'>
      iserver = 1 <font color=#447700>! only one server group for now<a name='2038'></font>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_8">( comm_io_group , iserver )<a name='2039'>
      CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='2040'>
      <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='2041'></font>
      CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='2042'>
                       MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='2043'></font>
                       comm_io_group, ierr )<a name='2044'>
      <font color=#447700>! send data to the i/o processor<a name='2045'></font>
      CALL collect_on_comm( comm_io_group,            &amp;<a name='2046'>
                            onebyte,                       &amp;<a name='2047'>
                            hdrbuf, hdrbufsize , &amp;<a name='2048'>
                            dummy, 0 )<a name='2049'>
    ENDIF<a name='2050'>
  ENDIF<a name='2051'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_120"> ( DEBUG_LVL, 'returning from wrf_quilt_put_dom_ti_integer' ) <a name='2052'>
<a name='2053'>
#endif<a name='2054'>
RETURN<a name='2055'>
END SUBROUTINE wrf_quilt_put_dom_ti_integer <a name='2056'>
<a name='2057'>
<A NAME='WRF_QUILT_GET_DOM_TI_LOGICAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2058'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_ti_logical</font> ( DataHandle,Element,   Data, Count, Outcount, Status ),<A href='../../call_from/WRF_QUILT_GET_DOM_TI_LOGICAL.html' TARGET='index'>1</A><a name='2059'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2060'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2061'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2062'></font>
<font color=#447700>! independent domain metadata named "Element"<a name='2063'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2064'></font>
<font color=#447700>! Metadata of type logical are<a name='2065'></font>
<font color=#447700>! stored in array Data.<a name='2066'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2067'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2068'></font>
<font color=#447700>!<a name='2069'></font>
<font color=#447700>! This is not yet supported.<a name='2070'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2071'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2072'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2073'></font>
  IMPLICIT NONE<a name='2074'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2075'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2076'>
  logical                     :: Data(*)<a name='2077'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2078'>
  INTEGER                      :: OutCount<a name='2079'>
  INTEGER                     :: Status<a name='2080'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_17">('wrf_quilt_get_dom_ti_logical not supported yet')<a name='2081'>
#endif<a name='2082'>
RETURN<a name='2083'>
END SUBROUTINE wrf_quilt_get_dom_ti_logical <a name='2084'>
<a name='2085'>
<A NAME='WRF_QUILT_PUT_DOM_TI_LOGICAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2086'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_ti_logical</font> ( DataHandle,Element,   Data, Count,  Status ),<A href='../../call_from/WRF_QUILT_PUT_DOM_TI_LOGICAL.html' TARGET='index'>1</A><a name='2087'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2088'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2089'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time independent<a name='2090'></font>
<font color=#447700>! domain metadata named "Element"<a name='2091'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2092'></font>
<font color=#447700>! Metadata of type logical are<a name='2093'></font>
<font color=#447700>! copied from array Data.<a name='2094'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2095'></font>
<font color=#447700>!<a name='2096'></font>
<font color=#447700>! This is not yet supported.<a name='2097'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2098'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2099'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2100'></font>
  IMPLICIT NONE<a name='2101'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2102'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2103'>
  logical ,            INTENT(IN) :: Data(*)<a name='2104'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2105'>
  INTEGER                     :: Status<a name='2106'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_18">('wrf_quilt_put_dom_ti_logical not supported yet')<a name='2107'>
#endif<a name='2108'>
RETURN<a name='2109'>
END SUBROUTINE wrf_quilt_put_dom_ti_logical <a name='2110'>
<a name='2111'>
<A NAME='WRF_QUILT_GET_DOM_TI_CHAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2112'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_ti_char</font> ( DataHandle,Element,   Data,  Status ),<A href='../../call_from/WRF_QUILT_GET_DOM_TI_CHAR.html' TARGET='index'>1</A><a name='2113'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2114'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2115'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read time independent<a name='2116'></font>
<font color=#447700>! domain metadata named "Element"<a name='2117'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2118'></font>
<font color=#447700>! Metadata of type char are<a name='2119'></font>
<font color=#447700>! stored in string Data.<a name='2120'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2121'></font>
<font color=#447700>!<a name='2122'></font>
<font color=#447700>! This is not yet supported.<a name='2123'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2124'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2125'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2126'></font>
  IMPLICIT NONE<a name='2127'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2128'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2129'>
  CHARACTER*(*)               :: Data<a name='2130'>
  INTEGER                     :: Status<a name='2131'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_19">('wrf_quilt_get_dom_ti_char not supported yet')<a name='2132'>
#endif<a name='2133'>
RETURN<a name='2134'>
END SUBROUTINE wrf_quilt_get_dom_ti_char <a name='2135'>
<a name='2136'>
<A NAME='WRF_QUILT_PUT_DOM_TI_CHAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2137'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_ti_char</font> ( DataHandle, Element,  Data,  Status ),<A href='../../call_from/WRF_QUILT_PUT_DOM_TI_CHAR.html' TARGET='index'>5</A><a name='2138'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2139'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2140'></font>
<font color=#447700>! Instruct the I/O quilt servers to write time independent<a name='2141'></font>
<font color=#447700>! domain metadata named "Element"<a name='2142'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2143'></font>
<font color=#447700>! Metadata of type char are<a name='2144'></font>
<font color=#447700>! copied from string Data.<a name='2145'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2146'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2147'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2148'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2149'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_14"><a name='2150'>
  IMPLICIT NONE<a name='2151'>
  INCLUDE 'mpif.h'<a name='2152'>
  INCLUDE 'intio_tags.h'<a name='2153'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2154'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2155'>
  CHARACTER*(*) , INTENT(IN)  :: Data<a name='2156'>
  INTEGER                     :: Status<a name='2157'>
  INTEGER i, typesize, itypesize, tasks_in_group, ierr, comm_io_group<a name='2158'>
  REAL dummy<a name='2159'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='2160'>
<font color=#447700>!<a name='2161'></font>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_121"> ( DEBUG_LVL, 'in wrf_quilt_put_dom_ti_char' ) <a name='2162'>
<a name='2163'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles ) THEN<a name='2164'>
    IF ( int_handle_in_use( DataHandle ) ) THEN<a name='2165'>
      CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='2166'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='2167'>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_TI_HEADER_CHAR'>int_gen_ti_header_char</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_TI_HEADER_CHAR_2">( hdrbuf, hdrbufsize, itypesize, &amp;<a name='2168'>
                                DataHandle, Element, "", Data, int_dom_ti_char )<a name='2169'>
      ELSE<a name='2170'>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_NOOP_HEADER'>int_gen_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_NOOP_HEADER_6">( hdrbuf, hdrbufsize, itypesize )<a name='2171'>
      ENDIF<a name='2172'>
      iserver = 1 <font color=#447700>! only one server group for now<a name='2173'></font>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_9">( comm_io_group , iserver )<a name='2174'>
      CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='2175'>
      <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='2176'></font>
      CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='2177'>
                       MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='2178'></font>
                       comm_io_group, ierr )<a name='2179'>
      <font color=#447700>! send data to the i/o processor<a name='2180'></font>
      CALL collect_on_comm( comm_io_group,            &amp;<a name='2181'>
                            onebyte,                       &amp;<a name='2182'>
                            hdrbuf, hdrbufsize , &amp;<a name='2183'>
                            dummy, 0 )<a name='2184'>
    ENDIF<a name='2185'>
  ENDIF<a name='2186'>
<a name='2187'>
#endif<a name='2188'>
RETURN<a name='2189'>
END SUBROUTINE wrf_quilt_put_dom_ti_char <a name='2190'>
<a name='2191'>
<A NAME='WRF_QUILT_GET_DOM_TD_REAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TD_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2192'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_td_real</font> ( DataHandle,Element, DateStr,  Data, Count, Outcount, Status )<a name='2193'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2194'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2195'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2196'></font>
<font color=#447700>! dependent domain metadata named "Element" valid at time DateStr<a name='2197'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2198'></font>
<font color=#447700>! Metadata of type real are<a name='2199'></font>
<font color=#447700>! stored in array Data.<a name='2200'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2201'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2202'></font>
<font color=#447700>!<a name='2203'></font>
<font color=#447700>! This is not yet supported.<a name='2204'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2205'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2206'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2207'></font>
  IMPLICIT NONE<a name='2208'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2209'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2210'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2211'>
  real                        :: Data(*)<a name='2212'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2213'>
  INTEGER                     :: OutCount<a name='2214'>
  INTEGER                     :: Status<a name='2215'>
#endif<a name='2216'>
RETURN<a name='2217'>
END SUBROUTINE wrf_quilt_get_dom_td_real <a name='2218'>
<a name='2219'>
<A NAME='WRF_QUILT_PUT_DOM_TD_REAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TD_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2220'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_td_real</font> ( DataHandle,Element, DateStr,  Data, Count,  Status )<a name='2221'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2222'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2223'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time dependent<a name='2224'></font>
<font color=#447700>! domain metadata named "Element" valid at time DateStr<a name='2225'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2226'></font>
<font color=#447700>! Metadata of type real are<a name='2227'></font>
<font color=#447700>! copied from array Data.<a name='2228'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2229'></font>
<font color=#447700>!<a name='2230'></font>
<font color=#447700>! This is not yet supported.<a name='2231'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2232'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2233'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2234'></font>
  IMPLICIT NONE<a name='2235'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2236'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2237'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2238'>
  real ,            INTENT(IN) :: Data(*)<a name='2239'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2240'>
  INTEGER                     :: Status<a name='2241'>
#endif<a name='2242'>
RETURN<a name='2243'>
END SUBROUTINE wrf_quilt_put_dom_td_real <a name='2244'>
<a name='2245'>
<A NAME='WRF_QUILT_GET_DOM_TD_DOUBLE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TD_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2246'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_td_double</font> ( DataHandle,Element, DateStr,  Data, Count, Outcount, Status )<a name='2247'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2248'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2249'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2250'></font>
<font color=#447700>! dependent domain metadata named "Element" valid at time DateStr<a name='2251'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2252'></font>
<font color=#447700>! Metadata of type double are<a name='2253'></font>
<font color=#447700>! stored in array Data.<a name='2254'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2255'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2256'></font>
<font color=#447700>!<a name='2257'></font>
<font color=#447700>! This is not yet supported.<a name='2258'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2259'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2260'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2261'></font>
  IMPLICIT NONE<a name='2262'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2263'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2264'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2265'>
  real*8                          :: Data(*)<a name='2266'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2267'>
  INTEGER                      :: OutCount<a name='2268'>
  INTEGER                     :: Status<a name='2269'>
#endif<a name='2270'>
RETURN<a name='2271'>
END SUBROUTINE wrf_quilt_get_dom_td_double <a name='2272'>
<a name='2273'>
<A NAME='WRF_QUILT_PUT_DOM_TD_DOUBLE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TD_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2274'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_td_double</font> ( DataHandle,Element, DateStr,  Data, Count,  Status )<a name='2275'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2276'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2277'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time dependent<a name='2278'></font>
<font color=#447700>! domain metadata named "Element" valid at time DateStr<a name='2279'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2280'></font>
<font color=#447700>! Metadata of type double are<a name='2281'></font>
<font color=#447700>! copied from array Data.<a name='2282'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2283'></font>
<font color=#447700>!<a name='2284'></font>
<font color=#447700>! This is not yet supported.<a name='2285'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2286'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2287'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2288'></font>
  IMPLICIT NONE<a name='2289'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2290'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2291'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2292'>
  real*8 ,            INTENT(IN) :: Data(*)<a name='2293'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2294'>
  INTEGER                     :: Status<a name='2295'>
#endif<a name='2296'>
RETURN<a name='2297'>
END SUBROUTINE wrf_quilt_put_dom_td_double <a name='2298'>
<a name='2299'>
<A NAME='WRF_QUILT_GET_DOM_TD_INTEGER'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TD_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2300'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_td_integer</font> ( DataHandle,Element, DateStr,  Data, Count, Outcount, Status )<a name='2301'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2302'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2303'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2304'></font>
<font color=#447700>! dependent domain metadata named "Element" valid at time DateStr<a name='2305'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2306'></font>
<font color=#447700>! Metadata of type integer are<a name='2307'></font>
<font color=#447700>! stored in array Data.<a name='2308'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2309'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2310'></font>
<font color=#447700>!<a name='2311'></font>
<font color=#447700>! This is not yet supported.<a name='2312'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2313'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2314'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2315'></font>
  IMPLICIT NONE<a name='2316'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2317'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2318'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2319'>
  integer                          :: Data(*)<a name='2320'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2321'>
  INTEGER                      :: OutCount<a name='2322'>
  INTEGER                     :: Status<a name='2323'>
#endif<a name='2324'>
RETURN<a name='2325'>
END SUBROUTINE wrf_quilt_get_dom_td_integer <a name='2326'>
<a name='2327'>
<A NAME='WRF_QUILT_PUT_DOM_TD_INTEGER'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TD_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2328'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_td_integer</font> ( DataHandle,Element, DateStr,  Data, Count,  Status )<a name='2329'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2330'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2331'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time dependent<a name='2332'></font>
<font color=#447700>! domain metadata named "Element" valid at time DateStr<a name='2333'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2334'></font>
<font color=#447700>! Metadata of type integer are<a name='2335'></font>
<font color=#447700>! copied from array Data.<a name='2336'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2337'></font>
<font color=#447700>!<a name='2338'></font>
<font color=#447700>! This is not yet supported.<a name='2339'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2340'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2341'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2342'></font>
  IMPLICIT NONE<a name='2343'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2344'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2345'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2346'>
  integer ,            INTENT(IN) :: Data(*)<a name='2347'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2348'>
  INTEGER                     :: Status<a name='2349'>
#endif<a name='2350'>
RETURN<a name='2351'>
END SUBROUTINE wrf_quilt_put_dom_td_integer <a name='2352'>
<a name='2353'>
<A NAME='WRF_QUILT_GET_DOM_TD_LOGICAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TD_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2354'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_td_logical</font> ( DataHandle,Element, DateStr,  Data, Count, Outcount, Status )<a name='2355'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2356'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2357'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2358'></font>
<font color=#447700>! dependent domain metadata named "Element" valid at time DateStr<a name='2359'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2360'></font>
<font color=#447700>! Metadata of type logical are<a name='2361'></font>
<font color=#447700>! stored in array Data.<a name='2362'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2363'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2364'></font>
<font color=#447700>!<a name='2365'></font>
<font color=#447700>! This is not yet supported.<a name='2366'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2367'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2368'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2369'></font>
  IMPLICIT NONE<a name='2370'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2371'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2372'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2373'>
  logical                          :: Data(*)<a name='2374'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2375'>
  INTEGER                      :: OutCount<a name='2376'>
  INTEGER                     :: Status<a name='2377'>
#endif<a name='2378'>
RETURN<a name='2379'>
END SUBROUTINE wrf_quilt_get_dom_td_logical <a name='2380'>
<a name='2381'>
<A NAME='WRF_QUILT_PUT_DOM_TD_LOGICAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TD_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2382'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_td_logical</font> ( DataHandle,Element, DateStr,  Data, Count,  Status )<a name='2383'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2384'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2385'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time dependent<a name='2386'></font>
<font color=#447700>! domain metadata named "Element" valid at time DateStr<a name='2387'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2388'></font>
<font color=#447700>! Metadata of type logical are<a name='2389'></font>
<font color=#447700>! copied from array Data.<a name='2390'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2391'></font>
<font color=#447700>!<a name='2392'></font>
<font color=#447700>! This is not yet supported.<a name='2393'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2394'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2395'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2396'></font>
  IMPLICIT NONE<a name='2397'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2398'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2399'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2400'>
  logical ,            INTENT(IN) :: Data(*)<a name='2401'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2402'>
  INTEGER                     :: Status<a name='2403'>
#endif<a name='2404'>
RETURN<a name='2405'>
END SUBROUTINE wrf_quilt_put_dom_td_logical <a name='2406'>
<a name='2407'>
<A NAME='WRF_QUILT_GET_DOM_TD_CHAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_DOM_TD_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2408'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_dom_td_char</font> ( DataHandle,Element, DateStr,  Data,  Status )<a name='2409'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2410'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2411'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read time dependent<a name='2412'></font>
<font color=#447700>! domain metadata named "Element" valid at time DateStr<a name='2413'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2414'></font>
<font color=#447700>! Metadata of type char are<a name='2415'></font>
<font color=#447700>! stored in string Data.<a name='2416'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2417'></font>
<font color=#447700>!<a name='2418'></font>
<font color=#447700>! This is not yet supported.<a name='2419'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2420'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2421'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2422'></font>
  IMPLICIT NONE<a name='2423'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2424'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2425'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2426'>
  CHARACTER*(*)               :: Data<a name='2427'>
  INTEGER                     :: Status<a name='2428'>
#endif<a name='2429'>
RETURN<a name='2430'>
END SUBROUTINE wrf_quilt_get_dom_td_char <a name='2431'>
<a name='2432'>
<A NAME='WRF_QUILT_PUT_DOM_TD_CHAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_DOM_TD_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2433'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_dom_td_char</font> ( DataHandle,Element, DateStr,  Data,  Status )<a name='2434'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2435'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2436'></font>
<font color=#447700>! Instruct $he I/O quilt servers to write time dependent<a name='2437'></font>
<font color=#447700>! domain metadata named "Element" valid at time DateStr<a name='2438'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2439'></font>
<font color=#447700>! Metadata of type char are<a name='2440'></font>
<font color=#447700>! copied from string Data.<a name='2441'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2442'></font>
<font color=#447700>!<a name='2443'></font>
<font color=#447700>! This is not yet supported.<a name='2444'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2445'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2446'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2447'></font>
  IMPLICIT NONE<a name='2448'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2449'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2450'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2451'>
  CHARACTER*(*) , INTENT(IN) :: Data<a name='2452'>
  INTEGER                          :: Status<a name='2453'>
#endif<a name='2454'>
RETURN<a name='2455'>
END SUBROUTINE wrf_quilt_put_dom_td_char <a name='2456'>
<a name='2457'>
<A NAME='WRF_QUILT_GET_VAR_TI_REAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TI_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2458'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_ti_real</font> ( DataHandle,Element,  Varname, Data, Count, Outcount, Status )<a name='2459'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2460'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2461'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2462'></font>
<font color=#447700>! independent attribute "Element" of variable "Varname"<a name='2463'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2464'></font>
<font color=#447700>! Attribute of type real is<a name='2465'></font>
<font color=#447700>! stored in array Data.<a name='2466'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2467'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2468'></font>
<font color=#447700>!<a name='2469'></font>
<font color=#447700>! This is not yet supported.<a name='2470'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2471'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2472'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2473'></font>
  IMPLICIT NONE<a name='2474'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2475'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2476'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2477'>
  real                          :: Data(*)<a name='2478'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2479'>
  INTEGER                     :: OutCount<a name='2480'>
  INTEGER                     :: Status<a name='2481'>
#endif<a name='2482'>
RETURN<a name='2483'>
END SUBROUTINE wrf_quilt_get_var_ti_real <a name='2484'>
<a name='2485'>
<A NAME='WRF_QUILT_PUT_VAR_TI_REAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2486'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_ti_real</font> ( DataHandle,Element,  Varname, Data, Count,  Status )<a name='2487'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2488'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2489'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time independent<a name='2490'></font>
<font color=#447700>! attribute "Element" of variable "Varname"<a name='2491'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2492'></font>
<font color=#447700>! Attribute of type real is<a name='2493'></font>
<font color=#447700>! copied from array Data.<a name='2494'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2495'></font>
<font color=#447700>!<a name='2496'></font>
<font color=#447700>! This is not yet supported.<a name='2497'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2498'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2499'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2500'></font>
  IMPLICIT NONE<a name='2501'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2502'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2503'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2504'>
  real ,            INTENT(IN) :: Data(*)<a name='2505'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2506'>
  INTEGER                     :: Status<a name='2507'>
#endif<a name='2508'>
RETURN<a name='2509'>
END SUBROUTINE wrf_quilt_put_var_ti_real <a name='2510'>
<a name='2511'>
<A NAME='WRF_QUILT_GET_VAR_TI_DOUBLE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TI_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2512'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_ti_double</font> ( DataHandle,Element,  Varname, Data, Count, Outcount, Status )<a name='2513'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2514'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2515'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2516'></font>
<font color=#447700>! independent attribute "Element" of variable "Varname"<a name='2517'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2518'></font>
<font color=#447700>! Attribute of type double is<a name='2519'></font>
<font color=#447700>! stored in array Data.<a name='2520'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2521'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2522'></font>
<font color=#447700>!<a name='2523'></font>
<font color=#447700>! This is not yet supported.<a name='2524'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2525'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2526'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2527'></font>
  IMPLICIT NONE<a name='2528'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2529'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2530'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2531'>
  real*8                      :: Data(*)<a name='2532'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2533'>
  INTEGER                     :: OutCount<a name='2534'>
  INTEGER                     :: Status<a name='2535'>
#endif<a name='2536'>
RETURN<a name='2537'>
END SUBROUTINE wrf_quilt_get_var_ti_double <a name='2538'>
<a name='2539'>
<A NAME='WRF_QUILT_PUT_VAR_TI_DOUBLE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2540'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_ti_double</font> ( DataHandle,Element,  Varname, Data, Count,  Status )<a name='2541'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2542'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2543'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time independent<a name='2544'></font>
<font color=#447700>! attribute "Element" of variable "Varname"<a name='2545'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2546'></font>
<font color=#447700>! Attribute of type double is<a name='2547'></font>
<font color=#447700>! copied from array Data.<a name='2548'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2549'></font>
<font color=#447700>!<a name='2550'></font>
<font color=#447700>! This is not yet supported.<a name='2551'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2552'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2553'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2554'></font>
  IMPLICIT NONE<a name='2555'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2556'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2557'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2558'>
  real*8 ,        INTENT(IN) :: Data(*)<a name='2559'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2560'>
  INTEGER                     :: Status<a name='2561'>
#endif<a name='2562'>
RETURN<a name='2563'>
END SUBROUTINE wrf_quilt_put_var_ti_double <a name='2564'>
<a name='2565'>
<A NAME='WRF_QUILT_GET_VAR_TI_INTEGER'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TI_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2566'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_ti_integer</font> ( DataHandle,Element,  Varname, Data, Count, Outcount, Status )<a name='2567'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2568'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2569'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2570'></font>
<font color=#447700>! independent attribute "Element" of variable "Varname"<a name='2571'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2572'></font>
<font color=#447700>! Attribute of type integer is<a name='2573'></font>
<font color=#447700>! stored in array Data.<a name='2574'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2575'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2576'></font>
<font color=#447700>!<a name='2577'></font>
<font color=#447700>! This is not yet supported.<a name='2578'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2579'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2580'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2581'></font>
  IMPLICIT NONE<a name='2582'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2583'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2584'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2585'>
  integer                     :: Data(*)<a name='2586'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2587'>
  INTEGER                     :: OutCount<a name='2588'>
  INTEGER                     :: Status<a name='2589'>
#endif<a name='2590'>
RETURN<a name='2591'>
END SUBROUTINE wrf_quilt_get_var_ti_integer <a name='2592'>
<a name='2593'>
<A NAME='WRF_QUILT_PUT_VAR_TI_INTEGER'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2594'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_ti_integer</font> ( DataHandle,Element,  Varname, Data, Count,  Status )<a name='2595'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2596'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2597'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time independent<a name='2598'></font>
<font color=#447700>! attribute "Element" of variable "Varname"<a name='2599'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2600'></font>
<font color=#447700>! Attribute of type integer is<a name='2601'></font>
<font color=#447700>! copied from array Data.<a name='2602'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2603'></font>
<font color=#447700>!<a name='2604'></font>
<font color=#447700>! This is not yet supported.<a name='2605'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2606'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2607'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2608'></font>
  IMPLICIT NONE<a name='2609'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2610'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2611'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2612'>
  integer ,            INTENT(IN) :: Data(*)<a name='2613'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2614'>
  INTEGER                     :: Status<a name='2615'>
#endif<a name='2616'>
RETURN<a name='2617'>
END SUBROUTINE wrf_quilt_put_var_ti_integer <a name='2618'>
<a name='2619'>
<A NAME='WRF_QUILT_GET_VAR_TI_LOGICAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TI_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2620'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_ti_logical</font> ( DataHandle,Element,  Varname, Data, Count, Outcount, Status )<a name='2621'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2622'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2623'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2624'></font>
<font color=#447700>! independent attribute "Element" of variable "Varname"<a name='2625'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2626'></font>
<font color=#447700>! Attribute of type logical is<a name='2627'></font>
<font color=#447700>! stored in array Data.<a name='2628'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2629'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2630'></font>
<font color=#447700>!<a name='2631'></font>
<font color=#447700>! This is not yet supported.<a name='2632'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2633'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2634'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2635'></font>
  IMPLICIT NONE<a name='2636'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2637'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2638'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2639'>
  logical                     :: Data(*)<a name='2640'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2641'>
  INTEGER                     :: OutCount<a name='2642'>
  INTEGER                     :: Status<a name='2643'>
#endif<a name='2644'>
RETURN<a name='2645'>
END SUBROUTINE wrf_quilt_get_var_ti_logical <a name='2646'>
<a name='2647'>
<A NAME='WRF_QUILT_PUT_VAR_TI_LOGICAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2648'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_ti_logical</font> ( DataHandle,Element,  Varname, Data, Count,  Status )<a name='2649'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2650'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2651'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time independent<a name='2652'></font>
<font color=#447700>! attribute "Element" of variable "Varname"<a name='2653'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2654'></font>
<font color=#447700>! Attribute of type logical is<a name='2655'></font>
<font color=#447700>! copied from array Data.<a name='2656'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2657'></font>
<font color=#447700>!<a name='2658'></font>
<font color=#447700>! This is not yet supported.<a name='2659'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2660'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2661'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2662'></font>
  IMPLICIT NONE<a name='2663'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2664'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2665'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2666'>
  logical ,            INTENT(IN) :: Data(*)<a name='2667'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2668'>
  INTEGER                     :: Status<a name='2669'>
#endif<a name='2670'>
RETURN<a name='2671'>
END SUBROUTINE wrf_quilt_put_var_ti_logical <a name='2672'>
<a name='2673'>
<A NAME='WRF_QUILT_GET_VAR_TI_CHAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TI_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2674'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_ti_char</font> ( DataHandle,Element,  Varname, Data,  Status )<a name='2675'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2676'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2677'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read time independent<a name='2678'></font>
<font color=#447700>! attribute "Element" of variable "Varname"<a name='2679'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2680'></font>
<font color=#447700>! Attribute of type char is<a name='2681'></font>
<font color=#447700>! stored in string Data.<a name='2682'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2683'></font>
<font color=#447700>!<a name='2684'></font>
<font color=#447700>! This is not yet supported.<a name='2685'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2686'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2687'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2688'></font>
  IMPLICIT NONE<a name='2689'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2690'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2691'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2692'>
  CHARACTER*(*)               :: Data<a name='2693'>
  INTEGER                     :: Status<a name='2694'>
#endif<a name='2695'>
RETURN<a name='2696'>
END SUBROUTINE wrf_quilt_get_var_ti_char <a name='2697'>
<a name='2698'>
<A NAME='WRF_QUILT_PUT_VAR_TI_CHAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2699'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_ti_char</font> ( DataHandle,Element,  Varname, Data,  Status ),<A href='../../call_from/WRF_QUILT_PUT_VAR_TI_CHAR.html' TARGET='index'>5</A><a name='2700'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2701'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2702'></font>
<font color=#447700>! Instruct the I/O quilt servers to write time independent<a name='2703'></font>
<font color=#447700>! attribute "Element" of variable "Varname"<a name='2704'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2705'></font>
<font color=#447700>! Attribute of type char is<a name='2706'></font>
<font color=#447700>! copied from string Data.<a name='2707'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2708'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2709'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2710'></font>
<a name='2711'>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2712'></font>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_15"><a name='2713'>
  IMPLICIT NONE<a name='2714'>
  INCLUDE 'mpif.h'<a name='2715'>
  INCLUDE 'intio_tags.h'<a name='2716'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2717'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2718'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2719'>
  CHARACTER*(*) , INTENT(IN)  :: Data<a name='2720'>
  INTEGER                     :: Status<a name='2721'>
  INTEGER i, typesize, itypesize, tasks_in_group, ierr, comm_io_group<a name='2722'>
  REAL dummy<a name='2723'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='2724'>
<font color=#447700>!<a name='2725'></font>
<a name='2726'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_122"> ( DEBUG_LVL, 'in wrf_quilt_put_var_ti_char' ) <a name='2727'>
<a name='2728'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles ) THEN<a name='2729'>
    IF ( int_handle_in_use( DataHandle ) ) THEN<a name='2730'>
      CALL MPI_TYPE_SIZE( MPI_INTEGER, itypesize, ierr )<a name='2731'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='2732'>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_TI_HEADER_CHAR'>int_gen_ti_header_char</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_TI_HEADER_CHAR_3">( hdrbuf, hdrbufsize, itypesize, &amp;<a name='2733'>
                                DataHandle, TRIM(Element), TRIM(VarName), TRIM(Data), int_var_ti_char )<a name='2734'>
      ELSE<a name='2735'>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_NOOP_HEADER'>int_gen_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_NOOP_HEADER_7">( hdrbuf, hdrbufsize, itypesize )<a name='2736'>
      ENDIF<a name='2737'>
      iserver = 1 <font color=#447700>! only one server group for now<a name='2738'></font>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_10">( comm_io_group , iserver )<a name='2739'>
      CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='2740'>
      <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='2741'></font>
      CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='2742'>
                       MPI_SUM, tasks_in_group-1,          &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='2743'></font>
                       comm_io_group, ierr )<a name='2744'>
      <font color=#447700>! send data to the i/o processor<a name='2745'></font>
      CALL collect_on_comm( comm_io_group,            &amp;<a name='2746'>
                            onebyte,                       &amp;<a name='2747'>
                            hdrbuf, hdrbufsize , &amp;<a name='2748'>
                            dummy, 0 )<a name='2749'>
    ENDIF<a name='2750'>
  ENDIF<a name='2751'>
<a name='2752'>
#endif<a name='2753'>
RETURN<a name='2754'>
END SUBROUTINE wrf_quilt_put_var_ti_char <a name='2755'>
<a name='2756'>
<A NAME='WRF_QUILT_GET_VAR_TD_REAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TD_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2757'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_td_real</font> ( DataHandle,Element,  DateStr,Varname, Data, Count, Outcount, Status )<a name='2758'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2759'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2760'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2761'></font>
<font color=#447700>! dependent attribute "Element" of variable "Varname" valid at time DateStr<a name='2762'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2763'></font>
<font color=#447700>! Attribute of type real is<a name='2764'></font>
<font color=#447700>! stored in array Data.<a name='2765'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2766'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2767'></font>
<font color=#447700>!<a name='2768'></font>
<font color=#447700>! This is not yet supported.<a name='2769'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2770'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2771'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2772'></font>
  IMPLICIT NONE<a name='2773'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2774'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2775'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2776'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2777'>
  real                        :: Data(*)<a name='2778'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2779'>
  INTEGER                     :: OutCount<a name='2780'>
  INTEGER                     :: Status<a name='2781'>
#endif<a name='2782'>
RETURN<a name='2783'>
END SUBROUTINE wrf_quilt_get_var_td_real <a name='2784'>
<a name='2785'>
<A NAME='WRF_QUILT_PUT_VAR_TD_REAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TD_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2786'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_td_real</font> ( DataHandle,Element,  DateStr,Varname, Data, Count,  Status )<a name='2787'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2788'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2789'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time dependent<a name='2790'></font>
<font color=#447700>! attribute "Element" of variable "Varname" valid at time DateStr<a name='2791'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2792'></font>
<font color=#447700>! Attribute of type real is<a name='2793'></font>
<font color=#447700>! copied from array Data.<a name='2794'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2795'></font>
<font color=#447700>!<a name='2796'></font>
<font color=#447700>! This is not yet supported.<a name='2797'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2798'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2799'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2800'></font>
  IMPLICIT NONE<a name='2801'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2802'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2803'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2804'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2805'>
  real ,            INTENT(IN) :: Data(*)<a name='2806'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2807'>
  INTEGER                     :: Status<a name='2808'>
#endif<a name='2809'>
RETURN<a name='2810'>
END SUBROUTINE wrf_quilt_put_var_td_real <a name='2811'>
<a name='2812'>
<A NAME='WRF_QUILT_GET_VAR_TD_DOUBLE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TD_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2813'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_td_double</font> ( DataHandle,Element,  DateStr,Varname, Data, Count, Outcount, Status )<a name='2814'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2815'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2816'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2817'></font>
<font color=#447700>! dependent attribute "Element" of variable "Varname" valid at time DateStr<a name='2818'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2819'></font>
<font color=#447700>! Attribute of type double is<a name='2820'></font>
<font color=#447700>! stored in array Data.<a name='2821'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2822'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2823'></font>
<font color=#447700>!<a name='2824'></font>
<font color=#447700>! This is not yet supported.<a name='2825'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2826'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2827'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2828'></font>
  IMPLICIT NONE<a name='2829'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2830'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2831'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2832'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2833'>
  real*8                      :: Data(*)<a name='2834'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2835'>
  INTEGER                     :: OutCount<a name='2836'>
  INTEGER                     :: Status<a name='2837'>
#endif<a name='2838'>
RETURN<a name='2839'>
END SUBROUTINE wrf_quilt_get_var_td_double <a name='2840'>
<a name='2841'>
<A NAME='WRF_QUILT_PUT_VAR_TD_DOUBLE'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TD_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2842'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_td_double</font> ( DataHandle,Element,  DateStr,Varname, Data, Count,  Status )<a name='2843'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2844'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2845'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time dependent<a name='2846'></font>
<font color=#447700>! attribute "Element" of variable "Varname" valid at time DateStr<a name='2847'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2848'></font>
<font color=#447700>! Attribute of type double is<a name='2849'></font>
<font color=#447700>! copied from array Data.<a name='2850'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2851'></font>
<font color=#447700>!<a name='2852'></font>
<font color=#447700>! This is not yet supported.<a name='2853'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2854'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2855'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2856'></font>
  IMPLICIT NONE<a name='2857'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2858'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2859'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2860'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2861'>
  real*8 ,            INTENT(IN) :: Data(*)<a name='2862'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2863'>
  INTEGER                     :: Status<a name='2864'>
#endif<a name='2865'>
RETURN<a name='2866'>
END SUBROUTINE wrf_quilt_put_var_td_double <a name='2867'>
<a name='2868'>
<A NAME='WRF_QUILT_GET_VAR_TD_INTEGER'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TD_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2869'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_td_integer</font> ( DataHandle,Element,  DateStr,Varname, Data, Count, Outcount,Status)<a name='2870'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2871'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2872'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2873'></font>
<font color=#447700>! dependent attribute "Element" of variable "Varname" valid at time DateStr<a name='2874'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2875'></font>
<font color=#447700>! Attribute of type integer is<a name='2876'></font>
<font color=#447700>! stored in array Data.<a name='2877'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2878'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2879'></font>
<font color=#447700>!<a name='2880'></font>
<font color=#447700>! This is not yet supported.<a name='2881'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2882'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2883'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2884'></font>
  IMPLICIT NONE<a name='2885'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2886'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2887'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2888'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2889'>
  integer                     :: Data(*)<a name='2890'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2891'>
  INTEGER                     :: OutCount<a name='2892'>
  INTEGER                     :: Status<a name='2893'>
#endif<a name='2894'>
RETURN<a name='2895'>
END SUBROUTINE wrf_quilt_get_var_td_integer <a name='2896'>
<a name='2897'>
<A NAME='WRF_QUILT_PUT_VAR_TD_INTEGER'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TD_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2898'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_td_integer</font> ( DataHandle,Element,  DateStr,Varname, Data, Count,  Status )<a name='2899'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2900'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2901'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time dependent<a name='2902'></font>
<font color=#447700>! attribute "Element" of variable "Varname" valid at time DateStr<a name='2903'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2904'></font>
<font color=#447700>! Attribute of type integer is<a name='2905'></font>
<font color=#447700>! copied from array Data.<a name='2906'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2907'></font>
<font color=#447700>!<a name='2908'></font>
<font color=#447700>! This is not yet supported.<a name='2909'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2910'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2911'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2912'></font>
  IMPLICIT NONE<a name='2913'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2914'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2915'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2916'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2917'>
  integer ,       INTENT(IN)  :: Data(*)<a name='2918'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2919'>
  INTEGER                     :: Status<a name='2920'>
#endif<a name='2921'>
RETURN<a name='2922'>
END SUBROUTINE wrf_quilt_put_var_td_integer <a name='2923'>
<a name='2924'>
<A NAME='WRF_QUILT_GET_VAR_TD_LOGICAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TD_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2925'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_td_logical</font> ( DataHandle,Element,  DateStr,Varname, Data, Count, Outcount, Status )<a name='2926'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2927'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2928'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read Count words of time<a name='2929'></font>
<font color=#447700>! dependent attribute "Element" of variable "Varname" valid at time DateStr<a name='2930'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2931'></font>
<font color=#447700>! Attribute of type logical is<a name='2932'></font>
<font color=#447700>! stored in array Data.<a name='2933'></font>
<font color=#447700>! Actual number of words read is returned in OutCount.<a name='2934'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2935'></font>
<font color=#447700>!<a name='2936'></font>
<font color=#447700>! This is not yet supported.<a name='2937'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2938'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2939'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2940'></font>
  IMPLICIT NONE<a name='2941'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2942'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2943'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2944'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2945'>
  logical                          :: Data(*)<a name='2946'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2947'>
  INTEGER                      :: OutCount<a name='2948'>
  INTEGER                     :: Status<a name='2949'>
#endif<a name='2950'>
RETURN<a name='2951'>
END SUBROUTINE wrf_quilt_get_var_td_logical <a name='2952'>
<a name='2953'>
<A NAME='WRF_QUILT_PUT_VAR_TD_LOGICAL'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TD_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2954'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_td_logical</font> ( DataHandle,Element,  DateStr,Varname, Data, Count,  Status )<a name='2955'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2956'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2957'></font>
<font color=#447700>! Instruct the I/O quilt servers to write Count words of time dependent<a name='2958'></font>
<font color=#447700>! attribute "Element" of variable "Varname" valid at time DateStr<a name='2959'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='2960'></font>
<font color=#447700>! Attribute of type logical is<a name='2961'></font>
<font color=#447700>! copied from array Data.<a name='2962'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2963'></font>
<font color=#447700>!<a name='2964'></font>
<font color=#447700>! This is not yet supported.<a name='2965'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2966'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2967'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2968'></font>
  IMPLICIT NONE<a name='2969'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2970'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2971'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2972'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='2973'>
  logical ,            INTENT(IN) :: Data(*)<a name='2974'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2975'>
  INTEGER                     :: Status<a name='2976'>
#endif<a name='2977'>
RETURN<a name='2978'>
END SUBROUTINE wrf_quilt_put_var_td_logical <a name='2979'>
<a name='2980'>
<A NAME='WRF_QUILT_GET_VAR_TD_CHAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_TD_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2981'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_td_char</font> ( DataHandle,Element,  DateStr,Varname, Data,  Status )<a name='2982'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2983'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2984'></font>
<font color=#447700>! Instruct the I/O quilt servers to attempt to read time dependent<a name='2985'></font>
<font color=#447700>! attribute "Element" of variable "Varname" valid at time DateStr<a name='2986'></font>
<font color=#447700>! from the open dataset described by DataHandle.<a name='2987'></font>
<font color=#447700>! Attribute of type char is<a name='2988'></font>
<font color=#447700>! stored in string Data.<a name='2989'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='2990'></font>
<font color=#447700>!<a name='2991'></font>
<font color=#447700>! This is not yet supported.<a name='2992'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2993'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2994'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='2995'></font>
  IMPLICIT NONE<a name='2996'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2997'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2998'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2999'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='3000'>
  CHARACTER*(*)               :: Data<a name='3001'>
  INTEGER                     :: Status<a name='3002'>
#endif<a name='3003'>
RETURN<a name='3004'>
END SUBROUTINE wrf_quilt_get_var_td_char <a name='3005'>
<a name='3006'>
<A NAME='WRF_QUILT_PUT_VAR_TD_CHAR'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_PUT_VAR_TD_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3007'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_put_var_td_char</font> ( DataHandle,Element,  DateStr,Varname, Data,  Status )<a name='3008'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3009'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3010'></font>
<font color=#447700>! Instruct the I/O quilt servers to write time dependent<a name='3011'></font>
<font color=#447700>! attribute "Element" of variable "Varname" valid at time DateStr<a name='3012'></font>
<font color=#447700>! to the open dataset described by DataHandle.<a name='3013'></font>
<font color=#447700>! Attribute of type char is<a name='3014'></font>
<font color=#447700>! copied from string Data.<a name='3015'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='3016'></font>
<font color=#447700>!<a name='3017'></font>
<font color=#447700>! This is not yet supported.<a name='3018'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3019'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3020'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='3021'></font>
  IMPLICIT NONE<a name='3022'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3023'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='3024'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='3025'>
  CHARACTER*(*) , INTENT(IN)  :: VarName <a name='3026'>
  CHARACTER*(*) , INTENT(IN) :: Data<a name='3027'>
  INTEGER                    :: Status<a name='3028'>
#endif<a name='3029'>
RETURN<a name='3030'>
END SUBROUTINE wrf_quilt_put_var_td_char <a name='3031'>
<a name='3032'>
<A NAME='WRF_QUILT_READ_FIELD'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_READ_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3033'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_read_field</font> ( DataHandle , DateStr , VarName , Field , FieldType , Comm , IOComm, &amp;<a name='3034'>
                            DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='3035'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='3036'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='3037'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='3038'>
                            Status )<a name='3039'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3040'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3041'></font>
<font color=#447700>! Instruct the I/O quilt servers to read the variable named VarName from the<a name='3042'></font>
<font color=#447700>! dataset pointed to by DataHandle.<a name='3043'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='3044'></font>
<font color=#447700>!<a name='3045'></font>
<font color=#447700>! This is not yet supported.<a name='3046'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3047'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3048'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='3049'></font>
  IMPLICIT NONE<a name='3050'>
  INTEGER ,       INTENT(IN)    :: DataHandle <a name='3051'>
  CHARACTER*(*) , INTENT(INOUT) :: DateStr<a name='3052'>
  CHARACTER*(*) , INTENT(INOUT) :: VarName<a name='3053'>
  INTEGER ,       INTENT(INOUT) :: Field(*)<a name='3054'>
  integer                       ,intent(in)    :: FieldType<a name='3055'>
  integer                       ,intent(inout) :: Comm<a name='3056'>
  integer                       ,intent(inout) :: IOComm<a name='3057'>
  integer                       ,intent(in)    :: DomainDesc<a name='3058'>
  character*(*)                 ,intent(in)    :: MemoryOrder<a name='3059'>
  character*(*)                 ,intent(in)    :: Stagger<a name='3060'>
  character*(*) , dimension (*) ,intent(in)    :: DimNames<a name='3061'>
  integer ,dimension(*)         ,intent(in)    :: DomainStart, DomainEnd<a name='3062'>
  integer ,dimension(*)         ,intent(in)    :: MemoryStart, MemoryEnd<a name='3063'>
  integer ,dimension(*)         ,intent(in)    :: PatchStart,  PatchEnd<a name='3064'>
  integer                       ,intent(out)   :: Status<a name='3065'>
  Status = 0<a name='3066'>
#endif<a name='3067'>
RETURN<a name='3068'>
END SUBROUTINE wrf_quilt_read_field<a name='3069'>
<a name='3070'>
<A NAME='WRF_QUILT_WRITE_FIELD'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3071'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_write_field</font> ( DataHandle , DateStr , VarName , Field , FieldType , Comm , IOComm,  &amp; <A href='../../call_to/WRF_QUILT_WRITE_FIELD.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_QUILT_WRITE_FIELD.html' TARGET='index'>8</A><a name='3072'>
                             DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='3073'>
                             DomainStart , DomainEnd ,                                    &amp;<a name='3074'>
                             MemoryStart , MemoryEnd ,                                    &amp;<a name='3075'>
                             PatchStart , PatchEnd ,                                      &amp;<a name='3076'>
                             Status )<a name='3077'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3078'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3079'></font>
<font color=#447700>! Prepare instructions for the I/O quilt servers to write the variable named<a name='3080'></font>
<font color=#447700>! VarName to the dataset pointed to by DataHandle.<a name='3081'></font>
<font color=#447700>!<a name='3082'></font>
<font color=#447700>! During a "training" write this routine accumulates number and sizes of<a name='3083'></font>
<font color=#447700>! messages that will be sent to the I/O server associated with this compute<a name='3084'></font>
<font color=#447700>! (client) task.<a name='3085'></font>
<font color=#447700>!<a name='3086'></font>
<font color=#447700>! During a "real" write, this routine begins by allocating<a name='3087'></font>
<font color=#447700>! int_local_output_buffer if it has not already been allocated.  Sizes<a name='3088'></font>
<font color=#447700>! accumulated during "training" are used to determine how big<a name='3089'></font>
<font color=#447700>! int_local_output_buffer must be.  This routine then stores "int_field"<a name='3090'></font>
<font color=#447700>! headers and associated field data in int_local_output_buffer.  The contents<a name='3091'></font>
<font color=#447700>! of int_local_output_buffer are actually sent to the I/O quilt server in<a name='3092'></font>
<font color=#447700>! routine wrf_quilt_iosync().  This scheme allows output of multiple variables<a name='3093'></font>
<font color=#447700>! to be aggregated into a single "iosync" operation.<a name='3094'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='3095'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3096'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3097'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='3098'></font>
  USE module_state_description<a name='3099'>
  USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_16"><a name='3100'>
  IMPLICIT NONE<a name='3101'>
  include 'mpif.h'<a name='3102'>
  include 'wrf_io_flags.h'<a name='3103'>
  INTEGER ,       INTENT(IN)    :: DataHandle <a name='3104'>
  CHARACTER*(*) , INTENT(IN)    :: DateStr<a name='3105'>
  CHARACTER*(*) , INTENT(IN)    :: VarName<a name='3106'>
<font color=#447700>!  INTEGER ,       INTENT(IN)    :: Field(*)<a name='3107'></font>
  integer                       ,intent(in)    :: FieldType<a name='3108'>
  integer                       ,intent(inout) :: Comm<a name='3109'>
  integer                       ,intent(inout) :: IOComm<a name='3110'>
  integer                       ,intent(in)    :: DomainDesc<a name='3111'>
  character*(*)                 ,intent(in)    :: MemoryOrder<a name='3112'>
  character*(*)                 ,intent(in)    :: Stagger<a name='3113'>
  character*(*) , dimension (*) ,intent(in)    :: DimNames<a name='3114'>
  integer ,dimension(*)         ,intent(in)    :: DomainStart, DomainEnd<a name='3115'>
  integer ,dimension(*)         ,intent(in)    :: MemoryStart, MemoryEnd<a name='3116'>
  integer ,dimension(*)         ,intent(in)    :: PatchStart,  PatchEnd<a name='3117'>
  integer                       ,intent(out)   :: Status<a name='3118'>
<a name='3119'>
  integer ii,jj,kk,myrank<a name='3120'>
<a name='3121'>
  REAL, DIMENSION( MemoryStart(1):MemoryEnd(1), &amp;<a name='3122'>
                   MemoryStart(2):MemoryEnd(2), &amp;<a name='3123'>
                   MemoryStart(3):MemoryEnd(3) ) :: Field<a name='3124'>
  INTEGER locsize , typesize, inttypesize, realtypesize<a name='3125'>
  INTEGER ierr, tasks_in_group, comm_io_group, dummy, i<a name='3126'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3127'>
  INTEGER, EXTERNAL :: use_package<a name='3128'>
<a name='3129'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_123"> ( DEBUG_LVL, 'in wrf_quilt_write_field' ) <a name='3130'>
<a name='3131'>
  IF ( .NOT. (DataHandle .GE. 1 .AND. DataHandle .LE. int_num_handles) ) THEN<a name='3132'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_109">("frame/module_io_quilt.F: wrf_quilt_write_field: invalid data handle" )<a name='3133'>
  ENDIF<a name='3134'>
  IF ( .NOT. int_handle_in_use( DataHandle ) ) THEN<a name='3135'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_110">("frame/module_io_quilt.F: wrf_quilt_write_field: DataHandle not opened" )<a name='3136'>
  ENDIF<a name='3137'>
<a name='3138'>
  locsize = (PatchEnd(1)-PatchStart(1)+1)* &amp;<a name='3139'>
            (PatchEnd(2)-PatchStart(2)+1)* &amp;<a name='3140'>
            (PatchEnd(3)-PatchStart(3)+1)<a name='3141'>
<a name='3142'>
  CALL mpi_type_size( MPI_INTEGER, inttypesize, ierr )<a name='3143'>
  CALL mpi_type_size( MPI_REAL, realtypesize, ierr )<a name='3144'>
  IF      ( FieldType .EQ. WRF_REAL ) THEN<a name='3145'>
    CALL mpi_type_size( MPI_REAL, typesize, ierr )<a name='3146'>
  ELSE IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='3147'>
    CALL mpi_type_size( MPI_DOUBLE_PRECISION, typesize, ierr )<a name='3148'>
  ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3149'>
    CALL mpi_type_size( MPI_INTEGER, typesize, ierr )<a name='3150'>
  ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='3151'>
    CALL mpi_type_size( MPI_LOGICAL, typesize, ierr )<a name='3152'>
  ENDIF<a name='3153'>
<a name='3154'>
  IF ( .NOT. okay_to_write( DataHandle ) ) THEN<a name='3155'>
<a name='3156'>
      <font color=#447700>! This is a "training" write.<a name='3157'></font>
      <font color=#447700>! it is not okay to actually write; what we do here is just "bookkeep": count up<a name='3158'></font>
      <font color=#447700>! the number and size of messages that we will output to io server associated with<a name='3159'></font>
      <font color=#447700>! this task<a name='3160'></font>
<a name='3161'>
      CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_WRITE_FIELD_HEADER'>int_gen_write_field_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_WRITE_FIELD_HEADER_1"> ( hdrbuf, hdrbufsize, inttypesize, typesize,           &amp;<a name='3162'>
                               DataHandle , DateStr , VarName , Field , FieldType , Comm , IOComm,  &amp;<a name='3163'>
                               333933         , MemoryOrder , Stagger , DimNames ,              &amp;   <font color=#447700>! 333933 means training; magic number<a name='3164'></font>
                               DomainStart , DomainEnd ,                                    &amp;<a name='3165'>
                               MemoryStart , MemoryEnd ,                                    &amp;<a name='3166'>
                               PatchStart , PatchEnd )<a name='3167'>
<a name='3168'>
      int_num_bytes_to_write(DataHandle) = int_num_bytes_to_write(DataHandle) + locsize * typesize + hdrbufsize<a name='3169'>
<a name='3170'>
      <font color=#447700>! Send the hdr for the write in case the interface is calling the I/O API in "learn" mode<a name='3171'></font>
<a name='3172'>
      iserver = 1<a name='3173'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS'>get_mpi_comm_io_groups</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_MPI_COMM_IO_GROUPS_11">( comm_io_group , iserver )<a name='3174'>
      <font color=#447700>! send the size of my local buffer to the i/o task (obufsize doesnt mean anything here)<a name='3175'></font>
<a name='3176'>
      CALL mpi_x_comm_size( comm_io_group , tasks_in_group , ierr )<a name='3177'>
<a name='3178'>
      IF ( .NOT. wrf_dm_on_monitor() ) THEN     <font color=#447700>! only one task in compute grid sends this message; send noops on others<a name='3179'></font>
        CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_NOOP_HEADER'>int_gen_noop_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_NOOP_HEADER_8">( hdrbuf, hdrbufsize, inttypesize )<a name='3180'>
      ENDIF<a name='3181'>
<a name='3182'>
      CALL MPI_Reduce( hdrbufsize, obufsize, 1, MPI_INTEGER,  &amp;<a name='3183'>
                       MPI_SUM, tasks_in_group-1,             &amp;   <font color=#447700>! root = nio_tasks_in_group-1 is me<a name='3184'></font>
                       comm_io_group, ierr )<a name='3185'>
      <font color=#447700>! send data to the i/o processor<a name='3186'></font>
<a name='3187'>
      CALL collect_on_comm( comm_io_group,                   &amp;<a name='3188'>
                            onebyte,                          &amp;<a name='3189'>
                            hdrbuf, hdrbufsize ,                 &amp;<a name='3190'>
                            dummy, 0 )<a name='3191'>
<a name='3192'>
  ELSE<a name='3193'>
<a name='3194'>
    IF ( .NOT. associated( int_local_output_buffer ) ) THEN<a name='3195'>
      ALLOCATE ( int_local_output_buffer( (int_num_bytes_to_write( DataHandle )+1)/inttypesize ) )<a name='3196'>
      int_local_output_cursor = 1<a name='3197'>
    ENDIF<a name='3198'>
<a name='3199'>
    <font color=#447700>! This is NOT a "training" write.  It is OK to write now.<a name='3200'></font>
    CALL <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GEN_WRITE_FIELD_HEADER'>int_gen_write_field_header</A><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GEN_WRITE_FIELD_HEADER_2"> ( hdrbuf, hdrbufsize, inttypesize, typesize,           &amp;<a name='3201'>
                             DataHandle , DateStr , VarName , Field , FieldType , Comm , IOComm,  &amp;<a name='3202'>
                             0          , MemoryOrder , Stagger , DimNames ,              &amp;   <font color=#447700>! non-333933 means okay to write; magic number<a name='3203'></font>
                             DomainStart , DomainEnd ,                                    &amp;<a name='3204'>
                             MemoryStart , MemoryEnd ,                                    &amp;<a name='3205'>
                             PatchStart , PatchEnd )<a name='3206'>
<a name='3207'>
    <font color=#447700>! Pack header into int_local_output_buffer.  It will be sent to the <a name='3208'></font>
    <font color=#447700>! I/O servers during the next "iosync" operation.  <a name='3209'></font>
#ifdef DEREF_KLUDGE<a name='3210'>
    CALL int_pack_data ( hdrbuf , hdrbufsize , int_local_output_buffer(1), int_local_output_cursor )<a name='3211'>
#else<a name='3212'>
    CALL int_pack_data ( hdrbuf , hdrbufsize , int_local_output_buffer, int_local_output_cursor )<a name='3213'>
#endif<a name='3214'>
<a name='3215'>
    <font color=#447700>! Pack field data into int_local_output_buffer.  It will be sent to the <a name='3216'></font>
    <font color=#447700>! I/O servers during the next "iosync" operation.  <a name='3217'></font>
#ifdef DEREF_KLUDGE<a name='3218'>
    CALL int_pack_data ( Field(PatchStart(1):PatchEnd(1),PatchStart(2):PatchEnd(2),PatchStart(3):PatchEnd(3) ), &amp;<a name='3219'>
                                  locsize * typesize , int_local_output_buffer(1), int_local_output_cursor )<a name='3220'>
#else<a name='3221'>
    CALL int_pack_data ( Field(PatchStart(1):PatchEnd(1),PatchStart(2):PatchEnd(2),PatchStart(3):PatchEnd(3) ), &amp;<a name='3222'>
                                  locsize * typesize , int_local_output_buffer, int_local_output_cursor )<a name='3223'>
#endif<a name='3224'>
<a name='3225'>
  ENDIF<a name='3226'>
  Status = 0<a name='3227'>
<a name='3228'>
#endif<a name='3229'>
  RETURN<a name='3230'>
END SUBROUTINE wrf_quilt_write_field<a name='3231'>
<a name='3232'>
<A NAME='WRF_QUILT_GET_VAR_INFO'><A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_INFO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3233'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_quilt_get_var_info</font> ( DataHandle , VarName , NDim , MemoryOrder , Stagger , &amp; <A href='../../call_to/WRF_QUILT_GET_VAR_INFO.html' TARGET='index'>1</A><a name='3234'>
                              DomainStart , DomainEnd , Status )<a name='3235'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3236'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3237'></font>
<font color=#447700>! This routine applies only to a dataset that is open for read.  It instructs<a name='3238'></font>
<font color=#447700>! the I/O quilt servers to return information about variable VarName.<a name='3239'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='3240'></font>
<font color=#447700>!<a name='3241'></font>
<font color=#447700>! This is not yet supported.<a name='3242'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3243'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3244'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='3245'></font>
  IMPLICIT NONE<a name='3246'>
  integer               ,intent(in)     :: DataHandle<a name='3247'>
  character*(*)         ,intent(in)     :: VarName<a name='3248'>
  integer                               :: NDim<a name='3249'>
  character*(*)                         :: MemoryOrder<a name='3250'>
  character*(*)                         :: Stagger<a name='3251'>
  integer ,dimension(*)                 :: DomainStart, DomainEnd<a name='3252'>
  integer                               :: Status<a name='3253'>
#endif<a name='3254'>
RETURN<a name='3255'>
END SUBROUTINE wrf_quilt_get_var_info<a name='3256'>
<a name='3257'>
<A NAME='GET_MPI_COMM_IO_GROUPS'><A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3258'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_mpi_comm_io_groups</font>( retval, isrvr ) <A href='../../call_to/GET_MPI_COMM_IO_GROUPS.html' TARGET='index'>11</A>,<A href='../../call_from/GET_MPI_COMM_IO_GROUPS.html' TARGET='index'>1</A><a name='3259'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3260'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3261'></font>
<font color=#447700>! This routine returns the compute+io communicator to which this<a name='3262'></font>
<font color=#447700>! compute task belongs for I/O server group "isrvr".<a name='3263'></font>
<font color=#447700>! This routine is called only by client (compute) tasks.  <a name='3264'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3265'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3266'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='3267'></font>
      USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#GET_MPI_COMM_IO_GROUPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_17"><a name='3268'>
      IMPLICIT NONE<a name='3269'>
      INTEGER, INTENT(IN ) :: isrvr<a name='3270'>
      INTEGER, INTENT(OUT) :: retval<a name='3271'>
      retval = mpi_comm_io_groups(isrvr)<a name='3272'>
#endif<a name='3273'>
      RETURN<a name='3274'>
END SUBROUTINE get_mpi_comm_io_groups<a name='3275'>
<a name='3276'>
<A NAME='GET_NIO_TASKS_IN_GROUP'><A href='../../html_code/frame/module_io_quilt.F.html#GET_NIO_TASKS_IN_GROUP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3277'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_nio_tasks_in_group</font>( retval ),<A href='../../call_from/GET_NIO_TASKS_IN_GROUP.html' TARGET='index'>1</A><a name='3278'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3279'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3280'></font>
<font color=#447700>! This routine returns the number of I/O server tasks in each <a name='3281'></font>
<font color=#447700>! I/O server group.  It can be called by both clients and <a name='3282'></font>
<font color=#447700>! servers.  <a name='3283'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3284'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3285'></font>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>!defined( STUBMPI )<a name='3286'></font>
      USE <A href='../../html_code/frame/module_io_quilt.F.html#MODULE_WRF_QUILT'>module_wrf_quilt</A><A href='../../html_code/frame/module_io_quilt.F.html#GET_NIO_TASKS_IN_GROUP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_QUILT_18"><a name='3287'>
      IMPLICIT NONE<a name='3288'>
      INTEGER, INTENT(OUT) :: retval<a name='3289'>
      retval = nio_tasks_in_group<a name='3290'>
#endif<a name='3291'>
      RETURN<a name='3292'>
END SUBROUTINE get_nio_tasks_in_group<a name='3293'>
<a name='3294'>
<a name='3295'>
</pre></body></html>