<HTML> <BODY BGCOLOR=#eeddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:DRIVER_LAYER:IO<a name='2'></font>
<font color=#447700>!<a name='3'></font>
#define DEBUG_LVL 500<a name='4'>
<a name='5'>
<A NAME='MODULE_IO'><A href='../../html_code/frame/module_io.F.html#MODULE_IO' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='6'>
<font color=#993300>MODULE </font><font color=#cc0000>module_io</font> <A href='../../call_to/MODULE_IO.html' TARGET='index'>38</A><a name='7'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='8'></font>
<font color=#447700>!&lt;PRE&gt;<a name='9'></font>
<font color=#447700>! WRF-specific package-independent interface to package-dependent WRF-specific<a name='10'></font>
<font color=#447700>! I/O packages.<a name='11'></font>
<font color=#447700>!<a name='12'></font>
<font color=#447700>! These routines have the same names as those specified in the WRF I/O API <a name='13'></font>
<font color=#447700>! except that:<a name='14'></font>
<font color=#447700>! - Routines defined in this file and called by users of this module have <a name='15'></font>
<font color=#447700>!   the "wrf_" prefix.  <a name='16'></font>
<font color=#447700>! - Routines defined in the I/O packages and called from routines in this <a name='17'></font>
<font color=#447700>!   file have the "ext_" prefix.  <a name='18'></font>
<font color=#447700>! - Routines called from routines in this file to initiate communication <a name='19'></font>
<font color=#447700>!   with I/O quilt servers have the "wrf_quilt_" prefix.  <a name='20'></font>
<font color=#447700>!<a name='21'></font>
<font color=#447700>! See http://www.mmm.ucar.edu/wrf/WG2/software_2.0/IOAPI.doc for the latest <a name='22'></font>
<font color=#447700>! version of the WRF I/O API.  This document includes detailed descriptions <a name='23'></font>
<font color=#447700>! of subroutines and their arguments that are not duplicated in this file.  <a name='24'></font>
<font color=#447700>!<a name='25'></font>
<font color=#447700>! We wish to be able to link to different packages depending on whether<a name='26'></font>
<font color=#447700>! the I/O is restart, initial, history, or boundary.  <a name='27'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='28'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='29'></font>
<a name='30'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#module_io.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_81"><a name='31'>
<a name='32'>
  LOGICAL :: is_inited = .FALSE.<a name='33'>
  INTEGER, PARAMETER, PRIVATE :: MAX_WRF_IO_HANDLE = 1000<a name='34'>
  INTEGER :: wrf_io_handles(MAX_WRF_IO_HANDLE), how_opened(MAX_WRF_IO_HANDLE) <a name='35'>
  LOGICAL :: for_output(MAX_WRF_IO_HANDLE), first_operation(MAX_WRF_IO_HANDLE)<a name='36'>
  CHARACTER*20 :: handle_data_set(MAX_WRF_IO_HANDLE)<a name='37'>
  INTEGER :: filtno = 0<a name='38'>
<a name='39'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='40'></font>
<font color=#447700>!&lt;PRE&gt;<a name='41'></font>
<font color=#447700>!<a name='42'></font>
<font color=#447700>! include the file generated from md_calls.m4 using the m4 preprocessor<a name='43'></font>
<font color=#447700>! note that this file also includes the CONTAINS declaration for the module<a name='44'></font>
<font color=#447700>!<a name='45'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='46'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='47'></font>
#include &lt;<A href='../../html_code/include/md_calls.inc.html'>md_calls.inc</A>&gt;<A NAME="md_calls.inc_1"><A href='../../html_code/frame/module_io.F.html#module_io.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='48'>
<a name='49'>
<font color=#447700>!--- ioinit<a name='50'></font>
<a name='51'>
<A NAME='WRF_IOINIT'><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='52'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_ioinit</font>( Status ) <A href='../../call_to/WRF_IOINIT.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_IOINIT.html' TARGET='index'>3</A><a name='53'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='54'></font>
<font color=#447700>!&lt;PRE&gt;<a name='55'></font>
<font color=#447700>! Initialize the WRF I/O system.<a name='56'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='57'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='58'></font>
  IMPLICIT NONE<a name='59'>
  INTEGER, INTENT(INOUT) :: Status<a name='60'>
<font color=#447700>!Local<a name='61'></font>
  CHARACTER(len=80) :: SysDepInfo<a name='62'>
  INTEGER :: ierr(7), minerr, maxerr<a name='63'>
<font color=#447700>!<a name='64'></font>
  Status = 0<a name='65'>
  ierr = 0<a name='66'>
  SysDepInfo = " "<a name='67'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_90">( DEBUG_LVL, 'module_io.F: in wrf_ioinit' )<a name='68'>
  CALL <A href='../../html_code/frame/module_io.F.html#INIT_IO_HANDLES'>init_io_handles</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_IO_HANDLES_1">    <font color=#447700>! defined below<a name='69'></font>
#ifdef NETCDF<a name='70'>
  CALL ext_ncd_ioinit(   SysDepInfo, ierr(1) )<a name='71'>
#endif<a name='72'>
#ifdef INTIO<a name='73'>
  CALL ext_int_ioinit(   SysDepInfo, ierr(2) )<a name='74'>
#endif<a name='75'>
#ifdef PHDF5<a name='76'>
  CALL ext_phdf5_ioinit( SysDepInfo, ierr(3) )<a name='77'>
#endif<a name='78'>
#ifdef MCELIO<a name='79'>
  CALL ext_mcel_ioinit(  SysDepInfo, ierr(4) )<a name='80'>
#endif<a name='81'>
#ifdef XXX<a name='82'>
  CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOINIT'>ext_xxx_ioinit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOINIT_1">(   SysDepInfo, ierr(5) )<a name='83'>
#endif<a name='84'>
#ifdef YYY<a name='85'>
  CALL ext_yyy_ioinit(   SysDepInfo, ierr(6) )<a name='86'>
#endif<a name='87'>
#ifdef ZZZ<a name='88'>
  CALL ext_zzz_ioinit(   SysDepInfo, ierr(7) )<a name='89'>
#endif<a name='90'>
  minerr = MINVAL(ierr)<a name='91'>
  maxerr = MAXVAL(ierr)<a name='92'>
  IF ( minerr &lt; 0 ) THEN<a name='93'>
    Status = minerr<a name='94'>
  ELSE IF ( maxerr &gt; 0 ) THEN<a name='95'>
    Status = maxerr<a name='96'>
  ELSE<a name='97'>
    Status = 0<a name='98'>
  ENDIF<a name='99'>
END SUBROUTINE wrf_ioinit<a name='100'>
<a name='101'>
<font color=#447700>!--- ioexit<a name='102'></font>
<a name='103'>
<A NAME='WRF_IOEXIT'><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='104'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_ioexit</font>( Status ) <A href='../../call_to/WRF_IOEXIT.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_IOEXIT.html' TARGET='index'>3</A><a name='105'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='106'></font>
<font color=#447700>!&lt;PRE&gt;<a name='107'></font>
<font color=#447700>! Shut down the WRF I/O system.  <a name='108'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='109'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='110'></font>
  IMPLICIT NONE<a name='111'>
  INTEGER, INTENT(INOUT) :: Status<a name='112'>
<font color=#447700>!Local<a name='113'></font>
  LOGICAL, EXTERNAL :: use_output_servers<a name='114'>
  INTEGER :: ierr(8), minerr, maxerr<a name='115'>
<font color=#447700>!<a name='116'></font>
  Status = 0<a name='117'>
  ierr = 0<a name='118'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_91">( DEBUG_LVL, 'module_io.F: in wrf_ioexit' )<a name='119'>
#ifdef NETCDF<a name='120'>
  CALL ext_ncd_ioexit(  ierr(1) )<a name='121'>
#endif<a name='122'>
#ifdef INTIO<a name='123'>
  CALL ext_int_ioexit(  ierr(2) )<a name='124'>
#endif<a name='125'>
#ifdef PHDF5<a name='126'>
  CALL ext_phdf5_ioexit(ierr(3) )<a name='127'>
#endif<a name='128'>
#ifdef MCELIO<a name='129'>
  CALL ext_mcel_ioexit( ierr(4) )<a name='130'>
#endif<a name='131'>
#ifdef XXX<a name='132'>
  CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOEXIT'>ext_xxx_ioexit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOEXIT_1">(  ierr(5) )<a name='133'>
#endif<a name='134'>
#ifdef YYY<a name='135'>
  CALL ext_yyy_ioexit(  ierr(6) )<a name='136'>
#endif<a name='137'>
#ifdef ZZZ<a name='138'>
  CALL ext_zzz_ioexit(  ierr(7) )<a name='139'>
#endif<a name='140'>
  IF ( use_output_servers() ) CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOEXIT'>wrf_quilt_ioexit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_IOEXIT_1">( ierr(8) )<a name='141'>
  minerr = MINVAL(ierr)<a name='142'>
  maxerr = MAXVAL(ierr)<a name='143'>
  IF ( minerr &lt; 0 ) THEN<a name='144'>
    Status = minerr<a name='145'>
  ELSE IF ( maxerr &gt; 0 ) THEN<a name='146'>
    Status = maxerr<a name='147'>
  ELSE<a name='148'>
    Status = 0<a name='149'>
  ENDIF<a name='150'>
END SUBROUTINE wrf_ioexit<a name='151'>
<a name='152'>
<font color=#447700>!--- open_for_write_begin<a name='153'></font>
<a name='154'>
<A NAME='WRF_OPEN_FOR_WRITE_BEGIN'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='155'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_write_begin</font>( FileName , Comm_compute, Comm_io, SysDepInfo, &amp; <A href='../../call_to/WRF_OPEN_FOR_WRITE_BEGIN.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_OPEN_FOR_WRITE_BEGIN.html' TARGET='index'>20</A><a name='156'>
                                     DataHandle , Status )<a name='157'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='158'></font>
<font color=#447700>!&lt;PRE&gt;<a name='159'></font>
<font color=#447700>! Begin data definition ("training") phase for writing to WRF dataset <a name='160'></font>
<font color=#447700>! FileName.  <a name='161'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='162'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='163'></font>
  USE module_state_description<a name='164'>
  IMPLICIT NONE<a name='165'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_2"><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='166'>
  CHARACTER*(*) :: FileName<a name='167'>
  INTEGER ,       INTENT(IN)  :: Comm_compute , Comm_io<a name='168'>
  CHARACTER*(*), INTENT(INOUT):: SysDepInfo<a name='169'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='170'>
  INTEGER ,       INTENT(OUT) :: Status<a name='171'>
 <font color=#447700>!Local <a name='172'></font>
  CHARACTER*128               :: DataSet<a name='173'>
  INTEGER                     :: io_form<a name='174'>
  INTEGER                     :: Hndl<a name='175'>
  INTEGER, EXTERNAL           :: use_package<a name='176'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='177'>
  CHARACTER*128     :: LocFilename   <font color=#447700>! for appending the process ID if necessary<a name='178'></font>
  INTEGER           :: myproc<a name='179'>
  CHARACTER*128     :: mess<a name='180'>
  CHARACTER*1028    :: tstr<a name='181'>
<a name='182'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_92">( DEBUG_LVL, 'module_io.F: in wrf_open_for_write_begin' )<a name='183'>
<a name='184'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_VALUE_FROM_PAIRS'>get_value_from_pairs</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_VALUE_FROM_PAIRS_1"> ( "DATASET" , SysDepInfo , DataSet )<a name='185'>
  IF      ( DataSet .eq. 'RESTART' ) THEN<a name='186'>
    CALL nl_get_io_form_restart( 1, io_form )<a name='187'>
  ELSE IF ( DataSet .eq. 'INPUT' ) THEN<a name='188'>
    CALL nl_get_io_form_input( 1, io_form )<a name='189'>
  ELSE IF ( DataSet .eq. 'AUXINPUT1' ) THEN<a name='190'>
    CALL nl_get_io_form_auxinput1( 1, io_form )<a name='191'>
  ELSE IF ( DataSet .eq. 'AUXINPUT2' ) THEN<a name='192'>
    CALL nl_get_io_form_auxinput2( 1, io_form )<a name='193'>
  ELSE IF ( DataSet .eq. 'AUXINPUT3' ) THEN<a name='194'>
    CALL nl_get_io_form_auxinput3( 1, io_form )<a name='195'>
  ELSE IF ( DataSet .eq. 'AUXINPUT4' ) THEN<a name='196'>
    CALL nl_get_io_form_auxinput4( 1, io_form )<a name='197'>
  ELSE IF ( DataSet .eq. 'AUXINPUT5' ) THEN<a name='198'>
    CALL nl_get_io_form_auxinput5( 1, io_form )<a name='199'>
  ELSE IF ( DataSet .eq. 'HISTORY' ) THEN<a name='200'>
    CALL nl_get_io_form_history( 1, io_form )<a name='201'>
  ELSE IF ( DataSet .eq. 'AUXHIST1' ) THEN<a name='202'>
    CALL nl_get_io_form_auxhist1( 1, io_form )<a name='203'>
  ELSE IF ( DataSet .eq. 'AUXHIST2' ) THEN<a name='204'>
    CALL nl_get_io_form_auxhist2( 1, io_form )<a name='205'>
  ELSE IF ( DataSet .eq. 'AUXHIST3' ) THEN<a name='206'>
    CALL nl_get_io_form_auxhist3( 1, io_form )<a name='207'>
  ELSE IF ( DataSet .eq. 'AUXHIST4' ) THEN<a name='208'>
    CALL nl_get_io_form_auxhist4( 1, io_form )<a name='209'>
  ELSE IF ( DataSet .eq. 'AUXHIST5' ) THEN<a name='210'>
    CALL nl_get_io_form_auxhist5( 1, io_form )<a name='211'>
  ELSE IF ( DataSet .eq. 'BOUNDARY' ) THEN<a name='212'>
    CALL nl_get_io_form_boundary( 1, io_form )<a name='213'>
  ELSE  <font color=#447700>! default if nothing is set in SysDepInfo; use history<a name='214'></font>
    CALL nl_get_io_form_history( 1, io_form )<a name='215'>
  ENDIF<a name='216'>
<a name='217'>
  Status = 0<a name='218'>
  Hndl = -1<a name='219'>
  IF ( multi_files( io_form ) .OR. .NOT. use_output_servers() ) THEN<a name='220'>
    SELECT CASE ( use_package(io_form) )<a name='221'>
#ifdef NETCDF<a name='222'>
      CASE ( IO_NETCDF   )<a name='223'>
        IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='224'>
          IF ( multi_files(io_form) ) THEN<a name='225'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_1"> ( myproc )<a name='226'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_1"> ( LocFilename , FileName , myproc, 4 )<a name='227'>
          ELSE<a name='228'>
            LocFilename = FileName<a name='229'>
          ENDIF<a name='230'>
          CALL ext_ncd_open_for_write_begin ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='231'>
                                              Hndl , Status )<a name='232'>
        ENDIF<a name='233'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='234'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_13">( Hndl, IWORDSIZE )<a name='235'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_14">( Status, IWORDSIZE )<a name='236'>
        ENDIF<a name='237'>
#endif<a name='238'>
#ifdef PHDF5<a name='239'>
      CASE (IO_PHDF5  )<a name='240'>
        CALL ext_phdf5_open_for_write_begin( FileName, Comm_compute, Comm_io, SysDepInfo, &amp;<a name='241'>
                                            Hndl, Status)<a name='242'>
#endif<a name='243'>
#ifdef XXX<a name='244'>
      CASE ( IO_XXX   )<a name='245'>
        CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_WRITE_BEGIN'>ext_xxx_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_WRITE_BEGIN_1"> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='246'>
                                            Hndl , Status )<a name='247'>
#endif<a name='248'>
#ifdef YYY<a name='249'>
      CASE ( IO_YYY   )<a name='250'>
        IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='251'>
          IF ( multi_files(io_form) ) THEN<a name='252'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_2"> ( myproc )<a name='253'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_2"> ( LocFilename , FileName , myproc, 4 )<a name='254'>
          ELSE<a name='255'>
            LocFilename = FileName<a name='256'>
          ENDIF<a name='257'>
          CALL ext_yyy_open_for_write_begin ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='258'>
                                              Hndl , Status )<a name='259'>
        ENDIF<a name='260'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='261'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_15">( Hndl, IWORDSIZE )<a name='262'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_16">( Status, IWORDSIZE )<a name='263'>
        ENDIF<a name='264'>
#endif<a name='265'>
#ifdef ZZZ<a name='266'>
      CASE ( IO_ZZZ   )<a name='267'>
        CALL ext_zzz_open_for_write_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='268'>
                                            Hndl , Status )<a name='269'>
#endif<a name='270'>
#ifdef MCELIO<a name='271'>
      CASE ( IO_MCEL )<a name='272'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='273'>
          tstr = TRIM(SysDepInfo) // ',' // 'LAT_R=XLAT,LON_R=XLONG,LANDMASK_I=LU_MASK'<a name='274'>
          CALL ext_mcel_open_for_write_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='275'>
                                               Hndl , Status )<a name='276'>
        ENDIF<a name='277'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_17">( Hndl, IWORDSIZE )<a name='278'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_18">( Status, IWORDSIZE )<a name='279'>
#endif<a name='280'>
#ifdef INTIO<a name='281'>
      CASE ( IO_INTIO   )<a name='282'>
        IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='283'>
          IF ( multi_files(io_form) ) THEN<a name='284'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_3"> ( myproc )<a name='285'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_3"> ( LocFilename , FileName , myproc, 4 )<a name='286'>
          ELSE<a name='287'>
            LocFilename = FileName<a name='288'>
          ENDIF<a name='289'>
          CALL ext_int_open_for_write_begin ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='290'>
                                              Hndl , Status )<a name='291'>
        ENDIF<a name='292'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='293'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_19">( Hndl, IWORDSIZE )<a name='294'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_20">( Status, IWORDSIZE )<a name='295'>
        ENDIF<a name='296'>
#endif<a name='297'>
      CASE DEFAULT<a name='298'>
        IF ( io_form .NE. 0 ) THEN<a name='299'>
          WRITE(mess,*)'Tried to open ',FileName,' writing: no valid io_form (',io_form,')'<a name='300'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_93">(1, mess)<a name='301'>
          Status = WRF_FILE_NOT_OPENED<a name='302'>
        ENDIF<a name='303'>
    END SELECT<a name='304'>
  ELSE IF ( use_output_servers() ) THEN<a name='305'>
    IF ( io_form .GT. 0 ) THEN<a name='306'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN'>wrf_quilt_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_OPEN_FOR_WRITE_BEGIN_1"> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='307'>
                                            Hndl , io_form, Status )<a name='308'>
    ENDIF<a name='309'>
  ELSE<a name='310'>
    Status = 0<a name='311'>
  ENDIF<a name='312'>
  CALL <A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE'>add_new_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_NEW_HANDLE_1">( Hndl, io_form, .TRUE., DataSet, DataHandle )<a name='313'>
END SUBROUTINE wrf_open_for_write_begin<a name='314'>
<a name='315'>
<font color=#447700>!--- open_for_write_commit<a name='316'></font>
<a name='317'>
<A NAME='WRF_OPEN_FOR_WRITE_COMMIT'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='318'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_write_commit</font>( DataHandle , Status ) <A href='../../call_to/WRF_OPEN_FOR_WRITE_COMMIT.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_OPEN_FOR_WRITE_COMMIT.html' TARGET='index'>8</A><a name='319'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='320'></font>
<font color=#447700>!&lt;PRE&gt;<a name='321'></font>
<font color=#447700>! This routine switches an internal flag to enable output for the data set <a name='322'></font>
<font color=#447700>! referenced by DataHandle. The call to wrf_open_for_write_commit() must be <a name='323'></font>
<font color=#447700>! paired with a call to wrf_open_for_write_begin().<a name='324'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='325'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='326'></font>
  USE module_state_description<a name='327'>
  IMPLICIT NONE<a name='328'>
  INTEGER ,       INTENT(IN ) :: DataHandle<a name='329'>
  INTEGER ,       INTENT(OUT) :: Status<a name='330'>
 <a name='331'>
  CHARACTER (128)             :: DataSet<a name='332'>
  INTEGER                     :: io_form<a name='333'>
  INTEGER                     :: Hndl<a name='334'>
  LOGICAL                     :: for_out<a name='335'>
  INTEGER, EXTERNAL           :: use_package<a name='336'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='337'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_3"><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='338'>
<a name='339'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_94">( DEBUG_LVL, 'module_io.F: in wrf_open_for_write_commit' )<a name='340'>
<a name='341'>
  Status = 0<a name='342'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_1"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='343'>
  CALL <A href='../../html_code/frame/module_io.F.html#SET_FIRST_OPERATION'>set_first_operation</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_FIRST_OPERATION_1">( DataHandle )<a name='344'>
  IF ( Hndl .GT. -1 ) THEN<a name='345'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='346'>
      SELECT CASE ( use_package(io_form) )<a name='347'>
#ifdef NETCDF<a name='348'>
        CASE ( IO_NETCDF   )<a name='349'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='350'>
            CALL ext_ncd_open_for_write_commit ( Hndl , Status )<a name='351'>
          ENDIF<a name='352'>
          IF ( .NOT. multi_files(io_form) ) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_21">( Status, IWORDSIZE )<a name='353'>
#endif<a name='354'>
#ifdef MCELIO<a name='355'>
        CASE ( IO_MCEL   )<a name='356'>
          IF ( wrf_dm_on_monitor() ) THEN<a name='357'>
            CALL ext_mcel_open_for_write_commit ( Hndl , Status )<a name='358'>
          ENDIF<a name='359'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_22">( Status, IWORDSIZE )<a name='360'>
#endif<a name='361'>
#ifdef PHDF5<a name='362'>
      CASE ( IO_PHDF5  )<a name='363'>
        CALL ext_phdf5_open_for_write_commit ( Hndl , Status )<a name='364'>
#endif<a name='365'>
#ifdef XXX<a name='366'>
      CASE ( IO_XXX   )<a name='367'>
        CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_WRITE_COMMIT'>ext_xxx_open_for_write_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_WRITE_COMMIT_1"> ( Hndl , Status )<a name='368'>
#endif<a name='369'>
#ifdef YYY<a name='370'>
      CASE ( IO_YYY   )<a name='371'>
         IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='372'>
            CALL ext_yyy_open_for_write_commit ( Hndl , Status )<a name='373'>
         ENDIF<a name='374'>
         IF ( .NOT. multi_files(io_form) ) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_23">( Status, IWORDSIZE )<a name='375'>
#endif<a name='376'>
#ifdef ZZZ<a name='377'>
      CASE ( IO_ZZZ   )<a name='378'>
        CALL ext_zzz_open_for_write_commit ( Hndl , Status )<a name='379'>
#endif<a name='380'>
#ifdef INTIO<a name='381'>
      CASE ( IO_INTIO   )<a name='382'>
        CALL ext_int_open_for_write_commit ( Hndl , Status )<a name='383'>
#endif<a name='384'>
        CASE DEFAULT<a name='385'>
          Status = 0<a name='386'>
      END SELECT<a name='387'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='388'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_OPEN_FOR_WRITE_COMMIT'>wrf_quilt_open_for_write_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_OPEN_FOR_WRITE_COMMIT_1"> ( Hndl , Status )<a name='389'>
    ELSE<a name='390'>
      Status = 0<a name='391'>
    ENDIF<a name='392'>
  ELSE<a name='393'>
    Status = 0<a name='394'>
  ENDIF<a name='395'>
  RETURN<a name='396'>
END SUBROUTINE wrf_open_for_write_commit<a name='397'>
<a name='398'>
<font color=#447700>!--- open_for_read_begin<a name='399'></font>
<a name='400'>
<A NAME='WRF_OPEN_FOR_READ_BEGIN'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='401'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_read_begin</font>( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;,<A href='../../call_from/WRF_OPEN_FOR_READ_BEGIN.html' TARGET='index'>7</A><a name='402'>
                                     DataHandle , Status )<a name='403'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='404'></font>
<font color=#447700>!&lt;PRE&gt;<a name='405'></font>
<font color=#447700>! Begin data definition ("training") phase for reading from WRF dataset <a name='406'></font>
<font color=#447700>! FileName.  <a name='407'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='408'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='409'></font>
  USE module_state_description<a name='410'>
  IMPLICIT NONE<a name='411'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_4"><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='412'>
  CHARACTER*(*) :: FileName<a name='413'>
  INTEGER ,       INTENT(IN)  :: Comm_compute , Comm_io<a name='414'>
  CHARACTER*(*) :: SysDepInfo<a name='415'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='416'>
  INTEGER ,       INTENT(OUT) :: Status<a name='417'>
  <a name='418'>
  CHARACTER*128               :: DataSet<a name='419'>
  INTEGER                     :: io_form<a name='420'>
  INTEGER                     :: Hndl<a name='421'>
  INTEGER, EXTERNAL           :: use_package<a name='422'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='423'>
<a name='424'>
  CHARACTER*128     :: LocFilename   <font color=#447700>! for appending the process ID if necessary<a name='425'></font>
  INTEGER     myproc<a name='426'>
  CHARACTER*128     :: mess, fhand<a name='427'>
  CHARACTER*1028    :: tstr<a name='428'>
<a name='429'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_95">( DEBUG_LVL, 'module_io.F: in wrf_open_for_read_begin' )<a name='430'>
<a name='431'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_VALUE_FROM_PAIRS'>get_value_from_pairs</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_VALUE_FROM_PAIRS_2"> ( "DATASET" , SysDepInfo , DataSet )<a name='432'>
  IF      ( DataSet .eq. 'RESTART' ) THEN<a name='433'>
    CALL nl_get_io_form_restart( 1, io_form )<a name='434'>
  ELSE IF ( DataSet .eq. 'INPUT' ) THEN<a name='435'>
    CALL nl_get_io_form_input( 1, io_form )<a name='436'>
  ELSE IF ( DataSet .eq. 'AUXINPUT1' ) THEN<a name='437'>
    CALL nl_get_io_form_auxinput1( 1, io_form )<a name='438'>
  ELSE IF ( DataSet .eq. 'AUXINPUT2' ) THEN<a name='439'>
    CALL nl_get_io_form_auxinput2( 1, io_form )<a name='440'>
  ELSE IF ( DataSet .eq. 'AUXINPUT3' ) THEN<a name='441'>
    CALL nl_get_io_form_auxinput3( 1, io_form )<a name='442'>
  ELSE IF ( DataSet .eq. 'AUXINPUT4' ) THEN<a name='443'>
    CALL nl_get_io_form_auxinput4( 1, io_form )<a name='444'>
  ELSE IF ( DataSet .eq. 'AUXINPUT5' ) THEN<a name='445'>
    CALL nl_get_io_form_auxinput5( 1, io_form )<a name='446'>
  ELSE IF ( DataSet .eq. 'HISTORY' ) THEN<a name='447'>
    CALL nl_get_io_form_history( 1, io_form )<a name='448'>
  ELSE IF ( DataSet .eq. 'AUXHIST1' ) THEN<a name='449'>
    CALL nl_get_io_form_auxhist1( 1, io_form )<a name='450'>
  ELSE IF ( DataSet .eq. 'AUXHIST2' ) THEN<a name='451'>
    CALL nl_get_io_form_auxhist2( 1, io_form )<a name='452'>
  ELSE IF ( DataSet .eq. 'AUXHIST3' ) THEN<a name='453'>
    CALL nl_get_io_form_auxhist3( 1, io_form )<a name='454'>
  ELSE IF ( DataSet .eq. 'AUXHIST4' ) THEN<a name='455'>
    CALL nl_get_io_form_auxhist4( 1, io_form )<a name='456'>
  ELSE IF ( DataSet .eq. 'AUXHIST5' ) THEN<a name='457'>
    CALL nl_get_io_form_auxhist5( 1, io_form )<a name='458'>
  ELSE IF ( DataSet .eq. 'BOUNDARY' ) THEN<a name='459'>
    CALL nl_get_io_form_boundary( 1, io_form )<a name='460'>
  ELSE  <font color=#447700>! default if nothing is set in SysDepInfo; use history<a name='461'></font>
    CALL nl_get_io_form_history( 1, io_form )<a name='462'>
  ENDIF<a name='463'>
<a name='464'>
  Status = 0<a name='465'>
  Hndl = -1<a name='466'>
  IF ( .NOT. use_output_servers() ) THEN<a name='467'>
    SELECT CASE ( use_package(io_form) )<a name='468'>
#ifdef NETCDF<a name='469'>
      CASE ( IO_NETCDF   )<a name='470'>
#endif<a name='471'>
#ifdef XXX<a name='472'>
      CASE ( IO_XXX   )<a name='473'>
        CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_READ_BEGIN'>ext_xxx_open_for_read_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_READ_BEGIN_1"> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='474'>
                                            Hndl , Status )<a name='475'>
#endif<a name='476'>
#ifdef YYY<a name='477'>
      CASE ( IO_YYY   )<a name='478'>
        CALL ext_yyy_open_for_read_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='479'>
                                            Hndl , Status )<a name='480'>
#endif<a name='481'>
#ifdef ZZZ<a name='482'>
      CASE ( IO_ZZZ   )<a name='483'>
        CALL ext_zzz_open_for_read_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='484'>
                                            Hndl , Status )<a name='485'>
#endif<a name='486'>
#ifdef MCELIO<a name='487'>
      CASE ( IO_MCEL )<a name='488'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='489'>
          <a name='490'>
        WRITE(fhand,'(a,i0)')"filter_",filtno<a name='491'>
        filtno = filtno + 1<a name='492'>
tstr = TRIM(SysDepInfo) // ',' // 'READ_MODE=UPDATE,LAT_R=XLAT,LON_R=XLONG,LANDMASK_I=LU_MASK,FILTER_HANDLE=' // TRIM(fhand)<a name='493'>
          CALL ext_mcel_open_for_read_begin ( FileName , Comm_compute, Comm_io, tstr, &amp;<a name='494'>
                                               Hndl , Status )<a name='495'>
        ENDIF<a name='496'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_24">( Hndl, IWORDSIZE )<a name='497'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_25">( Status, IWORDSIZE )<a name='498'>
#endif<a name='499'>
#ifdef INTIO<a name='500'>
      CASE ( IO_INTIO   )<a name='501'>
#endif<a name='502'>
      CASE DEFAULT<a name='503'>
        IF ( io_form .NE. 0 ) THEN<a name='504'>
          WRITE(mess,*)'Tried to open ',FileName,' reading: no valid io_form (',io_form,')'<a name='505'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_9">(mess)<a name='506'>
        ENDIF<a name='507'>
        Status = WRF_FILE_NOT_OPENED<a name='508'>
    END SELECT<a name='509'>
  ELSE<a name='510'>
    Status = 0<a name='511'>
  ENDIF<a name='512'>
  CALL <A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE'>add_new_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_NEW_HANDLE_2">( Hndl, io_form, .TRUE., DataSet, DataHandle )<a name='513'>
END SUBROUTINE wrf_open_for_read_begin<a name='514'>
<a name='515'>
<font color=#447700>!--- open_for_read_commit<a name='516'></font>
<a name='517'>
<A NAME='WRF_OPEN_FOR_READ_COMMIT'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='518'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_read_commit</font>( DataHandle , Status ) <A href='../../call_to/WRF_OPEN_FOR_READ_COMMIT.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_OPEN_FOR_READ_COMMIT.html' TARGET='index'>5</A><a name='519'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='520'></font>
<font color=#447700>!&lt;PRE&gt;<a name='521'></font>
<font color=#447700>! End "training" phase for WRF dataset FileName.  The call to <a name='522'></font>
<font color=#447700>! wrf_open_for_read_commit() must be paired with a call to <a name='523'></font>
<font color=#447700>! wrf_open_for_read_begin().<a name='524'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='525'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='526'></font>
  USE module_state_description<a name='527'>
  IMPLICIT NONE<a name='528'>
  INTEGER ,       INTENT(IN ) :: DataHandle<a name='529'>
  INTEGER ,       INTENT(OUT) :: Status<a name='530'>
 <a name='531'>
  CHARACTER (128)             :: DataSet<a name='532'>
  INTEGER                     :: io_form<a name='533'>
  INTEGER                     :: Hndl<a name='534'>
  LOGICAL                     :: for_out<a name='535'>
  INTEGER, EXTERNAL           :: use_package<a name='536'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='537'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_5"><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='538'>
<a name='539'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_96">( DEBUG_LVL, 'module_io.F: in wrf_open_for_read_commit' )<a name='540'>
<a name='541'>
  Status = 0<a name='542'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_2"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='543'>
  CALL <A href='../../html_code/frame/module_io.F.html#SET_FIRST_OPERATION'>set_first_operation</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_FIRST_OPERATION_2">( DataHandle )<a name='544'>
  IF ( Hndl .GT. -1 ) THEN<a name='545'>
    IF ( .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='546'>
      SELECT CASE ( use_package(io_form) )<a name='547'>
#ifdef NETCDF<a name='548'>
        CASE ( IO_NETCDF   )<a name='549'>
#endif<a name='550'>
#ifdef MCELIO<a name='551'>
        CASE ( IO_MCEL   )<a name='552'>
          IF ( wrf_dm_on_monitor() ) THEN<a name='553'>
            CALL ext_mcel_open_for_read_commit ( Hndl , Status )<a name='554'>
          ENDIF<a name='555'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_26">( Status, IWORDSIZE )<a name='556'>
#endif<a name='557'>
#ifdef XXX<a name='558'>
      CASE ( IO_XXX   )<a name='559'>
        CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_READ_COMMIT'>ext_xxx_open_for_read_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_READ_COMMIT_1"> ( Hndl , Status )<a name='560'>
#endif<a name='561'>
#ifdef YYY<a name='562'>
      CASE ( IO_YYY   )<a name='563'>
        CALL ext_yyy_open_for_read_commit ( Hndl , Status )<a name='564'>
#endif<a name='565'>
#ifdef ZZZ<a name='566'>
      CASE ( IO_ZZZ   )<a name='567'>
        CALL ext_zzz_open_for_read_commit ( Hndl , Status )<a name='568'>
#endif<a name='569'>
#ifdef INTIO<a name='570'>
      CASE ( IO_INTIO   )<a name='571'>
#endif<a name='572'>
        CASE DEFAULT<a name='573'>
          Status = 0<a name='574'>
      END SELECT<a name='575'>
    ELSE<a name='576'>
      Status = 0<a name='577'>
    ENDIF<a name='578'>
  ELSE<a name='579'>
    Status = WRF_FILE_NOT_OPENED<a name='580'>
  ENDIF<a name='581'>
  RETURN<a name='582'>
END SUBROUTINE wrf_open_for_read_commit<a name='583'>
<a name='584'>
<font color=#447700>!--- open_for_read <a name='585'></font>
<a name='586'>
<A NAME='WRF_OPEN_FOR_READ'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='587'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_read</font> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp; <A href='../../call_to/WRF_OPEN_FOR_READ.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_OPEN_FOR_READ.html' TARGET='index'>16</A><a name='588'>
                               DataHandle , Status )<a name='589'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='590'></font>
<font color=#447700>!&lt;PRE&gt;<a name='591'></font>
<font color=#447700>! Opens a WRF dataset for reading.  <a name='592'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='593'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='594'></font>
  USE module_state_description<a name='595'>
  IMPLICIT NONE<a name='596'>
  CHARACTER*(*) :: FileName<a name='597'>
  INTEGER ,       INTENT(IN)  :: Comm_compute , Comm_io<a name='598'>
  CHARACTER*(*) :: SysDepInfo<a name='599'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='600'>
  INTEGER ,       INTENT(OUT) :: Status<a name='601'>
<a name='602'>
  CHARACTER (128)             :: DataSet, LocFileName<a name='603'>
  INTEGER                     :: io_form, myproc<a name='604'>
  INTEGER                     :: Hndl<a name='605'>
  INTEGER, EXTERNAL           :: use_package<a name='606'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='607'>
<a name='608'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_97">( DEBUG_LVL, 'module_io.F: in wrf_open_for_read' )<a name='609'>
<a name='610'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_VALUE_FROM_PAIRS'>get_value_from_pairs</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_VALUE_FROM_PAIRS_3"> ( "DATASET" , SysDepInfo , DataSet )<a name='611'>
  IF      ( DataSet .eq. 'RESTART' ) THEN<a name='612'>
    CALL nl_get_io_form_restart( 1, io_form )<a name='613'>
  ELSE IF ( DataSet .eq. 'INPUT' ) THEN<a name='614'>
    CALL nl_get_io_form_input( 1, io_form )<a name='615'>
  ELSE IF ( DataSet .eq. 'AUXINPUT1' ) THEN<a name='616'>
    CALL nl_get_io_form_auxinput1( 1, io_form )<a name='617'>
  ELSE IF ( DataSet .eq. 'AUXINPUT2' ) THEN<a name='618'>
    CALL nl_get_io_form_auxinput2( 1, io_form )<a name='619'>
  ELSE IF ( DataSet .eq. 'AUXINPUT3' ) THEN<a name='620'>
    CALL nl_get_io_form_auxinput3( 1, io_form )<a name='621'>
  ELSE IF ( DataSet .eq. 'AUXINPUT4' ) THEN<a name='622'>
    CALL nl_get_io_form_auxinput4( 1, io_form )<a name='623'>
  ELSE IF ( DataSet .eq. 'AUXINPUT5' ) THEN<a name='624'>
    CALL nl_get_io_form_auxinput5( 1, io_form )<a name='625'>
  ELSE IF ( DataSet .eq. 'HISTORY' ) THEN<a name='626'>
    CALL nl_get_io_form_history( 1, io_form )<a name='627'>
  ELSE IF ( DataSet .eq. 'AUXHIST1' ) THEN<a name='628'>
    CALL nl_get_io_form_auxhist1( 1, io_form )<a name='629'>
  ELSE IF ( DataSet .eq. 'AUXHIST2' ) THEN<a name='630'>
    CALL nl_get_io_form_auxhist2( 1, io_form )<a name='631'>
  ELSE IF ( DataSet .eq. 'AUXHIST3' ) THEN<a name='632'>
    CALL nl_get_io_form_auxhist3( 1, io_form )<a name='633'>
  ELSE IF ( DataSet .eq. 'AUXHIST4' ) THEN<a name='634'>
    CALL nl_get_io_form_auxhist4( 1, io_form )<a name='635'>
  ELSE IF ( DataSet .eq. 'AUXHIST5' ) THEN<a name='636'>
    CALL nl_get_io_form_auxhist5( 1, io_form )<a name='637'>
  ELSE IF ( DataSet .eq. 'BOUNDARY' ) THEN<a name='638'>
    CALL nl_get_io_form_boundary( 1, io_form )<a name='639'>
  ELSE  <font color=#447700>! default if nothing is set in SysDepInfo; use history<a name='640'></font>
    CALL nl_get_io_form_history( 1, io_form )<a name='641'>
  ENDIF<a name='642'>
<a name='643'>
  Hndl = -1<a name='644'>
  Status = 0<a name='645'>
  SELECT CASE ( use_package(io_form) )<a name='646'>
#ifdef NETCDF<a name='647'>
    CASE ( IO_NETCDF   )<a name='648'>
      IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='649'>
        IF ( multi_files(io_form) ) THEN<a name='650'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_4"> ( myproc )<a name='651'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_4"> ( LocFilename , FileName , myproc, 4 )<a name='652'>
        ELSE<a name='653'>
            LocFilename = FileName<a name='654'>
        ENDIF<a name='655'>
<a name='656'>
        CALL ext_ncd_open_for_read ( LocFilename , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='657'>
                                     Hndl , Status )<a name='658'>
      ENDIF<a name='659'>
      IF ( .NOT. multi_files(io_form) ) THEN<a name='660'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_27">( Status, IWORDSIZE )<a name='661'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_28">( Hndl, IWORDSIZE )<a name='662'>
      ENDIF<a name='663'>
#endif<a name='664'>
#ifdef PHDF5<a name='665'>
    CASE ( IO_PHDF5  )<a name='666'>
      CALL ext_phdf5_open_for_read ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='667'>
                               Hndl , Status )<a name='668'>
#endif<a name='669'>
#ifdef XXX<a name='670'>
    CASE ( IO_XXX   )<a name='671'>
      CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_READ'>ext_xxx_open_for_read</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_READ_1"> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='672'>
                               Hndl , Status )<a name='673'>
#endif<a name='674'>
#ifdef YYY<a name='675'>
    CASE ( IO_YYY   )<a name='676'>
      IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='677'>
        IF ( multi_files(io_form) ) THEN<a name='678'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_5"> ( myproc )<a name='679'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_5"> ( LocFilename , FileName , myproc, 4 )<a name='680'>
        ELSE<a name='681'>
            LocFilename = FileName<a name='682'>
        ENDIF<a name='683'>
<a name='684'>
        CALL ext_yyy_open_for_read ( LocFilename , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='685'>
                                     Hndl , Status )<a name='686'>
      ENDIF<a name='687'>
      IF ( .NOT. multi_files(io_form) ) THEN<a name='688'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_29">( Status, IWORDSIZE )<a name='689'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_30">( Hndl, IWORDSIZE )<a name='690'>
      ENDIF<a name='691'>
#endif<a name='692'>
#ifdef ZZZ<a name='693'>
    CASE ( IO_ZZZ   )<a name='694'>
      CALL ext_zzz_open_for_read ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='695'>
                               Hndl , Status )<a name='696'>
#endif<a name='697'>
#ifdef INTIO<a name='698'>
    CASE ( IO_INTIO   )<a name='699'>
      IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='700'>
        IF ( multi_files(io_form) ) THEN<a name='701'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_6"> ( myproc )<a name='702'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_6"> ( LocFilename , FileName , myproc, 4 )<a name='703'>
        ELSE<a name='704'>
            LocFilename = FileName<a name='705'>
        ENDIF<a name='706'>
        CALL ext_int_open_for_read ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='707'>
                                     Hndl , Status )<a name='708'>
      ENDIF<a name='709'>
      IF ( .NOT. multi_files(io_form) ) THEN<a name='710'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_31">( Status, IWORDSIZE )<a name='711'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_32">( Hndl, IWORDSIZE )<a name='712'>
      ENDIF<a name='713'>
#endif<a name='714'>
    CASE DEFAULT<a name='715'>
        Status = 0<a name='716'>
  END SELECT<a name='717'>
  CALL <A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE'>add_new_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_NEW_HANDLE_3">( Hndl, io_form, .FALSE., DataSet, DataHandle )<a name='718'>
  RETURN  <a name='719'>
END SUBROUTINE wrf_open_for_read<a name='720'>
<a name='721'>
<font color=#447700>!--- inquire_opened<a name='722'></font>
<a name='723'>
<A NAME='WRF_INQUIRE_OPENED'><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='724'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_inquire_opened</font> ( DataHandle, FileName , FileStatus, Status ) <A href='../../call_to/WRF_INQUIRE_OPENED.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_INQUIRE_OPENED.html' TARGET='index'>10</A><a name='725'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='726'></font>
<font color=#447700>!&lt;PRE&gt;<a name='727'></font>
<font color=#447700>! Inquire if the dataset referenced by DataHandle is open.  <a name='728'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='729'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='730'></font>
  USE module_state_description<a name='731'>
  IMPLICIT NONE<a name='732'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='733'>
  CHARACTER*(*) :: FileName<a name='734'>
  INTEGER ,       INTENT(OUT) :: FileStatus<a name='735'>
  INTEGER ,       INTENT(OUT) :: Status<a name='736'>
  LOGICAL                     :: for_out<a name='737'>
  INTEGER, EXTERNAL           :: use_package<a name='738'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='739'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_6"><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='740'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_7"><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='741'>
<a name='742'>
  CHARACTER*20 DataSet<a name='743'>
  INTEGER io_form , Hndl<a name='744'>
<a name='745'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_98">( DEBUG_LVL, 'module_io.F: in wrf_inquire_opened' )<a name='746'>
<a name='747'>
  Status = 0<a name='748'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_3"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='749'>
  IF ( Hndl .GT. -1 ) THEN<a name='750'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='751'>
      SELECT CASE ( use_package(io_form) )<a name='752'>
#ifdef NETCDF<a name='753'>
        CASE ( IO_NETCDF   )<a name='754'>
          IF (wrf_dm_on_monitor()) CALL ext_ncd_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='755'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_33">( FileStatus, IWORDSIZE )<a name='756'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_34">( Status    , IWORDSIZE )<a name='757'>
#endif<a name='758'>
#ifdef PHDF5<a name='759'>
      CASE ( IO_PHDF5   )<a name='760'>
          CALL ext_phdf5_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='761'>
#endif<a name='762'>
#ifdef XXX<a name='763'>
      CASE ( IO_XXX   )<a name='764'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_INQUIRE_OPENED'>ext_xxx_inquire_opened</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_INQUIRE_OPENED_1"> ( Hndl, FileName , FileStatus, Status )<a name='765'>
#endif<a name='766'>
#ifdef YYY<a name='767'>
      CASE ( IO_YYY   )<a name='768'>
          IF (wrf_dm_on_monitor()) CALL ext_yyy_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='769'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_35">( FileStatus, IWORDSIZE )<a name='770'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_36">( Status    , IWORDSIZE )<a name='771'>
#endif<a name='772'>
#ifdef ZZZ<a name='773'>
      CASE ( IO_ZZZ   )<a name='774'>
          CALL ext_zzz_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='775'>
#endif<a name='776'>
#ifdef INTIO<a name='777'>
      CASE ( IO_INTIO   )<a name='778'>
          IF (wrf_dm_on_monitor()) CALL ext_int_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='779'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_37">( FileStatus, IWORDSIZE )<a name='780'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_38">( Status    , IWORDSIZE )<a name='781'>
#endif<a name='782'>
        CASE DEFAULT<a name='783'>
          FileStatus = WRF_FILE_NOT_OPENED<a name='784'>
          Status = 0<a name='785'>
      END SELECT<a name='786'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='787'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_INQUIRE_OPENED'>wrf_quilt_inquire_opened</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_INQUIRE_OPENED_1"> ( Hndl, FileName , FileStatus, Status )<a name='788'>
    ENDIF<a name='789'>
  ELSE<a name='790'>
    FileStatus = WRF_FILE_NOT_OPENED<a name='791'>
    Status = 0<a name='792'>
  ENDIF<a name='793'>
  RETURN<a name='794'>
END SUBROUTINE wrf_inquire_opened<a name='795'>
<a name='796'>
<font color=#447700>!--- inquire_filename<a name='797'></font>
<a name='798'>
<a name='799'>
<A NAME='WRF_INQUIRE_FILENAME'><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='800'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_inquire_filename</font> ( DataHandle, FileName , FileStatus, Status ) <A href='../../call_to/WRF_INQUIRE_FILENAME.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_INQUIRE_FILENAME.html' TARGET='index'>10</A><a name='801'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='802'></font>
<font color=#447700>!&lt;PRE&gt;<a name='803'></font>
<font color=#447700>! Returns the Filename and FileStatus associated with DataHandle.  <a name='804'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='805'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='806'></font>
  USE module_state_description<a name='807'>
  IMPLICIT NONE<a name='808'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='809'>
  CHARACTER*(*) :: FileName<a name='810'>
  INTEGER ,       INTENT(OUT) :: FileStatus<a name='811'>
  INTEGER ,       INTENT(OUT) :: Status<a name='812'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_8"><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='813'>
  INTEGER, EXTERNAL           :: use_package<a name='814'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='815'>
  LOGICAL                     :: for_out<a name='816'>
  CHARACTER*20 DataSet<a name='817'>
<a name='818'>
  INTEGER io_form , Hndl<a name='819'>
<a name='820'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_99">( DEBUG_LVL, 'module_io.F: in wrf_inquire_filename' )<a name='821'>
<a name='822'>
  Status = 0<a name='823'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_4"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='824'>
  IF ( Hndl .GT. -1 ) THEN<a name='825'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='826'>
      SELECT CASE ( use_package( io_form ) )<a name='827'>
#ifdef NETCDF<a name='828'>
        CASE ( IO_NETCDF   )<a name='829'>
          IF (wrf_dm_on_monitor()) CALL ext_ncd_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='830'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_39">( FileStatus, IWORDSIZE )<a name='831'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_40">( Status    , IWORDSIZE )<a name='832'>
#endif<a name='833'>
#ifdef PHDF5<a name='834'>
        CASE ( IO_PHDF5   )<a name='835'>
          CALL ext_phdf5_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='836'>
#endif<a name='837'>
#ifdef XXX<a name='838'>
        CASE ( IO_XXX   )<a name='839'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_INQUIRE_FILENAME'>ext_xxx_inquire_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_INQUIRE_FILENAME_1"> ( Hndl, FileName , FileStatus, Status )<a name='840'>
#endif<a name='841'>
#ifdef YYY<a name='842'>
        CASE ( IO_YYY   )<a name='843'>
          IF (wrf_dm_on_monitor()) CALL ext_yyy_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='844'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_41">( FileStatus, IWORDSIZE )<a name='845'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_42">( Status    , IWORDSIZE )<a name='846'>
#endif<a name='847'>
#ifdef ZZZ<a name='848'>
        CASE ( IO_ZZZ   )<a name='849'>
            CALL ext_zzz_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='850'>
#endif<a name='851'>
#ifdef INTIO<a name='852'>
        CASE ( IO_INTIO   )<a name='853'>
          IF (wrf_dm_on_monitor()) CALL ext_int_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='854'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_43">( FileStatus, IWORDSIZE )<a name='855'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_44">( Status    , IWORDSIZE )<a name='856'>
#endif<a name='857'>
        CASE DEFAULT<a name='858'>
          Status = 0<a name='859'>
      END SELECT<a name='860'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='861'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_INQUIRE_FILENAME'>wrf_quilt_inquire_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_INQUIRE_FILENAME_1"> ( Hndl, FileName , FileStatus, Status )<a name='862'>
    ENDIF<a name='863'>
  ELSE<a name='864'>
    FileName = ""<a name='865'>
    Status = 0<a name='866'>
  ENDIF<a name='867'>
  RETURN<a name='868'>
END SUBROUTINE wrf_inquire_filename<a name='869'>
<a name='870'>
<font color=#447700>!--- sync<a name='871'></font>
<a name='872'>
<A NAME='WRF_IOSYNC'><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='873'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_iosync</font> ( DataHandle, Status ) <A href='../../call_to/WRF_IOSYNC.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_IOSYNC.html' TARGET='index'>7</A><a name='874'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='875'></font>
<font color=#447700>!&lt;PRE&gt;<a name='876'></font>
<font color=#447700>! Synchronize the disk copy of a dataset with memory buffers.  <a name='877'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='878'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='879'></font>
  USE module_state_description<a name='880'>
  IMPLICIT NONE<a name='881'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='882'>
  INTEGER ,       INTENT(OUT) :: Status<a name='883'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_9"><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='884'>
  INTEGER, EXTERNAL           :: use_package<a name='885'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='886'>
  LOGICAL                     :: for_out<a name='887'>
<a name='888'>
  INTEGER io_form , Hndl<a name='889'>
  CHARACTER*20 DataSet<a name='890'>
<a name='891'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_100">( DEBUG_LVL, 'module_io.F: in wrf_iosync' )<a name='892'>
<a name='893'>
  Status = 0<a name='894'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_5"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='895'>
  IF ( Hndl .GT. -1 ) THEN<a name='896'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='897'>
      SELECT CASE ( use_package(io_form) )<a name='898'>
#ifdef NETCDF<a name='899'>
        CASE ( IO_NETCDF   )<a name='900'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) CALL ext_ncd_iosync( Hndl, Status )<a name='901'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_45">( Status    , IWORDSIZE )<a name='902'>
#endif<a name='903'>
#ifdef XXX<a name='904'>
        CASE ( IO_XXX   )<a name='905'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOSYNC'>ext_xxx_iosync</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOSYNC_1">( Hndl, Status )<a name='906'>
#endif<a name='907'>
#ifdef YYY<a name='908'>
        CASE ( IO_YYY   )<a name='909'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) CALL ext_yyy_iosync( Hndl, Status )<a name='910'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_46">( Status    , IWORDSIZE )<a name='911'>
#endif<a name='912'>
#ifdef ZZZ<a name='913'>
        CASE ( IO_ZZZ   )<a name='914'>
          CALL ext_zzz_iosync( Hndl, Status )<a name='915'>
#endif<a name='916'>
#ifdef INTIO<a name='917'>
        CASE ( IO_INTIO   )<a name='918'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) CALL ext_int_iosync( Hndl, Status )<a name='919'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_47">( Status    , IWORDSIZE )<a name='920'>
#endif<a name='921'>
        CASE DEFAULT<a name='922'>
          Status = 0<a name='923'>
      END SELECT<a name='924'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='925'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOSYNC'>wrf_quilt_iosync</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_IOSYNC_1">( Hndl, Status )<a name='926'>
    ELSE<a name='927'>
      Status = 0<a name='928'>
    ENDIF<a name='929'>
  ELSE<a name='930'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='931'>
  ENDIF<a name='932'>
  RETURN<a name='933'>
END SUBROUTINE wrf_iosync<a name='934'>
<a name='935'>
<font color=#447700>!--- close<a name='936'></font>
<a name='937'>
<A NAME='WRF_IOCLOSE'><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='938'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_ioclose</font> ( DataHandle, Status ) <A href='../../call_to/WRF_IOCLOSE.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_IOCLOSE.html' TARGET='index'>8</A><a name='939'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='940'></font>
<font color=#447700>!&lt;PRE&gt;<a name='941'></font>
<font color=#447700>! Close the dataset referenced by DataHandle.  <a name='942'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='943'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='944'></font>
  USE module_state_description<a name='945'>
  IMPLICIT NONE<a name='946'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='947'>
  INTEGER ,       INTENT(OUT) :: Status<a name='948'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_10"><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='949'>
  INTEGER, EXTERNAL           :: use_package<a name='950'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='951'>
  INTEGER io_form , Hndl<a name='952'>
  LOGICAL                     :: for_out<a name='953'>
  CHARACTER*20 DataSet<a name='954'>
<a name='955'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_101">( DEBUG_LVL, 'module_io.F: in wrf_ioclose' )<a name='956'>
<a name='957'>
  Status = 0<a name='958'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_6"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='959'>
  IF ( Hndl .GT. -1 ) THEN<a name='960'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='961'>
      SELECT CASE ( use_package(io_form) )<a name='962'>
#ifdef NETCDF<a name='963'>
        CASE ( IO_NETCDF   )<a name='964'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_ncd_ioclose( Hndl, Status )<a name='965'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_48">( Status, IWORDSIZE )<a name='966'>
#endif<a name='967'>
#ifdef PHDF5<a name='968'>
        CASE ( IO_PHDF5  )<a name='969'>
          CALL ext_phdf5_ioclose( Hndl, Status )<a name='970'>
#endif<a name='971'>
#ifdef XXX<a name='972'>
        CASE ( IO_XXX   )<a name='973'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOCLOSE'>ext_xxx_ioclose</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOCLOSE_1">( Hndl, Status )<a name='974'>
#endif<a name='975'>
#ifdef YYY<a name='976'>
        CASE ( IO_YYY   )<a name='977'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_ioclose( Hndl, Status )<a name='978'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_49">( Status, IWORDSIZE )<a name='979'>
#endif<a name='980'>
#ifdef ZZZ<a name='981'>
        CASE ( IO_ZZZ   )<a name='982'>
          CALL ext_zzz_ioclose( Hndl, Status )<a name='983'>
#endif<a name='984'>
#ifdef MCELIO<a name='985'>
        CASE ( IO_MCEL   )<a name='986'>
          CALL ext_mcel_ioclose( Hndl, Status )<a name='987'>
#endif<a name='988'>
#ifdef INTIO<a name='989'>
        CASE ( IO_INTIO   )<a name='990'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_int_ioclose( Hndl, Status )<a name='991'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_50">( Status, IWORDSIZE )<a name='992'>
#endif<a name='993'>
        CASE DEFAULT<a name='994'>
          Status = 0<a name='995'>
      END SELECT<a name='996'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='997'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_IOCLOSE'>wrf_quilt_ioclose</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_IOCLOSE_1">( Hndl, Status )<a name='998'>
    ELSE<a name='999'>
      Status = 0<a name='1000'>
    ENDIF<a name='1001'>
    CALL <A href='../../html_code/frame/module_io.F.html#FREE_HANDLE'>free_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FREE_HANDLE_1">( DataHandle )<a name='1002'>
  ELSE<a name='1003'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1004'>
  ENDIF<a name='1005'>
  RETURN<a name='1006'>
END SUBROUTINE wrf_ioclose<a name='1007'>
<a name='1008'>
<font color=#447700>!--- get_next_time (not defined for IntIO )<a name='1009'></font>
<a name='1010'>
<A NAME='WRF_GET_NEXT_TIME'><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1011'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_get_next_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/WRF_GET_NEXT_TIME.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_GET_NEXT_TIME.html' TARGET='index'>10</A><a name='1012'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1013'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1014'></font>
<font color=#447700>! Returns the next time stamp.  <a name='1015'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1016'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1017'></font>
  USE module_state_description<a name='1018'>
  IMPLICIT NONE<a name='1019'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1020'>
  CHARACTER*(*) :: DateStr<a name='1021'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1022'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_11"><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1023'>
<a name='1024'>
  INTEGER, EXTERNAL           :: use_package<a name='1025'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='1026'>
  INTEGER io_form , Hndl, len_of_str<a name='1027'>
  LOGICAL                     :: for_out<a name='1028'>
  CHARACTER*20 DataSet<a name='1029'>
<a name='1030'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_102">( DEBUG_LVL, 'module_io.F: in wrf_get_next_time' )<a name='1031'>
<a name='1032'>
  Status = 0<a name='1033'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_7"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='1034'>
  IF ( Hndl .GT. -1 ) THEN<a name='1035'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='1036'>
      SELECT CASE ( use_package(io_form) )<a name='1037'>
#ifdef NETCDF<a name='1038'>
        CASE ( IO_NETCDF   )<a name='1039'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_ncd_get_next_time( Hndl, DateStr, Status )<a name='1040'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1041'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_51">( Status, IWORDSIZE )<a name='1042'>
            len_of_str = LEN(DateStr)<a name='1043'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_1"> ( DateStr , len_of_str )<a name='1044'>
          ENDIF<a name='1045'>
#endif<a name='1046'>
#ifdef PHDF5<a name='1047'>
        CASE ( IO_PHDF5   )<a name='1048'>
          CALL ext_phdf5_get_next_time( Hndl, DateStr, Status )<a name='1049'>
#endif<a name='1050'>
#ifdef XXX<a name='1051'>
        CASE ( IO_XXX   )<a name='1052'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_GET_NEXT_TIME'>ext_xxx_get_next_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_GET_NEXT_TIME_1">( Hndl, DateStr, Status )<a name='1053'>
#endif<a name='1054'>
#ifdef YYY<a name='1055'>
        CASE ( IO_YYY   )<a name='1056'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_get_next_time( Hndl, DateStr, Status )<a name='1057'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1058'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_52">( Status, IWORDSIZE )<a name='1059'>
            len_of_str = LEN(DateStr)<a name='1060'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_2"> ( DateStr , len_of_str )<a name='1061'>
          ENDIF<a name='1062'>
#endif<a name='1063'>
#ifdef ZZZ<a name='1064'>
        CASE ( IO_ZZZ   )<a name='1065'>
          CALL ext_zzz_get_next_time( Hndl, DateStr, Status )<a name='1066'>
#endif<a name='1067'>
#ifdef INTIO<a name='1068'>
        CASE ( IO_INTIO   )<a name='1069'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_int_get_next_time( Hndl, DateStr, Status )<a name='1070'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1071'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_53">( Status, IWORDSIZE )<a name='1072'>
            len_of_str = LEN(DateStr)<a name='1073'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_3"> ( DateStr , len_of_str )<a name='1074'>
          ENDIF<a name='1075'>
#endif<a name='1076'>
        CASE DEFAULT<a name='1077'>
          Status = 0<a name='1078'>
      END SELECT<a name='1079'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='1080'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_NEXT_TIME'>wrf_quilt_get_next_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_GET_NEXT_TIME_1">( Hndl, DateStr, Status )<a name='1081'>
    ELSE<a name='1082'>
      Status = 0<a name='1083'>
    ENDIF<a name='1084'>
  ELSE<a name='1085'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1086'>
  ENDIF<a name='1087'>
  RETURN<a name='1088'>
END SUBROUTINE wrf_get_next_time<a name='1089'>
<a name='1090'>
<font color=#447700>!--- get_previous_time (not defined for IntIO )<a name='1091'></font>
<a name='1092'>
<A NAME='WRF_GET_PREVIOUS_TIME'><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1093'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_get_previous_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/WRF_GET_PREVIOUS_TIME.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_GET_PREVIOUS_TIME.html' TARGET='index'>8</A><a name='1094'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1095'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1096'></font>
<font color=#447700>! Returns the previous time stamp.  <a name='1097'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1098'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1099'></font>
  USE module_state_description<a name='1100'>
  IMPLICIT NONE<a name='1101'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1102'>
  CHARACTER*(*) :: DateStr<a name='1103'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1104'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_12"><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1105'>
<a name='1106'>
  INTEGER, EXTERNAL           :: use_package<a name='1107'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='1108'>
  INTEGER io_form , Hndl, len_of_str<a name='1109'>
  LOGICAL                     :: for_out<a name='1110'>
  CHARACTER*20 DataSet<a name='1111'>
<a name='1112'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_103">( DEBUG_LVL, 'module_io.F: in wrf_get_previous_time' )<a name='1113'>
<a name='1114'>
  Status = 0<a name='1115'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_8"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='1116'>
  IF ( Hndl .GT. -1 ) THEN<a name='1117'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='1118'>
      SELECT CASE ( use_package(io_form) )<a name='1119'>
#ifdef NETCDF<a name='1120'>
        CASE ( IO_NETCDF   )<a name='1121'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_ncd_get_previous_time( Hndl, DateStr, Status )<a name='1122'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1123'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_54">( Status, IWORDSIZE )<a name='1124'>
            len_of_str = LEN(DateStr)<a name='1125'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_4"> ( DateStr , len_of_str )<a name='1126'>
          ENDIF<a name='1127'>
#endif<a name='1128'>
#ifdef PHDF5<a name='1129'>
        CASE ( IO_PHDF5   )<a name='1130'>
          CALL ext_phdf5_get_previous_time( Hndl, DateStr, Status )<a name='1131'>
#endif<a name='1132'>
#ifdef XXX<a name='1133'>
        CASE ( IO_XXX   )<a name='1134'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_GET_PREVIOUS_TIME'>ext_xxx_get_previous_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_GET_PREVIOUS_TIME_1">( Hndl, DateStr, Status )<a name='1135'>
#endif<a name='1136'>
#ifdef YYY<a name='1137'>
        CASE ( IO_YYY   )<a name='1138'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_get_previous_time( Hndl, DateStr, Status )<a name='1139'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1140'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_55">( Status, IWORDSIZE )<a name='1141'>
            len_of_str = LEN(DateStr)<a name='1142'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_5"> ( DateStr , len_of_str )<a name='1143'>
         ENDIF<a name='1144'>
#endif<a name='1145'>
#ifdef ZZZ<a name='1146'>
        CASE ( IO_ZZZ   )<a name='1147'>
          CALL ext_zzz_get_previous_time( Hndl, DateStr, Status )<a name='1148'>
#endif<a name='1149'>
#ifdef INTIO<a name='1150'>
#endif<a name='1151'>
        CASE DEFAULT<a name='1152'>
          Status = 0<a name='1153'>
      END SELECT<a name='1154'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='1155'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_PREVIOUS_TIME'>wrf_quilt_get_previous_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_GET_PREVIOUS_TIME_1">( Hndl, DateStr, Status )<a name='1156'>
    ELSE<a name='1157'>
      Status = 0<a name='1158'>
    ENDIF<a name='1159'>
  ELSE<a name='1160'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1161'>
  ENDIF<a name='1162'>
  RETURN<a name='1163'>
END SUBROUTINE wrf_get_previous_time<a name='1164'>
<a name='1165'>
<font color=#447700>!--- set_time<a name='1166'></font>
<a name='1167'>
<A NAME='WRF_SET_TIME'><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1168'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_set_time</font> ( DataHandle, DateStr, Status ),<A href='../../call_from/WRF_SET_TIME.html' TARGET='index'>7</A><a name='1169'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1170'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1171'></font>
<font color=#447700>! Sets the time stamp.  <a name='1172'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1173'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1174'></font>
  USE module_state_description<a name='1175'>
  IMPLICIT NONE<a name='1176'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1177'>
  CHARACTER*(*) :: DateStr<a name='1178'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1179'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_13"><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1180'>
<a name='1181'>
  INTEGER, EXTERNAL           :: use_package<a name='1182'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='1183'>
  INTEGER io_form , Hndl<a name='1184'>
  LOGICAL                     :: for_out<a name='1185'>
  CHARACTER*20  DataSet<a name='1186'>
<a name='1187'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_104">( DEBUG_LVL, 'module_io.F: in wrf_set_time' )<a name='1188'>
<a name='1189'>
  Status = 0<a name='1190'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_9"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='1191'>
  IF ( Hndl .GT. -1 ) THEN<a name='1192'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='1193'>
      SELECT CASE ( use_package( io_form ) )<a name='1194'>
#ifdef NETCDF<a name='1195'>
        CASE ( IO_NETCDF   )<a name='1196'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_ncd_set_time( Hndl, DateStr, Status )<a name='1197'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_56">( Status, IWORDSIZE )<a name='1198'>
#endif<a name='1199'>
#ifdef PHDF5<a name='1200'>
        CASE ( IO_PHDF5  )<a name='1201'>
          CALL ext_phdf5_set_time( Hndl, DateStr, Status )<a name='1202'>
#endif<a name='1203'>
#ifdef XXX<a name='1204'>
        CASE ( IO_XXX   )<a name='1205'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_SET_TIME'>ext_xxx_set_time</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_SET_TIME_1">( Hndl, DateStr, Status )<a name='1206'>
#endif<a name='1207'>
#ifdef YYY<a name='1208'>
        CASE ( IO_YYY   )<a name='1209'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_set_time( Hndl, DateStr, Status )<a name='1210'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_57">( Status, IWORDSIZE )<a name='1211'>
#endif<a name='1212'>
#ifdef ZZZ<a name='1213'>
        CASE ( IO_ZZZ   )<a name='1214'>
          CALL ext_zzz_set_time( Hndl, DateStr, Status )<a name='1215'>
#endif<a name='1216'>
#ifdef INTIO<a name='1217'>
        CASE ( IO_INTIO   )<a name='1218'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_int_set_time( Hndl, DateStr, Status )<a name='1219'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_58">( Status, IWORDSIZE )<a name='1220'>
#endif<a name='1221'>
        CASE DEFAULT<a name='1222'>
          Status = 0<a name='1223'>
      END SELECT<a name='1224'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='1225'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_SET_TIME'>wrf_quilt_set_time</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_SET_TIME_1">( Hndl, DateStr, Status )<a name='1226'>
    ELSE<a name='1227'>
      Status = 0<a name='1228'>
    ENDIF<a name='1229'>
  ELSE<a name='1230'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1231'>
  ENDIF<a name='1232'>
  RETURN<a name='1233'>
END SUBROUTINE wrf_set_time<a name='1234'>
<a name='1235'>
<font color=#447700>!--- get_next_var  (not defined for IntIO)<a name='1236'></font>
<a name='1237'>
<A NAME='WRF_GET_NEXT_VAR'><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1238'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_get_next_var</font> ( DataHandle, VarName, Status ),<A href='../../call_from/WRF_GET_NEXT_VAR.html' TARGET='index'>7</A><a name='1239'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1240'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1241'></font>
<font color=#447700>! On reading, this routine returns the name of the next variable in the <a name='1242'></font>
<font color=#447700>! current time frame.  <a name='1243'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1244'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1245'></font>
  USE module_state_description<a name='1246'>
  IMPLICIT NONE<a name='1247'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1248'>
  CHARACTER*(*) :: VarName<a name='1249'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1250'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_14"><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1251'>
<a name='1252'>
  INTEGER, EXTERNAL           :: use_package<a name='1253'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='1254'>
  INTEGER io_form , Hndl<a name='1255'>
  LOGICAL                     :: for_out<a name='1256'>
  CHARACTER*20 DataSet<a name='1257'>
<a name='1258'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_105">( DEBUG_LVL, 'module_io.F: in wrf_get_next_var' )<a name='1259'>
<a name='1260'>
  Status = 0<a name='1261'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_10"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='1262'>
  IF ( Hndl .GT. -1 ) THEN<a name='1263'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='1264'>
      SELECT CASE ( use_package( io_form ) )<a name='1265'>
#ifdef NETCDF<a name='1266'>
        CASE ( IO_NETCDF   )<a name='1267'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_ncd_get_next_var( Hndl, VarName, Status )<a name='1268'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_59">( Status, IWORDSIZE )<a name='1269'>
#endif<a name='1270'>
#ifdef XXX<a name='1271'>
        CASE ( IO_XXX   )<a name='1272'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_GET_NEXT_VAR'>ext_xxx_get_next_var</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_GET_NEXT_VAR_1">( Hndl, VarName, Status )<a name='1273'>
#endif<a name='1274'>
#ifdef YYY<a name='1275'>
        CASE ( IO_YYY   )<a name='1276'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_get_next_var( Hndl, VarName, Status )<a name='1277'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_60">( Status, IWORDSIZE )<a name='1278'>
#endif<a name='1279'>
#ifdef ZZZ<a name='1280'>
        CASE ( IO_ZZZ   )<a name='1281'>
          CALL ext_zzz_get_next_var( Hndl, VarName, Status )<a name='1282'>
#endif<a name='1283'>
#ifdef INTIO<a name='1284'>
        CASE ( IO_INTIO   )<a name='1285'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_int_get_next_var( Hndl, VarName, Status )<a name='1286'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_61">( Status, IWORDSIZE )<a name='1287'>
#endif<a name='1288'>
        CASE DEFAULT<a name='1289'>
          Status = 0<a name='1290'>
      END SELECT<a name='1291'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='1292'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_NEXT_VAR'>wrf_quilt_get_next_var</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_GET_NEXT_VAR_1">( Hndl, VarName, Status )<a name='1293'>
    ELSE<a name='1294'>
      Status = 0<a name='1295'>
    ENDIF<a name='1296'>
  ELSE<a name='1297'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1298'>
  ENDIF<a name='1299'>
  RETURN<a name='1300'>
END SUBROUTINE wrf_get_next_var<a name='1301'>
<a name='1302'>
<a name='1303'>
<font color=#447700>! wrf_get_var_info  (not implemented for IntIO)<a name='1304'></font>
<a name='1305'>
<A NAME='WRF_GET_VAR_INFO'><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1306'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_get_var_info</font> ( DataHandle , VarName , NDim , MemoryOrder , Stagger , &amp;,<A href='../../call_from/WRF_GET_VAR_INFO.html' TARGET='index'>4</A><a name='1307'>
                              DomainStart , DomainEnd , Status )<a name='1308'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1309'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1310'></font>
<font color=#447700>! This routine applies only to a dataset that is open for read.  It returns <a name='1311'></font>
<font color=#447700>! information about a variable.  <a name='1312'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1313'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1314'></font>
  USE module_state_description<a name='1315'>
  IMPLICIT NONE<a name='1316'>
  INTEGER               ,INTENT(IN)     :: DataHandle<a name='1317'>
  CHARACTER*(*)         ,INTENT(IN)     :: VarName<a name='1318'>
  INTEGER               ,INTENT(OUT)    :: NDim<a name='1319'>
  CHARACTER*(*)         ,INTENT(OUT)    :: MemoryOrder<a name='1320'>
  CHARACTER*(*)         ,INTENT(OUT)    :: Stagger<a name='1321'>
  INTEGER ,dimension(*) ,INTENT(OUT)    :: DomainStart, DomainEnd<a name='1322'>
  INTEGER               ,INTENT(OUT)    :: Status<a name='1323'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_15"><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1324'>
  INTEGER io_form , Hndl<a name='1325'>
  LOGICAL                     :: for_out<a name='1326'>
  INTEGER, EXTERNAL           :: use_package<a name='1327'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='1328'>
  CHARACTER*20 DataSet<a name='1329'>
<a name='1330'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_106">( DEBUG_LVL, 'module_io.F: in wrf_get_var_info' )<a name='1331'>
<a name='1332'>
  Status = 0<a name='1333'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_11"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='1334'>
  IF ( Hndl .GT. -1 ) THEN<a name='1335'>
    IF (( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) .AND. .NOT. (for_out .AND. use_output_servers()) ) THEN<a name='1336'>
      SELECT CASE ( use_package( io_form ) )<a name='1337'>
#ifdef NETCDF<a name='1338'>
        CASE ( IO_NETCDF   )<a name='1339'>
          CALL ext_ncd_get_var_info ( Hndl , VarName , NDim ,            &amp;<a name='1340'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1341'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1342'>
                                      Status )<a name='1343'>
#endif<a name='1344'>
#ifdef PHDF5<a name='1345'>
        CASE ( IO_PHDF5)<a name='1346'>
          CALL ext_phdf5_get_var_info ( Hndl , VarName , NDim ,            &amp;<a name='1347'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1348'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1349'>
                                      Status )<a name='1350'>
#endif<a name='1351'>
#ifdef XXX<a name='1352'>
        CASE ( IO_XXX )<a name='1353'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_GET_VAR_INFO'>ext_xxx_get_var_info</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_GET_VAR_INFO_1"> ( Hndl , VarName , NDim ,            &amp;<a name='1354'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1355'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1356'>
                                      Status )<a name='1357'>
#endif<a name='1358'>
#ifdef YYY<a name='1359'>
        CASE ( IO_YYY )<a name='1360'>
          CALL ext_yyy_get_var_info ( Hndl , VarName , NDim ,            &amp;<a name='1361'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1362'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1363'>
                                      Status )<a name='1364'>
#endif<a name='1365'>
        CASE DEFAULT<a name='1366'>
          Status = 0<a name='1367'>
      END SELECT<a name='1368'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers() ) THEN<a name='1369'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_GET_VAR_INFO'>wrf_quilt_get_var_info</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_GET_VAR_INFO_1"> ( Hndl , VarName , NDim ,            &amp;<a name='1370'>
                                    MemoryOrder , Stagger ,                  &amp;<a name='1371'>
                                    DomainStart , DomainEnd ,                &amp;<a name='1372'>
                                    Status )<a name='1373'>
    ELSE<a name='1374'>
      Status = 0<a name='1375'>
    ENDIF<a name='1376'>
  ELSE<a name='1377'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1378'>
  ENDIF<a name='1379'>
  RETURN<a name='1380'>
<a name='1381'>
END SUBROUTINE wrf_get_var_info<a name='1382'>
<a name='1383'>
<a name='1384'>
<a name='1385'>
<font color=#447700>!---------------------------------------------------------------------------------<a name='1386'></font>
<a name='1387'>
<a name='1388'>
<A NAME='INIT_IO_HANDLES'><A href='../../html_code/frame/module_io.F.html#INIT_IO_HANDLES' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1389'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>init_io_handles</font>() <A href='../../call_to/INIT_IO_HANDLES.html' TARGET='index'>2</A><a name='1390'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1391'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1392'></font>
<font color=#447700>! Initialize all I/O handles.  <a name='1393'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1394'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1395'></font>
  IMPLICIT NONE<a name='1396'>
  INTEGER i<a name='1397'>
  IF ( .NOT. is_inited ) THEN<a name='1398'>
    DO i = 1, MAX_WRF_IO_HANDLE<a name='1399'>
      wrf_io_handles(i) = -999319<a name='1400'>
    ENDDO<a name='1401'>
    is_inited = .TRUE.<a name='1402'>
  ENDIF<a name='1403'>
  RETURN<a name='1404'>
END SUBROUTINE init_io_handles<a name='1405'>
<a name='1406'>
<A NAME='ADD_NEW_HANDLE'><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1407'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>add_new_handle</font>( Hndl, Hopened, for_out, DataSet, DataHandle ) <A href='../../call_to/ADD_NEW_HANDLE.html' TARGET='index'>3</A>,<A href='../../call_from/ADD_NEW_HANDLE.html' TARGET='index'>4</A><a name='1408'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1409'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1410'></font>
<font color=#447700>! Stash the package-specific I/O handle (Hndl) and return a WRF I/O handle <a name='1411'></font>
<font color=#447700>! (DataHandle).  <a name='1412'></font>
<font color=#447700>! File format ID is passed in via Hopened.  <a name='1413'></font>
<font color=#447700>! for_out will be .TRUE. if this routine was called from an <a name='1414'></font>
<font color=#447700>! open-for-read/write-begin operation and .FALSE. otherwise.  <a name='1415'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1416'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1417'></font>
  IMPLICIT NONE<a name='1418'>
  INTEGER, INTENT(IN)     :: Hndl<a name='1419'>
  INTEGER, INTENT(IN)     :: Hopened<a name='1420'>
  LOGICAL, INTENT(IN)     :: for_out<a name='1421'>
  CHARACTER*(*), INTENT(IN) :: DataSet<a name='1422'>
  INTEGER, INTENT(OUT)    :: DataHandle<a name='1423'>
  INTEGER i<a name='1424'>
  INTEGER, EXTERNAL       :: use_package<a name='1425'>
  LOGICAL, EXTERNAL       :: multi_files<a name='1426'>
  IF ( .NOT. is_inited ) THEN<a name='1427'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_92">( 'add_new_handle: not initialized' )<a name='1428'>
  ENDIF<a name='1429'>
  IF ( multi_files( Hopened ) ) THEN<a name='1430'>
    SELECT CASE ( use_package( Hopened ) )<a name='1431'>
      CASE ( IO_PHDF5  )<a name='1432'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_93">( 'add_new_handle:  multiple output files not supported for PHDF5' )<a name='1433'>
#ifdef MCELIO<a name='1434'>
      CASE ( IO_MCEL   )<a name='1435'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_94">( 'add_new_handle:  multiple output files not supported for MCEL' )<a name='1436'>
#endif<a name='1437'>
    END SELECT<a name='1438'>
  ENDIF<a name='1439'>
  DataHandle = -1<a name='1440'>
  DO i = 1, MAX_WRF_IO_HANDLE<a name='1441'>
    IF ( wrf_io_handles(i) .EQ. -999319 ) THEN<a name='1442'>
      DataHandle = i <a name='1443'>
      wrf_io_handles(i) = Hndl<a name='1444'>
      how_opened(i)     = Hopened<a name='1445'>
      for_output(DataHandle) = for_out<a name='1446'>
      first_operation(DataHandle) = .TRUE.<a name='1447'>
      handle_data_set(DataHandle) = DataSet<a name='1448'>
      EXIT<a name='1449'>
    ENDIF<a name='1450'>
  ENDDO<a name='1451'>
  IF ( DataHandle .EQ. -1 ) THEN<a name='1452'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_95">( 'add_new_handle: no handles left' )<a name='1453'>
  ENDIF<a name='1454'>
  RETURN<a name='1455'>
END SUBROUTINE add_new_handle<a name='1456'>
<a name='1457'>
<A NAME='GET_HANDLE'><A href='../../html_code/frame/module_io.F.html#GET_HANDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1458'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_handle</font> ( Hndl, Hopened, for_out, DataSet, DataHandle ) <A href='../../call_to/GET_HANDLE.html' TARGET='index'>16</A>,<A href='../../call_from/GET_HANDLE.html' TARGET='index'>1</A><a name='1459'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1460'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1461'></font>
<font color=#447700>! Return the package-specific handle (Hndl) from a WRF handle <a name='1462'></font>
<font color=#447700>! (DataHandle).  <a name='1463'></font>
<font color=#447700>! Return file format ID via Hopened.  <a name='1464'></font>
<font color=#447700>! Also, for_out will be set to .TRUE. if the file was opened <a name='1465'></font>
<font color=#447700>! with an open-for-read/write-begin operation and .FALSE. <a name='1466'></font>
<font color=#447700>! otherwise.  <a name='1467'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1468'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1469'></font>
  IMPLICIT NONE<a name='1470'>
  INTEGER, INTENT(OUT)     :: Hndl<a name='1471'>
  INTEGER, INTENT(OUT)     :: Hopened<a name='1472'>
  LOGICAL, INTENT(OUT)     :: for_out<a name='1473'>
  CHARACTER*(*), INTENT(OUT)     :: DataSet<a name='1474'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1475'>
  CHARACTER*128 mess<a name='1476'>
  INTEGER i<a name='1477'>
  IF ( .NOT. is_inited ) THEN<a name='1478'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#GET_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_96">( 'module_io.F: get_handle: not initialized' )<a name='1479'>
  ENDIF<a name='1480'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1481'>
    Hndl = wrf_io_handles(DataHandle)<a name='1482'>
    Hopened = how_opened(DataHandle)<a name='1483'>
    for_out = for_output(DataHandle)<a name='1484'>
    DataSet = handle_data_set(DataHandle)<a name='1485'>
  ELSE<a name='1486'>
    Hndl = -1<a name='1487'>
  ENDIF<a name='1488'>
  RETURN<a name='1489'>
END SUBROUTINE get_handle<a name='1490'>
<a name='1491'>
<A NAME='SET_FIRST_OPERATION'><A href='../../html_code/frame/module_io.F.html#SET_FIRST_OPERATION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1492'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>set_first_operation</font>( DataHandle ) <A href='../../call_to/SET_FIRST_OPERATION.html' TARGET='index'>2</A>,<A href='../../call_from/SET_FIRST_OPERATION.html' TARGET='index'>1</A><a name='1493'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1494'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1495'></font>
<font color=#447700>! Sets internal flag to indicate that the first read or write has not yet <a name='1496'></font>
<font color=#447700>! happened for the dataset referenced by DataHandle.  <a name='1497'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1498'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1499'></font>
  IMPLICIT NONE<a name='1500'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1501'>
  IF ( .NOT. is_inited ) THEN<a name='1502'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#SET_FIRST_OPERATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_97">( 'module_io.F: get_handle: not initialized' )<a name='1503'>
  ENDIF<a name='1504'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1505'>
    first_operation(DataHandle) = .TRUE.<a name='1506'>
  ENDIF<a name='1507'>
  RETURN<a name='1508'>
END SUBROUTINE set_first_operation<a name='1509'>
<a name='1510'>
<A NAME='RESET_FIRST_OPERATION'><A href='../../html_code/frame/module_io.F.html#RESET_FIRST_OPERATION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1511'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>reset_first_operation</font>( DataHandle ) <A href='../../call_to/RESET_FIRST_OPERATION.html' TARGET='index'>2</A>,<A href='../../call_from/RESET_FIRST_OPERATION.html' TARGET='index'>1</A><a name='1512'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1513'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1514'></font>
<font color=#447700>! Resets internal flag to indicate that the first read or write has already <a name='1515'></font>
<font color=#447700>! happened for the dataset referenced by DataHandle.  <a name='1516'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1517'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1518'></font>
  IMPLICIT NONE<a name='1519'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1520'>
  IF ( .NOT. is_inited ) THEN<a name='1521'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#RESET_FIRST_OPERATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_98">( 'module_io.F: get_handle: not initialized' )<a name='1522'>
  ENDIF<a name='1523'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1524'>
    first_operation(DataHandle) = .FALSE.<a name='1525'>
  ENDIF<a name='1526'>
  RETURN<a name='1527'>
END SUBROUTINE reset_first_operation<a name='1528'>
<a name='1529'>
<A NAME='IS_FIRST_OPERATION'><A href='../../html_code/frame/module_io.F.html#IS_FIRST_OPERATION' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1530'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>is_first_operation</font>( DataHandle ),<A href='../../call_from/IS_FIRST_OPERATION.html' TARGET='index'>1</A><a name='1531'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1532'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1533'></font>
<font color=#447700>! Returns .TRUE. the first read or write has not yet happened for the dataset <a name='1534'></font>
<font color=#447700>! referenced by DataHandle.  <a name='1535'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1536'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1537'></font>
  IMPLICIT NONE<a name='1538'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1539'>
  IF ( .NOT. is_inited ) THEN<a name='1540'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#IS_FIRST_OPERATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_99">( 'module_io.F: get_handle: not initialized' )<a name='1541'>
  ENDIF<a name='1542'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1543'>
    is_first_operation = first_operation(DataHandle)<a name='1544'>
  ENDIF<a name='1545'>
  RETURN<a name='1546'>
END FUNCTION is_first_operation<a name='1547'>
<a name='1548'>
<A NAME='FREE_HANDLE'><A href='../../html_code/frame/module_io.F.html#FREE_HANDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1549'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>free_handle</font> ( DataHandle ) <A href='../../call_to/FREE_HANDLE.html' TARGET='index'>1</A>,<A href='../../call_from/FREE_HANDLE.html' TARGET='index'>1</A><a name='1550'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1551'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1552'></font>
<font color=#447700>! Trash a handle and return to "unused" pool.  <a name='1553'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1554'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1555'></font>
  IMPLICIT NONE<a name='1556'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1557'>
  INTEGER i<a name='1558'>
  IF ( .NOT. is_inited ) THEN<a name='1559'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#FREE_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_100">( 'free_handle: not initialized' )<a name='1560'>
  ENDIF<a name='1561'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1562'>
    wrf_io_handles(DataHandle) = -999319<a name='1563'>
  ENDIF<a name='1564'>
  RETURN<a name='1565'>
END SUBROUTINE free_handle<a name='1566'>
<a name='1567'>
<font color=#447700>!--------------------------------------------------------------<a name='1568'></font>
<a name='1569'>
<A NAME='INIT_MODULE_IO'><A href='../../html_code/frame/module_io.F.html#INIT_MODULE_IO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1570'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_io</font> <A href='../../call_to/INIT_MODULE_IO.html' TARGET='index'>2</A>,<A href='../../call_from/INIT_MODULE_IO.html' TARGET='index'>1</A><a name='1571'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1572'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1573'></font>
<font color=#447700>! Initialize this module.  Must be called before any other operations are <a name='1574'></font>
<font color=#447700>! attempted.  <a name='1575'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1576'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1577'></font>
  CALL <A href='../../html_code/frame/module_io.F.html#INIT_IO_HANDLES'>init_io_handles</A><A href='../../html_code/frame/module_io.F.html#INIT_MODULE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_IO_HANDLES_2"><a name='1578'>
END SUBROUTINE init_module_io<a name='1579'>
END MODULE module_io<a name='1580'>
<a name='1581'>
<a name='1582'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1583'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1584'></font>
<font color=#447700>! Remaining routines in this file are defined outside of the module to <a name='1585'></font>
<font color=#447700>! defeat arg/param type checking.  <a name='1586'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1587'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1588'></font>
<A NAME='WRF_READ_FIELD'><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1589'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_read_field</font> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp; <A href='../../call_to/WRF_READ_FIELD.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_READ_FIELD.html' TARGET='index'>3</A><a name='1590'>
                            Comm       , IOComm  ,                                       &amp;<a name='1591'>
                            DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1592'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='1593'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='1594'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='1595'>
                            Status )<a name='1596'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1597'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1598'></font>
<font color=#447700>! Read the variable named VarName from the dataset pointed to by DataHandle.<a name='1599'></font>
<font color=#447700>! This routine is a wrapper that ensures uniform treatment of logicals across <a name='1600'></font>
<font color=#447700>! platforms by reading as integer and then converting to logical.  <a name='1601'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1602'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1603'></font>
  USE module_state_description<a name='1604'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_82"><a name='1605'>
  IMPLICIT NONE<a name='1606'>
  INTEGER ,       INTENT(IN)    :: DataHandle<a name='1607'>
  CHARACTER*(*) :: DateStr<a name='1608'>
  CHARACTER*(*) :: VarName<a name='1609'>
  LOGICAL ,       INTENT(INOUT) :: Field(*)<a name='1610'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='1611'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='1612'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='1613'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='1614'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='1615'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='1616'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='1617'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='1618'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='1619'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='1620'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='1621'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='1622'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_16"><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1623'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_17"><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1624'>
  INTEGER, ALLOCATABLE        :: ICAST(:)<a name='1625'>
  IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='1626'>
    ALLOCATE(ICAST((MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)))<a name='1627'>
<a name='1628'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1'>wrf_read_field1</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_READ_FIELD1_1"> ( DataHandle , DateStr , VarName , ICAST , WRF_INTEGER ,         &amp;<a name='1629'>
                           Comm       , IOComm  ,                                       &amp;<a name='1630'>
                           DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1631'>
                           DomainStart , DomainEnd ,                                    &amp;<a name='1632'>
                           MemoryStart , MemoryEnd ,                                    &amp;<a name='1633'>
                           PatchStart , PatchEnd ,                                      &amp;<a name='1634'>
                           Status )<a name='1635'>
    Field(1:(MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)) = ICAST == 1<a name='1636'>
    DEALLOCATE(ICAST)<a name='1637'>
  ELSE<a name='1638'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1'>wrf_read_field1</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_READ_FIELD1_2"> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp;<a name='1639'>
                           Comm       , IOComm  ,                                       &amp;<a name='1640'>
                           DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1641'>
                           DomainStart , DomainEnd ,                                    &amp;<a name='1642'>
                           MemoryStart , MemoryEnd ,                                    &amp;<a name='1643'>
                           PatchStart , PatchEnd ,                                      &amp;<a name='1644'>
                           Status )<a name='1645'>
  ENDIF<a name='1646'>
END SUBROUTINE wrf_read_field<a name='1647'>
<a name='1648'>
<A NAME='WRF_READ_FIELD1'><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1649'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_read_field1</font> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp; <A href='../../call_to/WRF_READ_FIELD1.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_READ_FIELD1.html' TARGET='index'>6</A><a name='1650'>
                            Comm       , IOComm  ,                                       &amp;<a name='1651'>
                            DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1652'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='1653'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='1654'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='1655'>
                            Status )<a name='1656'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1657'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1658'></font>
<font color=#447700>! Read the variable named VarName from the dataset pointed to by DataHandle.<a name='1659'></font>
<font color=#447700>! Calls ext_pkg_read_field() via call_pkg_and_dist().  <a name='1660'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1661'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1662'></font>
  USE module_state_description<a name='1663'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_83"><a name='1664'>
  USE <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_2"><a name='1665'>
  IMPLICIT NONE<a name='1666'>
  INTEGER ,       INTENT(IN)    :: DataHandle <a name='1667'>
  CHARACTER*(*) :: DateStr<a name='1668'>
  CHARACTER*(*) :: VarName<a name='1669'>
  INTEGER ,       INTENT(INOUT) :: Field(*)<a name='1670'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='1671'>
  INTEGER                       ,INTENT(INOUT) :: Comm <a name='1672'>
  INTEGER                       ,INTENT(INOUT) :: IOComm <a name='1673'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='1674'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='1675'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='1676'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='1677'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='1678'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='1679'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='1680'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='1681'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='1682'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_18"><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1683'>
  INTEGER io_form , Hndl<a name='1684'>
  LOGICAL                     :: for_out<a name='1685'>
  INTEGER, EXTERNAL           :: use_package<a name='1686'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers, use_input_servers<a name='1687'>
  CHARACTER*20 DataSet<a name='1688'>
#ifdef NETCDF<a name='1689'>
  EXTERNAL     ext_ncd_read_field<a name='1690'>
#endif<a name='1691'>
#ifdef MCELIO<a name='1692'>
  EXTERNAL     ext_mcel_read_field<a name='1693'>
#endif<a name='1694'>
#ifdef INTIO<a name='1695'>
  EXTERNAL     ext_int_read_field<a name='1696'>
#endif<a name='1697'>
#ifdef XXX<a name='1698'>
  EXTERNAL ext_xxx_read_field<a name='1699'>
#endif<a name='1700'>
#ifdef YYY<a name='1701'>
  EXTERNAL ext_yyy_read_field<a name='1702'>
#endif<a name='1703'>
<a name='1704'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_107">( DEBUG_LVL, 'module_io.F: in wrf_read_field' )<a name='1705'>
<a name='1706'>
  Status = 0<a name='1707'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_12"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='1708'>
  CALL <A href='../../html_code/frame/module_io.F.html#RESET_FIRST_OPERATION'>reset_first_operation</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RESET_FIRST_OPERATION_1">( DataHandle )<a name='1709'>
  IF ( Hndl .GT. -1 ) THEN<a name='1710'>
    IF ( .NOT. io_form .GT. 0 ) THEN<a name='1711'>
      Status = 0 <a name='1712'>
    ELSE IF ( .NOT. use_input_servers() ) THEN<a name='1713'>
      SELECT CASE ( use_package( io_form ) )<a name='1714'>
#ifdef NETCDF<a name='1715'>
        CASE ( IO_NETCDF   )<a name='1716'>
<a name='1717'>
          CALL call_pkg_and_dist   ( ext_ncd_read_field, multi_files(io_form), .false. ,        &amp;<a name='1718'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1719'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1720'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1721'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1722'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1723'>
                                     Status )<a name='1724'>
<a name='1725'>
#endif<a name='1726'>
#ifdef PHDF5<a name='1727'>
        CASE ( IO_PHDF5)<a name='1728'>
<font color=#447700>! this should call call_pkg_and_dist... but should pass true for multi-files  JM ZAP<a name='1729'></font>
          CALL ext_phdf5_read_field   (                   &amp;<a name='1730'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1731'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='1732'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1733'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1734'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1735'>
                                     Status )<a name='1736'>
#endif<a name='1737'>
#ifdef MCELIO<a name='1738'>
        CASE ( IO_MCEL   )<a name='1739'>
          CALL call_pkg_and_dist   ( ext_mcel_read_field, multi_files(io_form), .true. ,         &amp;<a name='1740'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1741'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1742'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1743'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1744'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1745'>
                                     Status )<a name='1746'>
#endif<a name='1747'>
#ifdef XXX<a name='1748'>
        CASE ( IO_XXX )<a name='1749'>
          CALL call_pkg_and_dist   ( ext_xxx_read_field, multi_files(io_form), .false.,         &amp;<a name='1750'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1751'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1752'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1753'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1754'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1755'>
                                     Status )<a name='1756'>
#endif<a name='1757'>
#ifdef YYY<a name='1758'>
        CASE ( IO_YYY )<a name='1759'>
          CALL call_pkg_and_dist   ( ext_yyy_read_field, multi_files(io_form), .false.,         &amp;<a name='1760'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1761'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1762'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1763'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1764'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1765'>
                                     Status )<a name='1766'>
#endif<a name='1767'>
#ifdef INTIO<a name='1768'>
        CASE ( IO_INTIO )<a name='1769'>
          CALL call_pkg_and_dist   ( ext_int_read_field, multi_files(io_form), .false.,         &amp;<a name='1770'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1771'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1772'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1773'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1774'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1775'>
                                     Status )<a name='1776'>
#endif<a name='1777'>
        CASE DEFAULT<a name='1778'>
          Status = 0<a name='1779'>
      END SELECT<a name='1780'>
    ELSE<a name='1781'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_101">('module_io.F: wrf_read_field: input_servers not inplemented yet')<a name='1782'>
    ENDIF<a name='1783'>
  ELSE<a name='1784'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1785'>
  ENDIF<a name='1786'>
  RETURN<a name='1787'>
END SUBROUTINE wrf_read_field1<a name='1788'>
<a name='1789'>
<A NAME='WRF_WRITE_FIELD'><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1790'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_write_field</font> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp; <A href='../../call_to/WRF_WRITE_FIELD.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_WRITE_FIELD.html' TARGET='index'>3</A><a name='1791'>
                             Comm       , IOComm  ,                                       &amp;<a name='1792'>
                             DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1793'>
                             DomainStart , DomainEnd ,                                    &amp;<a name='1794'>
                             MemoryStart , MemoryEnd ,                                    &amp;<a name='1795'>
                             PatchStart , PatchEnd ,                                      &amp;<a name='1796'>
                             Status )<a name='1797'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1798'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1799'></font>
<font color=#447700>! Write the variable named VarName to the dataset pointed to by DataHandle.<a name='1800'></font>
<font color=#447700>! This routine is a wrapper that ensures uniform treatment of logicals across <a name='1801'></font>
<font color=#447700>! platforms by converting to integer before writing.  <a name='1802'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1803'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1804'></font>
  USE module_state_description<a name='1805'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_84"><a name='1806'>
  IMPLICIT NONE<a name='1807'>
  INTEGER ,       INTENT(IN)    :: DataHandle<a name='1808'>
  CHARACTER*(*) :: DateStr<a name='1809'>
  CHARACTER*(*) :: VarName<a name='1810'>
  LOGICAL ,       INTENT(IN)    :: Field(*)<a name='1811'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='1812'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='1813'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='1814'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='1815'>
  LOGICAL, DIMENSION(4)         ,INTENT(IN)    :: bdy_mask<a name='1816'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='1817'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='1818'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='1819'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='1820'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='1821'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='1822'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='1823'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_19"><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1824'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_20"><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1825'>
  INTEGER, ALLOCATABLE        :: ICAST(:)<a name='1826'>
  IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='1827'>
      ALLOCATE(ICAST((MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)))<a name='1828'>
      ICAST = 0<a name='1829'>
      WHERE ( Field(1:(MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)) )<a name='1830'>
        ICAST = 1<a name='1831'>
      END WHERE<a name='1832'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1'>wrf_write_field1</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_WRITE_FIELD1_1"> ( DataHandle , DateStr , VarName , ICAST , WRF_INTEGER ,         &amp;<a name='1833'>
                            Comm       , IOComm  ,                                       &amp;<a name='1834'>
                            DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1835'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='1836'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='1837'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='1838'>
                            Status )<a name='1839'>
      DEALLOCATE(ICAST)<a name='1840'>
  ELSE<a name='1841'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1'>wrf_write_field1</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_WRITE_FIELD1_2"> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp;<a name='1842'>
                            Comm       , IOComm  ,                                       &amp;<a name='1843'>
                            DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1844'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='1845'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='1846'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='1847'>
                            Status )<a name='1848'>
  ENDIF<a name='1849'>
END SUBROUTINE wrf_write_field<a name='1850'>
<a name='1851'>
<A NAME='WRF_WRITE_FIELD1'><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1852'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_write_field1</font> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp; <A href='../../call_to/WRF_WRITE_FIELD1.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_WRITE_FIELD1.html' TARGET='index'>11</A><a name='1853'>
                             Comm       , IOComm  ,                                       &amp;<a name='1854'>
                             DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1855'>
                             DomainStart , DomainEnd ,                                    &amp;<a name='1856'>
                             MemoryStart , MemoryEnd ,                                    &amp;<a name='1857'>
                             PatchStart , PatchEnd ,                                      &amp;<a name='1858'>
                             Status )<a name='1859'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1860'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1861'></font>
<font color=#447700>! Write the variable named VarName to the dataset pointed to by DataHandle.<a name='1862'></font>
<font color=#447700>! Calls ext_pkg_write_field() via collect_fld_and_call_pkg().  <a name='1863'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1864'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1865'></font>
<a name='1866'>
  USE module_state_description<a name='1867'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_85"><a name='1868'>
  USE <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_3"><a name='1869'>
  IMPLICIT NONE<a name='1870'>
  INTEGER ,       INTENT(IN)    :: DataHandle <a name='1871'>
  CHARACTER*(*) :: DateStr<a name='1872'>
  CHARACTER*(*) :: VarName<a name='1873'>
  INTEGER ,       INTENT(IN)    :: Field(*)<a name='1874'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='1875'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='1876'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='1877'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='1878'>
  LOGICAL, DIMENSION(4)         ,INTENT(IN)    :: bdy_mask<a name='1879'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='1880'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='1881'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='1882'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='1883'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='1884'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='1885'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='1886'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_21"><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1887'>
  INTEGER io_form , Hndl<a name='1888'>
  LOGICAL                     :: for_out<a name='1889'>
  INTEGER, EXTERNAL           :: use_package<a name='1890'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers<a name='1891'>
  CHARACTER*20 DataSet<a name='1892'>
#ifdef NETCDF<a name='1893'>
  EXTERNAL     ext_ncd_write_field<a name='1894'>
#endif<a name='1895'>
#ifdef MCELIO<a name='1896'>
  EXTERNAL     ext_mcel_write_field<a name='1897'>
#endif<a name='1898'>
#ifdef INTIO<a name='1899'>
  EXTERNAL     ext_int_write_field<a name='1900'>
#endif<a name='1901'>
#ifdef XXX<a name='1902'>
  EXTERNAL ext_xxx_write_field<a name='1903'>
#endif<a name='1904'>
#ifdef YYY<a name='1905'>
  EXTERNAL ext_yyy_write_field<a name='1906'>
#endif<a name='1907'>
<a name='1908'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_108">( DEBUG_LVL, 'module_io.F: in wrf_write_field' )<a name='1909'>
<a name='1910'>
  Status = 0<a name='1911'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_13"> ( Hndl, io_form , for_out, DataSet, DataHandle )<a name='1912'>
  CALL <A href='../../html_code/frame/module_io.F.html#RESET_FIRST_OPERATION'>reset_first_operation</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RESET_FIRST_OPERATION_2"> ( DataHandle )<a name='1913'>
  IF ( Hndl .GT. -1 ) THEN<a name='1914'>
    IF ( multi_files( io_form ) .OR. .NOT. use_output_servers() ) THEN<a name='1915'>
      SELECT CASE ( use_package( io_form ) )<a name='1916'>
#ifdef NETCDF<a name='1917'>
        CASE ( IO_NETCDF   )<a name='1918'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_1"> ( ext_ncd_write_field, multi_files(io_form),                  &amp;<a name='1919'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1920'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1921'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1922'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1923'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1924'>
                                     Status )<a name='1925'>
#endif<a name='1926'>
#ifdef MCELIO<a name='1927'>
        CASE ( IO_MCEL   )<a name='1928'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_2"> ( ext_mcel_write_field, multi_files(io_form),                  &amp;<a name='1929'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1930'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1931'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1932'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1933'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1934'>
                                     Status )<a name='1935'>
#endif<a name='1936'>
#ifdef PHDF5<a name='1937'>
        CASE ( IO_PHDF5 )<a name='1938'>
<font color=#447700>! this should call collect_fld_and... but should pass true for multi-files  JM ZAP<a name='1939'></font>
          CALL ext_phdf5_write_field(                  &amp;<a name='1940'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1941'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='1942'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1943'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1944'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1945'>
                                     Status )<a name='1946'>
#endif<a name='1947'>
#ifdef XXX<a name='1948'>
        CASE ( IO_XXX )<a name='1949'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_3"> ( ext_xxx_write_field, multi_files(io_form),                  &amp;<a name='1950'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1951'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1952'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1953'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1954'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1955'>
                                     Status )<a name='1956'>
#endif<a name='1957'>
#ifdef YYY<a name='1958'>
        CASE ( IO_YYY )<a name='1959'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_4"> ( ext_yyy_write_field, multi_files(io_form),                  &amp;<a name='1960'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1961'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1962'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1963'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1964'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1965'>
                                     Status )<a name='1966'>
#endif<a name='1967'>
#ifdef INTIO<a name='1968'>
        CASE ( IO_INTIO )<a name='1969'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_5"> ( ext_int_write_field, multi_files(io_form),                  &amp;<a name='1970'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1971'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='1972'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='1973'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='1974'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='1975'>
                                     Status )<a name='1976'>
#endif<a name='1977'>
        CASE DEFAULT<a name='1978'>
          Status = 0<a name='1979'>
      END SELECT<a name='1980'>
    ELSE IF ( use_output_servers() ) THEN<a name='1981'>
      IF ( io_form .GT. 0 ) THEN<a name='1982'>
      CALL <A href='../../html_code/frame/module_io_quilt.F.html#WRF_QUILT_WRITE_FIELD'>wrf_quilt_write_field</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_WRITE_FIELD_1"> ( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='1983'>
                                   DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='1984'>
                                   DomainStart , DomainEnd ,                                    &amp;<a name='1985'>
                                   MemoryStart , MemoryEnd ,                                    &amp;<a name='1986'>
                                   PatchStart , PatchEnd ,                                      &amp;<a name='1987'>
                                   Status )<a name='1988'>
      ENDIF<a name='1989'>
    ENDIF<a name='1990'>
  ELSE<a name='1991'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1992'>
  ENDIF<a name='1993'>
  RETURN<a name='1994'>
END SUBROUTINE wrf_write_field1<a name='1995'>
<a name='1996'>
<A NAME='GET_VALUE_FROM_PAIRS'><A href='../../html_code/frame/module_io.F.html#GET_VALUE_FROM_PAIRS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1997'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_value_from_pairs</font> ( varname , str , retval ) <A href='../../call_to/GET_VALUE_FROM_PAIRS.html' TARGET='index'>3</A><a name='1998'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1999'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2000'></font>
<font color=#447700>! parse comma separated list of VARIABLE=VALUE strings and return the<a name='2001'></font>
<font color=#447700>! value for the matching variable if such exists, otherwise return<a name='2002'></font>
<font color=#447700>! the empty string<a name='2003'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2004'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2005'></font>
  IMPLICIT NONE<a name='2006'>
  CHARACTER*(*) ::    varname<a name='2007'>
  CHARACTER*(*) ::    str<a name='2008'>
  CHARACTER*(*) ::    retval<a name='2009'>
<a name='2010'>
  CHARACTER (128) varstr, tstr<a name='2011'>
  INTEGER i,j,n,varstrn<a name='2012'>
  LOGICAL nobreak, nobreakouter<a name='2013'>
<a name='2014'>
  varstr = TRIM(varname)//"="<a name='2015'>
  varstrn = len(TRIM(varstr))<a name='2016'>
  n = len(str)<a name='2017'>
  retval = ""<a name='2018'>
  i = 1<a name='2019'>
  nobreakouter = .TRUE.<a name='2020'>
  DO WHILE ( nobreakouter )<a name='2021'>
    j = 1<a name='2022'>
    nobreak = .TRUE.<a name='2023'>
    tstr = ""<a name='2024'>
<font color=#447700>! Potential for out of bounds array ref on str(i:i) for i &gt; n; reported by jedwards<a name='2025'></font>
<font color=#447700>!    DO WHILE ( nobreak )<a name='2026'></font>
<font color=#447700>!      IF ( str(i:i) .NE. ',' .AND. i .LE. n ) THEN<a name='2027'></font>
<font color=#447700>!        tstr(j:j) = str(i:i)<a name='2028'></font>
<font color=#447700>!      ELSE<a name='2029'></font>
<font color=#447700>!        nobreak = .FALSE.<a name='2030'></font>
<font color=#447700>!      ENDIF<a name='2031'></font>
<font color=#447700>!      j = j + 1<a name='2032'></font>
<font color=#447700>!      i = i + 1<a name='2033'></font>
<font color=#447700>!    ENDDO<a name='2034'></font>
<font color=#447700>! fix 20021112, JM<a name='2035'></font>
    DO WHILE ( nobreak )<a name='2036'>
      nobreak = .FALSE.<a name='2037'>
      IF ( i .LE. n ) THEN<a name='2038'>
        IF (str(i:i) .NE. ',' ) THEN<a name='2039'>
           tstr(j:j) = str(i:i)<a name='2040'>
           nobreak = .TRUE.<a name='2041'>
        ENDIF<a name='2042'>
      ENDIF<a name='2043'>
      j = j + 1<a name='2044'>
      i = i + 1<a name='2045'>
    ENDDO<a name='2046'>
    IF ( i .GT. n ) nobreakouter = .FALSE.<a name='2047'>
    IF ( varstr(1:varstrn) .EQ. tstr(1:varstrn) ) THEN<a name='2048'>
      retval(1:) = TRIM(tstr(varstrn+1:))<a name='2049'>
      nobreakouter = .FALSE.<a name='2050'>
    ENDIF<a name='2051'>
  ENDDO<a name='2052'>
  RETURN<a name='2053'>
END SUBROUTINE get_value_from_pairs<a name='2054'>
<a name='2055'>
<A NAME='MULTI_FILES'><A href='../../html_code/frame/module_io.F.html#MULTI_FILES' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2056'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>multi_files</font> ( io_form )<a name='2057'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2058'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2059'></font>
<font color=#447700>! Returns .TRUE. iff io_form is a multi-file format.  A multi-file format <a name='2060'></font>
<font color=#447700>! results in one file for each compute process and can be used with any <a name='2061'></font>
<font color=#447700>! I/O package.  A multi-file dataset can only be read by the same number <a name='2062'></font>
<font color=#447700>! of tasks that were used to write it.  This feature can be useful for <a name='2063'></font>
<font color=#447700>! speeding up restarts on machines that support efficient parallel I/O.  <a name='2064'></font>
<font color=#447700>! Multi-file formats cannot be used with I/O quilt servers.  <a name='2065'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2066'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2067'></font>
  IMPLICIT NONE<a name='2068'>
  INTEGER, INTENT(IN) :: io_form<a name='2069'>
#ifdef DM_PARALLEL<a name='2070'>
  multi_files = io_form &gt; 99<a name='2071'>
#else<a name='2072'>
  multi_files = .FALSE.<a name='2073'>
#endif<a name='2074'>
END FUNCTION multi_files<a name='2075'>
<a name='2076'>
<A NAME='USE_PACKAGE'><A href='../../html_code/frame/module_io.F.html#USE_PACKAGE' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2077'>
INTEGER <font color=#993300>FUNCTION </font><font color=#cc0000>use_package</font> ( io_form )<a name='2078'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2079'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2080'></font>
<font color=#447700>! Returns the ID of the external I/O package referenced by io_form.  <a name='2081'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2082'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2083'></font>
  IMPLICIT NONE<a name='2084'>
  INTEGER, INTENT(IN) :: io_form<a name='2085'>
  use_package = MOD( io_form, 100 )<a name='2086'>
END FUNCTION use_package<a name='2087'>
<a name='2088'>
<a name='2089'>
<A NAME='COLLECT_FLD_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2090'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_fld_and_call_pkg</font> (    fcn, donotcollect_arg,                                       &amp; <A href='../../call_to/COLLECT_FLD_AND_CALL_PKG.html' TARGET='index'>5</A>,<A href='../../call_from/COLLECT_FLD_AND_CALL_PKG.html' TARGET='index'>6</A><a name='2091'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2092'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2093'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2094'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2095'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2096'>
                                     Status )<a name='2097'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2098'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2099'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2100'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2101'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2102'></font>
<font color=#447700>! This routine handle cases where collection can be skipped and deals with <a name='2103'></font>
<font color=#447700>! different data types for Field.  <a name='2104'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2105'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2106'></font>
  IMPLICIT NONE<a name='2107'>
  include 'wrf_io_flags.h'<a name='2108'>
  EXTERNAL fcn<a name='2109'>
  LOGICAL,        INTENT(IN)    :: donotcollect_arg<a name='2110'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2111'>
  CHARACTER*(*) :: DateStr<a name='2112'>
  CHARACTER*(*) :: VarName<a name='2113'>
  INTEGER ,       INTENT(IN)    :: Field(*)<a name='2114'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2115'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2116'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2117'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2118'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2119'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2120'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2121'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2122'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2123'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2124'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2125'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='2126'>
  LOGICAL donotcollect<a name='2127'>
  INTEGER ndims, nproc<a name='2128'>
<a name='2129'>
  CALL <A href='../../html_code/frame/module_io.F.html#DIM_FROM_MEMORDER'>dim_from_memorder</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DIM_FROM_MEMORDER_1">( MemoryOrder , ndims)<a name='2130'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROC'>wrf_get_nproc</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROC_1">( nproc )<a name='2131'>
  donotcollect = donotcollect_arg .OR. (nproc .EQ. 1)<a name='2132'>
<a name='2133'>
  IF ( donotcollect ) THEN<a name='2134'>
<a name='2135'>
    CALL fcn ( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2136'>
               DomainDesc , MemoryOrder , Stagger , DimNames ,                &amp;<a name='2137'>
               DomainStart , DomainEnd ,                                      &amp;<a name='2138'>
               MemoryStart , MemoryEnd ,                                      &amp;<a name='2139'>
               PatchStart , PatchEnd ,                                        &amp;<a name='2140'>
               Status )<a name='2141'>
<a name='2142'>
  ELSE IF ( FieldType .EQ. WRF_DOUBLE  ) THEN<a name='2143'>
<a name='2144'>
     CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG'>collect_double_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_DOUBLE_AND_CALL_PKG_1"> ( fcn,                                        &amp;<a name='2145'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2146'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2147'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2148'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2149'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2150'>
               Status )<a name='2151'>
<a name='2152'>
  ELSE IF ( FieldType .EQ. WRF_REAL ) THEN<a name='2153'>
<a name='2154'>
     CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG'>collect_real_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_REAL_AND_CALL_PKG_1"> ( fcn,                                        &amp;<a name='2155'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2156'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2157'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2158'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2159'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2160'>
               Status )<a name='2161'>
<a name='2162'>
  ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='2163'>
<a name='2164'>
     CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG'>collect_int_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_INT_AND_CALL_PKG_1"> ( fcn,                                        &amp;<a name='2165'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2166'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2167'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2168'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2169'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2170'>
               Status )<a name='2171'>
<a name='2172'>
  ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='2173'>
<a name='2174'>
     CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG'>collect_logical_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_LOGICAL_AND_CALL_PKG_1"> ( fcn,                                        &amp;<a name='2175'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2176'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2177'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2178'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2179'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2180'>
               Status )<a name='2181'>
<a name='2182'>
  ENDIF<a name='2183'>
  RETURN<a name='2184'>
END SUBROUTINE collect_fld_and_call_pkg<a name='2185'>
<a name='2186'>
<A NAME='COLLECT_REAL_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2187'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_real_and_call_pkg</font> (   fcn,                                                     &amp; <A href='../../call_to/COLLECT_REAL_AND_CALL_PKG.html' TARGET='index'>1</A>,<A href='../../call_from/COLLECT_REAL_AND_CALL_PKG.html' TARGET='index'>2</A><a name='2188'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2189'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2190'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2191'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2192'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2193'>
                                     Status )<a name='2194'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2195'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2196'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2197'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2198'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2199'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big real buffer and <a name='2200'></font>
<font color=#447700>! pass it down to collect_generic_and_call_pkg() to do the actual work.  <a name='2201'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2202'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2203'></font>
  USE module_state_description<a name='2204'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_16"><a name='2205'>
  IMPLICIT NONE<a name='2206'>
  EXTERNAL fcn<a name='2207'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2208'>
  CHARACTER*(*) :: DateStr<a name='2209'>
  CHARACTER*(*) :: VarName<a name='2210'>
  REAL    ,       INTENT(IN)    :: Field(*)<a name='2211'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2212'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2213'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2214'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2215'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2216'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2217'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2218'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2219'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2220'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2221'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2222'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='2223'>
  REAL, ALLOCATABLE :: globbuf (:)<a name='2224'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor<a name='2225'>
<a name='2226'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='2227'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='2228'>
  ELSE<a name='2229'>
    ALLOCATE( globbuf( 1 ) )<a name='2230'>
  ENDIF<a name='2231'>
<a name='2232'>
#ifdef DEREF_KLUDGE<a name='2233'>
# define FRSTELEM (1)<a name='2234'>
#else<a name='2235'>
# define FRSTELEM<a name='2236'>
#endif<a name='2237'>
  <a name='2238'>
  CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG'>collect_generic_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_GENERIC_AND_CALL_PKG_1"> (   fcn, globbuf FRSTELEM,                                    &amp;<a name='2239'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2240'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2241'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2242'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2243'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2244'>
                                     Status )<a name='2245'>
  DEALLOCATE ( globbuf )<a name='2246'>
  RETURN<a name='2247'>
<a name='2248'>
END SUBROUTINE collect_real_and_call_pkg<a name='2249'>
<a name='2250'>
<A NAME='COLLECT_INT_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2251'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_int_and_call_pkg</font> (   fcn,                                                     &amp; <A href='../../call_to/COLLECT_INT_AND_CALL_PKG.html' TARGET='index'>1</A>,<A href='../../call_from/COLLECT_INT_AND_CALL_PKG.html' TARGET='index'>2</A><a name='2252'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2253'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2254'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2255'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2256'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2257'>
                                     Status )<a name='2258'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2259'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2260'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2261'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2262'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2263'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big integer buffer and <a name='2264'></font>
<font color=#447700>! pass it down to collect_generic_and_call_pkg() to do the actual work.  <a name='2265'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2266'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2267'></font>
  USE module_state_description<a name='2268'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_17"><a name='2269'>
  IMPLICIT NONE<a name='2270'>
  EXTERNAL fcn<a name='2271'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2272'>
  CHARACTER*(*) :: DateStr<a name='2273'>
  CHARACTER*(*) :: VarName<a name='2274'>
  INTEGER    ,       INTENT(IN)    :: Field(*)<a name='2275'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2276'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2277'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2278'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2279'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2280'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2281'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2282'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2283'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2284'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2285'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2286'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='2287'>
  INTEGER, ALLOCATABLE :: globbuf (:)<a name='2288'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor<a name='2289'>
<a name='2290'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='2291'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='2292'>
  ELSE<a name='2293'>
    ALLOCATE( globbuf( 1 ) )<a name='2294'>
  ENDIF<a name='2295'>
<a name='2296'>
  CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG'>collect_generic_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_GENERIC_AND_CALL_PKG_2"> (   fcn, globbuf FRSTELEM ,                                   &amp;<a name='2297'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2298'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2299'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2300'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2301'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2302'>
                                     Status )<a name='2303'>
  DEALLOCATE ( globbuf )<a name='2304'>
  RETURN<a name='2305'>
<a name='2306'>
END SUBROUTINE collect_int_and_call_pkg<a name='2307'>
<a name='2308'>
<A NAME='COLLECT_DOUBLE_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2309'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_double_and_call_pkg</font> (   fcn,                                                     &amp; <A href='../../call_to/COLLECT_DOUBLE_AND_CALL_PKG.html' TARGET='index'>1</A>,<A href='../../call_from/COLLECT_DOUBLE_AND_CALL_PKG.html' TARGET='index'>2</A><a name='2310'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2311'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2312'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2313'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2314'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2315'>
                                     Status )<a name='2316'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2317'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2318'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2319'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2320'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2321'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big double precision <a name='2322'></font>
<font color=#447700>! buffer and pass it down to collect_generic_and_call_pkg() to do the <a name='2323'></font>
<font color=#447700>! actual work.  <a name='2324'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2325'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2326'></font>
  USE module_state_description<a name='2327'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_18"><a name='2328'>
  IMPLICIT NONE<a name='2329'>
  EXTERNAL fcn<a name='2330'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2331'>
  CHARACTER*(*) :: DateStr<a name='2332'>
  CHARACTER*(*) :: VarName<a name='2333'>
  DOUBLE PRECISION    ,       INTENT(IN)    :: Field(*)<a name='2334'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2335'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2336'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2337'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2338'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2339'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2340'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2341'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2342'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2343'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2344'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2345'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='2346'>
  DOUBLE PRECISION, ALLOCATABLE :: globbuf (:)<a name='2347'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor<a name='2348'>
<a name='2349'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='2350'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='2351'>
  ELSE<a name='2352'>
    ALLOCATE( globbuf( 1 ) )<a name='2353'>
  ENDIF<a name='2354'>
<a name='2355'>
  CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG'>collect_generic_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_GENERIC_AND_CALL_PKG_3"> (   fcn, globbuf FRSTELEM ,                                   &amp;<a name='2356'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2357'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2358'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2359'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2360'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2361'>
                                     Status )<a name='2362'>
  DEALLOCATE ( globbuf )<a name='2363'>
  RETURN<a name='2364'>
<a name='2365'>
END SUBROUTINE collect_double_and_call_pkg<a name='2366'>
<a name='2367'>
<A NAME='COLLECT_LOGICAL_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2368'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_logical_and_call_pkg</font> (   fcn,                                                     &amp; <A href='../../call_to/COLLECT_LOGICAL_AND_CALL_PKG.html' TARGET='index'>1</A>,<A href='../../call_from/COLLECT_LOGICAL_AND_CALL_PKG.html' TARGET='index'>2</A><a name='2369'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2370'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2371'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2372'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2373'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2374'>
                                     Status )<a name='2375'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2376'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2377'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2378'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2379'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2380'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big logical buffer <a name='2381'></font>
<font color=#447700>! and pass it down to collect_generic_and_call_pkg() to do the actual work.  <a name='2382'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2383'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2384'></font>
  USE module_state_description<a name='2385'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_19"><a name='2386'>
  IMPLICIT NONE<a name='2387'>
  EXTERNAL fcn<a name='2388'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2389'>
  CHARACTER*(*) :: DateStr<a name='2390'>
  CHARACTER*(*) :: VarName<a name='2391'>
  LOGICAL    ,       INTENT(IN)    :: Field(*)<a name='2392'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2393'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2394'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2395'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2396'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2397'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2398'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2399'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2400'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2401'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2402'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2403'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='2404'>
  LOGICAL, ALLOCATABLE :: globbuf (:)<a name='2405'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor<a name='2406'>
<a name='2407'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='2408'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='2409'>
  ELSE<a name='2410'>
    ALLOCATE( globbuf( 1 ) )<a name='2411'>
  ENDIF<a name='2412'>
<a name='2413'>
  CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG'>collect_generic_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_GENERIC_AND_CALL_PKG_4"> (   fcn, globbuf FRSTELEM ,                                   &amp;<a name='2414'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2415'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2416'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2417'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2418'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2419'>
                                     Status )<a name='2420'>
  DEALLOCATE ( globbuf )<a name='2421'>
  RETURN<a name='2422'>
<a name='2423'>
END SUBROUTINE collect_logical_and_call_pkg<a name='2424'>
<a name='2425'>
<a name='2426'>
<A NAME='COLLECT_GENERIC_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2427'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_generic_and_call_pkg</font> ( fcn, globbuf,                                           &amp; <A href='../../call_to/COLLECT_GENERIC_AND_CALL_PKG.html' TARGET='index'>4</A>,<A href='../../call_from/COLLECT_GENERIC_AND_CALL_PKG.html' TARGET='index'>9</A><a name='2428'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2429'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2430'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2431'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2432'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2433'>
                                     Status )<a name='2434'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2435'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2436'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2437'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2438'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2439'></font>
<font color=#447700>! This routine calls the distributed memory communication routines that <a name='2440'></font>
<font color=#447700>! collect the array and then calls I/O function fcn to write it to disk.  <a name='2441'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2442'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2443'></font>
  USE module_state_description<a name='2444'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_20"><a name='2445'>
  IMPLICIT NONE<a name='2446'>
  include 'wrf_io_flags.h'<a name='2447'>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>! defined(STUBMPI)<a name='2448'></font>
include "<A href='../../html_code/include/mpif.h.html'>mpif.h</A>"<A NAME="mpif.h_22"><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2449'>
#endif<a name='2450'>
  EXTERNAL fcn<a name='2451'>
  REAL , DIMENSION(*) , INTENT(INOUT) :: globbuf<a name='2452'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2453'>
  CHARACTER*(*) :: DateStr<a name='2454'>
  CHARACTER*(*) :: VarName<a name='2455'>
  REAL    ,       INTENT(IN)    :: Field(*)<a name='2456'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2457'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2458'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2459'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2460'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2461'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2462'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2463'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2464'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2465'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2466'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2467'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='2468'>
  CHARACTER*3 MemOrd<a name='2469'>
  LOGICAL, EXTERNAL :: has_char<a name='2470'>
  INTEGER ids, ide, jds, jde, kds, kde<a name='2471'>
  INTEGER ims, ime, jms, jme, kms, kme<a name='2472'>
  INTEGER ips, ipe, jps, jpe, kps, kpe<a name='2473'>
  INTEGER nproc, communicator, displs(10*1024), mpi_bdyslice_type, ierr, my_displ, recv_count, root_proc, send_count, itype<a name='2474'>
  INTEGER my_count, counts(10*1024)<a name='2475'>
  INTEGER , dimension(3)                       :: dom_end_rev<a name='2476'>
  LOGICAL, EXTERNAL         :: wrf_dm_on_monitor<a name='2477'>
  LOGICAL     distributed_field<a name='2478'>
  INTEGER i,j,k,idx,lx,idx2,lx2<a name='2479'>
<a name='2480'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROC'>wrf_get_nproc</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROC_2">( nproc )<a name='2481'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_DM_COMMUNICATOR'>wrf_get_dm_communicator</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_DM_COMMUNICATOR_5"> ( communicator )<a name='2482'>
  CALL <A href='../../html_code/frame/module_io.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_1">( MemoryOrder, MemOrd )<a name='2483'>
<a name='2484'>
  dom_end_rev(1) = DomainEnd(1)<a name='2485'>
  dom_end_rev(2) = DomainEnd(2)<a name='2486'>
  dom_end_rev(3) = DomainEnd(3)<a name='2487'>
<a name='2488'>
  SELECT CASE (TRIM(MemOrd))<a name='2489'>
    CASE (  'xzy' )<a name='2490'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='2491'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='2492'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='2493'>
    CASE (  'zxy' )<a name='2494'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='2495'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='2496'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='2497'>
    CASE (  'xyz' )<a name='2498'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='2499'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='2500'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='2501'>
    CASE (  'xy' )<a name='2502'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='2503'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='2504'>
    CASE (  'yxz' )<a name='2505'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='2506'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='2507'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='2508'>
    CASE (  'yx' )<a name='2509'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='2510'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='2511'>
    CASE DEFAULT<a name='2512'>
      <font color=#447700>! do nothing; the boundary orders and others either dont care or set themselves<a name='2513'></font>
  END SELECT<a name='2514'>
<a name='2515'>
  SELECT CASE (TRIM(MemOrd))<a name='2516'>
#ifndef STUBMPI<a name='2517'>
    CASE (  'xzy','zxy','xyz','yxz','xy','yx' )<a name='2518'>
<a name='2519'>
      distributed_field = .TRUE.<a name='2520'>
      IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='2521'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_DOUBLE'>wrf_patch_to_global_double</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_DOUBLE_1"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='2522'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='2523'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='2524'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='2525'>
      ELSE IF ( FieldType .EQ. WRF_REAL ) THEN<a name='2526'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_REAL'>wrf_patch_to_global_real</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_REAL_3"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='2527'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='2528'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='2529'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='2530'>
      ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='2531'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_INTEGER'>wrf_patch_to_global_integer</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_INTEGER_1"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='2532'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='2533'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='2534'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='2535'>
      ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='2536'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_LOGICAL'>wrf_patch_to_global_logical</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_LOGICAL_1"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='2537'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='2538'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='2539'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='2540'>
      ENDIF<a name='2541'>
<a name='2542'>
#if defined(DM_PARALLEL) &amp;&amp; <font color=#447700>!defined(STUBMPI)<a name='2543'></font>
    CASE ( 'xsz', 'xez' )<a name='2544'>
      distributed_field = .FALSE.<a name='2545'>
      IF ( nproc .GT. 1 ) THEN<a name='2546'>
        jds = DomainStart(1) ; jde = DomainEnd(1) ; IF ( .NOT. has_char( Stagger, 'y' ) ) jde = jde+1  <font color=#447700>! ns strip<a name='2547'></font>
        kds = DomainStart(2) ; kde = DomainEnd(2) ; IF ( .NOT. has_char( Stagger, 'z' ) ) kde = kde+1  <font color=#447700>! levels<a name='2548'></font>
        ids = DomainStart(3) ; ide = DomainEnd(3) ; <font color=#447700>!  bdy_width<a name='2549'></font>
        dom_end_rev(1) = jde<a name='2550'>
        dom_end_rev(2) = kde<a name='2551'>
        dom_end_rev(3) = ide<a name='2552'>
        distributed_field = .TRUE.<a name='2553'>
        IF ( (MemOrd .eq. 'xsz' .AND. bdy_mask( P_XSB )) .OR.     &amp;<a name='2554'>
             (MemOrd .eq. 'xez' .AND. bdy_mask( P_XEB ))       ) THEN<a name='2555'>
          my_displ = PatchStart(1)-1<a name='2556'>
          my_count = PatchEnd(1)-PatchStart(1)+1<a name='2557'>
        ELSE<a name='2558'>
          my_displ = 0<a name='2559'>
          my_count = 0<a name='2560'>
        ENDIF<a name='2561'>
        CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, 0, communicator, ierr )<a name='2562'>
        CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, 0, communicator, ierr )<a name='2563'>
        do i = DomainStart(3),DomainEnd(3)    <font color=#447700>! bdy_width<a name='2564'></font>
        do k = DomainStart(2),DomainEnd(2)    <font color=#447700>! levels<a name='2565'></font>
           lx   = MemoryEnd(1)-MemoryStart(1)+1<a name='2566'>
           lx2  = dom_end_rev(1)-DomainStart(1)+1<a name='2567'>
           idx  = lx*((k-1)+(i-1)*(MemoryEnd(2)-MemoryStart(2)+1))<a name='2568'>
           idx2 = lx2*((k-1)+(i-1)*(MemoryEnd(2)-MemoryStart(2)+1))<a name='2569'>
           IF ( FieldType .EQ. WRF_DOUBLE  ) THEN<a name='2570'>
<a name='2571'>
             CALL wrf_gatherv_double ( Field, PatchStart(1)+idx , &amp;<a name='2572'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='2573'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='2574'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2575'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2576'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2577'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2578'></font>
                             ierr )<a name='2579'>
<a name='2580'>
           ELSE IF ( FieldType .EQ. WRF_REAL ) THEN<a name='2581'>
<a name='2582'>
             CALL wrf_gatherv_real ( Field, PatchStart(1)+idx , &amp;<a name='2583'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='2584'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='2585'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2586'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2587'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2588'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2589'></font>
                             ierr )<a name='2590'>
<a name='2591'>
           ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='2592'>
<a name='2593'>
             CALL wrf_gatherv_integer ( Field, PatchStart(1)+idx , &amp;<a name='2594'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='2595'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='2596'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2597'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2598'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2599'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2600'></font>
                             ierr )<a name='2601'>
           ENDIF<a name='2602'>
<a name='2603'>
        enddo<a name='2604'>
        enddo<a name='2605'>
      ENDIF<a name='2606'>
    CASE ( 'xs', 'xe' )<a name='2607'>
      distributed_field = .FALSE.<a name='2608'>
      IF ( nproc .GT. 1 ) THEN<a name='2609'>
        jds = DomainStart(1) ; jde = DomainEnd(1) ; IF ( .NOT. has_char( Stagger, 'y' ) ) jde = jde+1  <font color=#447700>! ns strip<a name='2610'></font>
        ids = DomainStart(2) ; ide = DomainEnd(2) ; <font color=#447700>!  bdy_width<a name='2611'></font>
        dom_end_rev(1) = jde<a name='2612'>
        dom_end_rev(2) = ide<a name='2613'>
        distributed_field = .TRUE.<a name='2614'>
        IF ( (MemOrd .eq. 'xs' .AND. bdy_mask( P_XSB )) .OR.     &amp;<a name='2615'>
             (MemOrd .eq. 'xe' .AND. bdy_mask( P_XEB ))       ) THEN<a name='2616'>
          my_displ = PatchStart(1)-1<a name='2617'>
          my_count = PatchEnd(1)-PatchStart(1)+1<a name='2618'>
        ELSE<a name='2619'>
          my_displ = 0<a name='2620'>
          my_count = 0<a name='2621'>
        ENDIF<a name='2622'>
        CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, 0, communicator, ierr )<a name='2623'>
        CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, 0, communicator, ierr )<a name='2624'>
        do i = DomainStart(2),DomainEnd(2)    <font color=#447700>! bdy_width<a name='2625'></font>
           lx   = MemoryEnd(1)-MemoryStart(1)+1<a name='2626'>
           idx  = lx*(i-1)<a name='2627'>
           lx2  = dom_end_rev(1)-DomainStart(1)+1<a name='2628'>
           idx2 = lx2*(i-1)<a name='2629'>
           IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='2630'>
<a name='2631'>
             CALL wrf_gatherv_double ( Field, PatchStart(1)+idx , &amp;<a name='2632'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='2633'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='2634'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2635'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2636'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2637'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2638'></font>
                             ierr )<a name='2639'>
<a name='2640'>
           ELSE IF ( FieldType .EQ. WRF_REAL ) THEN<a name='2641'>
<a name='2642'>
             CALL wrf_gatherv_real ( Field, PatchStart(1)+idx , &amp;<a name='2643'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='2644'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='2645'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2646'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2647'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2648'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2649'></font>
                             ierr )<a name='2650'>
<a name='2651'>
           ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='2652'>
<a name='2653'>
             CALL wrf_gatherv_integer ( Field, PatchStart(1)+idx , &amp;<a name='2654'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='2655'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='2656'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2657'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2658'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2659'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2660'></font>
                             ierr )<a name='2661'>
           ENDIF<a name='2662'>
<a name='2663'>
        enddo<a name='2664'>
      ENDIF<a name='2665'>
    CASE ( 'ysz', 'yez' )<a name='2666'>
      distributed_field = .FALSE.<a name='2667'>
      IF ( nproc .GT. 1 ) THEN<a name='2668'>
        ids = DomainStart(1) ; ide = DomainEnd(1) ; IF ( .NOT. has_char( Stagger, 'y' ) ) ide = ide+1  <font color=#447700>! ns strip<a name='2669'></font>
        kds = DomainStart(2) ; kde = DomainEnd(2) ; IF ( .NOT. has_char( Stagger, 'z' ) ) kde = kde+1  <font color=#447700>! levels<a name='2670'></font>
        jds = DomainStart(3) ; jde = DomainEnd(3) ; <font color=#447700>!  bdy_width<a name='2671'></font>
        dom_end_rev(1) = ide<a name='2672'>
        dom_end_rev(2) = kde<a name='2673'>
        dom_end_rev(3) = jde<a name='2674'>
        distributed_field = .TRUE.<a name='2675'>
        IF ( (MemOrd .eq. 'ysz' .AND. bdy_mask( P_YSB )) .OR.     &amp;<a name='2676'>
             (MemOrd .eq. 'yez' .AND. bdy_mask( P_YEB ))       ) THEN<a name='2677'>
          my_displ = PatchStart(1)-1<a name='2678'>
          my_count = PatchEnd(1)-PatchStart(1)+1<a name='2679'>
        ELSE<a name='2680'>
          my_displ = 0<a name='2681'>
          my_count = 0<a name='2682'>
        ENDIF<a name='2683'>
        CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, 0, communicator, ierr )<a name='2684'>
        CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, 0, communicator, ierr )<a name='2685'>
        do j = DomainStart(3),DomainEnd(3)    <font color=#447700>! bdy_width<a name='2686'></font>
        do k = DomainStart(2),DomainEnd(2)    <font color=#447700>! levels<a name='2687'></font>
           lx   = MemoryEnd(1)-MemoryStart(1)+1<a name='2688'>
           lx2  = dom_end_rev(1)-DomainStart(1)+1<a name='2689'>
           idx  = lx*((k-1)+(j-1)*(MemoryEnd(2)-MemoryStart(2)+1))<a name='2690'>
           idx2 = lx2*((k-1)+(j-1)*(MemoryEnd(2)-MemoryStart(2)+1))<a name='2691'>
<a name='2692'>
           IF ( FieldType .EQ. WRF_DOUBLE ) THEN <a name='2693'>
<a name='2694'>
             CALL wrf_gatherv_double ( Field, PatchStart(1)+idx ,      &amp;    <font color=#447700>! sendbuf<a name='2695'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='2696'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='2697'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2698'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2699'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2700'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2701'></font>
                             ierr )<a name='2702'>
<a name='2703'>
           ELSE IF ( FieldType .EQ. WRF_REAL ) THEN<a name='2704'>
<a name='2705'>
             CALL wrf_gatherv_real( Field, PatchStart(1)+idx ,      &amp;    <font color=#447700>! sendbuf<a name='2706'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='2707'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='2708'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2709'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2710'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2711'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2712'></font>
                             ierr )<a name='2713'>
<a name='2714'>
           ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='2715'>
<a name='2716'>
             CALL wrf_gatherv_integer( Field, PatchStart(1)+idx ,      &amp;    <font color=#447700>! sendbuf<a name='2717'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='2718'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='2719'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2720'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2721'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2722'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2723'></font>
                             ierr )<a name='2724'>
           ENDIF<a name='2725'>
<a name='2726'>
        enddo<a name='2727'>
        enddo<a name='2728'>
      ENDIF<a name='2729'>
    CASE ( 'ys', 'ye' )<a name='2730'>
      distributed_field = .FALSE.<a name='2731'>
      IF ( nproc .GT. 1 ) THEN<a name='2732'>
        ids = DomainStart(1) ; ide = DomainEnd(1) ; IF ( .NOT. has_char( Stagger, 'y' ) ) ide = ide+1  <font color=#447700>! ns strip<a name='2733'></font>
        jds = DomainStart(2) ; jde = DomainEnd(2) ; <font color=#447700>!  bdy_width<a name='2734'></font>
        dom_end_rev(1) = ide<a name='2735'>
        dom_end_rev(2) = jde<a name='2736'>
        distributed_field = .TRUE.<a name='2737'>
        IF ( (MemOrd .eq. 'ys' .AND. bdy_mask( P_YSB )) .OR.     &amp;<a name='2738'>
             (MemOrd .eq. 'ye' .AND. bdy_mask( P_YEB ))       ) THEN<a name='2739'>
          my_displ = PatchStart(1)-1<a name='2740'>
          my_count = PatchEnd(1)-PatchStart(1)+1<a name='2741'>
        ELSE<a name='2742'>
          my_displ = 0<a name='2743'>
          my_count = 0<a name='2744'>
        ENDIF<a name='2745'>
        CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, 0, communicator, ierr )<a name='2746'>
        CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, 0, communicator, ierr )<a name='2747'>
        do j = DomainStart(2),DomainEnd(2)    <font color=#447700>! bdy_width<a name='2748'></font>
           lx   = MemoryEnd(1)-MemoryStart(1)+1<a name='2749'>
           idx  = lx*(j-1)<a name='2750'>
           lx2  = dom_end_rev(1)-DomainStart(1)+1<a name='2751'>
           idx2 = lx2*(j-1)<a name='2752'>
<a name='2753'>
           IF ( FieldType .EQ. WRF_DOUBLE ) THEN <a name='2754'>
<a name='2755'>
             CALL wrf_gatherv_double( Field, PatchStart(1)+idx ,      &amp;    <font color=#447700>! sendbuf<a name='2756'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='2757'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='2758'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2759'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2760'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2761'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2762'></font>
                             ierr )<a name='2763'>
<a name='2764'>
           ELSE IF ( FieldType .EQ. WRF_REAL ) THEN<a name='2765'>
<a name='2766'>
             CALL wrf_gatherv_real( Field, PatchStart(1)+idx ,      &amp;    <font color=#447700>! sendbuf<a name='2767'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='2768'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='2769'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2770'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2771'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2772'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2773'></font>
                             ierr )<a name='2774'>
<a name='2775'>
           ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='2776'>
<a name='2777'>
             CALL wrf_gatherv_integer( Field, PatchStart(1)+idx ,      &amp;    <font color=#447700>! sendbuf<a name='2778'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='2779'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='2780'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='2781'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='2782'></font>
                             0                              , &amp;    <font color=#447700>! root<a name='2783'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='2784'></font>
                             ierr )<a name='2785'>
           ENDIF<a name='2786'>
<a name='2787'>
        enddo<a name='2788'>
      ENDIF<a name='2789'>
#endif<a name='2790'>
#endif<a name='2791'>
    CASE DEFAULT<a name='2792'>
      distributed_field = .FALSE.<a name='2793'>
  END SELECT<a name='2794'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='2795'>
    IF ( distributed_field ) THEN<a name='2796'>
      CALL fcn ( Hndl , DateStr , VarName , globbuf , FieldType , Comm , IOComm , &amp;<a name='2797'>
                 DomainDesc , MemoryOrder , Stagger , DimNames ,                  &amp;<a name='2798'>
                 DomainStart , DomainEnd ,                                        &amp;<a name='2799'>
                 DomainStart , dom_end_rev ,                                      &amp;  <font color=#447700>! memory dims adjust out for unstag<a name='2800'></font>
                 DomainStart , DomainEnd ,                                        &amp;<a name='2801'>
                 Status )<a name='2802'>
    ELSE<a name='2803'>
      CALL fcn ( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2804'>
                 DomainDesc , MemoryOrder , Stagger , DimNames ,                  &amp;<a name='2805'>
                 DomainStart , DomainEnd ,                                        &amp;<a name='2806'>
                 MemoryStart , MemoryEnd ,                                        &amp;<a name='2807'>
                 PatchStart  , PatchEnd  ,                                        &amp;<a name='2808'>
                 Status )<a name='2809'>
    ENDIF<a name='2810'>
  ENDIF<a name='2811'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_62">( Status , IWORDSIZE )<a name='2812'>
  RETURN<a name='2813'>
END SUBROUTINE collect_generic_and_call_pkg<a name='2814'>
<a name='2815'>
<a name='2816'>
<A NAME='CALL_PKG_AND_DIST'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2817'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist</font> (       fcn, donotdist_arg, update_arg,                           &amp;,<A href='../../call_from/CALL_PKG_AND_DIST.html' TARGET='index'>2</A><a name='2818'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2819'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2820'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2821'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2822'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2823'>
                                     Status )<a name='2824'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2825'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2826'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='2827'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='2828'></font>
<font color=#447700>! This routine handle cases where distribution/replication can be skipped and <a name='2829'></font>
<font color=#447700>! deals with different data types for Field.<a name='2830'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2831'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2832'></font>
  IMPLICIT NONE<a name='2833'>
  include 'wrf_io_flags.h'<a name='2834'>
  EXTERNAL fcn<a name='2835'>
  LOGICAL,        INTENT(IN)    :: donotdist_arg, update_arg  <font color=#447700>! update means collect old field update it and dist<a name='2836'></font>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2837'>
  CHARACTER*(*) :: DateStr<a name='2838'>
  CHARACTER*(*) :: VarName<a name='2839'>
  INTEGER                          :: Field(*)<a name='2840'>
  INTEGER                                      :: FieldType<a name='2841'>
  INTEGER                                      :: Comm<a name='2842'>
  INTEGER                                      :: IOComm<a name='2843'>
  INTEGER                                      :: DomainDesc<a name='2844'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2845'>
  CHARACTER*(*)                                :: MemoryOrder<a name='2846'>
  CHARACTER*(*)                                :: Stagger<a name='2847'>
  CHARACTER*(*) , dimension (*)                :: DimNames<a name='2848'>
  INTEGER ,dimension(*)                        :: DomainStart, DomainEnd<a name='2849'>
  INTEGER ,dimension(*)                        :: MemoryStart, MemoryEnd<a name='2850'>
  INTEGER ,dimension(*)                        :: PatchStart,  PatchEnd<a name='2851'>
  INTEGER                                      :: Status<a name='2852'>
  LOGICAL donotdist<a name='2853'>
  INTEGER ndims, nproc<a name='2854'>
<a name='2855'>
  CALL <A href='../../html_code/frame/module_io.F.html#DIM_FROM_MEMORDER'>dim_from_memorder</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DIM_FROM_MEMORDER_2">( MemoryOrder , ndims)<a name='2856'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROC'>wrf_get_nproc</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROC_3">( nproc )<a name='2857'>
  donotdist = donotdist_arg .OR. (nproc .EQ. 1)<a name='2858'>
<a name='2859'>
  IF ( donotdist ) THEN<a name='2860'>
    CALL fcn ( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2861'>
               DomainDesc , MemoryOrder , Stagger , DimNames ,                &amp;<a name='2862'>
               DomainStart , DomainEnd ,                                      &amp;<a name='2863'>
               MemoryStart , MemoryEnd ,                                      &amp;<a name='2864'>
               PatchStart , PatchEnd ,                                        &amp;<a name='2865'>
               Status )<a name='2866'>
<a name='2867'>
  ELSE IF (FieldType .EQ. WRF_DOUBLE) THEN<a name='2868'>
<a name='2869'>
     CALL call_pkg_and_dist_double ( fcn, update_arg,                            &amp;<a name='2870'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2871'>
               DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2872'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2873'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2874'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2875'>
               Status )<a name='2876'>
<a name='2877'>
  ELSE IF (FieldType .EQ. WRF_REAL) THEN<a name='2878'>
<a name='2879'>
     CALL call_pkg_and_dist_real ( fcn, update_arg,                            &amp;<a name='2880'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2881'>
               DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2882'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2883'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2884'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2885'>
               Status )<a name='2886'>
<a name='2887'>
  ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='2888'>
<a name='2889'>
     CALL call_pkg_and_dist_int ( fcn, update_arg,                            &amp;<a name='2890'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2891'>
               DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2892'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2893'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2894'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2895'>
               Status )<a name='2896'>
<a name='2897'>
  ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='2898'>
<a name='2899'>
     CALL call_pkg_and_dist_logical ( fcn, update_arg,                            &amp;<a name='2900'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2901'>
               DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2902'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2903'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2904'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2905'>
               Status )<a name='2906'>
<a name='2907'>
  ENDIF<a name='2908'>
  RETURN<a name='2909'>
END SUBROUTINE call_pkg_and_dist<a name='2910'>
<a name='2911'>
<A NAME='CALL_PKG_AND_DIST_REAL'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2912'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_real</font> (  fcn, update_arg,                                             &amp;<a name='2913'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2914'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2915'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2916'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2917'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2918'>
                                     Status )<a name='2919'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2920'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2921'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='2922'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='2923'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big real buffer and<a name='2924'></font>
<font color=#447700>! pass it down to call_pkg_and_dist_generic() to do the actual work.<a name='2925'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2926'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2927'></font>
  IMPLICIT NONE<a name='2928'>
  EXTERNAL fcn<a name='2929'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2930'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='2931'>
  CHARACTER*(*) :: DateStr<a name='2932'>
  CHARACTER*(*) :: VarName<a name='2933'>
  REAL    ,       INTENT(INOUT)    :: Field(*)<a name='2934'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2935'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2936'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2937'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2938'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2939'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2940'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2941'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2942'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2943'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2944'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='2945'>
  REAL, ALLOCATABLE :: globbuf (:)<a name='2946'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='2947'>
<a name='2948'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='2949'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='2950'>
  ELSE<a name='2951'>
    ALLOCATE( globbuf( 1 ) )<a name='2952'>
  ENDIF<a name='2953'>
<a name='2954'>
  globbuf = 0.<a name='2955'>
  CALL call_pkg_and_dist_generic (   fcn, globbuf FRSTELEM , update_arg,                          &amp;<a name='2956'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2957'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2958'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2959'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2960'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2961'>
                                     Status )<a name='2962'>
  DEALLOCATE ( globbuf )<a name='2963'>
  RETURN<a name='2964'>
END SUBROUTINE call_pkg_and_dist_real<a name='2965'>
<a name='2966'>
<a name='2967'>
<A NAME='CALL_PKG_AND_DIST_DOUBLE'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2968'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_double</font>  (  fcn, update_arg ,                                            &amp;<a name='2969'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2970'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2971'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2972'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2973'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2974'>
                                     Status )<a name='2975'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2976'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2977'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='2978'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='2979'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big double precision buffer <a name='2980'></font>
<font color=#447700>! and pass it down to call_pkg_and_dist_generic() to do the actual work.<a name='2981'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2982'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2983'></font>
  IMPLICIT NONE<a name='2984'>
  EXTERNAL fcn<a name='2985'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2986'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='2987'>
  CHARACTER*(*) :: DateStr<a name='2988'>
  CHARACTER*(*) :: VarName<a name='2989'>
  DOUBLE PRECISION   ,       INTENT(INOUT)    :: Field(*)<a name='2990'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2991'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2992'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2993'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2994'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2995'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2996'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2997'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2998'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2999'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3000'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3001'>
  DOUBLE PRECISION , ALLOCATABLE :: globbuf (:)<a name='3002'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3003'>
<a name='3004'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3005'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='3006'>
  ELSE<a name='3007'>
    ALLOCATE( globbuf( 1 ) )<a name='3008'>
  ENDIF<a name='3009'>
<a name='3010'>
  globbuf = 0<a name='3011'>
<a name='3012'>
  CALL call_pkg_and_dist_generic (   fcn, globbuf FRSTELEM , update_arg ,                         &amp;<a name='3013'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3014'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='3015'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3016'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3017'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3018'>
                                     Status )<a name='3019'>
  DEALLOCATE ( globbuf )<a name='3020'>
  RETURN<a name='3021'>
END SUBROUTINE call_pkg_and_dist_double<a name='3022'>
<a name='3023'>
<a name='3024'>
<A NAME='CALL_PKG_AND_DIST_INT'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_INT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3025'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_int</font>  (  fcn, update_arg ,                                            &amp;<a name='3026'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3027'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='3028'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3029'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3030'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3031'>
                                     Status )<a name='3032'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3033'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3034'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3035'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3036'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big integer buffer and <a name='3037'></font>
<font color=#447700>! pass it down to call_pkg_and_dist_generic() to do the actual work.<a name='3038'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3039'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3040'></font>
  IMPLICIT NONE<a name='3041'>
  EXTERNAL fcn<a name='3042'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3043'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='3044'>
  CHARACTER*(*) :: DateStr<a name='3045'>
  CHARACTER*(*) :: VarName<a name='3046'>
  INTEGER    ,       INTENT(INOUT)    :: Field(*)<a name='3047'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3048'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3049'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3050'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3051'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3052'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3053'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3054'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3055'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3056'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3057'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3058'>
  INTEGER , ALLOCATABLE :: globbuf (:)<a name='3059'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3060'>
<a name='3061'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3062'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='3063'>
  ELSE<a name='3064'>
    ALLOCATE( globbuf( 1 ) )<a name='3065'>
  ENDIF<a name='3066'>
<a name='3067'>
  globbuf = 0<a name='3068'>
<a name='3069'>
  CALL call_pkg_and_dist_generic (   fcn, globbuf FRSTELEM , update_arg ,                                  &amp;<a name='3070'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3071'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='3072'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3073'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3074'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3075'>
                                     Status )<a name='3076'>
  DEALLOCATE ( globbuf )<a name='3077'>
  RETURN<a name='3078'>
END SUBROUTINE call_pkg_and_dist_int<a name='3079'>
<a name='3080'>
<a name='3081'>
<A NAME='CALL_PKG_AND_DIST_LOGICAL'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3082'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_logical</font>  (  fcn, update_arg ,                                            &amp;<a name='3083'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3084'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='3085'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3086'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3087'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3088'>
                                     Status )<a name='3089'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3090'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3091'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3092'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3093'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big logical buffer and <a name='3094'></font>
<font color=#447700>! pass it down to call_pkg_and_dist_generic() to do the actual work.<a name='3095'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3096'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3097'></font>
  IMPLICIT NONE<a name='3098'>
  EXTERNAL fcn<a name='3099'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3100'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='3101'>
  CHARACTER*(*) :: DateStr<a name='3102'>
  CHARACTER*(*) :: VarName<a name='3103'>
  logical    ,       INTENT(INOUT)    :: Field(*)<a name='3104'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3105'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3106'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3107'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3108'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3109'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3110'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3111'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3112'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3113'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3114'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3115'>
  LOGICAL , ALLOCATABLE :: globbuf (:)<a name='3116'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3117'>
<a name='3118'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3119'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='3120'>
  ELSE<a name='3121'>
    ALLOCATE( globbuf( 1 ) )<a name='3122'>
  ENDIF<a name='3123'>
<a name='3124'>
  globbuf = .false.<a name='3125'>
<a name='3126'>
  CALL call_pkg_and_dist_generic (   fcn, globbuf FRSTELEM , update_arg ,                         &amp;<a name='3127'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3128'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='3129'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3130'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3131'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3132'>
                                     Status )<a name='3133'>
  DEALLOCATE ( globbuf )<a name='3134'>
  RETURN<a name='3135'>
END SUBROUTINE call_pkg_and_dist_logical<a name='3136'>
<a name='3137'>
<A NAME='CALL_PKG_AND_DIST_GENERIC'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3138'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_generic</font> (   fcn, globbuf , update_arg ,                                  &amp;,<A href='../../call_from/CALL_PKG_AND_DIST_GENERIC.html' TARGET='index'>21</A><a name='3139'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3140'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='3141'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3142'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3143'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3144'>
                                     Status )<a name='3145'>
<a name='3146'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3147'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3148'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3149'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3150'></font>
<font color=#447700>! This routine calls I/O function fcn to read the field from disk and then calls <a name='3151'></font>
<font color=#447700>! the distributed memory communication routines that distribute or replicate the <a name='3152'></font>
<font color=#447700>! array.  <a name='3153'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3154'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3155'></font>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_21"><a name='3156'>
  IMPLICIT NONE<a name='3157'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_23"><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3158'>
  EXTERNAL fcn<a name='3159'>
  REAL, DIMENSION(*) ::  globbuf<a name='3160'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3161'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='3162'>
  CHARACTER*(*) :: DateStr<a name='3163'>
  CHARACTER*(*) :: VarName<a name='3164'>
  REAL                           :: Field(*)<a name='3165'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3166'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3167'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3168'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3169'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3170'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3171'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3172'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3173'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3174'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3175'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='3176'>
  CHARACTER*3 MemOrd<a name='3177'>
  LOGICAL, EXTERNAL :: has_char<a name='3178'>
  INTEGER ids, ide, jds, jde, kds, kde<a name='3179'>
  INTEGER ims, ime, jms, jme, kms, kme<a name='3180'>
  INTEGER ips, ipe, jps, jpe, kps, kpe<a name='3181'>
  INTEGER , dimension(3)                       :: dom_end_rev<a name='3182'>
  INTEGER memsize<a name='3183'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3184'>
  LOGICAL distributed_field<a name='3185'>
<a name='3186'>
  CALL <A href='../../html_code/frame/module_io.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_2">( MemoryOrder, MemOrd )<a name='3187'>
<a name='3188'>
  dom_end_rev(1) = DomainEnd(1)<a name='3189'>
  dom_end_rev(2) = DomainEnd(2)<a name='3190'>
  dom_end_rev(3) = DomainEnd(3)<a name='3191'>
<a name='3192'>
  SELECT CASE (TRIM(MemOrd))<a name='3193'>
    CASE (  'xzy' )<a name='3194'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3195'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3196'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3197'>
    CASE (  'zxy' )<a name='3198'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3199'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3200'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3201'>
    CASE (  'xyz' )<a name='3202'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3203'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3204'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3205'>
    CASE (  'xy' )<a name='3206'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3207'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3208'>
    CASE (  'yxz' )<a name='3209'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3210'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3211'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3212'>
    CASE (  'yx' )<a name='3213'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3214'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3215'>
    CASE DEFAULT<a name='3216'>
      <font color=#447700>! do nothing; the boundary orders and others either dont care or set themselves<a name='3217'></font>
  END SELECT<a name='3218'>
<a name='3219'>
  SELECT CASE (MemOrd)<a name='3220'>
    CASE ( 'xzy' )<a name='3221'>
      distributed_field = .TRUE.<a name='3222'>
    CASE ( 'xyz' )<a name='3223'>
      distributed_field = .TRUE.<a name='3224'>
    CASE ( 'yxz' )<a name='3225'>
      distributed_field = .TRUE.<a name='3226'>
    CASE ( 'zxy' )<a name='3227'>
      distributed_field = .TRUE.<a name='3228'>
    CASE ( 'xy' )<a name='3229'>
      distributed_field = .TRUE.<a name='3230'>
    CASE ( 'yx' )<a name='3231'>
      distributed_field = .TRUE.<a name='3232'>
    CASE DEFAULT<a name='3233'>
      <font color=#447700>! all other memory orders are replicated<a name='3234'></font>
      distributed_field = .FALSE.<a name='3235'>
  END SELECT<a name='3236'>
<a name='3237'>
  IF ( distributed_field ) THEN<a name='3238'>
<a name='3239'>
<font color=#447700>! added 8/2004 for interfaces, like MCEL, that want the old values so they can be updated<a name='3240'></font>
    IF ( update_arg ) THEN<a name='3241'>
      SELECT CASE (TRIM(MemOrd))<a name='3242'>
        CASE (  'xzy','zxy','xyz','yxz','xy','yx' )<a name='3243'>
          IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='3244'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_DOUBLE'>wrf_patch_to_global_double</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_DOUBLE_2"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3245'>
               DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3246'>
               MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3247'>
               PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3248'>
          ELSE IF (  FieldType .EQ. WRF_REAL ) THEN<a name='3249'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_REAL'>wrf_patch_to_global_real</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_REAL_4"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3250'>
               DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3251'>
               MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3252'>
               PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3253'>
          ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3254'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_INTEGER'>wrf_patch_to_global_integer</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_INTEGER_2"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3255'>
               DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3256'>
               MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3257'>
               PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3258'>
          ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='3259'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_LOGICAL'>wrf_patch_to_global_logical</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_LOGICAL_2"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3260'>
               DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3261'>
               MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3262'>
               PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3263'>
          ENDIF<a name='3264'>
        CASE DEFAULT<a name='3265'>
      END SELECT<a name='3266'>
    ENDIF<a name='3267'>
<a name='3268'>
    IF ( wrf_dm_on_monitor()) THEN<a name='3269'>
      CALL fcn ( Hndl , DateStr , VarName , globbuf , FieldType , Comm , IOComm , &amp;<a name='3270'>
                 DomainDesc , MemoryOrder , Stagger , DimNames ,                  &amp;<a name='3271'>
                 DomainStart , DomainEnd ,                                        &amp;<a name='3272'>
                 DomainStart , dom_end_rev ,                                        &amp;<a name='3273'>
                 DomainStart , DomainEnd ,                                          &amp;<a name='3274'>
                 Status )<a name='3275'>
<a name='3276'>
    ENDIF<a name='3277'>
<a name='3278'>
    CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_63">( Status, IWORDSIZE )<a name='3279'>
  <a name='3280'>
    CALL <A href='../../html_code/frame/module_io.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_3">( MemoryOrder, MemOrd )<a name='3281'>
    IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='3282'>
<a name='3283'>
      SELECT CASE (MemOrd)<a name='3284'>
      CASE ( 'xzy','xyz','yxz','zxy' )<a name='3285'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_DOUBLE'>wrf_global_to_patch_double</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_DOUBLE_1"> (  globbuf,  Field  , DomainDesc, Stagger, MemOrd ,    &amp;<a name='3286'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3287'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3288'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3)  )<a name='3289'>
      CASE ( 'xy','yx' )<a name='3290'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_DOUBLE'>wrf_global_to_patch_double</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_DOUBLE_2"> (  globbuf, Field ,  DomainDesc, Stagger, MemOrd ,  &amp;<a name='3291'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), 1            , 1 , &amp;<a name='3292'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), 1            , 1 , &amp;<a name='3293'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , 1            , 1   )<a name='3294'>
      END SELECT<a name='3295'>
<a name='3296'>
    ELSE IF ( FieldType .EQ. WRF_REAL ) THEN<a name='3297'>
<a name='3298'>
      SELECT CASE (MemOrd)<a name='3299'>
      CASE ( 'xzy','xyz','yxz','zxy' )<a name='3300'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_REAL'>wrf_global_to_patch_real</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_REAL_2"> (  globbuf,  Field  , DomainDesc, Stagger, MemOrd ,    &amp;<a name='3301'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3302'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3303'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3)  )<a name='3304'>
      CASE ( 'xy','yx' )<a name='3305'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_REAL'>wrf_global_to_patch_real</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_REAL_3"> (  globbuf, Field ,  DomainDesc, Stagger, MemOrd ,  &amp;<a name='3306'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), 1            , 1 , &amp;<a name='3307'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), 1            , 1 , &amp;<a name='3308'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , 1            , 1   )<a name='3309'>
      END SELECT<a name='3310'>
<a name='3311'>
    ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3312'>
<a name='3313'>
      SELECT CASE (MemOrd)<a name='3314'>
      CASE ( 'xzy','xyz','yxz','zxy' )<a name='3315'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_INTEGER'>wrf_global_to_patch_integer</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_INTEGER_1"> (  globbuf,  Field  , DomainDesc, Stagger, MemOrd ,    &amp;<a name='3316'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3317'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3318'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3)  )<a name='3319'>
      CASE ( 'xy','yx' )<a name='3320'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_INTEGER'>wrf_global_to_patch_integer</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_INTEGER_2"> (  globbuf, Field ,  DomainDesc, Stagger, MemOrd ,  &amp;<a name='3321'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), 1            , 1 , &amp;<a name='3322'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), 1            , 1 , &amp;<a name='3323'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , 1            , 1   )<a name='3324'>
      END SELECT<a name='3325'>
<a name='3326'>
    ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='3327'>
<a name='3328'>
      SELECT CASE (MemOrd)<a name='3329'>
      CASE ( 'xzy','xyz','yxz','zxy' )<a name='3330'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_LOGICAL'>wrf_global_to_patch_logical</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_LOGICAL_1"> (  globbuf,  Field  , DomainDesc, Stagger, MemOrd ,    &amp;<a name='3331'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3332'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3333'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3)  )<a name='3334'>
      CASE ( 'xy','yx' )<a name='3335'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_LOGICAL'>wrf_global_to_patch_logical</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_LOGICAL_2"> (  globbuf, Field ,  DomainDesc, Stagger, MemOrd ,  &amp;<a name='3336'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), 1            , 1 , &amp;<a name='3337'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), 1            , 1 , &amp;<a name='3338'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , 1            , 1   )<a name='3339'>
      END SELECT<a name='3340'>
<a name='3341'>
    ENDIF<a name='3342'>
  ELSE<a name='3343'>
    IF ( wrf_dm_on_monitor()) THEN<a name='3344'>
      CALL fcn ( Hndl , DateStr , VarName , Field   , FieldType , Comm , IOComm , &amp;<a name='3345'>
                 DomainDesc , MemoryOrder , Stagger , DimNames ,                  &amp;<a name='3346'>
                 DomainStart , DomainEnd ,                                        &amp;<a name='3347'>
                 MemoryStart , MemoryEnd ,                                        &amp;<a name='3348'>
                 PatchStart  , PatchEnd  ,                                        &amp;<a name='3349'>
                 Status )<a name='3350'>
    ENDIF<a name='3351'>
    CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_64">( Status, IWORDSIZE )<a name='3352'>
    memsize = (MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)<a name='3353'>
    IF ( FieldType .EQ. WRF_DOUBLE ) THEN <a name='3354'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_65">( Field , DWORDSIZE*memsize )<a name='3355'>
    ELSE IF ( FieldType .EQ. WRF_REAL) THEN<a name='3356'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_66">( Field , RWORDSIZE*memsize )<a name='3357'>
    ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3358'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_67">( Field , IWORDSIZE*memsize )<a name='3359'>
    ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='3360'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_68">( Field , LWORDSIZE*memsize )<a name='3361'>
    ENDIF<a name='3362'>
  ENDIF<a name='3363'>
<a name='3364'>
<a name='3365'>
  RETURN<a name='3366'>
END SUBROUTINE call_pkg_and_dist_generic<a name='3367'>
<a name='3368'>
<font color=#447700>!!!!!!  Miscellaneous routines<a name='3369'></font>
<a name='3370'>
<font color=#447700>! stole these routines from io_netcdf external package; changed names to avoid collisions<a name='3371'></font>
<A NAME='DIM_FROM_MEMORDER'><A href='../../html_code/frame/module_io.F.html#DIM_FROM_MEMORDER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3372'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>dim_from_memorder</font>(MemoryOrder,NDim) <A href='../../call_to/DIM_FROM_MEMORDER.html' TARGET='index'>2</A>,<A href='../../call_from/DIM_FROM_MEMORDER.html' TARGET='index'>1</A><a name='3373'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3374'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3375'></font>
<font color=#447700>! Decodes array ranks from memory order.  <a name='3376'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3377'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3378'></font>
  CHARACTER*(*) ,INTENT(IN)  :: MemoryOrder<a name='3379'>
  INTEGER       ,INTENT(OUT) :: NDim<a name='3380'>
<font color=#447700>!Local<a name='3381'></font>
  CHARACTER*3                :: MemOrd<a name='3382'>
<font color=#447700>!<a name='3383'></font>
  CALL <A href='../../html_code/frame/module_io.F.html#LOWER_CASE'>Lower_Case</A><A href='../../html_code/frame/module_io.F.html#DIM_FROM_MEMORDER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_4">(MemoryOrder,MemOrd)<a name='3384'>
  SELECT CASE (MemOrd)<a name='3385'>
    CASE ('xyz','xzy','yxz','yzx','zxy','zyx')<a name='3386'>
      NDim = 3<a name='3387'>
    CASE ('xy','yx')<a name='3388'>
      NDim = 2<a name='3389'>
    CASE ('z','c','0')<a name='3390'>
      NDim = 1<a name='3391'>
    CASE DEFAULT<a name='3392'>
      NDim = 0<a name='3393'>
      RETURN<a name='3394'>
  END SELECT<a name='3395'>
  RETURN<a name='3396'>
END SUBROUTINE dim_from_memorder<a name='3397'>
<a name='3398'>
<A NAME='LOWER_CASE'><A href='../../html_code/frame/module_io.F.html#LOWER_CASE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3399'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>lower_case</font>(MemoryOrder,MemOrd) <A href='../../call_to/LOWER_CASE.html' TARGET='index'>6</A><a name='3400'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3401'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3402'></font>
<font color=#447700>! Translates upper-case characters to lower-case.  <a name='3403'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3404'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3405'></font>
  CHARACTER*(*) ,INTENT(IN)  :: MemoryOrder<a name='3406'>
  CHARACTER*(*) ,INTENT(OUT) :: MemOrd<a name='3407'>
<font color=#447700>!Local<a name='3408'></font>
  CHARACTER*1                :: c<a name='3409'>
  INTEGER       ,PARAMETER   :: upper_to_lower =IACHAR('a')-IACHAR('A')<a name='3410'>
  INTEGER                    :: i,n<a name='3411'>
<font color=#447700>!<a name='3412'></font>
  MemOrd = ' '<a name='3413'>
  N = len(MemoryOrder)<a name='3414'>
  MemOrd(1:N) = MemoryOrder(1:N)<a name='3415'>
  DO i=1,N<a name='3416'>
    c = MemoryOrder(i:i)<a name='3417'>
    if('A'&lt;=c .and. c &lt;='Z') MemOrd(i:i)=achar(iachar(c)+upper_to_lower)<a name='3418'>
  ENDDO<a name='3419'>
  RETURN<a name='3420'>
END SUBROUTINE Lower_Case<a name='3421'>
<a name='3422'>
<A NAME='HAS_CHAR'><A href='../../html_code/frame/module_io.F.html#HAS_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3423'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>has_char</font>( str, c ),<A href='../../call_from/HAS_CHAR.html' TARGET='index'>2</A><a name='3424'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3425'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3426'></font>
<font color=#447700>! Returns .TRUE. iff string str contains character c.  Ignores character case.  <a name='3427'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3428'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3429'></font>
  IMPLICIT NONE<a name='3430'>
  CHARACTER*(*) str<a name='3431'>
  CHARACTER c, d<a name='3432'>
  CHARACTER*80 str1, str2, str3<a name='3433'>
  INTEGER i<a name='3434'>
<a name='3435'>
  CALL <A href='../../html_code/frame/module_io.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#HAS_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_5">( TRIM(str), str1 )<a name='3436'>
  str2 = ""<a name='3437'>
  str2(1:1) = c<a name='3438'>
  CALL <A href='../../html_code/frame/module_io.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#HAS_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_6">( str2, str3 )<a name='3439'>
  d = str3(1:1)<a name='3440'>
  DO i = 1, LEN(TRIM(str1))<a name='3441'>
    IF ( str1(i:i) .EQ. d ) THEN<a name='3442'>
      has_char = .TRUE.<a name='3443'>
      RETURN<a name='3444'>
    ENDIF<a name='3445'>
  ENDDO<a name='3446'>
  has_char = .FALSE.<a name='3447'>
  RETURN<a name='3448'>
END FUNCTION has_char<a name='3449'>
<a name='3450'>
</pre></body></html>