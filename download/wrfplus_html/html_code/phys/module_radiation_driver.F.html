<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MEDIATION_LAYER:PHYSICS<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<A NAME='MODULE_RADIATION_DRIVER'><A href='../../html_code/phys/module_radiation_driver.F.html#MODULE_RADIATION_DRIVER' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='4'>
<font color=#993300>MODULE </font><font color=#cc0000>module_radiation_driver</font> <A href='../../call_to/MODULE_RADIATION_DRIVER.html' TARGET='index'>5</A><a name='5'>
CONTAINS<a name='6'>
<font color=#447700>!BOP<a name='7'></font>
<font color=#447700>! !IROUTINE: radiation_driver - interface to radiation physics options<a name='8'></font>
<a name='9'>
<font color=#447700>! !INTERFACE:<a name='10'></font>
<A NAME='RADIATION_DRIVER'><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>radiation_driver</font> (itimestep,dt,                            &amp; <A href='../../call_to/RADIATION_DRIVER.html' TARGET='index'>3</A>,<A href='../../call_from/RADIATION_DRIVER.html' TARGET='index'>22</A><a name='12'>
                       AER_DRY,AER_WATER,RTHRATENLW,RTHRATENSW,RTHRATEN, &amp;<a name='13'>
                         GLW,GSW,SWDOWN,XLAT,XLONG,ALBEDO,CLDFRA,EMISS,  &amp;<a name='14'>
                         rho_phy,moist,n_moist,                          &amp;<a name='15'>
                         p8w,p_phy,Pb,pi_phy,dz8w,t_phy,t8w,GMT,         &amp;<a name='16'>
                         JULDAY,config_flags,RADT,STEPRA,ICLOUD,         &amp;<a name='17'>
                         taucldi,taucldc,warm_rain,                      &amp;<a name='18'>
                         XLAND,TSK,HTOP,HBOT,CUPPT,VEGFRA,SNOW,          &amp;<a name='19'>
                         julyr,                                          &amp;<a name='20'>
                         NPHS,                                           &amp;<a name='21'>
                         TOTSWDN,TOTLWDN,RSWTOA,RLWTOA,CZMEAN,           &amp;<a name='22'>
                         CFRACL,CFRACM,CFRACH,                           &amp;<a name='23'>
                         ACFRST,NCFRST,ACFRCV,NCFRCV,                    &amp;<a name='24'>
                         ids,ide, jds,jde, kds,kde,                      &amp;<a name='25'>
                         ims,ime, jms,jme, kms,kme,                      &amp;<a name='26'>
                         i_start,i_end,j_start,j_end,kts,kte,num_tiles   )<a name='27'>
<font color=#447700>!-------------------------------------------------------------------------<a name='28'></font>
<a name='29'>
<font color=#447700>! !USES:<a name='30'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_108"><a name='31'>
   USE module_state_description<a name='32'>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_40"><a name='33'>
   USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_40"><a name='34'>
<a name='35'>
<font color=#447700>! *** add new modules of schemes here<a name='36'></font>
<a name='37'>
   USE <A href='../../html_code/phys/module_ra_sw.F.html#MODULE_RA_SW'>module_ra_sw</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_SW_2"><a name='38'>
   USE <A href='../../html_code/phys/module_ra_gsfcsw.F.html#MODULE_RA_GSFCSW'>module_ra_gsfcsw</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_GSFCSW_2"><a name='39'>
   USE <A href='../../html_code/phys/module_ra_rrtm.F.html#MODULE_RA_RRTM'>module_ra_rrtm</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_RRTM_2"><a name='40'>
   USE <A href='../../html_code/phys/module_ra_gfdleta.F.html#MODULE_RA_GFDLETA'>module_ra_gfdleta</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_GFDLETA_2"><a name='41'>
<a name='42'>
   <font color=#447700>!  This driver calls subroutines for the radiation parameterizations.<a name='43'></font>
   <font color=#447700>!<a name='44'></font>
   <font color=#447700>!  short wave radiation choices:<a name='45'></font>
   <font color=#447700>!  1. swrad (19??)<a name='46'></font>
   <font color=#447700>!<a name='47'></font>
   <font color=#447700>!  long wave radiation choices:<a name='48'></font>
   <font color=#447700>!  1. rrtmlwrad<a name='49'></font>
   <font color=#447700>!<a name='50'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='51'></font>
   IMPLICIT NONE<a name='52'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='53'></font>
<font color=#447700>!<a name='54'></font>
<font color=#447700>! Radiation_driver is the WRF mediation layer routine that provides the interface to<a name='55'></font>
<font color=#447700>! to radiation physics packages in the WRF model layer. The radiation<a name='56'></font>
<font color=#447700>! physics packages to call are chosen by setting the namelist variable<a name='57'></font>
<font color=#447700>! (Rconfig entry in Registry) to the integer value assigned to the <a name='58'></font>
<font color=#447700>! particular package (package entry in Registry). For example, if the<a name='59'></font>
<font color=#447700>! namelist variable ra_lw_physics is set to 1, this corresponds to the<a name='60'></font>
<font color=#447700>! Registry Package entry for swradscheme.  Note that the Package<a name='61'></font>
<font color=#447700>! names in the Registry are defined constants (frame/module_state_description.F)<a name='62'></font>
<font color=#447700>! in the CASE statements in this routine.<a name='63'></font>
<font color=#447700>!<a name='64'></font>
<font color=#447700>! Among the arguments is moist, a four-dimensional scalar array storing<a name='65'></font>
<font color=#447700>! a variable number of moisture tracers, depending on the physics <a name='66'></font>
<font color=#447700>! configuration for the WRF run, as determined in the namelist.  The<a name='67'></font>
<font color=#447700>! highest numbered index of active moisture tracers the integer argument<a name='68'></font>
<font color=#447700>! n_moist (note: the number of tracers at run time is the quantity<a name='69'></font>
<font color=#447700>! &lt;tt&gt;n_moist - PARAM_FIRST_SCALAR + 1&lt;/tt&gt; , not n_moist. Individual tracers<a name='70'></font>
<font color=#447700>! may be indexed from moist by the Registry name of the tracer prepended<a name='71'></font>
<font color=#447700>! with P_; for example P_QC is the index of cloud water. An index <a name='72'></font>
<font color=#447700>! represents a valid, active field only if the index is greater than<a name='73'></font>
<font color=#447700>! or equal to PARAM_FIRST_SCALAR.  PARAM_FIRST_SCALAR and the individual<a name='74'></font>
<font color=#447700>! indices for each tracer is defined in module_state_description and<a name='75'></font>
<font color=#447700>! set in &lt;a href=set_scalar_indices_from_config.html&gt;set_scalar_indices_from_config&lt;/a&gt; defined in frame/module_configure.F.<a name='76'></font>
<font color=#447700>!<a name='77'></font>
<font color=#447700>! Physics drivers in WRF 2.0 and higher, originally model-layer <a name='78'></font>
<font color=#447700>! routines, have been promoted to mediation layer routines and they<a name='79'></font>
<font color=#447700>! contain OpenMP threaded loops over tiles.  Thus, physics drivers<a name='80'></font>
<font color=#447700>! are called from single-threaded regions in the solver. The physics<a name='81'></font>
<font color=#447700>! routines that are called from the physics drivers are model-layer<a name='82'></font>
<font color=#447700>! routines and fully tile-callable and thread-safe.<a name='83'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='84'></font>
<font color=#447700>! <a name='85'></font>
<font color=#447700>!======================================================================<a name='86'></font>
<font color=#447700>! Grid structure in physics part of WRF<a name='87'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='88'></font>
<font color=#447700>! The horizontal velocities used in the physics are unstaggered<a name='89'></font>
<font color=#447700>! relative to temperature/moisture variables. All predicted<a name='90'></font>
<font color=#447700>! variables are carried at half levels except w, which is at full<a name='91'></font>
<font color=#447700>! levels. Some arrays with names (*8w) are at w (full) levels.<a name='92'></font>
<font color=#447700>!<a name='93'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='94'></font>
<font color=#447700>! In WRF, kms (smallest number) is the bottom level and kme (largest<a name='95'></font>
<font color=#447700>! number) is the top level.  In your scheme, if 1 is at the top level,<a name='96'></font>
<font color=#447700>! then you have to reverse the order in the k direction.<a name='97'></font>
<font color=#447700>!<a name='98'></font>
<font color=#447700>!         kme      -   half level (no data at this level)<a name='99'></font>
<font color=#447700>!         kme    ----- full level<a name='100'></font>
<font color=#447700>!         kme-1    -   half level<a name='101'></font>
<font color=#447700>!         kme-1  ----- full level<a name='102'></font>
<font color=#447700>!         .<a name='103'></font>
<font color=#447700>!         .<a name='104'></font>
<font color=#447700>!         .<a name='105'></font>
<font color=#447700>!         kms+2    -   half level<a name='106'></font>
<font color=#447700>!         kms+2  ----- full level<a name='107'></font>
<font color=#447700>!         kms+1    -   half level<a name='108'></font>
<font color=#447700>!         kms+1  ----- full level<a name='109'></font>
<font color=#447700>!         kms      -   half level<a name='110'></font>
<font color=#447700>!         kms    ----- full level<a name='111'></font>
<font color=#447700>!<a name='112'></font>
<font color=#447700>!======================================================================<a name='113'></font>
<font color=#447700>! Grid structure in physics part of WRF<a name='114'></font>
<font color=#447700>! <a name='115'></font>
<font color=#447700>!-------------------------------------<a name='116'></font>
<font color=#447700>! The horizontal velocities used in the physics are unstaggered <a name='117'></font>
<font color=#447700>! relative to temperature/moisture variables. All predicted <a name='118'></font>
<font color=#447700>! variables are carried at half levels except w, which is at full <a name='119'></font>
<font color=#447700>! levels. Some arrays with names (*8w) are at w (full) levels.<a name='120'></font>
<font color=#447700>!<a name='121'></font>
<font color=#447700>!==================================================================<a name='122'></font>
<font color=#447700>! Definitions<a name='123'></font>
<font color=#447700>!-----------<a name='124'></font>
<font color=#447700>! Theta      potential temperature (K)<a name='125'></font>
<font color=#447700>! Qv         water vapor mixing ratio (kg/kg)<a name='126'></font>
<font color=#447700>! Qc         cloud water mixing ratio (kg/kg)<a name='127'></font>
<font color=#447700>! Qr         rain water mixing ratio (kg/kg)<a name='128'></font>
<font color=#447700>! Qi         cloud ice mixing ratio (kg/kg)<a name='129'></font>
<font color=#447700>! Qs         snow mixing ratio (kg/kg)<a name='130'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='131'></font>
<font color=#447700>!-- RTHRATEN      Theta tendency <a name='132'></font>
<font color=#447700>!                 due to radiation (K/s)<a name='133'></font>
<font color=#447700>!-- RTHRATENLW    Theta tendency <a name='134'></font>
<font color=#447700>!                 due to long wave radiation (K/s)<a name='135'></font>
<font color=#447700>!-- RTHRATENSW    Theta temperature tendency <a name='136'></font>
<font color=#447700>!                 due to short wave radiation (K/s)<a name='137'></font>
<font color=#447700>!-- dt            time step (s)<a name='138'></font>
<font color=#447700>!-- itimestep     number of time steps<a name='139'></font>
<font color=#447700>!-- GLW           downward long wave flux at ground surface (W/m^2)<a name='140'></font>
<font color=#447700>!-- GSW           net short wave flux at ground surface (W/m^2)<a name='141'></font>
<font color=#447700>!-- SWDOWN        downward short wave flux at ground surface (W/m^2)<a name='142'></font>
<font color=#447700>!-- XLAT          latitude, south is negative (degree)<a name='143'></font>
<font color=#447700>!-- XLONG         longitude, west is negative (degree)<a name='144'></font>
<font color=#447700>!-- ALBEDO                albedo (between 0 and 1)<a name='145'></font>
<font color=#447700>!-- CLDFRA        cloud fraction (between 0 and 1)<a name='146'></font>
<font color=#447700>!-- EMISS         surface emissivity (between 0 and 1)<a name='147'></font>
<font color=#447700>!-- rho_phy       density (kg/m^3)<a name='148'></font>
<font color=#447700>!-- rr            dry air density (kg/m^3)<a name='149'></font>
<font color=#447700>!-- moist         moisture array (4D - last index is species) (kg/kg)<a name='150'></font>
<font color=#447700>!-- n_moist       number of moisture species<a name='151'></font>
<font color=#447700>!-- p8w           pressure at full levels (Pa)<a name='152'></font>
<font color=#447700>!-- p_phy         pressure (Pa)<a name='153'></font>
<font color=#447700>!-- Pb            base-state pressure (Pa)<a name='154'></font>
<font color=#447700>!-- pi_phy        exner function (dimensionless)<a name='155'></font>
<font color=#447700>!-- dz8w          dz between full levels (m)<a name='156'></font>
<font color=#447700>!-- t_phy         temperature (K)<a name='157'></font>
<font color=#447700>!-- t8w           temperature at full levels (K)<a name='158'></font>
<font color=#447700>!-- GMT           Greenwich Mean Time Hour of model start (hour)<a name='159'></font>
<font color=#447700>!-- JULDAY        the initial day (Julian day)<a name='160'></font>
<font color=#447700>!-- config_flags  boundary condition flag<a name='161'></font>
<font color=#447700>!-- RADT          time for calling radiation (min)<a name='162'></font>
<font color=#447700>!-- DEGRAD        conversion factor for <a name='163'></font>
<font color=#447700>!                 degrees to radians (pi/180.) (rad/deg)<a name='164'></font>
<font color=#447700>!-- DPD           degrees per day for earth's <a name='165'></font>
<font color=#447700>!                 orbital position (deg/day)<a name='166'></font>
<font color=#447700>!-- R_d           gas constant for dry air (J/kg/K)<a name='167'></font>
<font color=#447700>!-- CP            heat capacity at constant pressure for dry air (J/kg/K)<a name='168'></font>
<font color=#447700>!-- G             acceleration due to gravity (m/s^2)<a name='169'></font>
<font color=#447700>!-- rvovrd        R_v divided by R_d (dimensionless)<a name='170'></font>
<font color=#447700>!-- XTIME         time since simulation start (min)<a name='171'></font>
<font color=#447700>!-- DECLIN        solar declination angle (rad)<a name='172'></font>
<font color=#447700>!-- SOLCON        solar constant (W/m^2)<a name='173'></font>
<font color=#447700>!-- P_QV          species index for water vapor<a name='174'></font>
<font color=#447700>!-- P_QC          species index for cloud water<a name='175'></font>
<font color=#447700>!-- P_QR          species index for rain water<a name='176'></font>
<font color=#447700>!-- P_QI          species index for cloud ice<a name='177'></font>
<font color=#447700>!-- P_QS          species index for snow<a name='178'></font>
<font color=#447700>!-- P_QG          species index for graupel<a name='179'></font>
<font color=#447700>!-- ids           start index for i in domain<a name='180'></font>
<font color=#447700>!-- ide           end index for i in domain<a name='181'></font>
<font color=#447700>!-- jds           start index for j in domain<a name='182'></font>
<font color=#447700>!-- jde           end index for j in domain<a name='183'></font>
<font color=#447700>!-- kds           start index for k in domain<a name='184'></font>
<font color=#447700>!-- kde           end index for k in domain<a name='185'></font>
<font color=#447700>!-- ims           start index for i in memory<a name='186'></font>
<font color=#447700>!-- ime           end index for i in memory<a name='187'></font>
<font color=#447700>!-- jms           start index for j in memory<a name='188'></font>
<font color=#447700>!-- jme           end index for j in memory<a name='189'></font>
<font color=#447700>!-- kms           start index for k in memory<a name='190'></font>
<font color=#447700>!-- kme           end index for k in memory<a name='191'></font>
<font color=#447700>!-- i_start       start indices for i in tile<a name='192'></font>
<font color=#447700>!-- i_end         end indices for i in tile<a name='193'></font>
<font color=#447700>!-- j_start       start indices for j in tile<a name='194'></font>
<font color=#447700>!-- j_end         end indices for j in tile<a name='195'></font>
<font color=#447700>!-- kts           start index for k in tile<a name='196'></font>
<font color=#447700>!-- kte           end index for k in tile<a name='197'></font>
<font color=#447700>!-- num_tiles     number of tiles<a name='198'></font>
<font color=#447700>!<a name='199'></font>
<font color=#447700>!==================================================================<a name='200'></font>
   TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='201'>
<font color=#447700>!<a name='202'></font>
   INTEGER,      INTENT(IN   )    ::   ids,ide, jds,jde, kds,kde, &amp;<a name='203'>
                                       ims,ime, jms,jme, kms,kme, &amp;<a name='204'>
                                                         kts,kte, &amp;<a name='205'>
                                       n_moist,num_tiles<a name='206'>
   INTEGER, DIMENSION(num_tiles), INTENT(IN) ::                       &amp;<a name='207'>
     &amp;           i_start,i_end,j_start,j_end<a name='208'>
<a name='209'>
   INTEGER,      INTENT(IN   )    ::   STEPRA,ICLOUD<a name='210'>
   LOGICAL,      INTENT(IN   )    ::   warm_rain<a name='211'>
<a name='212'>
   REAL,      INTENT(IN   )       ::   RADT<a name='213'>
<a name='214'>
   REAL, DIMENSION( ims:ime, jms:jme ),                           &amp;<a name='215'>
         INTENT(IN   )  ::                                 XLAND, &amp;<a name='216'>
                                                             TSK, &amp;<a name='217'>
                                                          VEGFRA, &amp;<a name='218'>
                                                            SNOW <a name='219'>
<a name='220'>
   REAL, DIMENSION( ims:ime, jms:jme ),                           &amp;<a name='221'>
         INTENT(INOUT)  ::                                  HTOP, &amp;<a name='222'>
                                                            HBOT, &amp;<a name='223'>
                                                           CUPPT<a name='224'>
<a name='225'>
   INTEGER, INTENT(IN   )  ::   julyr<a name='226'>
<font color=#447700>!<a name='227'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme ),                  &amp;<a name='228'>
         INTENT(IN ) ::                                     dz8w, &amp;<a name='229'>
                                                             p8w, &amp;<a name='230'>
                                                           p_phy, &amp;<a name='231'>
                                                              Pb, &amp;<a name='232'>
                                                          pi_phy, &amp;<a name='233'>
                                                           t_phy, &amp;<a name='234'>
                                                             t8w, &amp;<a name='235'>
                                                         rho_phy, &amp;<a name='236'>
                                                         aer_dry, &amp;<a name='237'>
                                                       aer_water<a name='238'>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme ),                  &amp;<a name='239'>
         INTENT(INOUT) ::                                 CLDFRA<a name='240'>
<font color=#447700>!<a name='241'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme, n_moist ),         &amp;<a name='242'>
         INTENT(IN ) ::                                    moist<a name='243'>
<font color=#447700>!<a name='244'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme ),                  &amp;<a name='245'>
         INTENT(INOUT)  ::                              RTHRATEN, &amp;<a name='246'>
                                                      RTHRATENLW, &amp;<a name='247'>
                                                      RTHRATENSW<a name='248'>
<a name='249'>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme ),                  &amp;<a name='250'>
         INTENT(INOUT)  ::                       taucldi,taucldc<a name='251'>
<font color=#447700>!<a name='252'></font>
   REAL, DIMENSION( ims:ime, jms:jme ),                           &amp;<a name='253'>
         INTENT(IN   )  ::                                  XLAT, &amp;<a name='254'>
                                                           XLONG, &amp;<a name='255'>
                                                          ALBEDO, &amp;<a name='256'>
                                                           EMISS<a name='257'>
<font color=#447700>!<a name='258'></font>
   REAL, DIMENSION( ims:ime, jms:jme ),                           &amp;<a name='259'>
         INTENT(INOUT)  ::                                   GSW, &amp;<a name='260'>
                                                             GLW<a name='261'>
<a name='262'>
   REAL, DIMENSION( ims:ime, jms:jme ), INTENT(OUT)  ::   SWDOWN<a name='263'>
<font color=#447700>!<a name='264'></font>
   REAL, INTENT(IN  )   ::                                GMT,dt<a name='265'>
<font color=#447700>!<a name='266'></font>
   INTEGER, INTENT(IN  ) ::                    JULDAY, itimestep<a name='267'>
<a name='268'>
   INTEGER,INTENT(IN)                                       :: NPHS<a name='269'>
   REAL, DIMENSION( ims:ime, jms:jme ),INTENT(OUT)          ::    &amp;<a name='270'>
                                                      CFRACH,     &amp; <font color=#447700>!Added<a name='271'></font>
                                                      CFRACL,     &amp; <font color=#447700>!Added<a name='272'></font>
                                                      CFRACM,     &amp; <font color=#447700>!Added<a name='273'></font>
                                                      CZMEAN,     &amp; <font color=#447700>!Added<a name='274'></font>
                                                      TOTLWDN,    &amp; <font color=#447700>!Added<a name='275'></font>
                                                      TOTSWDN       <font color=#447700>!Added<a name='276'></font>
<a name='277'>
   REAL, DIMENSION( ims:ime, jms:jme ),                           &amp;<a name='278'>
         INTENT(INOUT)  ::                                        &amp;<a name='279'>
                                                          RLWTOA, &amp;  <font color=#447700>!Added<a name='280'></font>
                                                          RSWTOA, &amp;  <font color=#447700>!Added<a name='281'></font>
                                                          ACFRST, &amp;  <font color=#447700>!Added<a name='282'></font>
                                                          ACFRCV     <font color=#447700>!Added<a name='283'></font>
   INTEGER,DIMENSION( ims:ime, jms:jme ),INTENT(INOUT)        ::  &amp;<a name='284'>
                                                          NCFRST, &amp;  <font color=#447700>!Added<a name='285'></font>
                                                          NCFRCV     <font color=#447700>!Added<a name='286'></font>
 <a name='287'>
<font color=#447700>! LOCAL  VAR<a name='288'></font>
<a name='289'>
   REAL, DIMENSION( ims:ime, jms:jme ) ::             GLAT,GLON<a name='290'>
<a name='291'>
   REAL    ::    XTIME,DECLIN,SOLCON <a name='292'>
   INTEGER ::    i,j,k,its,ite,jts,jte,ij<a name='293'>
   LOGICAL ::    gfdl_lw,gfdl_sw<a name='294'>
<a name='295'>
   REAL    ::    OBECL,SINOB,SXLONG,ARG,DECDEG,                  &amp;<a name='296'>
                 DJUL,RJUL,ECCFAC<a name='297'>
<font color=#447700>!------------------------------------------------------------------<a name='298'></font>
<a name='299'>
   if (config_flags%ra_lw_physics .eq. 0 .and. &amp;<a name='300'>
       config_flags%ra_sw_physics .eq. 0)         return<a name='301'>
<a name='302'>
   IF (itimestep .eq. 1 .or. mod(itimestep,STEPRA) .eq. 0) THEN<a name='303'>
   gfdl_lw = .false.<a name='304'>
   gfdl_sw = .false.<a name='305'>
<a name='306'>
<font color=#447700>!---------------<a name='307'></font>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='308'></font>
      <font color=#447700>!$OMP PRIVATE ( ij ,i,j,k,its,ite,jts,jte)<a name='309'></font>
<a name='310'>
      DO ij = 1 , num_tiles<a name='311'>
        its = i_start(ij)<a name='312'>
        ite = i_end(ij)<a name='313'>
        jts = j_start(ij)<a name='314'>
        jte = j_end(ij)<a name='315'>
<a name='316'>
<font color=#447700>! initialize data<a name='317'></font>
<a name='318'>
   DO j=jts,jte<a name='319'>
   DO i=its,ite<a name='320'>
      GSW(I,J)=0.<a name='321'>
      GLW(I,J)=0.<a name='322'>
      SWDOWN(I,J)=0.<a name='323'>
      GLAT(I,J)=XLAT(I,J)*DEGRAD<a name='324'>
      GLON(I,J)=XLONG(I,J)*DEGRAD<a name='325'>
   ENDDO<a name='326'>
   ENDDO<a name='327'>
<a name='328'>
   DO j=jts,jte<a name='329'>
   DO k=kts,kte<a name='330'>
   DO i=its,ite<a name='331'>
      RTHRATEN(I,K,J)=0.<a name='332'>
   ENDDO<a name='333'>
   ENDDO<a name='334'>
   ENDDO<a name='335'>
<a name='336'>
<font color=#447700>!---------------<a name='337'></font>
<font color=#447700>! Calculate constant for short wave radiation<a name='338'></font>
<a name='339'>
   CALL <A href='../../html_code/phys/module_radiation_driver.F.html#RADCONST'>radconst</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RADCONST_1">(XTIME,DECLIN,SOLCON,GMT,JULDAY,           &amp;<a name='340'>
                 DEGRAD,DPD,itimestep,dt                   )<a name='341'>
<a name='342'>
   CALL <A href='../../html_code/phys/module_radiation_driver.F.html#CAL_CLDFRA'>cal_cldfra</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CAL_CLDFRA_1">(CLDFRA,moist(ims,kms,jms,P_QC),         &amp;<a name='343'>
                   moist(ims,kms,jms,P_QI),P_QI,P_QC,      &amp;<a name='344'>
                   PARAM_FIRST_SCALAR,                     &amp;<a name='345'>
                   ids,ide, jds,jde, kds,kde,              &amp;<a name='346'>
                   ims,ime, jms,jme, kms,kme,              &amp;<a name='347'>
                   its,ite, jts,jte, kts,kte               )<a name='348'>
<a name='349'>
<font color=#447700>!pjj/cray  Cray X1 cannot print from threaded region<a name='350'></font>
#ifndef crayx1<a name='351'>
   WRITE(wrf_err_message,*)'SOLCON=',SOLCON,DECLIN,XTIME<a name='352'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_168">(50,wrf_err_message)<a name='353'>
#endif<a name='354'>
<a name='355'>
   lwrad_select: SELECT CASE(config_flags%ra_lw_physics)<a name='356'>
<a name='357'>
        CASE (RRTMSCHEME)<a name='358'>
             CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_169"> (100, 'CALL rrtm')<a name='359'>
<a name='360'>
             CALL <A href='../../html_code/phys/module_ra_rrtm.F.html#RRTMLWRAD'>RRTMLWRAD</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMLWRAD_1">(RTHRATEN,GLW,EMISS,                    &amp;<a name='361'>
                     moist(ims,kms,jms,P_QV),                      &amp;<a name='362'>
                     moist(ims,kms,jms,P_QC),                      &amp;<a name='363'>
                     moist(ims,kms,jms,P_QR),                      &amp;<a name='364'>
                     moist(ims,kms,jms,P_QI),                      &amp;<a name='365'>
                     moist(ims,kms,jms,P_QS),                      &amp;<a name='366'>
                     moist(ims,kms,jms,P_QG),                      &amp;<a name='367'>
                     p8w,p_phy,pi_phy,dz8w,t_phy,                  &amp;<a name='368'>
                     t8w, rho_phy, CLDFRA,R_d,G,                   &amp;<a name='369'>
                     P_QV,P_QC,P_QR,P_QI,P_QS,P_QG,                &amp;<a name='370'>
                     PARAM_FIRST_SCALAR,                           &amp;<a name='371'>
                     ICLOUD,warm_rain,                             &amp;<a name='372'>
                     ids,ide, jds,jde, kds,kde,                    &amp;     <a name='373'>
                     ims,ime, jms,jme, kms,kme,                    &amp;<a name='374'>
                     its,ite, jts,jte, kts,kte                     )<a name='375'>
<a name='376'>
       CASE (GFDLLWSCHEME)<a name='377'>
<a name='378'>
             CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_170"> (100, 'CALL gfdllw')<a name='379'>
<a name='380'>
             gfdl_lw  = .true.<a name='381'>
<a name='382'>
               CALL <A href='../../html_code/phys/module_ra_gfdleta.F.html#ETARA'>ETARA</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ETARA_1">(DT,RTHRATEN,RTHRATENLW,RTHRATENSW,pi_phy, &amp;<a name='383'>
                        XLAND,p8w,dz8w,rho_phy,p_phy,t_phy,          &amp;<a name='384'>
                        moist(ims,kms,jms,P_QV),                     &amp;<a name='385'>
                        moist(ims,kms,jms,P_QC),                     &amp;<a name='386'>
                        moist(ims,kms,jms,P_QI),                     &amp;<a name='387'>
                        TSK,GLW,GSW,                                 &amp;<a name='388'>
                        TOTSWDN,TOTLWDN,RSWTOA,RLWTOA,CZMEAN,        &amp; <font color=#447700>!Added<a name='389'></font>
                        GLAT,GLON,HTOP,HBOT,ALBEDO,CUPPT,            &amp;<a name='390'>
                        VEGFRA,SNOW,G,GMT,                           &amp; <font color=#447700>!Modified<a name='391'></font>
                        STEPRA,NPHS,itimestep,                       &amp; <font color=#447700>!Modified<a name='392'></font>
                        julyr,julday,gfdl_lw,gfdl_sw,                &amp;<a name='393'>
                        CFRACL,CFRACM,CFRACH,                        &amp; <font color=#447700>!Added<a name='394'></font>
                        ACFRST,NCFRST,ACFRCV,NCFRCV,                 &amp; <font color=#447700>!Added<a name='395'></font>
                        ids,ide, jds,jde, kds,kde,                   &amp;<a name='396'>
                        ims,ime, jms,jme, kms,kme,                   &amp;<a name='397'>
                        its,ite, jts,jte, kts,kte                    )<a name='398'>
<a name='399'>
        CASE DEFAULT<a name='400'>
  <a name='401'>
             WRITE( wrf_err_message , * ) 'The longwave option does not exist: ra_lw_physics = ', config_flags%ra_lw_physics<a name='402'>
             CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_174"> ( wrf_err_message )<a name='403'>
           <a name='404'>
   END SELECT lwrad_select    <a name='405'>
<a name='406'>
   IF (config_flags%ra_lw_physics .gt. 0 ) THEN<a name='407'>
      DO j=jts,jte<a name='408'>
      DO k=kts,kte<a name='409'>
      DO i=its,ite<a name='410'>
         RTHRATENLW(I,K,J)=RTHRATEN(I,K,J)<a name='411'>
      ENDDO<a name='412'>
      ENDDO<a name='413'>
      ENDDO<a name='414'>
   ENDIF<a name='415'>
<font color=#447700>!<a name='416'></font>
<a name='417'>
   swrad_select: SELECT CASE(config_flags%ra_sw_physics)<a name='418'>
<a name='419'>
        CASE (SWRADSCHEME)<a name='420'>
             CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_171">(100, 'CALL swrad')<a name='421'>
             CALL <A href='../../html_code/phys/module_ra_sw.F.html#SWRAD'>SWRAD</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SWRAD_1">(dt,RTHRATEN,GSW,XLAT,XLONG,ALBEDO,         &amp;<a name='422'>
                     aer_dry,aer_water,rho_phy,t_phy,              &amp;<a name='423'>
                     moist(ims,kms,jms,P_QV),                      &amp;<a name='424'>
                     moist(ims,kms,jms,P_QC),                      &amp;<a name='425'>
                     moist(ims,kms,jms,P_QR),                      &amp;<a name='426'>
                     moist(ims,kms,jms,P_QI),                      &amp;<a name='427'>
                     moist(ims,kms,jms,P_QS),                      &amp;<a name='428'>
                     moist(ims,kms,jms,P_QG),                      &amp;<a name='429'>
                     p_phy,pi_phy,dz8w,GMT,                        &amp;<a name='430'>
                     R_d,CP,G,JULDAY,                              &amp;<a name='431'>
                     XTIME,DECLIN,SOLCON,                          &amp;<a name='432'>
                     P_QV,P_QC,P_QR,P_QI,P_QS,P_QG,                &amp;<a name='433'>
                     PARAM_FIRST_SCALAR,                           &amp;<a name='434'>
                     RADT,ICLOUD,DEGRAD,warm_rain,                 &amp;<a name='435'>
                     ids,ide, jds,jde, kds,kde,                    &amp;    <a name='436'>
                     ims,ime, jms,jme, kms,kme,                    &amp; <a name='437'>
                     its,ite, jts,jte, kts,kte                     ) <a name='438'>
<a name='439'>
        CASE (GSFCSWSCHEME)<a name='440'>
             CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_172">(100, 'CALL gsfcswrad')<a name='441'>
             CALL <A href='../../html_code/phys/module_ra_gsfcsw.F.html#GSFCSWRAD'>GSFCSWRAD</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GSFCSWRAD_1">(RTHRATEN,GSW,XLAT,XLONG,               &amp;<a name='442'>
                     ALBEDO,t_phy,                                 &amp;<a name='443'>
                     moist(ims,kms,jms,P_QV),                      &amp;<a name='444'>
                     moist(ims,kms,jms,P_QC),                      &amp;<a name='445'>
                     moist(ims,kms,jms,P_QR),                      &amp;<a name='446'>
                     moist(ims,kms,jms,P_QI),                      &amp;<a name='447'>
                     moist(ims,kms,jms,P_QS),                      &amp;<a name='448'>
                     moist(ims,kms,jms,P_QG),                      &amp;<a name='449'>
                     p_phy,p8w,pi_phy,CLDFRA,                      &amp;<a name='450'>
                     GMT,CP,G,JULDAY,XTIME,DECLIN,SOLCON,          &amp;<a name='451'>
                     P_QV,P_QC,P_QR,P_QI,P_QS,P_QG,                &amp;<a name='452'>
                     PARAM_FIRST_SCALAR,                           &amp;<a name='453'>
                     RADT,DEGRAD,taucldi,taucldc,warm_rain,        &amp;<a name='454'>
                     ids,ide, jds,jde, kds,kde,                    &amp;<a name='455'>
                     ims,ime, jms,jme, kms,kme,                    &amp;<a name='456'>
                     its,ite, jts,jte, kts,kte                     )<a name='457'>
<a name='458'>
       CASE (GFDLSWSCHEME)<a name='459'>
<a name='460'>
             CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_173"> (100, 'CALL gfdlsw')<a name='461'>
<a name='462'>
             gfdl_sw = .true.<a name='463'>
<a name='464'>
               CALL  <A href='../../html_code/phys/module_ra_gfdleta.F.html#ETARA'>ETARA</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ETARA_2">(DT,RTHRATEN,RTHRATENLW,RTHRATENSW,pi_phy, &amp;<a name='465'>
                        XLAND,p8w,dz8w,rho_phy,p_phy,t_phy,          &amp;<a name='466'>
                        moist(ims,kms,jms,P_QV),                     &amp;<a name='467'>
                        moist(ims,kms,jms,P_QC),                     &amp;<a name='468'>
                        moist(ims,kms,jms,P_QI),                     &amp;<a name='469'>
                        TSK,GLW,GSW,                                 &amp;<a name='470'>
                        TOTSWDN,TOTLWDN,RSWTOA,RLWTOA,CZMEAN,        &amp; <font color=#447700>!Added<a name='471'></font>
                        GLAT,GLON,HTOP,HBOT,ALBEDO,CUPPT,            &amp;<a name='472'>
                        VEGFRA,SNOW,G,GMT,                           &amp; <font color=#447700>!Modified<a name='473'></font>
                        STEPRA,NPHS,itimestep,                       &amp; <font color=#447700>!Modified<a name='474'></font>
                        julyr,julday,gfdl_lw,gfdl_sw,                &amp;<a name='475'>
                        CFRACL,CFRACM,CFRACH,                        &amp; <font color=#447700>!Added<a name='476'></font>
                        ACFRST,NCFRST,ACFRCV,NCFRCV,                 &amp; <font color=#447700>!Added<a name='477'></font>
                        ids,ide, jds,jde, kds,kde,                   &amp;<a name='478'>
                        ims,ime, jms,jme, kms,kme,                   &amp;<a name='479'>
                        its,ite, jts,jte, kts,kte                    )<a name='480'>
<a name='481'>
        CASE DEFAULT<a name='482'>
<a name='483'>
             WRITE( wrf_err_message , * ) 'The shortwave option does not exist: ra_sw_physics = ', config_flags%ra_sw_physics<a name='484'>
             CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADIATION_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_175"> ( wrf_err_message )<a name='485'>
<a name='486'>
   END SELECT swrad_select    <a name='487'>
<a name='488'>
   IF (config_flags%ra_sw_physics .gt. 0) THEN<a name='489'>
      DO j=jts,jte<a name='490'>
      DO k=kts,kte<a name='491'>
      DO i=its,ite<a name='492'>
         RTHRATENSW(I,K,J)=RTHRATEN(I,K,J)-RTHRATENLW(I,K,J)<a name='493'>
      ENDDO<a name='494'>
      ENDDO<a name='495'>
      ENDDO<a name='496'>
<a name='497'>
      DO j=jts,jte<a name='498'>
      DO i=its,ite<a name='499'>
         SWDOWN(I,J)=GSW(I,J)/(1.-ALBEDO(I,J))<a name='500'>
      ENDDO<a name='501'>
      ENDDO<a name='502'>
<a name='503'>
   ENDIF<a name='504'>
<a name='505'>
      ENDDO<a name='506'>
      <font color=#447700>!$OMP END PARALLEL DO<a name='507'></font>
<a name='508'>
   ENDIF<a name='509'>
<a name='510'>
   END SUBROUTINE radiation_driver<a name='511'>
<a name='512'>
<font color=#447700>!---------------------------------------------------------------------<a name='513'></font>
<font color=#447700>!BOP<a name='514'></font>
<font color=#447700>! !IROUTINE: radconst - compute radiation terms<a name='515'></font>
<font color=#447700>! !INTERFAC:<a name='516'></font>
<A NAME='RADCONST'><A href='../../html_code/phys/module_radiation_driver.F.html#RADCONST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='517'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>radconst</font>(XTIME,DECLIN,SOLCON,GMT,JULDAY,               &amp; <A href='../../call_to/RADCONST.html' TARGET='index'>1</A>,<A href='../../call_from/RADCONST.html' TARGET='index'>2</A><a name='518'>
                       DEGRAD,DPD,step,dt                            )<a name='519'>
<font color=#447700>!---------------------------------------------------------------------<a name='520'></font>
   USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADCONST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_41"><a name='521'>
   IMPLICIT NONE<a name='522'>
<font color=#447700>!---------------------------------------------------------------------<a name='523'></font>
<a name='524'>
<font color=#447700>! !ARGUMENTS:<a name='525'></font>
   INTEGER, INTENT(IN   )   ::       JULDAY, step<a name='526'>
   REAL, INTENT(IN   )      ::       GMT,dt,DEGRAD,DPD<a name='527'>
   REAL, INTENT(OUT  )      ::       XTIME,DECLIN,SOLCON<a name='528'>
   REAL                     ::       OBECL,SINOB,SXLONG,ARG,JULIAN,  &amp;<a name='529'>
                                     DECDEG,DJUL,RJUL,ECCFAC<a name='530'>
<font color=#447700>!<a name='531'></font>
<font color=#447700>! !DESCRIPTION:<a name='532'></font>
<font color=#447700>! Compute terms used in radiation physics <a name='533'></font>
<font color=#447700>!EOP<a name='534'></font>
<a name='535'>
<font color=#447700>! for short wave radiation<a name='536'></font>
<a name='537'>
   DECLIN=0.<a name='538'>
   SOLCON=0.<a name='539'>
<a name='540'>
<font color=#447700>!-----OBECL : OBLIQUITY = 23.5 DEGREE.<a name='541'></font>
        <a name='542'>
   OBECL=23.5*DEGRAD<a name='543'>
   SINOB=SIN(OBECL)<a name='544'>
   XTIME=float(step)*dt/60.<a name='545'>
        <a name='546'>
<font color=#447700>!-----CALCULATE LONGITUDE OF THE SUN FROM VERNAL EQUINOX:<a name='547'></font>
        <a name='548'>
   JULIAN=FLOAT(JULDAY-1)+(XTIME/60.+GMT)/24.<a name='549'>
   IF(JULIAN.GE.80.)SXLONG=DPD*(JULIAN-80.)<a name='550'>
   IF(JULIAN.LT.80.)SXLONG=DPD*(JULIAN+285.)<a name='551'>
   SXLONG=SXLONG*DEGRAD<a name='552'>
   ARG=SINOB*SIN(SXLONG)<a name='553'>
   DECLIN=ASIN(ARG)<a name='554'>
   DECDEG=DECLIN/DEGRAD<a name='555'>
<font color=#447700>!----SOLAR CONSTANT ECCENTRICITY FACTOR (PALTRIDGE AND PLATT 1976)<a name='556'></font>
   DJUL=JULIAN*360./365.<a name='557'>
   RJUL=DJUL*DEGRAD<a name='558'>
   ECCFAC=1.000110+0.034221*COS(RJUL)+0.001280*SIN(RJUL)+0.000719*  &amp;<a name='559'>
          COS(2*RJUL)+0.000077*SIN(2*RJUL)<a name='560'>
   SOLCON=1370.*ECCFAC<a name='561'>
   <a name='562'>
<font color=#447700>!pjj/cray  Cray X1 cannot print from threaded region<a name='563'></font>
#ifndef crayx1<a name='564'>
   write(wrf_err_message,10)DECDEG,SOLCON<a name='565'>
10 FORMAT(1X,'*** SOLAR DECLINATION ANGLE = ',F6.2,' DEGREES.',     &amp;<a name='566'>
        ' SOLAR CONSTANT = ',F8.2,' W/M**2 ***')<a name='567'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_radiation_driver.F.html#RADCONST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_174"> (50, wrf_err_message)<a name='568'>
#endif<a name='569'>
<a name='570'>
   END SUBROUTINE radconst<a name='571'>
<a name='572'>
<font color=#447700>!---------------------------------------------------------------------<a name='573'></font>
<font color=#447700>!BOP<a name='574'></font>
<font color=#447700>! !IROUTINE: cal_cldfra - Compute cloud fraction<a name='575'></font>
<font color=#447700>! !INTERFACE:<a name='576'></font>
<A NAME='CAL_CLDFRA'><A href='../../html_code/phys/module_radiation_driver.F.html#CAL_CLDFRA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='577'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>cal_cldfra</font>(CLDFRA,QC,QI,P_QI,P_QC,                     &amp; <A href='../../call_to/CAL_CLDFRA.html' TARGET='index'>1</A><a name='578'>
          PARAM_FIRST_SCALAR,                                        &amp;<a name='579'>
          ids,ide, jds,jde, kds,kde,                                 &amp;<a name='580'>
          ims,ime, jms,jme, kms,kme,                                 &amp;<a name='581'>
          its,ite, jts,jte, kts,kte                                  )<a name='582'>
<font color=#447700>!---------------------------------------------------------------------<a name='583'></font>
   IMPLICIT NONE<a name='584'>
<font color=#447700>!---------------------------------------------------------------------<a name='585'></font>
   INTEGER,  INTENT(IN   )   ::           ids,ide, jds,jde, kds,kde, &amp;<a name='586'>
                                          ims,ime, jms,jme, kms,kme, &amp;<a name='587'>
                                          its,ite, jts,jte, kts,kte<a name='588'>
<a name='589'>
   INTEGER,  INTENT(IN   )   ::           P_QI,P_QC,PARAM_FIRST_SCALAR<a name='590'>
<font color=#447700>!<a name='591'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme ), INTENT(OUT  ) ::    &amp;<a name='592'>
                                                             CLDFRA<a name='593'>
<a name='594'>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme ), INTENT(IN   ) ::    &amp;<a name='595'>
                                                                 QI, &amp;<a name='596'>
                                                                 QC<a name='597'>
<a name='598'>
   REAL thresh<a name='599'>
   INTEGER:: i,j,k<a name='600'>
<font color=#447700>! !DESCRIPTION:<a name='601'></font>
<font color=#447700>! Compute cloud fraction from input ice and cloud water fields<a name='602'></font>
<font color=#447700>! if provided.<a name='603'></font>
<font color=#447700>!<a name='604'></font>
<font color=#447700>! Whether QI or QC is active or not is determined from the indices of<a name='605'></font>
<font color=#447700>! the fields into the 4D scalar arrays in WRF. These indices are <a name='606'></font>
<font color=#447700>! P_QI and P_QC, respectively, and they are passed in to the routine<a name='607'></font>
<font color=#447700>! to enable testing to see if QI and QC represent active fields in<a name='608'></font>
<font color=#447700>! the moisture 4D scalar array carried by WRF.<a name='609'></font>
<font color=#447700>! <a name='610'></font>
<font color=#447700>! If a field is active its index will have a value greater than or<a name='611'></font>
<font color=#447700>! equal to PARAM_FIRST_SCALAR, which is also an input argument to <a name='612'></font>
<font color=#447700>! this routine.<a name='613'></font>
<font color=#447700>!EOP<a name='614'></font>
<font color=#447700>!---------------------------------------------------------------------<a name='615'></font>
     thresh=1.0e-6<a name='616'>
<a name='617'>
     IF ( P_QI .ge. PARAM_FIRST_SCALAR .and. P_QC .ge. PARAM_FIRST_SCALAR ) THEN<a name='618'>
        DO j = jts,jte<a name='619'>
        DO k = kts,kte<a name='620'>
        DO i = its,ite<a name='621'>
           IF ( QC(i,k,j)+QI(I,k,j) .gt. thresh) THEN<a name='622'>
              CLDFRA(i,k,j)=1.<a name='623'>
           ELSE<a name='624'>
              CLDFRA(i,k,j)=0.<a name='625'>
           ENDIF<a name='626'>
        ENDDO<a name='627'>
        ENDDO<a name='628'>
        ENDDO<a name='629'>
     ELSE IF ( P_QC .ge. PARAM_FIRST_SCALAR ) THEN<a name='630'>
        DO j = jts,jte<a name='631'>
        DO k = kts,kte<a name='632'>
        DO i = its,ite<a name='633'>
           IF ( QC(i,k,j) .gt. thresh) THEN<a name='634'>
              CLDFRA(i,k,j)=1.<a name='635'>
           ELSE<a name='636'>
              CLDFRA(i,k,j)=0.<a name='637'>
           ENDIF<a name='638'>
        ENDDO<a name='639'>
        ENDDO<a name='640'>
        ENDDO<a name='641'>
     ELSE <a name='642'>
        DO j = jts,jte<a name='643'>
        DO k = kts,kte<a name='644'>
        DO i = its,ite<a name='645'>
           CLDFRA(i,k,j)=0.<a name='646'>
        ENDDO<a name='647'>
        ENDDO<a name='648'>
        ENDDO<a name='649'>
     ENDIF<a name='650'>
<a name='651'>
   END SUBROUTINE cal_cldfra<a name='652'>
END MODULE module_radiation_driver<a name='653'>
</pre></body></html>