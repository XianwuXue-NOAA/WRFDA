<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MODEL_LAYER:INITIALIZATION<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<a name='4'>
<font color=#447700>!  This MODULE holds the routines which are used to perform model start-up operations<a name='5'></font>
<font color=#447700>!  for the individual domains.  This is the stage after inputting wrfinput and before<a name='6'></font>
<font color=#447700>!  calling 'integrate'.<a name='7'></font>
<a name='8'>
<font color=#447700>!  This MODULE CONTAINS the following routines:<a name='9'></font>
<a name='10'>
<a name='11'>
<A NAME='MODULE_PHYSICS_INIT'><A href='../../html_code/phys/module_physics_init.F.html#MODULE_PHYSICS_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='12'>
<font color=#993300>MODULE </font><font color=#cc0000>module_physics_init</font> <A href='../../call_to/MODULE_PHYSICS_INIT.html' TARGET='index'>1</A><a name='13'>
<a name='14'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/phys/module_physics_init.F.html#module_physics_init.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_98"><a name='15'>
<font color=#447700>!  USE module_io_domain<a name='16'></font>
   USE module_state_description<a name='17'>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/phys/module_physics_init.F.html#module_physics_init.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_38"><a name='18'>
<font color=#447700>!  USE module_timing<a name='19'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/phys/module_physics_init.F.html#module_physics_init.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_107"><a name='20'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/phys/module_physics_init.F.html#module_physics_init.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_8"><a name='21'>
#ifdef DM_PARALLEL<a name='22'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/phys/module_physics_init.F.html#module_physics_init.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_28"><a name='23'>
#endif<a name='24'>
<a name='25'>
CONTAINS<a name='26'>
<a name='27'>
<a name='28'>
<font color=#447700>!=================================================================<a name='29'></font>
<A NAME='PHY_INIT'><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='30'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>phy_init</font> ( grid,                                   &amp; <A href='../../call_to/PHY_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/PHY_INIT.html' TARGET='index'>17</A><a name='31'>
                         id, config_flags, DT, zfull, zhalf,     &amp;<a name='32'>
                         p_top, TSK,RADT,BLDT,CUDT,MPDT,         &amp;<a name='33'>
                         RTHCUTEN, RQVCUTEN, RQRCUTEN,           &amp;<a name='34'>
                         RQCCUTEN, RQSCUTEN, RQICUTEN,           &amp;<a name='35'>
                         RUBLTEN,RVBLTEN,RTHBLTEN,               &amp;<a name='36'>
                         RQVBLTEN,RQCBLTEN,RQIBLTEN,             &amp;<a name='37'>
                         RTHRATEN,RTHRATENLW,RTHRATENSW,         &amp;<a name='38'>
                         STEPBL,STEPRA,STEPCU,                   &amp;<a name='39'>
                         W0AVG, RAINNC, RAINC, RAINCV, RAINNCV,  &amp;<a name='40'>
                         NCA,                                    &amp;<a name='41'>
                         CLDEFI,LOWLYR,                          &amp;<a name='42'>
                         MASS_FLUX,                              &amp;<a name='43'>
                         RTHFTEN, RQVFTEN,                       &amp;<a name='44'>
                         CLDFRA,GLW,GSW,EMISS,LU_INDEX,          &amp;<a name='45'>
                         XLAT,XLONG,ALBEDO,ALBBCK,GMT,JULYR,JULDAY,&amp;<a name='46'>
                         TMN,XLAND,ZNT,Z0,UST,MOL,PBLH,TKE_MYJ,  &amp;<a name='47'>
                         EXCH_H,THC,SNOWC,MAVAIL,HFX,QFX,RAINBL,        &amp;<a name='48'>
                         TSLB,ZS,DZS,num_soil_layers,warm_rain,  &amp; <a name='49'>
                         APR_GR,APR_W,APR_MC,APR_ST,APR_AS,      &amp;<a name='50'>
                         APR_CAPMA,APR_CAPME,APR_CAPMI,          &amp;<a name='51'>
                         XICE,VEGFRA,SNOW,CANWAT,SMSTAV,         &amp;<a name='52'>
                         SMSTOT, SFCRUNOFF,UDRUNOFF,GRDFLX,ACSNOW,&amp;<a name='53'>
                         ACSNOM,IVGTYP,ISLTYP, SFCEVP, SMOIS,    &amp;<a name='54'>
                         SH2O, SNOWH, SMFR3D,                    &amp;  <font color=#447700>! temporary<a name='55'></font>
                         DX,DY,F_ICE_PHY,F_RAIN_PHY,F_RIMEF_PHY, &amp;<a name='56'>
                         allowed_to_read, moved,                 &amp;<a name='57'>
                         ids, ide, jds, jde, kds, kde,           &amp;<a name='58'>
                         ims, ime, jms, jme, kms, kme,           &amp;<a name='59'>
                         its, ite, jts, jte, kts, kte           )<a name='60'>
<a name='61'>
<font color=#447700>!-----------------------------------------------------------------<a name='62'></font>
   USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_37"><a name='63'>
   IMPLICIT NONE<a name='64'>
<font color=#447700>!-----------------------------------------------------------------<a name='65'></font>
   TYPE (domain), INTENT(INOUT)             :: grid<a name='66'>
   TYPE (grid_config_rec_type)              :: config_flags<a name='67'>
<a name='68'>
   INTEGER , INTENT(IN)        :: id<a name='69'>
   LOGICAL , INTENT(OUT)       :: warm_rain<a name='70'>
<font color=#447700>!   LOGICAL , INTENT (IN)       :: FNDSOILW, FNDSNOWH<a name='71'></font>
   LOGICAL, PARAMETER          :: FNDSOILW=.true., FNDSNOWH=.true.<a name='72'>
   INTEGER , INTENT(IN)        :: ids, ide, jds, jde, kds, kde,  &amp;<a name='73'>
                                  ims, ime, jms, jme, kms, kme,  &amp;<a name='74'>
                                  its, ite, jts, jte, kts, kte<a name='75'>
<a name='76'>
   INTEGER , INTENT(IN)        :: num_soil_layers<a name='77'>
<a name='78'>
   REAL,     INTENT(IN)        :: DT, p_top, DX, DY<a name='79'>
   REAL,     INTENT(IN)        :: RADT,BLDT,CUDT,MPDT<a name='80'>
<a name='81'>
   REAL,     DIMENSION( kms:kme ) , INTENT(IN) :: zfull, zhalf<a name='82'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(IN) :: TSK, XLAT, XLONG<a name='83'>
<a name='84'>
   REAL,     DIMENSION( ims:ime , 1:num_soil_layers , jms:jme ),&amp;<a name='85'>
                 INTENT(INOUT) :: SMOIS, SH2O,TSLB<a name='86'>
   REAL,     DIMENSION( ims:ime , 1:num_soil_layers , jms:jme ), INTENT(OUT) :: SMFR3D<a name='87'>
<a name='88'>
   REAL,    DIMENSION( ims:ime, jms:jme )                     , &amp;<a name='89'>
            INTENT(INOUT)    ::                           SNOW, &amp;<a name='90'>
                                                         SNOWC, &amp;<a name='91'>
                                                         SNOWH, &amp;<a name='92'>
                                                        CANWAT, &amp;<a name='93'>
                                                        SMSTAV, &amp;<a name='94'>
                                                        SMSTOT, &amp;<a name='95'>
                                                     SFCRUNOFF, &amp;<a name='96'>
                                                      UDRUNOFF, &amp;<a name='97'>
                                                        SFCEVP, &amp;<a name='98'>
                                                        GRDFLX, &amp;<a name='99'>
                                                        ACSNOW, &amp;<a name='100'>
                                                          XICE, &amp;<a name='101'>
                                                        VEGFRA, &amp;<a name='102'>
                                                        ACSNOM<a name='103'>
<a name='104'>
   INTEGER, DIMENSION( ims:ime, jms:jme )                     , &amp;<a name='105'>
            INTENT(INOUT)    ::                         IVGTYP, &amp;<a name='106'>
                                                        ISLTYP<a name='107'>
<a name='108'>
<font color=#447700>! rad<a name='109'></font>
<a name='110'>
   REAL,     DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) ::    &amp;<a name='111'>
             RTHRATEN, RTHRATENLW, RTHRATENSW, CLDFRA<a name='112'>
<a name='113'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(INOUT) ::         &amp;<a name='114'>
             GSW,ALBEDO,ALBBCK,GLW,EMISS<a name='115'>
<a name='116'>
   REAL,     INTENT(INOUT) :: GMT<a name='117'>
<a name='118'>
   INTEGER , INTENT(OUT) :: STEPRA, STEPBL, STEPCU<a name='119'>
   INTEGER , INTENT(INOUT) :: JULYR, JULDAY<a name='120'>
<a name='121'>
<font color=#447700>! cps<a name='122'></font>
<a name='123'>
   REAL,     DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) ::    &amp;<a name='124'>
             RTHCUTEN, RQVCUTEN, RQRCUTEN, RQCCUTEN, RQSCUTEN,   &amp;<a name='125'>
             RQICUTEN<a name='126'>
<a name='127'>
   REAL,     DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) :: W0AVG<a name='128'>
<a name='129'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(OUT) :: MASS_FLUX,   &amp;<a name='130'>
                      APR_GR,APR_W,APR_MC,APR_ST,APR_AS,          &amp;<a name='131'>
                      APR_CAPMA,APR_CAPME,APR_CAPMI<a name='132'>
<a name='133'>
   REAL,     DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) ::    &amp;<a name='134'>
             RTHFTEN, RQVFTEN<a name='135'>
<a name='136'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(OUT) ::           &amp;<a name='137'>
             RAINNC, RAINC, RAINCV, RAINNCV<a name='138'>
<a name='139'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(OUT) :: CLDEFI, NCA<a name='140'>
<a name='141'>
   INTEGER,  DIMENSION( ims:ime , jms:jme ) , INTENT(OUT) :: LOWLYR<a name='142'>
<a name='143'>
<font color=#447700>!pbl<a name='144'></font>
<a name='145'>
   <font color=#447700>! soil layer<a name='146'></font>
<a name='147'>
<a name='148'>
   REAL,     DIMENSION(1:num_soil_layers),      INTENT(INOUT) :: ZS,DZS<a name='149'>
<a name='150'>
   REAL,     DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) ::    &amp;<a name='151'>
             RUBLTEN,RVBLTEN,RTHBLTEN,RQVBLTEN,RQCBLTEN,RQIBLTEN,EXCH_H,TKE_MYJ<a name='152'>
<a name='153'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(INOUT) ::         &amp;<a name='154'>
             XLAND,ZNT,Z0,UST,MOL,LU_INDEX,                         &amp;<a name='155'>
             PBLH,THC,MAVAIL,HFX,QFX,RAINBL<a name='156'>
<a name='157'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(INOUT) :: TMN<a name='158'>
<a name='159'>
<font color=#447700>!mp<a name='160'></font>
   REAL,     DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) ::   &amp;<a name='161'>
             F_ICE_PHY,F_RAIN_PHY,F_RIMEF_PHY<a name='162'>
   LOGICAL,  INTENT(IN)  :: allowed_to_read, moved<a name='163'>
<a name='164'>
<font color=#447700>! Local data<a name='165'></font>
<a name='166'>
   REAL    :: ALBLND,ZZLND,ZZWTR,THINLD,XMAVA,CEN_LAT,pptop <a name='167'>
   REAL,     DIMENSION( kms:kme )  :: sfull, shalf<a name='168'>
   <a name='169'>
   CHARACTER*4 :: MMINLU_loc<a name='170'>
   CHARACTER*80 :: message<a name='171'>
   INTEGER :: ISWATER<a name='172'>
<a name='173'>
   INTEGER :: i, j, itf, jtf<a name='174'>
   LOGICAL :: restart<a name='175'>
   INTEGER :: hr, min, sec, ms, rc<a name='176'>
integer myproc<a name='177'>
<a name='178'>
<font color=#447700>!-----------------------------------------------------------------<a name='179'></font>
<a name='180'>
<font color=#447700>!-- should be from the namelist<a name='181'></font>
<a name='182'>
   sfull = 0.<a name='183'>
   shalf = 0.<a name='184'>
<a name='185'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_160">(100,'top of phy_init')<a name='186'>
<a name='187'>
   itf=min0(ite,ide-1)<a name='188'>
   jtf=min0(jte,jde-1)<a name='189'>
<a name='190'>
   IF ( .NOT. grid%restart ) THEN<a name='191'>
     restart = .false.<a name='192'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_29">(150, grid%domain_clock, &amp;<a name='193'>
                         'DEBUG phy_init():  get currTime from grid%domain_clock,')<a name='194'>
     CALL ESMF_ClockGet( grid%domain_clock, currTime=grid%current_time, rc=rc )<a name='195'>
     CALL ESMF_TimeGet( grid%current_time, YY=julyr, dayOfYear=julday, H=hr, M=min, S=sec, MS=ms, rc=rc)<a name='196'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_12"> ( grid%current_time, message )<a name='197'>
     WRITE( wrf_err_message , * ) 'DEBUG phy_init():  currTime = [',TRIM( message ),']'<a name='198'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_161">( 150, TRIM(wrf_err_message) )<a name='199'>
     gmt=hr+real(min)/60.+real(sec)/3600.+real(ms)/(1000*3600)<a name='200'>
     WRITE( wrf_err_message , * ) 'DEBUG phy_init():  julyr,hr,min,sec,ms,julday = ', &amp;<a name='201'>
                                  julyr,hr,min,sec,ms,julday<a name='202'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_162">( 150, TRIM(wrf_err_message) )<a name='203'>
     WRITE( wrf_err_message , * ) 'DEBUG phy_init():  gmt = ',gmt<a name='204'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_163">( 150, TRIM(wrf_err_message) )<a name='205'>
   ELSE<a name='206'>
     restart = .true.<a name='207'>
     CALL nl_get_julyr (id, julyr)<a name='208'>
     CALL nl_get_julday (id, julday)<a name='209'>
     CALL nl_get_gmt (id, gmt)<a name='210'>
   END IF<a name='211'>
<a name='212'>
   ZZLND=0.1<a name='213'>
   ZZWTR=0.0001<a name='214'>
   THINLD=0.04<a name='215'>
   ALBLND=0.2<a name='216'>
   XMAVA=0.3<a name='217'>
   CALL nl_get_cen_lat(id,cen_lat)<a name='218'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_164">(100,'calling nl_get_iswater, nl_get_mminlu_loc')<a name='219'>
   CALL nl_get_iswater(id,iswater)<a name='220'>
   CALL <A href='../../html_code/frame/module_configure.F.html#NL_GET_MMINLU'>nl_get_mminlu</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NL_GET_MMINLU_2">( 1, mminlu_loc )<a name='221'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_165">(100,'after nl_get_iswater, nl_get_mminlu_loc')<a name='222'>
<a name='223'>
  IF(.not.restart)THEN<a name='224'>
<font color=#447700>!-- initialize common variables<a name='225'></font>
<a name='226'>
   IF ( .NOT. moved ) THEN<a name='227'>
   DO j=jts,jtf<a name='228'>
   DO i=its,itf<a name='229'>
      XLAND(i,j)=1.<a name='230'>
      GSW(i,j)=0.<a name='231'>
      GLW(i,j)=0.<a name='232'>
      UST(i,j)=0.<a name='233'>
      MOL(i,j)=0.0<a name='234'>
      PBLH(i,j)=0.0<a name='235'>
      HFX(i,j)=0.<a name='236'>
      QFX(i,j)=0.<a name='237'>
      RAINBL(i,j)=0.<a name='238'>
      RAINNCV(i,j)=0.<a name='239'>
   ENDDO<a name='240'>
   ENDDO<a name='241'>
   ENDIF<a name='242'>
<a name='243'>
<font color=#447700>!<a name='244'></font>
   DO j=jts,jtf<a name='245'>
   DO i=its,itf<a name='246'>
     IF(XLAND(i,j) .LT. 1.5)THEN<a name='247'>
       ALBBCK(i,j)=ALBLND<a name='248'>
       ALBEDO(i,j)=ALBLND<a name='249'>
       EMISS(i,j)=0.85<a name='250'>
       THC(i,j)=THINLD<a name='251'>
       ZNT(i,j)=ZZLND<a name='252'>
#if  <font color=#447700>! ( NMM_CORE == 1 ) <a name='253'></font>
       Z0(i,j)=ZZLND<a name='254'>
#endif<a name='255'>
       MAVAIL(i,j)=XMAVA<a name='256'>
     ELSE<a name='257'>
       ALBBCK(i,j)=0.08<a name='258'>
       ALBEDO(i,j)=0.08<a name='259'>
       EMISS(i,j)=0.98<a name='260'>
       THC(i,j)=THINLD<a name='261'>
       ZNT(i,j)=ZZWTR<a name='262'>
#if  <font color=#447700>! ( NMM_CORE == 1 ) <a name='263'></font>
       Z0(i,j)=ZZWTR<a name='264'>
#endif<a name='265'>
       MAVAIL(i,j)=1.0 <a name='266'>
     ENDIF<a name='267'>
   ENDDO<a name='268'>
   ENDDO<a name='269'>
<a name='270'>
   CALL wrf_debug ( 200 , 'module_start: phy_init: Before call to landuse_init' )<a name='271'>
<a name='272'>
   IF(mminlu_loc .ne. '    ')THEN<a name='273'>
<font color=#447700>!-- initialize surface properties<a name='274'></font>
<a name='275'>
     CALL <A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT'>landuse_init</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LANDUSE_INIT_1">(lu_index, snowc, albedo, albbck, mavail, emiss,      &amp;<a name='276'>
                znt, Z0, thc, xland, xice, julday, cen_lat, iswater, mminlu_loc,  &amp;<a name='277'>
                allowed_to_read ,                                   &amp;<a name='278'>
                ids, ide, jds, jde, kds, kde,                       &amp;<a name='279'>
                ims, ime, jms, jme, kms, kme,                       &amp;<a name='280'>
                its, ite, jts, jte, kts, kte                       ) <a name='281'>
   ENDIF<a name='282'>
  ENDIF<a name='283'>
<a name='284'>
<font color=#447700>!-- convert zfull and zhalf to sigma values for ra_init (Eta CO2 needs these)<a name='285'></font>
<font color=#447700>!-- zfull/zhalf may be either zeta or eta<a name='286'></font>
<font color=#447700>!-- what is done here depends on coordinate (check this code if adding new coordinates)<a name='287'></font>
   CALL <A href='../../html_code/phys/module_physics_init.F.html#Z2SIGMA'>z2sigma</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="Z2SIGMA_1">(zfull,zhalf,sfull,shalf,p_top,pptop,config_flags, &amp;<a name='288'>
                allowed_to_read,                                  &amp;<a name='289'>
                kds,kde,kms,kme,kts,kte)<a name='290'>
<a name='291'>
<font color=#447700>!-- initialize physics<a name='292'></font>
<font color=#447700>!-- ra: radiation<a name='293'></font>
<font color=#447700>!-- bl: pbl<a name='294'></font>
<font color=#447700>!-- cu: cumulus<a name='295'></font>
<font color=#447700>!-- mp: microphysics<a name='296'></font>
<a name='297'>
   CALL wrf_debug ( 200 , 'module_start: phy_init: Before call to ra_init' )<a name='298'>
<a name='299'>
   CALL <A href='../../html_code/phys/module_physics_init.F.html#RA_INIT'>ra_init</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RA_INIT_1">(grid,STEPRA,RADT,DT,RTHRATEN,RTHRATENLW,             &amp;<a name='300'>
                RTHRATENSW,CLDFRA,cen_lat,JULYR,JULDAY,GMT,     &amp;<a name='301'>
                sfull,shalf,pptop,                              &amp;<a name='302'>
                config_flags,restart,                           &amp; <a name='303'>
                allowed_to_read ,                                   &amp;<a name='304'>
                ids, ide, jds, jde, kds, kde,                   &amp;<a name='305'>
                ims, ime, jms, jme, kms, kme,                   &amp;<a name='306'>
                its, ite, jts, jte, kts, kte                    )<a name='307'>
<a name='308'>
   CALL wrf_debug ( 200 , 'module_start: phy_init: Before call to bl_init' )<a name='309'>
<a name='310'>
   CALL <A href='../../html_code/phys/module_physics_init.F.html#BL_INIT'>bl_init</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BL_INIT_1">(STEPBL,BLDT,DT,RUBLTEN,RVBLTEN,RTHBLTEN,        &amp;<a name='311'>
                RQVBLTEN,RQCBLTEN,RQIBLTEN,TSK,TMN,             &amp;<a name='312'>
                config_flags,restart,UST,LOWLYR,TSLB,ZS,DZS,    &amp;<a name='313'>
                num_soil_layers,TKE_MYJ,EXCH_H,VEGFRA,          &amp;<a name='314'>
                SNOW,SNOWC, CANWAT,SMSTAV,                      &amp;<a name='315'>
                SMSTOT, SFCRUNOFF,UDRUNOFF,ACSNOW,ACSNOM,       &amp;<a name='316'>
                IVGTYP,ISLTYP,SMOIS,SMFR3D,                     &amp;<a name='317'>
                SNOWH,SH2O,FNDSOILW, FNDSNOWH,                  &amp;<a name='318'>
#if (NMM_CORE == 1)<a name='319'>
                Z0,XLAND,XICE,                                  &amp;<a name='320'>
#else<a name='321'>
                ZNT,XLAND,XICE,                                 &amp;<a name='322'>
#endif<a name='323'>
                SFCEVP,GRDFLX,                                  &amp;<a name='324'>
                allowed_to_read ,                                   &amp;<a name='325'>
                ids, ide, jds, jde, kds, kde,                   &amp;<a name='326'>
                ims, ime, jms, jme, kms, kme,                   &amp;<a name='327'>
                its, ite, jts, jte, kts, kte                    )<a name='328'>
<a name='329'>
   CALL wrf_debug ( 200 , 'module_start: phy_init: Before call to cu_init' )<a name='330'>
<a name='331'>
   CALL <A href='../../html_code/phys/module_physics_init.F.html#CU_INIT'>cu_init</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CU_INIT_1">(STEPCU,CUDT,DT,RTHCUTEN,RQVCUTEN,RQRCUTEN,      &amp;<a name='332'>
                RQCCUTEN,RQSCUTEN,RQICUTEN,NCA,RAINC,           &amp;<a name='333'>
                RAINCV,W0AVG,config_flags,restart,              &amp;<a name='334'>
                CLDEFI,LOWLYR,MASS_FLUX,                        &amp;<a name='335'>
                RTHFTEN, RQVFTEN,                               &amp;<a name='336'>
                APR_GR,APR_W,APR_MC,APR_ST,APR_AS,              &amp;<a name='337'>
                APR_CAPMA,APR_CAPME,APR_CAPMI,                  &amp;<a name='338'>
                allowed_to_read ,                                   &amp;<a name='339'>
                ids, ide, jds, jde, kds, kde,                   &amp;<a name='340'>
                ims, ime, jms, jme, kms, kme,                   &amp;<a name='341'>
                its, ite, jts, jte, kts, kte                    )<a name='342'>
<a name='343'>
   CALL wrf_debug ( 200 , 'module_start: phy_init: Before call to mp_init' )<a name='344'>
<a name='345'>
   CALL <A href='../../html_code/phys/module_physics_init.F.html#MP_INIT'>mp_init</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MP_INIT_1">(RAINNC,config_flags,restart,warm_rain,          &amp;<a name='346'>
                MPDT, DT, DX, DY, LOWLYR,                       &amp; <a name='347'>
                F_ICE_PHY,F_RAIN_PHY,F_RIMEF_PHY,               &amp;<a name='348'>
                allowed_to_read ,                                   &amp;<a name='349'>
                ids, ide, jds, jde, kds, kde,                   &amp;<a name='350'>
                ims, ime, jms, jme, kms, kme,                   &amp;<a name='351'>
                its, ite, jts, jte, kts, kte                    )<a name='352'>
<a name='353'>
   write(message,*)'STEPRA,STEPCU,STEPBL',STEPRA,STEPCU,STEPBL<a name='354'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_50">( message )<a name='355'>
<a name='356'>
   END SUBROUTINE phy_init<a name='357'>
<a name='358'>
<font color=#447700>!=====================================================================<a name='359'></font>
<A NAME='LANDUSE_INIT'><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='360'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>landuse_init</font>(lu_index, snowc, albedo, albbck, mavail, emiss,  &amp; <A href='../../call_to/LANDUSE_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/LANDUSE_INIT.html' TARGET='index'>19</A><a name='361'>
                znt,Z0,thc,xland, xice, julday, cen_lat, iswater, mminlu, &amp;<a name='362'>
                allowed_to_read ,                                   &amp;<a name='363'>
                ids, ide, jds, jde, kds, kde,                       &amp;<a name='364'>
                ims, ime, jms, jme, kms, kme,                       &amp;<a name='365'>
                its, ite, jts, jte, kts, kte                       )<a name='366'>
<a name='367'>
   USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_38"><a name='368'>
   IMPLICIT NONE<a name='369'>
<a name='370'>
<font color=#447700>!---------------------------------------------------------------------<a name='371'></font>
   INTEGER , INTENT(IN)           :: ids, ide, jds, jde, kds, kde,   &amp;<a name='372'>
                                     ims, ime, jms, jme, kms, kme,   &amp;<a name='373'>
                                     its, ite, jts, jte, kts, kte<a name='374'>
<a name='375'>
   INTEGER , INTENT(IN)           :: iswater, julday<a name='376'>
   REAL    , INTENT(IN)           :: cen_lat<a name='377'>
   CHARACTER*4, INTENT(IN)        :: mminlu<a name='378'>
   LOGICAL,  INTENT(IN)           :: allowed_to_read<a name='379'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(IN   ) :: lu_index, snowc, xice<a name='380'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(OUT  ) :: albedo, albbck, mavail, emiss, &amp;<a name='381'>
                                                         znt, Z0, thc, xland<a name='382'>
<a name='383'>
<font color=#447700>!---------------------------------------------------------------------<a name='384'></font>
<font color=#447700>! Local<a name='385'></font>
   CHARACTER*4 LUTYPE<a name='386'>
   CHARACTER*80 :: message<a name='387'>
   INTEGER  :: landuse_unit, LS, LC, LI, LUN, NSN<a name='388'>
   INTEGER  :: i, j, itf, jtf, is<a name='389'>
   INTEGER , PARAMETER :: max_cats = 100 , max_seas = 12 <a name='390'>
   INTEGER , PARAMETER :: OPEN_OK = 0<a name='391'>
   INTEGER :: ierr<a name='392'>
<font color=#447700>! save these fields in case nest moves or has to be reinitialized<a name='393'></font>
<font color=#447700>! and this routine is called with allowed_to_read set to false<a name='394'></font>
<font color=#447700>! note that by saving these, we're locking in the same landuse for<a name='395'></font>
<font color=#447700>! the duration of a run; possible implications for long climate runs<a name='396'></font>
   INTEGER , SAVE :: ISICE, LUCATS, LUSEAS, ISN<a name='397'>
   REAL    , SAVE , DIMENSION( max_cats, max_seas ) :: ALBD, SLMO, SFEM, SFZ0, THERIN, SFHC<a name='398'>
   REAL    , SAVE , DIMENSION( max_cats )     :: SCFX<a name='399'>
   LOGICAL :: FOUND_LU<a name='400'>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='401'>
<a name='402'>
<font color=#447700>!---------------------------------------------------------------------<a name='403'></font>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_166">( 100 , 'top of landuse_init' )<a name='404'>
<a name='405'>
   FOUND_LU = .TRUE.<a name='406'>
   IF ( allowed_to_read ) THEN<a name='407'>
      landuse_unit = 29<a name='408'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='409'>
        OPEN(landuse_unit, FILE='LANDUSE.TBL',FORM='FORMATTED',STATUS='OLD',IOSTAT=ierr)<a name='410'>
        IF ( ierr .NE. OPEN_OK ) THEN<a name='411'>
          WRITE(message,FMT='(A)') &amp;<a name='412'>
          'module_physics_init.F: LANDUSE_INIT: open failure for LANDUSE.TBL'<a name='413'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_154"> ( message ) <a name='414'>
        END IF<a name='415'>
      ENDIF<a name='416'>
<font color=#447700>! Determine season (summer=1, winter=2)<a name='417'></font>
      ISN=1                                                            <a name='418'>
      IF(JULDAY.LT.105.OR.JULDAY.GT.288)ISN=2                         <a name='419'>
      IF(CEN_LAT.LT.0.0)ISN=3-ISN                                   <a name='420'>
<a name='421'>
<font color=#447700>! Read info from file LANDUSE.TBL<a name='422'></font>
      IF(MMINLU.EQ.'OLD ')THEN<a name='423'>
<font color=#447700>!       ISWATER=7<a name='424'></font>
        ISICE=11 <a name='425'>
      ELSE IF(MMINLU.EQ.'USGS')THEN<a name='426'>
<font color=#447700>!       ISWATER=16<a name='427'></font>
        ISICE=24<a name='428'>
      ELSE IF(MMINLU.EQ.'SiB ')THEN<a name='429'>
<font color=#447700>!       ISWATER=15<a name='430'></font>
        ISICE=16<a name='431'>
      ELSE IF(MMINLU.EQ.'LW12')THEN<a name='432'>
<font color=#447700>!       ISWATER=15<a name='433'></font>
        ISICE=3<a name='434'>
      ENDIF<a name='435'>
      PRINT *, 'INPUT LANDUSE = ',MMINLU<a name='436'>
      FOUND_LU = .FALSE.<a name='437'>
 1999   CONTINUE                                                      <a name='438'>
      if ( wrf_dm_on_monitor() ) then<a name='439'>
        READ (landuse_unit,2000,END=2001)LUTYPE                                <a name='440'>
        READ (landuse_unit,*)LUCATS,LUSEAS                                    <a name='441'>
        FOUND_LU = LUTYPE.EQ.MMINLU<a name='442'>
      endif<a name='443'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_6">(lutype, 4)<a name='444'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_97"> (lucats,  IWORDSIZE )<a name='445'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_98"> (luseas,  IWORDSIZE )<a name='446'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_99"> (found_lu,  LWORDSIZE )<a name='447'>
 2000   FORMAT (A4)                                                <a name='448'>
        IF(FOUND_LU)THEN                                  <a name='449'>
          LUN=LUCATS                                             <a name='450'>
          NSN=LUSEAS                                            <a name='451'>
            PRINT *, 'LANDUSE TYPE = ',LUTYPE,' FOUND',        &amp;<a name='452'>
                   LUCATS,' CATEGORIES',LUSEAS,' SEASONS',     &amp;<a name='453'>
                   ' WATER CATEGORY = ',ISWATER,               &amp;<a name='454'>
                   ' SNOW CATEGORY = ',ISICE                <a name='455'>
        ENDIF                                             <a name='456'>
        DO LS=1,LUSEAS                                   <a name='457'>
          if ( wrf_dm_on_monitor() ) then<a name='458'>
            READ (landuse_unit,*)                                   <a name='459'>
          endif<a name='460'>
          DO LC=1,LUCATS                               <a name='461'>
            IF(FOUND_LU)THEN                  <a name='462'>
              IF ( wrf_dm_on_monitor() ) THEN<a name='463'>
                READ (landuse_unit,*)LI,ALBD(LC,LS),SLMO(LC,LS),SFEM(LC,LS),        &amp;       <a name='464'>
                           SFZ0(LC,LS),THERIN(LC,LS),SCFX(LC),SFHC(LC,LS)       <a name='465'>
              ENDIF<a name='466'>
              CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_100"> (LI,  IWORDSIZE )<a name='467'>
              IF(LC.NE.LI)CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_155"> ( 'module_start: MISSING LANDUSE UNIT ' )<a name='468'>
            ELSE                                                            <a name='469'>
              IF ( wrf_dm_on_monitor() ) THEN<a name='470'>
                READ (landuse_unit,*)                                                  <a name='471'>
              ENDIF<a name='472'>
            ENDIF                                                         <a name='473'>
          ENDDO                                                          <a name='474'>
        ENDDO                                                           <a name='475'>
        IF(NSN.EQ.1) THEN<a name='476'>
           ISN = 1<a name='477'>
        END IF<a name='478'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_101"> (albd,   max_cats * max_seas * RWORDSIZE )<a name='479'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_102"> (slmo,   max_cats * max_seas * RWORDSIZE )<a name='480'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_103"> (sfem,   max_cats * max_seas * RWORDSIZE )<a name='481'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_104"> (sfz0,   max_cats * max_seas * RWORDSIZE )<a name='482'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_105"> (therin, max_cats * max_seas * RWORDSIZE )<a name='483'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_106"> (sfhc,   max_cats * max_seas * RWORDSIZE )<a name='484'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_107"> (scfx,   max_cats *            RWORDSIZE )<a name='485'>
<a name='486'>
        IF(.NOT. FOUND_LU) GOTO 1999<a name='487'>
 2001   CONTINUE                                                      <a name='488'>
        IF(.NOT. FOUND_LU)THEN                                         <a name='489'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_51"> ( 'LANDUSE IN INPUT FILE DOES NOT MATCH LUTABLE: TABLE NOT USED' )<a name='490'>
        ENDIF                                                     <a name='491'>
     ENDIF  <font color=#447700>! allowed_to_read<a name='492'></font>
<a name='493'>
    IF(FOUND_LU)THEN<a name='494'>
<font color=#447700>! Set arrays according to lu_index<a name='495'></font>
      itf = min0(ite, ide-1)<a name='496'>
      jtf = min0(jte, jde-1)<a name='497'>
      DO j = jts, jtf<a name='498'>
        DO i = its, itf<a name='499'>
          IS=nint(lu_index(i,j))<a name='500'>
          <font color=#447700>! only do this check on read-in data<a name='501'></font>
          IF(IS.LT.0.OR.IS.GT.LUN.AND.allowed_to_read)THEN                                        <a name='502'>
            WRITE ( wrf_err_message , * ) 'ERROR: LANDUSE OUTSIDE RANGE =',IS,' AT ',I,J,' LUN= ',LUN<a name='503'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_156"> ( TRIM ( wrf_err_message ) )<a name='504'>
          ENDIF                                                            <a name='505'>
<font color=#447700>!   SET NO-DATA POINTS (IS=0) TO WATER                                    <a name='506'></font>
          IF(IS.EQ.0)THEN                                                <a name='507'>
            IS=ISWATER                                                  <a name='508'>
          ENDIF                                                        <a name='509'>
          ALBBCK(I,J)=ALBD(IS,ISN)/100.                                  <a name='510'>
          ALBEDO(I,J)=ALBBCK(I,J)<a name='511'>
          THC(I,J)=THERIN(IS,ISN)/100.                               <a name='512'>
          Z0(I,J)=SFZ0(IS,ISN)/100.                                <a name='513'>
          ZNT(I,J)=Z0(I,J)<a name='514'>
          EMISS(I,J)=SFEM(IS,ISN)                                  <a name='515'>
          MAVAIL(I,J)=SLMO(IS,ISN)                                <a name='516'>
          IF(IS.NE.ISWATER)THEN                                  <a name='517'>
            XLAND(I,J)=1.0                                      <a name='518'>
          ELSE                                                 <a name='519'>
            XLAND(I,J)=2.0                                    <a name='520'>
          ENDIF                                              <a name='521'>
<font color=#447700>!    SET SEA-ICE POINTS TO LAND WITH ICE/SNOW SURFACE PROPERTIES<a name='522'></font>
          IF(XICE(I,J).GT.0.5)THEN<a name='523'>
            XLAND(I,J)=1.0<a name='524'>
            ALBBCK(I,J)=ALBD(ISICE,ISN)/100.<a name='525'>
            ALBEDO(I,J)=ALBBCK(I,J)<a name='526'>
            THC(I,J)=THERIN(ISICE,ISN)/100.                              <a name='527'>
            Z0(I,J)=SFZ0(ISICE,ISN)/100.                               <a name='528'>
            ZNT(I,J)=Z0(I,J)<a name='529'>
            EMISS(I,J)=SFEM(ISICE,ISN)                                 <a name='530'>
            MAVAIL(I,J)=SLMO(ISICE,ISN)                               <a name='531'>
          ENDIF<a name='532'>
        ENDDO<a name='533'>
      ENDDO<a name='534'>
    ENDIF<a name='535'>
    if ( wrf_dm_on_monitor() .and. allowed_to_read ) then<a name='536'>
      CLOSE (landuse_unit)<a name='537'>
    endif<a name='538'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_physics_init.F.html#LANDUSE_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_167">( 100 , 'returning from of landuse_init' )<a name='539'>
<a name='540'>
    RETURN<a name='541'>
        <a name='542'>
   END SUBROUTINE landuse_init <a name='543'>
<font color=#447700>!===================================================================== <a name='544'></font>
<A NAME='RA_INIT'><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='545'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>ra_init</font>(grid,STEPRA,RADT,DT,RTHRATEN,RTHRATENLW,       &amp;  <A href='../../call_to/RA_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/RA_INIT.html' TARGET='index'>10</A><a name='546'>
                      RTHRATENSW,CLDFRA,cen_lat,JULYR,JULDAY,GMT,    &amp;<a name='547'>
                      sfull,shalf,pptop,                             &amp;<a name='548'>
                      config_flags,restart,                          &amp; <a name='549'>
                      allowed_to_read ,                              &amp;<a name='550'>
                      ids, ide, jds, jde, kds, kde,                  &amp;<a name='551'>
                      ims, ime, jms, jme, kms, kme,                  &amp;<a name='552'>
                      its, ite, jts, jte, kts, kte                   )<a name='553'>
<font color=#447700>!---------------------------------------------------------------------<a name='554'></font>
   USE <A href='../../html_code/phys/module_ra_rrtm.F.html#MODULE_RA_RRTM'>module_ra_rrtm</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_RRTM_1"><a name='555'>
   USE <A href='../../html_code/phys/module_ra_sw.F.html#MODULE_RA_SW'>module_ra_sw</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_SW_1"><a name='556'>
   USE <A href='../../html_code/phys/module_ra_gsfcsw.F.html#MODULE_RA_GSFCSW'>module_ra_gsfcsw</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_GSFCSW_1"><a name='557'>
   USE <A href='../../html_code/phys/module_ra_gfdleta.F.html#MODULE_RA_GFDLETA'>module_ra_gfdleta</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_GFDLETA_1"><a name='558'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_99"><a name='559'>
<font color=#447700>!---------------------------------------------------------------------<a name='560'></font>
   IMPLICIT NONE<a name='561'>
<font color=#447700>!---------------------------------------------------------------------<a name='562'></font>
   TYPE (domain)                  :: grid<a name='563'>
   TYPE (grid_config_rec_type)    :: config_flags<a name='564'>
   LOGICAL , INTENT(IN)           :: restart<a name='565'>
   LOGICAL,  INTENT(IN)           :: allowed_to_read<a name='566'>
<a name='567'>
   INTEGER , INTENT(IN)           :: ids, ide, jds, jde, kds, kde,   &amp;<a name='568'>
                                     ims, ime, jms, jme, kms, kme,   &amp;<a name='569'>
                                     its, ite, jts, jte, kts, kte<a name='570'>
<a name='571'>
   INTEGER , INTENT(IN)           :: JULDAY,JULYR<a name='572'>
   REAL ,    INTENT(IN)           :: DT, RADT, cen_lat, GMT, pptop<a name='573'>
<a name='574'>
   INTEGER , INTENT(INOUT)        :: STEPRA<a name='575'>
   INTEGER :: isn<a name='576'>
<a name='577'>
   REAL , DIMENSION( kms:kme ) , INTENT(IN) :: sfull, shalf<a name='578'>
   REAL , DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) ::           &amp;<a name='579'>
                                                           RTHRATEN, &amp;<a name='580'>
                                                         RTHRATENLW, &amp;<a name='581'>
                                                         RTHRATENSW, &amp;<a name='582'>
                                                             CLDFRA<a name='583'>
   LOGICAL :: etalw = .false.<a name='584'>
   integer :: month,iday<a name='585'>
<font color=#447700>!---------------------------------------------------------------------<a name='586'></font>
<a name='587'>
<font color=#447700>!-- calculate radiation time step<a name='588'></font>
<a name='589'>
    STEPRA = nint(RADT*60./DT)<a name='590'>
    STEPRA = max(STEPRA,1)<a name='591'>
<a name='592'>
<a name='593'>
<font color=#447700>!-- chose long wave radiation scheme<a name='594'></font>
 <a name='595'>
   lwrad_select: SELECT CASE(config_flags%ra_lw_physics)<a name='596'>
<a name='597'>
        CASE (RRTMSCHEME)<a name='598'>
             CALL <A href='../../html_code/phys/module_ra_rrtm.F.html#RRTMINIT'>rrtminit</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMINIT_1">(RTHRATEN,RTHRATENLW,CLDFRA,      &amp;<a name='599'>
                           restart,                         &amp;<a name='600'>
                           allowed_to_read ,                &amp;<a name='601'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='602'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='603'>
                           its, ite, jts, jte, kts, kte     )<a name='604'>
        CASE (GFDLLWSCHEME)<a name='605'>
             CALL nl_get_start_month(grid%id,month)<a name='606'>
             CALL nl_get_start_day(grid%id,iday)<a name='607'>
             CALL <A href='../../html_code/phys/module_ra_gfdleta.F.html#GFDLETAINIT'>gfdletainit</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GFDLETAINIT_1">(sfull,shalf,pptop,JULYR,MONTH,IDAY,GMT,&amp;<a name='608'>
                           allowed_to_read ,                         &amp;<a name='609'>
                           kds, kde, kms, kme, kts, kte     )<a name='610'>
             etalw = .true.<a name='611'>
        CASE DEFAULT<a name='612'>
<a name='613'>
   END SELECT lwrad_select<a name='614'>
<font color=#447700>!-- initialize short wave radiation scheme<a name='615'></font>
 <a name='616'>
   swrad_select: SELECT CASE(config_flags%ra_sw_physics)<a name='617'>
<a name='618'>
        CASE (SWRADSCHEME)<a name='619'>
             CALL <A href='../../html_code/phys/module_ra_sw.F.html#SWINIT'>swinit</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SWINIT_1">(RTHRATEN,RTHRATENSW,              &amp;<a name='620'>
                         restart,                          &amp;<a name='621'>
                         allowed_to_read ,                 &amp;<a name='622'>
                         ids, ide, jds, jde, kds, kde,     &amp;<a name='623'>
                         ims, ime, jms, jme, kms, kme,     &amp;<a name='624'>
                         its, ite, jts, jte, kts, kte      )<a name='625'>
<a name='626'>
        CASE (GSFCSWSCHEME)<a name='627'>
             CALL <A href='../../html_code/phys/module_ra_gsfcsw.F.html#GSFC_SWINIT'>gsfc_swinit</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GSFC_SWINIT_1">(cen_lat, allowed_to_read )<a name='628'>
<a name='629'>
        CASE (GFDLSWSCHEME)<a name='630'>
             IF(.not.etalw)THEN<a name='631'>
             CALL nl_get_start_month(grid%id,month)<a name='632'>
             CALL nl_get_start_day(grid%id,iday)<a name='633'>
             CALL <A href='../../html_code/phys/module_ra_gfdleta.F.html#GFDLETAINIT'>gfdletainit</A><A href='../../html_code/phys/module_physics_init.F.html#RA_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GFDLETAINIT_2">(sfull,shalf,pptop,JULYR,MONTH,IDAY,GMT,&amp;<a name='634'>
                           allowed_to_read,                          &amp;<a name='635'>
                           kds, kde, kms, kme, kts, kte     )<a name='636'>
             ENDIF<a name='637'>
<a name='638'>
        CASE DEFAULT<a name='639'>
<a name='640'>
   END SELECT swrad_select<a name='641'>
<a name='642'>
   END SUBROUTINE ra_init<a name='643'>
<a name='644'>
<A NAME='BL_INIT'><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='645'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>bl_init</font>(STEPBL,BLDT,DT,RUBLTEN,RVBLTEN,RTHBLTEN,  &amp; <A href='../../call_to/BL_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/BL_INIT.html' TARGET='index'>26</A><a name='646'>
                RQVBLTEN,RQCBLTEN,RQIBLTEN,TSK,TMN,             &amp;<a name='647'>
                config_flags,restart,UST,LOWLYR,TSLB,ZS,DZS,    &amp;<a name='648'>
                num_soil_layers,TKE_MYJ,EXCH_H,VEGFRA,          &amp;<a name='649'>
                SNOW,SNOWC, CANWAT,SMSTAV,                      &amp;<a name='650'>
                SMSTOT, SFCRUNOFF,UDRUNOFF,ACSNOW,ACSNOM,       &amp;<a name='651'>
                IVGTYP,ISLTYP,SMOIS,SMFR3D,                     &amp;<a name='652'>
                SNOWH,SH2O,FNDSOILW, FNDSNOWH,                  &amp;<a name='653'>
#if  ( NMM_CORE == 1 )<a name='654'>
                Z0,XLAND,XICE,                                  &amp;<a name='655'>
#else<a name='656'>
                ZNT,XLAND,XICE,                                 &amp;<a name='657'>
#endif<a name='658'>
                SFCEVP,GRDFLX,                                  &amp;<a name='659'>
                allowed_to_read,                                &amp;<a name='660'>
                ids, ide, jds, jde, kds, kde,                   &amp;<a name='661'>
                ims, ime, jms, jme, kms, kme,                   &amp;<a name='662'>
                its, ite, jts, jte, kts, kte                    )<a name='663'>
<font color=#447700>!--------------------------------------------------------------------<a name='664'></font>
   USE <A href='../../html_code/phys/module_sf_sfclay.F.html#MODULE_SF_SFCLAY'>module_sf_sfclay</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SF_SFCLAY_1"><a name='665'>
   USE <A href='../../html_code/phys/module_sf_slab.F.html#MODULE_SF_SLAB'>module_sf_slab</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SF_SLAB_1"><a name='666'>
   USE <A href='../../html_code/phys/module_bl_ysu.F.html#MODULE_BL_YSU'>module_bl_ysu</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BL_YSU_2"><a name='667'>
   USE <A href='../../html_code/phys/module_bl_mrf.F.html#MODULE_BL_MRF'>module_bl_mrf</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BL_MRF_2"><a name='668'>
   USE <A href='../../html_code/phys/module_bl_gfs.F.html#MODULE_BL_GFS'>module_bl_gfs</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BL_GFS_2"><a name='669'>
   USE <A href='../../html_code/phys/module_sf_myjsfc.F.html#MODULE_SF_MYJSFC'>module_sf_myjsfc</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SF_MYJSFC_1"><a name='670'>
   USE <A href='../../html_code/phys/module_sf_noahlsm.F.html#MODULE_SF_NOAHLSM'>module_sf_noahlsm</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SF_NOAHLSM_1"><a name='671'>
   USE <A href='../../html_code/phys/module_sf_ruclsm.F.html#MODULE_SF_RUCLSM'>module_sf_ruclsm</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SF_RUCLSM_1"><a name='672'>
   USE <A href='../../html_code/phys/module_bl_myjpbl.F.html#MODULE_BL_MYJPBL'>module_bl_myjpbl</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BL_MYJPBL_2"><a name='673'>
#if (NMM_CORE == 1)<a name='674'>
   USE <A href='../../html_code/phys/module_sf_lsm_nmm.F.html#MODULE_SF_LSM_NMM'>module_sf_lsm_nmm</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SF_LSM_NMM_1"><a name='675'>
#endif<a name='676'>
<font color=#447700>!--------------------------------------------------------------------<a name='677'></font>
   IMPLICIT NONE<a name='678'>
<font color=#447700>!--------------------------------------------------------------------<a name='679'></font>
   TYPE (grid_config_rec_type) ::     config_flags<a name='680'>
   LOGICAL , INTENT(IN)        :: restart<a name='681'>
   LOGICAL, INTENT(IN)         ::   FNDSOILW, FNDSNOWH<a name='682'>
<a name='683'>
   INTEGER , INTENT(IN)        ::     ids, ide, jds, jde, kds, kde, &amp;<a name='684'>
                                      ims, ime, jms, jme, kms, kme, &amp;<a name='685'>
                                      its, ite, jts, jte, kts, kte<a name='686'>
   INTEGER , INTENT(IN)        ::     num_soil_layers<a name='687'>
<a name='688'>
   REAL ,    INTENT(IN)        ::     DT, BLDT<a name='689'>
   INTEGER , INTENT(INOUT)     ::     STEPBL<a name='690'>
<a name='691'>
   REAL,     DIMENSION( ims:ime , 1:num_soil_layers , jms:jme ),    &amp;<a name='692'>
             INTENT(OUT) :: SMFR3D<a name='693'>
<a name='694'>
   REAL,     DIMENSION( ims:ime , 1:num_soil_layers , jms:jme ),&amp;<a name='695'>
                   INTENT(INOUT) :: SMOIS,SH2O,TSLB <a name='696'>
<a name='697'>
   REAL,    DIMENSION( ims:ime, jms:jme )                     , &amp;<a name='698'>
            INTENT(INOUT)    ::                           SNOW, &amp;<a name='699'>
                                                         SNOWH, &amp;<a name='700'>
                                                         SNOWC, &amp;<a name='701'>
                                                        CANWAT, &amp;<a name='702'>
                                                        SMSTAV, &amp;<a name='703'>
                                                        SMSTOT, &amp;<a name='704'>
                                                     SFCRUNOFF, &amp;<a name='705'>
                                                      UDRUNOFF, &amp;<a name='706'>
                                                        ACSNOW, &amp;<a name='707'>
                                                        VEGFRA, &amp;<a name='708'>
                                                        ACSNOM, &amp;<a name='709'>
                                                        SFCEVP, &amp;<a name='710'>
                                                        GRDFLX, &amp;<a name='711'>
                                                           UST, &amp;<a name='712'>
#if ( NMM_CORE == 1 )<a name='713'>
                                                            Z0, &amp;<a name='714'>
#else<a name='715'>
                                                           ZNT, &amp;<a name='716'>
#endif<a name='717'>
                                                         XLAND, &amp;<a name='718'>
                                                         XICE<a name='719'>
<a name='720'>
   INTEGER, DIMENSION( ims:ime, jms:jme )                     , &amp;<a name='721'>
            INTENT(INOUT)    ::                         IVGTYP, &amp;<a name='722'>
                                                        ISLTYP, &amp;<a name='723'>
                                                        LOWLYR<a name='724'>
<a name='725'>
<a name='726'>
   REAL,     DIMENSION(1:num_soil_layers), INTENT(INOUT)  ::  ZS,DZS<a name='727'>
<a name='728'>
   REAL,     DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) ::       &amp;<a name='729'>
                                                           RUBLTEN, &amp;<a name='730'>
                                                           RVBLTEN, &amp;<a name='731'>
 						          EXCH_H,   &amp;<a name='732'>
                                                          RTHBLTEN, &amp;<a name='733'>
                                                          RQVBLTEN, &amp;<a name='734'>
                                                          RQCBLTEN, &amp;<a name='735'>
                                                          RQIBLTEN, &amp;<a name='736'>
                                                          TKE_MYJ<a name='737'>
<a name='738'>
   REAL,  DIMENSION( ims:ime , jms:jme ) , INTENT(IN) ::     TSK<a name='739'>
   REAL,  DIMENSION( ims:ime , jms:jme ) , INTENT(INOUT) ::  TMN<a name='740'>
   LOGICAL,  INTENT(IN)           :: allowed_to_read<a name='741'>
   INTEGER :: isn, isfc<a name='742'>
<font color=#447700>!--------------------------------------------------------------------<a name='743'></font>
<a name='744'>
<font color=#447700>!-- calculate pbl time step<a name='745'></font>
<a name='746'>
   STEPBL = nint(BLDT*60./DT)<a name='747'>
   STEPBL = max(STEPBL,1)<a name='748'>
<a name='749'>
<a name='750'>
<font color=#447700>!-- initialize surface layer scheme<a name='751'></font>
<a name='752'>
   sfclay_select: SELECT CASE(config_flags%sf_sfclay_physics)<a name='753'>
<a name='754'>
      CASE (SFCLAYSCHEME)<a name='755'>
           CALL <A href='../../html_code/phys/module_sf_sfclay.F.html#SFCLAYINIT'>sfclayinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SFCLAYINIT_1">( allowed_to_read )<a name='756'>
           isfc = 1<a name='757'>
      CASE (MYJSFCSCHEME)<a name='758'>
#if ( NMM_CORE == 1 )<a name='759'>
           CALL <A href='../../html_code/phys/module_sf_myjsfc.F.html#MYJSFCINIT'>myjsfcinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MYJSFCINIT_1">(LOWLYR,UST,Z0,XLAND,XICE,           &amp;<a name='760'>
#else<a name='761'>
           CALL <A href='../../html_code/phys/module_sf_myjsfc.F.html#MYJSFCINIT'>myjsfcinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MYJSFCINIT_2">(LOWLYR,UST,ZNT,XLAND,XICE,           &amp;<a name='762'>
#endif<a name='763'>
                         IVGTYP,restart,                       &amp;<a name='764'>
                         allowed_to_read ,                     &amp;<a name='765'>
                         ids, ide, jds, jde, kds, kde,         &amp;<a name='766'>
                         ims, ime, jms, jme, kms, kme,         &amp;<a name='767'>
                         its, ite, jts, jte, kts, kte          )<a name='768'>
           isfc = 2<a name='769'>
      CASE DEFAULT<a name='770'>
<a name='771'>
   END SELECT sfclay_select<a name='772'>
<a name='773'>
<a name='774'>
<font color=#447700>!-- initialize surface scheme<a name='775'></font>
<a name='776'>
   sfc_select: SELECT CASE(config_flags%sf_surface_physics)<a name='777'>
<a name='778'>
      CASE (SLABSCHEME)<a name='779'>
           CALL <A href='../../html_code/phys/module_sf_slab.F.html#SLABINIT'>slabinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SLABINIT_1">(TSK,TMN,                              &amp;<a name='780'>
                         TSLB,ZS,DZS,num_soil_layers,          &amp; <a name='781'>
                         restart,                              &amp;<a name='782'>
                         allowed_to_read ,                     &amp;<a name='783'>
                         ids, ide, jds, jde, kds, kde,         &amp;<a name='784'>
                         ims, ime, jms, jme, kms, kme,         &amp;<a name='785'>
                         its, ite, jts, jte, kts, kte          )<a name='786'>
#if (NMM_CORE == 1)<a name='787'>
      CASE (NMMLSMSCHEME)<a name='788'>
           CALL <A href='../../html_code/phys/module_sf_lsm_nmm.F.html#NMMLSMINIT'>nmmlsminit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NMMLSMINIT_1">(isn,XICE,VEGFRA,SNOW,SNOWC, CANWAT,SMSTAV, &amp;<a name='789'>
                     SMSTOT, SFCRUNOFF,UDRUNOFF,GRDFLX,ACSNOW,     &amp;<a name='790'>
                     ACSNOM,IVGTYP,ISLTYP,TSLB,SMOIS,DZS,SFCEVP,   &amp;<a name='791'>
                     TMN,                                          &amp;<a name='792'>
                     num_soil_layers,                              &amp;<a name='793'>
                     allowed_to_read ,                             &amp;<a name='794'>
                     ids,ide, jds,jde, kds,kde,                    &amp;<a name='795'>
                     ims,ime, jms,jme, kms,kme,                    &amp;<a name='796'>
                     its,ite, jts,jte, kts,kte                     )<a name='797'>
#endif<a name='798'>
      CASE (LSMSCHEME)<a name='799'>
          CALL <A href='../../html_code/phys/module_sf_noahlsm.F.html#LSMINIT'>LSMINIT</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LSMINIT_1">(VEGFRA,SNOW,SNOWC,SNOWH,CANWAT,SMSTAV,  &amp;<a name='800'>
                     SMSTOT, SFCRUNOFF,UDRUNOFF,ACSNOW,        &amp;<a name='801'>
                     ACSNOM,IVGTYP,ISLTYP,TSLB,SMOIS,SH2O,ZS,DZS, &amp;<a name='802'>
                     FNDSOILW, FNDSNOWH,                       &amp;<a name='803'>
                     num_soil_layers, restart,                 &amp;<a name='804'>
                     allowed_to_read ,                         &amp;<a name='805'>
                     ids,ide, jds,jde, kds,kde,                &amp;<a name='806'>
                     ims,ime, jms,jme, kms,kme,                &amp;<a name='807'>
                     its,ite, jts,jte, kts,kte                 )<a name='808'>
<a name='809'>
      CASE (RUCLSMSCHEME)<a name='810'>
           if(isfc .ne. 2)CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_157"> &amp;<a name='811'>
            ( 'module_physics_init: use myjsfc and myjpbl scheme for this lsm option' )<a name='812'>
           CALL <A href='../../html_code/phys/module_sf_ruclsm.F.html#LSMRUCINIT'>lsmrucinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LSMRUCINIT_1">( SMFR3D,TSLB,SMOIS,ISLTYP,              &amp;<a name='813'>
                     num_soil_layers, restart,                     &amp;<a name='814'>
                     allowed_to_read ,                             &amp;<a name='815'>
                     ids,ide, jds,jde, kds,kde,                    &amp;<a name='816'>
                     ims,ime, jms,jme, kms,kme,                    &amp;<a name='817'>
                     its,ite, jts,jte, kts,kte                     )<a name='818'>
<a name='819'>
      CASE DEFAULT<a name='820'>
<a name='821'>
   END SELECT sfc_select<a name='822'>
<a name='823'>
<a name='824'>
<font color=#447700>!-- initialize pbl scheme<a name='825'></font>
<a name='826'>
   pbl_select: SELECT CASE(config_flags%bl_pbl_physics)<a name='827'>
<a name='828'>
      CASE (YSUSCHEME)<a name='829'>
           if(isfc .ne. 1)CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_158"> &amp;<a name='830'>
            ( 'module_physics_init: use sfclay scheme for this pbl option' )<a name='831'>
           CALL <A href='../../html_code/phys/module_bl_ysu.F.html#YSUINIT'>ysuinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="YSUINIT_1">(RUBLTEN,RVBLTEN,RTHBLTEN,RQVBLTEN,    &amp;<a name='832'>
                        RQCBLTEN,RQIBLTEN,P_QI,               &amp;<a name='833'>
                        PARAM_FIRST_SCALAR,                   &amp;<a name='834'>
                        restart,                              &amp;<a name='835'>
                        allowed_to_read ,                     &amp;<a name='836'>
                        ids, ide, jds, jde, kds, kde,         &amp;<a name='837'>
                        ims, ime, jms, jme, kms, kme,         &amp;<a name='838'>
                        its, ite, jts, jte, kts, kte          )<a name='839'>
      CASE (MRFSCHEME)<a name='840'>
           if(isfc .ne. 1)CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_159"> &amp;<a name='841'>
            ( 'module_physics_init: use sfclay scheme for this pbl option' )<a name='842'>
           CALL <A href='../../html_code/phys/module_bl_mrf.F.html#MRFINIT'>mrfinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MRFINIT_1">(RUBLTEN,RVBLTEN,RTHBLTEN,RQVBLTEN,    &amp;<a name='843'>
                        RQCBLTEN,RQIBLTEN,P_QI,               &amp;<a name='844'>
                        PARAM_FIRST_SCALAR,                   &amp;<a name='845'>
                        restart,                              &amp;<a name='846'>
                        allowed_to_read ,                     &amp;<a name='847'>
                        ids, ide, jds, jde, kds, kde,         &amp;<a name='848'>
                        ims, ime, jms, jme, kms, kme,         &amp;<a name='849'>
                        its, ite, jts, jte, kts, kte          )<a name='850'>
      CASE (GFSSCHEME)<a name='851'>
           if(isfc .ne. 1)CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_160"> &amp;<a name='852'>
            ( 'module_physics_init: use sfclay scheme for this pbl option' )<a name='853'>
           CALL <A href='../../html_code/phys/module_bl_gfs.F.html#GFSINIT'>gfsinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GFSINIT_1">(RUBLTEN,RVBLTEN,RTHBLTEN,RQVBLTEN,    &amp;<a name='854'>
                        RQCBLTEN,RQIBLTEN,P_QI,               &amp;<a name='855'>
                        PARAM_FIRST_SCALAR,                   &amp;<a name='856'>
                        restart,                              &amp;<a name='857'>
                        allowed_to_read ,                     &amp;<a name='858'>
                        ids, ide, jds, jde, kds, kde,         &amp;<a name='859'>
                        ims, ime, jms, jme, kms, kme,         &amp;<a name='860'>
                        its, ite, jts, jte, kts, kte          )<a name='861'>
      CASE (MYJPBLSCHEME)<a name='862'>
           if(isfc .ne. 2)CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_161"> &amp;<a name='863'>
            ( 'module_physics_init: use myjsfc scheme for this pbl option' )<a name='864'>
           CALL <A href='../../html_code/phys/module_bl_myjpbl.F.html#MYJPBLINIT'>myjpblinit</A><A href='../../html_code/phys/module_physics_init.F.html#BL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MYJPBLINIT_1">(RUBLTEN,RVBLTEN,RTHBLTEN,RQVBLTEN, &amp;<a name='865'>
                        TKE_MYJ,EXCH_H,restart,               &amp;<a name='866'>
                        allowed_to_read ,                     &amp;<a name='867'>
                        ids, ide, jds, jde, kds, kde,         &amp;<a name='868'>
                        ims, ime, jms, jme, kms, kme,         &amp;<a name='869'>
                        its, ite, jts, jte, kts, kte          )<a name='870'>
      CASE DEFAULT<a name='871'>
<a name='872'>
   END SELECT pbl_select<a name='873'>
<a name='874'>
   END SUBROUTINE bl_init<a name='875'>
<a name='876'>
<font color=#447700>!==================================================================<a name='877'></font>
<A NAME='CU_INIT'><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='878'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>cu_init</font>(STEPCU,CUDT,DT,RTHCUTEN,RQVCUTEN,RQRCUTEN,  &amp; <A href='../../call_to/CU_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/CU_INIT.html' TARGET='index'>12</A><a name='879'>
                      RQCCUTEN,RQSCUTEN,RQICUTEN,NCA,RAINC,       &amp;<a name='880'>
                      RAINCV,W0AVG,config_flags,restart,          &amp;<a name='881'>
                      CLDEFI,LOWLYR,MASS_FLUX,                    &amp;<a name='882'>
                      RTHFTEN, RQVFTEN,                           &amp;<a name='883'>
                      APR_GR,APR_W,APR_MC,APR_ST,APR_AS,          &amp;<a name='884'>
                      APR_CAPMA,APR_CAPME,APR_CAPMI,              &amp;<a name='885'>
                      allowed_to_read ,                           &amp;<a name='886'>
                      ids, ide, jds, jde, kds, kde,               &amp;<a name='887'>
                      ims, ime, jms, jme, kms, kme,               &amp;<a name='888'>
                      its, ite, jts, jte, kts, kte                )<a name='889'>
<font color=#447700>!------------------------------------------------------------------<a name='890'></font>
   USE <A href='../../html_code/phys/module_cu_kf.F.html#MODULE_CU_KF'>module_cu_kf</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CU_KF_3"><a name='891'>
   USE <A href='../../html_code/phys/module_cu_kfeta.F.html#MODULE_CU_KFETA'>module_cu_kfeta</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CU_KFETA_3"><a name='892'>
   USE <A href='../../html_code/phys/module_cu_bmj.F.html#MODULE_CU_BMJ'>MODULE_CU_BMJ</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CU_BMJ_2"><a name='893'>
   USE <A href='../../html_code/phys/module_cu_gd.F.html#MODULE_CU_GD'>module_cu_gd</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CU_GD_2"><a name='894'>
   USE <A href='../../html_code/phys/module_cu_sas.F.html#MODULE_CU_SAS'>module_cu_sas</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CU_SAS_2"><a name='895'>
   USE <A href='../../html_code/phys/module_cu_du.F.html#MODULE_CU_DU'>module_cu_du</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CU_DU_7"><a name='896'>
<font color=#447700>!------------------------------------------------------------------<a name='897'></font>
   IMPLICIT NONE<a name='898'>
<font color=#447700>!------------------------------------------------------------------<a name='899'></font>
   TYPE (grid_config_rec_type) ::     config_flags<a name='900'>
   LOGICAL , INTENT(IN)        :: restart<a name='901'>
<a name='902'>
<a name='903'>
   INTEGER , INTENT(IN)        :: ids, ide, jds, jde, kds, kde,   &amp;<a name='904'>
                                  ims, ime, jms, jme, kms, kme,   &amp;<a name='905'>
                                  its, ite, jts, jte, kts, kte<a name='906'>
<a name='907'>
   REAL ,    INTENT(IN)        :: DT, CUDT<a name='908'>
   LOGICAL , INTENT(IN)        :: allowed_to_read<a name='909'>
   INTEGER , INTENT(INOUT)     :: STEPCU<a name='910'>
<a name='911'>
   REAL ,   DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(INOUT) ::    &amp;<a name='912'>
            RTHCUTEN, RQVCUTEN, RQCCUTEN, RQRCUTEN, RQICUTEN,     &amp;<a name='913'>
            RQSCUTEN<a name='914'>
<a name='915'>
   REAL ,   DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) :: W0AVG<a name='916'>
<a name='917'>
   REAL,    DIMENSION( ims:ime , kms:kme , jms:jme ) , INTENT(OUT) ::    &amp;<a name='918'>
            RTHFTEN, RQVFTEN<a name='919'>
<a name='920'>
   REAL ,   DIMENSION( ims:ime , jms:jme ), INTENT(OUT):: RAINC, RAINCV<a name='921'>
<a name='922'>
   REAL ,   DIMENSION( ims:ime , jms:jme ), INTENT(OUT):: CLDEFI<a name='923'>
<a name='924'>
   REAL ,   DIMENSION( ims:ime , jms:jme ), INTENT(INOUT):: NCA<a name='925'>
<a name='926'>
   REAL ,   DIMENSION( ims:ime , jms:jme ), INTENT(INOUT):: MASS_FLUX,   &amp;<a name='927'>
                                   APR_GR,APR_W,APR_MC,APR_ST,APR_AS,    &amp;<a name='928'>
                                   APR_CAPMA,APR_CAPME,APR_CAPMI<a name='929'>
<a name='930'>
   INTEGER, DIMENSION( ims:ime , jms:jme ), INTENT(INOUT):: LOWLYR<a name='931'>
<a name='932'>
<font color=#447700>! LOCAL VAR<a name='933'></font>
   <a name='934'>
  INTEGER :: i,j,itf,jtf<a name='935'>
<a name='936'>
<font color=#447700>!--------------------------------------------------------------------<a name='937'></font>
<a name='938'>
<font color=#447700>!-- calculate cumulus parameterization time step<a name='939'></font>
<a name='940'>
   itf=min0(ite,ide-1)<a name='941'>
   jtf=min0(jte,jde-1)<a name='942'>
<font color=#447700>!<a name='943'></font>
   STEPCU = nint(CUDT*60./DT)<a name='944'>
   STEPCU = max(STEPCU,1)<a name='945'>
<a name='946'>
<font color=#447700>!-- initialization<a name='947'></font>
<a name='948'>
   IF(.not.restart)THEN<a name='949'>
     DO j=jts,jtf<a name='950'>
     DO i=its,itf<a name='951'>
        RAINC(i,j)=0.<a name='952'>
        RAINCV(i,j)=0.<a name='953'>
     ENDDO<a name='954'>
     ENDDO<a name='955'>
   ENDIF<a name='956'>
<a name='957'>
   cps_select: SELECT CASE(config_flags%cu_physics)<a name='958'>
<a name='959'>
     CASE (KFSCHEME)<a name='960'>
          CALL <A href='../../html_code/phys/module_cu_kf.F.html#KFINIT'>kfinit</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KFINIT_1">(RTHCUTEN,RQVCUTEN,RQCCUTEN,RQRCUTEN,        &amp;<a name='961'>
                      RQICUTEN,RQSCUTEN,NCA,W0AVG,P_QI,P_QS,      &amp;<a name='962'>
                      PARAM_FIRST_SCALAR,restart,                 &amp;<a name='963'>
                      allowed_to_read ,                           &amp;<a name='964'>
                      ids, ide, jds, jde, kds, kde,               &amp;<a name='965'>
                      ims, ime, jms, jme, kms, kme,               &amp;<a name='966'>
                      its, ite, jts, jte, kts, kte                )<a name='967'>
<a name='968'>
     CASE (BMJSCHEME)<a name='969'>
          CALL <A href='../../html_code/phys/module_cu_bmj.F.html#BMJINIT'>bmjinit</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BMJINIT_1">(RTHCUTEN,RQVCUTEN,RQCCUTEN,RQRCUTEN,       &amp;<a name='970'>
                      CLDEFI,LOWLYR,cp,r_d,restart,               &amp;<a name='971'>
                      allowed_to_read ,                           &amp;<a name='972'>
                      ids, ide, jds, jde, kds, kde,               &amp;<a name='973'>
                      ims, ime, jms, jme, kms, kme,               &amp;<a name='974'>
                      its, ite, jts, jte, kts, kte                )<a name='975'>
<a name='976'>
     CASE (KFETASCHEME)<a name='977'>
          CALL <A href='../../html_code/phys/module_cu_kfeta.F.html#KF_ETA_INIT'>kf_eta_init</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KF_ETA_INIT_1">(RTHCUTEN,RQVCUTEN,RQCCUTEN,RQRCUTEN,   &amp;<a name='978'>
                      RQICUTEN,RQSCUTEN,NCA,W0AVG,P_QI,P_QS,      &amp;<a name='979'>
                      SVP1,SVP2,SVP3,SVPT0,                       &amp;<a name='980'>
                      PARAM_FIRST_SCALAR,restart,                 &amp;<a name='981'>
                      allowed_to_read ,                           &amp;<a name='982'>
                      ids, ide, jds, jde, kds, kde,               &amp;<a name='983'>
                      ims, ime, jms, jme, kms, kme,               &amp;<a name='984'>
                      its, ite, jts, jte, kts, kte                )<a name='985'>
     CASE (GDSCHEME)<a name='986'>
          CALL <A href='../../html_code/phys/module_cu_gd.F.html#GDINIT'>gdinit</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GDINIT_1">(RTHCUTEN,RQVCUTEN,RQCCUTEN,RQICUTEN,        &amp;<a name='987'>
                      MASS_FLUX,cp,restart,                       &amp;<a name='988'>
                      P_QC,P_QI,PARAM_FIRST_SCALAR,               &amp;<a name='989'>
                      RTHFTEN, RQVFTEN,                           &amp;<a name='990'>
                      APR_GR,APR_W,APR_MC,APR_ST,APR_AS,          &amp;<a name='991'>
                      APR_CAPMA,APR_CAPME,APR_CAPMI,              &amp;<a name='992'>
                      allowed_to_read ,                           &amp;<a name='993'>
                      ids, ide, jds, jde, kds, kde,               &amp;<a name='994'>
                      ims, ime, jms, jme, kms, kme,               &amp;<a name='995'>
                      its, ite, jts, jte, kts, kte                )<a name='996'>
     CASE (SASSCHEME)<a name='997'>
          CALL <A href='../../html_code/phys/module_cu_sas.F.html#SASINIT'>sasinit</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SASINIT_1">(RTHCUTEN,RQVCUTEN,RQCCUTEN,RQICUTEN,       &amp;<a name='998'>
                      restart,P_QC,P_QI,PARAM_FIRST_SCALAR,       &amp;<a name='999'>
                      allowed_to_read ,                           &amp;<a name='1000'>
                      ids, ide, jds, jde, kds, kde,               &amp;<a name='1001'>
                      ims, ime, jms, jme, kms, kme,               &amp;<a name='1002'>
                      its, ite, jts, jte, kts, kte                )<a name='1003'>
     CASE (DUCUSCHEME)<a name='1004'>
          CALL <A href='../../html_code/phys/module_cu_du.F.html#DUCUINIT'>ducuinit</A><A href='../../html_code/phys/module_physics_init.F.html#CU_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DUCUINIT_1">(RTHCUTEN,RQVCUTEN,RQCCUTEN,RQRCUTEN,      &amp;<a name='1005'>
                      RQICUTEN,RQSCUTEN,NCA,W0AVG,P_QI,P_QS,      &amp;<a name='1006'>
                      SVP1,SVP2,SVP3,SVPT0,                       &amp;<a name='1007'>
                      PARAM_FIRST_SCALAR,restart,                 &amp;<a name='1008'>
                      allowed_to_read ,                           &amp;<a name='1009'>
                      ids, ide, jds, jde, kds, kde,               &amp;<a name='1010'>
                      ims, ime, jms, jme, kms, kme,               &amp;<a name='1011'>
                      its, ite, jts, jte, kts, kte                )<a name='1012'>
<a name='1013'>
     CASE DEFAULT<a name='1014'>
<a name='1015'>
   END SELECT cps_select<a name='1016'>
<a name='1017'>
   END SUBROUTINE cu_init<a name='1018'>
<a name='1019'>
<font color=#447700>!==================================================================<a name='1020'></font>
<A NAME='MP_INIT'><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1021'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>mp_init</font>(RAINNC,config_flags,restart,warm_rain,      &amp; <A href='../../call_to/MP_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/MP_INIT.html' TARGET='index'>12</A><a name='1022'>
                      MPDT, DT, DX, DY, LOWLYR,                   &amp; <font color=#447700>! for eta mp<a name='1023'></font>
                      F_ICE_PHY,F_RAIN_PHY,F_RIMEF_PHY,           &amp; <font color=#447700>! for eta mp<a name='1024'></font>
                      allowed_to_read ,                           &amp;<a name='1025'>
                      ids, ide, jds, jde, kds, kde,               &amp;<a name='1026'>
                      ims, ime, jms, jme, kms, kme,               &amp;<a name='1027'>
                      its, ite, jts, jte, kts, kte                )<a name='1028'>
<font color=#447700>!------------------------------------------------------------------<a name='1029'></font>
   USE <A href='../../html_code/phys/module_mp_ncloud3.F.html#MODULE_MP_NCLOUD3'>module_mp_ncloud3</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_NCLOUD3_2"><a name='1030'>
   USE <A href='../../html_code/phys/module_mp_ncloud5.F.html#MODULE_MP_NCLOUD5'>module_mp_ncloud5</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_NCLOUD5_2"><a name='1031'>
   USE <A href='../../html_code/phys/module_mp_wsm3.F.html#MODULE_MP_WSM3'>module_mp_wsm3</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_WSM3_2"><a name='1032'>
   USE <A href='../../html_code/phys/module_mp_wsm5.F.html#MODULE_MP_WSM5'>module_mp_wsm5</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_WSM5_2"><a name='1033'>
   USE <A href='../../html_code/phys/module_mp_wsm6.F.html#MODULE_MP_WSM6'>module_mp_wsm6</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_WSM6_2"><a name='1034'>
   USE <A href='../../html_code/phys/module_mp_etanew.F.html#MODULE_MP_ETANEW'>module_mp_etanew</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_ETANEW_2"><a name='1035'>
<font color=#447700>!------------------------------------------------------------------<a name='1036'></font>
   IMPLICIT NONE<a name='1037'>
<font color=#447700>!------------------------------------------------------------------<a name='1038'></font>
<font color=#447700>! Arguments<a name='1039'></font>
   TYPE (grid_config_rec_type) ::     config_flags<a name='1040'>
   LOGICAL , INTENT(IN)        :: restart<a name='1041'>
   LOGICAL , INTENT(OUT)       :: warm_rain<a name='1042'>
   REAL    , INTENT(IN)        :: MPDT, DT, DX, DY<a name='1043'>
<a name='1044'>
   INTEGER , INTENT(IN)        :: ids, ide, jds, jde, kds, kde,   &amp;<a name='1045'>
                                  ims, ime, jms, jme, kms, kme,   &amp;<a name='1046'>
                                  its, ite, jts, jte, kts, kte<a name='1047'>
<a name='1048'>
   INTEGER , DIMENSION( ims:ime , jms:jme ) ,INTENT(INOUT)  :: LOWLYR<a name='1049'>
   REAL,     DIMENSION( ims:ime , jms:jme ) , INTENT(INOUT) :: RAINNC<a name='1050'>
   REAL,     DIMENSION( ims:ime , kms:kme, jms:jme ) , INTENT(INOUT) :: &amp;<a name='1051'>
                                  F_ICE_PHY,F_RAIN_PHY,F_RIMEF_PHY<a name='1052'>
   LOGICAL , INTENT(IN)  :: allowed_to_read<a name='1053'>
<a name='1054'>
<font color=#447700>! Local<a name='1055'></font>
   INTEGER :: i, j, itf, jtf<a name='1056'>
<a name='1057'>
   warm_rain = .false.<a name='1058'>
   itf=min0(ite,ide-1)<a name='1059'>
   jtf=min0(jte,jde-1)<a name='1060'>
<a name='1061'>
   IF(.not.restart)THEN<a name='1062'>
     DO j=jts,jtf<a name='1063'>
     DO i=its,itf<a name='1064'>
        RAINNC(i,j) = 0.<a name='1065'>
     ENDDO<a name='1066'>
     ENDDO<a name='1067'>
   ENDIF<a name='1068'>
<a name='1069'>
   mp_select: SELECT CASE(config_flags%mp_physics)<a name='1070'>
<a name='1071'>
     CASE (KESSLERSCHEME)<a name='1072'>
          warm_rain = .true.<a name='1073'>
     CASE (WSM3SCHEME)<a name='1074'>
          CALL <A href='../../html_code/phys/module_mp_wsm3.F.html#WSM3INIT'>wsm3init</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WSM3INIT_1">(rhoair0,rhowater,rhosnow,cliq,cv, allowed_to_read )<a name='1075'>
     CASE (WSM5SCHEME)<a name='1076'>
          CALL <A href='../../html_code/phys/module_mp_wsm5.F.html#WSM5INIT'>wsm5init</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WSM5INIT_1">(rhoair0,rhowater,rhosnow,cliq,cv, allowed_to_read )<a name='1077'>
     CASE (WSM6SCHEME)<a name='1078'>
          CALL <A href='../../html_code/phys/module_mp_wsm6.F.html#WSM6INIT'>wsm6init</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WSM6INIT_1">(rhoair0,rhowater,rhosnow,cliq,cv, allowed_to_read )<a name='1079'>
     CASE (ETAMPNEW)<a name='1080'>
         CALL <A href='../../html_code/phys/module_mp_etanew.F.html#ETANEWINIT'>etanewinit</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ETANEWINIT_1"> (MPDT,DT,DX,DY,LOWLYR,restart,           &amp;<a name='1081'>
                          F_ICE_PHY,F_RAIN_PHY,F_RIMEF_PHY,       &amp;<a name='1082'>
                          allowed_to_read,                        &amp;<a name='1083'>
                          ids, ide, jds, jde, kds, kde,           &amp;<a name='1084'>
                          ims, ime, jms, jme, kms, kme,           &amp;<a name='1085'>
                          its, ite, jts, jte, kts, kte            )<a name='1086'>
     CASE (NCEPCLOUD3)<a name='1087'>
          CALL <A href='../../html_code/phys/module_mp_ncloud3.F.html#NCLOUD3INIT'>ncloud3init</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NCLOUD3INIT_1">(rhoair0,rhowater,rhosnow,cliq,cv, allowed_to_read )<a name='1088'>
     CASE (NCEPCLOUD5)<a name='1089'>
          CALL <A href='../../html_code/phys/module_mp_ncloud5.F.html#NCLOUD5INIT'>ncloud5init</A><A href='../../html_code/phys/module_physics_init.F.html#MP_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NCLOUD5INIT_1">(rhoair0,rhowater,rhosnow,cliq,cv, allowed_to_read )<a name='1090'>
<a name='1091'>
     CASE DEFAULT<a name='1092'>
<a name='1093'>
   END SELECT mp_select<a name='1094'>
<a name='1095'>
   END SUBROUTINE mp_init<a name='1096'>
<a name='1097'>
<A NAME='Z2SIGMA'><A href='../../html_code/phys/module_physics_init.F.html#Z2SIGMA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1098'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>z2sigma</font>(zf,zh,sf,sh,p_top,pptop,config_flags, &amp; <A href='../../call_to/Z2SIGMA.html' TARGET='index'>1</A><a name='1099'>
                allowed_to_read , &amp;<a name='1100'>
                kds,kde,kms,kme,kts,kte)<a name='1101'>
   IMPLICIT NONE<a name='1102'>
<font color=#447700>! Arguments<a name='1103'></font>
   INTEGER, INTENT(IN) :: kds,kde,kms,kme,kts,kte<a name='1104'>
   REAL , DIMENSION( kms:kme ), INTENT(IN) :: zf,zh<a name='1105'>
   REAL , DIMENSION( kms:kme ), INTENT(OUT):: sf,sh<a name='1106'>
   REAL , INTENT(IN) :: p_top<a name='1107'>
   REAL , INTENT(OUT) :: pptop<a name='1108'>
   TYPE (grid_config_rec_type)              :: config_flags<a name='1109'>
   LOGICAL , INTENT(IN) :: allowed_to_read<a name='1110'>
<font color=#447700>! Local<a name='1111'></font>
   REAL R, G, TS, GAMMA, PS, ZTROP, TSTRAT, PTROP, Z, T, P, ZTOP, PTOP<a name='1112'>
   INTEGER K<a name='1113'>
<a name='1114'>
   IF(zf(kde/2) .GT. 1.0)THEN<a name='1115'>
<font color=#447700>! Height levels assumed (zeta coordinate)<a name='1116'></font>
<font color=#447700>! Convert to sigma using standard atmosphere for pressure-height relation<a name='1117'></font>
<font color=#447700>! constants for standard atmosphere definition<a name='1118'></font>
      r=287.05<a name='1119'>
      g=9.80665<a name='1120'>
      ts=288.15<a name='1121'>
      gamma=-6.5/1000.<a name='1122'>
      ps=1013.25<a name='1123'>
      ztrop=11000.<a name='1124'>
      tstrat=ts+gamma*ztrop<a name='1125'>
      ptrop=ps*(tstrat/ts)**(-g/(gamma*r))<a name='1126'>
<a name='1127'>
      do k=kde,kds,-1<a name='1128'>
<font color=#447700>! full levels<a name='1129'></font>
        z=zf(k)<a name='1130'>
        if(z.le.ztrop)then<a name='1131'>
          t=ts+gamma*z<a name='1132'>
          p=ps*(t/ts)**(-g/(gamma*r))<a name='1133'>
        else<a name='1134'>
          t=tstrat<a name='1135'>
          p=ptrop*exp(-g*(z-ztrop)/(r*tstrat))<a name='1136'>
        endif<a name='1137'>
        if(k.eq.kde)then<a name='1138'>
          ztop=zf(k)<a name='1139'>
          ptop=p<a name='1140'>
        endif<a name='1141'>
        sf(k)=(p-ptop)/(ps-ptop)<a name='1142'>
<font color=#447700>! half levels<a name='1143'></font>
        if(k.ne.kds)then<a name='1144'>
        z=0.5*(zf(k)+zf(k-1))<a name='1145'>
        if(z.le.ztrop)then<a name='1146'>
          t=ts+gamma*z<a name='1147'>
          p=ps*(t/ts)**(-g/(gamma*r))<a name='1148'>
        else<a name='1149'>
          t=tstrat<a name='1150'>
          p=ptrop*exp(-g*(z-ztrop)/(r*tstrat))<a name='1151'>
        endif<a name='1152'>
        sh(k-1)=(p-ptop)/(ps-ptop)<a name='1153'>
        endif<a name='1154'>
      enddo<a name='1155'>
      pptop=ptop/10.<a name='1156'>
   ELSE<a name='1157'>
<font color=#447700>!  Levels are already sigma/eta<a name='1158'></font>
      do k=kde,kds,-1<a name='1159'>
<font color=#447700>!        sf(k)=zf(kde-k+kds)<a name='1160'></font>
<font color=#447700>!        if(k .ne. kde)sh(k)=zh(kde-1-k+kds)<a name='1161'></font>
         sf(k)=zf(k)<a name='1162'>
         if(k .ne. kde)sh(k)=zh(k)<a name='1163'>
      enddo<a name='1164'>
      pptop=p_top/1000.<a name='1165'>
<a name='1166'>
   ENDIF<a name='1167'>
<a name='1168'>
   END SUBROUTINE z2sigma<a name='1169'>
<a name='1170'>
END MODULE module_physics_init<a name='1171'>
</pre></body></html>