<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MODEL_LAYER:UTIL<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<A NAME='MODULE_DATE_TIME'><A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='4'>
<font color=#993300>MODULE </font><font color=#cc0000>module_date_time</font> <A href='../../call_to/MODULE_DATE_TIME.html' TARGET='index'>30</A><a name='5'>
<a name='6'>
  USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/share/module_date_time.F.html#module_date_time.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_49"><a name='7'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_date_time.F.html#module_date_time.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_176"><a name='8'>
<a name='9'>
  CHARACTER* 24 ::   start_date = '                        '<a name='10'>
  CHARACTER* 24 ::   current_date<a name='11'>
  INTEGER , PARAMETER :: len_current_date  = 24<a name='12'>
  REAL :: xtime<a name='13'>
<a name='14'>
<font color=#447700>!  1.  geth_idts (ndate, odate, idts)<a name='15'></font>
<font color=#447700>!  Get the time period between two dates.<a name='16'></font>
<a name='17'>
<font color=#447700>!  2. geth_newdate ( ndate, odate, idts)<a name='18'></font>
<font color=#447700>!  Get the new date based on the old date and a time difference.<a name='19'></font>
<a name='20'>
<font color=#447700>!  3. split_date_char ( date , century_year , month , day , hour , minute , second , ten_thousandth)<a name='21'></font>
<font color=#447700>!  Given the date, return the integer components.<a name='22'></font>
<a name='23'>
CONTAINS<a name='24'>
<a name='25'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='26'></font>
<a name='27'>
<A NAME='GETH_JULGMT'><A href='../../html_code/share/module_date_time.F.html#GETH_JULGMT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='28'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>geth_julgmt</font>(julyr,julday, gmt) <A href='../../call_to/GETH_JULGMT.html' TARGET='index'>5</A>,<A href='../../call_from/GETH_JULGMT.html' TARGET='index'>1</A><a name='29'>
     IMPLICIT NONE<a name='30'>
<font color=#447700>! Arguments<a name='31'></font>
     INTEGER, INTENT(OUT  ) :: julyr<a name='32'>
     INTEGER, INTENT(OUT  ) :: julday<a name='33'>
     REAL   , INTENT(OUT  ) :: gmt<a name='34'>
<font color=#447700>! Local<a name='35'></font>
     INTEGER :: ny , nm , nd , nh , ni , ns , nt<a name='36'>
     INTEGER :: my1, my2, my3, monss<a name='37'>
     INTEGER, DIMENSION(12) :: mmd<a name='38'>
     DATA MMD/31,28,31,30,31,30,31,31,30,31,30,31/<a name='39'>
     CALL <A href='../../html_code/share/module_date_time.F.html#SPLIT_DATE_CHAR'>split_date_char</A><A href='../../html_code/share/module_date_time.F.html#GETH_JULGMT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPLIT_DATE_CHAR_1"> ( current_date , ny , nm , nd , nh , ni , ns , nt )<a name='40'>
     GMT=nh+FLOAT(ni)/60.+FLOAT(ns)/3600.<a name='41'>
     MY1=MOD(ny,4)<a name='42'>
     MY2=MOD(ny,100)<a name='43'>
     MY3=MOD(ny,400)<a name='44'>
     IF(MY1.EQ.0.AND.MY2.NE.0.OR.MY3.EQ.0)MMD(2)=29<a name='45'>
     JULDAY=nd<a name='46'>
     JULYR=ny<a name='47'>
     DO MONSS=1,nm-1<a name='48'>
       JULDAY=JULDAY+MMD(MONSS)<a name='49'>
     ENDDO<a name='50'>
   END SUBROUTINE geth_julgmt<a name='51'>
<a name='52'>
<A NAME='CALC_CURRENT_DATE'><A href='../../html_code/share/module_date_time.F.html#CALC_CURRENT_DATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='53'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>calc_current_date</font> (id, time) <A href='../../call_to/CALC_CURRENT_DATE.html' TARGET='index'>1</A>,<A href='../../call_from/CALC_CURRENT_DATE.html' TARGET='index'>7</A><a name='54'>
<font color=#447700>! This subroutines calculates current_date and xtime<a name='55'></font>
   IMPLICIT NONE<a name='56'>
<font color=#447700>! Arguments<a name='57'></font>
   INTEGER, INTENT(IN   ) :: id <font color=#447700>! grid id<a name='58'></font>
   REAL, INTENT(IN   ) :: time <font color=#447700>! time in seconds since start time<a name='59'></font>
<font color=#447700>! Local<a name='60'></font>
   INTEGER :: julyr, julday, idt<a name='61'>
   CHARACTER*19  new_date<a name='62'>
   CHARACTER*24  base_date<a name='63'>
   CHARACTER*128 mess<a name='64'>
   REAL :: gmt<a name='65'>
<a name='66'>
    xtime = time/60.<a name='67'>
    CALL nl_get_gmt (id, gmt)<a name='68'>
    CALL nl_get_julyr (id, julyr)<a name='69'>
    CALL nl_get_julday (id, julday)<a name='70'>
    idt        = 86400*(julday-1)+nint(3600*gmt)<a name='71'>
    write (mess,*) 'calc_current_date called: time = ',time,' idt = ',idt<a name='72'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_date_time.F.html#CALC_CURRENT_DATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_231">(300,TRIM(mess))<a name='73'>
    write (mess,*) 'calc_current_date called: gmt  = ',gmt<a name='74'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_date_time.F.html#CALC_CURRENT_DATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_232">(300,TRIM(mess))<a name='75'>
    write (mess,*) 'calc_current_date called: julyr  = ',julyr<a name='76'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_date_time.F.html#CALC_CURRENT_DATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_233">(300,TRIM(mess))<a name='77'>
    write (mess,*) 'calc_current_date called: julday = ',julday<a name='78'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_date_time.F.html#CALC_CURRENT_DATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_234">(300,TRIM(mess))<a name='79'>
    base_date  = '0000-01-01_00:00:00.0000'<a name='80'>
    write(base_date(1:4),'(I4.4)')julyr<a name='81'>
    CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/share/module_date_time.F.html#CALC_CURRENT_DATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_13"> (start_date(1:19), base_date(1:19), idt)<a name='82'>
    CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/share/module_date_time.F.html#CALC_CURRENT_DATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_14"> (new_date, start_date(1:19), nint(time))<a name='83'>
    write (current_date(1:24),fmt=340)new_date<a name='84'>
    340 format(a19, '.0000')<a name='85'>
    write (mess,*) current_date,gmt,julday,julyr,'=current_date,gmt,julday,julyr: calc_current_date'<a name='86'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_date_time.F.html#CALC_CURRENT_DATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_235">(300,TRIM(mess))<a name='87'>
   END SUBROUTINE calc_current_date<a name='88'>
<a name='89'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='90'></font>
<a name='91'>
<A NAME='GETH_IDTS'><A href='../../html_code/share/module_date_time.F.html#GETH_IDTS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='92'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>geth_idts</font> (ndate, odate, idts) <A href='../../call_to/GETH_IDTS.html' TARGET='index'>1</A>,<A href='../../call_from/GETH_IDTS.html' TARGET='index'>4</A><a name='93'>
   <a name='94'>
      IMPLICIT NONE<a name='95'>
      <a name='96'>
      <font color=#447700>!  From 2 input mdates ('YYYY-MM-DD HH:MM:SS.ffff'), <a name='97'></font>
      <font color=#447700>!  compute the time difference.<a name='98'></font>
      <a name='99'>
      <font color=#447700>!  on entry     -  ndate  -  the new hdate.<a name='100'></font>
      <font color=#447700>!                  odate  -  the old hdate.<a name='101'></font>
      <a name='102'>
      <font color=#447700>!  on exit      -  idts    -  the change in time in seconds.<a name='103'></font>
      <a name='104'>
      CHARACTER (LEN=*) , INTENT(INOUT) :: ndate, odate<a name='105'>
      INTEGER           , INTENT(OUT)   :: idts<a name='106'>
      <a name='107'>
      <font color=#447700>!  Local Variables<a name='108'></font>
      <a name='109'>
      <font color=#447700>!  yrnew    -  indicates the year associated with "ndate"<a name='110'></font>
      <font color=#447700>!  yrold    -  indicates the year associated with "odate"<a name='111'></font>
      <font color=#447700>!  monew    -  indicates the month associated with "ndate"<a name='112'></font>
      <font color=#447700>!  moold    -  indicates the month associated with "odate"<a name='113'></font>
      <font color=#447700>!  dynew    -  indicates the day associated with "ndate"<a name='114'></font>
      <font color=#447700>!  dyold    -  indicates the day associated with "odate"<a name='115'></font>
      <font color=#447700>!  hrnew    -  indicates the hour associated with "ndate"<a name='116'></font>
      <font color=#447700>!  hrold    -  indicates the hour associated with "odate"<a name='117'></font>
      <font color=#447700>!  minew    -  indicates the minute associated with "ndate"<a name='118'></font>
      <font color=#447700>!  miold    -  indicates the minute associated with "odate"<a name='119'></font>
      <font color=#447700>!  scnew    -  indicates the second associated with "ndate"<a name='120'></font>
      <font color=#447700>!  scold    -  indicates the second associated with "odate"<a name='121'></font>
      <font color=#447700>!  i        -  loop counter<a name='122'></font>
      <font color=#447700>!  mday     -  a list assigning the number of days in each month<a name='123'></font>
      <a name='124'>
      CHARACTER (LEN=24) :: tdate<a name='125'>
      INTEGER :: olen, nlen<a name='126'>
      INTEGER :: yrnew, monew, dynew, hrnew, minew, scnew<a name='127'>
      INTEGER :: yrold, moold, dyold, hrold, miold, scold<a name='128'>
      INTEGER :: mday(12), i, newdys, olddys<a name='129'>
      LOGICAL :: npass, opass<a name='130'>
      INTEGER :: isign<a name='131'>
      <a name='132'>
      IF (odate.GT.ndate) THEN<a name='133'>
         isign = -1<a name='134'>
         tdate=ndate<a name='135'>
         ndate=odate<a name='136'>
         odate=tdate<a name='137'>
      ELSE<a name='138'>
         isign = 1<a name='139'>
      END IF<a name='140'>
      <a name='141'>
      <font color=#447700>!  Assign the number of days in a months<a name='142'></font>
      <a name='143'>
      mday( 1) = 31<a name='144'>
      mday( 2) = 28<a name='145'>
      mday( 3) = 31<a name='146'>
      mday( 4) = 30<a name='147'>
      mday( 5) = 31<a name='148'>
      mday( 6) = 30<a name='149'>
      mday( 7) = 31<a name='150'>
      mday( 8) = 31<a name='151'>
      mday( 9) = 30<a name='152'>
      mday(10) = 31<a name='153'>
      mday(11) = 30<a name='154'>
      mday(12) = 31<a name='155'>
      <a name='156'>
      <font color=#447700>!  Break down old hdate into parts<a name='157'></font>
      <a name='158'>
      hrold = 0<a name='159'>
      miold = 0<a name='160'>
      scold = 0<a name='161'>
      olen = LEN(odate)<a name='162'>
      <a name='163'>
      READ(odate(1:4),  '(I4)') yrold<a name='164'>
      READ(odate(6:7),  '(I2)') moold<a name='165'>
      READ(odate(9:10), '(I2)') dyold<a name='166'>
      IF (olen.GE.13) THEN<a name='167'>
         READ(odate(12:13),'(I2)') hrold<a name='168'>
         IF (olen.GE.16) THEN<a name='169'>
            READ(odate(15:16),'(I2)') miold<a name='170'>
            IF (olen.GE.19) THEN<a name='171'>
               READ(odate(18:19),'(I2)') scold<a name='172'>
            END IF<a name='173'>
         END IF<a name='174'>
      END IF<a name='175'>
      <a name='176'>
      <font color=#447700>!  Break down new hdate into parts<a name='177'></font>
      <a name='178'>
      hrnew = 0<a name='179'>
      minew = 0<a name='180'>
      scnew = 0<a name='181'>
      nlen = LEN(ndate)<a name='182'>
      <a name='183'>
      READ(ndate(1:4),  '(I4)') yrnew<a name='184'>
      READ(ndate(6:7),  '(I2)') monew<a name='185'>
      READ(ndate(9:10), '(I2)') dynew<a name='186'>
      IF (nlen.GE.13) THEN<a name='187'>
         READ(ndate(12:13),'(I2)') hrnew<a name='188'>
         IF (nlen.GE.16) THEN<a name='189'>
            READ(ndate(15:16),'(I2)') minew<a name='190'>
            IF (nlen.GE.19) THEN<a name='191'>
               READ(ndate(18:19),'(I2)') scnew<a name='192'>
            END IF<a name='193'>
         END IF<a name='194'>
      END IF<a name='195'>
      <a name='196'>
      <font color=#447700>!  Check that the dates make sense.<a name='197'></font>
      <a name='198'>
      npass = .true.<a name='199'>
      opass = .true.<a name='200'>
      <a name='201'>
      <font color=#447700>!  Check that the month of NDATE makes sense.<a name='202'></font>
      <a name='203'>
      IF ((monew.GT.12).or.(monew.LT.1)) THEN<a name='204'>
         PRINT*, 'GETH_IDTS:  Month of NDATE = ', monew<a name='205'>
         npass = .false.<a name='206'>
      END IF<a name='207'>
      <a name='208'>
      <font color=#447700>!  Check that the month of ODATE makes sense.<a name='209'></font>
      <a name='210'>
      IF ((moold.GT.12).or.(moold.LT.1)) THEN<a name='211'>
         PRINT*, 'GETH_IDTS:  Month of ODATE = ', moold<a name='212'>
         opass = .false.<a name='213'>
      END IF<a name='214'>
      <a name='215'>
      <font color=#447700>!  Check that the day of NDATE makes sense.<a name='216'></font>
      <a name='217'>
      IF (monew.ne.2) THEN<a name='218'>
      <font color=#447700>! ...... For all months but February<a name='219'></font>
         IF ((dynew.GT.mday(monew)).or.(dynew.LT.1)) THEN<a name='220'>
            PRINT*, 'GETH_IDTS:  Day of NDATE = ', dynew<a name='221'>
            npass = .false.<a name='222'>
         END IF<a name='223'>
      ELSE IF (monew.eq.2) THEN<a name='224'>
      <font color=#447700>! ...... For February<a name='225'></font>
         IF ((dynew.GT.nfeb(yrnew)).OR.(dynew.LT.1)) THEN<a name='226'>
            PRINT*, 'GETH_IDTS:  Day of NDATE = ', dynew<a name='227'>
            npass = .false.<a name='228'>
         END IF<a name='229'>
      END IF<a name='230'>
      <a name='231'>
      <font color=#447700>!  Check that the day of ODATE makes sense.<a name='232'></font>
      <a name='233'>
      IF (moold.ne.2) THEN<a name='234'>
      <font color=#447700>! ...... For all months but February<a name='235'></font>
         IF ((dyold.GT.mday(moold)).or.(dyold.LT.1)) THEN<a name='236'>
            PRINT*, 'GETH_IDTS:  Day of ODATE = ', dyold<a name='237'>
            opass = .false.<a name='238'>
         END IF<a name='239'>
      ELSE IF (moold.eq.2) THEN<a name='240'>
      <font color=#447700>! ....... For February<a name='241'></font>
         IF ((dyold.GT.nfeb(yrold)).or.(dyold.LT.1)) THEN<a name='242'>
            PRINT*, 'GETH_IDTS:  Day of ODATE = ', dyold<a name='243'>
            opass = .false.<a name='244'>
         END IF<a name='245'>
      END IF<a name='246'>
      <a name='247'>
      <font color=#447700>!  Check that the hour of NDATE makes sense.<a name='248'></font>
      <a name='249'>
      IF ((hrnew.GT.23).or.(hrnew.LT.0)) THEN<a name='250'>
         PRINT*, 'GETH_IDTS:  Hour of NDATE = ', hrnew<a name='251'>
         npass = .false.<a name='252'>
      END IF<a name='253'>
      <a name='254'>
      <font color=#447700>!  Check that the hour of ODATE makes sense.<a name='255'></font>
      <a name='256'>
      IF ((hrold.GT.23).or.(hrold.LT.0)) THEN<a name='257'>
         PRINT*, 'GETH_IDTS:  Hour of ODATE = ', hrold<a name='258'>
         opass = .false.<a name='259'>
      END IF<a name='260'>
      <a name='261'>
      <font color=#447700>!  Check that the minute of NDATE makes sense.<a name='262'></font>
      <a name='263'>
      IF ((minew.GT.59).or.(minew.LT.0)) THEN<a name='264'>
         PRINT*, 'GETH_IDTS:  Minute of NDATE = ', minew<a name='265'>
         npass = .false.<a name='266'>
      END IF<a name='267'>
      <a name='268'>
      <font color=#447700>!  Check that the minute of ODATE makes sense.<a name='269'></font>
      <a name='270'>
      IF ((miold.GT.59).or.(miold.LT.0)) THEN<a name='271'>
         PRINT*, 'GETH_IDTS:  Minute of ODATE = ', miold<a name='272'>
         opass = .false.<a name='273'>
      END IF<a name='274'>
      <a name='275'>
      <font color=#447700>!  Check that the second of NDATE makes sense.<a name='276'></font>
      <a name='277'>
      IF ((scnew.GT.59).or.(scnew.LT.0)) THEN<a name='278'>
         PRINT*, 'GETH_IDTS:  SECOND of NDATE = ', scnew<a name='279'>
         npass = .false.<a name='280'>
      END IF<a name='281'>
      <a name='282'>
      <font color=#447700>!  Check that the second of ODATE makes sense.<a name='283'></font>
      <a name='284'>
      IF ((scold.GT.59).or.(scold.LT.0)) THEN<a name='285'>
         PRINT*, 'GETH_IDTS:  Second of ODATE = ', scold<a name='286'>
         opass = .false.<a name='287'>
      END IF<a name='288'>
      <a name='289'>
      IF (.not. npass) THEN<a name='290'>
         WRITE( wrf_err_message , * ) 'module_date_time: geth_idts: Bad NDATE: ', ndate(1:nlen)<a name='291'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_date_time.F.html#GETH_IDTS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_230"> ( TRIM ( wrf_err_message ) )<a name='292'>
      END IF<a name='293'>
      <a name='294'>
      IF (.not. opass) THEN<a name='295'>
         WRITE( wrf_err_message , * ) 'module_date_time: geth_idts: Bad ODATE: ', odate(1:olen)<a name='296'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_date_time.F.html#GETH_IDTS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_231"> ( TRIM ( wrf_err_message ) )<a name='297'>
      END IF<a name='298'>
      <a name='299'>
      <font color=#447700>!  Date Checks are completed.  Continue.<a name='300'></font>
      <a name='301'>
      <font color=#447700>!  Compute number of days from 1 January ODATE, 00:00:00 until ndate<a name='302'></font>
      <font color=#447700>!  Compute number of hours from 1 January ODATE, 00:00:00 until ndate<a name='303'></font>
      <font color=#447700>!  Compute number of minutes from 1 January ODATE, 00:00:00 until ndate<a name='304'></font>
      <a name='305'>
      newdys = 0<a name='306'>
      DO i = yrold, yrnew - 1<a name='307'>
         newdys = newdys + (365 + (nfeb(i)-28))<a name='308'>
      END DO<a name='309'>
      <a name='310'>
      IF (monew .GT. 1) THEN<a name='311'>
         mday(2) = <A href='../../html_code/share/module_date_time.F.html#NFEB'>nfeb</A><A href='../../html_code/share/module_date_time.F.html#GETH_IDTS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NFEB_1">(yrnew)<a name='312'>
         DO i = 1, monew - 1<a name='313'>
            newdys = newdys + mday(i)<a name='314'>
         END DO<a name='315'>
         mday(2) = 28<a name='316'>
      END IF<a name='317'>
      <a name='318'>
      newdys = newdys + dynew-1<a name='319'>
      <a name='320'>
      <font color=#447700>!  Compute number of hours from 1 January ODATE, 00:00:00 until odate<a name='321'></font>
      <font color=#447700>!  Compute number of minutes from 1 January ODATE, 00:00:00 until odate<a name='322'></font>
      <a name='323'>
      olddys = 0<a name='324'>
      <a name='325'>
      IF (moold .GT. 1) THEN<a name='326'>
         mday(2) = <A href='../../html_code/share/module_date_time.F.html#NFEB'>nfeb</A><A href='../../html_code/share/module_date_time.F.html#GETH_IDTS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NFEB_2">(yrold)<a name='327'>
         DO i = 1, moold - 1<a name='328'>
            olddys = olddys + mday(i)<a name='329'>
         END DO<a name='330'>
         mday(2) = 28<a name='331'>
      END IF<a name='332'>
      <a name='333'>
      olddys = olddys + dyold-1<a name='334'>
      <a name='335'>
      <font color=#447700>!  Determine the time difference in seconds<a name='336'></font>
      <a name='337'>
      idts = (newdys - olddys) * 86400<a name='338'>
      idts = idts + (hrnew - hrold) * 3600<a name='339'>
      idts = idts + (minew - miold) * 60<a name='340'>
      idts = idts + (scnew - scold)<a name='341'>
      <a name='342'>
      IF (isign .eq. -1) THEN<a name='343'>
         tdate=ndate<a name='344'>
         ndate=odate<a name='345'>
         odate=tdate<a name='346'>
         idts = idts * isign<a name='347'>
      END IF<a name='348'>
   <a name='349'>
   END SUBROUTINE geth_idts<a name='350'>
<a name='351'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='352'></font>
<a name='353'>
<A NAME='GETH_NEWDATE'><A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='354'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>geth_newdate</font> (ndate, odate, idt) <A href='../../call_to/GETH_NEWDATE.html' TARGET='index'>14</A>,<A href='../../call_from/GETH_NEWDATE.html' TARGET='index'>5</A><a name='355'>
   <a name='356'>
      IMPLICIT NONE<a name='357'>
      <a name='358'>
      <font color=#447700>!  From old date ('YYYY-MM-DD HH:MM:SS.ffff') and <a name='359'></font>
      <font color=#447700>!  delta-time, compute the new date.<a name='360'></font>
   <a name='361'>
      <font color=#447700>!  on entry     -  odate  -  the old hdate.<a name='362'></font>
      <font color=#447700>!                  idt    -  the change in time<a name='363'></font>
   <a name='364'>
      <font color=#447700>!  on exit      -  ndate  -  the new hdate.<a name='365'></font>
      <a name='366'>
      INTEGER , INTENT(IN)           :: idt<a name='367'>
      CHARACTER (LEN=*) , INTENT(OUT) :: ndate<a name='368'>
      CHARACTER (LEN=*) , INTENT(IN)  :: odate<a name='369'>
      <a name='370'>
       <a name='371'>
      <font color=#447700>!  Local Variables<a name='372'></font>
       <a name='373'>
      <font color=#447700>!  yrold    -  indicates the year associated with "odate"<a name='374'></font>
      <font color=#447700>!  moold    -  indicates the month associated with "odate"<a name='375'></font>
      <font color=#447700>!  dyold    -  indicates the day associated with "odate"<a name='376'></font>
      <font color=#447700>!  hrold    -  indicates the hour associated with "odate"<a name='377'></font>
      <font color=#447700>!  miold    -  indicates the minute associated with "odate"<a name='378'></font>
      <font color=#447700>!  scold    -  indicates the second associated with "odate"<a name='379'></font>
       <a name='380'>
      <font color=#447700>!  yrnew    -  indicates the year associated with "ndate"<a name='381'></font>
      <font color=#447700>!  monew    -  indicates the month associated with "ndate"<a name='382'></font>
      <font color=#447700>!  dynew    -  indicates the day associated with "ndate"<a name='383'></font>
      <font color=#447700>!  hrnew    -  indicates the hour associated with "ndate"<a name='384'></font>
      <font color=#447700>!  minew    -  indicates the minute associated with "ndate"<a name='385'></font>
      <font color=#447700>!  scnew    -  indicates the second associated with "ndate"<a name='386'></font>
       <a name='387'>
      <font color=#447700>!  mday     -  a list assigning the number of days in each month<a name='388'></font>
      <a name='389'>
      <font color=#447700>!  i        -  loop counter<a name='390'></font>
      <font color=#447700>!  nday     -  the integer number of days represented by "idt"<a name='391'></font>
      <font color=#447700>!  nhour    -  the integer number of hours in "idt" after taking out<a name='392'></font>
      <font color=#447700>!              all the whole days<a name='393'></font>
      <font color=#447700>!  nmin     -  the integer number of minutes in "idt" after taking out<a name='394'></font>
      <font color=#447700>!              all the whole days and whole hours.<a name='395'></font>
      <font color=#447700>!  nsec     -  the integer number of minutes in "idt" after taking out<a name='396'></font>
      <font color=#447700>!              all the whole days, whole hours, and whole minutes.<a name='397'></font>
       <a name='398'>
      INTEGER :: nlen, olen<a name='399'>
      INTEGER :: yrnew, monew, dynew, hrnew, minew, scnew, frnew<a name='400'>
      INTEGER :: yrold, moold, dyold, hrold, miold, scold, frold<a name='401'>
      INTEGER :: mday(12), nday, nhour, nmin, nsec, nfrac, i, ifrc<a name='402'>
      LOGICAL :: opass<a name='403'>
      CHARACTER (LEN=10) :: hfrc<a name='404'>
      CHARACTER (LEN=1) :: sp<a name='405'>
      <font color=#447700>! INTEGER, EXTERNAL :: nfeb  ! in the same module now<a name='406'></font>
      <a name='407'>
      <font color=#447700>!  Assign the number of days in a months<a name='408'></font>
      <a name='409'>
      mday( 1) = 31<a name='410'>
      mday( 2) = 28<a name='411'>
      mday( 3) = 31<a name='412'>
      mday( 4) = 30<a name='413'>
      mday( 5) = 31<a name='414'>
      mday( 6) = 30<a name='415'>
      mday( 7) = 31<a name='416'>
      mday( 8) = 31<a name='417'>
      mday( 9) = 30<a name='418'>
      mday(10) = 31<a name='419'>
      mday(11) = 30<a name='420'>
      mday(12) = 31<a name='421'>
      <a name='422'>
      <font color=#447700>!  Break down old hdate into parts<a name='423'></font>
      <a name='424'>
      hrold = 0<a name='425'>
      miold = 0<a name='426'>
      scold = 0<a name='427'>
      frold = 0<a name='428'>
      olen = LEN(odate)<a name='429'>
      IF (olen.GE.11) THEN<a name='430'>
         sp = odate(11:11)<a name='431'>
      else<a name='432'>
         sp = ' '<a name='433'>
      END IF<a name='434'>
      <a name='435'>
      <font color=#447700>!  Use internal READ statements to convert the CHARACTER string<a name='436'></font>
      <font color=#447700>!  date into INTEGER components.<a name='437'></font>
   <a name='438'>
      READ(odate(1:4),  '(I4)') yrold<a name='439'>
      READ(odate(6:7),  '(I2)') moold<a name='440'>
      READ(odate(9:10), '(I2)') dyold<a name='441'>
      IF (olen.GE.13) THEN<a name='442'>
         READ(odate(12:13),'(I2)') hrold<a name='443'>
         IF (olen.GE.16) THEN<a name='444'>
            READ(odate(15:16),'(I2)') miold<a name='445'>
            IF (olen.GE.19) THEN<a name='446'>
               READ(odate(18:19),'(I2)') scold<a name='447'>
               IF (olen.GT.20) THEN<a name='448'>
                  READ(odate(21:olen),'(I2)') frold<a name='449'>
               END IF<a name='450'>
            END IF<a name='451'>
         END IF<a name='452'>
      END IF<a name='453'>
      <a name='454'>
      <font color=#447700>!  Set the number of days in February for that year.<a name='455'></font>
      <a name='456'>
      mday(2) = <A href='../../html_code/share/module_date_time.F.html#NFEB'>nfeb</A><A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NFEB_3">(yrold)<a name='457'>
      <a name='458'>
      <font color=#447700>!  Check that ODATE makes sense.<a name='459'></font>
      <a name='460'>
      opass = .TRUE.<a name='461'>
      <a name='462'>
      <font color=#447700>!  Check that the month of ODATE makes sense.<a name='463'></font>
      <a name='464'>
      IF ((moold.GT.12).or.(moold.LT.1)) THEN<a name='465'>
         WRITE(*,*) 'GETH_NEWDATE:  Month of ODATE = ', moold<a name='466'>
         opass = .FALSE.<a name='467'>
      END IF<a name='468'>
      <a name='469'>
      <font color=#447700>!  Check that the day of ODATE makes sense.<a name='470'></font>
      <a name='471'>
      IF ((dyold.GT.mday(moold)).or.(dyold.LT.1)) THEN<a name='472'>
         WRITE(*,*) 'GETH_NEWDATE:  Day of ODATE = ', dyold<a name='473'>
         opass = .FALSE.<a name='474'>
      END IF<a name='475'>
      <a name='476'>
      <font color=#447700>!  Check that the hour of ODATE makes sense.<a name='477'></font>
      <a name='478'>
      IF ((hrold.GT.23).or.(hrold.LT.0)) THEN<a name='479'>
         WRITE(*,*) 'GETH_NEWDATE:  Hour of ODATE = ', hrold<a name='480'>
         opass = .FALSE.<a name='481'>
      END IF<a name='482'>
      <a name='483'>
      <font color=#447700>!  Check that the minute of ODATE makes sense.<a name='484'></font>
      <a name='485'>
      IF ((miold.GT.59).or.(miold.LT.0)) THEN<a name='486'>
         WRITE(*,*) 'GETH_NEWDATE:  Minute of ODATE = ', miold<a name='487'>
         opass = .FALSE.<a name='488'>
      END IF<a name='489'>
      <a name='490'>
      <font color=#447700>!  Check that the second of ODATE makes sense.<a name='491'></font>
      <a name='492'>
      IF ((scold.GT.59).or.(scold.LT.0)) THEN<a name='493'>
         WRITE(*,*) 'GETH_NEWDATE:  Second of ODATE = ', scold<a name='494'>
         opass = .FALSE.<a name='495'>
      END IF<a name='496'>
      <a name='497'>
      <font color=#447700>!  Check that the fractional part  of ODATE makes sense.<a name='498'></font>
      <a name='499'>
      <a name='500'>
      IF (.not.opass) THEN<a name='501'>
         WRITE( wrf_err_message , * ) 'module_date_time: GETH_NEWDATE: Bad ODATE: ', odate(1:olen), olen<a name='502'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_232"> ( TRIM ( wrf_err_message ) )<a name='503'>
      END IF<a name='504'>
      <a name='505'>
      <font color=#447700>!  Date Checks are completed.  Continue.<a name='506'></font>
      <a name='507'>
      <a name='508'>
      <font color=#447700>!  Compute the number of days, hours, minutes, and seconds in idt<a name='509'></font>
      <a name='510'>
      IF (olen.GT.20) THEN <font color=#447700>!idt should be in fractions of seconds<a name='511'></font>
         ifrc = olen-20<a name='512'>
         ifrc = 10**ifrc<a name='513'>
         nday   = ABS(idt)/(86400*ifrc)<a name='514'>
         nhour  = MOD(ABS(idt),86400*ifrc)/(3600*ifrc)<a name='515'>
         nmin   = MOD(ABS(idt),3600*ifrc)/(60*ifrc)<a name='516'>
         nsec   = MOD(ABS(idt),60*ifrc)/(ifrc)<a name='517'>
         nfrac = MOD(ABS(idt), ifrc)<a name='518'>
      ELSE IF (olen.eq.19) THEN  <font color=#447700>!idt should be in seconds<a name='519'></font>
         ifrc = 1<a name='520'>
         nday   = ABS(idt)/86400 <font color=#447700>! Integer number of days in delta-time<a name='521'></font>
         nhour  = MOD(ABS(idt),86400)/3600<a name='522'>
         nmin   = MOD(ABS(idt),3600)/60<a name='523'>
         nsec   = MOD(ABS(idt),60)<a name='524'>
         nfrac  = 0<a name='525'>
      ELSE IF (olen.eq.16) THEN <font color=#447700>!idt should be in minutes<a name='526'></font>
         ifrc = 1<a name='527'>
         nday   = ABS(idt)/1440 <font color=#447700>! Integer number of days in delta-time<a name='528'></font>
         nhour  = MOD(ABS(idt),1440)/60<a name='529'>
         nmin   = MOD(ABS(idt),60)<a name='530'>
         nsec   = 0<a name='531'>
         nfrac  = 0<a name='532'>
      ELSE IF (olen.eq.13) THEN <font color=#447700>!idt should be in hours<a name='533'></font>
         ifrc = 1<a name='534'>
         nday   = ABS(idt)/24 <font color=#447700>! Integer number of days in delta-time<a name='535'></font>
         nhour  = MOD(ABS(idt),24)<a name='536'>
         nmin   = 0<a name='537'>
         nsec   = 0<a name='538'>
         nfrac  = 0<a name='539'>
      ELSE IF (olen.eq.10) THEN <font color=#447700>!idt should be in days<a name='540'></font>
         ifrc = 1<a name='541'>
         nday   = ABS(idt)/24 <font color=#447700>! Integer number of days in delta-time<a name='542'></font>
         nhour  = 0<a name='543'>
         nmin   = 0<a name='544'>
         nsec   = 0<a name='545'>
         nfrac  = 0<a name='546'>
      ELSE<a name='547'>
         WRITE( wrf_err_message , * ) 'module_date_time: GETH_NEWDATE: Strange length for ODATE: ',olen<a name='548'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_233"> ( TRIM ( wrf_err_message ) )<a name='549'>
      END IF<a name='550'>
      <a name='551'>
      IF (idt.GE.0) THEN<a name='552'>
      <a name='553'>
         frnew = frold + nfrac<a name='554'>
         IF (frnew.GE.ifrc) THEN<a name='555'>
            frnew = frnew - ifrc<a name='556'>
            nsec = nsec + 1<a name='557'>
         END IF<a name='558'>
      <a name='559'>
         scnew = scold + nsec<a name='560'>
         IF (scnew .GE. 60) THEN<a name='561'>
            scnew = scnew - 60<a name='562'>
            nmin  = nmin + 1<a name='563'>
         END IF<a name='564'>
      <a name='565'>
         minew = miold + nmin<a name='566'>
         IF (minew .GE. 60) THEN<a name='567'>
            minew = minew - 60<a name='568'>
            nhour  = nhour + 1<a name='569'>
         END IF<a name='570'>
      <a name='571'>
         hrnew = hrold + nhour<a name='572'>
         IF (hrnew .GE. 24) THEN<a name='573'>
            hrnew = hrnew - 24<a name='574'>
            nday  = nday + 1<a name='575'>
         END IF<a name='576'>
      <a name='577'>
         dynew = dyold<a name='578'>
         monew = moold<a name='579'>
         yrnew = yrold<a name='580'>
         DO i = 1, nday<a name='581'>
            dynew = dynew + 1<a name='582'>
            IF (dynew.GT.mday(monew)) THEN<a name='583'>
               dynew = dynew - mday(monew)<a name='584'>
               monew = monew + 1<a name='585'>
               IF (monew .GT. 12) THEN<a name='586'>
                  monew = 1<a name='587'>
                  yrnew = yrnew + 1<a name='588'>
                  <font color=#447700>! If the year changes, recompute the number of days in February<a name='589'></font>
                  mday(2) = <A href='../../html_code/share/module_date_time.F.html#NFEB'>nfeb</A><A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NFEB_4">(yrnew)<a name='590'>
               END IF<a name='591'>
            END IF<a name='592'>
         END DO<a name='593'>
      <a name='594'>
      ELSE IF (idt.LT.0) THEN<a name='595'>
      <a name='596'>
         frnew = frold - nfrac<a name='597'>
         IF (frnew .LT. 0) THEN<a name='598'>
            frnew = frnew + ifrc<a name='599'>
            nsec = nsec - 1<a name='600'>
         END IF<a name='601'>
      <a name='602'>
         scnew = scold - nsec<a name='603'>
         IF (scnew .LT. 00) THEN<a name='604'>
            scnew = scnew + 60<a name='605'>
            nmin  = nmin + 1<a name='606'>
         END IF<a name='607'>
      <a name='608'>
         minew = miold - nmin<a name='609'>
         IF (minew .LT. 00) THEN<a name='610'>
            minew = minew + 60<a name='611'>
            nhour  = nhour + 1<a name='612'>
         END IF<a name='613'>
      <a name='614'>
         hrnew = hrold - nhour<a name='615'>
         IF (hrnew .LT. 00) THEN<a name='616'>
            hrnew = hrnew + 24<a name='617'>
            nday  = nday + 1<a name='618'>
         END IF<a name='619'>
      <a name='620'>
         dynew = dyold<a name='621'>
         monew = moold<a name='622'>
         yrnew = yrold<a name='623'>
         DO i = 1, nday<a name='624'>
            dynew = dynew - 1<a name='625'>
            IF (dynew.eq.0) THEN<a name='626'>
               monew = monew - 1<a name='627'>
               IF (monew.eq.0) THEN<a name='628'>
                  monew = 12<a name='629'>
                  yrnew = yrnew - 1<a name='630'>
                  <font color=#447700>! If the year changes, recompute the number of days in February<a name='631'></font>
                  mday(2) = <A href='../../html_code/share/module_date_time.F.html#NFEB'>nfeb</A><A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NFEB_5">(yrnew)<a name='632'>
               END IF<a name='633'>
               dynew = mday(monew)<a name='634'>
            END IF<a name='635'>
         END DO<a name='636'>
      END IF<a name='637'>
      <a name='638'>
      <font color=#447700>!  Now construct the new mdate<a name='639'></font>
      <a name='640'>
      nlen = LEN(ndate)<a name='641'>
      <a name='642'>
      IF (nlen.GT.20) THEN<a name='643'>
         WRITE(ndate(1:19),19) yrnew, monew, dynew, hrnew, minew, scnew<a name='644'>
         WRITE(hfrc,'(I10)') frnew+1000000000<a name='645'>
         ndate = ndate(1:19)//'.'//hfrc(31-nlen:10)<a name='646'>
      <a name='647'>
      ELSE IF (nlen.eq.19.or.nlen.eq.20) THEN<a name='648'>
         WRITE(ndate(1:19),19) yrnew, monew, dynew, hrnew, minew, scnew<a name='649'>
      19   format(I4,'-',I2.2,'-',I2.2,'_',I2.2,':',I2.2,':',I2.2)<a name='650'>
         IF (nlen.eq.20) ndate = ndate(1:19)//'.'<a name='651'>
      <a name='652'>
      ELSE IF (nlen.eq.16) THEN<a name='653'>
         WRITE(ndate,16) yrnew, monew, dynew, hrnew, minew<a name='654'>
      16   format(I4,'-',I2.2,'-',I2.2,'_',I2.2,':',I2.2)<a name='655'>
      <a name='656'>
      ELSE IF (nlen.eq.13) THEN<a name='657'>
         WRITE(ndate,13) yrnew, monew, dynew, hrnew<a name='658'>
      13   format(I4,'-',I2.2,'-',I2.2,'_',I2.2)<a name='659'>
      <a name='660'>
      ELSE IF (nlen.eq.10) THEN<a name='661'>
         WRITE(ndate,10) yrnew, monew, dynew<a name='662'>
      10   format(I4,'-',I2.2,'-',I2.2)<a name='663'>
      <a name='664'>
      END IF<a name='665'>
      <a name='666'>
      IF (olen.GE.11) ndate(11:11) = sp<a name='667'>
   <a name='668'>
   END SUBROUTINE geth_newdate<a name='669'>
<a name='670'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='671'></font>
<a name='672'>
<A NAME='NFEB'><A href='../../html_code/share/module_date_time.F.html#NFEB' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='673'>
   <font color=#993300>FUNCTION </font><font color=#cc0000>nfeb</font> ( year ) RESULT (num_days) <A href='../../call_to/NFEB.html' TARGET='index'>5</A><a name='674'>
   <a name='675'>
      <font color=#447700>! Compute the number of days in February for the given year<a name='676'></font>
   <a name='677'>
      IMPLICIT NONE<a name='678'>
   <a name='679'>
      INTEGER :: year<a name='680'>
      INTEGER :: num_days<a name='681'>
   <a name='682'>
      num_days = 28 <font color=#447700>! By default, February has 28 days ...<a name='683'></font>
      IF (MOD(year,4).eq.0) THEN  <a name='684'>
         num_days = 29  <font color=#447700>! But every four years, it has 29 days ...<a name='685'></font>
         IF (MOD(year,100).eq.0) THEN<a name='686'>
            num_days = 28  <font color=#447700>! Except every 100 years, when it has 28 days ...<a name='687'></font>
            IF (MOD(year,400).eq.0) THEN<a name='688'>
               num_days = 29  <font color=#447700>! Except every 400 years, when it has 29 days.<a name='689'></font>
            END IF<a name='690'>
         END IF<a name='691'>
      END IF<a name='692'>
   <a name='693'>
   END FUNCTION nfeb<a name='694'>
<a name='695'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='696'></font>
<A NAME='SPLIT_DATE_CHAR'><A href='../../html_code/share/module_date_time.F.html#SPLIT_DATE_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='697'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>split_date_char</font> ( date , century_year , month , day , hour , minute , second , ten_thousandth) <A href='../../call_to/SPLIT_DATE_CHAR.html' TARGET='index'>1</A><a name='698'>
     <a name='699'>
      IMPLICIT NONE<a name='700'>
   <a name='701'>
      <font color=#447700>!  Input data.<a name='702'></font>
   <a name='703'>
      CHARACTER(LEN=24) , INTENT(IN) :: date <a name='704'>
   <a name='705'>
      <font color=#447700>!  Output data.<a name='706'></font>
   <a name='707'>
      INTEGER , INTENT(OUT) :: century_year , month , day , hour , minute , second , ten_thousandth<a name='708'>
      <a name='709'>
      READ(date,FMT='(    I4)') century_year<a name='710'>
      READ(date,FMT='( 5X,I2)') month<a name='711'>
      READ(date,FMT='( 8X,I2)') day<a name='712'>
      READ(date,FMT='(11X,I2)') hour<a name='713'>
      READ(date,FMT='(14X,I2)') minute<a name='714'>
      READ(date,FMT='(17X,I2)') second<a name='715'>
      READ(date,FMT='(20X,I4)') ten_thousandth<a name='716'>
   <a name='717'>
   END SUBROUTINE split_date_char<a name='718'>
<a name='719'>
<A NAME='INIT_MODULE_DATE_TIME'><A href='../../html_code/share/module_date_time.F.html#INIT_MODULE_DATE_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='720'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_date_time</font><a name='721'>
   END SUBROUTINE init_module_date_time<a name='722'>
<a name='723'>
END MODULE module_date_time<a name='724'>
<a name='725'>
<a name='726'>
   <font color=#447700>! TBH:  NOTE:  <a name='727'></font>
   <font color=#447700>! TBH:  Linkers whine if these routines are placed inside the module.  Not <a name='728'></font>
   <font color=#447700>! TBH:  sure if these should live here or inside an external package.  They <a name='729'></font>
   <font color=#447700>! TBH:  have dependencies both on WRF (for the format of the WRF date-time <a name='730'></font>
   <font color=#447700>! TBH:  strings) and on ESMF.  Currently, the format of the WRF date-time <a name='731'></font>
   <font color=#447700>! TBH:  strings is a slight variant on ISO 8601 (ISO is "YYYY-MM-DDThh:mm:ss" <a name='732'></font>
   <font color=#447700>! TBH:  while WRF is "YYYY-MM-DD_hh:mm:ss").  If we change the WRF format to <a name='733'></font>
   <font color=#447700>! TBH:  match the standard, then we remove the WRF dependence...  <a name='734'></font>
<a name='735'>
   <font color=#447700>! Converts WRF date-time string into an ESMF_Time object.  <a name='736'></font>
   <font color=#447700>! The format of the WRF date-time strings is a slight variant on ISO 8601: <a name='737'></font>
   <font color=#447700>! ISO is "YYYY-MM-DDThh:mm:ss" while WRF is "YYYY-MM-DD_hh:mm:ss".  <a name='738'></font>
<A NAME='WRF_ATOTIME'><A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='739'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_atotime</font> ( str, time ) <A href='../../call_to/WRF_ATOTIME.html' TARGET='index'>20</A>,<A href='../../call_from/WRF_ATOTIME.html' TARGET='index'>1</A><a name='740'>
      USE WRF_ESMF_MOD<a name='741'>
      CHARACTER (LEN=*), INTENT( IN) :: str<a name='742'>
      TYPE(ESMF_Time),   INTENT(OUT) :: time<a name='743'>
      INTEGER yr, mm, dd, h, m, s, ms<a name='744'>
      INTEGER rc, debug_level<a name='745'>
      IF ( LEN( str ) .GE. 20 ) THEN<a name='746'>
        IF ( str(20:20) .EQ. '.' ) THEN<a name='747'>
          READ(str,34) yr,mm,dd,h,m,s,ms<a name='748'>
          <font color=#447700>!  last four digits are ten-thousandths of a sec, convert to ms<a name='749'></font>
          ms=nint(real(ms)/10)<a name='750'>
        ELSE<a name='751'>
          READ(str,33) yr,mm,dd,h,m,s<a name='752'>
          ms = 0<a name='753'>
        ENDIF<a name='754'>
      ELSE<a name='755'>
        READ(str,33) yr,mm,dd,h,m,s<a name='756'>
        ms = 0<a name='757'>
      ENDIF<a name='758'>
      CALL ESMF_TimeSet( time, YY=yr, MM=mm, DD=dd, H=h, M=m, S=s, MS=ms, rc=rc )<a name='759'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_16">( ESMF_SUCCESS, rc, &amp;<a name='760'>
                            'ESMF_TimeSet() in wrf_atotime() FAILED', &amp;<a name='761'>
                            __FILE__ , &amp;<a name='762'>
                            __LINE__  )<a name='763'>
33 FORMAT (I4.4,1x,I2.2,1x,I2.2,1x,I2.2,1x,I2.2,1x,I2.2)<a name='764'>
34 FORMAT (I4.4,1x,I2.2,1x,I2.2,1x,I2.2,1x,I2.2,1x,I2.2,1x,I4.4)<a name='765'>
      RETURN<a name='766'>
   END SUBROUTINE wrf_atotime<a name='767'>
<a name='768'>
<a name='769'>
<a name='770'>
   <font color=#447700>! Converts an ESMF_Time object into a WRF date-time string.  <a name='771'></font>
   <font color=#447700>! The format of the WRF date-time strings is a slight variant on ISO 8601: <a name='772'></font>
   <font color=#447700>! ISO is "YYYY-MM-DDThh:mm:ss" while WRF is "YYYY-MM-DD_hh:mm:ss".  <a name='773'></font>
<A NAME='WRF_TIMETOA'><A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='774'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_timetoa</font> ( time, str ) <A href='../../call_to/WRF_TIMETOA.html' TARGET='index'>33</A>,<A href='../../call_from/WRF_TIMETOA.html' TARGET='index'>2</A><a name='775'>
      USE WRF_ESMF_MOD<a name='776'>
      TYPE(ESMF_Time),   INTENT( IN) :: time<a name='777'>
      CHARACTER (LEN=*), INTENT(OUT) :: str<a name='778'>
      INTEGER rc, debug_level<a name='779'>
      CHARACTER (LEN=256) :: mess<a name='780'>
      CALL ESMF_TimeGet( time, timeString=str, rc=rc )<a name='781'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_17">( ESMF_SUCCESS, rc, &amp;<a name='782'>
                            'ESMF_TimeGet() in wrf_timetoa() FAILED', &amp;<a name='783'>
                            __FILE__ , &amp;<a name='784'>
                            __LINE__  )<a name='785'>
      <font color=#447700>! change ESMF 'T' to WRF '_' -- variant of ISO 8601<a name='786'></font>
      str(11:11) = '_'<a name='787'>
      WRITE (mess,*) 'DEBUG wrf_timetoa():  returning with str = [',TRIM(str),']'<a name='788'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_236"> ( 150 , mess )<a name='789'>
      RETURN<a name='790'>
   END SUBROUTINE wrf_timetoa<a name='791'>
<a name='792'>
<a name='793'>
<a name='794'>
   <font color=#447700>! Debug routine to print key clock information.  <a name='795'></font>
   <font color=#447700>! Every printed line begins with pre_str.  <a name='796'></font>
   <font color=#447700>! If clock is invalid, also print its state using ESMF_ClockPrint().  <a name='797'></font>
   <font color=#447700>! Lines printed by ESMF_ClockPrint() currently do not begin with pre_str.  <a name='798'></font>
<A NAME='WRF_CLOCKPRINT'><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='799'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_clockprint</font> ( level, clock, pre_str ) <A href='../../call_to/WRF_CLOCKPRINT.html' TARGET='index'>32</A>,<A href='../../call_from/WRF_CLOCKPRINT.html' TARGET='index'>11</A><a name='800'>
      USE WRF_ESMF_MOD<a name='801'>
      INTEGER,           INTENT( IN) :: level<a name='802'>
      TYPE(ESMF_Clock),  INTENT( IN) :: clock<a name='803'>
      CHARACTER (LEN=*), INTENT( IN) :: pre_str<a name='804'>
      INTEGER rc<a name='805'>
      LOGICAL clockinvalid<a name='806'>
      INTEGER :: debug_level<a name='807'>
      TYPE(ESMF_Time) :: currTime, startTime, stopTime<a name='808'>
      CHARACTER (LEN=25) :: currTime_str, startTime_str, stopTime_str<a name='809'>
      CHARACTER (LEN=256) :: mess<a name='810'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#GET_WRF_DEBUG_LEVEL'>get_wrf_debug_level</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_WRF_DEBUG_LEVEL_2">( debug_level )<a name='811'>
      IF ( level .LE. debug_level ) THEN<a name='812'>
        rc=ESMF_SUCCESS<a name='813'>
        CALL ESMF_ClockValidate(clock, rc=rc)<a name='814'>
        clockinvalid = .FALSE.<a name='815'>
        IF (rc /= ESMF_SUCCESS) THEN<a name='816'>
          clockinvalid = .TRUE.<a name='817'>
        ENDIF<a name='818'>
        IF ( clockinvalid ) THEN<a name='819'>
          WRITE (mess,*) TRIM(pre_str),'  ERROR:  clock is invalid, rc = ',rc<a name='820'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_107">(TRIM(mess))<a name='821'>
        ELSE<a name='822'>
          WRITE (mess,*) TRIM(pre_str),'  clock is valid'<a name='823'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_108">(TRIM(mess))<a name='824'>
        ENDIF<a name='825'>
<a name='826'>
        CALL ESMF_ClockGet( clock, CurrTime=currTime, StartTime=startTime, &amp;<a name='827'>
                                   StopTime=stopTime, rc=rc )<a name='828'>
        CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_29">( currTime, currTime_str )<a name='829'>
        CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_30">( startTime, startTime_str )<a name='830'>
        CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_31">( stopTime, stopTime_str )<a name='831'>
        WRITE (mess,*) TRIM(pre_str),'  clock start time = ',TRIM(startTime_str)<a name='832'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_109">(TRIM(mess))<a name='833'>
        WRITE (mess,*) TRIM(pre_str),'  clock current time = ',TRIM(currTime_str)<a name='834'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_110">(TRIM(mess))<a name='835'>
        WRITE (mess,*) TRIM(pre_str),'  clock stop time = ',TRIM(stopTime_str)<a name='836'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_111">(TRIM(mess))<a name='837'>
        IF ( clockinvalid ) THEN<a name='838'>
          WRITE (mess,*) TRIM(pre_str),'   BEGIN INVALID CLOCK { '<a name='839'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_112">(TRIM(mess))<a name='840'>
          CALL ESMF_ClockPrint( clock, rc=rc )<a name='841'>
          WRITE (mess,*) TRIM(pre_str),' } END INVALID CLOCK'<a name='842'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_113">(TRIM(mess))<a name='843'>
        ENDIF<a name='844'>
      ENDIF<a name='845'>
      RETURN<a name='846'>
   END SUBROUTINE wrf_clockprint<a name='847'>
<a name='848'>
</pre></body></html>