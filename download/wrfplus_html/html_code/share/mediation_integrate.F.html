<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!<a name='2'></font>
<font color=#447700>!WRF:MEDIATION_LAYER:IO<a name='3'></font>
<font color=#447700>!<a name='4'></font>
<a name='5'>
<A NAME='MED_CALC_MODEL_TIME'><A href='../../html_code/share/mediation_integrate.F.html#MED_CALC_MODEL_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_calc_model_time</font> ( grid , config_flags ) <A href='../../call_to/MED_CALC_MODEL_TIME.html' TARGET='index'>3</A>,<A href='../../call_from/MED_CALC_MODEL_TIME.html' TARGET='index'>3</A><a name='7'>
  <font color=#447700>! Driver layer<a name='8'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_CALC_MODEL_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_110"><a name='9'>
  <font color=#447700>! Model layer<a name='10'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_CALC_MODEL_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_134"><a name='11'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/share/mediation_integrate.F.html#MED_CALC_MODEL_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_10"><a name='12'>
<a name='13'>
   IMPLICIT NONE<a name='14'>
<a name='15'>
  <font color=#447700>! Arguments<a name='16'></font>
   TYPE(domain)                               :: grid<a name='17'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='18'>
<a name='19'>
  <font color=#447700>! Local data<a name='20'></font>
   REAL                                       :: time <a name='21'>
<a name='22'>
<font color=#447700>! this is now handled by with calls to ESMF time manager<a name='23'></font>
<font color=#447700>!   time = head_grid%dt * head_grid%total_time_steps<a name='24'></font>
<font color=#447700>!   CALL calc_current_date (grid%id, time)<a name='25'></font>
<a name='26'>
<a name='27'>
END SUBROUTINE med_calc_model_time<a name='28'>
<a name='29'>
<A NAME='MED_BEFORE_SOLVE_IO'><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='30'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_before_solve_io</font> ( grid , config_flags ) <A href='../../call_to/MED_BEFORE_SOLVE_IO.html' TARGET='index'>3</A>,<A href='../../call_from/MED_BEFORE_SOLVE_IO.html' TARGET='index'>15</A><a name='31'>
  <font color=#447700>! Driver layer<a name='32'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_111"><a name='33'>
  <font color=#447700>! Model layer<a name='34'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_135"><a name='35'>
   USE WRF_ESMF_MOD<a name='36'>
<a name='37'>
   IMPLICIT NONE<a name='38'>
<a name='39'>
  <font color=#447700>! Arguments<a name='40'></font>
   TYPE(domain)                               :: grid<a name='41'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='42'>
  <font color=#447700>! Local<a name='43'></font>
   INTEGER                                    :: rc<a name='44'>
<a name='45'>
   IF( ESMF_AlarmIsRinging( grid%alarms( HISTORY_ALARM ), rc=rc ) ) THEN<a name='46'>
<font color=#447700>!    CALL med_hist_out ( grid , 0, config_flags )<a name='47'></font>
     CALL ESMF_AlarmRingerOff( grid%alarms( HISTORY_ALARM ), rc=rc )<a name='48'>
   ENDIF<a name='49'>
<a name='50'>
   IF( ESMF_AlarmIsRinging( grid%alarms( INPUTOUT_ALARM ), rc=rc ) ) THEN<a name='51'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT'>med_filter_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_FILTER_OUT_2">  ( grid , config_flags )<a name='52'>
     CALL ESMF_AlarmRingerOff( grid%alarms( INPUTOUT_ALARM ), rc=rc )<a name='53'>
   ENDIF<a name='54'>
<a name='55'>
<font color=#447700>! - AUX HISTORY OUTPUT <a name='56'></font>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST1_ALARM ), rc=rc ) ) THEN<a name='57'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_2"> ( grid , 1, config_flags )<a name='58'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXHIST1_ALARM ), rc=rc )<a name='59'>
   ENDIF<a name='60'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST2_ALARM ), rc=rc ) ) THEN<a name='61'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_3"> ( grid , 2, config_flags )<a name='62'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXHIST2_ALARM ), rc=rc )<a name='63'>
   ENDIF<a name='64'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST3_ALARM ), rc=rc ) ) THEN<a name='65'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_4"> ( grid , 3,  config_flags )<a name='66'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXHIST3_ALARM ), rc=rc )<a name='67'>
   ENDIF<a name='68'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST4_ALARM ), rc=rc ) ) THEN<a name='69'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_5"> ( grid , 4, config_flags )<a name='70'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXHIST4_ALARM ), rc=rc )<a name='71'>
   ENDIF<a name='72'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST5_ALARM ), rc=rc ) ) THEN<a name='73'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_6"> ( grid , 5, config_flags )<a name='74'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXHIST5_ALARM ), rc=rc )<a name='75'>
   ENDIF<a name='76'>
<a name='77'>
<font color=#447700>! - AUX INPUT INPUT<a name='78'></font>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXINPUT1_ALARM ), rc=rc ) ) THEN<a name='79'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT1_IN'>med_auxinput1_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT1_IN_1"> ( grid , config_flags )<a name='80'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXINPUT1_ALARM ), rc=rc )<a name='81'>
   ENDIF<a name='82'>
<font color=#447700>!  IF( ESMF_AlarmIsRinging( grid%alarms( AUXINPUT2_ALARM ), rc=rc ) ) THEN<a name='83'></font>
<font color=#447700>!    CALL med_auxinput2_in ( grid , config_flags )<a name='84'></font>
<font color=#447700>!    CALL ESMF_AlarmRingerOff( grid%alarms( AUXINPUT2_ALARM ), rc=rc )<a name='85'></font>
<font color=#447700>!  ENDIF<a name='86'></font>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXINPUT3_ALARM ), rc=rc ) ) THEN<a name='87'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3_IN'>med_auxinput3_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT3_IN_4"> ( grid , config_flags )<a name='88'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXINPUT3_ALARM ), rc=rc )<a name='89'>
   ENDIF<a name='90'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXINPUT4_ALARM ), rc=rc ) ) THEN<a name='91'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4_IN'>med_auxinput4_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT4_IN_1"> ( grid , config_flags )<a name='92'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXINPUT4_ALARM ), rc=rc )<a name='93'>
   ENDIF<a name='94'>
<a name='95'>
<font color=#447700>! this needs to be looked at again so we can get rid of the special<a name='96'></font>
<font color=#447700>! handling of AUXINPUT5 but for now...<a name='97'></font>
<a name='98'>
#ifdef WRF_CHEM<a name='99'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='100'></font>
<font color=#447700>! add for wrf_chem emiss input<a name='101'></font>
<font color=#447700>! - Get chemistry data<a name='102'></font>
  IF( config_flags%chem_opt &gt; 0 ) THEN<a name='103'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXINPUT5_ALARM ), rc=rc ) ) THEN<a name='104'>
    print *,' CALL med_read_wrf_chem_emiss '<a name='105'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS'>med_read_wrf_chem_emiss</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_EMISS_1"> ( grid , config_flags )<a name='106'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXINPUT5_ALARM ), rc=rc )<a name='107'>
    print *,' back from CALL med_read_wrf_chem_emiss '<a name='108'>
<a name='109'>
   ENDIF<a name='110'>
<font color=#447700>! end for wrf chem emiss input<a name='111'></font>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='112'></font>
  ELSE<a name='113'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXINPUT5_ALARM ), rc=rc ) ) THEN<a name='114'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT5_IN'>med_auxinput5_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT5_IN_1"> ( grid , config_flags )<a name='115'>
     CALL ESMF_AlarmRingerOff( grid%alarms( AUXINPUT5_ALARM ), rc=rc )<a name='116'>
   ENDIF<a name='117'>
  ENDIF<a name='118'>
#endif<a name='119'>
<a name='120'>
<font color=#447700>! - RESTART OUTPUT<a name='121'></font>
   IF( ESMF_AlarmIsRinging( grid%alarms( RESTART_ALARM ), rc=rc ) ) THEN<a name='122'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT'>med_restart_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_RESTART_OUT_1"> ( grid , config_flags )<a name='123'>
     CALL ESMF_AlarmRingerOff( grid%alarms( RESTART_ALARM ), rc=rc )<a name='124'>
   ENDIF<a name='125'>
<a name='126'>
<font color=#447700>! - Look for boundary data after writing out history and restart files<a name='127'></font>
   CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN'>med_latbound_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_BEFORE_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_LATBOUND_IN_1"> ( grid , config_flags )<a name='128'>
<a name='129'>
   RETURN<a name='130'>
END SUBROUTINE med_before_solve_io<a name='131'>
<a name='132'>
<A NAME='MED_AFTER_SOLVE_IO'><A href='../../html_code/share/mediation_integrate.F.html#MED_AFTER_SOLVE_IO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='133'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_after_solve_io</font> ( grid , config_flags ) <A href='../../call_to/MED_AFTER_SOLVE_IO.html' TARGET='index'>3</A>,<A href='../../call_from/MED_AFTER_SOLVE_IO.html' TARGET='index'>3</A><a name='134'>
  <font color=#447700>! Driver layer<a name='135'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AFTER_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_112"><a name='136'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AFTER_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_24"><a name='137'>
  <font color=#447700>! Model layer<a name='138'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AFTER_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_136"><a name='139'>
<a name='140'>
   IMPLICIT NONE<a name='141'>
<a name='142'>
  <font color=#447700>! Arguments<a name='143'></font>
   TYPE(domain)                               :: grid<a name='144'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='145'>
<a name='146'>
   RETURN<a name='147'>
END SUBROUTINE med_after_solve_io<a name='148'>
<a name='149'>
<A NAME='MED_NEST_INITIAL'><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='150'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_nest_initial</font> ( parent , nest , config_flags ) <A href='../../call_to/MED_NEST_INITIAL.html' TARGET='index'>4</A>,<A href='../../call_from/MED_NEST_INITIAL.html' TARGET='index'>37</A><a name='151'>
  <font color=#447700>! Driver layer<a name='152'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_113"><a name='153'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_25"><a name='154'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_17"><a name='155'>
  <font color=#447700>! Model layer<a name='156'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_137"><a name='157'>
<a name='158'>
   IMPLICIT NONE<a name='159'>
<a name='160'>
  <font color=#447700>! Arguments<a name='161'></font>
   TYPE(domain) , POINTER                     :: parent, nest<a name='162'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='163'>
   TYPE (grid_config_rec_type)                :: nest_config_flags<a name='164'>
<a name='165'>
#if (EM_CORE == 1 &amp;&amp; DA_CORE <font color=#447700>!= 1)<a name='166'></font>
  <font color=#447700>! Local<a name='167'></font>
   INTEGER                                    :: idum1 , idum2 , fid, ierr<a name='168'>
   INTEGER                                    :: i , j<a name='169'>
   INTEGER                                    :: ids , ide , jds , jde , kds , kde , &amp;<a name='170'>
                                                 ims , ime , jms , jme , kms , kme , &amp;<a name='171'>
                                                 ips , ipe , jps , jpe , kps , kpe<a name='172'>
   CHARACTER * 80         :: rstname , timestr<a name='173'>
   CHARACTER * 256        :: message<a name='174'>
   TYPE(ESMF_Time)        :: CurrTime<a name='175'>
   INTEGER                :: save_itimestep <font color=#447700>! This is a kludge, correct fix will <a name='176'></font>
                                            <font color=#447700>! involve integrating the time-step<a name='177'></font>
                                            <font color=#447700>! counting into the ESMF time manager.<a name='178'></font>
                                            <font color=#447700>! JM 20040604<a name='179'></font>
   REAL, ALLOCATABLE, DIMENSION(:,:) ::   save_acsnow             &amp;<a name='180'>
                                         ,save_acsnom             &amp;<a name='181'>
                                         ,save_cuppt              &amp;<a name='182'>
                                         ,save_rainc              &amp;<a name='183'>
                                         ,save_rainnc             &amp;<a name='184'>
                                         ,save_sfcevp             &amp;<a name='185'>
                                         ,save_sfcrunoff          &amp;<a name='186'>
                                         ,save_udrunoff<a name='187'>
<a name='188'>
   INTERFACE<a name='189'>
     SUBROUTINE med_interp_domain ( parent , nest )<a name='190'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_114"><a name='191'>
        TYPE(domain) , POINTER                 :: parent , nest<a name='192'>
     END SUBROUTINE med_interp_domain<a name='193'>
<a name='194'>
     SUBROUTINE med_init_domain_constants ( parent , nest )<a name='195'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_115"><a name='196'>
        TYPE(domain) , POINTER                 :: parent , nest<a name='197'>
     END SUBROUTINE med_init_domain_constants<a name='198'>
<a name='199'>
     SUBROUTINE med_initialdata_input_ptr( nest , config_flags )<a name='200'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_116"><a name='201'>
        USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_138"><a name='202'>
        TYPE (grid_config_rec_type) :: config_flags<a name='203'>
        TYPE(domain) , POINTER :: nest<a name='204'>
     END SUBROUTINE med_initialdata_input_ptr<a name='205'>
<a name='206'>
     SUBROUTINE med_nest_feedback ( parent , nest , config_flags )<a name='207'>
       USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_117"><a name='208'>
       USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_139"><a name='209'>
       TYPE (domain), POINTER ::  nest , parent<a name='210'>
       TYPE (grid_config_rec_type), INTENT(IN):: config_flags<a name='211'>
     END SUBROUTINE med_nest_feedback<a name='212'>
<a name='213'>
     SUBROUTINE start_domain ( grid , allowed_to_move )<a name='214'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_118"><a name='215'>
        TYPE(domain) :: grid<a name='216'>
        LOGICAL, INTENT(IN) :: allowed_to_move<a name='217'>
     END SUBROUTINE start_domain<a name='218'>
<a name='219'>
     SUBROUTINE  blend_terrain ( ter_interpolated , ter_input , &amp;<a name='220'>
                           ids , ide , jds , jde , kds , kde , &amp;<a name='221'>
                           ims , ime , jms , jme , kms , kme , &amp;<a name='222'>
                           ips , ipe , jps , jpe , kps , kpe )<a name='223'>
       INTEGER                           :: ids , ide , jds , jde , kds , kde , &amp;<a name='224'>
                                            ims , ime , jms , jme , kms , kme , &amp;<a name='225'>
                                            ips , ipe , jps , jpe , kps , kpe<a name='226'>
       REAL , DIMENSION(ims:ime,jms:jme) :: ter_interpolated<a name='227'>
       REAL , DIMENSION(ims:ime,jms:jme) :: ter_input<a name='228'>
     END SUBROUTINE blend_terrain<a name='229'>
<a name='230'>
     SUBROUTINE  store_terrain ( ter_interpolated , ter_input , &amp;<a name='231'>
                           ids , ide , jds , jde , kds , kde , &amp;<a name='232'>
                           ims , ime , jms , jme , kms , kme , &amp;<a name='233'>
                           ips , ipe , jps , jpe , kps , kpe )<a name='234'>
       INTEGER                           :: ids , ide , jds , jde , kds , kde , &amp;<a name='235'>
                                            ims , ime , jms , jme , kms , kme , &amp;<a name='236'>
                                            ips , ipe , jps , jpe , kps , kpe<a name='237'>
       REAL , DIMENSION(ims:ime,jms:jme) :: ter_interpolated<a name='238'>
       REAL , DIMENSION(ims:ime,jms:jme) :: ter_input<a name='239'>
     END SUBROUTINE store_terrain<a name='240'>
<a name='241'>
     SUBROUTINE  input_terrain_rsmas ( ter_input , xlat, xlon, dx,  &amp;<a name='242'>
                           ids , ide , jds , jde , kds , kde , &amp;<a name='243'>
                           ims , ime , jms , jme , kms , kme , &amp;<a name='244'>
                           ips , ipe , jps , jpe , kps , kpe )<a name='245'>
       INTEGER                           :: ids , ide , jds , jde , kds , kde , &amp;<a name='246'>
                                            ims , ime , jms , jme , kms , kme , &amp;<a name='247'>
                                            ips , ipe , jps , jpe , kps , kpe<a name='248'>
       REAL , DIMENSION(ims:ime,jms:jme), INTENT(INOUT) :: ter_input<a name='249'>
       REAL , DIMENSION(ims:ime,jms:jme), INTENT(IN)    :: xlat, xlon<a name='250'>
       REAL , INTENT(IN)                                :: dx<a name='251'>
     END SUBROUTINE input_terrain_rsmas<a name='252'>
<a name='253'>
   END INTERFACE<a name='254'>
<a name='255'>
   nest%first_force = .true.<a name='256'>
<a name='257'>
   IF ( .not. config_flags%restart ) THEN<a name='258'>
<a name='259'>
<font color=#447700>! initialize nest with interpolated data from the parent<a name='260'></font>
     nest%imask_nostag = 1<a name='261'>
     nest%imask_xstag = 1<a name='262'>
     nest%imask_ystag = 1<a name='263'>
     nest%imask_xystag = 1<a name='264'>
<a name='265'>
#ifdef MOVE_NESTS<a name='266'>
     parent%nest_pos = parent%ht<a name='267'>
     where ( parent%nest_pos .gt. 0. ) parent%nest_pos = parent%nest_pos + 500.  <font color=#447700>! make a cliff<a name='268'></font>
#endif<a name='269'>
<a name='270'>
     CALL <A href='../../html_code/share/mediation_interp_domain.F.html#MED_INTERP_DOMAIN'>med_interp_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_INTERP_DOMAIN_2">( parent, nest )<a name='271'>
<a name='272'>
<font color=#447700>!  De-reference dimension information stored in the grid data structure.<a name='273'></font>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_11"> (  nest ,                   &amp;<a name='274'>
                               ids, ide, jds, jde, kds, kde,    &amp;<a name='275'>
                               ims, ime, jms, jme, kms, kme,    &amp;<a name='276'>
                               ips, ipe, jps, jpe, kps, kpe    )<a name='277'>
  <a name='278'>
<font color=#447700>! initialize some other constants (and 1d arrays in z)<a name='279'></font>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#INIT_DOMAIN_CONSTANTS'>init_domain_constants</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_DOMAIN_CONSTANTS_1"> ( parent, nest )<a name='280'>
<a name='281'>
<font color=#447700>! get the nest config flags<a name='282'></font>
     CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_38"> ( nest%id , model_config_rec , nest_config_flags )<a name='283'>
<a name='284'>
     IF ( nest_config_flags%input_from_file .OR. nest_config_flags%input_from_hires ) THEN<a name='285'>
<a name='286'>
        WRITE(message,FMT='(A,I2,A)') '*** Initializing nest domain #',nest%id,&amp;<a name='287'>
                                      ' from an input file. ***'<a name='288'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_203"> ( 0 , message )<a name='289'>
<font color=#447700>! store horizontally interpolated terrain in temp location<a name='290'></font>
       CALL  <A href='../../html_code/dyn_em/nest_init_utils.F.html#STORE_TERRAIN'>store_terrain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STORE_TERRAIN_1"> ( nest%ht_fine , nest%ht , &amp;<a name='291'>
                             ids , ide , jds , jde , 1   , 1   , &amp;<a name='292'>
                             ims , ime , jms , jme , 1   , 1   , &amp;<a name='293'>
                             ips , ipe , jps , jpe , 1   , 1   )<a name='294'>
       CALL  <A href='../../html_code/dyn_em/nest_init_utils.F.html#STORE_TERRAIN'>store_terrain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STORE_TERRAIN_2"> ( nest%em_mub_fine , nest%em_mub , &amp;<a name='295'>
                             ids , ide , jds , jde , 1   , 1   , &amp;<a name='296'>
                             ims , ime , jms , jme , 1   , 1   , &amp;<a name='297'>
                             ips , ipe , jps , jpe , 1   , 1   )<a name='298'>
       CALL  <A href='../../html_code/dyn_em/nest_init_utils.F.html#STORE_TERRAIN'>store_terrain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STORE_TERRAIN_3"> ( nest%em_phb_fine , nest%em_phb , &amp;<a name='299'>
                             ids , ide , jds , jde , kds , kde , &amp;<a name='300'>
                             ims , ime , jms , jme , kms , kme , &amp;<a name='301'>
                             ips , ipe , jps , jpe , kps , kpe )<a name='302'>
<a name='303'>
       IF ( nest_config_flags%input_from_file ) THEN<a name='304'>
<font color=#447700>! read input from dataset<a name='305'></font>
          CALL <A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT_PTR'>med_initialdata_input_ptr</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_INITIALDATA_INPUT_PTR_1">( nest , nest_config_flags )<a name='306'>
       ELSE IF ( nest_config_flags%input_from_hires ) THEN<a name='307'>
<font color=#447700>! read in high res topography<a name='308'></font>
          CALL  <A href='../../html_code/dyn_em/nest_init_utils.F.html#INPUT_TERRAIN_RSMAS'>input_terrain_rsmas</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_TERRAIN_RSMAS_1"> ( nest%ht , nest%xlat, nest%xlong, nest%dx, &amp;<a name='309'>
                                      ids , ide , jds , jde , 1   , 1   , &amp;<a name='310'>
                                      ims , ime , jms , jme , 1   , 1   , &amp;<a name='311'>
                                      ips , ipe , jps , jpe , 1   , 1   )<a name='312'>
       ENDIF<a name='313'>
<a name='314'>
<font color=#447700>! blend parent and nest fields: terrain, mub, and phb.  THe mub and phb are used in start_domain.<a name='315'></font>
       CALL  <A href='../../html_code/dyn_em/nest_init_utils.F.html#BLEND_TERRAIN'>blend_terrain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BLEND_TERRAIN_1"> ( nest%ht_fine , nest%ht , &amp;<a name='316'>
                             ids , ide , jds , jde , 1   , 1   , &amp;<a name='317'>
                             ims , ime , jms , jme , 1   , 1   , &amp;<a name='318'>
                             ips , ipe , jps , jpe , 1   , 1   )<a name='319'>
       CALL  <A href='../../html_code/dyn_em/nest_init_utils.F.html#BLEND_TERRAIN'>blend_terrain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BLEND_TERRAIN_2"> ( nest%em_mub_fine , nest%em_mub , &amp;<a name='320'>
                             ids , ide , jds , jde , 1   , 1   , &amp;<a name='321'>
                             ims , ime , jms , jme , 1   , 1   , &amp;<a name='322'>
                             ips , ipe , jps , jpe , 1   , 1   )<a name='323'>
       CALL  <A href='../../html_code/dyn_em/nest_init_utils.F.html#BLEND_TERRAIN'>blend_terrain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BLEND_TERRAIN_3"> ( nest%em_phb_fine , nest%em_phb , &amp;<a name='324'>
                             ids , ide , jds , jde , kds , kde , &amp;<a name='325'>
                             ims , ime , jms , jme , kms , kme , &amp;<a name='326'>
                             ips , ipe , jps , jpe , kps , kpe )<a name='327'>
     ELSE<a name='328'>
       WRITE(message,FMT='(A,I2,A,I2,A)') '*** Initializing nest domain #',nest%id,&amp;<a name='329'>
                                     ' by horizontally interpolating parent domain #' ,parent%id, &amp;<a name='330'>
                                     '. ***'<a name='331'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_204"> ( 0 , message )<a name='332'>
     END IF<a name='333'>
<a name='334'>
<font color=#447700>! feedback, mostly for this new terrain, but it is the safe thing to do<a name='335'></font>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FEEDBACK'>med_nest_feedback</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_NEST_FEEDBACK_5"> ( parent , nest , config_flags )<a name='336'>
<a name='337'>
<font color=#447700>! set some other initial fields, fill out halos, base fields; re-do parent due<a name='338'></font>
<font color=#447700>! to new terrain elevation from feedback<a name='339'></font>
     nest%imask_nostag = 1<a name='340'>
     nest%imask_xstag = 1<a name='341'>
     nest%imask_ystag = 1<a name='342'>
     nest%imask_xystag = 1<a name='343'>
     CALL <A href='../../html_code/share/start_domain.F.html#START_DOMAIN'>start_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_DOMAIN_2"> ( nest , .TRUE. )<a name='344'>
<font color=#447700>! kludge: 20040604<a name='345'></font>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_12"> (  parent ,                   &amp;<a name='346'>
                               ids, ide, jds, jde, kds, kde,    &amp;<a name='347'>
                               ims, ime, jms, jme, kms, kme,    &amp;<a name='348'>
                               ips, ipe, jps, jpe, kps, kpe    )<a name='349'>
  <a name='350'>
     ALLOCATE( save_acsnow(ims:ime,jms:jme) )<a name='351'>
     ALLOCATE( save_acsnom(ims:ime,jms:jme) )<a name='352'>
     ALLOCATE( save_cuppt(ims:ime,jms:jme) )<a name='353'>
     ALLOCATE( save_rainc(ims:ime,jms:jme) )<a name='354'>
     ALLOCATE( save_rainnc(ims:ime,jms:jme) )<a name='355'>
     ALLOCATE( save_sfcevp(ims:ime,jms:jme) )<a name='356'>
     ALLOCATE( save_sfcrunoff(ims:ime,jms:jme) )<a name='357'>
     ALLOCATE( save_udrunoff(ims:ime,jms:jme) )<a name='358'>
     save_acsnow       = parent%acsnow<a name='359'>
     save_acsnom       = parent%acsnom<a name='360'>
     save_cuppt        = parent%cuppt<a name='361'>
     save_rainc        = parent%rainc<a name='362'>
     save_rainnc       = parent%rainnc<a name='363'>
     save_sfcevp       = parent%sfcevp<a name='364'>
     save_sfcrunoff    = parent%sfcrunoff<a name='365'>
     save_udrunoff     = parent%udrunoff<a name='366'>
     save_itimestep    = parent%itimestep<a name='367'>
     parent%imask_nostag = 1<a name='368'>
     parent%imask_xstag = 1<a name='369'>
     parent%imask_ystag = 1<a name='370'>
     parent%imask_xystag = 1<a name='371'>
     CALL <A href='../../html_code/share/start_domain.F.html#START_DOMAIN'>start_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_DOMAIN_3"> ( parent , .TRUE. )<a name='372'>
     parent%acsnow     = save_acsnow<a name='373'>
     parent%acsnom     = save_acsnom<a name='374'>
     parent%cuppt      = save_cuppt<a name='375'>
     parent%rainc      = save_rainc<a name='376'>
     parent%rainnc     = save_rainnc<a name='377'>
     parent%sfcevp     = save_sfcevp<a name='378'>
     parent%sfcrunoff  = save_sfcrunoff<a name='379'>
     parent%udrunoff   = save_udrunoff<a name='380'>
     parent%itimestep  = save_itimestep<a name='381'>
     DEALLOCATE( save_acsnow )<a name='382'>
     DEALLOCATE( save_acsnom )<a name='383'>
     DEALLOCATE( save_cuppt )<a name='384'>
     DEALLOCATE( save_rainc )<a name='385'>
     DEALLOCATE( save_rainnc )<a name='386'>
     DEALLOCATE( save_sfcevp )<a name='387'>
     DEALLOCATE( save_sfcrunoff )<a name='388'>
     DEALLOCATE( save_udrunoff )<a name='389'>
<font color=#447700>! end of kludge: 20040604<a name='390'></font>
<a name='391'>
<a name='392'>
  ELSE<a name='393'>
     CALL ESMF_ClockGet( nest%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='394'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_15"> ( CurrTime, timestr )<a name='395'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_1"> ( rstname , config_flags%rst_inname , nest%id , 2 , timestr )<a name='396'>
<a name='397'>
     WRITE(message,*)'RESTART: nest, opening ',TRIM(rstname),' for reading'<a name='398'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_71"> ( message )<a name='399'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_6"> ( fid , TRIM(rstname) , nest , config_flags , "DATASET=RESTART", ierr )<a name='400'>
     IF ( ierr .NE. 0 ) THEN<a name='401'>
       WRITE( message , '("program wrf: error opening ",A32," for reading")') TRIM(rstname)<a name='402'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_211"> ( message )<a name='403'>
     ENDIF<a name='404'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_RESTART'>input_restart</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_RESTART_1"> ( fid,   nest , config_flags , ierr )<a name='405'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_15"> ( fid , config_flags , "DATASET=RESTART" )<a name='406'>
<a name='407'>
     nest%imask_nostag = 1<a name='408'>
     nest%imask_xstag = 1<a name='409'>
     nest%imask_ystag = 1<a name='410'>
     nest%imask_xystag = 1<a name='411'>
     CALL <A href='../../html_code/share/start_domain.F.html#START_DOMAIN'>start_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_INITIAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_DOMAIN_4"> ( nest , .TRUE. )<a name='412'>
<a name='413'>
  ENDIF<a name='414'>
<a name='415'>
#endif<a name='416'>
<a name='417'>
  RETURN<a name='418'>
END SUBROUTINE med_nest_initial<a name='419'>
<a name='420'>
<A NAME='INIT_DOMAIN_CONSTANTS'><A href='../../html_code/share/mediation_integrate.F.html#INIT_DOMAIN_CONSTANTS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='421'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>init_domain_constants</font> ( parent , nest ) <A href='../../call_to/INIT_DOMAIN_CONSTANTS.html' TARGET='index'>1</A>,<A href='../../call_from/INIT_DOMAIN_CONSTANTS.html' TARGET='index'>3</A><a name='422'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#INIT_DOMAIN_CONSTANTS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_119"><a name='423'>
   IMPLICIT NONE<a name='424'>
   TYPE(domain) :: parent , nest<a name='425'>
#if (EM_CORE == 1 &amp;&amp; DA_CORE <font color=#447700>!= 1)<a name='426'></font>
   INTERFACE <a name='427'>
     SUBROUTINE med_init_domain_constants ( parent , nest )<a name='428'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#INIT_DOMAIN_CONSTANTS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_120"><a name='429'>
        TYPE(domain) ,POINTER :: parent , nest<a name='430'>
     END SUBROUTINE med_init_domain_constants<a name='431'>
   END INTERFACE <a name='432'>
   CALL <A href='../../html_code/dyn_em/nest_init_utils.F.html#INIT_DOMAIN_CONSTANTS_EM'>init_domain_constants_em</A><A href='../../html_code/share/mediation_integrate.F.html#INIT_DOMAIN_CONSTANTS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_DOMAIN_CONSTANTS_EM_1"> ( parent, nest )<a name='433'>
#endif<a name='434'>
END SUBROUTINE init_domain_constants<a name='435'>
<a name='436'>
#ifdef MOVE_NESTS<a name='437'>
<A NAME='MED_NEST_MOVE'><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='438'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_nest_move</font> ( parent, nest ) <A href='../../call_to/MED_NEST_MOVE.html' TARGET='index'>4</A>,<A href='../../call_from/MED_NEST_MOVE.html' TARGET='index'>17</A><a name='439'>
  <font color=#447700>! Driver layer<a name='440'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_121"><a name='441'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_26"><a name='442'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_140"><a name='443'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_18"><a name='444'>
   TYPE(domain) , POINTER                     :: parent, nest, grid<a name='445'>
   INTEGER dx, dy       <font color=#447700>! number of parent domain points to move<a name='446'></font>
  <font color=#447700>! Local <a name='447'></font>
   INTEGER i, j, p, parent_grid_ratio<a name='448'>
   INTEGER px, py       <font color=#447700>! number and direction of nd points to move<a name='449'></font>
   INTEGER                         :: ids , ide , jds , jde , kds , kde , &amp;<a name='450'>
                                      ims , ime , jms , jme , kms , kme , &amp;<a name='451'>
                                      ips , ipe , jps , jpe , kps , kpe<a name='452'>
   INTEGER ierr, fid<a name='453'>
<a name='454'>
#if ( EM_CORE == 1 &amp;&amp; defined(DM_PARALLEL) )<a name='455'>
   INTERFACE<a name='456'>
     SUBROUTINE med_interp_domain ( parent , nest )<a name='457'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_122"><a name='458'>
        TYPE(domain) , POINTER                 :: parent , nest<a name='459'>
     END SUBROUTINE med_interp_domain<a name='460'>
     SUBROUTINE start_domain ( grid , allowed_to_move )<a name='461'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_123"><a name='462'>
        TYPE(domain) :: grid<a name='463'>
        LOGICAL, INTENT(IN) :: allowed_to_move<a name='464'>
     END SUBROUTINE start_domain<a name='465'>
     SUBROUTINE shift_domain_em ( grid, disp_x, disp_y,  &amp;<a name='466'>
<font color=#447700>!<a name='467'></font>
# include &lt;<A href='../../html_code/include/em_dummy_args.inc.html'>em_dummy_args.inc</A>&gt;<A NAME="em_dummy_args.inc_1"><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='468'>
<font color=#447700>!<a name='469'></font>
                           )<a name='470'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_124"><a name='471'>
        USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_141"><a name='472'>
        USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_27"><a name='473'>
        IMPLICIT NONE<a name='474'>
        INTEGER disp_x, disp_y<a name='475'>
        TYPE(domain) , POINTER                 :: grid<a name='476'>
#include &lt;<A href='../../html_code/include/em_dummy_decl.inc.html'>em_dummy_decl.inc</A>&gt;<A NAME="em_dummy_decl.inc_2"><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='477'>
     END SUBROUTINE shift_domain_em<a name='478'>
     LOGICAL FUNCTION time_for_move ( parent , nest , dx , dy )<a name='479'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_125"><a name='480'>
        USE WRF_ESMF_MOD<a name='481'>
        TYPE(domain) , POINTER    :: parent , nest<a name='482'>
        INTEGER, INTENT(OUT)      :: dx , dy<a name='483'>
     END FUNCTION time_for_move<a name='484'>
   END INTERFACE<a name='485'>
<a name='486'>
#ifdef DEREF_KLUDGE<a name='487'>
<font color=#447700>! see &lt;a href="www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm"&gt;here&lt;/a&gt;<a name='488'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='489'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='490'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='491'>
#endif<a name='492'>
<a name='493'>
  <font color=#447700>! set grid pointer for code in deref_kludge (if used)<a name='494'></font>
  grid =&gt; nest<a name='495'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_3"><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='496'>
<a name='497'>
<font color=#447700>! mask should be defined in nest domain<a name='498'></font>
<a name='499'>
   check_for_move: IF ( time_for_move ( parent , nest , dx, dy ) ) THEN<a name='500'>
<a name='501'>
     IF ( dx .gt. 1 .or. dy .gt. 1 ) THEN<a name='502'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_212">( 'med_nest_move' )<a name='503'>
     ENDIF<a name='504'>
write(0,*)' moving ',grid%id,dx,dy<a name='505'>
<a name='506'>
<a name='507'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_13"> (  grid ,                   &amp;<a name='508'>
                               ids, ide, jds, jde, kds, kde,    &amp;<a name='509'>
                               ims, ime, jms, jme, kms, kme,    &amp;<a name='510'>
                               ips, ipe, jps, jpe, kps, kpe    )<a name='511'>
<a name='512'>
#ifdef RSL<a name='513'>
<font color=#447700>! tell RSL about the move; this needs to be moved into external directory<a name='514'></font>
     CALL rsl_move_nest ( parent%domdesc, nest%intermediate_grid%domdesc, dx, dy )<a name='515'>
     CALL <A href='../../html_code/frame/module_domain.F.html#ADJUST_DOMAIN_DIMS_FOR_MOVE'>adjust_domain_dims_for_move</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADJUST_DOMAIN_DIMS_FOR_MOVE_1">( nest%intermediate_grid , dx, dy )<a name='516'>
#endif<a name='517'>
<a name='518'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_14"> (  grid ,                   &amp;<a name='519'>
                               ids, ide, jds, jde, kds, kde,    &amp;<a name='520'>
                               ims, ime, jms, jme, kms, kme,    &amp;<a name='521'>
                               ips, ipe, jps, jpe, kps, kpe    )<a name='522'>
<a name='523'>
     grid =&gt; nest <a name='524'>
<a name='525'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM'>shift_domain_em</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SHIFT_DOMAIN_EM_1">( grid, dx, dy,  &amp;<a name='526'>
<font color=#447700>!<a name='527'></font>
# include &lt;<A href='../../html_code/include/em_actual_args.inc.html'>em_actual_args.inc</A>&gt;<A NAME="em_actual_args.inc_4"><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='528'>
<font color=#447700>!<a name='529'></font>
                         )<a name='530'>
<a name='531'>
     px = grid%parent_grid_ratio*dx<a name='532'>
     py = grid%parent_grid_ratio*dy<a name='533'>
<a name='534'>
     grid%i_parent_start = grid%i_parent_start + px / grid%parent_grid_ratio <a name='535'>
     CALL nl_set_i_parent_start( grid%id, grid%i_parent_start )<a name='536'>
     grid%j_parent_start = grid%j_parent_start + py / grid%parent_grid_ratio<a name='537'>
     CALL nl_set_j_parent_start( grid%id, grid%j_parent_start )<a name='538'>
<a name='539'>
     CALL <A href='../../html_code/share/mediation_interp_domain.F.html#MED_INTERP_DOMAIN'>med_interp_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_INTERP_DOMAIN_3">( parent, nest )<a name='540'>
<a name='541'>
     nest%moved = .true.<a name='542'>
<font color=#447700>! masks associated with nest will have been set by shift_domain_em above<a name='543'></font>
     CALL <A href='../../html_code/share/start_domain.F.html#START_DOMAIN'>start_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_DOMAIN_5"> ( nest , .FALSE. )<a name='544'>
     nest%moved = .false.<a name='545'>
<a name='546'>
<font color=#447700>! copy time level 2 to time level 1 in new regions of multi-time level fields<a name='547'></font>
<font color=#447700>! this should be registry generated.<a name='548'></font>
     do k = kms,kme<a name='549'>
       where ( nest%imask_xstag  .EQ. 1 ) nest%em_u_1(:,k,:)   = nest%em_u_2(:,k,:)<a name='550'>
       where ( nest%imask_ystag  .EQ. 1 ) nest%em_v_1(:,k,:)   = nest%em_v_2(:,k,:)<a name='551'>
       where ( nest%imask_nostag .EQ. 1 ) nest%em_t_1(:,k,:)   = nest%em_t_2(:,k,:)<a name='552'>
       where ( nest%imask_nostag .EQ. 1 ) nest%em_w_1(:,k,:)   = nest%em_w_2(:,k,:)<a name='553'>
       where ( nest%imask_nostag .EQ. 1 ) nest%em_ph_1(:,k,:)  = nest%em_ph_2(:,k,:)<a name='554'>
       where ( nest%imask_nostag .EQ. 1 ) nest%em_tp_1(:,k,:)  = nest%em_tp_2(:,k,:)<a name='555'>
       where ( nest%imask_nostag .EQ. 1 ) nest%em_tke_1(:,k,:) = nest%em_tke_2(:,k,:)<a name='556'>
     enddo<a name='557'>
     do p = PARAM_FIRST_SCALAR , num_moist<a name='558'>
       do k = kms,kme<a name='559'>
         where ( nest%imask_nostag .EQ. 1 ) nest%moist_1(:,k,:,p) = nest%moist_2(:,k,:,p)<a name='560'>
       enddo<a name='561'>
     enddo<a name='562'>
     do p = PARAM_FIRST_SCALAR , num_chem<a name='563'>
       do k = kms,kme<a name='564'>
         where ( nest%imask_nostag .EQ. 1 ) nest%chem_1(:,k,:,p) = nest%chem_2(:,k,:,p)<a name='565'>
       enddo<a name='566'>
     enddo<a name='567'>
     where ( nest%imask_nostag .EQ. 1 ) nest%em_mu_1(:,:)  = nest%em_mu_2(:,:)<a name='568'>
<font color=#447700>!<a name='569'></font>
<a name='570'>
   ENDIF check_for_move<a name='571'>
<a name='572'>
#endif<a name='573'>
<a name='574'>
END SUBROUTINE med_nest_move<a name='575'>
<a name='576'>
<A NAME='TIME_FOR_MOVE2'><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE2' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='577'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>time_for_move2</font> ( parent , grid , move_cd_x, move_cd_y ),<A href='../../call_from/TIME_FOR_MOVE2.html' TARGET='index'>3</A><a name='578'>
  <font color=#447700>! Driver layer<a name='579'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_126"><a name='580'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_142"><a name='581'>
   USE WRF_ESMF_MOD<a name='582'>
   IMPLICIT NONE<a name='583'>
<font color=#447700>! arguments<a name='584'></font>
   TYPE(domain) , POINTER    :: parent, grid<a name='585'>
   INTEGER, INTENT(OUT)      :: move_cd_x , move_cd_y<a name='586'>
<font color=#447700>! local<a name='587'></font>
   INTEGER  i, num_moves, rc<a name='588'>
   INTEGER  move_interval , move_id<a name='589'>
   TYPE(ESMF_Time) :: ct, st<a name='590'>
   TYPE(ESMF_TimeInterval) :: ti<a name='591'>
   CHARACTER*256 mess<a name='592'>
<a name='593'>
   time_for_move2 = .FALSE.<a name='594'>
   CALL ESMF_ClockGet( grid%domain_clock, CurrTime=ct, StartTime=st, rc=rc )<a name='595'>
   CALL nl_get_num_moves( 1, num_moves )<a name='596'>
   IF ( num_moves .GT. max_moves ) THEN<a name='597'>
     WRITE(mess,*)'time_for_moves2: num_moves (',num_moves,') .GT. max_moves (',max_moves,')'<a name='598'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_213">( TRIM(mess) )<a name='599'>
   ENDIF<a name='600'>
   DO I = 1, num_moves<a name='601'>
     CALL nl_get_move_id( i, move_id )<a name='602'>
     IF ( move_id .EQ. grid%id ) THEN<a name='603'>
       CALL nl_get_move_interval( i, move_interval )<a name='604'>
       IF ( move_interval .LT. 999999999 ) THEN<a name='605'>
         CALL ESMF_TimeIntervalSet ( ti, M=move_interval, rc=rc )<a name='606'>
         IF ( ct .GE. grid%start_time + ti ) THEN<a name='607'>
           CALL nl_get_move_cd_x ( i, move_cd_x )<a name='608'>
           CALL nl_get_move_cd_y ( i, move_cd_y )<a name='609'>
           CALL nl_set_move_interval ( i, 999999999 )<a name='610'>
           time_for_move2 = .TRUE.<a name='611'>
           EXIT<a name='612'>
         ENDIF<a name='613'>
       ENDIF<a name='614'>
     ENDIF<a name='615'>
   ENDDO<a name='616'>
   RETURN<a name='617'>
END FUNCTION time_for_move2<a name='618'>
<a name='619'>
<A NAME='TIME_FOR_MOVE'><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='620'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>time_for_move</font> ( parent , grid , move_cd_x, move_cd_y ),<A href='../../call_from/TIME_FOR_MOVE.html' TARGET='index'>7</A><a name='621'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_127"><a name='622'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_143"><a name='623'>
   USE WRF_ESMF_MOD<a name='624'>
   IMPLICIT NONE<a name='625'>
<font color=#447700>! arguments<a name='626'></font>
   TYPE(domain) , POINTER    :: parent, grid<a name='627'>
   INTEGER, INTENT(OUT)      :: move_cd_x , move_cd_y<a name='628'>
<font color=#447700>! local<a name='629'></font>
   INTEGER     :: coral_dist, kid<a name='630'>
   INTEGER     :: dw, de, ds, dn, pgr<a name='631'>
   INTEGER     :: cids, cide, cjds, cjde, ckds, ckde, &amp;<a name='632'>
                  cims, cime, cjms, cjme, ckms, ckme, &amp;<a name='633'>
                  cips, cipe, cjps, cjpe, ckps, ckpe, &amp;<a name='634'>
                  nids, nide, njds, njde, nkds, nkde, &amp;<a name='635'>
                  nims, nime, njms, njme, nkms, nkme, &amp;<a name='636'>
                  nips, nipe, njps, njpe, nkps, nkpe<a name='637'>
<font color=#447700>! interface<a name='638'></font>
   INTERFACE<a name='639'>
     LOGICAL FUNCTION time_for_move2 ( parent , nest , dx , dy )<a name='640'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_128"><a name='641'>
        USE WRF_ESMF_MOD<a name='642'>
        TYPE(domain) , POINTER    :: parent , nest<a name='643'>
        INTEGER, INTENT(OUT)      :: dx , dy<a name='644'>
     END FUNCTION time_for_move2<a name='645'>
   END INTERFACE<a name='646'>
<font color=#447700>! executable<a name='647'></font>
<font color=#447700>! <a name='648'></font>
<font color=#447700>! Simplifying assumption: domains in moving nest simulations have only <a name='649'></font>
<font color=#447700>! one parent and only one child.<a name='650'></font>
   IF   ( grid%num_nests .GT. 1 ) THEN<a name='651'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_214"> ( 'domains in moving nest simulations can have only 1 nest' )<a name='652'>
   ENDIF<a name='653'>
   kid = 1<a name='654'>
<font color=#447700>!<a name='655'></font>
<font color=#447700>! find out if this is the innermost nest (will not have kids)<a name='656'></font>
   IF   ( grid%num_nests .EQ. 0 ) THEN<a name='657'>
     <font color=#447700>! code that executes on innermost nest<a name='658'></font>
     time_for_move = time_for_move2 ( parent , grid , move_cd_x, move_cd_y )<a name='659'>
   ELSE<a name='660'>
     <font color=#447700>! code that executes on parent to see if parent needs to move<a name='661'></font>
     <font color=#447700>! get closest number of cells we'll allow nest edge to approach parent bdy<a name='662'></font>
     CALL nl_get_coral_dist ( grid%id , coral_dist )<a name='663'>
     <font color=#447700>! get dims<a name='664'></font>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_15"> (  grid%nests(kid)%ptr ,               &amp;<a name='665'>
                               nids, nide, njds, njde, nkds, nkde, &amp;<a name='666'>
                               nims, nime, njms, njme, nkms, nkme, &amp;<a name='667'>
                               nips, nipe, njps, njpe, nkps, nkpe  )<a name='668'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_16"> (  grid ,                              &amp;<a name='669'>
                               cids, cide, cjds, cjde, ckds, ckde, &amp;<a name='670'>
                               cims, cime, cjms, cjme, ckms, ckme, &amp;<a name='671'>
                               cips, cipe, cjps, cjpe, ckps, ckpe  )<a name='672'>
     CALL nl_get_parent_grid_ratio ( grid%nests(kid)%ptr%id , pgr )<a name='673'>
     <font color=#447700>! perform measurements...<a name='674'></font>
     <font color=#447700>!  from western boundary<a name='675'></font>
     dw = grid%nests(kid)%ptr%i_parent_start - 1<a name='676'>
     <font color=#447700>!  from southern boundary<a name='677'></font>
     ds = grid%nests(kid)%ptr%j_parent_start - 1<a name='678'>
     <font color=#447700>!  from eastern boundary<a name='679'></font>
     de = cide - ( grid%nests(kid)%ptr%i_parent_start + (nide-nids+1)/pgr )<a name='680'>
     <font color=#447700>!  from northern boundary<a name='681'></font>
     dn = cjde - ( grid%nests(kid)%ptr%j_parent_start + (njde-njds+1)/pgr )<a name='682'>
<a name='683'>
     <font color=#447700>! move this domain (the parent containing the moving nest)<a name='684'></font>
     <font color=#447700>! in a direction that reestablishes the distance from <a name='685'></font>
     <font color=#447700>! the boundary.<a name='686'></font>
     move_cd_x = 0<a name='687'>
     move_cd_y = 0<a name='688'>
     if ( dw .LT. coral_dist ) move_cd_x = move_cd_x - 1<a name='689'>
     if ( de .LT. coral_dist ) move_cd_x = move_cd_x + 1<a name='690'>
     if ( ds .LT. coral_dist ) move_cd_y = move_cd_y - 1<a name='691'>
     if ( dn .LT. coral_dist ) move_cd_y = move_cd_y + 1<a name='692'>
<a name='693'>
     time_for_move = ( move_cd_x .NE. 0 ) .OR. ( move_cd_y .NE. 0 )<a name='694'>
<a name='695'>
     IF ( time_for_move .AND. grid%id .EQ. 1 ) THEN<a name='696'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#TIME_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_72">( 'DANGER: Nest has moved too close to boundary of outermost domain.' )<a name='697'>
       time_for_move = .FALSE.<a name='698'>
     ENDIF <a name='699'>
<a name='700'>
   ENDIF<a name='701'>
<a name='702'>
   RETURN<a name='703'>
<a name='704'>
END FUNCTION time_for_move<a name='705'>
<a name='706'>
#endif<a name='707'>
<a name='708'>
#if ( EM_CORE == 1 &amp;&amp; defined(DM_PARALLEL) &amp;&amp; MOVE_NESTS )<a name='709'>
<a name='710'>
<A NAME='SHIFT_DOMAIN_EM'><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='711'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>shift_domain_em</font> ( grid , disp_x, disp_y, &amp; <A href='../../call_to/SHIFT_DOMAIN_EM.html' TARGET='index'>1</A>,<A href='../../call_from/SHIFT_DOMAIN_EM.html' TARGET='index'>7</A><a name='712'>
<font color=#447700>!<a name='713'></font>
# include &lt;<A href='../../html_code/include/em_dummy_args.inc.html'>em_dummy_args.inc</A>&gt;<A NAME="em_dummy_args.inc_5"><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='714'>
<font color=#447700>!<a name='715'></font>
                           )<a name='716'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_129"><a name='717'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_28"><a name='718'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_144"><a name='719'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_32"><a name='720'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_29"><a name='721'>
   IMPLICIT NONE<a name='722'>
  <font color=#447700>! Arguments<a name='723'></font>
   INTEGER disp_x, disp_y       <font color=#447700>! number of parent domain points to move<a name='724'></font>
   TYPE(domain) , POINTER                     :: grid<a name='725'>
  <font color=#447700>! Local <a name='726'></font>
   INTEGER i, j, ii<a name='727'>
   INTEGER px, py       <font color=#447700>! number and direction of nd points to move<a name='728'></font>
   INTEGER                         :: ids , ide , jds , jde , kds , kde , &amp;<a name='729'>
                                      ims , ime , jms , jme , kms , kme , &amp;<a name='730'>
                                      ips , ipe , jps , jpe , kps , kpe<a name='731'>
   TYPE (grid_config_rec_type)  :: config_flags<a name='732'>
#ifdef DEREF_KLUDGE<a name='733'>
<font color=#447700>! see &lt;a href="www2.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm"&gt;here&lt;/a&gt;<a name='734'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='735'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='736'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='737'>
#endif<a name='738'>
<a name='739'>
   <font color=#447700>!  Definitions of dummy arguments to solve<a name='740'></font>
#include &lt;<A href='../../html_code/include/em_dummy_decl.inc.html'>em_dummy_decl.inc</A>&gt;<A NAME="em_dummy_decl.inc_6"><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='741'>
<a name='742'>
#define COPY_IN<a name='743'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_7"><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='744'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_8"><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='745'>
#ifdef DM_PARALLEL<a name='746'>
#      include &lt;<A href='../../html_code/include/em_data_calls.inc.html'>em_data_calls.inc</A>&gt;<A NAME="em_data_calls.inc_9"><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='747'>
#endif<a name='748'>
<a name='749'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_39"> ( grid%id , model_config_rec , config_flags )<a name='750'>
<a name='751'>
   CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_17"> (  grid ,                   &amp;<a name='752'>
                             ids, ide, jds, jde, kds, kde,    &amp;<a name='753'>
                             ims, ime, jms, jme, kms, kme,    &amp;<a name='754'>
                             ips, ipe, jps, jpe, kps, kpe    )<a name='755'>
<a name='756'>
   px = isign(parent_grid_ratio,disp_x)<a name='757'>
   py = isign(parent_grid_ratio,disp_y)<a name='758'>
<a name='759'>
   imask_nostag = 1<a name='760'>
   imask_xstag = 1<a name='761'>
   imask_ystag = 1<a name='762'>
   imask_xystag = 1<a name='763'>
<a name='764'>
   imask_nostag(ips:min(ide-1,ipe),jps:min(jde-1,jpe)) = 0<a name='765'>
   imask_xstag(ips:ipe,jps:min(jde-1,jpe)) = 0<a name='766'>
   imask_ystag(ips:min(ide-1,ipe),jps:jpe) = 0<a name='767'>
   imask_xystag(ips:ipe,jps:jpe) = 0<a name='768'>
<a name='769'>
#if 1<a name='770'>
<a name='771'>
<font color=#447700>! shift the nest domain in x<a name='772'></font>
   do ii = 1,abs(disp_x)<a name='773'>
#include &lt;<A href='../../html_code/include/em_shift_halo_x.inc.html'>em_shift_halo_x.inc</A>&gt;<A NAME="em_shift_halo_x.inc_10"><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='774'>
   enddo<a name='775'>
<a name='776'>
<font color=#447700>! shift the nest domain in y<a name='777'></font>
   do ii = 1,abs(disp_y)<a name='778'>
#include &lt;<A href='../../html_code/include/em_shift_halo_y.inc.html'>em_shift_halo_y.inc</A>&gt;<A NAME="em_shift_halo_y.inc_11"><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='779'>
   enddo<a name='780'>
<a name='781'>
#endif<a name='782'>
<a name='783'>
#define COPY_OUT<a name='784'>
#include &lt;<A href='../../html_code/include/em_scalar_derefs.inc.html'>em_scalar_derefs.inc</A>&gt;<A NAME="em_scalar_derefs.inc_12"><A href='../../html_code/share/mediation_integrate.F.html#SHIFT_DOMAIN_EM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='785'>
<a name='786'>
END SUBROUTINE shift_domain_em<a name='787'>
#endif<a name='788'>
<a name='789'>
<A NAME='MED_NEST_FORCE'><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FORCE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='790'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_nest_force</font> ( parent , nest ) <A href='../../call_to/MED_NEST_FORCE.html' TARGET='index'>4</A>,<A href='../../call_from/MED_NEST_FORCE.html' TARGET='index'>6</A><a name='791'>
  <font color=#447700>! Driver layer<a name='792'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FORCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_130"><a name='793'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FORCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_30"><a name='794'>
  <font color=#447700>! Model layer<a name='795'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FORCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_145"><a name='796'>
  <font color=#447700>! External<a name='797'></font>
   USE WRF_ESMF_MOD<a name='798'>
<a name='799'>
   IMPLICIT NONE<a name='800'>
<a name='801'>
  <font color=#447700>! Arguments<a name='802'></font>
   TYPE(domain) , POINTER                     :: parent, nest<a name='803'>
  <font color=#447700>! Local<a name='804'></font>
   INTEGER                                    :: idum1 , idum2 , fid, rc<a name='805'>
<a name='806'>
   INTERFACE<a name='807'>
     SUBROUTINE med_force_domain ( parent , nest )<a name='808'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FORCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_131"><a name='809'>
        TYPE(domain) , POINTER                 :: parent , nest<a name='810'>
     END SUBROUTINE med_force_domain<a name='811'>
     SUBROUTINE med_interp_domain ( parent , nest )<a name='812'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FORCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_132"><a name='813'>
        TYPE(domain) , POINTER                 :: parent , nest<a name='814'>
     END SUBROUTINE med_interp_domain<a name='815'>
   END INTERFACE<a name='816'>
<a name='817'>
   IF ( .NOT. ESMF_ClockIsStopTime(nest%domain_clock ,rc=rc) ) THEN<a name='818'>
<font color=#447700>! initialize nest with interpolated data from the parent<a name='819'></font>
     nest%imask_nostag = 1<a name='820'>
     nest%imask_xstag = 1<a name='821'>
     nest%imask_ystag = 1<a name='822'>
     nest%imask_xystag = 1<a name='823'>
     CALL <A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN'>med_force_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FORCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_FORCE_DOMAIN_1">( parent, nest )<a name='824'>
   ENDIF<a name='825'>
<a name='826'>
<font color=#447700>! might also have calls here to do input from a file into the nest<a name='827'></font>
<a name='828'>
   RETURN<a name='829'>
END SUBROUTINE med_nest_force<a name='830'>
<a name='831'>
<A NAME='MED_NEST_FEEDBACK'><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FEEDBACK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='832'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_nest_feedback</font> ( parent , nest , config_flags ) <A href='../../call_to/MED_NEST_FEEDBACK.html' TARGET='index'>5</A>,<A href='../../call_from/MED_NEST_FEEDBACK.html' TARGET='index'>6</A><a name='833'>
  <font color=#447700>! Driver layer<a name='834'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FEEDBACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_133"><a name='835'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FEEDBACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_31"><a name='836'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FEEDBACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_146"><a name='837'>
  <font color=#447700>! Model layer<a name='838'></font>
  <font color=#447700>! External<a name='839'></font>
   USE WRF_ESMF_MOD<a name='840'>
   IMPLICIT NONE<a name='841'>
<a name='842'>
<a name='843'>
  <font color=#447700>! Arguments<a name='844'></font>
   TYPE(domain) , POINTER                     :: parent, nest<a name='845'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='846'>
  <font color=#447700>! Local<a name='847'></font>
   INTEGER                                    :: idum1 , idum2 , fid, rc<a name='848'>
   INTEGER                         :: ids , ide , jds , jde , kds , kde , &amp;<a name='849'>
                                      ims , ime , jms , jme , kms , kme , &amp;<a name='850'>
                                      ips , ipe , jps , jpe , kps , kpe<a name='851'>
   INTEGER i,j<a name='852'>
<a name='853'>
   INTERFACE<a name='854'>
     SUBROUTINE med_feedback_domain ( parent , nest )<a name='855'>
        USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FEEDBACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_134"><a name='856'>
        TYPE(domain) , POINTER                 :: parent , nest<a name='857'>
     END SUBROUTINE med_feedback_domain<a name='858'>
   END INTERFACE<a name='859'>
<a name='860'>
<font color=#447700>! feedback nest to the parent<a name='861'></font>
    IF ( .NOT. ESMF_ClockIsStopTime(nest%domain_clock ,rc=rc) .AND. &amp;<a name='862'>
         config_flags%feedback .NE. 0 ) THEN<a name='863'>
      CALL <A href='../../html_code/share/mediation_feedback_domain.F.html#MED_FEEDBACK_DOMAIN'>med_feedback_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FEEDBACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_FEEDBACK_DOMAIN_1">( parent, nest )<a name='864'>
#ifdef MOVE_NESTS<a name='865'>
      CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/mediation_integrate.F.html#MED_NEST_FEEDBACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_18"> (  parent ,                         &amp;<a name='866'>
                                ids, ide, jds, jde, kds, kde,    &amp;<a name='867'>
                                ims, ime, jms, jme, kms, kme,    &amp;<a name='868'>
                                ips, ipe, jps, jpe, kps, kpe    )<a name='869'>
      DO j = jps, MIN(jpe,jde-1)<a name='870'>
      DO i = ips, MIN(ipe,ide-1)<a name='871'>
        IF      ( parent%nest_pos(i,j) .EQ. 9021000. ) THEN<a name='872'>
          parent%nest_pos(i,j) = parent%ht(i,j)*1.5 + 1000.<a name='873'>
        ELSE IF ( parent%ht(i,j) .NE. 0. ) THEN<a name='874'>
          parent%nest_pos(i,j) = parent%ht(i,j) + 500.<a name='875'>
        ELSE <a name='876'>
          parent%nest_pos(i,j) = 0.<a name='877'>
        ENDIF<a name='878'>
      ENDDO<a name='879'>
      ENDDO<a name='880'>
#endif<a name='881'>
    END IF<a name='882'>
<a name='883'>
   RETURN<a name='884'>
END SUBROUTINE med_nest_feedback<a name='885'>
<a name='886'>
<A NAME='MED_LAST_SOLVE_IO'><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='887'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_last_solve_io</font> ( grid , config_flags ) <A href='../../call_to/MED_LAST_SOLVE_IO.html' TARGET='index'>6</A>,<A href='../../call_from/MED_LAST_SOLVE_IO.html' TARGET='index'>10</A><a name='888'>
  <font color=#447700>! Driver layer<a name='889'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_135"><a name='890'>
  <font color=#447700>! Model layer<a name='891'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_147"><a name='892'>
<a name='893'>
   IMPLICIT NONE<a name='894'>
<a name='895'>
  <font color=#447700>! Arguments<a name='896'></font>
   TYPE(domain)                               :: grid<a name='897'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='898'>
  <font color=#447700>! Local<a name='899'></font>
   INTEGER                                    :: rc<a name='900'>
<a name='901'>
   IF( ESMF_AlarmIsRinging( grid%alarms( HISTORY_ALARM ), rc=rc ) ) THEN<a name='902'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_7"> ( grid , 0 , config_flags )<a name='903'>
   ENDIF<a name='904'>
<a name='905'>
   IF( ESMF_AlarmIsRinging( grid%alarms( INPUTOUT_ALARM ), rc=rc ) ) THEN<a name='906'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT'>med_filter_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_FILTER_OUT_3">  ( grid , config_flags )<a name='907'>
   ENDIF<a name='908'>
<a name='909'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST1_ALARM ), rc=rc ) ) THEN<a name='910'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_8"> ( grid , 1 , config_flags )<a name='911'>
   ENDIF<a name='912'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST2_ALARM ), rc=rc ) ) THEN<a name='913'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_9"> ( grid , 2 , config_flags )<a name='914'>
   ENDIF<a name='915'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST3_ALARM ), rc=rc ) ) THEN<a name='916'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_10"> ( grid , 3 , config_flags )<a name='917'>
   ENDIF<a name='918'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST4_ALARM ), rc=rc ) ) THEN<a name='919'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_11"> ( grid , 4 , config_flags )<a name='920'>
   ENDIF<a name='921'>
   IF( ESMF_AlarmIsRinging( grid%alarms( AUXHIST5_ALARM ), rc=rc ) ) THEN<a name='922'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT'>med_hist_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_HIST_OUT_12"> ( grid , 5 , config_flags )<a name='923'>
   ENDIF<a name='924'>
<a name='925'>
<font color=#447700>! - RESTART OUTPUT<a name='926'></font>
   IF( ESMF_AlarmIsRinging( grid%alarms( RESTART_ALARM ), rc=rc ) ) THEN<a name='927'>
     CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT'>med_restart_out</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LAST_SOLVE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_RESTART_OUT_2"> ( grid , config_flags )<a name='928'>
   ENDIF<a name='929'>
<a name='930'>
   RETURN<a name='931'>
END SUBROUTINE med_last_solve_io<a name='932'>
<a name='933'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='934'></font>
<a name='935'>
<A NAME='MED_RESTART_OUT'><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='936'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_restart_out</font> ( grid , config_flags ) <A href='../../call_to/MED_RESTART_OUT.html' TARGET='index'>3</A>,<A href='../../call_from/MED_RESTART_OUT.html' TARGET='index'>14</A><a name='937'>
  <font color=#447700>! Driver layer<a name='938'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_136"><a name='939'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_19"><a name='940'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_32"><a name='941'>
  <font color=#447700>! Model layer<a name='942'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_148"><a name='943'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_4"><a name='944'>
   USE WRF_ESMF_MOD<a name='945'>
<a name='946'>
   IMPLICIT NONE<a name='947'>
<a name='948'>
  <font color=#447700>! Arguments<a name='949'></font>
   TYPE(domain)                               :: grid<a name='950'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='951'>
<a name='952'>
  <font color=#447700>! Local<a name='953'></font>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='954'>
   CHARACTER*80                           :: rstname , outname<a name='955'>
   INTEGER                                :: fid , rid<a name='956'>
   CHARACTER (LEN=256)                    :: message<a name='957'>
   INTEGER                                :: ierr<a name='958'>
   INTEGER                                :: myproc<a name='959'>
   TYPE(ESMF_Time)                        :: CurrTime<a name='960'>
   CHARACTER*80                           :: timestr<a name='961'>
<a name='962'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='963'>
     CALL <A href='../../html_code/frame/module_timing.F.html#START_TIMING'>start_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_TIMING_13"><a name='964'>
   END IF<a name='965'>
<a name='966'>
   CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='967'>
   CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_16"> ( CurrTime, timestr )<a name='968'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_2"> ( rstname , config_flags%rst_outname , grid%id , 2 , timestr )<a name='969'>
<a name='970'>
   WRITE( message , '("med_restart_out: opening ",A," for writing")' ) TRIM ( rstname )<a name='971'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_205">( 1 , message )<a name='972'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_12"> ( rid, TRIM(rstname), grid , &amp;<a name='973'>
                         config_flags , output_restart , "DATASET=RESTART", ierr )<a name='974'>
<a name='975'>
   IF ( ierr .NE. 0 ) THEN<a name='976'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>WRF_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_73">( message )<a name='977'>
   ENDIF<a name='978'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_RESTART'>output_restart</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_RESTART_1"> ( rid, grid , config_flags , ierr )<a name='979'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='980'>
     WRITE ( message , FMT = '("Writing restart for domain ",I8)' ) grid%id<a name='981'>
     CALL <A href='../../html_code/frame/module_timing.F.html#END_TIMING'>end_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="END_TIMING_13"> ( TRIM(message) )<a name='982'>
   END IF<a name='983'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_RESTART_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_16"> ( rid , config_flags , "DATASET=RESTART" )<a name='984'>
   RETURN<a name='985'>
END SUBROUTINE med_restart_out<a name='986'>
<a name='987'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='988'></font>
<a name='989'>
<A NAME='MED_HIST_OUT'><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='990'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_hist_out</font> ( grid , stream, config_flags ) <A href='../../call_to/MED_HIST_OUT.html' TARGET='index'>12</A>,<A href='../../call_from/MED_HIST_OUT.html' TARGET='index'>35</A><a name='991'>
  <font color=#447700>! Driver layer<a name='992'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_137"><a name='993'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_33"><a name='994'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_20"><a name='995'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_149"><a name='996'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_5"><a name='997'>
   USE WRF_ESMF_MOD<a name='998'>
<a name='999'>
   IMPLICIT NONE<a name='1000'>
  <font color=#447700>! Arguments<a name='1001'></font>
   TYPE(domain)                               :: grid<a name='1002'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1003'>
   INTEGER , INTENT(IN)                       :: stream<a name='1004'>
  <font color=#447700>! Local<a name='1005'></font>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1006'>
   CHARACTER*80                           :: fname, n1, n2<a name='1007'>
   INTEGER                                :: fid , rid<a name='1008'>
   CHARACTER (LEN=256)                    :: message<a name='1009'>
   INTEGER                                :: ierr<a name='1010'>
   INTEGER                                :: myproc<a name='1011'>
   TYPE(ESMF_Time)                        :: CurrTime<a name='1012'>
   CHARACTER*80                           :: timestr<a name='1013'>
<a name='1014'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='1015'>
     CALL <A href='../../html_code/frame/module_timing.F.html#START_TIMING'>start_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_TIMING_14"><a name='1016'>
   END IF<a name='1017'>
<a name='1018'>
   IF ( stream .LT. 0 .OR. stream .GT. 5 ) THEN<a name='1019'>
     WRITE(message,*)'med_hist_out: invalid history stream ',stream<a name='1020'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_215">( message )<a name='1021'>
   ENDIF<a name='1022'>
   IF (      ( stream .eq. 0 .and. grid%oid          .eq. 0 )    &amp;<a name='1023'>
        .or. ( stream .eq. 1 .and. grid%auxhist1_oid .eq. 0 )    &amp;<a name='1024'>
        .or. ( stream .eq. 2 .and. grid%auxhist2_oid .eq. 0 )    &amp;<a name='1025'>
        .or. ( stream .eq. 3 .and. grid%auxhist3_oid .eq. 0 )    &amp;<a name='1026'>
        .or. ( stream .eq. 4 .and. grid%auxhist4_oid .eq. 0 )    &amp;<a name='1027'>
        .or. ( stream .eq. 5 .and. grid%auxhist5_oid .eq. 0 )    &amp;<a name='1028'>
      ) THEN<a name='1029'>
     CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='1030'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_17"> ( CurrTime, timestr )<a name='1031'>
     SELECT CASE( stream )<a name='1032'>
       CASE ( 0 )<a name='1033'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_3"> ( fname , config_flags%history_outname , grid%id , 2 , timestr )<a name='1034'>
       CASE ( 1 )<a name='1035'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_4"> ( fname , config_flags%auxhist1_outname , grid%id , 2 , timestr )<a name='1036'>
       CASE ( 2 )<a name='1037'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_5"> ( fname , config_flags%auxhist2_outname , grid%id , 2 , timestr )<a name='1038'>
       CASE ( 3 )<a name='1039'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_6"> ( fname , config_flags%auxhist3_outname , grid%id , 2 , timestr )<a name='1040'>
       CASE ( 4 )<a name='1041'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_7"> ( fname , config_flags%auxhist4_outname , grid%id , 2 , timestr )<a name='1042'>
       CASE ( 5 )<a name='1043'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_8"> ( fname , config_flags%auxhist5_outname , grid%id , 2 , timestr )<a name='1044'>
     END SELECT<a name='1045'>
     WRITE(n2,'("DATASET=AUXHIST",I1)')stream  <font color=#447700>! may be overwritten, below, if stream is 0<a name='1046'></font>
     WRITE ( message , '("med_hist_out : opening ",A," for writing. ",I3)') TRIM ( fname ), ierr<a name='1047'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_206">( 1, message )<a name='1048'>
     SELECT CASE( stream )<a name='1049'>
       CASE ( 0 )<a name='1050'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_13"> ( grid%oid, TRIM(fname), grid ,  &amp;<a name='1051'>
                               config_flags , output_history , 'DATASET=HISTORY' , ierr )<a name='1052'>
       CASE ( 1 )<a name='1053'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_14"> ( grid%auxhist1_oid, TRIM(fname), grid ,  &amp;<a name='1054'>
                               config_flags , output_aux_hist1 , n2, ierr )<a name='1055'>
       CASE ( 2 )<a name='1056'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_15"> ( grid%auxhist2_oid, TRIM(fname), grid ,  &amp;<a name='1057'>
                               config_flags , output_aux_hist2 , n2, ierr )<a name='1058'>
       CASE ( 3 )<a name='1059'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_16"> ( grid%auxhist3_oid, TRIM(fname), grid ,  &amp;<a name='1060'>
                               config_flags , output_aux_hist3 , n2, ierr )<a name='1061'>
       CASE ( 4 )<a name='1062'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_17"> ( grid%auxhist4_oid, TRIM(fname), grid ,  &amp;<a name='1063'>
                               config_flags , output_aux_hist4 , n2, ierr )<a name='1064'>
       CASE ( 5 )<a name='1065'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_18"> ( grid%auxhist5_oid, TRIM(fname), grid ,  &amp;<a name='1066'>
                               config_flags , output_aux_hist5 , n2, ierr )<a name='1067'>
     END SELECT<a name='1068'>
     IF ( ierr .NE. 0 ) THEN<a name='1069'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_74">( message )<a name='1070'>
     ENDIF<a name='1071'>
   END IF<a name='1072'>
   SELECT CASE( stream )<a name='1073'>
     CASE ( 0 )<a name='1074'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_HISTORY'>output_history</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_HISTORY_1"> ( grid%oid, grid , config_flags , ierr )<a name='1075'>
     CASE ( 1 )<a name='1076'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_AUX_HIST1'>output_aux_hist1</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_AUX_HIST1_1"> ( grid%auxhist1_oid, grid , config_flags , ierr )<a name='1077'>
     CASE ( 2 )<a name='1078'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_AUX_HIST2'>output_aux_hist2</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_AUX_HIST2_1"> ( grid%auxhist2_oid, grid , config_flags , ierr )<a name='1079'>
     CASE ( 3 )<a name='1080'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_AUX_HIST3'>output_aux_hist3</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_AUX_HIST3_1"> ( grid%auxhist3_oid, grid , config_flags , ierr )<a name='1081'>
     CASE ( 4 )<a name='1082'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_AUX_HIST4'>output_aux_hist4</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_AUX_HIST4_1"> ( grid%auxhist4_oid, grid , config_flags , ierr )<a name='1083'>
     CASE ( 5 )<a name='1084'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_AUX_HIST5'>output_aux_hist5</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_AUX_HIST5_1"> ( grid%auxhist5_oid, grid , config_flags , ierr )<a name='1085'>
   END SELECT<a name='1086'>
<a name='1087'>
   grid%nframes(stream) = grid%nframes(stream) + 1<a name='1088'>
<a name='1089'>
   SELECT CASE( stream )<a name='1090'>
     CASE ( 0 )<a name='1091'>
       IF ( grid%nframes(stream) &gt;= config_flags%frames_per_outfile ) THEN<a name='1092'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_17"> ( grid%oid , config_flags , "DATASET=HISTORY" ) <a name='1093'>
         grid%oid = 0<a name='1094'>
         grid%nframes(stream) = 0<a name='1095'>
       ENDIF<a name='1096'>
     CASE ( 1 )<a name='1097'>
       IF ( grid%nframes(stream) &gt;= config_flags%frames_per_auxhist1 ) THEN<a name='1098'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_18"> ( grid%auxhist1_oid , config_flags , n2 ) <a name='1099'>
         grid%auxhist1_oid = 0<a name='1100'>
         grid%nframes(stream) = 0<a name='1101'>
       ENDIF<a name='1102'>
     CASE ( 2 )<a name='1103'>
       IF ( grid%nframes(stream) &gt;= config_flags%frames_per_auxhist2 ) THEN<a name='1104'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_19"> ( grid%auxhist2_oid , config_flags , n2 ) <a name='1105'>
         grid%auxhist2_oid = 0<a name='1106'>
         grid%nframes(stream) = 0<a name='1107'>
       ENDIF<a name='1108'>
     CASE ( 3 )<a name='1109'>
       IF ( grid%nframes(stream) &gt;= config_flags%frames_per_auxhist3 ) THEN<a name='1110'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_20"> ( grid%auxhist3_oid , config_flags , n2 ) <a name='1111'>
         grid%auxhist3_oid = 0<a name='1112'>
         grid%nframes(stream) = 0<a name='1113'>
       ENDIF<a name='1114'>
     CASE ( 4 )<a name='1115'>
       IF ( grid%nframes(stream) &gt;= config_flags%frames_per_auxhist4 ) THEN<a name='1116'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_21"> ( grid%auxhist4_oid , config_flags , n2 ) <a name='1117'>
         grid%auxhist4_oid = 0<a name='1118'>
         grid%nframes(stream) = 0<a name='1119'>
       ENDIF<a name='1120'>
     CASE ( 5 )<a name='1121'>
       IF ( grid%nframes(stream) &gt;= config_flags%frames_per_auxhist5 ) THEN<a name='1122'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_22"> ( grid%auxhist5_oid , config_flags , n2 ) <a name='1123'>
         grid%auxhist5_oid = 0<a name='1124'>
         grid%nframes(stream) = 0<a name='1125'>
       ENDIF<a name='1126'>
   END SELECT<a name='1127'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='1128'>
     WRITE ( message , FMT = '("Writing ",A30," for domain ",I8)' )TRIM(fname),grid%id<a name='1129'>
     CALL <A href='../../html_code/frame/module_timing.F.html#END_TIMING'>end_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_HIST_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="END_TIMING_14"> ( TRIM(message) )<a name='1130'>
   END IF<a name='1131'>
   RETURN<a name='1132'>
<a name='1133'>
   RETURN<a name='1134'>
END SUBROUTINE med_hist_out<a name='1135'>
<a name='1136'>
<A NAME='MED_AUXINPUT1_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT1_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1137'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput1_in</font> ( grid , config_flags ) <A href='../../call_to/MED_AUXINPUT1_IN.html' TARGET='index'>1</A>,<A href='../../call_from/MED_AUXINPUT1_IN.html' TARGET='index'>3</A><a name='1138'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT1_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_138"><a name='1139'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT1_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_150"><a name='1140'>
   IMPLICIT NONE<a name='1141'>
<a name='1142'>
   TYPE(domain)                               :: grid<a name='1143'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1144'>
   CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN'>med_auxinput_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT1_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT_IN_1">( grid , 1 , config_flags )<a name='1145'>
   RETURN<a name='1146'>
END SUBROUTINE med_auxinput1_in<a name='1147'>
<a name='1148'>
<A NAME='MED_AUXINPUT2_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT2_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1149'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput2_in</font> ( grid , config_flags ),<A href='../../call_from/MED_AUXINPUT2_IN.html' TARGET='index'>3</A><a name='1150'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT2_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_139"><a name='1151'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT2_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_151"><a name='1152'>
   IMPLICIT NONE<a name='1153'>
<a name='1154'>
   TYPE(domain)                               :: grid<a name='1155'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1156'>
<a name='1157'>
   CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN'>med_auxinput_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT2_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT_IN_2">( grid , 2 , config_flags )<a name='1158'>
   RETURN<a name='1159'>
END SUBROUTINE med_auxinput2_in<a name='1160'>
<a name='1161'>
<A NAME='MED_AUXINPUT2_IN4AD'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT2_IN4AD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1162'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput2_in4ad</font> ( grid , config_flags , nl_timestr ) <A href='../../call_to/MED_AUXINPUT2_IN4AD.html' TARGET='index'>6</A>,<A href='../../call_from/MED_AUXINPUT2_IN4AD.html' TARGET='index'>3</A><a name='1163'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT2_IN4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_140"><a name='1164'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT2_IN4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_152"><a name='1165'>
   IMPLICIT NONE<a name='1166'>
<a name='1167'>
   TYPE(domain)                               :: grid<a name='1168'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1169'>
   character(len=*),             INTENT(IN)   :: nl_timestr<a name='1170'>
<a name='1171'>
<font color=#447700>!  write(unit=*, fmt='(3a,i6)') 'file:', __FILE__, ', line:', __LINE__<a name='1172'></font>
<font color=#447700>!  print *, 'nl_timestr=', nl_timestr<a name='1173'></font>
   CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD'>med_auxinput4ad</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT2_IN4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT4AD_1">( grid , 2 , config_flags , nl_timestr )<a name='1174'>
   RETURN<a name='1175'>
END SUBROUTINE med_auxinput2_in4ad<a name='1176'>
<a name='1177'>
<A NAME='MED_AUXINPUT3_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1178'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput3_in</font> ( grid , config_flags ) <A href='../../call_to/MED_AUXINPUT3_IN.html' TARGET='index'>4</A>,<A href='../../call_from/MED_AUXINPUT3_IN.html' TARGET='index'>3</A><a name='1179'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_141"><a name='1180'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_153"><a name='1181'>
   IMPLICIT NONE<a name='1182'>
<a name='1183'>
   TYPE(domain)                               :: grid<a name='1184'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1185'>
   CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN'>med_auxinput_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT_IN_3">( grid , 3 , config_flags )<a name='1186'>
   RETURN<a name='1187'>
END SUBROUTINE med_auxinput3_in<a name='1188'>
<a name='1189'>
<A NAME='MED_AUXINPUT3DFI_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3DFI_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1190'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput3dfi_in</font> ( grid , config_flags ) <A href='../../call_to/MED_AUXINPUT3DFI_IN.html' TARGET='index'>1</A>,<A href='../../call_from/MED_AUXINPUT3DFI_IN.html' TARGET='index'>3</A><a name='1191'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3DFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_142"><a name='1192'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3DFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_154"><a name='1193'>
   IMPLICIT NONE<a name='1194'>
<a name='1195'>
   TYPE(domain)                               :: grid<a name='1196'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1197'>
   CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN'>med_auxinputdfi_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT3DFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUTDFI_IN_1">( grid , 3 , config_flags )<a name='1198'>
   RETURN<a name='1199'>
END SUBROUTINE med_auxinput3dfi_in<a name='1200'>
<a name='1201'>
<A NAME='MED_AUXINPUT4_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1202'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput4_in</font> ( grid , config_flags ) <A href='../../call_to/MED_AUXINPUT4_IN.html' TARGET='index'>1</A>,<A href='../../call_from/MED_AUXINPUT4_IN.html' TARGET='index'>3</A><a name='1203'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_143"><a name='1204'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_155"><a name='1205'>
   IMPLICIT NONE<a name='1206'>
<a name='1207'>
   TYPE(domain)                               :: grid<a name='1208'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1209'>
   CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN'>med_auxinput_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT_IN_4">( grid , 4 , config_flags )<a name='1210'>
   RETURN<a name='1211'>
END SUBROUTINE med_auxinput4_in<a name='1212'>
<a name='1213'>
<A NAME='MED_AUXINPUT5_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT5_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1214'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput5_in</font> ( grid , config_flags ) <A href='../../call_to/MED_AUXINPUT5_IN.html' TARGET='index'>1</A>,<A href='../../call_from/MED_AUXINPUT5_IN.html' TARGET='index'>3</A><a name='1215'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT5_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_144"><a name='1216'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT5_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_156"><a name='1217'>
   IMPLICIT NONE<a name='1218'>
<a name='1219'>
   TYPE(domain)                               :: grid<a name='1220'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1221'>
   CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN'>med_auxinput_in</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT5_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_AUXINPUT_IN_5">( grid , 5 , config_flags )<a name='1222'>
   RETURN<a name='1223'>
END SUBROUTINE med_auxinput5_in<a name='1224'>
<a name='1225'>
<A NAME='MED_AUXINPUTDFI_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1226'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinputdfi_in</font> ( grid , stream, config_flags ) <A href='../../call_to/MED_AUXINPUTDFI_IN.html' TARGET='index'>1</A>,<A href='../../call_from/MED_AUXINPUTDFI_IN.html' TARGET='index'>39</A><a name='1227'>
  <font color=#447700>! Driver layer<a name='1228'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_145"><a name='1229'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_21"><a name='1230'>
  <font color=#447700>! Model layer<a name='1231'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_157"><a name='1232'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_6"><a name='1233'>
   USE WRF_ESMF_MOD<a name='1234'>
<a name='1235'>
   IMPLICIT NONE<a name='1236'>
  <font color=#447700>! Arguments<a name='1237'></font>
   TYPE(domain)                               :: grid<a name='1238'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1239'>
   INTEGER , INTENT(IN)                       :: stream<a name='1240'>
  <font color=#447700>! Local<a name='1241'></font>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1242'>
   CHARACTER*80                           :: rstname , outname, auxname, n1, n2<a name='1243'>
   INTEGER                                :: fid , rid<a name='1244'>
   CHARACTER (LEN=256)                    :: message<a name='1245'>
   INTEGER                                :: ierr<a name='1246'>
   INTEGER                                :: myproc<a name='1247'>
   TYPE(ESMF_Time)                        :: CurrTime<a name='1248'>
   CHARACTER*80                           :: timestr<a name='1249'>
<a name='1250'>
   IF ( stream .LT. 1 .OR. stream .GT. 5 ) THEN<a name='1251'>
     WRITE(message,*)'med_auxinput_in: invalid inputory stream ',stream<a name='1252'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_216">( message )<a name='1253'>
   ENDIF<a name='1254'>
<a name='1255'>
   IF(stream == 2) THEN<a name='1256'>
     CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='1257'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_18"> ( CurrTime, timestr )<a name='1258'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_9"> ( auxname , config_flags%auxinput2_inname , grid%id , 2 , timestr )<a name='1259'>
     WRITE ( message , '("build auxname &lt;",A,"&gt; for stream:",I3,", timestr &lt;",A,"&gt;")') TRIM ( auxname ), stream, trim(timestr)<a name='1260'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_207">( 1, message )<a name='1261'>
     WRITE(n2,'("DATASET=AUXINPUT",I1)')stream<a name='1262'>
     WRITE ( message , '("med_auxinput_in : opening ",A," for reading. ",I3)') TRIM ( auxname ), ierr<a name='1263'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_208">( 1, message )<a name='1264'>
<a name='1265'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_7"> ( grid%auxinput2_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1266'>
<a name='1267'>
     IF ( ierr .NE. 0 ) THEN<a name='1268'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_75">( message )<a name='1269'>
     ENDIF<a name='1270'>
<a name='1271'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT2'>input_aux_model_input2</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT2_2"> ( grid%auxinput2_oid, grid , config_flags , ierr )<a name='1272'>
<a name='1273'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_23"> ( grid%auxinput2_oid , config_flags , n2)<a name='1274'>
<a name='1275'>
     return<a name='1276'>
   ENDIF<a name='1277'>
<a name='1278'>
   IF(stream == 3) THEN<a name='1279'>
     CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='1280'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_19"> ( CurrTime, timestr )<a name='1281'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_10"> ( auxname , config_flags%auxinput3_inname , grid%id , 2 , timestr )<a name='1282'>
     auxname = TRIM(auxname)//'_dfi'<a name='1283'>
     WRITE ( message , '("build auxname &lt;",A,"&gt; for stream:",I3,", timestr &lt;",A,"&gt;")') TRIM ( auxname ), stream, trim(timestr)<a name='1284'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_209">( 1, message )<a name='1285'>
     WRITE(n2,'("DATASET=AUXINPUT",I1)')stream<a name='1286'>
     WRITE ( message , '("med_auxinput_in : opening ",A," for reading. ",I3)') TRIM ( auxname ), ierr<a name='1287'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_210">( 1, message )<a name='1288'>
<a name='1289'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_8"> ( grid%auxinput3_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1290'>
<a name='1291'>
     IF ( ierr .NE. 0 ) THEN<a name='1292'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_76">( message )<a name='1293'>
     ENDIF<a name='1294'>
<a name='1295'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT3'>input_aux_model_input3</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT3_1"> ( grid%auxinput3_oid, grid , config_flags , ierr )<a name='1296'>
<a name='1297'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_24"> ( grid%auxinput3_oid , config_flags , n2)<a name='1298'>
<a name='1299'>
     return<a name='1300'>
   ENDIF<a name='1301'>
<a name='1302'>
   IF (      ( stream .eq. 1 .and. grid%auxinput1_oid .eq. 0 )    &amp;<a name='1303'>
        .or. ( stream .eq. 2 .and. grid%auxinput2_oid .eq. 0 )    &amp;<a name='1304'>
        .or. ( stream .eq. 3 .and. grid%auxinput3_oid .eq. 0 )    &amp;<a name='1305'>
        .or. ( stream .eq. 4 .and. grid%auxinput4_oid .eq. 0 )    &amp;<a name='1306'>
        .or. ( stream .eq. 5 .and. grid%auxinput5_oid .eq. 0 )    &amp;<a name='1307'>
      ) THEN<a name='1308'>
     CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='1309'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_20"> ( CurrTime, timestr )<a name='1310'>
     SELECT CASE( stream )<a name='1311'>
       CASE ( 1 )<a name='1312'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_11"> ( auxname , config_flags%auxinput1_inname, grid%id , 2 , timestr )<a name='1313'>
       CASE ( 2 )<a name='1314'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_12"> ( auxname , config_flags%auxinput2_inname , grid%id , 2 , timestr )<a name='1315'>
       CASE ( 3 )<a name='1316'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_13"> ( auxname , config_flags%auxinput3_inname , grid%id , 2 , timestr )<a name='1317'>
       CASE ( 4 )<a name='1318'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_14"> ( auxname , config_flags%auxinput4_inname , grid%id , 2 , timestr )<a name='1319'>
       CASE ( 5 )<a name='1320'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_15"> ( auxname , config_flags%auxinput5_inname , grid%id , 2 , timestr )<a name='1321'>
     END SELECT<a name='1322'>
     WRITE(n2,'("DATASET=AUXINPUT",I1)')stream<a name='1323'>
     WRITE ( message , '("med_auxinput_in : opening ",A," for reading. ",I3)') TRIM ( auxname ), ierr<a name='1324'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_211">( 1, message )<a name='1325'>
<a name='1326'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1327'></font>
<font color=#447700>!<a name='1328'></font>
<font color=#447700>!Open_u_dataset is called rather than open_r_dataset to allow interfaces<a name='1329'></font>
<font color=#447700>!that can do blending or masking to update an existing field. (MCEL IO does this).<a name='1330'></font>
<font color=#447700>!No effect for other interfaces; open_u_dataset is equivalent to open_r_dataset <a name='1331'></font>
<font color=#447700>!in those cases.<a name='1332'></font>
<font color=#447700>!<a name='1333'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1334'></font>
<a name='1335'>
     SELECT CASE( stream )<a name='1336'>
       CASE ( 1 )<a name='1337'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET'>open_u_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_U_DATASET_1"> ( grid%auxinput1_oid, TRIM(auxname), grid ,  &amp;<a name='1338'>
                               config_flags , input_aux_model_input1 , n2, ierr )<a name='1339'>
       CASE ( 2 )<a name='1340'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_9"> ( grid%auxinput2_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1341'>
<font color=#447700>!        CALL open_u_dataset ( grid%auxinput2_oid, TRIM(auxname), grid ,  &amp;<a name='1342'></font>
<font color=#447700>!                              config_flags , input_aux_model_input2 , n2, ierr )<a name='1343'></font>
       CASE ( 3 )<a name='1344'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_10"> ( grid%auxinput3_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1345'>
<font color=#447700>!        CALL open_u_dataset ( grid%auxinput3_oid, TRIM(auxname), grid ,  &amp;<a name='1346'></font>
<font color=#447700>!                              config_flags , input_aux_model_input3 , n2, ierr )<a name='1347'></font>
       CASE ( 4 )<a name='1348'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET'>open_u_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_U_DATASET_2"> ( grid%auxinput4_oid, TRIM(auxname), grid ,  &amp;<a name='1349'>
                               config_flags , input_aux_model_input4 , n2, ierr )<a name='1350'>
       CASE ( 5 )<a name='1351'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET'>open_u_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_U_DATASET_3"> ( grid%auxinput5_oid, TRIM(auxname), grid ,  &amp;<a name='1352'>
                               config_flags , input_aux_model_input5 , n2, ierr )<a name='1353'>
     END SELECT<a name='1354'>
     IF ( ierr .NE. 0 ) THEN<a name='1355'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_77">( message )<a name='1356'>
     ENDIF<a name='1357'>
   END IF<a name='1358'>
<a name='1359'>
<a name='1360'>
   SELECT CASE( stream )<a name='1361'>
     CASE ( 1 )<a name='1362'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT1'>input_aux_model_input1</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT1_3"> ( grid%auxinput1_oid, grid , config_flags , ierr )<a name='1363'>
     CASE ( 2 )<a name='1364'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT2'>input_aux_model_input2</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT2_3"> ( grid%auxinput2_oid, grid , config_flags , ierr )<a name='1365'>
     CASE ( 3 )<a name='1366'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT3'>input_aux_model_input3</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT3_2"> ( grid%auxinput3_oid, grid , config_flags , ierr )<a name='1367'>
     CASE ( 4 )<a name='1368'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT4'>input_aux_model_input4</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT4_1"> ( grid%auxinput4_oid, grid , config_flags , ierr )<a name='1369'>
     CASE ( 5 )<a name='1370'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT5'>input_aux_model_input5</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUTDFI_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT5_1"> ( grid%auxinput5_oid, grid , config_flags , ierr )<a name='1371'>
   END SELECT<a name='1372'>
<a name='1373'>
   RETURN<a name='1374'>
END SUBROUTINE med_auxinputdfi_in<a name='1375'>
<a name='1376'>
<A NAME='MED_AUXINPUT_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1377'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput_in</font> ( grid , stream, config_flags ) <A href='../../call_to/MED_AUXINPUT_IN.html' TARGET='index'>5</A>,<A href='../../call_from/MED_AUXINPUT_IN.html' TARGET='index'>39</A><a name='1378'>
  <font color=#447700>! Driver layer<a name='1379'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_146"><a name='1380'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_22"><a name='1381'>
  <font color=#447700>! Model layer<a name='1382'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_158"><a name='1383'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_7"><a name='1384'>
   USE WRF_ESMF_MOD<a name='1385'>
<a name='1386'>
   IMPLICIT NONE<a name='1387'>
  <font color=#447700>! Arguments<a name='1388'></font>
   TYPE(domain)                               :: grid<a name='1389'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1390'>
   INTEGER , INTENT(IN)                       :: stream<a name='1391'>
  <font color=#447700>! Local<a name='1392'></font>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1393'>
   CHARACTER*80                           :: rstname , outname, auxname, n1, n2<a name='1394'>
   INTEGER                                :: fid , rid<a name='1395'>
   CHARACTER (LEN=256)                    :: message<a name='1396'>
   INTEGER                                :: ierr<a name='1397'>
   INTEGER                                :: myproc<a name='1398'>
   TYPE(ESMF_Time)                        :: CurrTime<a name='1399'>
   CHARACTER*80                           :: timestr<a name='1400'>
<a name='1401'>
   IF ( stream .LT. 1 .OR. stream .GT. 5 ) THEN<a name='1402'>
     WRITE(message,*)'med_auxinput_in: invalid inputory stream ',stream<a name='1403'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_217">( message )<a name='1404'>
   ENDIF<a name='1405'>
<a name='1406'>
   IF(stream == 2) THEN<a name='1407'>
     CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='1408'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_21"> ( CurrTime, timestr )<a name='1409'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_16"> ( auxname , config_flags%auxinput2_inname , grid%id , 2 , timestr )<a name='1410'>
     WRITE ( message , '("build auxname &lt;",A,"&gt; for stream:",I3,", timestr &lt;",A,"&gt;")') TRIM ( auxname ), stream, trim(timestr)<a name='1411'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_212">( 1, message )<a name='1412'>
     WRITE(n2,'("DATASET=AUXINPUT",I1)')stream<a name='1413'>
     WRITE ( message , '("med_auxinput_in : opening ",A," for reading. ",I3)') TRIM ( auxname ), ierr<a name='1414'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_213">( 1, message )<a name='1415'>
<a name='1416'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_11"> ( grid%auxinput2_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1417'>
<a name='1418'>
     IF ( ierr .NE. 0 ) THEN<a name='1419'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_78">( message )<a name='1420'>
     ENDIF<a name='1421'>
<a name='1422'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT2'>input_aux_model_input2</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT2_4"> ( grid%auxinput2_oid, grid , config_flags , ierr )<a name='1423'>
<a name='1424'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_25"> ( grid%auxinput2_oid , config_flags , n2)<a name='1425'>
<a name='1426'>
     return<a name='1427'>
   ENDIF<a name='1428'>
<a name='1429'>
   IF(stream == 3) THEN<a name='1430'>
     CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='1431'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_22"> ( CurrTime, timestr )<a name='1432'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_17"> ( auxname , config_flags%auxinput3_inname , grid%id , 2 , timestr )<a name='1433'>
     WRITE ( message , '("build auxname &lt;",A,"&gt; for stream:",I3,", timestr &lt;",A,"&gt;")') TRIM ( auxname ), stream, trim(timestr)<a name='1434'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_214">( 1, message )<a name='1435'>
     WRITE(n2,'("DATASET=AUXINPUT",I1)')stream<a name='1436'>
     WRITE ( message , '("med_auxinput_in : opening ",A," for reading. ",I3)') TRIM ( auxname ), ierr<a name='1437'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_215">( 1, message )<a name='1438'>
<a name='1439'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_12"> ( grid%auxinput3_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1440'>
<a name='1441'>
     IF ( ierr .NE. 0 ) THEN<a name='1442'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_79">( message )<a name='1443'>
     ENDIF<a name='1444'>
<a name='1445'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT3'>input_aux_model_input3</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT3_3"> ( grid%auxinput3_oid, grid , config_flags , ierr )<a name='1446'>
<a name='1447'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_26"> ( grid%auxinput3_oid , config_flags , n2)<a name='1448'>
<a name='1449'>
     return<a name='1450'>
   ENDIF<a name='1451'>
<a name='1452'>
   IF (      ( stream .eq. 1 .and. grid%auxinput1_oid .eq. 0 )    &amp;<a name='1453'>
        .or. ( stream .eq. 2 .and. grid%auxinput2_oid .eq. 0 )    &amp;<a name='1454'>
        .or. ( stream .eq. 3 .and. grid%auxinput3_oid .eq. 0 )    &amp;<a name='1455'>
        .or. ( stream .eq. 4 .and. grid%auxinput4_oid .eq. 0 )    &amp;<a name='1456'>
        .or. ( stream .eq. 5 .and. grid%auxinput5_oid .eq. 0 )    &amp;<a name='1457'>
      ) THEN<a name='1458'>
     CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='1459'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_23"> ( CurrTime, timestr )<a name='1460'>
     SELECT CASE( stream )<a name='1461'>
       CASE ( 1 )<a name='1462'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_18"> ( auxname , config_flags%auxinput1_inname, grid%id , 2 , timestr )<a name='1463'>
       CASE ( 2 )<a name='1464'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_19"> ( auxname , config_flags%auxinput2_inname , grid%id , 2 , timestr )<a name='1465'>
       CASE ( 3 )<a name='1466'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_20"> ( auxname , config_flags%auxinput3_inname , grid%id , 2 , timestr )<a name='1467'>
       CASE ( 4 )<a name='1468'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_21"> ( auxname , config_flags%auxinput4_inname , grid%id , 2 , timestr )<a name='1469'>
       CASE ( 5 )<a name='1470'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_22"> ( auxname , config_flags%auxinput5_inname , grid%id , 2 , timestr )<a name='1471'>
     END SELECT<a name='1472'>
     WRITE(n2,'("DATASET=AUXINPUT",I1)')stream<a name='1473'>
     WRITE ( message , '("med_auxinput_in : opening ",A," for reading. ",I3)') TRIM ( auxname ), ierr<a name='1474'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_216">( 1, message )<a name='1475'>
<a name='1476'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1477'></font>
<font color=#447700>!<a name='1478'></font>
<font color=#447700>!Open_u_dataset is called rather than open_r_dataset to allow interfaces<a name='1479'></font>
<font color=#447700>!that can do blending or masking to update an existing field. (MCEL IO does this).<a name='1480'></font>
<font color=#447700>!No effect for other interfaces; open_u_dataset is equivalent to open_r_dataset <a name='1481'></font>
<font color=#447700>!in those cases.<a name='1482'></font>
<font color=#447700>!<a name='1483'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1484'></font>
<a name='1485'>
     SELECT CASE( stream )<a name='1486'>
       CASE ( 1 )<a name='1487'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET'>open_u_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_U_DATASET_4"> ( grid%auxinput1_oid, TRIM(auxname), grid ,  &amp;<a name='1488'>
                               config_flags , input_aux_model_input1 , n2, ierr )<a name='1489'>
       CASE ( 2 )<a name='1490'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_13"> ( grid%auxinput2_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1491'>
<font color=#447700>!        CALL open_u_dataset ( grid%auxinput2_oid, TRIM(auxname), grid ,  &amp;<a name='1492'></font>
<font color=#447700>!                              config_flags , input_aux_model_input2 , n2, ierr )<a name='1493'></font>
       CASE ( 3 )<a name='1494'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_14"> ( grid%auxinput3_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1495'>
<font color=#447700>!        CALL open_u_dataset ( grid%auxinput3_oid, TRIM(auxname), grid ,  &amp;<a name='1496'></font>
<font color=#447700>!                              config_flags , input_aux_model_input3 , n2, ierr )<a name='1497'></font>
       CASE ( 4 )<a name='1498'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET'>open_u_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_U_DATASET_5"> ( grid%auxinput4_oid, TRIM(auxname), grid ,  &amp;<a name='1499'>
                               config_flags , input_aux_model_input4 , n2, ierr )<a name='1500'>
       CASE ( 5 )<a name='1501'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET'>open_u_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_U_DATASET_6"> ( grid%auxinput5_oid, TRIM(auxname), grid ,  &amp;<a name='1502'>
                               config_flags , input_aux_model_input5 , n2, ierr )<a name='1503'>
     END SELECT<a name='1504'>
     IF ( ierr .NE. 0 ) THEN<a name='1505'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_80">( message )<a name='1506'>
     ENDIF<a name='1507'>
   END IF<a name='1508'>
<a name='1509'>
<a name='1510'>
   SELECT CASE( stream )<a name='1511'>
     CASE ( 1 )<a name='1512'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT1'>input_aux_model_input1</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT1_4"> ( grid%auxinput1_oid, grid , config_flags , ierr )<a name='1513'>
     CASE ( 2 )<a name='1514'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT2'>input_aux_model_input2</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT2_5"> ( grid%auxinput2_oid, grid , config_flags , ierr )<a name='1515'>
     CASE ( 3 )<a name='1516'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT3'>input_aux_model_input3</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT3_4"> ( grid%auxinput3_oid, grid , config_flags , ierr )<a name='1517'>
     CASE ( 4 )<a name='1518'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT4'>input_aux_model_input4</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT4_2"> ( grid%auxinput4_oid, grid , config_flags , ierr )<a name='1519'>
     CASE ( 5 )<a name='1520'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT5'>input_aux_model_input5</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT5_2"> ( grid%auxinput5_oid, grid , config_flags , ierr )<a name='1521'>
   END SELECT<a name='1522'>
<a name='1523'>
   RETURN<a name='1524'>
END SUBROUTINE med_auxinput_in<a name='1525'>
<a name='1526'>
<A NAME='MED_AUXINPUT4AD'><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1527'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_auxinput4ad</font> ( grid , stream, config_flags, nl_timestr ) <A href='../../call_to/MED_AUXINPUT4AD.html' TARGET='index'>1</A>,<A href='../../call_from/MED_AUXINPUT4AD.html' TARGET='index'>11</A><a name='1528'>
  <font color=#447700>! Driver layer<a name='1529'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_147"><a name='1530'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_23"><a name='1531'>
  <font color=#447700>! Model layer<a name='1532'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_159"><a name='1533'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_8"><a name='1534'>
   USE WRF_ESMF_MOD<a name='1535'>
<a name='1536'>
   IMPLICIT NONE<a name='1537'>
  <font color=#447700>! Arguments<a name='1538'></font>
   TYPE(domain)                               :: grid<a name='1539'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1540'>
   INTEGER , INTENT(IN)                       :: stream<a name='1541'>
   character(len=*), intent(in)               :: nl_timestr<a name='1542'>
  <font color=#447700>! Local<a name='1543'></font>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1544'>
   CHARACTER*80                           :: rstname , outname, auxname, n1, n2<a name='1545'>
   INTEGER                                :: fid , rid<a name='1546'>
   CHARACTER (LEN=256)                    :: message<a name='1547'>
   INTEGER                                :: ierr<a name='1548'>
   INTEGER                                :: myproc<a name='1549'>
   TYPE(ESMF_Time)                        :: CurrTime<a name='1550'>
   CHARACTER*80                           :: timestr<a name='1551'>
<a name='1552'>
   IF ( stream /= 2 ) THEN<a name='1553'>
     WRITE(message,*)'med_auxinput4ad: invalid inputory stream ',stream<a name='1554'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_218">( message )<a name='1555'>
   ENDIF<a name='1556'>
<a name='1557'>
     timestr = trim( nl_timestr )<a name='1558'>
     ierr = 0<a name='1559'>
<a name='1560'>
<font color=#447700>!    write(unit=*, fmt='(3a,i6)') 'file:', __FILE__, ', line:', __LINE__<a name='1561'></font>
<font color=#447700>!    print *, 'nl_timestr=', nl_timestr<a name='1562'></font>
<a name='1563'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_23"> ( auxname , config_flags%auxinput2_inname , grid%id , 2 , timestr )<a name='1564'>
     WRITE(n2,'("DATASET=AUXINPUT",I1)')stream<a name='1565'>
<a name='1566'>
<font color=#447700>!    print *, 'auxname=', auxname<a name='1567'></font>
<a name='1568'>
     WRITE ( message , '("med_auxinput_in : opening ",A," for reading. ",I3)') TRIM ( auxname ), ierr<a name='1569'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_217">( 1, message )<a name='1570'>
<a name='1571'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_15"> ( grid%auxinput2_oid, TRIM(auxname), grid , config_flags , n2, ierr )<a name='1572'>
<a name='1573'>
     IF ( ierr .NE. 0 ) THEN<a name='1574'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_81">( message )<a name='1575'>
     ENDIF<a name='1576'>
<a name='1577'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT2'>input_aux_model_input2</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT2_6"> ( grid%auxinput2_oid, grid , config_flags , ierr )<a name='1578'>
<a name='1579'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_AUXINPUT4AD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_27"> ( grid%auxinput2_oid , config_flags , n2)<a name='1580'>
<a name='1581'>
   RETURN<a name='1582'>
END SUBROUTINE med_auxinput4ad<a name='1583'>
<a name='1584'>
<A NAME='MED_FILTER_OUT'><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1585'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_filter_out</font> ( grid , config_flags ) <A href='../../call_to/MED_FILTER_OUT.html' TARGET='index'>3</A>,<A href='../../call_from/MED_FILTER_OUT.html' TARGET='index'>15</A><a name='1586'>
  <font color=#447700>! Driver layer<a name='1587'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_148"><a name='1588'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_24"><a name='1589'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_34"><a name='1590'>
  <font color=#447700>! Model layer<a name='1591'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_160"><a name='1592'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_9"><a name='1593'>
<a name='1594'>
   IMPLICIT NONE<a name='1595'>
<a name='1596'>
  <font color=#447700>! Arguments<a name='1597'></font>
   TYPE(domain)                               :: grid<a name='1598'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1599'>
<a name='1600'>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='1601'>
   CHARACTER*80                           :: rstname , outname<a name='1602'>
   INTEGER                                :: fid , rid<a name='1603'>
   CHARACTER (LEN=256)                    :: message<a name='1604'>
   INTEGER                                :: ierr<a name='1605'>
   INTEGER                                :: myproc<a name='1606'>
   TYPE(ESMF_Time)                        :: CurrTime<a name='1607'>
   CHARACTER*80                           :: timestr<a name='1608'>
<a name='1609'>
   IF ( config_flags%write_input ) THEN<a name='1610'>
<a name='1611'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='1612'>
     CALL <A href='../../html_code/frame/module_timing.F.html#START_TIMING'>start_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_TIMING_15"><a name='1613'>
   END IF<a name='1614'>
<a name='1615'>
     CALL ESMF_ClockGet( grid%domain_clock, CurrTime=CurrTime, rc=ierr )<a name='1616'>
     CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_24"> ( CurrTime, timestr )<a name='1617'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_24"> ( outname , config_flags%input_outname , grid%id , 2 , timestr )<a name='1618'>
<a name='1619'>
     WRITE ( message , '("med_filter_out 1: opening ",A," for writing. ",I3)') TRIM ( outname ), ierr<a name='1620'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_218">( 1, message )<a name='1621'>
<a name='1622'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_19"> ( fid, TRIM(outname), grid ,  &amp;<a name='1623'>
                           config_flags , output_model_input , "DATASET=INPUT", ierr )<a name='1624'>
     IF ( ierr .NE. 0 ) THEN<a name='1625'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_219">( message )<a name='1626'>
     ENDIF<a name='1627'>
<a name='1628'>
     IF ( ierr .NE. 0 ) THEN<a name='1629'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_220">( message )<a name='1630'>
     ENDIF<a name='1631'>
<a name='1632'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_MODEL_INPUT'>output_model_input</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_MODEL_INPUT_6"> ( fid, grid , config_flags , ierr )<a name='1633'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_28"> ( fid , config_flags , "DATASET=INPUT" )<a name='1634'>
<a name='1635'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='1636'>
     WRITE ( message , FMT = '("Writing filter output for domain ",I8)' ) grid%id<a name='1637'>
     CALL <A href='../../html_code/frame/module_timing.F.html#END_TIMING'>end_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_FILTER_OUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="END_TIMING_15"> ( TRIM(message) )<a name='1638'>
   END IF<a name='1639'>
   ENDIF<a name='1640'>
<a name='1641'>
   RETURN<a name='1642'>
END SUBROUTINE med_filter_out<a name='1643'>
<a name='1644'>
<A NAME='MED_LATBOUND_IN'><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1645'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_latbound_in</font> ( grid , config_flags ) <A href='../../call_to/MED_LATBOUND_IN.html' TARGET='index'>3</A>,<A href='../../call_from/MED_LATBOUND_IN.html' TARGET='index'>22</A><a name='1646'>
  <font color=#447700>! Driver layer<a name='1647'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_149"><a name='1648'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_25"><a name='1649'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_35"><a name='1650'>
  <font color=#447700>! Model layer<a name='1651'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_161"><a name='1652'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_10"><a name='1653'>
   USE WRF_ESMF_MOD<a name='1654'>
<a name='1655'>
   IMPLICIT NONE<a name='1656'>
<a name='1657'>
#include &lt;<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>&gt;<A NAME="wrf_status_codes.h_13"><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1658'>
<a name='1659'>
  <font color=#447700>! Arguments<a name='1660'></font>
   TYPE(domain)                               :: grid<a name='1661'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1662'>
<a name='1663'>
  <font color=#447700>! Local data<a name='1664'></font>
   LOGICAL, EXTERNAL                      :: wrf_dm_on_monitor<a name='1665'>
   LOGICAL                                :: lbc_opened<a name='1666'>
   INTEGER                                :: idum1 , idum2 , ierr , open_status , fid, rc<a name='1667'>
   REAL                                   :: bfrq<a name='1668'>
   CHARACTER (LEN=256)                    :: message<a name='1669'>
   CHARACTER (LEN=80)                     :: bdyname<a name='1670'>
   Type (ESMF_Time )                      :: time, btime<a name='1671'>
   Type (ESMF_Time )                      :: current_time<a name='1672'>
<a name='1673'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_14"><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1674'>
<a name='1675'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_219"> ( 1 , 'in med_latbound_in' )<a name='1676'>
<a name='1677'>
   IF ( grid%id .EQ. 1 .AND. config_flags%specified .AND. config_flags%io_form_boundary .GT. 0 ) THEN<a name='1678'>
<a name='1679'>
     IF ( ( lbc_read_time( grid%current_time ) ) .AND. &amp;<a name='1680'>
          ( grid%current_time + grid%step_time .GE. grid%stop_time ) .AND. &amp;<a name='1681'>
          ( grid%current_time .NE. grid%start_time ) ) THEN<a name='1682'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_220">( 100 , 'med_latbound_in: Skipping attempt to read lateral boundary file during last time step ' )<a name='1683'>
<a name='1684'>
     ELSE IF ( ESMF_AlarmIsRinging( grid%alarms( BOUNDARY_ALARM ), rc=rc ) ) THEN<a name='1685'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_221"> ( 1 , 'in med_latbound_in preparing to read' )<a name='1686'>
       CALL ESMF_AlarmRingerOff( grid%alarms( BOUNDARY_ALARM ), rc=rc )<a name='1687'>
       IF ( wrf_dm_on_monitor() ) CALL <A href='../../html_code/frame/module_timing.F.html#START_TIMING'>start_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_TIMING_16"><a name='1688'>
<a name='1689'>
<font color=#447700>! typically a &lt;date&gt; wouldn't be part of the bdy_inname, so just pass a dummy<a name='1690'></font>
       CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_25"> ( bdyname , config_flags%bdy_inname , grid%id , 2 , 'dummydate' )<a name='1691'>
<a name='1692'>
       CALL <A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED'>wrf_inquire_opened</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_INQUIRE_OPENED_1">(head_grid%lbc_fid , TRIM(bdyname) , open_status , ierr ) <a name='1693'>
       IF ( open_status .EQ. WRF_FILE_OPENED_FOR_READ ) THEN<a name='1694'>
         lbc_opened = .TRUE.<a name='1695'>
       ELSE<a name='1696'>
         lbc_opened = .FALSE.<a name='1697'>
       ENDIF<a name='1698'>
       CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_114"> ( lbc_opened , LWORDSIZE )<a name='1699'>
       IF ( .NOT. lbc_opened ) THEN<a name='1700'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_12"> ( bdyname , 'wrfbdy' , grid%id , 2 )<a name='1701'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_16"> ( head_grid%lbc_fid, TRIM(bdyname) , grid , config_flags , "DATASET=BOUNDARY", ierr )<a name='1702'>
          IF ( ierr .NE. 0 ) THEN<a name='1703'>
            WRITE( message, * ) 'med_latbound_in: error opening ',TRIM(bdyname), ' for reading. IERR = ',ierr<a name='1704'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_221">( message )<a name='1705'>
          ENDIF<a name='1706'>
       ELSE<a name='1707'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_222">( 100 , bdyname // 'already opened' )<a name='1708'>
       ENDIF<a name='1709'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_223">( 100 , 'med_latbound_in: calling input_boundary ' )<a name='1710'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_BOUNDARY'>input_boundary</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_BOUNDARY_1"> ( grid%lbc_fid, grid , config_flags , ierr )<a name='1711'>
<a name='1712'>
       CALL ESMF_ClockGet( grid%domain_clock, CurrTime=current_time, rc=rc)<a name='1713'>
       DO WHILE (current_time .GE. grid%next_bdy_time )         <font color=#447700>! next_bdy_time is set by input_boundary from bdy file<a name='1714'></font>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_224">( 100 , 'med_latbound_in: calling input_boundary ' )<a name='1715'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_BOUNDARY'>input_boundary</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_BOUNDARY_2"> ( grid%lbc_fid, grid , config_flags , ierr )<a name='1716'>
       ENDDO<a name='1717'>
       CALL ESMF_AlarmSet( grid%alarms( BOUNDARY_ALARM ), RingTime=grid%next_bdy_time, rc=rc )<a name='1718'>
<a name='1719'>
       IF ( ierr .NE. 0 .and. ierr .NE. WRF_WARN_NETCDF ) THEN<a name='1720'>
         WRITE( message, * ) 'med_latbound_in: error reading ',TRIM(bdyname), ' IERR = ',ierr<a name='1721'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_222">( message )<a name='1722'>
       ENDIF<a name='1723'>
       IF ( grid%current_time .EQ. grid%this_bdy_time ) grid%dtbc = 0.<a name='1724'>
  <a name='1725'>
       IF ( wrf_dm_on_monitor() ) THEN<a name='1726'>
         WRITE ( message , FMT = '("processing lateral boundary for domain ",I8)' ) grid%id<a name='1727'>
         CALL <A href='../../html_code/frame/module_timing.F.html#END_TIMING'>end_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_LATBOUND_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="END_TIMING_16"> ( TRIM(message) )<a name='1728'>
       ENDIF<a name='1729'>
<a name='1730'>
<font color=#447700>!#if 0<a name='1731'></font>
     ENDIF<a name='1732'>
<font color=#447700>!#endif<a name='1733'></font>
   ENDIF<a name='1734'>
   RETURN<a name='1735'>
END SUBROUTINE med_latbound_in<a name='1736'>
<a name='1737'>
<A NAME='MED_SETUP_STEP'><A href='../../html_code/share/mediation_integrate.F.html#MED_SETUP_STEP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1738'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_setup_step</font> ( grid , config_flags ) <A href='../../call_to/MED_SETUP_STEP.html' TARGET='index'>4</A>,<A href='../../call_from/MED_SETUP_STEP.html' TARGET='index'>3</A><a name='1739'>
  <font color=#447700>! Driver layer<a name='1740'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_SETUP_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_150"><a name='1741'>
  <font color=#447700>! Model layer<a name='1742'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_SETUP_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_162"><a name='1743'>
<a name='1744'>
   IMPLICIT NONE<a name='1745'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1746'></font>
<font color=#447700>!<a name='1747'></font>
<font color=#447700>!The driver layer routine integrate() calls this mediation layer routine<a name='1748'></font>
<font color=#447700>!prior to initiating a time step on the domain specified by the argument<a name='1749'></font>
<font color=#447700>!grid.  This provides the model-layer contributor an opportunity to make<a name='1750'></font>
<font color=#447700>!any pre-time-step initializations that pertain to a particular model<a name='1751'></font>
<font color=#447700>!domain.  In WRF, this routine is used to call<a name='1752'></font>
<font color=#447700>!set_scalar_indices_from_config for the specified domain.<a name='1753'></font>
<font color=#447700>!<a name='1754'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1755'></font>
<a name='1756'>
  <font color=#447700>! Arguments<a name='1757'></font>
   TYPE(domain)                               :: grid<a name='1758'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1759'>
  <font color=#447700>! Local<a name='1760'></font>
   INTEGER                                    :: idum1 , idum2<a name='1761'>
<a name='1762'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG'>set_scalar_indices_from_config</A><A href='../../html_code/share/mediation_integrate.F.html#MED_SETUP_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_SCALAR_INDICES_FROM_CONFIG_20"> ( grid%id , idum1 , idum2 )<a name='1763'>
<a name='1764'>
   RETURN<a name='1765'>
<a name='1766'>
END SUBROUTINE med_setup_step<a name='1767'>
 <a name='1768'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='1769'></font>
<a name='1770'>
<A NAME='MED_READ_WRF_CHEM_EMISS'><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1771'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_read_wrf_chem_emiss</font> ( grid , config_flags ) <A href='../../call_to/MED_READ_WRF_CHEM_EMISS.html' TARGET='index'>1</A>,<A href='../../call_from/MED_READ_WRF_CHEM_EMISS.html' TARGET='index'>24</A><a name='1772'>
  <font color=#447700>! Driver layer<a name='1773'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_151"><a name='1774'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_26"><a name='1775'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_36"><a name='1776'>
  <font color=#447700>! Model layer<a name='1777'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_163"><a name='1778'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_11"><a name='1779'>
#ifdef DM_PARALLEL<a name='1780'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_33"><a name='1781'>
#endif<a name='1782'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_11"><a name='1783'>
   USE WRF_ESMF_Mod<a name='1784'>
<a name='1785'>
   IMPLICIT NONE<a name='1786'>
<a name='1787'>
  <font color=#447700>! Arguments<a name='1788'></font>
   TYPE(domain)                               :: grid<a name='1789'>
<a name='1790'>
<font color=#447700>!  TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1791'></font>
   TYPE (grid_config_rec_type)                :: config_flags<a name='1792'>
   Type (ESMF_Time )                          :: start_time, stop_time, current_time<a name='1793'>
   TYPE(ESMF_TimeInterval)                    :: time_interval<a name='1794'>
<a name='1795'>
  <font color=#447700>! Local data<a name='1796'></font>
   LOGICAL, EXTERNAL                      :: wrf_dm_on_monitor<a name='1797'>
<a name='1798'>
   INTEGER                                :: ierr, efid<a name='1799'>
   REAL                                   :: time, tupdate<a name='1800'>
   real, allocatable :: dumc0(:,:,:)<a name='1801'>
   CHARACTER (LEN=256)                    :: message, current_date_char, date_string<a name='1802'>
   CHARACTER (LEN=80)                     :: inpname<a name='1803'>
<a name='1804'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_15"><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1805'>
<a name='1806'>
     CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_40"> ( grid%id , model_config_rec , config_flags )<a name='1807'>
<a name='1808'>
    IF ( grid%id .EQ. 1 ) THEN<a name='1809'>
<a name='1810'>
      CALL ESMF_ClockGet( grid%domain_clock, CurrTime=grid%current_time, rc=ierr )<a name='1811'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_25"> ( grid%current_time, current_date_char )<a name='1812'>
<a name='1813'>
      time = float(grid%itimestep) * grid%dt<a name='1814'>
      tupdate = mod( time, (12. * 3600.) )<a name='1815'>
      IF( grid%current_time + grid%step_time .GE. grid%stop_time .AND.                  &amp;<a name='1816'>
          grid%auxinput5_oid .NE. 0 ) THEN<a name='1817'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_29"> ( grid%auxinput5_oid , config_flags , "DATASET=AUXINPUT5" )<a name='1818'>
        tupdate = 1.<a name='1819'>
      ENDIF<a name='1820'>
<a name='1821'>
       print *,' EMISSIONS UPDATE TIME ',time,TRIM(current_date_char(12:13))<a name='1822'>
       print *,tupdate<a name='1823'>
<a name='1824'>
<a name='1825'>
      IF ( tupdate .EQ. 0. .AND.  current_date_char(12:13) .EQ. '00' ) THEN<a name='1826'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_13"> ( inpname , 'wrfchemi_00z' , grid%id , 2 )<a name='1827'>
         WRITE(message,*)'mediation_integrate: med_read_wrf_chem_emissions: Open file ',TRIM(inpname)<a name='1828'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_82">( TRIM(message) )<a name='1829'>
<a name='1830'>
        if( grid%auxinput5_oid .NE. 0 ) then<a name='1831'>
          CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_30"> ( grid%auxinput5_oid , config_flags , "DATASET=AUXINPUT5" )<a name='1832'>
        endif<a name='1833'>
<a name='1834'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_17"> ( grid%auxinput5_oid, TRIM(inpname) , grid , config_flags, &amp;<a name='1835'>
                              "DATASET=AUXINPUT5", ierr )<a name='1836'>
        IF ( ierr .NE. 0 ) THEN<a name='1837'>
           WRITE( message , * ) 'med_read_wrf_chem_emissions: error opening ', TRIM( inpname )<a name='1838'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_223">( TRIM( message ) )<a name='1839'>
        ENDIF<a name='1840'>
      ELSE IF ( tupdate .EQ. 0. .AND. current_date_char(12:13) .EQ. '12' ) THEN<a name='1841'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_14"> ( inpname , 'wrfchemi_12z' , grid%id , 2 )<a name='1842'>
         WRITE(message,*)'mediation_integrate: med_read_wrf_chem_emissions: Open file ',TRIM(inpname)<a name='1843'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_83">( TRIM(message) )<a name='1844'>
<a name='1845'>
        if( grid%auxinput5_oid .NE. 0 ) then<a name='1846'>
          CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_31"> ( grid%auxinput5_oid , config_flags , "DATASET=AUXINPUT5" )<a name='1847'>
        endif<a name='1848'>
<a name='1849'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_18"> ( grid%auxinput5_oid, TRIM(inpname) , grid , config_flags, &amp;<a name='1850'>
                              "DATASET=AUXINPUT5", ierr )<a name='1851'>
        IF ( ierr .NE. 0 ) THEN<a name='1852'>
           WRITE( message , * ) 'med_read_wrf_chem_emissions: error opening ', TRIM( inpname )<a name='1853'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_224">( TRIM( message ) )<a name='1854'>
        ENDIF<a name='1855'>
      ENDIF<a name='1856'>
<a name='1857'>
       print *,' HOURLY EMISSIONS UPDATE TIME ',time,mod(time,3600.)<a name='1858'>
<font color=#447700>!      print *, grid%current_time + grid%step_time, grid%stop_time<a name='1859'></font>
<font color=#447700>! hourly updates to emissions<a name='1860'></font>
      IF ( ( mod( time, 3600. ) .EQ. 0   ) .AND. &amp;<a name='1861'>
           ( grid%current_time + grid%step_time .LT. grid%stop_time ) ) THEN<a name='1862'>
<font color=#447700>!        IF ( wrf_dm_on_monitor() ) CALL start_timing<a name='1863'></font>
<a name='1864'>
         WRITE(message,*)'mediation_integrate: med_read_wrf_chem_emissions: Read emissions for time ',TRIM(current_date_char)<a name='1865'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_84">( TRIM(message) )<a name='1866'>
<a name='1867'>
         CALL wrf_debug (100 , 'mediation_integrate: calling input_aux_model_input5' )<a name='1868'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT5'>input_aux_model_input5</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT5_3"> ( grid%auxinput5_oid, grid , config_flags , ierr )<a name='1869'>
      ELSE<a name='1870'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_225"> (100 , 'mediation_integrate: med_read_wrf_chem_emissions: Do not read emissions' )<a name='1871'>
      ENDIF<a name='1872'>
<a name='1873'>
<font color=#447700>!     ! Close the data file at 11z and 23z<a name='1874'></font>
<font color=#447700>!     IF ( ( time - 11. * 3600. ) .GE. 0.   ) THEN<a name='1875'></font>
<font color=#447700>!        CALL close_dataset ( grid%auxinput5_oid , config_flags , "DATASET=AUXINPUT5" )<a name='1876'></font>
<font color=#447700>!     ENDIF<a name='1877'></font>
<a name='1878'>
   ENDIF<a name='1879'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_226"> (100 , 'mediation_integrate: med_read_wrf_chem_emissions: exit' )<a name='1880'>
<a name='1881'>
END SUBROUTINE med_read_wrf_chem_emiss<a name='1882'>
<a name='1883'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='1884'></font>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='1885'></font>
<a name='1886'>
<A NAME='MED_READ_WRF_CHEM_BIOEMISS'><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1887'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_read_wrf_chem_bioemiss</font> ( grid , config_flags ) <A href='../../call_to/MED_READ_WRF_CHEM_BIOEMISS.html' TARGET='index'>3</A>,<A href='../../call_from/MED_READ_WRF_CHEM_BIOEMISS.html' TARGET='index'>17</A><a name='1888'>
  <font color=#447700>! Driver layer<a name='1889'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_152"><a name='1890'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_27"><a name='1891'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_37"><a name='1892'>
  <font color=#447700>! Model layer<a name='1893'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_164"><a name='1894'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_12"><a name='1895'>
#ifdef DM_PARALLEL<a name='1896'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_34"><a name='1897'>
#endif<a name='1898'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_12"><a name='1899'>
   USE WRF_ESMF_Mod<a name='1900'>
<a name='1901'>
   IMPLICIT NONE<a name='1902'>
<a name='1903'>
  <font color=#447700>! Arguments<a name='1904'></font>
   TYPE(domain)                               :: grid<a name='1905'>
<a name='1906'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='1907'>
   Type (ESMF_Time )                          :: start_time, stop_time, current_time<a name='1908'>
   TYPE(ESMF_TimeInterval)                    :: time_interval<a name='1909'>
<a name='1910'>
  <font color=#447700>! Local data<a name='1911'></font>
   LOGICAL, EXTERNAL                      :: wrf_dm_on_monitor<a name='1912'>
<a name='1913'>
   INTEGER                                :: ierr, efid<a name='1914'>
   REAL                                   :: time, tupdate<a name='1915'>
   real, allocatable :: dumc0(:,:,:)<a name='1916'>
   CHARACTER (LEN=256)                    :: message, current_date_char, date_string<a name='1917'>
   CHARACTER (LEN=80)                     :: inpname<a name='1918'>
<a name='1919'>
#include &lt;<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>&gt;<A NAME="wrf_io_flags.h_16"><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1920'>
    IF ( grid%id .EQ. 1 ) THEN<a name='1921'>
<a name='1922'>
      CALL ESMF_ClockGet( grid%domain_clock, CurrTime=grid%current_time, rc=ierr )<a name='1923'>
      CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_26"> ( grid%current_time, current_date_char )<a name='1924'>
<a name='1925'>
<font color=#447700>!     IF( grid%current_time + grid%step_time .GE. grid%stop_time ) then<a name='1926'></font>
<font color=#447700>!       return<a name='1927'></font>
<font color=#447700>!     ENDIF<a name='1928'></font>
<a name='1929'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_15"> ( inpname , 'wrfbiochemi' , grid%id , 2 )<a name='1930'>
      WRITE(message,*)'mediation_integrate: med_read_wrf_chem_bioemissions: Open file ',TRIM(inpname)<a name='1931'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_85">( TRIM(message) )<a name='1932'>
<a name='1933'>
     if( grid%auxinput4_oid .NE. 0 ) then<a name='1934'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_32"> ( grid%auxinput4_oid , config_flags , "DATASET=AUXINPUT4" )<a name='1935'>
     endif<a name='1936'>
<a name='1937'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_19"> ( grid%auxinput4_oid, TRIM(inpname) , grid , config_flags, &amp;<a name='1938'>
                              "DATASET=AUXINPUT4", ierr )<a name='1939'>
        IF ( ierr .NE. 0 ) THEN<a name='1940'>
           WRITE( message , * ) 'med_read_wrf_chem_bioemissions: error opening ', TRIM( inpname )<a name='1941'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_225">( TRIM( message ) )<a name='1942'>
        ENDIF<a name='1943'>
<a name='1944'>
         WRITE(message,*)'mediation_integrate: med_read_wrf_chem_bioemissions: Read biogenic emissions at time ',&amp;<a name='1945'>
         TRIM(current_date_char)<a name='1946'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_86">( TRIM(message) )<a name='1947'>
<a name='1948'>
         CALL wrf_debug (100 , 'mediation_integrate: calling input_aux_model_input4' )<a name='1949'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_AUX_MODEL_INPUT4'>input_aux_model_input4</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_AUX_MODEL_INPUT4_3"> ( grid%auxinput4_oid, grid , config_flags , ierr )<a name='1950'>
<a name='1951'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_33"> ( grid%auxinput4_oid , config_flags , "DATASET=AUXINPUT4" )<a name='1952'>
<a name='1953'>
   ENDIF<a name='1954'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_227"> (100 , 'mediation_integrate: med_read_wrf_chem_bioemissions: exit' )<a name='1955'>
<a name='1956'>
END SUBROUTINE med_read_wrf_chem_bioemiss<a name='1957'>
<a name='1958'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='1959'></font>
</pre></body></html>