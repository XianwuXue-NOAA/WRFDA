From Version 2.2, WRF 4DVAR system begin to use wrfvar trunk , wrf trunk and wrfplus. 

I :  To run the system using a ready configuration

1, The whole reorganized and precompiled system now located at ~xinzhang/msswrf/release, all case data and executables are ready. 

2, A demonstrated job scripts located at ~/scripts/da_run_suite_wrapper_test.ksh. please modify this script to suite your case.


II:  To setup the system (on willow and goldenrain) :

1, Check out wrfvar trunk
   svn co https://svn-wrf-var.cgd.ucar.edu/trunk wrfvar

2, Check out wrfplus 
   svn co https://svn-wrf-var.cgd.ucar.edu/branches/BR_2005workshop wrfplus

3, Check out wrf trunk
   svn co https://svn-wrf-model.cgd.ucar.edu/trunk wrf

4, Get WRF_BC installed

4, Subsititue wrf/Registry/Registry.EM with wrfplus/parallel/wrf/Regisrty/Registry.EM
   Subsititue wrf/external/RSL/module_dm.F with wrfplus/parallel/external/RSL/module_dm.F
   Subsititue wrf/external/RSL_LITE/module_dm.F with wrfplus/parallel/external/RSL/_LITEmodule_dm.F

5, Compile wrfvar trunk (use G95)
   cd  wrfvar
   source setup.csh g95
   ./configure wrfvar (select 1, if you like, you can change the optimization level to O2)
   ./compile wrfvar

6, Compile wrf trunk (use xlf)
   cd wrf
   ./configure (select 1)
   edit configure.wrf, add -lSystemStubs at the end of LIB
   ./compile wrf
   cp wrfvar/inc/namelist_script_wrf_wps_2004.inc inc/namelist_script.inc

7, Compile wrfplus (use xlf)
   cd wrfplus
   ./configure wrfplus (select 1)
   ./compile wrf
   If Sucessful, cd main; ln -sf wrf.exe wrfplus.exe
   (note: make sure the namelist_script.inc is existed in inc/ diretory, if deleted by "clean -a", use "svn revert inc/namelist_script.inc to restore)
   
8, Run the testdata 
   cd ~xinzhang/scripts and get a copy of da_run_suite_wrapper_test.ksh
   edit da_run_suite_wrapper_test.ksh
   da_run_suite_wrapper_test.ksh

Note: The WRF 4DVAR home directory is REL_DIR  
      the input dataset directory is DAT_DIR
      the output directory is EXP_DIR, the print out is in html format now, you can use lynx to see the output (looking for the index.html).
      for 4dvar, set NL_VAR4D = true, otherwise, set NL_VAR4D = false

