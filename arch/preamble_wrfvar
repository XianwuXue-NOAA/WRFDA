#=============================
# Start of preamble
#=============================

# System properties

SHELL           =       /bin/sh
REGISTRY        =       Registry

#Macros, these should be generic for all machines

LN      =       ln -sf
MAKE    =       make -i -r
RM      =       /bin/rm -f
MV      =       /bin/mv -f
CP      =       /bin/cp -f
AR      =       ar ru
M4      =       m4 -B12000

.SUFFIXES: .F .i .o .f .c

# Substituted by Config_wrfvar.pl

DEVTOP      = CONFIGURE_DEVTOP
PERL        = CONFIGURE_PERL_PATH
NETCDFPATH  = CONFIGURE_NETCDF_PATH
PHDF5PATH   = CONFIGURE_PHDF5_PATH
RTTOVPATH   = CONFIGURE_RTTOV_PATH
RTTOV_LIB   = CONFIGURE_RTTOV_LIB
ENVCOMPDEFS = CONFIGURE_COMPILEFLAGS
ARCHFLAGS1  = CONFIGURE_NETCDF_FLAG CONFIGURE_RTTOV_FLAG
WRFIO       = CONFIGURE_WRFIO_NF wrfio_int wrfio_grib1

# Short cuts to directories

ARCH      = $(DEVTOP)/arch
CHEM      = $(DEVTOP)/chem
CONVERTOR = $(DEVTOP)/convertor
DA_VAR    = $(DEVTOP)/da_3dvar
DA_BE     = $(DEVTOP)/da_be
DYN_EM    = $(DEVTOP)/dyn_em
DYN_EXP   = $(DEVTOP)/dyn_exp
DYN_NMM   = $(DEVTOP)/dyn_nmm
EXTERNAL  = $(DEVTOP)/external
FRAME     = $(DEVTOP)/frame
GEN_BE    = $(DEVTOP)/ge_be
INC       = $(DEVTOP)/inc
MAIN      = $(DEVTOP)/main
PHYS      = $(DEVTOP)/phys
RUN       = $(DEVTOP)/run
SCRIPTS   = $(DEVTOP)/scripts
SHARE     = $(DEVTOP)/share
TEST      = $(DEVTOP)/test
TOOLS     = $(DEVTOP)/tools

DA_SRC        = $(DA_VAR)/src
IO_GRIB1      = $(EXTERNAL)/io_grib1
IO_INT        = $(EXTERNAL)/io_int
ESMF_TIME_F90 = $(EXTERNAL)/esmf_time_f90
IO_NETCDF     = $(EXTERNAL)/io_netcdf
IOAPI_SHARE   = $(EXTERNAL)/ioapi_share

NETCDF_LIB = -L$(EXTERNAL)/io_netcdf -lwrfio_nf -L$(NETCDFPATH)/lib -lnetcdf
PHDF5_LIB  = -L\$(EXTERNAL)/io_phdf5 -lwrfio_phdf5 -L$(PHDF5PATH)/lib -lhdf5_fortran -lhdf5 -lm -lz -L$(PHDF5PATH)/lib -lsz
LIBINCLUDE = -I. -I$(INC) -I$(IOAPI_SHARE)

ARCHFLAGS2      = $(WORDSIZE_DEF)

#### Get core settings from environment (set in compile script)
#### Note to add a core, this has to be added to.
WRFVAR   = -DWRFVAR
NETCDF_IO_PATH  =       external/io_netcdf

COREDEFS = -DEM_CORE=$(WRF_EM_CORE) \
           -DNMM_CORE=$(WRF_NMM_CORE) -DNMM_MAX_DIM=1250 \
	   -DCOAMPS_CORE=$(WRF_COAMPS_CORE) \
           -DEXP_CORE=$(WRF_EXP_CORE) \
           -DDA_CORE=$(WRF_DA_CORE) \
	   $(WRFVAR)

#### For wrfvar, always use RWORDSIZE 8

RWORDSIZE	=	8
DWORDSIZE	=	8
WORDSIZE_DEF	=	-DIWORDSIZE=4 -DDWORDSIZE=$(DWORDSIZE) -DRWORDSIZE=$(RWORDSIZE) -DLWORDSIZE=4

#### Single location for defining total number of domains.  You need
#### at least 1 + 2*(number of total nests).  For example, 1 coarse
#### grid + three fine grids = 1 + 2(3) = 7, so MAX_DOMAINS=7.

MAX_DOMAINS	=	21
MAX_PROC	=	1024
RANLIB		=	ranlib

MPI_LIB		=
LOCAL_LIB	=
CONVERTOR_LIB	=

#### DM buffer length for the configuration flags.

CONFIG_BUF_LEN	=	8192

#### Default sed command and script for Fortran source files ####
SED_FTN = sed -f ../arch/standard.sed

#### Default ESMF dependence for embedded ESMF time manager ####
ESMF_MOD_DEPENDENCE = ../external/esmf_time_f90/ESMF_Mod.o

WRF_LIB		=	-L../external/io_int -lwrfio_int \
			-L../external/io_grib1 -lio_grib1 \
			-L../external/esmf_time_f90 -lesmf_time \
			../frame/module_internal_header_util.o \
			../frame/pack_utils.o

#### Architecture specific settings ####

